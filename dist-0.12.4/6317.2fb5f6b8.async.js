(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[6317],{64335:function(ar,O,_){"use strict";var Q=_(67294),E=(0,Q.createContext)({});O.Z=E},21349:function(ar,O,_){"use strict";var Q=_(84305),E=_(69224),p=_(17781),b=_.n(p),X=_(67294),W=_(94184),$=_.n(W),I=_(64335),k=function(Be){var We=(0,X.useContext)(I.Z),$e=Be.children,Vt=Be.contentWidth,Ht=Be.className,At=Be.style,Ot=(0,X.useContext)(E.ZP.ConfigContext),bt=Ot.getPrefixCls,dt=Be.prefixCls||bt("pro"),Pr=Vt||We.contentWidth,er="".concat(dt,"-grid-content");return X.createElement("div",{className:$()(er,Ht,{wide:Pr==="Fixed"}),style:At},X.createElement("div",{className:"".concat(dt,"-grid-content-children")},$e))};O.Z=k},46343:function(ar,O,_){"use strict";_.d(O,{zj:function(){return yt},oI:function(){return on},ni:function(){return oe},gg:function(){return Dr}});var Q=_(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function E(tr,se,be,Fe){function Ee(wt){return wt instanceof be?wt:new be(function(Bt){Bt(wt)})}return new(be||(be=Promise))(function(wt,Bt){function w(je){try{he(Fe.next(je))}catch(et){Bt(et)}}function N(je){try{he(Fe.throw(je))}catch(et){Bt(et)}}function he(je){je.done?wt(je.value):Ee(je.value).then(w,N)}he((Fe=Fe.apply(tr,se||[])).next())})}function p(tr,se){var be={label:0,sent:function(){if(wt[0]&1)throw wt[1];return wt[1]},trys:[],ops:[]},Fe,Ee,wt,Bt;return Bt={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(Bt[Symbol.iterator]=function(){return this}),Bt;function w(he){return function(je){return N([he,je])}}function N(he){if(Fe)throw new TypeError("Generator is already executing.");for(;be;)try{if(Fe=1,Ee&&(wt=he[0]&2?Ee.return:he[0]?Ee.throw||((wt=Ee.return)&&wt.call(Ee),0):Ee.next)&&!(wt=wt.call(Ee,he[1])).done)return wt;switch(Ee=0,wt&&(he=[he[0]&2,wt.value]),he[0]){case 0:case 1:wt=he;break;case 4:return be.label++,{value:he[1],done:!1};case 5:be.label++,Ee=he[1],he=[0];continue;case 7:he=be.ops.pop(),be.trys.pop();continue;default:if(wt=be.trys,!(wt=wt.length>0&&wt[wt.length-1])&&(he[0]===6||he[0]===2)){be=0;continue}if(he[0]===3&&(!wt||he[1]>wt[0]&&he[1]<wt[3])){be.label=he[1];break}if(he[0]===6&&be.label<wt[1]){be.label=wt[1],wt=he;break}if(wt&&be.label<wt[2]){be.label=wt[2],be.ops.push(he);break}wt[2]&&be.ops.pop(),be.trys.pop();continue}he=se.call(tr,be)}catch(je){he=[6,je],Ee=0}finally{Fe=wt=0}if(he[0]&5)throw he[1];return{value:he[0]?he[1]:void 0,done:!0}}}function b(tr,se){var be=typeof Symbol=="function"&&tr[Symbol.iterator];if(!be)return tr;var Fe=be.call(tr),Ee,wt=[],Bt;try{for(;(se===void 0||se-- >0)&&!(Ee=Fe.next()).done;)wt.push(Ee.value)}catch(w){Bt={error:w}}finally{try{Ee&&!Ee.done&&(be=Fe.return)&&be.call(Fe)}finally{if(Bt)throw Bt.error}}return wt}function X(){for(var tr=[],se=0;se<arguments.length;se++)tr=tr.concat(b(arguments[se]));return tr}function W(tr){return tr&&tr.__esModule&&Object.prototype.hasOwnProperty.call(tr,"default")?tr.default:tr}function $(tr,se){return se={exports:{}},tr(se,se.exports),se.exports}var I=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=be;function be(Fe){return Fe&&typeof Fe.length=="number"&&Fe.length>=0&&Fe.length%1==0}tr.exports=se.default});W(I);var k=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=function(be){return function(){for(var Fe=[],Ee=arguments.length;Ee--;)Fe[Ee]=arguments[Ee];var wt=Fe.pop();return be.call(this,Fe,wt)}},tr.exports=se.default});W(k);var Ce=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.fallback=Ee,se.wrap=wt;var be=se.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,Fe=se.hasNextTick=typeof Q=="object"&&typeof Q.nextTick=="function";function Ee(w){setTimeout(w,0)}function wt(w){return function(N){for(var he=[],je=arguments.length-1;je-- >0;)he[je]=arguments[je+1];return w(function(){return N.apply(void 0,he)})}}var Bt;be?Bt=setImmediate:Fe?Bt=Q.nextTick:Bt=Ee,se.default=wt(Bt)});W(Ce);var Be=Ce.fallback,We=Ce.wrap,$e=Ce.hasSetImmediate,Vt=Ce.hasNextTick,Ht=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=wt;var be=Ee(k),Fe=Ee(Ce);function Ee(N){return N&&N.__esModule?N:{default:N}}function wt(N){return(0,At.isAsync)(N)?function(){for(var he=[],je=arguments.length;je--;)he[je]=arguments[je];var et=he.pop(),_t=N.apply(this,he);return Bt(_t,et)}:(0,be.default)(function(he,je){var et;try{et=N.apply(this,he)}catch(_t){return je(_t)}if(et&&typeof et.then=="function")return Bt(et,je);je(null,et)})}function Bt(N,he){return N.then(function(je){w(he,null,je)},function(je){w(he,je&&je.message?je:new Error(je))})}function w(N,he,je){try{N(he,je)}catch(et){(0,Fe.default)(function(_t){throw _t},et)}}tr.exports=se.default});W(Ht);var At=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.isAsyncIterable=se.isAsyncGenerator=se.isAsync=void 0;var be=Fe(Ht);function Fe(N){return N&&N.__esModule?N:{default:N}}function Ee(N){return N[Symbol.toStringTag]==="AsyncFunction"}function wt(N){return N[Symbol.toStringTag]==="AsyncGenerator"}function Bt(N){return typeof N[Symbol.asyncIterator]=="function"}function w(N){if(typeof N!="function")throw new Error("expected a function");return Ee(N)?(0,be.default)(N):N}se.default=w,se.isAsync=Ee,se.isAsyncGenerator=wt,se.isAsyncIterable=Bt});W(At);var Ot=At.isAsyncIterable,bt=At.isAsyncGenerator,dt=At.isAsync,Pr=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=be;function be(Fe,Ee){if(Ee===void 0&&(Ee=Fe.length),!Ee)throw new Error("arity is undefined");function wt(){for(var Bt=this,w=[],N=arguments.length;N--;)w[N]=arguments[N];return typeof w[Ee-1]=="function"?Fe.apply(this,w):new Promise(function(he,je){w[Ee-1]=function(et){for(var _t=[],Ct=arguments.length-1;Ct-- >0;)_t[Ct]=arguments[Ct+1];if(et)return je(et);he(_t.length>1?_t:_t[0])},Fe.apply(Bt,w)})}return Object.defineProperty(wt,"name",{configurable:!0,value:"awaitable("+Fe.name+")"}),wt}tr.exports=se.default});W(Pr);var er=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0});var be=wt(I),Fe=wt(At),Ee=wt(Pr);function wt(Bt){return Bt&&Bt.__esModule?Bt:{default:Bt}}se.default=(0,Ee.default)(function(Bt,w,N){var he=(0,be.default)(w)?[]:{};Bt(w,function(je,et,_t){(0,Fe.default)(je)(function(Ct){for(var V,Yt=[],kt=arguments.length-1;kt-- >0;)Yt[kt]=arguments[kt+1];Yt.length<2&&(V=Yt,Yt=V[0]),he[et]=Yt,_t(Ct)})},function(je){return N(je,he)})},3),tr.exports=se.default});W(er);var Ft=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=be;function be(Fe){function Ee(){for(var wt=[],Bt=arguments.length;Bt--;)wt[Bt]=arguments[Bt];if(Fe!==null){var w=Fe;Fe=null,w.apply(this,wt)}}return Object.assign(Ee,Fe),Ee}tr.exports=se.default});W(Ft);var tt=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=function(be){return be[Symbol.iterator]&&be[Symbol.iterator]()},tr.exports=se.default});W(tt);var Ne=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=N;var be=Ee(I),Fe=Ee(tt);function Ee(he){return he&&he.__esModule?he:{default:he}}function wt(he){var je=-1,et=he.length;return function(){return++je<et?{value:he[je],key:je}:null}}function Bt(he){var je=-1;return function(){var _t=he.next();return _t.done?null:(je++,{value:_t.value,key:je})}}function w(he){var je=he?Object.keys(he):[],et=-1,_t=je.length;return function(){var V=je[++et];return et<_t?{value:he[V],key:V}:null}}function N(he){if((0,be.default)(he))return wt(he);var je=(0,Fe.default)(he);return je?Bt(je):w(he)}tr.exports=se.default});W(Ne);var Qe=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=be;function be(Fe){return function(){for(var Ee=[],wt=arguments.length;wt--;)Ee[wt]=arguments[wt];if(Fe===null)throw new Error("Callback was already called.");var Bt=Fe;Fe=null,Bt.apply(this,Ee)}}tr.exports=se.default});W(Qe);var Ie=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0});var be={};se.default=be,tr.exports=se.default});W(Ie);var Ae=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=Ee;var be=Fe(Ie);function Fe(wt){return wt&&wt.__esModule?wt:{default:wt}}function Ee(wt,Bt,w,N){var he=!1,je=!1,et=!1,_t=0,Ct=0;function V(){_t>=Bt||et||he||(et=!0,wt.next().then(function(fr){var Cr=fr.value,Tr=fr.done;if(!(je||he)){if(et=!1,Tr){he=!0,_t<=0&&N(null);return}_t++,w(Cr,Ct,Yt),Ct++,V()}}).catch(kt))}function Yt(fr,Cr){if(_t-=1,!je){if(fr)return kt(fr);if(fr===!1){he=!0,je=!0;return}if(Cr===be.default||he&&_t<=0)return he=!0,N(null);V()}}function kt(fr){je||(et=!1,he=!0,N(fr))}V()}tr.exports=se.default});W(Ae);var Ue=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0});var be=w(Ft),Fe=w(Ne),Ee=w(Qe),wt=w(Ae),Bt=w(Ie);function w(N){return N&&N.__esModule?N:{default:N}}se.default=function(N){return function(he,je,et){if(et=(0,be.default)(et),N<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!he)return et(null);if((0,At.isAsyncGenerator)(he))return(0,wt.default)(he,N,je,et);if((0,At.isAsyncIterable)(he))return(0,wt.default)(he[Symbol.asyncIterator](),N,je,et);var _t=(0,Fe.default)(he),Ct=!1,V=!1,Yt=0,kt=!1;function fr(Tr,Ar){if(!V)if(Yt-=1,Tr)Ct=!0,et(Tr);else if(Tr===!1)Ct=!0,V=!0;else{if(Ar===Bt.default||Ct&&Yt<=0)return Ct=!0,et(null);kt||Cr()}}function Cr(){for(kt=!0;Yt<N&&!Ct;){var Tr=_t();if(Tr===null){Ct=!0,Yt<=0&&et(null);return}Yt+=1,je(Tr.value,Tr.key,(0,Ee.default)(fr))}kt=!1}Cr()}},tr.exports=se.default});W(Ue);var St=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0});var be=wt(Ue),Fe=wt(At),Ee=wt(Pr);function wt(w){return w&&w.__esModule?w:{default:w}}function Bt(w,N,he,je){return(0,be.default)(N)(w,(0,Fe.default)(he),je)}se.default=(0,Ee.default)(Bt,4),tr.exports=se.default});W(St);var ur=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0});var be=Ee(St),Fe=Ee(Pr);function Ee(Bt){return Bt&&Bt.__esModule?Bt:{default:Bt}}function wt(Bt,w,N){return(0,be.default)(Bt,1,w,N)}se.default=(0,Fe.default)(wt,3),tr.exports=se.default});W(ur);var ae=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=wt;var be=Ee(er),Fe=Ee(ur);function Ee(Bt){return Bt&&Bt.__esModule?Bt:{default:Bt}}function wt(Bt,w){return(0,be.default)(Fe.default,Bt,w)}tr.exports=se.default}),Te=W(ae),oe=function(){function tr(){for(var se=arguments,be=[],Fe=0;Fe<arguments.length;Fe++)be[Fe]=se[Fe];this.args=[],this.tasks=[]}return tr.prototype.call=function(){for(var se=arguments,be=[],Fe=0;Fe<arguments.length;Fe++)be[Fe]=se[Fe];return this.args=be,Te(this.tasks)},tr.prototype.tap=function(se,be){var Fe=this;this.tasks.push(function(Ee){be.apply(void 0,X(Fe.args)),Ee(null,se)})},tr}(),me=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0});var be=he(I),Fe=he(Ie),Ee=he(St),wt=he(Ft),Bt=he(Qe),w=he(At),N=he(Pr);function he(Ct){return Ct&&Ct.__esModule?Ct:{default:Ct}}function je(Ct,V,Yt){Yt=(0,wt.default)(Yt);var kt=0,fr=0,Cr=Ct.length,Tr=!1;Cr===0&&Yt(null);function Ar(Je,xt){Je===!1&&(Tr=!0),Tr!==!0&&(Je?Yt(Je):(++fr===Cr||xt===Fe.default)&&Yt(null))}for(;kt<Cr;kt++)V(Ct[kt],kt,(0,Bt.default)(Ar))}function et(Ct,V,Yt){return(0,Ee.default)(Ct,Infinity,V,Yt)}function _t(Ct,V,Yt){var kt=(0,be.default)(Ct)?je:et;return kt(Ct,(0,w.default)(V),Yt)}se.default=(0,N.default)(_t,3),tr.exports=se.default});W(me);var Me=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0}),se.default=wt;var be=Ee(me),Fe=Ee(er);function Ee(Bt){return Bt&&Bt.__esModule?Bt:{default:Bt}}function wt(Bt,w){return(0,Fe.default)(be.default,Bt,w)}tr.exports=se.default}),qe=W(Me),yt=function(){function tr(){for(var se=arguments,be=[],Fe=0;Fe<arguments.length;Fe++)be[Fe]=se[Fe];this.tasks=[]}return tr.prototype.promise=function(){for(var se=arguments,be=[],Fe=0;Fe<arguments.length;Fe++)be[Fe]=se[Fe];return qe(this.tasks)},tr.prototype.tapPromise=function(se,be){var Fe=this;this.tasks.push(function(Ee){return E(Fe,void 0,void 0,function(){return p(this,function(wt){switch(wt.label){case 0:return[4,be()];case 1:return wt.sent(),Ee(null,se),[2]}})})})},tr}(),Qt=$(function(tr,se){Object.defineProperty(se,"__esModule",{value:!0});var be=Bt(Ft),Fe=Bt(Qe),Ee=Bt(At),wt=Bt(Pr);function Bt(N){return N&&N.__esModule?N:{default:N}}function w(N,he){if(he=(0,be.default)(he),!Array.isArray(N))return he(new Error("First argument to waterfall must be an array of functions"));if(!N.length)return he();var je=0;function et(Ct){var V=(0,Ee.default)(N[je++]);V.apply(void 0,Ct.concat([(0,Fe.default)(_t)]))}function _t(Ct){for(var V=[],Yt=arguments.length-1;Yt-- >0;)V[Yt]=arguments[Yt+1];if(Ct!==!1){if(Ct||je===N.length)return he.apply(void 0,[Ct].concat(V));et(V)}}et([])}se.default=(0,wt.default)(w),tr.exports=se.default}),Or=W(Qt),Dr=function(){function tr(){for(var se=arguments,be=[],Fe=0;Fe<arguments.length;Fe++)be[Fe]=se[Fe];this.tasks=[]}return tr.prototype.call=function(){for(var se=arguments,be=[],Fe=0;Fe<arguments.length;Fe++)be[Fe]=se[Fe];return Or(this.tasks)},tr.prototype.tap=function(se,be){this.tasks.length===0?this.tasks.push(function(Fe){var Ee=be();Fe(Ee?null:!1,Ee)}):this.tasks.push(function(Fe,Ee){var wt=be();Ee(wt?null:!1,se)})},tr}(),on=function(){function tr(){for(var se=arguments,be=[],Fe=0;Fe<arguments.length;Fe++)be[Fe]=se[Fe];this.tasks=[]}return tr.prototype.call=function(){for(var se=arguments,be=[],Fe=0;Fe<arguments.length;Fe++)be[Fe]=se[Fe];return Te(this.tasks)},tr.prototype.tap=function(se,be){this.tasks.push(function(Fe){var Ee=be();Fe(Ee,se)})},tr}()},58881:function(ar,O,_){"use strict";_.d(O,{nC:function(){return Q.ZP},Hp:function(){return Q.Hp},e7:function(){return Q.e7},yT:function(){return Q.yT},vK:function(){return p.v},h0:function(){return X.h},GC:function(){return W.GC},vY:function(){return W.vY},ee:function(){return W.ee},MapServiceEvent:function(){return k.I},CoordinateSystem:function(){return Ce.l},CoordinateUniform:function(){return Ce.k},CameraUniform:function(){return $e.l},SceneEventList:function(){return At.P},PositionType:function(){return tt.d},gl:function(){return N.gl}});var Q=_(85951),E=_(69530),p=_(72302),b=_(76915),X=_(77252),W=_(31251),$=_(8628),I=_.n($);_.o($,"CameraUniform")&&_.d(O,{CameraUniform:function(){return $.CameraUniform}}),_.o($,"CityBuildingLayer")&&_.d(O,{CityBuildingLayer:function(){return $.CityBuildingLayer}}),_.o($,"CoordinateSystem")&&_.d(O,{CoordinateSystem:function(){return $.CoordinateSystem}}),_.o($,"CoordinateUniform")&&_.d(O,{CoordinateUniform:function(){return $.CoordinateUniform}}),_.o($,"HeatmapLayer")&&_.d(O,{HeatmapLayer:function(){return $.HeatmapLayer}}),_.o($,"ImageLayer")&&_.d(O,{ImageLayer:function(){return $.ImageLayer}}),_.o($,"LineLayer")&&_.d(O,{LineLayer:function(){return $.LineLayer}}),_.o($,"MapServiceEvent")&&_.d(O,{MapServiceEvent:function(){return $.MapServiceEvent}}),_.o($,"Marker")&&_.d(O,{Marker:function(){return $.Marker}}),_.o($,"PointLayer")&&_.d(O,{PointLayer:function(){return $.PointLayer}}),_.o($,"PolygonLayer")&&_.d(O,{PolygonLayer:function(){return $.PolygonLayer}}),_.o($,"Popup")&&_.d(O,{Popup:function(){return $.Popup}}),_.o($,"PositionType")&&_.d(O,{PositionType:function(){return $.PositionType}}),_.o($,"RasterLayer")&&_.d(O,{RasterLayer:function(){return $.RasterLayer}}),_.o($,"Scene")&&_.d(O,{Scene:function(){return $.Scene}}),_.o($,"SceneEventList")&&_.d(O,{SceneEventList:function(){return $.SceneEventList}}),_.o($,"gl")&&_.d(O,{gl:function(){return $.gl}});var k=_(16606),Ce=_(47282),Be=_(41906),We=_.n(Be);_.o(Be,"CameraUniform")&&_.d(O,{CameraUniform:function(){return Be.CameraUniform}}),_.o(Be,"CityBuildingLayer")&&_.d(O,{CityBuildingLayer:function(){return Be.CityBuildingLayer}}),_.o(Be,"HeatmapLayer")&&_.d(O,{HeatmapLayer:function(){return Be.HeatmapLayer}}),_.o(Be,"ImageLayer")&&_.d(O,{ImageLayer:function(){return Be.ImageLayer}}),_.o(Be,"LineLayer")&&_.d(O,{LineLayer:function(){return Be.LineLayer}}),_.o(Be,"Marker")&&_.d(O,{Marker:function(){return Be.Marker}}),_.o(Be,"PointLayer")&&_.d(O,{PointLayer:function(){return Be.PointLayer}}),_.o(Be,"PolygonLayer")&&_.d(O,{PolygonLayer:function(){return Be.PolygonLayer}}),_.o(Be,"Popup")&&_.d(O,{Popup:function(){return Be.Popup}}),_.o(Be,"PositionType")&&_.d(O,{PositionType:function(){return Be.PositionType}}),_.o(Be,"RasterLayer")&&_.d(O,{RasterLayer:function(){return Be.RasterLayer}}),_.o(Be,"Scene")&&_.d(O,{Scene:function(){return Be.Scene}}),_.o(Be,"SceneEventList")&&_.d(O,{SceneEventList:function(){return Be.SceneEventList}}),_.o(Be,"gl")&&_.d(O,{gl:function(){return Be.gl}});var $e=_(4594),Vt=_(1910),Ht=_.n(Vt);_.o(Vt,"CityBuildingLayer")&&_.d(O,{CityBuildingLayer:function(){return Vt.CityBuildingLayer}}),_.o(Vt,"HeatmapLayer")&&_.d(O,{HeatmapLayer:function(){return Vt.HeatmapLayer}}),_.o(Vt,"ImageLayer")&&_.d(O,{ImageLayer:function(){return Vt.ImageLayer}}),_.o(Vt,"LineLayer")&&_.d(O,{LineLayer:function(){return Vt.LineLayer}}),_.o(Vt,"Marker")&&_.d(O,{Marker:function(){return Vt.Marker}}),_.o(Vt,"PointLayer")&&_.d(O,{PointLayer:function(){return Vt.PointLayer}}),_.o(Vt,"PolygonLayer")&&_.d(O,{PolygonLayer:function(){return Vt.PolygonLayer}}),_.o(Vt,"Popup")&&_.d(O,{Popup:function(){return Vt.Popup}}),_.o(Vt,"PositionType")&&_.d(O,{PositionType:function(){return Vt.PositionType}}),_.o(Vt,"RasterLayer")&&_.d(O,{RasterLayer:function(){return Vt.RasterLayer}}),_.o(Vt,"Scene")&&_.d(O,{Scene:function(){return Vt.Scene}}),_.o(Vt,"SceneEventList")&&_.d(O,{SceneEventList:function(){return Vt.SceneEventList}}),_.o(Vt,"gl")&&_.d(O,{gl:function(){return Vt.gl}});var At=_(19793),Ot=_(93102),bt=_.n(Ot);_.o(Ot,"CityBuildingLayer")&&_.d(O,{CityBuildingLayer:function(){return Ot.CityBuildingLayer}}),_.o(Ot,"HeatmapLayer")&&_.d(O,{HeatmapLayer:function(){return Ot.HeatmapLayer}}),_.o(Ot,"ImageLayer")&&_.d(O,{ImageLayer:function(){return Ot.ImageLayer}}),_.o(Ot,"LineLayer")&&_.d(O,{LineLayer:function(){return Ot.LineLayer}}),_.o(Ot,"Marker")&&_.d(O,{Marker:function(){return Ot.Marker}}),_.o(Ot,"PointLayer")&&_.d(O,{PointLayer:function(){return Ot.PointLayer}}),_.o(Ot,"PolygonLayer")&&_.d(O,{PolygonLayer:function(){return Ot.PolygonLayer}}),_.o(Ot,"Popup")&&_.d(O,{Popup:function(){return Ot.Popup}}),_.o(Ot,"PositionType")&&_.d(O,{PositionType:function(){return Ot.PositionType}}),_.o(Ot,"RasterLayer")&&_.d(O,{RasterLayer:function(){return Ot.RasterLayer}}),_.o(Ot,"Scene")&&_.d(O,{Scene:function(){return Ot.Scene}}),_.o(Ot,"gl")&&_.d(O,{gl:function(){return Ot.gl}});var dt=_(64532),Pr=_.n(dt);_.o(dt,"CityBuildingLayer")&&_.d(O,{CityBuildingLayer:function(){return dt.CityBuildingLayer}}),_.o(dt,"HeatmapLayer")&&_.d(O,{HeatmapLayer:function(){return dt.HeatmapLayer}}),_.o(dt,"ImageLayer")&&_.d(O,{ImageLayer:function(){return dt.ImageLayer}}),_.o(dt,"LineLayer")&&_.d(O,{LineLayer:function(){return dt.LineLayer}}),_.o(dt,"Marker")&&_.d(O,{Marker:function(){return dt.Marker}}),_.o(dt,"PointLayer")&&_.d(O,{PointLayer:function(){return dt.PointLayer}}),_.o(dt,"PolygonLayer")&&_.d(O,{PolygonLayer:function(){return dt.PolygonLayer}}),_.o(dt,"Popup")&&_.d(O,{Popup:function(){return dt.Popup}}),_.o(dt,"PositionType")&&_.d(O,{PositionType:function(){return dt.PositionType}}),_.o(dt,"RasterLayer")&&_.d(O,{RasterLayer:function(){return dt.RasterLayer}}),_.o(dt,"Scene")&&_.d(O,{Scene:function(){return dt.Scene}}),_.o(dt,"gl")&&_.d(O,{gl:function(){return dt.gl}});var er=_(2811),Ft=_.n(er);_.o(er,"CityBuildingLayer")&&_.d(O,{CityBuildingLayer:function(){return er.CityBuildingLayer}}),_.o(er,"HeatmapLayer")&&_.d(O,{HeatmapLayer:function(){return er.HeatmapLayer}}),_.o(er,"ImageLayer")&&_.d(O,{ImageLayer:function(){return er.ImageLayer}}),_.o(er,"LineLayer")&&_.d(O,{LineLayer:function(){return er.LineLayer}}),_.o(er,"Marker")&&_.d(O,{Marker:function(){return er.Marker}}),_.o(er,"PointLayer")&&_.d(O,{PointLayer:function(){return er.PointLayer}}),_.o(er,"PolygonLayer")&&_.d(O,{PolygonLayer:function(){return er.PolygonLayer}}),_.o(er,"Popup")&&_.d(O,{Popup:function(){return er.Popup}}),_.o(er,"PositionType")&&_.d(O,{PositionType:function(){return er.PositionType}}),_.o(er,"RasterLayer")&&_.d(O,{RasterLayer:function(){return er.RasterLayer}}),_.o(er,"Scene")&&_.d(O,{Scene:function(){return er.Scene}}),_.o(er,"gl")&&_.d(O,{gl:function(){return er.gl}});var tt=_(66690),Ne=_(81732),Qe=_.n(Ne);_.o(Ne,"CityBuildingLayer")&&_.d(O,{CityBuildingLayer:function(){return Ne.CityBuildingLayer}}),_.o(Ne,"HeatmapLayer")&&_.d(O,{HeatmapLayer:function(){return Ne.HeatmapLayer}}),_.o(Ne,"ImageLayer")&&_.d(O,{ImageLayer:function(){return Ne.ImageLayer}}),_.o(Ne,"LineLayer")&&_.d(O,{LineLayer:function(){return Ne.LineLayer}}),_.o(Ne,"Marker")&&_.d(O,{Marker:function(){return Ne.Marker}}),_.o(Ne,"PointLayer")&&_.d(O,{PointLayer:function(){return Ne.PointLayer}}),_.o(Ne,"PolygonLayer")&&_.d(O,{PolygonLayer:function(){return Ne.PolygonLayer}}),_.o(Ne,"Popup")&&_.d(O,{Popup:function(){return Ne.Popup}}),_.o(Ne,"RasterLayer")&&_.d(O,{RasterLayer:function(){return Ne.RasterLayer}}),_.o(Ne,"Scene")&&_.d(O,{Scene:function(){return Ne.Scene}}),_.o(Ne,"gl")&&_.d(O,{gl:function(){return Ne.gl}});var Ie=_(84007),Ae=_.n(Ie);_.o(Ie,"CityBuildingLayer")&&_.d(O,{CityBuildingLayer:function(){return Ie.CityBuildingLayer}}),_.o(Ie,"HeatmapLayer")&&_.d(O,{HeatmapLayer:function(){return Ie.HeatmapLayer}}),_.o(Ie,"ImageLayer")&&_.d(O,{ImageLayer:function(){return Ie.ImageLayer}}),_.o(Ie,"LineLayer")&&_.d(O,{LineLayer:function(){return Ie.LineLayer}}),_.o(Ie,"Marker")&&_.d(O,{Marker:function(){return Ie.Marker}}),_.o(Ie,"PointLayer")&&_.d(O,{PointLayer:function(){return Ie.PointLayer}}),_.o(Ie,"PolygonLayer")&&_.d(O,{PolygonLayer:function(){return Ie.PolygonLayer}}),_.o(Ie,"Popup")&&_.d(O,{Popup:function(){return Ie.Popup}}),_.o(Ie,"RasterLayer")&&_.d(O,{RasterLayer:function(){return Ie.RasterLayer}}),_.o(Ie,"Scene")&&_.d(O,{Scene:function(){return Ie.Scene}}),_.o(Ie,"gl")&&_.d(O,{gl:function(){return Ie.gl}});var Ue=_(79042),St=_.n(Ue);_.o(Ue,"CityBuildingLayer")&&_.d(O,{CityBuildingLayer:function(){return Ue.CityBuildingLayer}}),_.o(Ue,"HeatmapLayer")&&_.d(O,{HeatmapLayer:function(){return Ue.HeatmapLayer}}),_.o(Ue,"ImageLayer")&&_.d(O,{ImageLayer:function(){return Ue.ImageLayer}}),_.o(Ue,"LineLayer")&&_.d(O,{LineLayer:function(){return Ue.LineLayer}}),_.o(Ue,"Marker")&&_.d(O,{Marker:function(){return Ue.Marker}}),_.o(Ue,"PointLayer")&&_.d(O,{PointLayer:function(){return Ue.PointLayer}}),_.o(Ue,"PolygonLayer")&&_.d(O,{PolygonLayer:function(){return Ue.PolygonLayer}}),_.o(Ue,"Popup")&&_.d(O,{Popup:function(){return Ue.Popup}}),_.o(Ue,"RasterLayer")&&_.d(O,{RasterLayer:function(){return Ue.RasterLayer}}),_.o(Ue,"Scene")&&_.d(O,{Scene:function(){return Ue.Scene}}),_.o(Ue,"gl")&&_.d(O,{gl:function(){return Ue.gl}});var ur=_(89648),ae=_(90919),Te=_.n(ae);_.o(ae,"CityBuildingLayer")&&_.d(O,{CityBuildingLayer:function(){return ae.CityBuildingLayer}}),_.o(ae,"HeatmapLayer")&&_.d(O,{HeatmapLayer:function(){return ae.HeatmapLayer}}),_.o(ae,"ImageLayer")&&_.d(O,{ImageLayer:function(){return ae.ImageLayer}}),_.o(ae,"LineLayer")&&_.d(O,{LineLayer:function(){return ae.LineLayer}}),_.o(ae,"Marker")&&_.d(O,{Marker:function(){return ae.Marker}}),_.o(ae,"PointLayer")&&_.d(O,{PointLayer:function(){return ae.PointLayer}}),_.o(ae,"PolygonLayer")&&_.d(O,{PolygonLayer:function(){return ae.PolygonLayer}}),_.o(ae,"Popup")&&_.d(O,{Popup:function(){return ae.Popup}}),_.o(ae,"RasterLayer")&&_.d(O,{RasterLayer:function(){return ae.RasterLayer}}),_.o(ae,"Scene")&&_.d(O,{Scene:function(){return ae.Scene}}),_.o(ae,"gl")&&_.d(O,{gl:function(){return ae.gl}});var oe=_(75925),me=_.n(oe);_.o(oe,"CityBuildingLayer")&&_.d(O,{CityBuildingLayer:function(){return oe.CityBuildingLayer}}),_.o(oe,"HeatmapLayer")&&_.d(O,{HeatmapLayer:function(){return oe.HeatmapLayer}}),_.o(oe,"ImageLayer")&&_.d(O,{ImageLayer:function(){return oe.ImageLayer}}),_.o(oe,"LineLayer")&&_.d(O,{LineLayer:function(){return oe.LineLayer}}),_.o(oe,"Marker")&&_.d(O,{Marker:function(){return oe.Marker}}),_.o(oe,"PointLayer")&&_.d(O,{PointLayer:function(){return oe.PointLayer}}),_.o(oe,"PolygonLayer")&&_.d(O,{PolygonLayer:function(){return oe.PolygonLayer}}),_.o(oe,"Popup")&&_.d(O,{Popup:function(){return oe.Popup}}),_.o(oe,"RasterLayer")&&_.d(O,{RasterLayer:function(){return oe.RasterLayer}}),_.o(oe,"Scene")&&_.d(O,{Scene:function(){return oe.Scene}}),_.o(oe,"gl")&&_.d(O,{gl:function(){return oe.gl}});var Me=_(85040),qe=_.n(Me);_.o(Me,"CityBuildingLayer")&&_.d(O,{CityBuildingLayer:function(){return Me.CityBuildingLayer}}),_.o(Me,"HeatmapLayer")&&_.d(O,{HeatmapLayer:function(){return Me.HeatmapLayer}}),_.o(Me,"ImageLayer")&&_.d(O,{ImageLayer:function(){return Me.ImageLayer}}),_.o(Me,"LineLayer")&&_.d(O,{LineLayer:function(){return Me.LineLayer}}),_.o(Me,"Marker")&&_.d(O,{Marker:function(){return Me.Marker}}),_.o(Me,"PointLayer")&&_.d(O,{PointLayer:function(){return Me.PointLayer}}),_.o(Me,"PolygonLayer")&&_.d(O,{PolygonLayer:function(){return Me.PolygonLayer}}),_.o(Me,"Popup")&&_.d(O,{Popup:function(){return Me.Popup}}),_.o(Me,"RasterLayer")&&_.d(O,{RasterLayer:function(){return Me.RasterLayer}}),_.o(Me,"Scene")&&_.d(O,{Scene:function(){return Me.Scene}}),_.o(Me,"gl")&&_.d(O,{gl:function(){return Me.gl}});var yt=_(8594),Qt=_.n(yt);_.o(yt,"CityBuildingLayer")&&_.d(O,{CityBuildingLayer:function(){return yt.CityBuildingLayer}}),_.o(yt,"HeatmapLayer")&&_.d(O,{HeatmapLayer:function(){return yt.HeatmapLayer}}),_.o(yt,"ImageLayer")&&_.d(O,{ImageLayer:function(){return yt.ImageLayer}}),_.o(yt,"LineLayer")&&_.d(O,{LineLayer:function(){return yt.LineLayer}}),_.o(yt,"Marker")&&_.d(O,{Marker:function(){return yt.Marker}}),_.o(yt,"PointLayer")&&_.d(O,{PointLayer:function(){return yt.PointLayer}}),_.o(yt,"PolygonLayer")&&_.d(O,{PolygonLayer:function(){return yt.PolygonLayer}}),_.o(yt,"Popup")&&_.d(O,{Popup:function(){return yt.Popup}}),_.o(yt,"RasterLayer")&&_.d(O,{RasterLayer:function(){return yt.RasterLayer}}),_.o(yt,"Scene")&&_.d(O,{Scene:function(){return yt.Scene}}),_.o(yt,"gl")&&_.d(O,{gl:function(){return yt.gl}});var Or=_(67571),Dr=_.n(Or);_.o(Or,"CityBuildingLayer")&&_.d(O,{CityBuildingLayer:function(){return Or.CityBuildingLayer}}),_.o(Or,"HeatmapLayer")&&_.d(O,{HeatmapLayer:function(){return Or.HeatmapLayer}}),_.o(Or,"ImageLayer")&&_.d(O,{ImageLayer:function(){return Or.ImageLayer}}),_.o(Or,"LineLayer")&&_.d(O,{LineLayer:function(){return Or.LineLayer}}),_.o(Or,"Marker")&&_.d(O,{Marker:function(){return Or.Marker}}),_.o(Or,"PointLayer")&&_.d(O,{PointLayer:function(){return Or.PointLayer}}),_.o(Or,"PolygonLayer")&&_.d(O,{PolygonLayer:function(){return Or.PolygonLayer}}),_.o(Or,"Popup")&&_.d(O,{Popup:function(){return Or.Popup}}),_.o(Or,"RasterLayer")&&_.d(O,{RasterLayer:function(){return Or.RasterLayer}}),_.o(Or,"Scene")&&_.d(O,{Scene:function(){return Or.Scene}}),_.o(Or,"gl")&&_.d(O,{gl:function(){return Or.gl}});var on=_(66718),tr=_.n(on);_.o(on,"CityBuildingLayer")&&_.d(O,{CityBuildingLayer:function(){return on.CityBuildingLayer}}),_.o(on,"HeatmapLayer")&&_.d(O,{HeatmapLayer:function(){return on.HeatmapLayer}}),_.o(on,"ImageLayer")&&_.d(O,{ImageLayer:function(){return on.ImageLayer}}),_.o(on,"LineLayer")&&_.d(O,{LineLayer:function(){return on.LineLayer}}),_.o(on,"Marker")&&_.d(O,{Marker:function(){return on.Marker}}),_.o(on,"PointLayer")&&_.d(O,{PointLayer:function(){return on.PointLayer}}),_.o(on,"PolygonLayer")&&_.d(O,{PolygonLayer:function(){return on.PolygonLayer}}),_.o(on,"Popup")&&_.d(O,{Popup:function(){return on.Popup}}),_.o(on,"RasterLayer")&&_.d(O,{RasterLayer:function(){return on.RasterLayer}}),_.o(on,"Scene")&&_.d(O,{Scene:function(){return on.Scene}}),_.o(on,"gl")&&_.d(O,{gl:function(){return on.gl}});var se=_(92364),be=_(78010),Fe=_.n(be);_.o(be,"CityBuildingLayer")&&_.d(O,{CityBuildingLayer:function(){return be.CityBuildingLayer}}),_.o(be,"HeatmapLayer")&&_.d(O,{HeatmapLayer:function(){return be.HeatmapLayer}}),_.o(be,"ImageLayer")&&_.d(O,{ImageLayer:function(){return be.ImageLayer}}),_.o(be,"LineLayer")&&_.d(O,{LineLayer:function(){return be.LineLayer}}),_.o(be,"Marker")&&_.d(O,{Marker:function(){return be.Marker}}),_.o(be,"PointLayer")&&_.d(O,{PointLayer:function(){return be.PointLayer}}),_.o(be,"PolygonLayer")&&_.d(O,{PolygonLayer:function(){return be.PolygonLayer}}),_.o(be,"Popup")&&_.d(O,{Popup:function(){return be.Popup}}),_.o(be,"RasterLayer")&&_.d(O,{RasterLayer:function(){return be.RasterLayer}}),_.o(be,"Scene")&&_.d(O,{Scene:function(){return be.Scene}}),_.o(be,"gl")&&_.d(O,{gl:function(){return be.gl}});var Ee=_(68116),wt=_.n(Ee);_.o(Ee,"CityBuildingLayer")&&_.d(O,{CityBuildingLayer:function(){return Ee.CityBuildingLayer}}),_.o(Ee,"HeatmapLayer")&&_.d(O,{HeatmapLayer:function(){return Ee.HeatmapLayer}}),_.o(Ee,"ImageLayer")&&_.d(O,{ImageLayer:function(){return Ee.ImageLayer}}),_.o(Ee,"LineLayer")&&_.d(O,{LineLayer:function(){return Ee.LineLayer}}),_.o(Ee,"Marker")&&_.d(O,{Marker:function(){return Ee.Marker}}),_.o(Ee,"PointLayer")&&_.d(O,{PointLayer:function(){return Ee.PointLayer}}),_.o(Ee,"PolygonLayer")&&_.d(O,{PolygonLayer:function(){return Ee.PolygonLayer}}),_.o(Ee,"Popup")&&_.d(O,{Popup:function(){return Ee.Popup}}),_.o(Ee,"RasterLayer")&&_.d(O,{RasterLayer:function(){return Ee.RasterLayer}}),_.o(Ee,"Scene")&&_.d(O,{Scene:function(){return Ee.Scene}}),_.o(Ee,"gl")&&_.d(O,{gl:function(){return Ee.gl}});var Bt=_(23067),w=_.n(Bt);_.o(Bt,"CityBuildingLayer")&&_.d(O,{CityBuildingLayer:function(){return Bt.CityBuildingLayer}}),_.o(Bt,"HeatmapLayer")&&_.d(O,{HeatmapLayer:function(){return Bt.HeatmapLayer}}),_.o(Bt,"ImageLayer")&&_.d(O,{ImageLayer:function(){return Bt.ImageLayer}}),_.o(Bt,"LineLayer")&&_.d(O,{LineLayer:function(){return Bt.LineLayer}}),_.o(Bt,"Marker")&&_.d(O,{Marker:function(){return Bt.Marker}}),_.o(Bt,"PointLayer")&&_.d(O,{PointLayer:function(){return Bt.PointLayer}}),_.o(Bt,"PolygonLayer")&&_.d(O,{PolygonLayer:function(){return Bt.PolygonLayer}}),_.o(Bt,"Popup")&&_.d(O,{Popup:function(){return Bt.Popup}}),_.o(Bt,"RasterLayer")&&_.d(O,{RasterLayer:function(){return Bt.RasterLayer}}),_.o(Bt,"Scene")&&_.d(O,{Scene:function(){return Bt.Scene}}),_.o(Bt,"gl")&&_.d(O,{gl:function(){return Bt.gl}});var N=_(7648)},85951:function(ar,O,_){"use strict";_.d(O,{e7:function(){return ru},Hp:function(){return lf},ZP:function(){return Hl},yT:function(){return Wc}});var Q=_(28660),E=_(26729),p=_.n(E),b=_(86700),X=_(84879),W=_(72302),$=_(6610),I=_(5991),k=_(96156),Ce=_(6901),Be=_(49296),We=_.n(Be);function $e(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function Vt(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?$e(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):$e(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function Ht(j,z){var M=typeof Symbol!="undefined"&&j[Symbol.iterator]||j["@@iterator"];if(!M){if(Array.isArray(j)||(M=At(j))||z&&j&&typeof j.length=="number"){M&&(j=M);var D=0,ne=function(){};return{s:ne,n:function(){return D>=j.length?{done:!0}:{done:!1,value:j[D++]}},e:function(Sr){throw Sr},f:ne}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var _e=!0,gt=!1,Gt;return{s:function(){M=M.call(j)},n:function(){var Sr=M.next();return _e=Sr.done,Sr},e:function(Sr){gt=!0,Gt=Sr},f:function(){try{!_e&&M.return!=null&&M.return()}finally{if(gt)throw Gt}}}}function At(j,z){if(!!j){if(typeof j=="string")return Ot(j,z);var M=Object.prototype.toString.call(j).slice(8,-1);if(M==="Object"&&j.constructor&&(M=j.constructor.name),M==="Map"||M==="Set")return Array.from(j);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return Ot(j,z)}}function Ot(j,z){(z==null||z>j.length)&&(z=j.length);for(var M=0,D=new Array(z);M<z;M++)D[M]=j[M];return D}var bt=30;function dt(j){var z=j.characterSet,M=j.getFontWidth,D=j.fontHeight,ne=j.buffer,_e=j.maxCanvasWidth,gt=j.mapping,Gt=gt===void 0?{}:gt,zt=j.xOffset,Sr=zt===void 0?0:zt,qr=j.yOffset,Rn=qr===void 0?0:qr,Gn=0,Mn=Sr;Array.from(z).forEach(function(yi,aa){if(!Gt[yi]){var Mi=M(yi,aa);Mn+bt>_e&&(Mn=0,Gn++),Gt[yi]={x:Mn,y:Rn+Gn*bt,width:bt,height:bt,advance:Mi},Mn+=bt}});var di=D+ne*2;return{mapping:Gt,xOffset:Mn,yOffset:Rn+Gn*di,canvasHeight:Ft(Rn+(Gn+1)*di)}}function Pr(j,z,M){var D=0,ne=0,_e=0,gt=[],Gt={},zt=Ht(j),Sr;try{for(zt.s();!(Sr=zt.n()).done;){var qr=Sr.value;if(!Gt[qr.id]){var Rn=qr.size;D+Rn+z>M&&(er(Gt,gt,ne),D=0,ne=_e+ne+z,_e=0,gt=[]),gt.push({icon:qr,xOffset:D}),D=D+Rn+z,_e=Math.max(_e,Rn)}}}catch(Mn){zt.e(Mn)}finally{zt.f()}gt.length>0&&er(Gt,gt,ne);var Gn=Ft(_e+ne+z);return{mapping:Gt,canvasHeight:Gn}}function er(j,z,M){var D=Ht(z),ne;try{for(D.s();!(ne=D.n()).done;){var _e=ne.value,gt=_e.icon,Gt=_e.xOffset;j[gt.id]=Vt(Vt({},gt),{},{x:Gt,y:M,image:gt.image,width:gt.width,height:gt.height})}}catch(zt){D.e(zt)}finally{D.f()}}function Ft(j){return Math.pow(2,Math.ceil(Math.log2(j)))}var tt,Ne;function Qe(j,z){var M=typeof Symbol!="undefined"&&j[Symbol.iterator]||j["@@iterator"];if(!M){if(Array.isArray(j)||(M=Ie(j))||z&&j&&typeof j.length=="number"){M&&(j=M);var D=0,ne=function(){};return{s:ne,n:function(){return D>=j.length?{done:!0}:{done:!1,value:j[D++]}},e:function(Sr){throw Sr},f:ne}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var _e=!0,gt=!1,Gt;return{s:function(){M=M.call(j)},n:function(){var Sr=M.next();return _e=Sr.done,Sr},e:function(Sr){gt=!0,Gt=Sr},f:function(){try{!_e&&M.return!=null&&M.return()}finally{if(gt)throw Gt}}}}function Ie(j,z){if(!!j){if(typeof j=="string")return Ae(j,z);var M=Object.prototype.toString.call(j).slice(8,-1);if(M==="Object"&&j.constructor&&(M=j.constructor.name),M==="Map"||M==="Set")return Array.from(j);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return Ae(j,z)}}function Ae(j,z){(z==null||z>j.length)&&(z=j.length);for(var M=0,D=new Array(z);M<z;M++)D[M]=j[M];return D}function Ue(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function St(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?Ue(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):Ue(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}var ur=tr(),ae="sans-serif",Te="normal",oe=24,me=3,Me=.25,qe=8,yt=1024,Qt=1,Or=1,Dr=3,on=null;function tr(){for(var j=[],z=32;z<128;z++)j.push(String.fromCharCode(z));return j}function se(j,z,M,D){j.font="".concat(D," ").concat(M,"px ").concat(z),j.fillStyle="black",j.textBaseline="middle"}function be(j,z){for(var M=0;M<j.length;M++)z.data[4*M+3]=j[M]}var Fe=(tt=(0,b.b2)(),tt(Ne=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"fontAtlas",void 0),(0,k.Z)(this,"iconFontMap",void 0),(0,k.Z)(this,"iconFontGlyphs",{}),(0,k.Z)(this,"fontOptions",void 0),(0,k.Z)(this,"key",void 0),(0,k.Z)(this,"cache",new Ce.z6(Dr))}return(0,I.Z)(j,[{key:"scale",get:function(){return Or}},{key:"canvas",get:function(){var M=this.cache.get(this.key);return M&&M.data}},{key:"mapping",get:function(){var M=this.cache.get(this.key);return M&&M.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:ae,fontWeight:Te,characterSet:ur,fontSize:oe,buffer:me,sdf:!0,cutoff:Me,radius:qe,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(M){var D=this;M.forEach(function(ne){D.iconFontGlyphs[ne.name]=ne.unicode})}},{key:"addIconFont",value:function(M,D){this.iconFontMap.set(M,D)}},{key:"getIconFontKey",value:function(M){return this.iconFontMap.get(M)||M}},{key:"getGlyph",value:function(M){return this.iconFontGlyphs[M]?String.fromCharCode(parseInt(this.iconFontGlyphs[M],16)):""}},{key:"setFontOptions",value:function(M){this.fontOptions=St(St({},this.fontOptions),M),this.key=this.getKey();var D=this.getNewChars(this.key,this.fontOptions.characterSet),ne=this.cache.get(this.key);if(!(ne&&D.length===0)){var _e=this.generateFontAtlas(this.key,D,ne);this.fontAtlas=_e,this.cache.set(this.key,_e)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(M,D,ne){var _e=this.fontOptions,gt=_e.fontFamily,Gt=_e.fontWeight,zt=_e.fontSize,Sr=_e.buffer,qr=_e.sdf,Rn=_e.radius,Gn=_e.cutoff,Mn=_e.iconfont,di=ne&&ne.data;di||(di=document.createElement("canvas"),di.width=yt);var yi=di.getContext("2d");se(yi,gt,zt,Gt);var aa=dt(St({getFontWidth:function(cf){return yi.measureText(cf).width},fontHeight:zt*Or,buffer:Sr,characterSet:D,maxCanvasWidth:yt},ne&&{mapping:ne.mapping,xOffset:ne.xOffset,yOffset:ne.yOffset})),Mi=aa.mapping,Ha=aa.canvasHeight,Mo=aa.xOffset,bo=aa.yOffset,So=yi.getImageData(0,0,di.width,di.height);if(di.height=Ha,yi.putImageData(So,0,0),se(yi,gt,zt,Gt),qr){var Qa=new(We())(zt,Sr,Rn,Gn,gt,Gt),ca=yi.getImageData(0,0,Qa.size,Qa.size),Wa=Qe(D),Eo;try{for(Wa.s();!(Eo=Wa.n()).done;){var oo=Eo.value;if(Mn){var wo=String.fromCharCode(parseInt(oo.replace("&#x","").replace(";",""),16)),Ds=Qa.draw(wo);be(Ds,ca)}else be(Qa.draw(oo),ca);yi.putImageData(ca,Mi[oo].x,Mi[oo].y)}}catch(Xc){Wa.e(Xc)}finally{Wa.f()}}else{var mu=Qe(D),Zu;try{for(mu.s();!(Zu=mu.n()).done;){var Ss=Zu.value;yi.fillText(Ss,Mi[Ss].x,Mi[Ss].y+zt*Qt)}}catch(Xc){mu.e(Xc)}finally{mu.f()}}return{xOffset:Mo,yOffset:bo,mapping:Mi,data:di,width:di.width,height:di.height}}},{key:"getKey",value:function(){return"key";var M,D,ne,_e,gt,Gt,zt,Sr}},{key:"getNewChars",value:function(M,D){var ne=this.cache.get(M);if(!ne)return D;var _e=[],gt=ne.mapping,Gt=new Set(Object.keys(gt)),zt=new Set(D);return zt.forEach(function(Sr){Gt.has(Sr)||_e.push(Sr)}),_e}}]),j}())||Ne),Ee=_(63349),wt=_(10379),Bt=_(46070),w=_(77608),N,he;function je(j){var z=et();return function(){var D=(0,w.Z)(j),ne;if(z){var _e=(0,w.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Bt.Z)(this,ne)}}function et(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var _t=3,Ct=1024,V=64,Yt=(N=(0,b.b2)(),N(he=function(j){(0,wt.Z)(M,j);var z=je(M);function M(){var D;(0,$.Z)(this,M);for(var ne=arguments.length,_e=new Array(ne),gt=0;gt<ne;gt++)_e[gt]=arguments[gt];return D=z.call.apply(z,[this].concat(_e)),(0,k.Z)((0,Ee.Z)(D),"canvasHeight",128),(0,k.Z)((0,Ee.Z)(D),"texture",void 0),(0,k.Z)((0,Ee.Z)(D),"canvas",void 0),(0,k.Z)((0,Ee.Z)(D),"iconData",void 0),(0,k.Z)((0,Ee.Z)(D),"iconMap",void 0),(0,k.Z)((0,Ee.Z)(D),"ctx",void 0),(0,k.Z)((0,Ee.Z)(D),"loadingImageCount",0),D}return(0,I.Z)(M,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(ne,_e){var gt=this,Gt=new Image;if(this.loadingImageCount++,this.hasImage(ne))throw new Error("Image Id already exists");this.iconData.push({id:ne,size:V}),this.updateIconMap(),this.loadImage(_e).then(function(zt){Gt=zt;var Sr=gt.iconData.find(function(qr){return qr.id===ne});Sr&&(Sr.image=Gt,Sr.width=Gt.width,Sr.height=Gt.height),gt.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(ne){return this.iconMap.hasOwnProperty(ne)}},{key:"removeImage",value:function(ne){this.hasImage(ne)&&(this.iconData=this.iconData.filter(function(_e){return _e.id!==ne}),delete this.iconMap[ne],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var ne=this;this.canvas.width=Ct,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(_e){var gt=ne.iconMap[_e],Gt=gt.x,zt=gt.y,Sr=gt.image,qr=gt.width,Rn=qr===void 0?64:qr,Gn=gt.height,Mn=Gn===void 0?64:Gn,di=Math.max(Rn,Mn),yi=di/V,aa=Mn/yi,Mi=Rn/yi;Sr&&ne.ctx.drawImage(Sr,Gt+(V-Mi)/2,zt+(V-aa)/2,Mi,aa)})}},{key:"updateIconMap",value:function(){var ne=Pr(this.iconData,_t,Ct),_e=ne.mapping,gt=ne.canvasHeight;this.iconMap=_e,this.canvasHeight=gt}},{key:"loadImage",value:function(ne){return new Promise(function(_e,gt){if(ne instanceof HTMLImageElement){_e(ne);return}var Gt=new Image;Gt.crossOrigin="anonymous",Gt.onload=function(){_e(Gt)},Gt.onerror=function(){gt(new Error("Could not load image at "+ne))},Gt.src=ne instanceof File?URL.createObjectURL(ne):ne})}}]),M}(E.EventEmitter))||he),kt=_(28481),fr=_(85975),Cr,Tr,Ar=(Cr=(0,b.b2)(),Cr(Tr=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"viewport",void 0),(0,k.Z)(this,"overridedViewProjectionMatrix",void 0),(0,k.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,k.Z)(this,"jitteredProjectionMatrix",void 0),(0,k.Z)(this,"viewMatrixInverse",void 0),(0,k.Z)(this,"cameraPosition",void 0)}return(0,I.Z)(j,[{key:"init",value:function(){}},{key:"update",value:function(M){this.viewport=M,this.viewMatrixInverse=fr.create(),fr.invert(this.viewMatrixInverse,M.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var M=this.viewport.getCenter(),D=(0,kt.Z)(M,2),ne=D[0],_e=D[1];return[ne,_e]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(M,D){return this.viewport.projectFlat(M,D)}},{key:"setViewProjectionMatrix",value:function(M){this.overridedViewProjectionMatrix=M}},{key:"jitterProjectionMatrix",value:function(M,D){var ne=fr.fromTranslation(fr.create(),[M,D,0]);this.jitteredProjectionMatrix=fr.multiply(fr.create(),ne,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=fr.multiply(fr.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),j}())||Tr),Je,xt;function ht(j,z){var M=typeof Symbol!="undefined"&&j[Symbol.iterator]||j["@@iterator"];if(!M){if(Array.isArray(j)||(M=lr(j))||z&&j&&typeof j.length=="number"){M&&(j=M);var D=0,ne=function(){};return{s:ne,n:function(){return D>=j.length?{done:!0}:{done:!1,value:j[D++]}},e:function(Sr){throw Sr},f:ne}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var _e=!0,gt=!1,Gt;return{s:function(){M=M.call(j)},n:function(){var Sr=M.next();return _e=Sr.done,Sr},e:function(Sr){gt=!0,Gt=Sr},f:function(){try{!_e&&M.return!=null&&M.return()}finally{if(gt)throw Gt}}}}function lr(j,z){if(!!j){if(typeof j=="string")return Kr(j,z);var M=Object.prototype.toString.call(j).slice(8,-1);if(M==="Object"&&j.constructor&&(M=j.constructor.name),M==="Map"||M==="Set")return Array.from(j);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return Kr(j,z)}}function Kr(j,z){(z==null||z>j.length)&&(z=j.length);for(var M=0,D=new Array(z);M<z;M++)D[M]=j[M];return D}var lt=(Je=(0,b.b2)(),Je(xt=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"container",void 0),(0,k.Z)(this,"controlCorners",void 0),(0,k.Z)(this,"controlContainer",void 0),(0,k.Z)(this,"scene",void 0),(0,k.Z)(this,"mapsService",void 0),(0,k.Z)(this,"controls",[]),(0,k.Z)(this,"unAddControls",[])}return(0,I.Z)(j,[{key:"init",value:function(M,D){this.container=M.container,this.scene=D,this.mapsService=D.get(W.v.IMapService),this.initControlPos()}},{key:"addControl",value:function(M,D){var ne=D.get(W.v.IMapService);ne.map?(M.addTo(this.scene),this.controls.push(M)):this.unAddControls.push(M)}},{key:"getControlByName",value:function(M){return this.controls.find(function(D){return D.controlOption.name===M})}},{key:"removeControl",value:function(M){var D=this.controls.indexOf(M);return D>-1&&this.controls.splice(D,1),M.remove(),this}},{key:"addControls",value:function(){var M=this;this.unAddControls.forEach(function(D){D.addTo(M.scene),M.controls.push(D)}),this.unAddControls=[]}},{key:"destroy",value:function(){var M=ht(this.controls),D;try{for(M.s();!(D=M.n()).done;){var ne=D.value;ne.remove()}}catch(_e){M.e(_e)}finally{M.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var M=this.controlCorners={},D="l7-",ne=this.controlContainer=Ce.SO.create("div",D+"control-container",this.container);function _e(gt,Gt){var zt=D+gt+" "+D+Gt;M[gt+Gt]=Ce.SO.create("div",zt,ne)}_e("top","left"),_e("top","right"),_e("bottom","left"),_e("bottom","right")}},{key:"clearControlPos",value:function(){for(var M in this.controlCorners)this.controlCorners[M]&&Ce.SO.remove(this.controlCorners[M]);this.controlContainer&&Ce.SO.remove(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),j}())||xt),Lt,Jt,or=(Lt=(0,b.b2)(),Lt(Jt=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"container",void 0),(0,k.Z)(this,"scene",void 0),(0,k.Z)(this,"mapsService",void 0),(0,k.Z)(this,"markers",[]),(0,k.Z)(this,"markerLayers",[]),(0,k.Z)(this,"unAddMarkers",[]),(0,k.Z)(this,"unAddMarkerLayers",[])}return(0,I.Z)(j,[{key:"addMarkerLayer",value:function(M){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(M),M.addTo(this.scene)):this.unAddMarkerLayers.push(M)}},{key:"removeMarkerLayer",value:function(M){M.destroy(),this.markerLayers.indexOf(M);var D=this.markerLayers.indexOf(M);D>-1&&this.markerLayers.splice(D,1)}},{key:"addMarker",value:function(M){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(M),M.addTo(this.scene)):this.unAddMarkers.push(M)}},{key:"addMarkers",value:function(){var M=this;this.unAddMarkers.forEach(function(D){D.addTo(M.scene),M.markers.push(D)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var M=this;this.unAddMarkerLayers.forEach(function(D){M.markerLayers.push(D),D.addTo(M.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(M){M.remove(),this.markers.indexOf(M);var D=this.markers.indexOf(M);D>-1&&this.markers.splice(D,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(M){this.scene=M,this.mapsService=M.get(W.v.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(M){M.remove()}),this.markers=[],this.markerLayers.forEach(function(M){M.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(M){M.destroy()}}]),j}())||Jt),cn,Pn,bi=(cn=(0,b.b2)(),cn(Pn=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"scene",void 0),(0,k.Z)(this,"popup",void 0),(0,k.Z)(this,"mapsService",void 0),(0,k.Z)(this,"unAddPopup",void 0)}return(0,I.Z)(j,[{key:"removePopup",value:function(M){M.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(M){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(M.addTo(this.scene),this.popup=M):this.unAddPopup=M}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(M){this.scene=M,this.mapsService=M.get(W.v.IMapService)}}]),j}())||Pn),Si=_(82492),Ri=_.n(Si),ia={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},pi=ia,H,ie;function ce(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function B(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?ce(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):ce(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}var re={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},fe={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",selectColor:"blue",enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Se=(H=(0,b.b2)(),H(ie=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"sceneConfigCache",{}),(0,k.Z)(this,"layerConfigCache",{})}return(0,I.Z)(j,[{key:"getSceneConfig",value:function(M){return this.sceneConfigCache[M]}},{key:"getSceneWarninfo",value:function(M){return pi[M]}},{key:"setSceneConfig",value:function(M,D){this.sceneConfigCache[M]=B(B({},re),D)}},{key:"getLayerConfig",value:function(M){return this.layerConfigCache[M]}},{key:"setLayerConfig",value:function(M,D,ne){this.layerConfigCache[D]=B({},Ri()({},this.sceneConfigCache[M],fe,ne))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),j}())||ie),te=_(55770),ge=_(3473),pt=_(98333),yr=Math.PI/180,Lr=512,Nt=4003e4;function Fr(j){var z=j.latitude,M=z===void 0?0:z,D=j.zoom,ne=D===void 0?0:D,_e=j.scale,gt=j.highPrecision,Gt=gt===void 0?!1:gt,zt=j.flipY,Sr=zt===void 0?!1:zt;_e=_e!==void 0?_e:Math.pow(2,ne);var qr={},Rn=Lr*_e,Gn=Math.cos(M*yr),Mn=Rn/360,di=Mn/Gn,yi=Rn/Nt/Gn;if(qr.pixelsPerMeter=[yi,-yi,yi],qr.metersPerPixel=[1/yi,-1/yi,1/yi],qr.pixelsPerDegree=[Mn,-di,yi],qr.degreesPerPixel=[1/Mn,-1/di,1/yi],Gt){var aa=yr*Math.tan(M*yr)/Gn,Mi=Mn*aa/2,Ha=Rn/Nt*aa,Mo=Ha/di*yi;qr.pixelsPerDegree2=[0,-Mi,Ha],qr.pixelsPerMeter2=[Mo,0,Mo],Sr&&(qr.pixelsPerDegree2[1]=-qr.pixelsPerDegree2[1],qr.pixelsPerMeter2[1]=-qr.pixelsPerMeter2[1])}return Sr&&(qr.pixelsPerMeter[1]=-qr.pixelsPerMeter[1],qr.metersPerPixel[1]=-qr.metersPerPixel[1],qr.pixelsPerDegree[1]=-qr.pixelsPerDegree[1],qr.degreesPerPixel[1]=-qr.degreesPerPixel[1]),qr}var bn=_(47282),gn,gr,vn,Wr,ln,Ei=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],pn=(gn=(0,b.b2)(),gr=(0,b.f3)(W.v.ICameraService),gn(vn=(Wr=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"needRefresh",!0),(0,te.Z)(this,"cameraService",ln,this),(0,k.Z)(this,"coordinateSystem",void 0),(0,k.Z)(this,"viewportCenter",void 0),(0,k.Z)(this,"viewportCenterProjection",void 0),(0,k.Z)(this,"pixelsPerDegree",void 0),(0,k.Z)(this,"pixelsPerDegree2",void 0),(0,k.Z)(this,"pixelsPerMeter",void 0)}return(0,I.Z)(j,[{key:"refresh",value:function(){var M=this.cameraService.getZoom(),D=this.cameraService.getZoomScale(),ne=this.cameraService.getCenter(),_e=Fr({latitude:ne[1],zoom:M}),gt=_e.pixelsPerMeter,Gt=_e.pixelsPerDegree;this.viewportCenter=ne,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=gt,this.pixelsPerDegree=Gt,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===bn.l.LNGLAT||this.coordinateSystem===bn.l.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===bn.l.LNGLAT_OFFSET?this.calculateLnglatOffset(ne,M):this.coordinateSystem===bn.l.P20_OFFSET&&this.calculateLnglatOffset(ne,M,D,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(M){this.coordinateSystem=M}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(M,D,ne,_e){var gt=Fr({latitude:M[1],zoom:D,scale:ne,flipY:_e,highPrecision:!0}),Gt=gt.pixelsPerMeter,zt=gt.pixelsPerDegree,Sr=gt.pixelsPerDegree2,qr=this.cameraService.getViewMatrix(),Rn=this.cameraService.getProjectionMatrix(),Gn=fr.multiply([],Rn,qr),Mn=this.cameraService.projectFlat([Math.fround(M[0]),Math.fround(M[1])],Math.pow(2,D));this.viewportCenterProjection=pt.fF([],[Mn[0],Mn[1],0,1],Gn),qr=this.cameraService.getViewMatrixUncentered()||qr,Gn=fr.multiply([],Rn,qr),Gn=fr.multiply([],Gn,Ei),this.cameraService.setViewProjectionMatrix(Gn),this.pixelsPerMeter=Gt,this.pixelsPerDegree=zt,this.pixelsPerDegree2=Sr}}]),j}(),ln=(0,ge.Z)(Wr.prototype,"cameraService",[gr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wr))||vn),wi=_(50840),Yi=_.n(wi),Yn=_(89648),Di,ki,za,Wn,ai,Ai,Qn;function Fi(j){var z=ya();return function(){var D=(0,w.Z)(j),ne;if(z){var _e=(0,w.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Bt.Z)(this,ne)}}function ya(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var Xa={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},_a=(Di=(0,b.b2)(),ki=(0,b.f3)(W.v.IMapService),za=(0,b.f3)(W.v.ILogService),Di(Wn=(ai=function(j){(0,wt.Z)(M,j);var z=Fi(M);function M(){var D;(0,$.Z)(this,M);for(var ne=arguments.length,_e=new Array(ne),gt=0;gt<ne;gt++)_e[gt]=arguments[gt];return D=z.call.apply(z,[this].concat(_e)),(0,te.Z)((0,Ee.Z)(D),"mapService",Ai,(0,Ee.Z)(D)),(0,te.Z)((0,Ee.Z)(D),"logger",Qn,(0,Ee.Z)(D)),(0,k.Z)((0,Ee.Z)(D),"hammertime",void 0),(0,k.Z)((0,Ee.Z)(D),"lastClickTime",0),(0,k.Z)((0,Ee.Z)(D),"lastClickXY",[-1,-1]),(0,k.Z)((0,Ee.Z)(D),"clickTimer",void 0),(0,k.Z)((0,Ee.Z)(D),"$containter",void 0),(0,k.Z)((0,Ee.Z)(D),"onDrag",function(Gt){var zt=D.interactionEvent(Gt);zt.type=Xa[zt.type],D.emit(Yn.s.Drag,zt)}),(0,k.Z)((0,Ee.Z)(D),"onHammer",function(Gt){Gt.srcEvent.stopPropagation();var zt=D.interactionEvent(Gt);D.emit(Yn.s.Hover,zt)}),(0,k.Z)((0,Ee.Z)(D),"onTouch",function(Gt){var zt=Gt.touches[0];D.onHover({x:zt.pageX,y:zt.pageY,type:"touch"})}),(0,k.Z)((0,Ee.Z)(D),"onHover",function(Gt){var zt=Gt.clientX,Sr=Gt.clientY,qr=zt,Rn=Sr,Gn=Gt.type,Mn=D.mapService.getMapContainer();if(Mn){var di=Mn.getBoundingClientRect(),yi=di.top,aa=di.left;qr=qr-aa-Mn.clientLeft,Rn=Rn-yi-Mn.clientTop}var Mi=D.mapService.containerToLngLat([qr,Rn]);if(Gn==="click"){if("ontouchstart"in document.documentElement)return;D.isDoubleTap(qr,Rn,Mi);return}if(Gn==="touch"){D.isDoubleTap(qr,Rn,Mi);return}Gn!=="click"&&Gn!=="dblclick"&&D.emit(Yn.s.Hover,{x:qr,y:Rn,lngLat:Mi,type:Gn,target:Gt})}),D}return(0,I.Z)(M,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Yn.s.Hover)}},{key:"triggerHover",value:function(ne){var _e=ne.x,gt=ne.y;this.emit(Yn.s.Hover,{x:_e,y:gt})}},{key:"triggerSelect",value:function(ne){this.emit(Yn.s.Select,{featureId:ne})}},{key:"triggerActive",value:function(ne){this.emit(Yn.s.Active,{featureId:ne})}},{key:"addEventListenerOnMap",value:function(){var ne=this.mapService.getMapContainer();if(ne){var _e=new(Yi()).Manager(ne);_e.add(new(Yi()).Tap({event:"dblclick",taps:2})),_e.add(new(Yi()).Tap({event:"click"})),_e.add(new(Yi()).Pan({threshold:0,pointers:0})),_e.add(new(Yi()).Press({})),_e.on("dblclick click",this.onHammer),_e.on("panstart panmove panend pancancel",this.onDrag),ne.addEventListener("mousemove",this.onHover),ne.addEventListener("mousedown",this.onHover,!0),ne.addEventListener("mouseup",this.onHover),ne.addEventListener("contextmenu",this.onHover),this.hammertime=_e,this.logger.debug("add event listeners on canvas")}}},{key:"removeEventListenerOnMap",value:function(){var ne=this.mapService.getMapContainer();ne&&(ne.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),ne.removeEventListener("mousedown",this.onHover),ne.removeEventListener("mouseup",this.onHover),ne.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(ne){var _e=ne.type,gt=ne.pointerType,Gt,zt;gt==="touch"?(zt=Math.floor(ne.pointers[0].clientY),Gt=Math.floor(ne.pointers[0].clientX)):(zt=Math.floor(ne.srcEvent.y),Gt=Math.floor(ne.srcEvent.x));var Sr=this.mapService.getMapContainer();if(Sr){var qr=Sr.getBoundingClientRect(),Rn=qr.top,Gn=qr.left;Gt-=Gn,zt-=Rn}var Mn=this.mapService.containerToLngLat([Gt,zt]);return{x:Gt,y:zt,lngLat:Mn,type:_e,target:ne.srcEvent}}},{key:"isDoubleTap",value:function(ne,_e,gt){var Gt=this,zt=new Date().getTime(),Sr="click";zt-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-ne)<10&&Math.abs(this.lastClickXY[1]-_e)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),Sr="dblclick",this.emit(Yn.s.Hover,{x:ne,y:_e,lngLat:gt,type:Sr})):(this.lastClickTime=zt,this.lastClickXY=[ne,_e],this.clickTimer=setTimeout(function(){Sr="click",Gt.emit(Yn.s.Hover,{x:ne,y:_e,lngLat:gt,type:Sr})},400))}}]),M}(p()),Ai=(0,ge.Z)(ai.prototype,"mapService",[ki],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qn=(0,ge.Z)(ai.prototype,"logger",[za],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ai))||Wn),da=_(92137),Vu=_(87757),Ya=_.n(Vu),gi=_(7648),qa,Ka,$a,Yo,Gi,Oo,Oa,Za,cs,va,fs;function Ca(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function fo(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?Ca(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):Ca(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}var Zi=(qa=(0,b.b2)(),Ka=(0,b.f3)(W.v.IRendererService),$a=(0,b.f3)(W.v.IGlobalConfigService),Yo=(0,b.f3)(W.v.IInteractionService),Gi=(0,b.f3)(W.v.ILayerService),qa(Oo=(Oa=function(){function j(){var z=this;(0,$.Z)(this,j),(0,te.Z)(this,"rendererService",Za,this),(0,te.Z)(this,"configService",cs,this),(0,te.Z)(this,"interactionService",va,this),(0,te.Z)(this,"layerService",fs,this),(0,k.Z)(this,"pickingFBO",void 0),(0,k.Z)(this,"width",0),(0,k.Z)(this,"height",0),(0,k.Z)(this,"alreadyInPicking",!1),(0,k.Z)(this,"pickBufferScale",1),(0,k.Z)(this,"pickFromPickingFBO",function(M,D){var ne,_e=D.x,gt=D.y,Gt=D.lngLat,zt=D.type,Sr=D.target,qr=!1,Rn=z.rendererService,Gn=Rn.getViewportSize,Mn=Rn.readPixels,di=Rn.getContainer,yi=di().getBoundingClientRect(),aa=yi.width,Mi=yi.height;aa*=Ce.SO.DPR,Mi*=Ce.SO.DPR;var Ha=M.getLayerConfig(),Mo=Ha.enableHighlight,bo=Ha.enableSelect,So=_e*Ce.SO.DPR,Qa=gt*Ce.SO.DPR;if(So>aa-1*Ce.SO.DPR||So<0||Qa>Mi-1*Ce.SO.DPR||Qa<0)return!1;var ca;if(ca=Mn({x:Math.floor(So/z.pickBufferScale),y:Math.floor((Mi-(gt+1)*Ce.SO.DPR)/z.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:z.pickingFBO}),ca[0]!==0||ca[1]!==0||ca[2]!==0){var Wa=(0,Ce.W0)(ca),Eo=M.getSource().getFeatureById(Wa);Wa!==M.getCurrentPickId()&&zt==="mousemove"&&(zt="mouseenter");var oo={x:_e,y:gt,type:zt,lngLat:Gt,featureId:Wa,feature:Eo,target:Sr};Eo&&(qr=!0,M.setCurrentPickId(Wa),z.triggerHoverOnLayer(M,oo))}else{var wo={x:_e,y:gt,lngLat:Gt,type:M.getCurrentPickId()!==null&&zt==="mousemove"?"mouseout":"un"+zt,featureId:null,target:Sr,feature:null};z.triggerHoverOnLayer(M,fo(fo({},wo),{},{type:"unpick"})),z.triggerHoverOnLayer(M,wo),M.setCurrentPickId(null)}if(Mo&&z.highlightPickedFeature(M,ca),bo&&zt==="click"&&((ne=ca)===null||ne===void 0?void 0:ne.toString())!==[0,0,0,0].toString()){var Ds=(0,Ce.W0)(ca);M.getCurrentSelectedId()===null||Ds!==M.getCurrentSelectedId()?(z.selectFeature(M,ca),M.setCurrentSelectedId(Ds)):(z.selectFeature(M,new Uint8Array([0,0,0,0])),M.setCurrentSelectedId(null))}return qr})}return(0,I.Z)(j,[{key:"init",value:function(M){var D=this.rendererService,ne=D.createTexture2D,_e=D.createFramebuffer,gt=D.getViewportSize,Gt=D.getContainer,zt=Gt().getBoundingClientRect(),Sr=zt.width,qr=zt.height;Sr*=Ce.SO.DPR,qr*=Ce.SO.DPR,this.pickBufferScale=this.configService.getSceneConfig(M).pickBufferScale||1,this.pickingFBO=_e({color:ne({width:Math.round(Sr/this.pickBufferScale),height:Math.round(qr/this.pickBufferScale),wrapS:gi.gl.CLAMP_TO_EDGE,wrapT:gi.gl.CLAMP_TO_EDGE})}),this.interactionService.on(Yn.s.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var z=(0,da.Z)(Ya().mark(function D(ne,_e,gt){var Gt=this,zt,Sr,qr,Rn;return Ya().wrap(function(Mn){for(;;)switch(Mn.prev=Mn.next){case 0:zt=this.rendererService,Sr=zt.useFramebuffer,qr=zt.clear,Rn=zt.getContainer,this.resizePickingFBO(),Sr(this.pickingFBO,function(){qr({framebuffer:Gt.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),ne.hooks.beforePickingEncode.call(),ne.renderModels(),ne.hooks.afterPickingEncode.call();var di=Gt.pickBox(ne,_e);gt(di)});case 3:case"end":return Mn.stop()}},D,this)}));function M(D,ne,_e){return z.apply(this,arguments)}return M}()},{key:"pickBox",value:function(M,D){var ne=this,_e=D.map(function(wo){var Ds=wo<0?0:wo;return Math.floor(Ds*Ce.SO.DPR/ne.pickBufferScale)}),gt=(0,kt.Z)(_e,4),Gt=gt[0],zt=gt[1],Sr=gt[2],qr=gt[3],Rn=this.rendererService,Gn=Rn.getViewportSize,Mn=Rn.readPixels,di=Rn.getContainer,yi=di().getBoundingClientRect(),aa=yi.width,Mi=yi.height;if(aa*=Ce.SO.DPR,Mi*=Ce.SO.DPR,Gt>(aa-1)*Ce.SO.DPR/this.pickBufferScale||Sr<0||zt>(Mi-1)*Ce.SO.DPR/this.pickBufferScale||qr<0)return[];var Ha,Mo=Math.min(aa/this.pickBufferScale,Sr)-Gt,bo=Math.min(Mi/this.pickBufferScale,qr)-zt;Ha=Mn({x:Gt,y:Math.floor(Mi/this.pickBufferScale-(qr+1)),width:Mo,height:bo,data:new Uint8Array(Mo*bo*4),framebuffer:this.pickingFBO});for(var So=[],Qa={},ca=0;ca<Ha.length/4;ca=ca+1){var Wa=Ha.slice(ca*4,ca*4+4),Eo=(0,Ce.W0)(Wa);if(Eo!==-1&&!Qa[Eo]){var oo=M.getSource().getFeatureById(Eo);So.push(oo),Qa[Eo]=!0}}return So}},{key:"pickingAllLayer",value:function(){var z=(0,da.Z)(Ya().mark(function D(ne){return Ya().wrap(function(gt){for(;;)switch(gt.prev=gt.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering)){gt.next=2;break}return gt.abrupt("return");case 2:return this.alreadyInPicking=!0,gt.next=5,this.pickingLayers(ne);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return gt.stop()}},D,this)}));function M(D){return z.apply(this,arguments)}return M}()},{key:"resizePickingFBO",value:function(){var M=this.rendererService.getContainer,D=M().getBoundingClientRect(),ne=D.width,_e=D.height;ne*=Ce.SO.DPR,_e*=Ce.SO.DPR,(this.width!==ne||this.height!==_e)&&(this.pickingFBO.resize({width:Math.round(ne/this.pickBufferScale),height:Math.round(_e/this.pickBufferScale)}),this.width=ne,this.height=_e)}},{key:"pickingLayers",value:function(){var z=(0,da.Z)(Ya().mark(function D(ne){var _e=this,gt,Gt,zt,Sr,qr;return Ya().wrap(function(Gn){for(;;)switch(Gn.prev=Gn.next){case 0:gt=this.rendererService,Gt=gt.getViewportSize,zt=gt.useFramebuffer,Sr=gt.clear,qr=gt.getContainer,this.resizePickingFBO(),zt(this.pickingFBO,function(){var Mn=_e.layerService.getLayers();Mn.filter(function(di){return di.needPick(ne.type)}).reverse().some(function(di){Sr({framebuffer:_e.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),di.hooks.beforePickingEncode.call(),di.renderModels(),di.hooks.afterPickingEncode.call();var yi=_e.pickFromPickingFBO(di,ne);return yi&&!di.getLayerConfig().enablePropagation})});case 3:case"end":return Gn.stop()}},D,this)}));function M(D){return z.apply(this,arguments)}return M}()},{key:"triggerHoverOnLayer",value:function(M,D){M.emit(D.type,D)}},{key:"isEventCrash",value:function(M){var D=!0;return M.target.path.map(function(ne){ne.classList&&ne.classList.forEach(function(_e){(_e==="l7-marker"||_e==="l7-popup")&&(D=!1)})}),D}},{key:"highlightPickedFeature",value:function(M,D){var ne=(0,kt.Z)(D,3),_e=ne[0],gt=ne[1],Gt=ne[2];M.hooks.beforeHighlight.call([_e,gt,Gt])}},{key:"selectFeature",value:function(M,D){var ne=(0,kt.Z)(D,3),_e=ne[0],gt=ne[1],Gt=ne[2];M.hooks.beforeSelect.call([_e,gt,Gt])}}]),j}(),Za=(0,ge.Z)(Oa.prototype,"rendererService",[Ka],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cs=(0,ge.Z)(Oa.prototype,"configService",[$a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),va=(0,ge.Z)(Oa.prototype,"interactionService",[Yo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fs=(0,ge.Z)(Oa.prototype,"layerService",[Gi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oa))||Oo),pe=function(){function j(){var z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,$.Z)(this,j),(0,k.Z)(this,"autoStart",void 0),(0,k.Z)(this,"startTime",0),(0,k.Z)(this,"oldTime",0),(0,k.Z)(this,"running",!1),(0,k.Z)(this,"elapsedTime",0),this.autoStart=z}return(0,I.Z)(j,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var M=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var D=(typeof performance=="undefined"?Date:performance).now();M=(D-this.oldTime)/1e3,this.oldTime=D,this.elapsedTime+=M}return M}}]),j}(),Le,vt,hr,Qr,Dn,Ki,Ua,La=(Le=(0,b.b2)(),vt=(0,b.f3)(W.v.IRendererService),hr=(0,b.f3)(W.v.IGlobalConfigService),Le(Qr=(Dn=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"clock",new pe),(0,k.Z)(this,"alreadyInRendering",!1),(0,k.Z)(this,"layers",[]),(0,k.Z)(this,"layerRenderID",void 0),(0,k.Z)(this,"sceneInited",!1),(0,k.Z)(this,"animateInstanceCount",0),(0,te.Z)(this,"renderService",Ki,this),(0,te.Z)(this,"configService",Ua,this)}return(0,I.Z)(j,[{key:"add",value:function(M){this.sceneInited&&M.init(),this.layers.push(M)}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(M){M.inited||M.init()})}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(M){return this.layers.find(function(D){return D.id===M})}},{key:"getLayerByName",value:function(M){return this.layers.find(function(D){return D.name===M})}},{key:"remove",value:function(M){var D=this.layers.indexOf(M);D>-1&&this.layers.splice(D,1),M.emit("remove",null),M.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"renderLayers",value:function(){this.alreadyInRendering||(this.alreadyInRendering=!0,this.clear(),this.updateRenderOrder(),this.layers.filter(function(M){return M.inited}).filter(function(M){return M.isVisible()}).forEach(function(M){M.hooks.beforeRenderData.call(),M.hooks.beforeRender.call(),M.render(),M.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateRenderOrder",value:function(){this.layers.sort(function(M,D){return M.zIndex-D.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(M){return M.destroy()}),this.layers=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"clear",value:function(){this.renderService.clear({color:[0,0,0,0],depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){cancelAnimationFrame(this.layerRenderID)}}]),j}(),Ki=(0,ge.Z)(Dn.prototype,"renderService",[vt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ua=(0,ge.Z)(Dn.prototype,"configService",[hr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dn))||Qr),ja=_(81253),To=_(85061),Mu=_(14293),$l=_.n(Mu),Il=function(){function j(z){var M=this;(0,$.Z)(this,j),(0,k.Z)(this,"name",void 0),(0,k.Z)(this,"type",void 0),(0,k.Z)(this,"scale",void 0),(0,k.Z)(this,"descriptor",void 0),(0,k.Z)(this,"featureBufferLayout",[]),(0,k.Z)(this,"needRescale",!1),(0,k.Z)(this,"needRemapping",!1),(0,k.Z)(this,"needRegenerateVertices",!1),(0,k.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,k.Z)(this,"vertexAttribute",void 0),(0,k.Z)(this,"defaultCallback",function(D){if(D.length===0){var ne;return((ne=M.scale)===null||ne===void 0?void 0:ne.defaultValues)||[]}return D.map(function(_e,gt){var Gt,zt=(Gt=M.scale)===null||Gt===void 0?void 0:Gt.scalers[gt].func,Sr=zt(_e);return Sr})}),this.setProps(z)}return(0,I.Z)(j,[{key:"setProps",value:function(M){Object.assign(this,M)}},{key:"mapping",value:function(M){var D;if((D=this.scale)!==null&&D!==void 0&&D.callback){var ne,_e=(ne=this.scale)===null||ne===void 0?void 0:ne.callback.apply(ne,(0,To.Z)(M));if(!$l()(_e))return[_e]}return this.defaultCallback(M)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),j}(),Lo,Xs,ua,Ns,ou,bs;function Ps(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function ti(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?Ps(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):Ps(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function ho(j){return new Promise(function(z){return setTimeout(z,j)})}var su=(Lo={},(0,k.Z)(Lo,gi.gl.FLOAT,4),(0,k.Z)(Lo,gi.gl.UNSIGNED_BYTE,1),(0,k.Z)(Lo,gi.gl.UNSIGNED_SHORT,2),Lo),Ol=(Xs=(0,b.b2)(),ua=(0,b.f3)(W.v.IRendererService),Xs(Ns=(ou=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"attributesAndIndices",void 0),(0,te.Z)(this,"rendererService",bs,this),(0,k.Z)(this,"attributes",[]),(0,k.Z)(this,"triangulation",void 0),(0,k.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,I.Z)(j,[{key:"registerStyleAttribute",value:function(M){var D=this.getLayerStyleAttribute(M.name||"");return D?D.setProps(M):(D=new Il(M),this.attributes.push(D)),D}},{key:"updateStyleAttribute",value:function(M,D,ne){var _e=this.getLayerStyleAttribute(M);_e||(_e=this.registerStyleAttribute(ti(ti({},D),{},{name:M})));var gt=D.scale;gt&&_e&&(_e.scale=gt,_e.needRescale=!0,_e.needRemapping=!0,_e.needRegenerateVertices=!0,ne&&ne.featureRange&&(_e.featureRange=ne.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(M){return this.attributes.find(function(D){return D.name===M})}},{key:"getLayerAttributeScale",value:function(M){var D,ne=this.getLayerStyleAttribute(M),_e=ne==null||(D=ne.scale)===null||D===void 0?void 0:D.scalers;return _e&&_e[0]?_e[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(M,D){var ne=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,_e=arguments.length>3?arguments[3]:void 0,gt=this.attributes.find(function(bo){return bo.name===M});if(gt&&gt.descriptor){var Gt=gt.descriptor,zt=Gt.update,Sr=Gt.buffer,qr=Gt.size,Rn=qr===void 0?0:qr,Gn=su[Sr.type||gi.gl.FLOAT];if(zt){var Mn=this.featureLayout,di=Mn.elements,yi=Mn.sizePerElement,aa=di.slice(ne,_e);if(!aa.length)return;var Mi=aa[0].offset,Ha=Mi*Rn*Gn,Mo=aa.map(function(bo,So){for(var Qa=bo.featureIdx,ca=bo.vertices,Wa=bo.normals,Eo=ca.length/yi,oo=[],wo=0;wo<Eo;wo++){var Ds=Wa?Wa.slice(wo*3,wo*3+3):[];oo.push.apply(oo,(0,To.Z)(zt(D[Qa],Qa,ca.slice(wo*yi,wo*yi+yi),So,Ds)))}return oo}).reduce(function(bo,So){return bo.push.apply(bo,(0,To.Z)(So)),bo},[]);gt.vertexAttribute.updateBuffer({data:Mo,offset:Ha})}}}},{key:"createAttributesAndIndices",value:function(M,D){var ne=this;this.featureLayout={sizePerElement:0,elements:[]},D&&(this.triangulation=D);var _e=this.attributes.map(function(Mi){return Mi.resetDescriptor(),Mi.descriptor}),gt=0,Gt=[],zt=[],Sr=[],qr=3;M.forEach(function(Mi,Ha){var Mo=ne.triangulation(Mi),bo=Mo.indices,So=Mo.vertices,Qa=Mo.normals,ca=Mo.size;bo.forEach(function(wo){zt.push(wo+gt)}),qr=ca;var Wa=So.length/ca;ne.featureLayout.sizePerElement=qr,ne.featureLayout.elements.push({featureIdx:Ha,vertices:So,normals:Qa,offset:gt}),gt+=Wa;for(var Eo=function(Ds){var mu=(Qa==null?void 0:Qa.slice(Ds*3,Ds*3+3))||[],Zu=So.slice(Ds*ca,Ds*ca+ca);_e.forEach(function(Ss,Xc){if(Ss&&Ss.update){var cf;(cf=Ss.buffer.data).push.apply(cf,(0,To.Z)(Ss.update(Mi,Ha,Zu,Ds,mu)))}})},oo=0;oo<Wa;oo++)Eo(oo)});var Rn=this.rendererService,Gn=Rn.createAttribute,Mn=Rn.createBuffer,di=Rn.createElements,yi={};_e.forEach(function(Mi,Ha){if(Mi){var Mo=Mi.buffer,bo=Mi.update,So=Mi.name,Qa=(0,ja.Z)(Mi,["buffer","update","name"]),ca=Gn(ti({buffer:Mn(Mo)},Qa));yi[Mi.name||""]=ca,ne.attributes[Ha].vertexAttribute=ca}});var aa=di({data:zt,type:gi.gl.UNSIGNED_INT,count:zt.length});return this.attributesAndIndices={attributes:yi,elements:aa},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var M;this.attributes.forEach(function(D){D.vertexAttribute&&D.vertexAttribute.destroy()}),(M=this.attributesAndIndices)===null||M===void 0||M.elements.destroy(),this.attributes=[]}}]),j}(),bs=(0,ge.Z)(ou.prototype,"rendererService",[ua],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ou))||Ns),sl=_(34155);function Xe(j){if(typeof window!="undefined"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof sl!="undefined"&&typeof sl.versions=="object"&&Boolean(sl.versions.electron))return!0;const z=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,M=j||z;return!!(M&&M.indexOf("Electron")>=0)}var Pt=_(34155);function _r(){return!(typeof Pt=="object"&&String(Pt)==="[object process]"&&!Pt.browser)||Xe()}function Zn(){return _r()&&typeof document!="undefined"}const sa=typeof __VERSION__!="undefined"?__VERSION__:"untranspiled source",xa=_r();function ka(j){try{const z=window[j],M="__storage_test__";return z.setItem(M,M),z.removeItem(M),z}catch(z){return null}}class vi{constructor(z,M,D="sessionStorage"){this.storage=ka(D),this.id=z,this.config={},Object.assign(this.config,M),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(z){return this.config={},this.updateConfiguration(z)}updateConfiguration(z){if(Object.assign(this.config,z),this.storage){const M=JSON.stringify(this.config);this.storage.setItem(this.id,M)}return this}_loadConfiguration(){let z={};if(this.storage){const M=this.storage.getItem(this.id);z=M?JSON.parse(M):{}}return Object.assign(this.config,z),this}}function Ta(j){let z;return j<10?z="".concat(j.toFixed(2),"ms"):j<100?z="".concat(j.toFixed(1),"ms"):j<1e3?z="".concat(j.toFixed(0),"ms"):z="".concat((j/1e3).toFixed(2),"s"),z}function eo(j,z=8){const M=Math.max(z-j.length,0);return"".concat(" ".repeat(M)).concat(j)}function qn(j,z=8){const M=Math.max(z-j.length,0);return"".concat(j).concat(" ".repeat(M))}function ba(j,z={}){const M=1e-16,{isInteger:D=!1}=z;if(Array.isArray(j)||ArrayBuffer.isView(j))return Jl(j,z);if(!Number.isFinite(j))return String(j);if(Math.abs(j)<M)return D?"0":"0.";if(D||Math.abs(j)>100&&Math.abs(j)<1e4)return j.toFixed(0);const ne=j.toPrecision(2);return ne.indexOf(".0")===ne.length-2?ne.slice(0,-1):ne}function Jl(j,z){const{maxElts:M=16,size:D=1}=z;let ne="[";for(let gt=0;gt<j.length&&gt<M;++gt)gt>0&&(ne+=",".concat(gt%D==0?" ":"")),ne+=ba(j[gt],z);const _e=j.length>M?"...":"]";return"".concat(ne).concat(_e)}function Ra(j,z,M,D=600){const ne=j.src.replace(/\(/g,"%28").replace(/\)/g,"%29");j.width>D&&(M=Math.min(M,D/j.width));const _e=j.width*M,gt=j.height*M,Gt=["font-size:1px;","padding:".concat(Math.floor(gt/2),"px ").concat(Math.floor(_e/2),"px;"),"line-height:".concat(gt,"px;"),"background:url(".concat(ne,");"),"background-size:".concat(_e,"px ").concat(gt,"px;"),"color:transparent;"].join("");return["".concat(z," %c+"),Gt]}const Ro={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function xu(j){return typeof j=="string"?Ro[j.toUpperCase()]||Ro.WHITE:j}function Ys(j,z,M){return!xa&&typeof j=="string"&&(z&&(z=xu(z),j="[".concat(z,"m").concat(j,"[39m")),M&&(z=xu(M),j="[".concat(M+10,"m").concat(j,"[49m"))),j}function zs(j,z=["constructor"]){const M=Object.getPrototypeOf(j),D=Object.getOwnPropertyNames(M);for(const ne of D)typeof j[ne]=="function"&&(z.find(_e=>ne===_e)||(j[ne]=j[ne].bind(j)))}function rs(j,z){if(!j)throw new Error(z||"Assertion failed")}var Iu=_(34155);const xo={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,global:typeof _.g!="undefined"&&_.g,document:typeof document!="undefined"&&document,process:typeof Iu=="object"&&Iu},rf=xo.self||xo.window||xo.global,ul=xo.window||xo.self||xo.global,Ui=xo.global||xo.self||xo.window,Hf=xo.document||{},Ql=xo.process||{},Sf=console;function Ll(){let j;if(xa&&ul.performance)j=ul.performance.now();else if(Ql.hrtime){const z=Ql.hrtime();j=z[0]*1e3+z[1]/1e6}else j=Date.now();return j}const Ko={debug:xa&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Aa={enabled:!0,level:0};function to(){}const Ks={},ns={once:!0};function fc(j){for(const z in j)for(const M in j[z])return M||"untitled";return"empty"}class Rl{constructor({id:z}={id:""}){this.id=z,this.VERSION=sa,this._startTs=Ll(),this._deltaTs=Ll(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new vi("__probe-".concat(this.id,"__"),Aa),this.userData={},this.timeStamp("".concat(this.id," started")),zs(this),Object.seal(this)}set level(z){this.setLevel(z)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Ll()-this._startTs).toPrecision(10))}getDelta(){return Number((Ll()-this._deltaTs).toPrecision(10))}set priority(z){this.level=z}get priority(){return this.level}getPriority(){return this.level}enable(z=!0){return this._storage.updateConfiguration({enabled:z}),this}setLevel(z){return this._storage.updateConfiguration({level:z}),this}assert(z,M){rs(z,M)}warn(z){return this._getLogFunction(0,z,Ko.warn,arguments,ns)}error(z){return this._getLogFunction(0,z,Ko.error,arguments)}deprecated(z,M){return this.warn("`".concat(z,"` is deprecated and will be removed in a later version. Use `").concat(M,"` instead"))}removed(z,M){return this.error("`".concat(z,"` has been removed. Use `").concat(M,"` instead"))}probe(z,M){return this._getLogFunction(z,M,Ko.log,arguments,{time:!0,once:!0})}log(z,M){return this._getLogFunction(z,M,Ko.debug,arguments)}info(z,M){return this._getLogFunction(z,M,console.info,arguments)}once(z,M){return this._getLogFunction(z,M,Ko.debug||Ko.info,arguments,ns)}table(z,M,D){return M?this._getLogFunction(z,M,console.table||to,D&&[D],{tag:fc(M)}):to}image({logLevel:z,priority:M,image:D,message:ne="",scale:_e=1}){return this._shouldLog(z||M)?xa?Eu({image:D,message:ne,scale:_e}):Zs({image:D,message:ne,scale:_e}):to}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}get(z){return this._storage.config[z]}set(z,M){this._storage.updateConfiguration({[z]:M})}time(z,M){return this._getLogFunction(z,M,console.time?console.time:console.info)}timeEnd(z,M){return this._getLogFunction(z,M,console.timeEnd?console.timeEnd:console.info)}timeStamp(z,M){return this._getLogFunction(z,M,console.timeStamp||to)}group(z,M,D={collapsed:!1}){D=Su({logLevel:z,message:M,opts:D});const{collapsed:ne}=D;return D.method=(ne?console.groupCollapsed:console.group)||console.info,this._getLogFunction(D)}groupCollapsed(z,M,D={}){return this.group(z,M,Object.assign({},D,{collapsed:!0}))}groupEnd(z){return this._getLogFunction(z,"",console.groupEnd||to)}withGroup(z,M,D){this.group(z,M)();try{D()}finally{this.groupEnd(z)()}}trace(){console.trace&&console.trace()}_shouldLog(z){return this.isEnabled()&&this.getLevel()>=bu(z)}_getLogFunction(z,M,D,ne=[],_e){if(this._shouldLog(z)){_e=Su({logLevel:z,message:M,args:ne,opts:_e}),D=D||_e.method,rs(D),_e.total=this.getTotal(),_e.delta=this.getDelta(),this._deltaTs=Ll();const gt=_e.tag||_e.message;if(_e.once)if(!Ks[gt])Ks[gt]=Ll();else return to;return M=Ou(this.id,_e.message,_e),D.bind(console,M,..._e.args)}return to}}Rl.VERSION=sa;function bu(j){if(!j)return 0;let z;switch(typeof j){case"number":z=j;break;case"object":z=j.logLevel||j.priority||0;break;default:return 0}return rs(Number.isFinite(z)&&z>=0),z}function Su(j){const{logLevel:z,message:M}=j;j.logLevel=bu(z);const D=j.args?Array.from(j.args):[];for(;D.length&&D.shift()!==M;);switch(j.args=D,typeof z){case"string":case"function":M!==void 0&&D.unshift(M),j.message=z;break;case"object":Object.assign(j,z);break;default:}typeof j.message=="function"&&(j.message=j.message());const ne=typeof j.message;return rs(ne==="string"||ne==="object"),Object.assign(j,j.opts)}function Ou(j,z,M){if(typeof z=="string"){const D=M.time?eo(Ta(M.total)):"";z=M.time?"".concat(j,": ").concat(D,"  ").concat(z):"".concat(j,": ").concat(z),z=Ys(z,M.color,M.background)}return z}function Zs({image:j,message:z="",scale:M=1}){let D=null;try{D=_(75307)}catch(ne){}return D?()=>D(j,{fit:"box",width:"".concat(Math.round(80*M),"%")}).then(ne=>console.log(ne)):to}function Eu({image:j,message:z="",scale:M=1}){if(typeof j=="string"){const ne=new Image;return ne.onload=()=>{const _e=Ra(ne,z,M);console.log(..._e)},ne.src=j,to}const D=j.nodeName||"";if(D.toLowerCase()==="img")return console.log(...Ra(j,z,M)),to;if(D.toLowerCase()==="canvas"){const ne=new Image;return ne.onload=()=>console.log(...Ra(ne,z,M)),ne.src=j.toDataURL(),to}return to}var hc,Gu,ma=new Rl({id:"L7"}).enable(!1);ma.priority=5;var Pc=(hc=(0,b.b2)(),hc(Gu=function(){function j(){(0,$.Z)(this,j)}return(0,I.Z)(j,[{key:"error",value:function(M){ma.error(M)()}},{key:"warn",value:function(M){ma.probe(1,M)()}},{key:"info",value:function(M){ma.info(3,M)()}},{key:"debug",value:function(M){ma.probe(4,M)()}}]),j}())||Gu),Ef=_(46343),ll=_(67709),nf=_.n(ll),Mc=window.document.documentElement.style,pc=0;function ql(j){var z=j;if(typeof j=="string"&&(z=document.getElementById(j)),z){var M=document.createElement("div");return M.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,M.id="l7-scene-".concat(pc++),M.classList.add("l7-scene"),z.appendChild(M),M}return null}var cl,wu,ec,fl,uu,dc,hl,$s,Ic,Oc,Lc,Hu,Dl,tc,Wu,kl,Rc,Xu,No,af,of,Fl,Dc,Fa,kc,Yu,Fc,Cu,Pa,rc,Lu,Ku,Hi,Ma,Us;function vc(j){var z=nc();return function(){var D=(0,w.Z)(j),ne;if(z){var _e=(0,w.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Bt.Z)(this,ne)}}function nc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var ic=(cl=(0,b.b2)(),wu=(0,b.f3)(W.v.SceneID),ec=(0,b.f3)(W.v.IIconService),fl=(0,b.f3)(W.v.IFontService),uu=(0,b.f3)(W.v.IControlService),dc=(0,b.f3)(W.v.ILogService),hl=(0,b.f3)(W.v.IGlobalConfigService),$s=(0,b.f3)(W.v.IMapService),Ic=(0,b.f3)(W.v.ICoordinateSystemService),Oc=(0,b.f3)(W.v.IRendererService),Lc=(0,b.f3)(W.v.ILayerService),Hu=(0,b.f3)(W.v.ICameraService),Dl=(0,b.f3)(W.v.IInteractionService),tc=(0,b.f3)(W.v.IPickingService),Wu=(0,b.f3)(W.v.IShaderModuleService),kl=(0,b.f3)(W.v.IMarkerService),Rc=(0,b.f3)(W.v.IPopupService),cl(Xu=(No=function(j){(0,wt.Z)(M,j);var z=vc(M);function M(){var D;return(0,$.Z)(this,M),D=z.call(this),(0,k.Z)((0,Ee.Z)(D),"destroyed",!1),(0,k.Z)((0,Ee.Z)(D),"loaded",!1),(0,k.Z)((0,Ee.Z)(D),"loadFont",!1),(0,k.Z)((0,Ee.Z)(D),"fontFamily",""),(0,te.Z)((0,Ee.Z)(D),"id",af,(0,Ee.Z)(D)),(0,te.Z)((0,Ee.Z)(D),"iconService",of,(0,Ee.Z)(D)),(0,te.Z)((0,Ee.Z)(D),"fontService",Fl,(0,Ee.Z)(D)),(0,te.Z)((0,Ee.Z)(D),"controlService",Dc,(0,Ee.Z)(D)),(0,te.Z)((0,Ee.Z)(D),"logger",Fa,(0,Ee.Z)(D)),(0,te.Z)((0,Ee.Z)(D),"configService",kc,(0,Ee.Z)(D)),(0,te.Z)((0,Ee.Z)(D),"map",Yu,(0,Ee.Z)(D)),(0,te.Z)((0,Ee.Z)(D),"coordinateSystemService",Fc,(0,Ee.Z)(D)),(0,te.Z)((0,Ee.Z)(D),"rendererService",Cu,(0,Ee.Z)(D)),(0,te.Z)((0,Ee.Z)(D),"layerService",Pa,(0,Ee.Z)(D)),(0,te.Z)((0,Ee.Z)(D),"cameraService",rc,(0,Ee.Z)(D)),(0,te.Z)((0,Ee.Z)(D),"interactionService",Lu,(0,Ee.Z)(D)),(0,te.Z)((0,Ee.Z)(D),"pickingService",Ku,(0,Ee.Z)(D)),(0,te.Z)((0,Ee.Z)(D),"shaderModuleService",Hi,(0,Ee.Z)(D)),(0,te.Z)((0,Ee.Z)(D),"markerService",Ma,(0,Ee.Z)(D)),(0,te.Z)((0,Ee.Z)(D),"popupService",Us,(0,Ee.Z)(D)),(0,k.Z)((0,Ee.Z)(D),"inited",!1),(0,k.Z)((0,Ee.Z)(D),"initPromise",void 0),(0,k.Z)((0,Ee.Z)(D),"rendering",!1),(0,k.Z)((0,Ee.Z)(D),"$container",void 0),(0,k.Z)((0,Ee.Z)(D),"canvas",void 0),(0,k.Z)((0,Ee.Z)(D),"markerContainer",void 0),(0,k.Z)((0,Ee.Z)(D),"hooks",void 0),(0,k.Z)((0,Ee.Z)(D),"handleWindowResized",function(){D.emit("resize"),D.$container&&(D.initContainer(),Ce.SO.triggerResize(),D.coordinateSystemService.needRefresh=!0,D.render())}),(0,k.Z)((0,Ee.Z)(D),"handleMapCameraChanged",function(ne){D.cameraService.update(ne),D.render()}),D.hooks={init:new Ef.zj},D}return(0,I.Z)(M,[{key:"init",value:function(ne){var _e=this;this.configService.setSceneConfig(this.id,ne),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,da.Z)(Ya().mark(function gt(){return Ya().wrap(function(zt){for(;;)switch(zt.prev=zt.next){case 0:return zt.next=2,new Promise(function(Sr){_e.map.onCameraChanged(function(qr){_e.cameraService.init(),_e.cameraService.update(qr),_e.map.version!=="GAODE2.x"&&Sr()}),_e.map.version!=="GAODE2.x"?_e.map.init():Sr()});case 2:if(!(_e.map.version==="GAODE2.x"&&_e.map.initViewPort)){zt.next=6;break}return zt.next=5,_e.map.init();case 5:_e.map.initViewPort();case 6:_e.map.onCameraChanged(_e.handleMapCameraChanged),_e.map.addMarkerContainer(),_e.markerService.addMarkers(),_e.markerService.addMarkerLayers(),_e.popupService.initPopup(),_e.interactionService.init(),_e.interactionService.on(Yn.s.Drag,_e.addSceneEvent.bind(_e)),_e.logger.debug("map ".concat(_e.id," loaded"));case 14:case"end":return zt.stop()}},gt)}))),this.hooks.init.tapPromise("initRenderer",(0,da.Z)(Ya().mark(function gt(){var Gt;return Ya().wrap(function(Sr){for(;;)switch(Sr.prev=Sr.next){case 0:if(Gt=ql(_e.configService.getSceneConfig(_e.id).id||""),_e.$container=Gt,!Gt){Sr.next=11;break}return _e.canvas=Ce.SO.create("canvas","",Gt),_e.setCanvas(),Sr.next=7,_e.rendererService.init(_e.canvas,_e.configService.getSceneConfig(_e.id));case 7:nf()(_e.$container,_e.handleWindowResized),window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)").addListener(_e.handleWindowResized),Sr.next=12;break;case 11:_e.logger.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:_e.pickingService.init(_e.id),_e.logger.debug("scene ".concat(_e.id," renderer loaded"));case 14:case"end":return Sr.stop()}},gt)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(ne){this.logger.debug("add layer ".concat(ne.name," to scene ").concat(this.id)),this.layerService.add(ne),this.render()}},{key:"render",value:function(){var D=(0,da.Z)(Ya().mark(function _e(){return Ya().wrap(function(Gt){for(;;)switch(Gt.prev=Gt.next){case 0:if(!(this.rendering||this.destroyed)){Gt.next=2;break}return Gt.abrupt("return");case 2:if(this.rendering=!0,this.inited){Gt.next=16;break}return Gt.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){Gt.next=10;break}return Gt.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.logger.info(" render inited"),this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 16:this.layerService.renderLayers(),this.logger.debug("scene ".concat(this.id," render")),this.rendering=!1;case 19:case"end":return Gt.stop()}},_e,this)}));function ne(){return D.apply(this,arguments)}return ne}()},{key:"addFontFace",value:function(ne,_e){this.fontFamily=ne;var gt=document.createElement("style");gt.type="text/css",gt.innerText=`
        @font-face{
            font-family: '`.concat(ne,`';
            src: url('`).concat(_e,`') format('woff2'),
            url('`).concat(_e,`') format('woff'),
            url('`).concat(_e,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(gt),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(ne){var _e,gt=(_e=this.$container)===null||_e===void 0?void 0:_e.getElementsByTagName("canvas")[0];this.render();var Gt=ne==="jpg"?gt==null?void 0:gt.toDataURL("image/jpeg"):gt==null?void 0:gt.toDataURL("image/png");return Gt}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"addMarkerContainer",value:function(){var ne=this.$container.parentElement;ne!==null&&(this.markerContainer=Ce.SO.create("div","l7-marker-container",ne))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){if(!this.inited){this.destroyed=!0;return}this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.removeAllListeners(),this.inited=!1,(0,ll.unbind)(this.$container,this.handleWindowResized),window.matchMedia("screen and (min-resolution: 2dppx)").removeListener(this.handleWindowResized)}},{key:"initContainer",value:function(){var ne,_e,gt=Ce.SO.DPR,Gt=((ne=this.$container)===null||ne===void 0?void 0:ne.clientWidth)||400,zt=((_e=this.$container)===null||_e===void 0?void 0:_e.clientHeight)||300,Sr=this.canvas;Sr&&(Sr.width=Gt*gt,Sr.height=zt*gt,Sr.style.width="".concat(Gt,"px"),Sr.style.height="".concat(zt,"px")),this.rendererService.viewport({x:0,y:0,width:gt*Gt,height:gt*zt})}},{key:"setCanvas",value:function(){var ne,_e,gt=Ce.SO.DPR,Gt=((ne=this.$container)===null||ne===void 0?void 0:ne.clientWidth)||400,zt=((_e=this.$container)===null||_e===void 0?void 0:_e.clientHeight)||300,Sr=this.canvas;Sr.width=Gt*gt,Sr.height=zt*gt,Sr.style.width="".concat(Gt,"px"),Sr.style.height="".concat(zt,"px")}},{key:"addSceneEvent",value:function(ne){this.emit(ne.type,ne)}}]),M}(E.EventEmitter),af=(0,ge.Z)(No.prototype,"id",[wu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),of=(0,ge.Z)(No.prototype,"iconService",[ec],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fl=(0,ge.Z)(No.prototype,"fontService",[fl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dc=(0,ge.Z)(No.prototype,"controlService",[uu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fa=(0,ge.Z)(No.prototype,"logger",[dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kc=(0,ge.Z)(No.prototype,"configService",[hl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yu=(0,ge.Z)(No.prototype,"map",[$s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fc=(0,ge.Z)(No.prototype,"coordinateSystemService",[Ic],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cu=(0,ge.Z)(No.prototype,"rendererService",[Oc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pa=(0,ge.Z)(No.prototype,"layerService",[Lc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rc=(0,ge.Z)(No.prototype,"cameraService",[Hu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lu=(0,ge.Z)(No.prototype,"interactionService",[Dl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ku=(0,ge.Z)(No.prototype,"pickingService",[tc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hi=(0,ge.Z)(No.prototype,"shaderModuleService",[Wu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ma=(0,ge.Z)(No.prototype,"markerService",[kl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Us=(0,ge.Z)(No.prototype,"popupService",[Rc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),No))||Xu),Of=_(44908),Lf=_.n(Of);function ac(j){var z=0;switch(j){case"vec2":case"ivec2":z=2;break;case"vec3":case"ivec3":z=3;break;case"vec4":case"ivec4":case"mat2":z=4;break;case"mat3":z=9;break;case"mat4":z=16;break;default:}return z}var $u=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Ru(j){var z={};return j=j.replace($u,function(M,D,ne){var _e=ne.split(":"),gt=_e[0].trim(),Gt="";switch(_e.length>1&&(Gt=_e[1].trim()),D){case"bool":Gt=Gt==="true";break;case"float":case"int":Gt=Number(Gt);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":Gt?Gt=Gt.replace("[","").replace("]","").split(",").reduce(function(zt,Sr){return zt.push(Number(Sr.trim())),zt},[]):Gt=new Array(ac(D)).fill(0);break;default:}return z[gt]=Gt,"uniform ".concat(D," ").concat(gt,`;
`)}),{content:j,uniforms:z}}var ro,hs;function pl(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function Va(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?pl(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):pl(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}var wn="#define PI 3.14159265359",js=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,mc=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Bl=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,lu=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  return filterPickingColor(filterHighlightColor(color));
}
`,Vs=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,dl=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,$r=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Bc=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,gc=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 0.0, 0.0, 0.0, // offsets
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0;   // offsets
}`,Ju=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,Js=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Ms=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,Nc=/precision\s+(high|low|medium)p\s+float/,zc=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,Gs=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,Qu=(ro=(0,b.b2)(),ro(hs=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"moduleCache",{}),(0,k.Z)(this,"rawContentCache",{})}return(0,I.Z)(j,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:wn,fs:wn}),this.registerModule("decode",{vs:js,fs:""}),this.registerModule("projection",{vs:$r,fs:""}),this.registerModule("project",{vs:dl,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Bc}),this.registerModule("lighting",{vs:Bl,fs:""}),this.registerModule("light",{vs:mc,fs:""}),this.registerModule("picking",{vs:Vs,fs:lu}),this.registerModule("styleMapping",{vs:gc,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:Ju,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:Js,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Ms,fs:""})}},{key:"registerModule",value:function(M,D){if(!this.rawContentCache[M]){var ne=D.vs,_e=D.fs,gt=D.uniforms,Gt=Ru(ne),zt=Gt.content,Sr=Gt.uniforms,qr=Ru(_e),Rn=qr.content,Gn=qr.uniforms;this.rawContentCache[M]={fs:Rn,uniforms:Va(Va(Va({},Sr),Gn),gt),vs:zt}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(M){var D=this;if(this.moduleCache[M])return this.moduleCache[M];var ne=this.rawContentCache[M].vs,_e=this.rawContentCache[M].fs,gt=this.processModule(ne,[],"vs"),Gt=gt.content,zt=gt.includeList,Sr=this.processModule(_e,[],"fs"),qr=Sr.content,Rn=Sr.includeList,Gn=qr,Mn=Lf()(zt.concat(Rn).concat(M)).reduce(function(di,yi){return Va(Va({},di),D.rawContentCache[yi].uniforms)},{});return Nc.test(qr)||(Gn=zc+qr),this.moduleCache[M]={fs:Gn.trim(),uniforms:Mn,vs:Gt.trim()},this.moduleCache[M]}},{key:"processModule",value:function(M,D,ne){var _e=this,gt=M.replace(Gs,function(Gt,zt){var Sr=zt.split(" "),qr=Sr[0].replace(/"/g,"");if(D.indexOf(qr)>-1)return"";var Rn=_e.rawContentCache[qr][ne];D.push(qr);var Gn=_e.processModule(Rn,D,ne),Mn=Gn.content;return Mn});return{content:gt,includeList:D}}}]),j}())||hs),Nl=_(66213),Du=_(92364),Zc,yc,cu,Is,Bi,Qs=(Zc=(0,b.b2)(),yc=(0,b.f3)(W.v.IShaderModuleService),Zc(cu=(Is=function(){function j(){(0,$.Z)(this,j),(0,te.Z)(this,"shaderModuleService",Bi,this),(0,k.Z)(this,"rendererService",void 0),(0,k.Z)(this,"cameraService",void 0),(0,k.Z)(this,"mapService",void 0),(0,k.Z)(this,"interactionService",void 0),(0,k.Z)(this,"layerService",void 0),(0,k.Z)(this,"config",void 0)}return(0,I.Z)(j,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Du.G.Normal}},{key:"init",value:function(M,D){this.config=D,this.rendererService=M.getContainer().get(W.v.IRendererService),this.cameraService=M.getContainer().get(W.v.ICameraService),this.mapService=M.getContainer().get(W.v.IMapService),this.interactionService=M.getContainer().get(W.v.IInteractionService),this.layerService=M.getContainer().get(W.v.ILayerService)}},{key:"render",value:function(M){}}]),j}(),Bi=(0,ge.Z)(Is.prototype,"shaderModuleService",[yc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Is))||cu),$o,Ao;function vl(j){var z=qu();return function(){var D=(0,w.Z)(j),ne;if(z){var _e=(0,w.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Bt.Z)(this,ne)}}function qu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var fu=($o=(0,b.b2)(),$o(Ao=function(j){(0,wt.Z)(M,j);var z=vl(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(ne,_e){(0,Nl.Z)((0,w.Z)(M.prototype),"init",this).call(this,ne,_e)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),M}(Qs))||Ao),is,zl,Un,On,Zl;function ps(j,z){var M=typeof Symbol!="undefined"&&j[Symbol.iterator]||j["@@iterator"];if(!M){if(Array.isArray(j)||(M=Do(j))||z&&j&&typeof j.length=="number"){M&&(j=M);var D=0,ne=function(){};return{s:ne,n:function(){return D>=j.length?{done:!0}:{done:!1,value:j[D++]}},e:function(Sr){throw Sr},f:ne}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var _e=!0,gt=!1,Gt;return{s:function(){M=M.call(j)},n:function(){var Sr=M.next();return _e=Sr.done,Sr},e:function(Sr){gt=!0,Gt=Sr},f:function(){try{!_e&&M.return!=null&&M.return()}finally{if(gt)throw Gt}}}}function Do(j,z){if(!!j){if(typeof j=="string")return zo(j,z);var M=Object.prototype.toString.call(j).slice(8,-1);if(M==="Object"&&j.constructor&&(M=j.constructor.name),M==="Map"||M==="Set")return Array.from(j);if(M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M))return zo(j,z)}}function zo(j,z){(z==null||z>j.length)&&(z=j.length);for(var M=0,D=new Array(z);M<z;M++)D[M]=j[M];return D}var ku=(is=(0,b.b2)(),zl=(0,b.f3)(W.v.IPostProcessor),is(Un=(On=function(){function j(){(0,$.Z)(this,j),(0,k.Z)(this,"passes",[]),(0,te.Z)(this,"postProcessor",Zl,this),(0,k.Z)(this,"layer",void 0),(0,k.Z)(this,"renderFlag",void 0),(0,k.Z)(this,"width",0),(0,k.Z)(this,"height",0)}return(0,I.Z)(j,[{key:"setLayer",value:function(M){this.layer=M}},{key:"setRenderFlag",value:function(M){this.renderFlag=M}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var z=(0,da.Z)(Ya().mark(function D(){var ne,_e,gt;return Ya().wrap(function(zt){for(;;)switch(zt.prev=zt.next){case 0:ne=ps(this.passes),zt.prev=1,ne.s();case 3:if((_e=ne.n()).done){zt.next=9;break}return gt=_e.value,zt.next=7,gt.render(this.layer);case 7:zt.next=3;break;case 9:zt.next=14;break;case 11:zt.prev=11,zt.t0=zt.catch(1),ne.e(zt.t0);case 14:return zt.prev=14,ne.f(),zt.finish(14);case 17:this.layer.renderModels();case 18:case"end":return zt.stop()}},D,this,[[1,11,14,17]])}));function M(){return z.apply(this,arguments)}return M}()},{key:"resize",value:function(M,D){(this.width!==M||this.height!==D)&&(this.width=M,this.height=D)}},{key:"add",value:function(M,D){M.getType()===Du.G.PostProcessing?this.postProcessor.add(M,this.layer,D):(M.init(this.layer,D),this.passes.push(M))}},{key:"insert",value:function(M,D,ne){M.init(this.layer,D),this.passes.splice(ne,0,M)}},{key:"destroy",value:function(){this.passes.length=0}}]),j}(),Zl=(0,ge.Z)(On.prototype,"postProcessor",[zl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),On))||Un),hu,Ul,ra,po,Uc;function Fu(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function _c(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?Fu(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):Fu(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function Bu(j){var z=Os();return function(){var D=(0,w.Z)(j),ne;if(z){var _e=(0,w.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Bt.Z)(this,ne)}}function Os(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var oc=(hu=(0,b.b2)(),Ul=(0,b.f3)(W.v.ILogService),hu(ra=(po=function(j){(0,wt.Z)(M,j);var z=Bu(M);function M(){var D;(0,$.Z)(this,M);for(var ne=arguments.length,_e=new Array(ne),gt=0;gt<ne;gt++)_e[gt]=arguments[gt];return D=z.call.apply(z,[this].concat(_e)),(0,te.Z)((0,Ee.Z)(D),"logger",Uc,(0,Ee.Z)(D)),(0,k.Z)((0,Ee.Z)(D),"pickingFBO",void 0),(0,k.Z)((0,Ee.Z)(D),"layer",void 0),(0,k.Z)((0,Ee.Z)(D),"width",0),(0,k.Z)((0,Ee.Z)(D),"height",0),(0,k.Z)((0,Ee.Z)(D),"alreadyInRendering",!1),(0,k.Z)((0,Ee.Z)(D),"pickFromPickingFBO",function(Gt){var zt=Gt.x,Sr=Gt.y,qr=Gt.lngLat,Rn=Gt.type;if(!(!D.layer.isVisible()||!D.layer.needPick(Rn))){var Gn=D.rendererService,Mn=Gn.getViewportSize,di=Gn.readPixels,yi=Gn.useFramebuffer,aa=Mn(),Mi=aa.width,Ha=aa.height,Mo=D.layer.getLayerConfig(),bo=Mo.enableHighlight,So=Mo.enableSelect,Qa=zt*Ce.SO.DPR,ca=Sr*Ce.SO.DPR;if(!(Qa>Mi||Qa<0||ca>Ha||ca<0)){var Wa;yi(D.pickingFBO,function(){var Eo;if(Wa=di({x:Math.round(Qa),y:Math.round(Ha-(Sr+1)*Ce.SO.DPR),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:D.pickingFBO}),Wa[0]!==0||Wa[1]!==0||Wa[2]!==0){D.logger.debug("picked");var oo=(0,Ce.W0)(Wa),wo=D.layer.getSource().getFeatureById(oo),Ds={x:zt,y:Sr,type:Rn,lngLat:qr,featureId:oo,feature:wo};wo&&(D.layer.setCurrentPickId(oo),D.triggerHoverOnLayer(Ds))}else{var mu={x:zt,y:Sr,lngLat:qr,type:D.layer.getCurrentPickId()===null?"un"+Rn:"mouseout",featureId:null,feature:null};D.triggerHoverOnLayer(_c(_c({},mu),{},{type:"unpick"})),D.triggerHoverOnLayer(mu),D.layer.setCurrentPickId(null)}bo&&D.highlightPickedFeature(Wa),So&&Rn==="click"&&((Eo=Wa)===null||Eo===void 0?void 0:Eo.toString())!==[0,0,0,0].toString()&&D.selectFeature(Wa)})}}}),D}return(0,I.Z)(M,[{key:"getType",value:function(){return Du.G.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(ne,_e){(0,Nl.Z)((0,w.Z)(M.prototype),"init",this).call(this,ne,_e),this.layer=ne;var gt=this.rendererService,Gt=gt.createTexture2D,zt=gt.createFramebuffer,Sr=gt.getViewportSize,qr=Sr(),Rn=qr.width,Gn=qr.height;this.pickingFBO=zt({color:Gt({width:Rn,height:Gn,wrapS:gi.gl.CLAMP_TO_EDGE,wrapT:gi.gl.CLAMP_TO_EDGE})}),this.interactionService.on(Yn.s.Hover,this.pickFromPickingFBO),this.interactionService.on(Yn.s.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Yn.s.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(ne){var _e=this;if(!this.alreadyInRendering){var gt=this.rendererService,Gt=gt.getViewportSize,zt=gt.useFramebuffer,Sr=gt.clear,qr=Gt(),Rn=qr.width,Gn=qr.height;this.alreadyInRendering=!0,(this.width!==Rn||this.height!==Gn)&&(this.pickingFBO.resize({width:Rn,height:Gn}),this.width=Rn,this.height=Gn),zt(this.pickingFBO,function(){Sr({framebuffer:_e.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var Mn=_e.layer.multiPassRenderer.getRenderFlag();_e.layer.multiPassRenderer.setRenderFlag(!1),ne.hooks.beforePickingEncode.call(),ne.render(),ne.hooks.afterPickingEncode.call(),_e.layer.multiPassRenderer.setRenderFlag(Mn),_e.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(ne){this.layer.emit(ne.type,ne)}},{key:"highlightPickedFeature",value:function(ne){var _e=(0,kt.Z)(ne,3),gt=_e[0],Gt=_e[1],zt=_e[2];this.layer.hooks.beforeHighlight.call([gt,Gt,zt]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(ne){var _e=(0,kt.Z)(ne,3),gt=_e[0],Gt=_e[1],zt=_e[2];this.layer.hooks.beforeSelect.call([gt,Gt,zt]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(ne){var _e=ne.featureId,gt=(0,Ce.Z6)(_e);this.selectFeature(new Uint8Array(gt))}},{key:"highlightFeatureHandle",value:function(ne){var _e=ne.featureId,gt=(0,Ce.Z6)(_e);this.highlightPickedFeature(new Uint8Array(gt))}}]),M}(Qs),Uc=(0,ge.Z)(po.prototype,"logger",[Ul],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),po))||ra),as=_(69530),xc,jl;function sc(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function jc(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?sc(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):sc(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function uc(j){var z=ml();return function(){var D=(0,w.Z)(j),ne;if(z){var _e=(0,w.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Bt.Z)(this,ne)}}function ml(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var Vc=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,gl=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,yl=(xc=(0,b.b2)(),xc(jl=function(j){(0,wt.Z)(M,j);var z=uc(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:gl,fs:Vc});var ne=this.shaderModuleService.getModule("blur-pass"),_e=ne.vs,gt=ne.fs,Gt=ne.uniforms,zt=this.rendererService.getViewportSize(),Sr=zt.width,qr=zt.height;return{vs:_e,fs:gt,uniforms:jc(jc({},Gt),{},{u_ViewportSize:[Sr,qr]})}}},{key:"convertOptionsToUniforms",value:function(ne){var _e={};return $l()(ne.blurRadius)||(_e.u_BlurDir=[ne.blurRadius,0]),_e}}]),M}(as.Z))||jl),_l,pu;function qs(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function Gc(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?qs(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):qs(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function bc(j){var z=sf();return function(){var D=(0,w.Z)(j),ne;if(z){var _e=(0,w.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Bt.Z)(this,ne)}}function sf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var Sc=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,i=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,u=(_l=(0,b.b2)(),_l(pu=function(j){(0,wt.Z)(M,j);var z=bc(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:i,fs:Sc});var ne=this.shaderModuleService.getModule("blur-pass"),_e=ne.vs,gt=ne.fs,Gt=ne.uniforms,zt=this.rendererService.getViewportSize(),Sr=zt.width,qr=zt.height;return{vs:_e,fs:gt,uniforms:Gc(Gc({},Gt),{},{u_ViewportSize:[Sr,qr]})}}},{key:"convertOptionsToUniforms",value:function(ne){var _e={};return $l()(ne.blurRadius)||(_e.u_BlurDir=[0,ne.blurRadius]),_e}}]),M}(as.Z))||pu),a,h;function g(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function S(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?g(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):g(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function T(j){var z=R();return function(){var D=(0,w.Z)(j),ne;if(z){var _e=(0,w.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Bt.Z)(this,ne)}}function R(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var G=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,ee=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ve=(a=(0,b.b2)(),a(h=function(j){(0,wt.Z)(M,j);var z=T(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:ee,fs:G});var ne=this.shaderModuleService.getModule("colorhalftone-pass"),_e=ne.vs,gt=ne.fs,Gt=ne.uniforms,zt=this.rendererService.getViewportSize(),Sr=zt.width,qr=zt.height;return{vs:_e,fs:gt,uniforms:S(S({},Gt),{},{u_ViewportSize:[Sr,qr]})}}}]),M}(as.Z))||h),ye,we;function Ke(j){var z=He();return function(){var D=(0,w.Z)(j),ne;if(z){var _e=(0,w.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Bt.Z)(this,ne)}}function He(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var at=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,ze=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,it=(ye=(0,b.b2)(),ye(we=function(j){(0,wt.Z)(M,j);var z=Ke(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:ze,fs:at}),this.shaderModuleService.getModule("copy-pass")}}]),M}(as.Z))||we),mt,Ut;function sr(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function nr(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?sr(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):sr(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function cr(j){var z=Rr();return function(){var D=(0,w.Z)(j),ne;if(z){var _e=(0,w.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Bt.Z)(this,ne)}}function Rr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var tn=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Xr=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,yn=(mt=(0,b.b2)(),mt(Ut=function(j){(0,wt.Z)(M,j);var z=cr(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Xr,fs:tn});var ne=this.shaderModuleService.getModule("hexagonalpixelate-pass"),_e=ne.vs,gt=ne.fs,Gt=ne.uniforms,zt=this.rendererService.getViewportSize(),Sr=zt.width,qr=zt.height;return{vs:_e,fs:gt,uniforms:nr(nr({},Gt),{},{u_ViewportSize:[Sr,qr]})}}}]),M}(as.Z))||Ut),Fn,Vn;function jn(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function Qi(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?jn(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):jn(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function _n(j){var z=ci();return function(){var D=(0,w.Z)(j),ne;if(z){var _e=(0,w.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Bt.Z)(this,ne)}}function ci(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var Ci=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,fi=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,oi=(Fn=(0,b.b2)(),Fn(Vn=function(j){(0,wt.Z)(M,j);var z=_n(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:fi,fs:Ci});var ne=this.shaderModuleService.getModule("ink-pass"),_e=ne.vs,gt=ne.fs,Gt=ne.uniforms,zt=this.rendererService.getViewportSize(),Sr=zt.width,qr=zt.height;return{vs:_e,fs:gt,uniforms:Qi(Qi({},Gt),{},{u_ViewportSize:[Sr,qr]})}}}]),M}(as.Z))||Vn),Ti,ii;function ri(j){var z=Po();return function(){var D=(0,w.Z)(j),ne;if(z){var _e=(0,w.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Bt.Z)(this,ne)}}function Po(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var Ja=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,os=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Zo=(Ti=(0,b.b2)(),Ti(ii=function(j){(0,wt.Z)(M,j);var z=ri(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:os,fs:Ja}),this.shaderModuleService.getModule("noise-pass")}}]),M}(as.Z))||ii),Ga,no;function ds(j){var z=vs();return function(){var D=(0,w.Z)(j),ne;if(z){var _e=(0,w.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Bt.Z)(this,ne)}}function vs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var el=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ms=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,eu=(Ga=(0,b.b2)(),Ga(no=function(j){(0,wt.Z)(M,j);var z=ds(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:el,fs:ms}),this.shaderModuleService.getModule("sepia-pass")}}]),M}(as.Z))||no),Ls,xl,bl,Nu,tu,Vl,Tu=(Ls=(0,b.b2)(),xl=(0,b.f3)(W.v.IRendererService),bl=(0,b.zY)(),Ls(Nu=(tu=function(){function j(){(0,$.Z)(this,j),(0,te.Z)(this,"rendererService",Vl,this),(0,k.Z)(this,"passes",[]),(0,k.Z)(this,"readFBO",void 0),(0,k.Z)(this,"writeFBO",void 0)}return(0,I.Z)(j,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var z=(0,da.Z)(Ya().mark(function D(ne){var _e,gt;return Ya().wrap(function(zt){for(;;)switch(zt.prev=zt.next){case 0:_e=0;case 1:if(!(_e<this.passes.length)){zt.next=10;break}return gt=this.passes[_e],gt.setRenderToScreen(this.isLastEnabledPass(_e)),zt.next=6,gt.render(ne);case 6:_e!==this.passes.length-1&&this.swap();case 7:_e++,zt.next=1;break;case 10:case"end":return zt.stop()}},D,this)}));function M(D){return z.apply(this,arguments)}return M}()},{key:"resize",value:function(M,D){this.readFBO.resize({width:M,height:D}),this.writeFBO.resize({width:M,height:D})}},{key:"add",value:function(M,D,ne){M.init(D,ne),this.passes.push(M)}},{key:"insert",value:function(M,D,ne,_e){M.init(ne,_e),this.passes.splice(D,0,M)}},{key:"getPostProcessingPassByName",value:function(M){return this.passes.find(function(D){return D.getName()===M})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(M){for(var D=M+1;D<this.passes.length;D++)if(this.passes[D].isEnabled())return!1;return!0}},{key:"swap",value:function(){var M=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=M}}]),j}(),Vl=(0,ge.Z)(tu.prototype,"rendererService",[xl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,ge.Z)(tu.prototype,"init",[bl],Object.getOwnPropertyDescriptor(tu.prototype,"init"),tu.prototype),tu))||Nu),zu,Hs;function io(j){var z=Au();return function(){var D=(0,w.Z)(j),ne;if(z){var _e=(0,w.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Bt.Z)(this,ne)}}function Au(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var du=(zu=(0,b.b2)(),zu(Hs=function(j){(0,wt.Z)(M,j);var z=io(M);function M(){return(0,$.Z)(this,M),z.apply(this,arguments)}return(0,I.Z)(M,[{key:"getType",value:function(){return Du.G.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(ne,_e){(0,Nl.Z)((0,w.Z)(M.prototype),"init",this).call(this,ne,_e)}},{key:"render",value:function(ne){var _e=this.rendererService,gt=_e.useFramebuffer,Gt=_e.clear;gt(null,function(){Gt({color:[0,0,0,0],depth:1,stencil:0}),ne.multiPassRenderer.setRenderFlag(!1),ne.render(),ne.multiPassRenderer.setRenderFlag(!0)})}}]),M}(Qs))||Hs),gs,qi,ao,ko,Rs,tl,vu;function rl(j,z){var M=Object.keys(j);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(j);z&&(D=D.filter(function(ne){return Object.getOwnPropertyDescriptor(j,ne).enumerable})),M.push.apply(M,D)}return M}function nl(j){for(var z=1;z<arguments.length;z++){var M=arguments[z]!=null?arguments[z]:{};z%2?rl(Object(M),!0).forEach(function(D){(0,k.Z)(j,D,M[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(M)):rl(Object(M)).forEach(function(D){Object.defineProperty(j,D,Object.getOwnPropertyDescriptor(M,D))})}return j}function Ec(j){var z=Pu();return function(){var D=(0,w.Z)(j),ne;if(z){var _e=(0,w.Z)(this).constructor;ne=Reflect.construct(D,arguments,_e)}else ne=D.apply(this,arguments);return(0,Bt.Z)(this,ne)}}function Pu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}var Gl=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,wc=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Ws=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function Uo(j,z){for(var M=0,D=1/z,ne=j;ne>0;)M=M+D*(ne%z),ne=Math.floor(ne/z),D=D/z;return M}var Hc=1,Rf=(gs=(0,b.b2)(),qi=(0,b.f3)(W.v.IShaderModuleService),ao=(0,b.f3)(W.v.ILogService),gs(ko=(Rs=function(j){(0,wt.Z)(M,j);var z=Ec(M);function M(){var D;(0,$.Z)(this,M);for(var ne=arguments.length,_e=new Array(ne),gt=0;gt<ne;gt++)_e[gt]=arguments[gt];return D=z.call.apply(z,[this].concat(_e)),(0,te.Z)((0,Ee.Z)(D),"shaderModuleService",tl,(0,Ee.Z)(D)),(0,te.Z)((0,Ee.Z)(D),"logger",vu,(0,Ee.Z)(D)),(0,k.Z)((0,Ee.Z)(D),"haltonSequence",[]),(0,k.Z)((0,Ee.Z)(D),"accumulatingId",0),(0,k.Z)((0,Ee.Z)(D),"frame",0),(0,k.Z)((0,Ee.Z)(D),"timer",void 0),(0,k.Z)((0,Ee.Z)(D),"sampleRenderTarget",void 0),(0,k.Z)((0,Ee.Z)(D),"prevRenderTarget",void 0),(0,k.Z)((0,Ee.Z)(D),"outputRenderTarget",void 0),(0,k.Z)((0,Ee.Z)(D),"copyRenderTarget",void 0),(0,k.Z)((0,Ee.Z)(D),"blendModel",void 0),(0,k.Z)((0,Ee.Z)(D),"outputModel",void 0),(0,k.Z)((0,Ee.Z)(D),"copyModel",void 0),D}return(0,I.Z)(M,[{key:"getType",value:function(){return Du.G.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(ne,_e){(0,Nl.Z)((0,w.Z)(M.prototype),"init",this).call(this,ne,_e);var gt=this.rendererService,Gt=gt.createFramebuffer,zt=gt.createTexture2D;this.sampleRenderTarget=Gt({color:zt({width:1,height:1,wrapS:gi.gl.CLAMP_TO_EDGE,wrapT:gi.gl.CLAMP_TO_EDGE})}),this.prevRenderTarget=Gt({color:zt({width:1,height:1,wrapS:gi.gl.CLAMP_TO_EDGE,wrapT:gi.gl.CLAMP_TO_EDGE})}),this.outputRenderTarget=Gt({color:zt({width:1,height:1,wrapS:gi.gl.CLAMP_TO_EDGE,wrapT:gi.gl.CLAMP_TO_EDGE})}),this.copyRenderTarget=Gt({color:zt({width:1,height:1,wrapS:gi.gl.CLAMP_TO_EDGE,wrapT:gi.gl.CLAMP_TO_EDGE})});for(var Sr=0;Sr<30;Sr++)this.haltonSequence.push([Uo(Sr,2),Uo(Sr,3)]);this.blendModel=this.createTriangleModel("blend-pass",Gl),this.outputModel=this.createTriangleModel("copy-pass",wc,{blend:{enable:!0,func:{srcRGB:gi.gl.ONE,dstRGB:gi.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:gi.gl.ONE,dstAlpha:gi.gl.ONE_MINUS_SRC_ALPHA},equation:{rgb:gi.gl.FUNC_ADD,alpha:gi.gl.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",wc)}},{key:"render",value:function(ne){var _e=this,gt=this.rendererService,Gt=gt.clear,zt=gt.getViewportSize,Sr=gt.useFramebuffer,qr=zt(),Rn=qr.width,Gn=qr.height;this.sampleRenderTarget.resize({width:Rn,height:Gn}),this.prevRenderTarget.resize({width:Rn,height:Gn}),this.outputRenderTarget.resize({width:Rn,height:Gn}),this.copyRenderTarget.resize({width:Rn,height:Gn}),this.resetFrame(),this.stopAccumulating();var Mn=ne.multiPassRenderer.getPostProcessor().getReadFBO();Sr(Mn,function(){Gt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:Mn}),ne.multiPassRenderer.setRenderFlag(!1),ne.render(),ne.multiPassRenderer.setRenderFlag(!0)});var di=function yi(aa){!_e.accumulatingId||aa!==_e.accumulatingId||_e.isFinished()||(_e.doRender(ne),requestAnimationFrame(function(){yi(aa)}))};this.accumulatingId=Hc++,this.timer=window.setTimeout(function(){di(_e.accumulatingId)},50)}},{key:"doRender",value:function(ne){var _e=this;this.logger.debug("accumulatingId: ".concat(this.accumulatingId));var gt=this.rendererService,Gt=gt.clear,zt=gt.getViewportSize,Sr=gt.useFramebuffer,qr=zt(),Rn=qr.width,Gn=qr.height,Mn=ne.getLayerConfig(),di=Mn.jitterScale,yi=di===void 0?1:di,aa=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((aa[0]*2-1)/Rn*yi,(aa[1]*2-1)/Gn*yi),ne.multiPassRenderer.setRenderFlag(!1),ne.hooks.beforeRender.call(),Sr(this.sampleRenderTarget,function(){Gt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:_e.sampleRenderTarget}),ne.render()}),ne.hooks.afterRender.call(),ne.multiPassRenderer.setRenderFlag(!0);var Mi=ne.getLayerConfig();Sr(this.outputRenderTarget,function(){_e.blendModel.draw({uniforms:{u_opacity:Mi.opacity||1,u_MixRatio:_e.frame===0?1:.9,u_Diffuse1:_e.sampleRenderTarget,u_Diffuse2:_e.frame===0?ne.multiPassRenderer.getPostProcessor().getReadFBO():_e.prevRenderTarget}})}),this.frame===0&&Gt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(Sr(this.copyRenderTarget,function(){_e.outputModel.draw({uniforms:{u_Texture:_e.outputRenderTarget}})}),Sr(ne.multiPassRenderer.getPostProcessor().getReadFBO(),function(){_e.copyModel.draw({uniforms:{u_Texture:_e.copyRenderTarget}})}),ne.multiPassRenderer.getPostProcessor().render(ne));var Ha=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Ha,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(ne,_e,gt){this.shaderModuleService.registerModule(ne,{vs:Ws,fs:_e});var Gt=this.shaderModuleService.getModule(ne),zt=Gt.vs,Sr=Gt.fs,qr=Gt.uniforms,Rn=this.rendererService,Gn=Rn.createAttribute,Mn=Rn.createBuffer,di=Rn.createModel;return di(nl({vs:zt,fs:Sr,attributes:{a_Position:Gn({buffer:Mn({data:[-4,-4,4,-4,0,4],type:gi.gl.FLOAT}),size:2})},uniforms:nl({},qr),depth:{enable:!1},count:3},gt))}}]),M}(Qs),tl=(0,ge.Z)(Rs.prototype,"shaderModuleService",[qi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vu=(0,ge.Z)(Rs.prototype,"logger",[ao],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rs))||ko),Sl=new b.W2;Sl.bind(W.v.IGlobalConfigService).to(Se).inSingletonScope(),Sl.bind(W.v.IShaderModuleService).to(Qu).inSingletonScope(),Sl.bind(W.v.ILogService).to(Pc).inSingletonScope(),(0,b.GW)((0,b.b2)(),E.EventEmitter),Sl.bind(W.v.IEventEmitter).to(E.EventEmitter);var uf=(0,X.Z)(Sl,!1),Wc=function(z){var M=uf.lazyInject(z);return function(D,ne,_e){M.call(this,D,ne),_e&&(_e.initializer=function(){return D[ne]})}},Wf=function(z){var M=uf.lazyMultiInject(z);return function(D,ne,_e){M.call(this,D,ne),_e&&(_e.initializer=function(){return D[ne]})}},Hl=Sl,ih=0;function lf(){var j=new b.W2;return j.parent=Sl,j.bind(W.v.SceneID).toConstantValue("".concat(ih++)),j.bind(W.v.ILayerService).to(La).inSingletonScope(),j.bind(W.v.ISceneService).to(ic).inSingletonScope(),j.bind(W.v.ICameraService).to(Ar).inSingletonScope(),j.bind(W.v.ICoordinateSystemService).to(pn).inSingletonScope(),j.bind(W.v.IInteractionService).to(_a).inSingletonScope(),j.bind(W.v.IPickingService).to(Zi).inSingletonScope(),j.bind(W.v.IControlService).to(lt).inSingletonScope(),j.bind(W.v.IMarkerService).to(or).inSingletonScope(),j.bind(W.v.IIconService).to(Yt).inSingletonScope(),j.bind(W.v.IFontService).to(Fe).inSingletonScope(),j.bind(W.v.IPopupService).to(bi).inSingletonScope(),j.bind(W.v.INormalPass).to(fu).whenTargetNamed("clear"),j.bind(W.v.INormalPass).to(oc).whenTargetNamed("pixelPicking"),j.bind(W.v.INormalPass).to(du).whenTargetNamed("render"),j.bind(W.v.INormalPass).to(Rf).whenTargetNamed("taa"),j.bind(W.v.IFactoryNormalPass).toFactory(function(z){return function(M){return z.container.getNamed(W.v.INormalPass,M)}}),j.bind(W.v.IPostProcessingPass).to(it).whenTargetNamed("copy"),j.bind(W.v.IPostProcessingPass).to(yl).whenTargetNamed("blurH"),j.bind(W.v.IPostProcessingPass).to(u).whenTargetNamed("blurV"),j.bind(W.v.IPostProcessingPass).to(Zo).whenTargetNamed("noise"),j.bind(W.v.IPostProcessingPass).to(eu).whenTargetNamed("sepia"),j.bind(W.v.IPostProcessingPass).to(ve).whenTargetNamed("colorHalftone"),j.bind(W.v.IPostProcessingPass).to(yn).whenTargetNamed("hexagonalPixelate"),j.bind(W.v.IPostProcessingPass).to(oi).whenTargetNamed("ink"),j.bind(W.v.IFactoryPostProcessingPass).toFactory(function(z){return function(M){var D=z.container.getNamed(W.v.IPostProcessingPass,M);return D.setName(M),D}}),j}function ru(j){var z=new b.W2;return z.parent=j,z.bind(W.v.IStyleAttributeService).to(Ol).inSingletonScope(),z.bind(W.v.IMultiPassRenderer).to(ku).inSingletonScope(),z.bind(W.v.IPostProcessor).to(Tu).inSingletonScope(),z}},2811:function(){},64532:function(){},4594:function(ar,O,_){"use strict";_.d(O,{l:function(){return Q}});var Q={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"}},66690:function(ar,O,_){"use strict";_.d(O,{d:function(){return Q}});var Q;(function(E){E.TOPRIGHT="topright",E.TOPLEFT="topleft",E.BOTTOMRIGHT="bottomright",E.BOTTOMLEFT="bottomleft"})(Q||(Q={}))},81732:function(){},84007:function(){},1910:function(){},47282:function(ar,O,_){"use strict";_.d(O,{l:function(){return Q},k:function(){return E}});var Q;(function(p){p[p.LNGLAT=1]="LNGLAT",p[p.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",p[p.VECTOR_TILE=3]="VECTOR_TILE",p[p.IDENTITY=4]="IDENTITY",p[p.P20=5]="P20",p[p.P20_OFFSET=6]="P20_OFFSET",p[p.METER_OFFSET=7]="METER_OFFSET",p[p.P20_2=8]="P20_2"})(Q||(Q={}));var E={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"}},89648:function(ar,O,_){"use strict";_.d(O,{s:function(){return Q}});var Q;(function(E){E.Hover="hover",E.Click="click",E.Select="select",E.Active="active",E.Drag="drag"})(Q||(Q={}))},90919:function(){},77252:function(ar,O,_){"use strict";_.d(O,{h:function(){return Q}});var Q;(function(E){E.normal="normal",E.additive="additive",E.subtractive="subtractive",E.min="min",E.max="max",E.none="none"})(Q||(Q={}))},31251:function(ar,O,_){"use strict";_.d(O,{vY:function(){return Q},ee:function(){return E},GC:function(){return p}});var Q;(function(b){b.LINEAR="linear",b.POWER="power",b.LOG="log",b.IDENTITY="identity",b.TIME="time",b.QUANTILE="quantile",b.QUANTIZE="quantize",b.THRESHOLD="threshold",b.CAT="cat"})(Q||(Q={}));var E;(function(b){b.CONSTANT="constant",b.VARIABLE="variable"})(E||(E={}));var p;(function(b){b[b.Attribute=0]="Attribute",b[b.InstancedAttribute=1]="InstancedAttribute",b[b.Uniform=2]="Uniform"})(p||(p={}))},79042:function(){},16606:function(ar,O,_){"use strict";_.d(O,{I:function(){return Q}});var Q=["mapload"]},75925:function(){},85040:function(){},8594:function(){},67571:function(){},66718:function(){},92364:function(ar,O,_){"use strict";_.d(O,{G:function(){return Q}});var Q;(function(E){E.Normal="normal",E.PostProcessing="post-processing"})(Q||(Q={}))},78010:function(){},41906:function(){},68116:function(){},23067:function(){},7648:function(ar,O,_){"use strict";_.d(O,{gl:function(){return Q}});var Q;(function(E){E[E.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",E[E.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",E[E.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",E[E.POINTS=0]="POINTS",E[E.LINES=1]="LINES",E[E.LINE_LOOP=2]="LINE_LOOP",E[E.LINE_STRIP=3]="LINE_STRIP",E[E.TRIANGLES=4]="TRIANGLES",E[E.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",E[E.TRIANGLE_FAN=6]="TRIANGLE_FAN",E[E.ZERO=0]="ZERO",E[E.ONE=1]="ONE",E[E.SRC_COLOR=768]="SRC_COLOR",E[E.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",E[E.SRC_ALPHA=770]="SRC_ALPHA",E[E.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",E[E.DST_ALPHA=772]="DST_ALPHA",E[E.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",E[E.DST_COLOR=774]="DST_COLOR",E[E.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",E[E.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",E[E.FUNC_ADD=32774]="FUNC_ADD",E[E.BLEND_EQUATION=32777]="BLEND_EQUATION",E[E.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",E[E.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",E[E.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",E[E.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",E[E.MAX_EXT=32776]="MAX_EXT",E[E.MIN_EXT=32775]="MIN_EXT",E[E.BLEND_DST_RGB=32968]="BLEND_DST_RGB",E[E.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",E[E.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",E[E.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",E[E.CONSTANT_COLOR=32769]="CONSTANT_COLOR",E[E.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",E[E.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",E[E.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",E[E.BLEND_COLOR=32773]="BLEND_COLOR",E[E.ARRAY_BUFFER=34962]="ARRAY_BUFFER",E[E.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",E[E.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",E[E.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",E[E.STREAM_DRAW=35040]="STREAM_DRAW",E[E.STATIC_DRAW=35044]="STATIC_DRAW",E[E.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",E[E.BUFFER_SIZE=34660]="BUFFER_SIZE",E[E.BUFFER_USAGE=34661]="BUFFER_USAGE",E[E.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",E[E.FRONT=1028]="FRONT",E[E.BACK=1029]="BACK",E[E.FRONT_AND_BACK=1032]="FRONT_AND_BACK",E[E.CULL_FACE=2884]="CULL_FACE",E[E.BLEND=3042]="BLEND",E[E.DITHER=3024]="DITHER",E[E.STENCIL_TEST=2960]="STENCIL_TEST",E[E.DEPTH_TEST=2929]="DEPTH_TEST",E[E.SCISSOR_TEST=3089]="SCISSOR_TEST",E[E.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",E[E.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",E[E.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",E[E.NO_ERROR=0]="NO_ERROR",E[E.INVALID_ENUM=1280]="INVALID_ENUM",E[E.INVALID_VALUE=1281]="INVALID_VALUE",E[E.INVALID_OPERATION=1282]="INVALID_OPERATION",E[E.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",E[E.CW=2304]="CW",E[E.CCW=2305]="CCW",E[E.LINE_WIDTH=2849]="LINE_WIDTH",E[E.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",E[E.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",E[E.CULL_FACE_MODE=2885]="CULL_FACE_MODE",E[E.FRONT_FACE=2886]="FRONT_FACE",E[E.DEPTH_RANGE=2928]="DEPTH_RANGE",E[E.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",E[E.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",E[E.DEPTH_FUNC=2932]="DEPTH_FUNC",E[E.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",E[E.STENCIL_FUNC=2962]="STENCIL_FUNC",E[E.STENCIL_FAIL=2964]="STENCIL_FAIL",E[E.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",E[E.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",E[E.STENCIL_REF=2967]="STENCIL_REF",E[E.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",E[E.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",E[E.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",E[E.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",E[E.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",E[E.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",E[E.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",E[E.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",E[E.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",E[E.VIEWPORT=2978]="VIEWPORT",E[E.SCISSOR_BOX=3088]="SCISSOR_BOX",E[E.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",E[E.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",E[E.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",E[E.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",E[E.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",E[E.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",E[E.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",E[E.RED_BITS=3410]="RED_BITS",E[E.GREEN_BITS=3411]="GREEN_BITS",E[E.BLUE_BITS=3412]="BLUE_BITS",E[E.ALPHA_BITS=3413]="ALPHA_BITS",E[E.DEPTH_BITS=3414]="DEPTH_BITS",E[E.STENCIL_BITS=3415]="STENCIL_BITS",E[E.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",E[E.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",E[E.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",E[E.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",E[E.SAMPLES=32937]="SAMPLES",E[E.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",E[E.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",E[E.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",E[E.DONT_CARE=4352]="DONT_CARE",E[E.FASTEST=4353]="FASTEST",E[E.NICEST=4354]="NICEST",E[E.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",E[E.BYTE=5120]="BYTE",E[E.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",E[E.SHORT=5122]="SHORT",E[E.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",E[E.INT=5124]="INT",E[E.UNSIGNED_INT=5125]="UNSIGNED_INT",E[E.FLOAT=5126]="FLOAT",E[E.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",E[E.ALPHA=6406]="ALPHA",E[E.RGB=6407]="RGB",E[E.RGBA=6408]="RGBA",E[E.LUMINANCE=6409]="LUMINANCE",E[E.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",E[E.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",E[E.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",E[E.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",E[E.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",E[E.VERTEX_SHADER=35633]="VERTEX_SHADER",E[E.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",E[E.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",E[E.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",E[E.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",E[E.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",E[E.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",E[E.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",E[E.SHADER_TYPE=35663]="SHADER_TYPE",E[E.DELETE_STATUS=35712]="DELETE_STATUS",E[E.LINK_STATUS=35714]="LINK_STATUS",E[E.VALIDATE_STATUS=35715]="VALIDATE_STATUS",E[E.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",E[E.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",E[E.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",E[E.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",E[E.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",E[E.NEVER=512]="NEVER",E[E.LESS=513]="LESS",E[E.EQUAL=514]="EQUAL",E[E.LEQUAL=515]="LEQUAL",E[E.GREATER=516]="GREATER",E[E.NOTEQUAL=517]="NOTEQUAL",E[E.GEQUAL=518]="GEQUAL",E[E.ALWAYS=519]="ALWAYS",E[E.KEEP=7680]="KEEP",E[E.REPLACE=7681]="REPLACE",E[E.INCR=7682]="INCR",E[E.DECR=7683]="DECR",E[E.INVERT=5386]="INVERT",E[E.INCR_WRAP=34055]="INCR_WRAP",E[E.DECR_WRAP=34056]="DECR_WRAP",E[E.VENDOR=7936]="VENDOR",E[E.RENDERER=7937]="RENDERER",E[E.VERSION=7938]="VERSION",E[E.NEAREST=9728]="NEAREST",E[E.LINEAR=9729]="LINEAR",E[E.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",E[E.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",E[E.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",E[E.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",E[E.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",E[E.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",E[E.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",E[E.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",E[E.TEXTURE_2D=3553]="TEXTURE_2D",E[E.TEXTURE=5890]="TEXTURE",E[E.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",E[E.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",E[E.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",E[E.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",E[E.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",E[E.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",E[E.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",E[E.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",E[E.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",E[E.TEXTURE0=33984]="TEXTURE0",E[E.TEXTURE1=33985]="TEXTURE1",E[E.TEXTURE2=33986]="TEXTURE2",E[E.TEXTURE3=33987]="TEXTURE3",E[E.TEXTURE4=33988]="TEXTURE4",E[E.TEXTURE5=33989]="TEXTURE5",E[E.TEXTURE6=33990]="TEXTURE6",E[E.TEXTURE7=33991]="TEXTURE7",E[E.TEXTURE8=33992]="TEXTURE8",E[E.TEXTURE9=33993]="TEXTURE9",E[E.TEXTURE10=33994]="TEXTURE10",E[E.TEXTURE11=33995]="TEXTURE11",E[E.TEXTURE12=33996]="TEXTURE12",E[E.TEXTURE13=33997]="TEXTURE13",E[E.TEXTURE14=33998]="TEXTURE14",E[E.TEXTURE15=33999]="TEXTURE15",E[E.TEXTURE16=34e3]="TEXTURE16",E[E.TEXTURE17=34001]="TEXTURE17",E[E.TEXTURE18=34002]="TEXTURE18",E[E.TEXTURE19=34003]="TEXTURE19",E[E.TEXTURE20=34004]="TEXTURE20",E[E.TEXTURE21=34005]="TEXTURE21",E[E.TEXTURE22=34006]="TEXTURE22",E[E.TEXTURE23=34007]="TEXTURE23",E[E.TEXTURE24=34008]="TEXTURE24",E[E.TEXTURE25=34009]="TEXTURE25",E[E.TEXTURE26=34010]="TEXTURE26",E[E.TEXTURE27=34011]="TEXTURE27",E[E.TEXTURE28=34012]="TEXTURE28",E[E.TEXTURE29=34013]="TEXTURE29",E[E.TEXTURE30=34014]="TEXTURE30",E[E.TEXTURE31=34015]="TEXTURE31",E[E.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",E[E.REPEAT=10497]="REPEAT",E[E.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",E[E.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",E[E.FLOAT_VEC2=35664]="FLOAT_VEC2",E[E.FLOAT_VEC3=35665]="FLOAT_VEC3",E[E.FLOAT_VEC4=35666]="FLOAT_VEC4",E[E.INT_VEC2=35667]="INT_VEC2",E[E.INT_VEC3=35668]="INT_VEC3",E[E.INT_VEC4=35669]="INT_VEC4",E[E.BOOL=35670]="BOOL",E[E.BOOL_VEC2=35671]="BOOL_VEC2",E[E.BOOL_VEC3=35672]="BOOL_VEC3",E[E.BOOL_VEC4=35673]="BOOL_VEC4",E[E.FLOAT_MAT2=35674]="FLOAT_MAT2",E[E.FLOAT_MAT3=35675]="FLOAT_MAT3",E[E.FLOAT_MAT4=35676]="FLOAT_MAT4",E[E.SAMPLER_2D=35678]="SAMPLER_2D",E[E.SAMPLER_CUBE=35680]="SAMPLER_CUBE",E[E.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",E[E.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",E[E.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",E[E.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",E[E.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",E[E.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",E[E.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",E[E.COMPILE_STATUS=35713]="COMPILE_STATUS",E[E.LOW_FLOAT=36336]="LOW_FLOAT",E[E.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",E[E.HIGH_FLOAT=36338]="HIGH_FLOAT",E[E.LOW_INT=36339]="LOW_INT",E[E.MEDIUM_INT=36340]="MEDIUM_INT",E[E.HIGH_INT=36341]="HIGH_INT",E[E.FRAMEBUFFER=36160]="FRAMEBUFFER",E[E.RENDERBUFFER=36161]="RENDERBUFFER",E[E.RGBA4=32854]="RGBA4",E[E.RGB5_A1=32855]="RGB5_A1",E[E.RGB565=36194]="RGB565",E[E.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",E[E.STENCIL_INDEX=6401]="STENCIL_INDEX",E[E.STENCIL_INDEX8=36168]="STENCIL_INDEX8",E[E.DEPTH_STENCIL=34041]="DEPTH_STENCIL",E[E.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",E[E.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",E[E.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",E[E.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",E[E.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",E[E.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",E[E.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",E[E.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",E[E.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",E[E.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",E[E.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",E[E.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",E[E.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",E[E.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",E[E.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",E[E.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",E[E.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",E[E.NONE=0]="NONE",E[E.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",E[E.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",E[E.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",E[E.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",E[E.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",E[E.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",E[E.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",E[E.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",E[E.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",E[E.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",E[E.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",E[E.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",E[E.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",E[E.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(Q||(Q={}))},69530:function(ar,O,_){"use strict";_.d(O,{Z:function(){return Ne}});var Q=_(55770),E=_(6610),p=_(5991),b=_(96156),X=_(3473),W=_(11700),$=_.n(W),I=_(14293),k=_.n(I),Ce=_(68929),Be=_.n(Ce),We=_(86700),$e=_(58881),Vt=_(72302),Ht=_(92364),At,Ot,bt,dt,Pr;function er(Qe,Ie){var Ae=Object.keys(Qe);if(Object.getOwnPropertySymbols){var Ue=Object.getOwnPropertySymbols(Qe);Ie&&(Ue=Ue.filter(function(St){return Object.getOwnPropertyDescriptor(Qe,St).enumerable})),Ae.push.apply(Ae,Ue)}return Ae}function Ft(Qe){for(var Ie=1;Ie<arguments.length;Ie++){var Ae=arguments[Ie]!=null?arguments[Ie]:{};Ie%2?er(Object(Ae),!0).forEach(function(Ue){(0,b.Z)(Qe,Ue,Ae[Ue])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Qe,Object.getOwnPropertyDescriptors(Ae)):er(Object(Ae)).forEach(function(Ue){Object.defineProperty(Qe,Ue,Object.getOwnPropertyDescriptor(Ae,Ue))})}return Qe}var tt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ne=(At=(0,We.b2)(),Ot=(0,We.f3)(Vt.v.IShaderModuleService),At(bt=(dt=function(){function Qe(){(0,E.Z)(this,Qe),(0,Q.Z)(this,"shaderModuleService",Pr,this),(0,b.Z)(this,"rendererService",void 0),(0,b.Z)(this,"config",void 0),(0,b.Z)(this,"quad",tt),(0,b.Z)(this,"enabled",!0),(0,b.Z)(this,"renderToScreen",!1),(0,b.Z)(this,"model",void 0),(0,b.Z)(this,"name",void 0),(0,b.Z)(this,"optionsToUpdate",{})}return(0,p.Z)(Qe,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(Ae){this.name=Ae}},{key:"getType",value:function(){return Ht.G.PostProcessing}},{key:"init",value:function(Ae,Ue){this.config=Ue,this.rendererService=Ae.getContainer().get(Vt.v.IRendererService);var St=this.rendererService,ur=St.createAttribute,ae=St.createBuffer,Te=St.createModel,oe=this.setupShaders(),me=oe.vs,Me=oe.fs,qe=oe.uniforms;this.model=Te({vs:me,fs:Me,attributes:{a_Position:ur({buffer:ae({data:[-4,-4,4,-4,0,4],type:$e.gl.FLOAT}),size:2})},uniforms:Ft(Ft({u_Texture:null},qe),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(Ae){var Ue=this,St=Ae.multiPassRenderer.getPostProcessor(),ur=this.rendererService,ae=ur.useFramebuffer,Te=ur.getViewportSize,oe=ur.clear,me=Te(),Me=me.width,qe=me.height;ae(this.renderToScreen?null:St.getWriteFBO(),function(){oe({framebuffer:St.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),Ue.model.draw({uniforms:Ft({u_Texture:St.getReadFBO(),u_ViewportSize:[Me,qe]},Ue.convertOptionsToUniforms(Ue.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(Ae){this.enabled=Ae}},{key:"setRenderToScreen",value:function(Ae){this.renderToScreen=Ae}},{key:"updateOptions",value:function(Ae){this.optionsToUpdate=Ft(Ft({},this.optionsToUpdate),Ae)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(Ae){var Ue={};return Object.keys(Ae).forEach(function(St){k()(Ae[St])||(Ue["u_".concat($()(Be()(St)))]=Ae[St])}),Ue}}]),Qe}(),Pr=(0,X.Z)(dt.prototype,"shaderModuleService",[Ot],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dt))||bt)},19793:function(ar,O,_){"use strict";_.d(O,{P:function(){return Q}});var Q=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"]},93102:function(){},8628:function(){},72302:function(ar,O,_){"use strict";_.d(O,{v:function(){return Q}});var Q={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),ILogService:Symbol.for("ILogService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")}},76915:function(ar,O,_){"use strict";var Q=_(74691),E=null;function p(Ie){return E.indexOf(Ie)}var b=2,X=4,W=64,$=128,I=256,k=512,Ce=8192,Be=16384,We=32768,$e=null,Vt=131072,Ht=262144,At=524288,Ot=1048576,bt=2097152,dt=4194304,Pr=8388608,er=16777216,Ft=null;function tt(Ie,Ae){return Ie=_clamp(Math.floor(Ie),0,255),Ae=_clamp(Math.floor(Ae),0,255),256*Ie+Ae}function Ne(Ie){var Ae=Ie.color,Ue=Ie.radius,St=Ie.tileX,ur=Ie.tileY,ae=Ie.shape,Te=Ie.opacity,oe=Ie.stroke,me=Ie.strokeWidth,Me=Ie.strokeOpacity,qe=[],yt=[],Qt=[],Or=[tt(Ae[0],Ae[1]),tt(Ae[2],Ae[3])],Dr=[tt(oe[0],oe[1]),tt(oe[2],oe[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(on){var tr=_slicedToArray(on,2),se=tr[0],be=tr[1];qe.push([].concat(Or,[(se+1)*Pr+(be+1)*bt+getShapeIndex(ae)*Vt+Ue,(St+512)*At+(ur+512)*W])),yt.push([].concat(Dr,[me,Me])),Qt.push([Te,0,0,0])}),{packedBuffer:qe,packedBuffer2:yt,packedBuffer3:Qt}}function Qe(Ie,Ae){if(Ie===0&&!Ae)return 0;if(Ie===1&&Ae)return 4294967295;var Ue=Ae?1:0,St=Math.floor(Ie*127);return St*Ft+Ue*er+St*Vt+Ue*$e+St*k+Ue*I+St*b+Ue}},66275:function(ar,O,_){"use strict";_.d(O,{zP:function(){return Qy},JE:function(){return Qg},ns:function(){return Jy}});var Q=_(67294),E=(0,Q.createContext)({});function p(){return(0,Q.useContext)(E)}var b=_(58881),X=_(28481),W=_(6610),$=_(5991),I=_(96156),k=_(63349),Ce=_(10379),Be=_(46070),We=_(77608),$e=_(6901),Vt=_(26729);function Ht(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function At(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Ht(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Ht(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function Ot(n){var c=bt();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function bt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var dt;(function(n){n.TOPRIGHT="topright",n.TOPLEFT="topleft",n.BOTTOMRIGHT="bottomright",n.BOTTOMLEFT="bottomleft"})(dt||(dt={}));var Pr=0,er=function(n){(0,Ce.Z)(o,n);var c=Ot(o);function o(s){var l;return(0,W.Z)(this,o),l=c.call(this),(0,I.Z)((0,k.Z)(l),"controlOption",void 0),(0,I.Z)((0,k.Z)(l),"container",void 0),(0,I.Z)((0,k.Z)(l),"sceneContainer",void 0),(0,I.Z)((0,k.Z)(l),"mapsService",void 0),(0,I.Z)((0,k.Z)(l),"renderService",void 0),(0,I.Z)((0,k.Z)(l),"layerService",void 0),(0,I.Z)((0,k.Z)(l),"controlService",void 0),(0,I.Z)((0,k.Z)(l),"isShow",void 0),l.controlOption=At(At({},l.getDefault()),s||{}),l}return(0,$.Z)(o,[{key:"getDefault",value:function(){return{position:dt.TOPRIGHT,name:"".concat(Pr++)}}},{key:"setPosition",value:function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"bottomright",d=this.controlService;return d&&d.removeControl(this),this.controlOption.position=l,d&&d.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(l){this.mapsService=l.get(b.vK.IMapService),this.renderService=l.get(b.vK.IRendererService),this.layerService=l.get(b.vK.ILayerService),this.controlService=l.get(b.vK.IControlService),this.sceneContainer=l,this.isShow=!0,this.container=this.onAdd();var d=this.container,y=this.controlOption.position,C=this.controlService.controlCorners[y];return $e.SO.addClass(d,"l7-control"),y.indexOf("bottom")!==-1?C.insertBefore(d,C.firstChild):C.appendChild(d),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var l=this.container;$e.SO.addClass(l,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var l=this.container;$e.SO.removeClass(l,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;$e.SO.remove(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(l){if(this.mapsService&&l&&l.screenX>0&&l.screenY>0){var d=this.mapsService.getContainer();d!==null&&d.focus()}}}]),o}(Vt.EventEmitter);function Ft(n){var c=tt();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function tt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ne=function(n){(0,Ce.Z)(o,n);var c=Ft(o);function o(s){var l;return(0,W.Z)(this,o),l=c.call(this,s),(0,I.Z)((0,k.Z)(l),"layerControlInputs",void 0),(0,I.Z)((0,k.Z)(l),"layers",void 0),(0,I.Z)((0,k.Z)(l),"lastZIndex",void 0),(0,I.Z)((0,k.Z)(l),"handlingClick",void 0),(0,I.Z)((0,k.Z)(l),"layersLink",void 0),(0,I.Z)((0,k.Z)(l),"baseLayersList",void 0),(0,I.Z)((0,k.Z)(l),"separator",void 0),(0,I.Z)((0,k.Z)(l),"overlaysList",void 0),(0,I.Z)((0,k.Z)(l),"form",void 0),l.layerControlInputs=[],l.layers=[],l.lastZIndex=0,l.handlingClick=!1,l.initLayers(),(0,$e.Ev)(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,k.Z)(l)),l}return(0,$.Z)(o,[{key:"getDefault",value:function(){return{collapsed:!0,position:b.PositionType.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var l=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(d){d.layer.on("remove",l.onLayerChange),d.layer.on("add",l.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(l,d){return this.addLayer(l,d,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var l=this.renderService.getViewportSize(),d=l.height;$e.SO.addClass(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var y=d-(this.container.offsetTop+50);return y<this.form.clientHeight?($e.SO.addClass(this.form,"l7-control-layers-scrollbar"),this.form.style.height=y+"px"):$e.SO.removeClass(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return $e.SO.removeClass(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var l=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(d){d.layer.off("remove",l.onLayerChange),d.layer.off("add",l.onLayerChange)}))}},{key:"initLayout",value:function(){var l="l7-control-layers",d=this.container=$e.SO.create("div",l),y=this.controlOption.collapsed;d.setAttribute("aria-haspopup","true");var C=this.form=$e.SO.create("form",l+"-list");y&&(this.mapsService.on("click",this.collapse),d.addEventListener("mouseenter",this.expand),d.addEventListener("mouseleave",this.collapse)),this.layersLink=$e.SO.create("a",l+"-toggle",d);var P=this.layersLink;P.title="Layers",y||this.expand(),this.baseLayersList=$e.SO.create("div",l+"-base",C),this.separator=$e.SO.create("div",l+"-separator",C),this.overlaysList=$e.SO.create("div",l+"-overlays",C),d.appendChild(C)}},{key:"initLayers",value:function(){var l=this,d=this.controlOption,y=d.baseLayers,C=y===void 0?{}:y,P=d.overlayers,L=P===void 0?{}:P;Object.keys(C).forEach(function(J,Y){l.addLayer(C[J],J,!1)}),Object.keys(L).forEach(function(J,Y){l.addLayer(L[J],J,!0)})}},{key:"update",value:function(){if(!this.container)return this;$e.SO.empty(this.baseLayersList),$e.SO.empty(this.overlaysList),this.layerControlInputs=[];var l,d,y,C,P=0;for(y=0;y<this.layers.length;y++)C=this.layers[y],this.addItem(C),d=d||C.overlay,l=l||!C.overlay,P+=C.overlay?0:1;return this.controlOption.hideSingleBase&&(l=l&&P>1,this.baseLayersList.style.display=l?"":"none"),this.separator.style.display=d&&l?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var l=this.layerControlInputs,d,y,C=this.mapsService.getZoom(),P=l.length-1;P>=0;P--)if(d=l[P],y=this.layerService.getLayer(d.layerId),y&&y.inited){var L=y.getMinZoom(),J=y.getMaxZoom();d.disabled=C<L||C>J}}},{key:"addLayer",value:function(l,d,y){this.mapsService&&(l.on("add",this.onLayerChange),l.on("remove",this.onLayerChange)),this.layers.push({layer:l,name:d,overlay:y});var C=this.controlOption,P=C.sortLayers,L=C.sortFunction,J=C.autoZIndex;P&&this.layers.sort(function(Y,le){return L(Y.layer,le.layer,Y.name,le.name)}),J&&l.setZIndex&&(this.lastZIndex++,l.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(l){this.handlingClick||this.update();var d=this.layerService.getLayer(l.target.layerId),y=d!=null&&d.overlay?l.type==="add"?"overlayadd":"overlayremove":l.type==="add"?"baselayerchange":null;y&&this.emit(y,d)}},{key:"createRadioElement",value:function(l,d){var y='<input type="radio" class="l7-control-layers-selector" name="'+l+'"'+(d?' checked="checked"':"")+"/>",C=document.createElement("div");return C.innerHTML=y,C.firstChild}},{key:"addItem",value:function(l){var d=document.createElement("label"),y=this.layerService.getLayer(l.layer.id),C=y&&y.inited&&l.layer.isVisible(),P;l.overlay?(P=document.createElement("input"),P.type="checkbox",P.className="l7-control-layers-selector",P.defaultChecked=C):P=this.createRadioElement("l7-base-layers",C),this.layerControlInputs.push(P),P.layerId=l.layer.id,P.addEventListener("click",this.onInputClick);var L=document.createElement("span");L.innerHTML=" "+l.name;var J=document.createElement("div");d.appendChild(J),J.appendChild(P),J.appendChild(L);var Y=l.overlay?this.overlaysList:this.baseLayersList;return Y.appendChild(d),this.checkDisabledLayers(),d}},{key:"onInputClick",value:function(){var l=this.layerControlInputs,d,y,C=[],P=[];this.handlingClick=!0;for(var L=l.length-1;L>=0;L--)d=l[L],y=this.layerService.getLayer(d.layerId),d.checked?C.push(y):d.checked||P.push(y);P.forEach(function(J){J.hide()}),C.forEach(function(J){J.show()}),this.handlingClick=!1}}]),o}(er);function Qe(n){var c=Ie();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Ie(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ae=function(n){(0,Ce.Z)(o,n);var c=Qe(o);function o(){return(0,W.Z)(this,o),c.apply(this,arguments)}return(0,$.Z)(o,[{key:"getDefault",value:function(){return{position:dt.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var l="l7-control-logo",d=$e.SO.create("div",l),y=$e.SO.create("a","l7-ctrl-logo");return y.target="_blank",y.rel="noopener nofollow",y.href="https://antv.alipay.com/l7",y.setAttribute("aria-label","AntV logo"),y.setAttribute("rel","noopener nofollow"),d.appendChild(y),d}},{key:"onRemove",value:function(){return null}}]),o}(er);function Ue(n){var c=St();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function St(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ur=function(n){(0,Ce.Z)(o,n);var c=Ue(o);function o(s){var l;return(0,W.Z)(this,o),l=c.call(this,s),(0,I.Z)((0,k.Z)(l),"mScale",void 0),(0,I.Z)((0,k.Z)(l),"iScale",void 0),(0,$e.Ev)(["update"],(0,k.Z)(l)),l}return(0,$.Z)(o,[{key:"getDefault",value:function(){return{position:dt.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var l="l7-control-scale",d=$e.SO.create("div",l);this.addScales(l+"-line",d);var y=this.controlOption.updateWhenIdle;return this.mapsService.on(y?"moveend":"mapmove",this.update),this.mapsService.on(y?"zoomend":"zoomchange",this.update),this.update(),d}},{key:"onRemove",value:function(){var l=this.controlOption.updateWhenIdle;this.mapsService.off(l?"zoomend":"zoomchange",this.update),this.mapsService.off(l?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var l=this.mapsService,d=this.controlOption.maxWidth,y=l.getSize()[1]/2,C=l.containerToLngLat([0,y]),P=l.containerToLngLat([d,y]),L=(0,$e.yM)([C.lng,C.lat],[P.lng,P.lat]);this.updateScales(L)}},{key:"updateScales",value:function(l){var d=this.controlOption,y=d.metric,C=d.imperial;y&&l&&this.updateMetric(l),C&&l&&this.updateImperial(l)}},{key:"updateMetric",value:function(l){var d=this.getRoundNum(l),y=d<1e3?d+" m":d/1e3+" km";this.updateScale(this.mScale,y,d/l)}},{key:"updateImperial",value:function(l){var d=l*3.2808399,y,C,P;d>5280?(y=d/5280,C=this.getRoundNum(y),this.updateScale(this.iScale,C+" mi",C/y)):(P=this.getRoundNum(d),this.updateScale(this.iScale,P+" ft",P/d))}},{key:"updateScale",value:function(l,d,y){var C=this.controlOption.maxWidth;l.style.width=Math.round(C*y)+"px",l.innerHTML=d}},{key:"getRoundNum",value:function(l){var d=Math.pow(10,(Math.floor(l)+"").length-1),y=l/d;return y=y>=10?10:y>=5?5:y>=3?3:y>=2?2:1,d*y}},{key:"addScales",value:function(l,d){var y=this.controlOption,C=y.metric,P=y.imperial;C&&(this.mScale=$e.SO.create("div",l,d)),P&&(this.iScale=$e.SO.create("div",l,d))}}]),o}(er);function ae(n){var c=Te();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Te(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var oe=function(n){(0,Ce.Z)(o,n);var c=ae(o);function o(s){var l;return(0,W.Z)(this,o),l=c.call(this,s),(0,I.Z)((0,k.Z)(l),"disabled",void 0),(0,I.Z)((0,k.Z)(l),"zoomInButton",void 0),(0,I.Z)((0,k.Z)(l),"zoomOutButton",void 0),(0,$e.Ev)(["updateDisabled","zoomIn","zoomOut"],(0,k.Z)(l)),l}return(0,$.Z)(o,[{key:"getDefault",value:function(){return{position:dt.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var l="l7-control-zoom",d=$e.SO.create("div",l+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,l+"-in",d,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,l+"-out",d,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),d}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(l,d,y,C,P){var L=$e.SO.create("a",y,C);return L.innerHTML=l,L.title=d,L.href="javascript:void(0)",L.addEventListener("click",P),L}},{key:"updateDisabled",value:function(){var l=this.mapsService,d="l7-disabled";$e.SO.removeClass(this.zoomInButton,d),$e.SO.removeClass(this.zoomOutButton,d),(this.disabled||l.getZoom()<=l.getMinZoom())&&$e.SO.addClass(this.zoomOutButton,d),(this.disabled||l.getZoom()>=l.getMaxZoom())&&$e.SO.addClass(this.zoomInButton,d)}}]),o}(er);function me(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function Me(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?me(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):me(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function qe(n){var c=yt();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function yt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Qt=function(n){(0,Ce.Z)(o,n);var c=qe(o);function o(s){var l;return(0,W.Z)(this,o),l=c.call(this),(0,I.Z)((0,k.Z)(l),"markerOption",void 0),(0,I.Z)((0,k.Z)(l),"defaultMarker",void 0),(0,I.Z)((0,k.Z)(l),"popup",void 0),(0,I.Z)((0,k.Z)(l),"mapsService",void 0),(0,I.Z)((0,k.Z)(l),"sceneSerive",void 0),(0,I.Z)((0,k.Z)(l),"lngLat",void 0),(0,I.Z)((0,k.Z)(l),"scene",void 0),(0,I.Z)((0,k.Z)(l),"added",!1),(0,I.Z)((0,k.Z)(l),"eventHandle",function(d){l.emit(d.type,{target:d,data:l.markerOption.extData,lngLat:l.lngLat})}),l.markerOption=Me(Me({},l.getDefault()),s),(0,$e.Ev)(["update","onMove","onUp","addDragHandler","onMapClick"],(0,k.Z)(l)),l.init(),l}return(0,$.Z)(o,[{key:"getDefault",value:function(){return{element:void 0,anchor:$e.bV.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(l){this.scene=l,this.mapsService=l.get(b.vK.IMapService),this.sceneSerive=l.get(b.vK.ISceneService);var d=this.markerOption,y=d.element,C=d.draggable;return this.mapsService.getMarkerContainer().appendChild(y),this.registerMarkerEvent(y),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var l=this.markerOption.element;return l&&$e.SO.remove(l),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(l){var d=this;if(!this.added)return this.once("added",function(){d.setElement(l)}),this;var y=this.markerOption.element;return y&&$e.SO.remove(y),this.markerOption.element=l,this.init(),this.mapsService.getMarkerContainer().appendChild(l),this.registerMarkerEvent(l),this.update(),this}},{key:"openPopup",value:function(){var l=this;if(!this.added)return this.once("added",function(){l.openPopup()}),this;var d=this.popup;return d?(d.isOpen()||d.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var l=this;this.added||this.once("added",function(){l.closePopup()});var d=this.popup;return d&&d.remove(),this}},{key:"setPopup",value:function(l){return this.popup=l,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var l=this.popup;if(l)l.isOpen()?l.remove():l.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(l){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(l){this.markerOption.extData=l}},{key:"update",value:function(){if(!!this.mapsService){var l=this.markerOption,d=l.element,y=l.anchor;this.updatePosition(),$e.SO.setTransform(d,"".concat($e.rQ[y]))}}},{key:"onMapClick",value:function(l){var d=this.markerOption.element;this.popup&&d&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.markerOption,d=l.element,y=l.offsets,C=this.lngLat,P=C.lng,L=C.lat,J=this.mapsService.getBounds(),Y=this.mapsService.lngLatToContainer([P,L]);if(d){d.style.display="block";var le=this.mapsService.getContainer(),De=0,ut=0;if(le&&(De=le.scrollWidth,ut=le.scrollHeight),Math.abs(J[0][0])>180||Math.abs(J[1][0])>180){if(Y.x>De){var Rt=this.mapsService.lngLatToContainer([P-360,L]);Y.x=Rt.x}if(Y.x<0){var mr=this.mapsService.lngLatToContainer([P+360,L]);Y.x=mr.x}}(Y.x>De||Y.x<0||Y.y>ut||Y.y<0)&&(d.style.display="none"),d.style.left=Y.x+y[0]+"px",d.style.top=Y.y-y[1]+"px"}}}},{key:"init",value:function(){var l=this,d=this.markerOption.element,y=this.markerOption,C=y.color,P=y.anchor;if(!d){this.defaultMarker=!0,d=$e.SO.create("div"),this.markerOption.element=d;var L=document.createElementNS("http://www.w3.org/2000/svg","svg");L.setAttributeNS(null,"display","block"),L.setAttributeNS(null,"height","48px"),L.setAttributeNS(null,"width","48px"),L.setAttributeNS(null,"viewBox","0 0 1024 1024");var J=document.createElementNS("http://www.w3.org/2000/svg","path");J.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),J.setAttributeNS(null,"fill",C),L.appendChild(J),d.appendChild(L)}$e.SO.addClass(d,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(Y){var le,De,ut=((le=l.markerOption)===null||le===void 0?void 0:le.style)&&((De=l.markerOption)===null||De===void 0?void 0:De.style[Y]);d&&(d.style[Y]=ut)}),d.addEventListener("click",function(Y){l.onMapClick(Y)}),d.addEventListener("click",this.eventHandle),(0,$e.zi)(d,P,"marker")}},{key:"registerMarkerEvent",value:function(l){l.addEventListener("mousemove",this.eventHandle),l.addEventListener("click",this.eventHandle),l.addEventListener("mousedown",this.eventHandle),l.addEventListener("mouseup",this.eventHandle),l.addEventListener("dblclick",this.eventHandle),l.addEventListener("contextmenu",this.eventHandle),l.addEventListener("mouseover",this.eventHandle),l.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var l=this.getElement();l.removeEventListener("mousemove",this.eventHandle),l.removeEventListener("click",this.eventHandle),l.removeEventListener("mousedown",this.eventHandle),l.removeEventListener("mouseup",this.eventHandle),l.removeEventListener("dblclick",this.eventHandle),l.removeEventListener("contextmenu",this.eventHandle),l.removeEventListener("mouseover",this.eventHandle),l.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(l){throw new Error("Method not implemented.")}},{key:"onUp",value:function(l){throw new Error("Method not implemented.")}}]),o}(Vt.EventEmitter),Or=_(82492),Dr=_.n(Or),on=_(69848),tr=_.n(on);function se(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function be(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?se(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):se(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function Fe(n){var c=Ee();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Ee(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var wt=function(n){(0,Ce.Z)(o,n);var c=Fe(o);function o(s){var l,d;return(0,W.Z)(this,o),d=c.call(this),(0,I.Z)((0,k.Z)(d),"markers",[]),(0,I.Z)((0,k.Z)(d),"markerLayerOption",void 0),(0,I.Z)((0,k.Z)(d),"clusterIndex",void 0),(0,I.Z)((0,k.Z)(d),"points",[]),(0,I.Z)((0,k.Z)(d),"clusterMarkers",[]),(0,I.Z)((0,k.Z)(d),"mapsService",void 0),(0,I.Z)((0,k.Z)(d),"scene",void 0),(0,I.Z)((0,k.Z)(d),"zoom",void 0),(0,I.Z)((0,k.Z)(d),"bbox",void 0),d.markerLayerOption=Dr()(d.getDefault(),s),(0,$e.Ev)(["update"],(0,k.Z)(d)),d.zoom=((l=d.markerLayerOption.clusterOption)===null||l===void 0?void 0:l.zoom)||-99,d}return(0,$.Z)(o,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(l){return this.scene=l,this.mapsService=l.get(b.vK.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(l){var d=this.markerLayerOption.cluster;d&&this.addPoint(l,this.markers.length),this.markers.push(l)}},{key:"removeMarker",value:function(l){this.markers.indexOf(l);var d=this.markers.indexOf(l);d>-1&&this.markers.splice(d,1)}},{key:"hide",value:function(){this.markers.map(function(l){l.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(l){l.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var l=this.markerLayerOption.cluster;return l?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var l=this;this.getMarkers().forEach(function(d){d.addTo(l.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(l){l.remove()}),this.clusterMarkers.forEach(function(l){l.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(l,d){var y=l.getLnglat(),C=y.lng,P=y.lat,L={geometry:{type:"Point",coordinates:[C,P]},properties:be(be({},l.getExtData()),{},{marker_id:d})};this.points.push(L)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var l=this.markerLayerOption.clusterOption,d=l.radius,y=l.minZoom,C=y===void 0?0:y,P=l.maxZoom;this.clusterIndex=new(tr())({radius:d,minZoom:C,maxZoom:P}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(l,d){var y=this,C=l[0].concat(l[1]),P=this.clusterIndex.getClusters(C,d);this.clusterMarkers.forEach(function(L){L.remove()}),this.clusterMarkers=[],P.forEach(function(L){var J,Y=y.markerLayerOption.clusterOption,le=Y.field,De=Y.method;if(L.properties&&(J=L.properties)!==null&&J!==void 0&&J.cluster_id){var ut,Rt=y.getLeaves((ut=L.properties)===null||ut===void 0?void 0:ut.cluster_id);if(L.properties.clusterData=Rt,le&&De){var mr=Rt==null?void 0:Rt.map(function(Ln){var ni=(0,I.Z)({},le,Ln.properties[le]);return ni}),br=$e.a5.getColumn(mr,le),Zr=$e.a5.getSatByColumn(De,br),fn="point_"+De;L.properties[fn]=Zr.toFixed(2)}}var xn=y.clusterMarker(L);y.clusterMarkers.push(xn),xn.addTo(y.scene)})}},{key:"getLeaves",value:function(l){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return l?this.clusterIndex.getLeaves(l,d,y):null}},{key:"clusterMarker",value:function(l){var d=this.markerLayerOption.clusterOption,y=d,C=y.element,P=C===void 0?this.generateElement.bind(this):C,L=new Qt({element:P(l)}).setLnglat({lng:l.geometry.coordinates[0],lat:l.geometry.coordinates[1]});return L}},{key:"normalMarker",value:function(l){var d=l.properties.marker_id;return this.markers[d]}},{key:"update",value:function(){var l=this.mapsService.getZoom(),d=this.mapsService.getBounds();(!this.bbox||Math.abs(l-this.zoom)>=1||!(0,$e.oO)(this.bbox,d))&&(this.bbox=(0,$e.yA)(d,.5),this.zoom=Math.floor(l),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(l){var d=$e.SO.create("div","l7-marker-cluster"),y=$e.SO.create("div","",d),C=$e.SO.create("span","",y),P=this.markerLayerOption.clusterOption,L=P.field,J=P.method;l.properties.point_count=l.properties.point_count||1;var Y=L&&J?l.properties["point_"+J]||l.properties[L]:l.properties.point_count;return C.textContent=Y,d}}]),o}(Vt.EventEmitter);function Bt(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function w(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Bt(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Bt(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function N(n){var c=he();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function he(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var je=function(n){(0,Ce.Z)(o,n);var c=N(o);function o(s){var l;return(0,W.Z)(this,o),l=c.call(this),(0,I.Z)((0,k.Z)(l),"popupOption",void 0),(0,I.Z)((0,k.Z)(l),"mapsService",void 0),(0,I.Z)((0,k.Z)(l),"sceneSerive",void 0),(0,I.Z)((0,k.Z)(l),"lngLat",void 0),(0,I.Z)((0,k.Z)(l),"content",void 0),(0,I.Z)((0,k.Z)(l),"closeButton",void 0),(0,I.Z)((0,k.Z)(l),"timeoutInstance",void 0),(0,I.Z)((0,k.Z)(l),"container",void 0),(0,I.Z)((0,k.Z)(l),"tip",void 0),(0,I.Z)((0,k.Z)(l),"scene",void 0),l.popupOption=w(w({},l.getdefault()),s),(0,$e.Ev)(["update","onClickClose","remove"],(0,k.Z)(l)),l}return(0,$.Z)(o,[{key:"addTo",value:function(l){var d=this;return this.mapsService=l.get(b.vK.IMapService),this.sceneSerive=l.get(b.vK.ISceneService),this.mapsService.on("camerachange",this.update),this.scene=l,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){d.mapsService.on("click",d.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(l){var d=window.document.createDocumentFragment(),y=window.document.createElement("body"),C;for(y.innerHTML=l;C=y.firstChild,!!C;)d.appendChild(C);return this.setDOMContent(d)}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.mapsService&&this.mapsService.on("camerachange",this.update),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(l){return this.setDOMContent(window.document.createTextNode(l))}},{key:"setMaxWidth",value:function(l){return this.popupOption.maxWidth=l,this.update(),this}},{key:"setDOMContent",value:function(l){return this.createContent(),this.content.appendChild(l),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&$e.SO.remove(this.content),this.content=$e.SO.create("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=$e.SO.create("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(l,d,y){var C=window.document.createElement(l);return d!==void 0&&(C.className=d),y&&y.appendChild(C),C}},{key:"removeDom",value:function(l){l.parentNode&&l.parentNode.removeChild(l)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:$e.bV.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(l){l.stopPropagation&&l.stopPropagation(),this.remove()}},{key:"update",value:function(){var l=this,d=this.lngLat,y=this.popupOption,C=y.className,P=y.maxWidth,L=y.anchor;if(!(!this.mapsService||!d||!this.content)){var J=this.mapsService.getMarkerContainer();if(!this.container&&J){this.container=this.creatDom("div","l7-popup",J),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),C&&C.split(" ").forEach(function(le){return l.container.classList.add(le)});var Y=this.popupOption.stopPropagation;Y&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(le){l.container.addEventListener(le,function(De){De.stopPropagation()})})}P&&this.container.style.maxWidth!==P&&(this.container.style.maxWidth=P),this.updatePosition(),$e.SO.setTransform(this.container,"".concat($e.rQ[L])),(0,$e.zi)(this.container,L,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.lngLat,d=l.lng,y=l.lat,C=this.popupOption.offsets,P=this.mapsService.lngLatToContainer([d,y]);this.container.style.left=P.x+C[0]+"px",this.container.style.top=P.y-C[1]+"px"}}}]),o}(Vt.EventEmitter);_(68982)(`/* @antv/l7-component */
.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
 }

.l7-marker {
	position: absolute !important;
	top: 0;
	left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px "Helvetica Neue", Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
    -webkit-flex-direction: column-reverse;
    -webkit-box-orient: vertical;
    -webkit-box-direction: reverse;
        -ms-flex-direction: column-reverse;
            flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 5px;
	}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
    -webkit-flex-direction: column;
    -webkit-box-orient: vertical;
    -webkit-box-direction: normal;
        -ms-flex-direction: column;
            flex-direction: column;
}


.l7-popup-anchor-left {
    -webkit-flex-direction: row;
    -webkit-box-orient: horizontal;
    -webkit-box-direction: normal;
        -ms-flex-direction: row;
            flex-direction: row;
}

.l7-popup-anchor-right {
    -webkit-flex-direction: row-reverse;
    -webkit-box-orient: horizontal;
    -webkit-box-direction: reverse;
        -ms-flex-direction: row-reverse;
            flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-flex;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-top: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-top: none;
	border-left: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-top: none;
	border-right: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-bottom: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-bottom: none;
	border-left: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-bottom: none;
	border-right: none;
	border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-left: none;
	border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-right: none;
	border-left-color: #fff;
}

.l7-popup-close-button {
	position: absolute;
	right: 0;
	top: 0;
	border: 0;
	padding: 0;
	font-size: 25px;
	line-height: 20px;
	border-radius: 0 3px 0 0;
	cursor: pointer;
	background-color: transparent;
}

.l7-popup-close-button:hover {
	background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
	position: relative;
	background: #fff;
	border-radius: 3px;
	-webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	padding: 10px 10px 15px;
	pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
	border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
	border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
	border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
	border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
	display: none;
}

.l7-popup-track-pointer * {
	pointer-events: none;
	-webkit-user-select: none;
	   -moz-user-select: none;
	    -ms-user-select: none;
	        user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
	display: -webkit-box;
	display: -webkit-flex;
	display: -ms-flexbox;
	display: flex;
}

.l7-map:active .l7-popup-track-pointer {
	display: none;
}


.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	border-radius: 4px;
	}
.l7-bar a,
.l7-bar a:hover {
	background-color: #fff;
	width: 30px;
	height: 30px;
  font-size: 20px;
	display: block;
	text-align: center;
	text-decoration: none;
	color: #8E9DAB;
	}
.l7-bar a,
.l7-control-layers-toggle {
	background-position: 50% 50%;
	background-repeat: no-repeat;
	display: block;
	}
.l7-bar a:hover {
	background-color: #f4f4f4;
	}
.l7-bar a:first-child {
	border-top-left-radius: 2px;
	border-top-right-radius: 2px;
	}
.l7-bar a:last-child {
	border-bottom-left-radius: 2px;
	border-bottom-right-radius: 2px;
	border-bottom: none;
	}
.l7-bar a.l7-disabled {
	cursor: default;
	background-color: #f4f4f4;
	color: #bbb;
	}


/* control positioning */

.l7-control-container {
	font: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;
}
.l7-control-hide {
	display: none;
}
.l7-control {
	position: relative;
	z-index: 800;
	pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
	pointer-events: auto;
	}
.l7-control {
	float: left;
	clear: both;
	}.l7-top,
  .l7-bottom {
    position: absolute;
    z-index: 1000;
    pointer-events: none;
    }
  .l7-top {
    top: 0;
    }
  .l7-right {
    right: 0;
    }
  .l7-bottom {
    bottom: 0;
    }
  .l7-left {
    left: 0;
    }

  .l7-control {
    float: left;
    clear: both;
    }
  .l7-right .l7-control {
    float: right;
    }
  .l7-top .l7-control {
    margin-top: 10px;
    }
  .l7-bottom .l7-control {
    margin-bottom: 10px;
    }
  .l7-left .l7-control {
    margin-left: 10px;
    }
  .l7-right .l7-control {
    margin-right: 10px;
    }

  /* attribution and scale controls */

.l7-control-container .l7-control-attribution {
	background: #fff;
	background: rgba(255, 255, 255, 0.7);
	margin: 0;
	}
.l7-control-attribution,
.l7-control-scale-line {
	padding: 0 5px;
  color: #333;
	}
.l7-control-attribution a {
	text-decoration: none;
	}
.l7-control-attribution a:hover {
	text-decoration: underline;
	}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
	}
.l7-left .l7-control-scale {
	margin-left: 5px;
	}
.l7-bottom .l7-control-scale {
	margin-bottom: 5px;
	}
.l7-control-scale-line {
	border: 2px solid #000;
  border-top: none;
  color: #000;
	line-height: 1.1;
	padding: 2px 5px 1px;
	font-size: 11px;
	white-space: nowrap;
	overflow: hidden;
	-webkit-box-sizing: border-box;
	        box-sizing: border-box;

	background: #fff;
	}
.l7-control-scale-line:not(:first-child) {
	border-top: 2px solid #777;
	border-bottom: none;
	margin-top: -2px;
	}
.l7-control-scale-line:not(:first-child):not(:last-child) {
	border-bottom: 2px solid #777;
	}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	-webkit-box-shadow: none;
	        box-shadow: none;
	}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	border: 2px solid rgba(0,0,0,0.2);
	background-clip: padding-box;
  }
  /*logo */

  .l7-ctrl-logo {
    background-size: 100% 100%;
    width: 89px;
    height: 16px;
    margin: 0 0 -3px -3px;
    display: -webkit-box;
    display: -webkit-flex;
    display: -ms-flexbox;
    display: flex;
    background-repeat: no-repeat;
    cursor: pointer;
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}


	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 2px;
	}
.l7-control-layers-toggle {
	background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
	width: 30px;
  height: 30px;
  background-size: 20px 20px;
	}

.l7-touch .l7-control-layers-toggle {
	width: 44px;
	height: 44px;
	}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
	display: none;
	}
.l7-control-layers-expanded .l7-control-layers-list {
	display: block;
	position: relative;
	}
.l7-control-layers-expanded {
	padding: 6px 10px 6px 6px;
	color: #59626B;
	background: #fff;
	}
.l7-control-layers-scrollbar {
	overflow-y: scroll;
	overflow-x: hidden;
	padding-right: 5px;
	}
.l7-control-layers-selector {
	margin-top: 2px;
	position: relative;
	top: 1px;
	}
.l7-control-layers label {
  display: block;
  padding: 8px;
  }
  .l7-control-layers label input[type="radio"],
  .l7-control-layers label input[type="checkbox"] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
	height: 0;
	border-top: 1px solid #D8D8D8;
	margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
 }
 .amap-logo{
  display: none !important;
 }
`);var et=_(92137),_t=_(87757),Ct=_.n(_t),V=_(86700),Yt=_(81550),kt=_.n(Yt),fr=function(){function n(c,o){(0,W.Z)(this,n),(0,I.Z)(this,"attribute",void 0),(0,I.Z)(this,"buffer",void 0);var s=o.buffer,l=o.offset,d=o.stride,y=o.normalized,C=o.size,P=o.divisor;this.buffer=s,this.attribute={buffer:s.get(),offset:l||0,stride:d||0,normalized:y||!1,divisor:P||0},C&&(this.attribute.size=C)}return(0,$.Z)(n,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(o){this.buffer.subData(o)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),n}(),Cr,Tr,Ar,Je,xt,ht,lr,Kr,lt,Lt,Jt,or,cn,Pn,bi=(Cr={},(0,I.Z)(Cr,b.gl.POINTS,"points"),(0,I.Z)(Cr,b.gl.LINES,"lines"),(0,I.Z)(Cr,b.gl.LINE_LOOP,"line loop"),(0,I.Z)(Cr,b.gl.LINE_STRIP,"line strip"),(0,I.Z)(Cr,b.gl.TRIANGLES,"triangles"),(0,I.Z)(Cr,b.gl.TRIANGLE_FAN,"triangle fan"),(0,I.Z)(Cr,b.gl.TRIANGLE_STRIP,"triangle strip"),Cr),Si=(Tr={},(0,I.Z)(Tr,b.gl.STATIC_DRAW,"static"),(0,I.Z)(Tr,b.gl.DYNAMIC_DRAW,"dynamic"),(0,I.Z)(Tr,b.gl.STREAM_DRAW,"stream"),Tr),Ri=(Ar={},(0,I.Z)(Ar,b.gl.BYTE,"int8"),(0,I.Z)(Ar,b.gl.UNSIGNED_INT,"int16"),(0,I.Z)(Ar,b.gl.INT,"int32"),(0,I.Z)(Ar,b.gl.UNSIGNED_BYTE,"uint8"),(0,I.Z)(Ar,b.gl.UNSIGNED_SHORT,"uint16"),(0,I.Z)(Ar,b.gl.UNSIGNED_INT,"uint32"),(0,I.Z)(Ar,b.gl.FLOAT,"float"),Ar),ia=(Je={},(0,I.Z)(Je,b.gl.ALPHA,"alpha"),(0,I.Z)(Je,b.gl.LUMINANCE,"luminance"),(0,I.Z)(Je,b.gl.LUMINANCE_ALPHA,"luminance alpha"),(0,I.Z)(Je,b.gl.RGB,"rgb"),(0,I.Z)(Je,b.gl.RGBA,"rgba"),(0,I.Z)(Je,b.gl.RGBA4,"rgba4"),(0,I.Z)(Je,b.gl.RGB5_A1,"rgb5 a1"),(0,I.Z)(Je,b.gl.RGB565,"rgb565"),(0,I.Z)(Je,b.gl.DEPTH_COMPONENT,"depth"),(0,I.Z)(Je,b.gl.DEPTH_STENCIL,"depth stencil"),Je),pi=(xt={},(0,I.Z)(xt,b.gl.DONT_CARE,"dont care"),(0,I.Z)(xt,b.gl.NICEST,"nice"),(0,I.Z)(xt,b.gl.FASTEST,"fast"),xt),H=(ht={},(0,I.Z)(ht,b.gl.NEAREST,"nearest"),(0,I.Z)(ht,b.gl.LINEAR,"linear"),(0,I.Z)(ht,b.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,I.Z)(ht,b.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,I.Z)(ht,b.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,I.Z)(ht,b.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),ht),ie=(lr={},(0,I.Z)(lr,b.gl.REPEAT,"repeat"),(0,I.Z)(lr,b.gl.CLAMP_TO_EDGE,"clamp"),(0,I.Z)(lr,b.gl.MIRRORED_REPEAT,"mirror"),lr),ce=(Kr={},(0,I.Z)(Kr,b.gl.NONE,"none"),(0,I.Z)(Kr,b.gl.BROWSER_DEFAULT_WEBGL,"browser"),Kr),B=(lt={},(0,I.Z)(lt,b.gl.NEVER,"never"),(0,I.Z)(lt,b.gl.ALWAYS,"always"),(0,I.Z)(lt,b.gl.LESS,"less"),(0,I.Z)(lt,b.gl.LEQUAL,"lequal"),(0,I.Z)(lt,b.gl.GREATER,"greater"),(0,I.Z)(lt,b.gl.GEQUAL,"gequal"),(0,I.Z)(lt,b.gl.EQUAL,"equal"),(0,I.Z)(lt,b.gl.NOTEQUAL,"notequal"),lt),re=(Lt={},(0,I.Z)(Lt,b.gl.FUNC_ADD,"add"),(0,I.Z)(Lt,b.gl.MIN_EXT,"min"),(0,I.Z)(Lt,b.gl.MAX_EXT,"max"),(0,I.Z)(Lt,b.gl.FUNC_SUBTRACT,"subtract"),(0,I.Z)(Lt,b.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Lt),fe=(Jt={},(0,I.Z)(Jt,b.gl.ZERO,"zero"),(0,I.Z)(Jt,b.gl.ONE,"one"),(0,I.Z)(Jt,b.gl.SRC_COLOR,"src color"),(0,I.Z)(Jt,b.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,I.Z)(Jt,b.gl.SRC_ALPHA,"src alpha"),(0,I.Z)(Jt,b.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,I.Z)(Jt,b.gl.DST_COLOR,"dst color"),(0,I.Z)(Jt,b.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,I.Z)(Jt,b.gl.DST_ALPHA,"dst alpha"),(0,I.Z)(Jt,b.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,I.Z)(Jt,b.gl.CONSTANT_COLOR,"constant color"),(0,I.Z)(Jt,b.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,I.Z)(Jt,b.gl.CONSTANT_ALPHA,"constant alpha"),(0,I.Z)(Jt,b.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,I.Z)(Jt,b.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),Jt),Se=(or={},(0,I.Z)(or,b.gl.NEVER,"never"),(0,I.Z)(or,b.gl.ALWAYS,"always"),(0,I.Z)(or,b.gl.LESS,"less"),(0,I.Z)(or,b.gl.LEQUAL,"lequal"),(0,I.Z)(or,b.gl.GREATER,"greater"),(0,I.Z)(or,b.gl.GEQUAL,"gequal"),(0,I.Z)(or,b.gl.EQUAL,"equal"),(0,I.Z)(or,b.gl.NOTEQUAL,"notequal"),or),te=(cn={},(0,I.Z)(cn,b.gl.ZERO,"zero"),(0,I.Z)(cn,b.gl.KEEP,"keep"),(0,I.Z)(cn,b.gl.REPLACE,"replace"),(0,I.Z)(cn,b.gl.INVERT,"invert"),(0,I.Z)(cn,b.gl.INCR,"increment"),(0,I.Z)(cn,b.gl.DECR,"decrement"),(0,I.Z)(cn,b.gl.INCR_WRAP,"increment wrap"),(0,I.Z)(cn,b.gl.DECR_WRAP,"decrement wrap"),cn),ge=(Pn={},(0,I.Z)(Pn,b.gl.FRONT,"front"),(0,I.Z)(Pn,b.gl.BACK,"back"),Pn),pt=function(){function n(c,o){(0,W.Z)(this,n),(0,I.Z)(this,"buffer",void 0);var s=o.data,l=o.usage,d=o.type;this.buffer=c.buffer({data:s,usage:Si[l||b.gl.STATIC_DRAW],type:Ri[d||b.gl.UNSIGNED_BYTE]})}return(0,$.Z)(n,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(o){var s=o.data,l=o.offset;this.buffer.subdata(s,l)}}]),n}(),yr=function(){function n(c,o){(0,W.Z)(this,n),(0,I.Z)(this,"elements",void 0);var s=o.data,l=o.usage,d=o.type,y=o.count;this.elements=c.elements({data:s,usage:Si[l||b.gl.STATIC_DRAW],type:Ri[d||b.gl.UNSIGNED_BYTE],count:y})}return(0,$.Z)(n,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(o){var s=o.data;this.elements.subdata(s)}},{key:"destroy",value:function(){}}]),n}(),Lr=function(){function n(c,o){(0,W.Z)(this,n),(0,I.Z)(this,"framebuffer",void 0);var s=o.width,l=o.height,d=o.color,y=o.colors,C=o.depth,P=o.stencil,L={width:s,height:l};Array.isArray(y)&&(L.colors=y.map(function(J){return J.get()})),d&&typeof d!="boolean"&&(L.color=d.get()),this.framebuffer=c.framebuffer(L)}return(0,$.Z)(n,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(o){var s=o.width,l=o.height;this.framebuffer.resize(s,l)}}]),n}(),Nt=_(90484),Fr=_(36719),bn=_.n(Fr),gn=_(68630),gr=_.n(gn);function vn(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function Wr(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?vn(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):vn(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}var ln=function(){function n(c,o){(0,W.Z)(this,n),(0,I.Z)(this,"reGl",void 0),(0,I.Z)(this,"destroyed",!1),(0,I.Z)(this,"drawCommand",void 0),(0,I.Z)(this,"drawParams",void 0),(0,I.Z)(this,"options",void 0),(0,I.Z)(this,"uniforms",{}),this.reGl=c;var s=o.vs,l=o.fs,d=o.attributes,y=o.uniforms,C=o.primitive,P=o.count,L=o.elements,J=o.depth,Y=o.blend,le=o.stencil,De=o.cull,ut=o.instances,Rt={};this.options=o,y&&(this.uniforms=this.extractUniforms(y),Object.keys(y).forEach(function(Zr){Rt[Zr]=c.prop(Zr)}));var mr={};Object.keys(d).forEach(function(Zr){mr[Zr]=d[Zr].get()});var br={attributes:mr,frag:l,uniforms:Rt,vert:s,primitive:bi[C===void 0?b.gl.TRIANGLES:C]};ut&&(br.instances=ut),P&&(br.count=P),L&&(br.elements=L.get()),this.initDepthDrawParams({depth:J},br),this.initBlendDrawParams({blend:Y},br),this.initStencilDrawParams({stencil:le},br),this.initCullDrawParams({cull:De},br),this.drawCommand=c(br),this.drawParams=br}return(0,$.Z)(n,[{key:"addUniforms",value:function(o){this.uniforms=Wr(Wr({},this.uniforms),this.extractUniforms(o))}},{key:"draw",value:function(o){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var s=Wr(Wr({},this.uniforms),this.extractUniforms(o.uniforms||{})),l={};Object.keys(s).forEach(function(d){var y=(0,Nt.Z)(s[d]);y==="boolean"||y==="number"||Array.isArray(s[d])||s[d].BYTES_PER_ELEMENT?l[d]=s[d]:l[d]=s[d].get()}),this.drawCommand(l)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(o){o.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(o,s){var l=o.depth;l&&(s.depth={enable:l.enable===void 0?!0:!!l.enable,mask:l.mask===void 0?!0:!!l.mask,func:B[l.func||b.gl.LESS],range:l.range||[0,1]})}},{key:"initBlendDrawParams",value:function(o,s){var l=o.blend;if(l){var d=l.enable,y=l.func,C=l.equation,P=l.color,L=P===void 0?[0,0,0,0]:P;s.blend={enable:!!d,func:{srcRGB:fe[y&&y.srcRGB||b.gl.SRC_ALPHA],srcAlpha:fe[y&&y.srcAlpha||b.gl.SRC_ALPHA],dstRGB:fe[y&&y.dstRGB||b.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:fe[y&&y.dstAlpha||b.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:re[C&&C.rgb||b.gl.FUNC_ADD],alpha:re[C&&C.alpha||b.gl.FUNC_ADD]},color:L}}}},{key:"initStencilDrawParams",value:function(o,s){var l=o.stencil;if(l){var d=l.enable,y=l.mask,C=y===void 0?-1:y,P=l.func,L=P===void 0?{cmp:b.gl.ALWAYS,ref:0,mask:-1}:P,J=l.opFront,Y=J===void 0?{fail:b.gl.KEEP,zfail:b.gl.KEEP,zpass:b.gl.KEEP}:J,le=l.opBack,De=le===void 0?{fail:b.gl.KEEP,zfail:b.gl.KEEP,zpass:b.gl.KEEP}:le;s.stencil={enable:!!d,mask:C,func:Wr(Wr({},L),{},{cmp:Se[L.cmp]}),opFront:{fail:te[Y.fail],zfail:te[Y.zfail],zpass:te[Y.zpass]},opBack:{fail:te[De.fail],zfail:te[De.zfail],zpass:te[De.zpass]}}}}},{key:"initCullDrawParams",value:function(o,s){var l=o.cull;if(l){var d=l.enable,y=l.face,C=y===void 0?b.gl.BACK:y;s.cull={enable:!!d,face:ge[C]}}}},{key:"extractUniforms",value:function(o){var s=this,l={};return Object.keys(o).forEach(function(d){s.extractUniformsRecursively(d,o[d],l,"")}),l}},{key:"extractUniformsRecursively",value:function(o,s,l,d){var y=this;if(s===null||typeof s=="number"||typeof s=="boolean"||Array.isArray(s)&&typeof s[0]=="number"||bn()(s)||s===""||"resize"in s){l["".concat(d&&d+".").concat(o)]=s;return}gr()(s)&&Object.keys(s).forEach(function(C){y.extractUniformsRecursively(C,s[C],l,"".concat(d&&d+".").concat(o))}),Array.isArray(s)&&s.forEach(function(C,P){Object.keys(C).forEach(function(L){y.extractUniformsRecursively(L,C[L],l,"".concat(d&&d+".").concat(o,"[").concat(P,"]"))})})}}]),n}(),Ei=function(){function n(c,o){(0,W.Z)(this,n),(0,I.Z)(this,"texture",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0);var s=o.data,l=o.type,d=l===void 0?b.gl.UNSIGNED_BYTE:l,y=o.width,C=o.height,P=o.flipY,L=P===void 0?!1:P,J=o.format,Y=J===void 0?b.gl.RGBA:J,le=o.mipmap,De=le===void 0?!1:le,ut=o.wrapS,Rt=ut===void 0?b.gl.CLAMP_TO_EDGE:ut,mr=o.wrapT,br=mr===void 0?b.gl.CLAMP_TO_EDGE:mr,Zr=o.aniso,fn=Zr===void 0?0:Zr,xn=o.alignment,Ln=xn===void 0?1:xn,ni=o.premultiplyAlpha,Nn=ni===void 0?!1:ni,xi=o.mag,Ji=xi===void 0?b.gl.NEAREST:xi,ga=o.min,hi=ga===void 0?b.gl.NEAREST:ga,wa=o.colorSpace,co=wa===void 0?b.gl.BROWSER_DEFAULT_WEBGL:wa;this.width=y,this.height=C;var ju={width:y,height:C,type:Ri[d],format:ia[Y],wrapS:ie[Rt],wrapT:ie[br],mag:H[Ji],min:H[hi],alignment:Ln,flipY:L,colorSpace:ce[co],premultiplyAlpha:Nn,aniso:fn};s&&(ju.data=s),typeof De=="number"?ju.mipmap=pi[De]:typeof De=="boolean"&&(ju.mipmap=De),this.texture=c.texture(ju)}return(0,$.Z)(n,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(o)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(o){var s=o.width,l=o.height;this.texture.resize(s,l),this.width=s,this.height=l}},{key:"destroy",value:function(){this.texture.destroy()}}]),n}(),pn,wi,Yi=(pn=(0,V.b2)(),pn(wi=function(){function n(){var c=this;(0,W.Z)(this,n),(0,I.Z)(this,"extensionObject",void 0),(0,I.Z)(this,"gl",void 0),(0,I.Z)(this,"$container",void 0),(0,I.Z)(this,"canvas",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"isDirty",void 0),(0,I.Z)(this,"createModel",function(o){return new ln(c.gl,o)}),(0,I.Z)(this,"createAttribute",function(o){return new fr(c.gl,o)}),(0,I.Z)(this,"createBuffer",function(o){return new pt(c.gl,o)}),(0,I.Z)(this,"createElements",function(o){return new yr(c.gl,o)}),(0,I.Z)(this,"createTexture2D",function(o){return new Ei(c.gl,o)}),(0,I.Z)(this,"createFramebuffer",function(o){return new Lr(c.gl,o)}),(0,I.Z)(this,"useFramebuffer",function(o,s){c.gl({framebuffer:o?o.get():null})(s)}),(0,I.Z)(this,"clear",function(o){var s=o.color,l=o.depth,d=o.stencil,y=o.framebuffer,C=y===void 0?null:y,P={color:s,depth:l,stencil:d};P.framebuffer=C===null?C:C.get(),c.gl.clear(P)}),(0,I.Z)(this,"viewport",function(o){var s=o.x,l=o.y,d=o.width,y=o.height;c.gl._gl.viewport(s,l,d,y),c.width=d,c.height=y,c.gl._refresh()}),(0,I.Z)(this,"readPixels",function(o){var s=o.framebuffer,l=o.x,d=o.y,y=o.width,C=o.height,P={x:l,y:d,width:y,height:C};return s&&(P.framebuffer=s.get()),c.gl.read(P)}),(0,I.Z)(this,"getViewportSize",function(){return{width:c.gl._gl.drawingBufferWidth,height:c.gl._gl.drawingBufferHeight}}),(0,I.Z)(this,"getContainer",function(){var o;return(o=c.canvas)===null||o===void 0?void 0:o.parentElement}),(0,I.Z)(this,"getCanvas",function(){return c.canvas}),(0,I.Z)(this,"getGLContext",function(){return c.gl._gl}),(0,I.Z)(this,"destroy",function(){c.gl.destroy()})}return(0,$.Z)(n,[{key:"init",value:function(){var c=(0,et.Z)(Ct().mark(function s(l,d){var y=this;return Ct().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return this.canvas=l,P.next=3,new Promise(function(L,J){kt()({canvas:y.canvas,attributes:{alpha:!0,antialias:d.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:d.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(le,De){(le||!De)&&J(le),L(De)}})});case 3:this.gl=P.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return P.stop()}},s,this)}));function o(s,l){return c.apply(this,arguments)}return o}()},{key:"testExtension",value:function(o){return!!this.getGLContext().getExtension(o)}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var o=this.getGLContext();o.disable(o.CULL_FACE)}},{key:"setDirty",value:function(o){this.isDirty=o}},{key:"getDirty",value:function(){return this.isDirty}}]),n}())||wi);function Yn(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function Di(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Yn(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Yn(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}var ki=function(){function n(c){(0,W.Z)(this,n),(0,I.Z)(this,"sceneService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"controlService",void 0),(0,I.Z)(this,"layerService",void 0),(0,I.Z)(this,"iconService",void 0),(0,I.Z)(this,"markerService",void 0),(0,I.Z)(this,"popupService",void 0),(0,I.Z)(this,"fontService",void 0),(0,I.Z)(this,"interactionService",void 0),(0,I.Z)(this,"container",void 0);var o=c.id,s=c.map,l=(0,b.Hp)();this.container=l,s.setContainer(l,o),l.bind(b.vK.IRendererService).to(Yi).inSingletonScope(),this.sceneService=l.get(b.vK.ISceneService),this.mapService=l.get(b.vK.IMapService),this.iconService=l.get(b.vK.IIconService),this.fontService=l.get(b.vK.IFontService),this.controlService=l.get(b.vK.IControlService),this.layerService=l.get(b.vK.ILayerService),this.markerService=l.get(b.vK.IMarkerService),this.interactionService=l.get(b.vK.IInteractionService),this.popupService=l.get(b.vK.IPopupService),this.initComponent(o),this.sceneService.init(c),this.initControl()}return(0,$.Z)(n,[{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(o){return this.sceneService.exportPng(o)}},{key:"exportMap",value:function(o){return this.sceneService.exportPng(o)}},{key:"registerRenderService",value:function(o){var s=this;if(this.sceneService.loaded){var l=new o(this);l.init()}else this.on("loaded",function(){var d=new o(s);d.init()})}},{key:"map",get:function(){return this.mapService.map}},{key:"addLayer",value:function(o){var s=(0,b.e7)(this.container);o.setContainer(s),this.sceneService.addLayer(o)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(o){return this.layerService.getLayer(o)}},{key:"getLayerByName",value:function(o){return this.layerService.getLayerByName(o)}},{key:"removeLayer",value:function(o){this.layerService.remove(o)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"addIconFont",value:function(o,s){this.fontService.addIconFont(o,s)}},{key:"addIconFonts",value:function(o){var s=this;o.forEach(function(l){var d=(0,X.Z)(l,2),y=d[0],C=d[1];s.fontService.addIconFont(y,C)})}},{key:"addFontFace",value:function(o,s){this.sceneService.addFontFace(o,s)}},{key:"addImage",value:function(o,s){this.iconService.addImage(o,s)}},{key:"hasImage",value:function(o){return this.iconService.hasImage(o)}},{key:"removeImage",value:function(o){this.iconService.removeImage(o)}},{key:"addIconFontGlyphs",value:function(o,s){this.fontService.addIconGlyphs(s)}},{key:"addControl",value:function(o){this.controlService.addControl(o,this.container)}},{key:"removeControl",value:function(o){this.controlService.removeControl(o)}},{key:"getControlByName",value:function(o){return this.controlService.getControlByName(o)}},{key:"addMarker",value:function(o){this.markerService.addMarker(o)}},{key:"addMarkerLayer",value:function(o){this.markerService.addMarkerLayer(o)}},{key:"removeMarkerLayer",value:function(o){this.markerService.removeMarkerLayer(o)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(o){this.popupService.addPopup(o)}},{key:"on",value:function(o,s){b.SceneEventList.indexOf(o)===-1?this.mapService.on(o,s):this.sceneService.on(o,s)}},{key:"once",value:function(o,s){b.SceneEventList.indexOf(o)===-1?this.mapService.once(o,s):this.sceneService.once(o,s)}},{key:"off",value:function(o,s){b.SceneEventList.indexOf(o)===-1?this.mapService.off(o,s):this.sceneService.off(o,s)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(o){return this.mapService.getCenter(o)}},{key:"setCenter",value:function(o,s){return this.mapService.setCenter(o,s)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(o){return this.mapService.setPitch(o)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(o){this.mapService.setRotation(o)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(o){this.mapService.panTo(o)}},{key:"panBy",value:function(o){this.mapService.panBy(o)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(o){this.mapService.setZoom(o)}},{key:"fitBounds",value:function(o,s){var l=this.sceneService.getSceneConfig(),d=l.fitBoundsOptions,y=l.animate;this.mapService.fitBounds(o,s||Di(Di({},d),{},{animate:y}))}},{key:"setZoomAndCenter",value:function(o,s){this.mapService.setZoomAndCenter(o,s)}},{key:"setMapStyle",value:function(o){this.mapService.setMapStyle(o)}},{key:"setMapStatus",value:function(o){this.mapService.setMapStatus(o)}},{key:"pixelToLngLat",value:function(o){return this.mapService.pixelToLngLat(o)}},{key:"lngLatToPixel",value:function(o){return this.mapService.lngLatToPixel(o)}},{key:"containerToLngLat",value:function(o){return this.mapService.containerToLngLat(o)}},{key:"lngLatToContainer",value:function(o){return this.mapService.lngLatToContainer(o)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(o,s){this.container.bind(b.vK.IPostProcessingPass).to(o).whenTargetNamed(s)}},{key:"initComponent",value:function(o){this.controlService.init({container:$e.SO.getContainer(o)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var o=this.sceneService.getSceneConfig(),s=o.logoVisible,l=o.logoPosition;s&&this.addControl(new Ae({position:l}))}}]),n}(),za=_(81253),Wn=_(55770),ai=_(3473),Ai=_(13218),Qn=_.n(Ai),Fi=_(23560),ya=_.n(Fi),Xa=_(46343),_a=_(86387),da=_.n(_a),Vu,Ya,gi,qa,Ka;function $a(n){return n.map(function(c){return typeof c=="string"&&(c=[c,{}]),c})}var Yo=(Vu=(0,V.b2)(),Ya=(0,V.f3)(b.vK.IGlobalConfigService),Vu(gi=(qa=function(){function n(){(0,W.Z)(this,n),(0,Wn.Z)(this,"configService",Ka,this),(0,I.Z)(this,"enabled",void 0)}return(0,$.Z)(n,[{key:"apply",value:function(o,s){var l=this,d=s.rendererService,y=s.postProcessingPassFactory,C=s.normalPassFactory;o.hooks.init.tap("MultiPassRendererPlugin",function(){var P=o.getLayerConfig(),L=P.enableMultiPassRenderer,J=P.passes,Y=J===void 0?[]:J;l.enabled=!!L&&o.getLayerConfig().enableMultiPassRenderer!==!1,l.enabled&&(o.multiPassRenderer=l.createMultiPassRenderer(o,Y,y,C),o.multiPassRenderer.setRenderFlag(!0))}),o.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(o,s,l,d){var y=o.multiPassRenderer,C=o.getLayerConfig(),P=C.enablePicking,L=C.enableTAA;return P&&y.add(d("pixelPicking")),y}}]),n}(),Ka=(0,ai.Z)(qa.prototype,"configService",[Ya],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qa))||gi),Gi,Oo=(Gi={},(0,I.Z)(Gi,b.h0.additive,{enable:!0,func:{srcRGB:b.gl.ONE,dstRGB:b.gl.ONE,srcAlpha:1,dstAlpha:1}}),(0,I.Z)(Gi,b.h0.none,{enable:!1}),(0,I.Z)(Gi,b.h0.normal,{enable:!0,func:{srcRGB:b.gl.SRC_ALPHA,dstRGB:b.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,I.Z)(Gi,b.h0.subtractive,{enable:!0,func:{srcRGB:b.gl.ONE,dstRGB:b.gl.ONE,srcAlpha:b.gl.ZERO,dstAlpha:b.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:b.gl.FUNC_SUBTRACT,alpha:b.gl.FUNC_SUBTRACT}}),(0,I.Z)(Gi,b.h0.max,{enable:!0,func:{srcRGB:b.gl.ONE,dstRGB:b.gl.ONE},equation:{rgb:b.gl.MAX_EXT}}),(0,I.Z)(Gi,b.h0.min,{enable:!0,func:{srcRGB:b.gl.ONE,dstRGB:b.gl.ONE},equation:{rgb:b.gl.MIN_EXT}}),Gi),Oa=_(47037),Za=_.n(Oa),cs=_(81763),va=_.n(cs),fs=_(1469),Ca=_.n(fs),fo=1024;function Zi(n,c,o,s,l){c.updateStyleAttribute(n,o,s,l)}function pe(n,c){n.opacity&&Le("opacity",c,n.opacity),n.strokeWidth&&Le("strokeWidth",c,n.strokeWidth),n.strokeOpacity&&Le("strokeOpacity",c,n.strokeOpacity),n.stroke&&hr("stroke",c,n.stroke),n.offsets&&vt("offsets",c,n.offsets),n.textOffset&&vt("textOffset",c,n.textOffset)}function Le(n,c,o){Za()(o)?Zi(n,c,o,function(s){return s}):va()(o)?Zi(n,c,[o],void 0):Ca()(o)&&o.length===2?Za()(o[0])&&ya()(o[1])||Za()(o[0])&&Ca()(o[1])&&va()(o[1][0])&&va()(o[1][1])?Zi(n,c,o[0],o[1]):Zi(n,c,[1],void 0):Zi(n,c,[1],void 0)}function vt(n,c,o){Za()(o)?Zi(n,c,o,function(s){return s}):Ca()(o)&&o.length===2&&Za()(o[0])&&ya()(o[1])?Zi(n,c,o[0],o[1]):Ca()(o)&&o.length===2&&va()(o[0])&&va()(o[1])?Zi(n,c,o,void 0):Zi(n,c,[0,0],void 0)}function hr(n,c,o){Za()(o)?Zi(n,c,o,void 0):Ca()(o)&&o.length===2&&(Za()(o[0])&&ya()(o[1])||Za()(o[0])&&Ca()(o[1])&&o[1].length>0)?Zi(n,c,o[0],o[1]):Zi(n,c,"#fff",void 0)}var Qr={properties:{enablePicking:{type:"boolean"},enableHighlight:{type:"boolean"},highlightColor:{oneOf:[{type:"array",items:{type:"number",minimum:0,maximum:1}},{type:"string"}]}}},Dn,Ki,Ua,La,ja,To,Mu;function $l(n,c){var o=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!o){if(Array.isArray(n)||(o=Il(n))||c&&n&&typeof n.length=="number"){o&&(n=o);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(L){throw L},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,y=!1,C;return{s:function(){o=o.call(n)},n:function(){var L=o.next();return d=L.done,L},e:function(L){y=!0,C=L},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(y)throw C}}}}function Il(n,c){if(!!n){if(typeof n=="string")return Lo(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Lo(n,c)}}function Lo(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}function Xs(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function ua(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Xs(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Xs(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function Ns(n){var c=ou();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function ou(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var bs=0,Ps=(Dn=(0,b.yT)(b.vK.ILogService),Ki=(0,b.yT)(b.vK.IGlobalConfigService),Ua=(0,b.yT)(b.vK.IShaderModuleService),La=function(n){(0,Ce.Z)(o,n);var c=Ns(o);function o(){var s,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,W.Z)(this,o),s=c.call(this),(0,I.Z)((0,k.Z)(s),"id","".concat(bs++)),(0,I.Z)((0,k.Z)(s),"name","".concat(bs)),(0,I.Z)((0,k.Z)(s),"type",void 0),(0,I.Z)((0,k.Z)(s),"visible",!0),(0,I.Z)((0,k.Z)(s),"zIndex",0),(0,I.Z)((0,k.Z)(s),"minZoom",void 0),(0,I.Z)((0,k.Z)(s),"maxZoom",void 0),(0,I.Z)((0,k.Z)(s),"inited",!1),(0,I.Z)((0,k.Z)(s),"layerModelNeedUpdate",!1),(0,I.Z)((0,k.Z)(s),"pickedFeatureID",null),(0,I.Z)((0,k.Z)(s),"selectedFeatureID",null),(0,I.Z)((0,k.Z)(s),"styleNeedUpdate",!1),(0,I.Z)((0,k.Z)(s),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,I.Z)((0,k.Z)(s),"hooks",{init:new Xa.oI,afterInit:new Xa.oI,beforeRender:new Xa.oI,beforeRenderData:new Xa.gg,afterRender:new Xa.ni,beforePickingEncode:new Xa.ni,afterPickingEncode:new Xa.ni,beforeHighlight:new Xa.ni(["pickedColor"]),afterHighlight:new Xa.ni,beforeSelect:new Xa.ni(["pickedColor"]),afterSelect:new Xa.ni,beforeDestroy:new Xa.ni,afterDestroy:new Xa.ni}),(0,I.Z)((0,k.Z)(s),"models",[]),(0,I.Z)((0,k.Z)(s),"multiPassRenderer",void 0),(0,I.Z)((0,k.Z)(s),"plugins",void 0),(0,I.Z)((0,k.Z)(s),"sourceOption",void 0),(0,I.Z)((0,k.Z)(s),"layerModel",void 0),(0,Wn.Z)((0,k.Z)(s),"logger",ja,(0,k.Z)(s)),(0,Wn.Z)((0,k.Z)(s),"configService",To,(0,k.Z)(s)),(0,Wn.Z)((0,k.Z)(s),"shaderModuleService",Mu,(0,k.Z)(s)),(0,I.Z)((0,k.Z)(s),"cameraService",void 0),(0,I.Z)((0,k.Z)(s),"coordinateService",void 0),(0,I.Z)((0,k.Z)(s),"iconService",void 0),(0,I.Z)((0,k.Z)(s),"fontService",void 0),(0,I.Z)((0,k.Z)(s),"pickingService",void 0),(0,I.Z)((0,k.Z)(s),"rendererService",void 0),(0,I.Z)((0,k.Z)(s),"layerService",void 0),(0,I.Z)((0,k.Z)(s),"interactionService",void 0),(0,I.Z)((0,k.Z)(s),"mapService",void 0),(0,I.Z)((0,k.Z)(s),"styleAttributeService",void 0),(0,I.Z)((0,k.Z)(s),"layerSource",void 0),(0,I.Z)((0,k.Z)(s),"postProcessingPassFactory",void 0),(0,I.Z)((0,k.Z)(s),"normalPassFactory",void 0),(0,I.Z)((0,k.Z)(s),"animateOptions",{enable:!1}),(0,I.Z)((0,k.Z)(s),"container",void 0),(0,I.Z)((0,k.Z)(s),"encodedData",void 0),(0,I.Z)((0,k.Z)(s),"configSchema",void 0),(0,I.Z)((0,k.Z)(s),"currentPickId",null),(0,I.Z)((0,k.Z)(s),"rawConfig",void 0),(0,I.Z)((0,k.Z)(s),"needUpdateConfig",void 0),(0,I.Z)((0,k.Z)(s),"pendingStyleAttributes",[]),(0,I.Z)((0,k.Z)(s),"scaleOptions",{}),(0,I.Z)((0,k.Z)(s),"animateStartTime",void 0),(0,I.Z)((0,k.Z)(s),"aniamateStatus",!1),(0,I.Z)((0,k.Z)(s),"sourceEvent",function(){s.dataState.dataSourceNeedUpdate=!0;var d=s.getLayerConfig(),y=d.autoFit,C=d.fitBoundsOptions;y&&s.fitBounds(C),s.emit("dataUpdate"),s.reRender()}),s.name=l.name||s.id,s.zIndex=l.zIndex||0,s.rawConfig=l,s}return(0,$.Z)(o,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(l){if(!this.inited)this.needUpdateConfig=ua(ua({},this.needUpdateConfig),l);else{var d=this.container.get(b.vK.SceneID);pe(l,this),this.configService.setLayerConfig(d,this.id,ua(ua(ua({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),l)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(l){this.container=l}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(l){return this.plugins.push(l),this}},{key:"init",value:function(){var l=this,d=this.container.get(b.vK.SceneID),y=this.rawConfig.enableMultiPassRenderer,C=y===void 0?!1:y;this.configService.setLayerConfig(d,this.id,{enableMultiPassRenderer:C}),this.iconService=this.container.get(b.vK.IIconService),this.fontService=this.container.get(b.vK.IFontService),this.rendererService=this.container.get(b.vK.IRendererService),this.layerService=this.container.get(b.vK.ILayerService),this.interactionService=this.container.get(b.vK.IInteractionService),this.pickingService=this.container.get(b.vK.IPickingService),this.mapService=this.container.get(b.vK.IMapService),this.cameraService=this.container.get(b.vK.ICameraService),this.coordinateService=this.container.get(b.vK.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(b.vK.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(b.vK.IFactoryNormalPass),this.styleAttributeService=this.container.get(b.vK.IStyleAttributeService),this.multiPassRenderer=this.container.get(b.vK.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(Y){var le=Y.attributeName,De=Y.attributeField,ut=Y.attributeValues,Rt=Y.updateOptions;l.styleAttributeService.updateStyleAttribute(le,{scale:ua({field:De},l.splitValuesAndCallbackInAttribute(ut,l.getLayerConfig()[le]))},Rt)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(b.vK.ILayerPlugin);var P=$l(this.plugins),L;try{for(P.s();!(L=P.n()).done;){var J=L.value;J.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(Y){P.e(Y)}finally{P.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(ua(ua({},this.getDefaultConfig()),this.rawConfig));var l=this.getLayerConfig(),d=l.animateOption;d!=null&&d.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(l,d,y){return this.updateStyleAttribute("color",l,d,y),this}},{key:"texture",value:function(l,d,y){return this.updateStyleAttribute("texture",l,d,y),this}},{key:"rotate",value:function(l,d,y){return this.updateStyleAttribute("rotate",l,d,y),this}},{key:"size",value:function(l,d,y){return this.updateStyleAttribute("size",l,d,y),this}},{key:"filter",value:function(l,d,y){return this.updateStyleAttribute("filter",l,d,y),this}},{key:"shape",value:function(l,d,y){return this.updateStyleAttribute("shape",l,d,y),this}},{key:"label",value:function(l,d,y){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:l,attributeValues:d,updateOptions:y}),this}},{key:"animate",value:function(l){var d={};return Qn()(l)?(d.enable=!0,d=ua(ua({},d),l)):d.enable=l,this.updateLayerConfig({animateOption:d}),this}},{key:"source",value:function(l,d){return this.sourceOption={data:l,options:d},this}},{key:"setData",value:function(l,d){var y=this;return this.inited?this.layerSource.setData(l,d):this.on("inited",function(){y.layerSource.setData(l,d)}),this}},{key:"style",value:function(l){var d=this,y=l.passes,C=(0,za.Z)(l,["passes"]);return y&&$a(y).forEach(function(P){var L=d.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(P[0]);L&&L.updateOptions(P[1])}),this.rawConfig=ua(ua({},this.rawConfig),C),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(l,d){return Qn()(l)?this.scaleOptions=ua(ua({},this.scaleOptions),l):this.scaleOptions[l]=d,this}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"active",value:function(l){var d={};return d.enableHighlight=Qn()(l)?!0:l,Qn()(l)?(d.enableHighlight=!0,l.color&&(d.highlightColor=l.color)):d.enableHighlight=!!l,this.updateLayerConfig(d),this}},{key:"setActive",value:function(l,d){var y=this;if(Qn()(l)){var C=l.x,P=C===void 0?0:C,L=l.y,J=L===void 0?0:L;this.updateLayerConfig({highlightColor:Qn()(d)?d.color:this.getLayerConfig().highlightColor}),this.pick({x:P,y:J})}else this.updateLayerConfig({pickedFeatureID:l,highlightColor:Qn()(d)?d.color:this.getLayerConfig().highlightColor}),this.hooks.beforeSelect.call((0,$e.Z6)(l)).then(function(){setTimeout(function(){y.reRender()},1)})}},{key:"select",value:function(l){var d={};return d.enableSelect=Qn()(l)?!0:l,Qn()(l)?(d.enableSelect=!0,l.color&&(d.selectColor=l.color)):d.enableSelect=!!l,this.updateLayerConfig(d),this}},{key:"setSelect",value:function(l,d){var y=this;if(Qn()(l)){var C=l.x,P=C===void 0?0:C,L=l.y,J=L===void 0?0:L;this.updateLayerConfig({selectColor:Qn()(d)?d.color:this.getLayerConfig().selectColor}),this.pick({x:P,y:J})}else this.updateLayerConfig({pickedFeatureID:l,selectColor:Qn()(d)?d.color:this.getLayerConfig().selectColor}),this.hooks.beforeSelect.call((0,$e.Z6)(l)).then(function(){setTimeout(function(){y.reRender()},1)})}},{key:"setBlend",value:function(l){this.updateLayerConfig({blend:l}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(l){return this.zIndex=l,this.layerService.updateRenderOrder(),this}},{key:"setCurrentPickId",value:function(l){this.currentPickId=l}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(l){this.selectedFeatureID=l}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var l=this.mapService.getZoom(),d=this.getLayerConfig(),y=d.visible,C=d.minZoom,P=C===void 0?-Infinity:C,L=d.maxZoom,J=L===void 0?Infinity:L;return!!y&&l>=P&&l<=J}},{key:"setMinZoom",value:function(l){return this.updateLayerConfig({minZoom:l}),this}},{key:"getMinZoom",value:function(){var l=this.getLayerConfig(),d=l.minZoom;return d}},{key:"getMaxZoom",value:function(){var l=this.getLayerConfig(),d=l.maxZoom;return d}},{key:"get",value:function(l){var d=this.getLayerConfig();return d[l]}},{key:"setMaxZoom",value:function(l){return this.updateLayerConfig({maxZoom:l}),this}},{key:"fitBounds",value:function(l){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var d=this.getSource(),y=d.extent,C=y.some(function(P){return Math.abs(P)===Infinity});return C?this:(this.mapService.fitBounds([[y[0],y[1]],[y[2],y[3]]],l),this)}},{key:"destroy",value:function(){this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(l){return l.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(l){return l.needRescale||l.needRemapping||l.needRegenerateVertices}).length}},{key:"setSource",value:function(l){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=l,this.inited&&this.layerSource.cluster){var d=this.mapService.getZoom();this.layerSource.updateClusterData(d)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(l){this.encodedData=l}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getConfigSchemaForValidation",value:function(){return this.configSchema||(this.configSchema=da()([Qr,this.getConfigSchema()])),this.configSchema}},{key:"getLegendItems",value:function(l){var d=this.styleAttributeService.getLayerAttributeScale(l);if(d){if(d.ticks){var y=d.ticks().map(function(P){return(0,I.Z)({value:P},l,d(P))});return y}else if(d.invertExtent){var C=d.range().map(function(P){return(0,I.Z)({value:d.invertExtent(P)},l,P)});return C}}else return[]}},{key:"pick",value:function(l){var d=l.x,y=l.y;this.interactionService.triggerHover({x:d,y})}},{key:"boxSelect",value:function(l,d){this.pickingService.boxPickLayer(this,l,d)}},{key:"buildLayerModel",value:function(l){var d=l.moduleName,y=l.vertexShader,C=l.fragmentShader,P=l.triangulation,L=(0,za.Z)(l,["moduleName","vertexShader","fragmentShader","triangulation"]);this.shaderModuleService.registerModule(d,{vs:y,fs:C});var J=this.shaderModuleService.getModule(d),Y=J.vs,le=J.fs,De=J.uniforms,ut=this.rendererService.createModel,Rt=this.styleAttributeService.createAttributesAndIndices(this.encodedData,P),mr=Rt.attributes,br=Rt.elements;return ut(ua({attributes:mr,uniforms:De,fs:le,vs:Y,elements:br,blend:Oo[b.h0.normal]},L))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(l){var d=this.getLayerConfig(),y=d.enableHighlight,C=y===void 0?!0:y,P=d.enableSelect,L=P===void 0?!0:P,J=this.eventNames().indexOf(l)!==-1||this.eventNames().indexOf("un"+l)!==-1;return(l==="click"||l==="dblclick")&&L&&(J=!0),l==="mousemove"&&(C||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(J=!0),this.isVisible()&&J}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(){var l=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(d){d.draw({uniforms:l.layerModel.getUninforms()})})),this}},{key:"updateStyleAttribute",value:function(l,d,y,C){this.inited?this.styleAttributeService.updateStyleAttribute(l,{scale:ua({field:d},this.splitValuesAndCallbackInAttribute(y,this.getLayerConfig()[d]))},C):this.pendingStyleAttributes.push({attributeName:l,attributeField:d,attributeValues:y,updateOptions:C})}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&this.layerService.renderLayers()}},{key:"splitValuesAndCallbackInAttribute",value:function(l,d){return{values:ya()(l)?void 0:l||d,callback:ya()(l)?l:void 0}}}]),o}(Vt.EventEmitter),ja=(0,ai.Z)(La.prototype,"logger",[Dn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),To=(0,ai.Z)(La.prototype,"configService",[Ki],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mu=(0,ai.Z)(La.prototype,"shaderModuleService",[Ua],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),La),ti=_(85061),ho=_(18446),su=_.n(ho),Ol=_(2650),sl,Xe,Pt,_r,Zn;function sa(n,c){var o=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!o){if(Array.isArray(n)||(o=xa(n))||c&&n&&typeof n.length=="number"){o&&(n=o);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(L){throw L},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,y=!1,C;return{s:function(){o=o.call(n)},n:function(){var L=o.next();return d=L.done,L},e:function(L){y=!0,C=L},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(y)throw C}}}}function xa(n,c){if(!!n){if(typeof n=="string")return ka(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return ka(n,c)}}function ka(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}var vi=(sl=(0,b.yT)(b.vK.IGlobalConfigService),Xe=(0,b.yT)(b.vK.IShaderModuleService),Pt=function(){function n(c){(0,W.Z)(this,n),(0,I.Z)(this,"triangulation",void 0),(0,I.Z)(this,"createTexture2D",void 0),(0,I.Z)(this,"layer",void 0),(0,I.Z)(this,"dataTexture",void 0),(0,I.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,I.Z)(this,"rowCount",void 0),(0,I.Z)(this,"cacheStyleProperties",void 0),(0,I.Z)(this,"cellLength",void 0),(0,I.Z)(this,"cellProperties",void 0),(0,I.Z)(this,"cellTypeLayout",void 0),(0,I.Z)(this,"stylePropertyesExist",void 0),(0,I.Z)(this,"dataTextureTest",void 0),(0,Wn.Z)(this,"configService",_r,this),(0,Wn.Z)(this,"shaderModuleService",Zn,this),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"iconService",void 0),(0,I.Z)(this,"fontService",void 0),(0,I.Z)(this,"styleAttributeService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"cameraService",void 0),(0,I.Z)(this,"layerService",void 0),this.layer=c,this.rendererService=c.getContainer().get(b.vK.IRendererService),this.styleAttributeService=c.getContainer().get(b.vK.IStyleAttributeService),this.mapService=c.getContainer().get(b.vK.IMapService),this.iconService=c.getContainer().get(b.vK.IIconService),this.fontService=c.getContainer().get(b.vK.IFontService),this.cameraService=c.getContainer().get(b.vK.ICameraService),this.layerService=c.getContainer().get(b.vK.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var o=this.rendererService.createTexture2D;this.createTexture2D=o,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new ImageData(1,1).data,mag:b.gl.NEAREST,min:b.gl.NEAREST,width:1,height:1}))}return(0,$.Z)(n,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,0,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(o){var s=!1;return su()(o.opacity,this.cacheStyleProperties.opacity)||(s=!0,this.cacheStyleProperties.opacity=o.opacity),su()(o.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(s=!0,this.cacheStyleProperties.strokeOpacity=o.strokeOpacity),su()(o.strokeWidth,this.cacheStyleProperties.strokeWidth)||(s=!0,this.cacheStyleProperties.strokeWidth=o.strokeWidth),su()(o.stroke,this.cacheStyleProperties.stroke)||(s=!0,this.cacheStyleProperties.stroke=o.stroke),su()(o.offsets,this.cacheStyleProperties.offsets)||(s=!0,this.cacheStyleProperties.offsets=o.offsets),this.dataTexture===void 0&&(s=!0),s}},{key:"judgeStyleAttributes",value:function(o){this.clearLastCalRes(),o.opacity!==void 0&&!va()(o.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),o.strokeOpacity!==void 0&&!va()(o.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),o.strokeWidth!==void 0&&!va()(o.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),o.stroke!==void 0&&!this.isStaticColor(o.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),o.offsets!==void 0&&!this.isOffsetStatic(o.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2)}},{key:"isStaticColor",value:function(o){return Za()(o)?!!(0,Ol.ZP)(o):!1}},{key:"getStrokeColor",value:function(o){if(this.isStaticColor(o)){var s=(0,$e.CI)(o);return s[0]=s[0]?s[0]:0,s[1]=s[1]?s[1]:0,s[2]=s[2]?s[2]:0,s[3]=s[3]?s[3]:0,s}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(o){return!!(Ca()(o)&&o.length===2&&va()(o[0])&&va()(o[1]))}},{key:"patchMod",value:function(o,s){for(var l=0;l<s;l++)o.push(-1)}},{key:"patchData",value:function(o,s,l){var d=sa(l),y;try{for(d.s();!(y=d.n()).done;){var C=y.value,P=C.attr,L=C.count,J=s[P];J?P==="stroke"?o.push.apply(o,(0,ti.Z)((0,$e.CI)(J))):P==="offsets"?this.isOffsetStatic(J)?o.push(-J[0],J[1]):o.push(0,0):o.push(va()(J)?J:1):this.patchMod(o,L)}}catch(Y){d.e(Y)}finally{d.f()}}},{key:"calDataFrame",value:function(o,s,l){for(var d=s.length,y=Math.ceil(d*o/this.DATA_TEXTURE_WIDTH),C=y*this.DATA_TEXTURE_WIDTH,P=[],L=0;L<d;L++){var J=s[L];this.patchData(P,J,l)}for(var Y=P.length;Y<C;Y++)P.push(-1);return{data:P,width:this.DATA_TEXTURE_WIDTH,height:y}}},{key:"getBlend",value:function(){var o=this.layer.getLayerConfig(),s=o.blend,l=s===void 0?"normal":s;return Oo[b.h0[l]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(o){return[o.enable?0:1,o.duration||4,o.interval||.2,o.trailLength||.1]}},{key:"startModelAnimate",value:function(){var o=this.layer.getLayerConfig(),s=o.animateOption;s.enable&&this.layer.setAnimateStartTime()}}]),n}(),_r=(0,ai.Z)(Pt.prototype,"configService",[sl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zn=(0,ai.Z)(Pt.prototype,"shaderModuleService",[Xe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pt),Ta=_(9187),eo=_.n(Ta),qn=_(31437),ba=qn.create(),Jl=qn.create(),Ra=qn.create(),Ro=qn.create(),xu=qn.create();function Ys(n,c,o,s,l){qn.add(n,o,s),qn.normalize(n,n),c=qn.fromValues(-n[1],n[0]);var d=qn.fromValues(-o[1],o[0]);return[l/qn.dot(c,d),c]}function zs(n,c){return qn.set(n,-c[1],c[0])}function rs(n,c,o){return qn.sub(n,c,o),qn.normalize(n,n),n}function Iu(n,c){return n[0]===c[0]&&n[1]===c[1]}function xo(n){for(var c=new Map,o=0;o<n.length;o++){var s=n[0].toString()+"-"+n[1].toString();c.get(s)?(n.splice(o,1),o++):c.set(s,s)}return n}var rf=function(){function n(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,W.Z)(this,n),(0,I.Z)(this,"complex",void 0),(0,I.Z)(this,"join",void 0),(0,I.Z)(this,"cap",void 0),(0,I.Z)(this,"miterLimit",void 0),(0,I.Z)(this,"thickness",void 0),(0,I.Z)(this,"normal",void 0),(0,I.Z)(this,"lastFlip",-1),(0,I.Z)(this,"miter",qn.fromValues(0,0)),(0,I.Z)(this,"started",!1),(0,I.Z)(this,"dash",!1),(0,I.Z)(this,"totalDistance",0),this.join=c.join||"miter",this.cap=c.cap||"butt",this.miterLimit=c.miterLimit||10,this.thickness=c.thickness||1,this.dash=c.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,$.Z)(n,[{key:"extrude_gaode2",value:function(o,s){var l=this.complex;if(o.length<=1)return l;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var d=o.length,y=l.startIndex,C=1;C<d;C++){var P=o[C-1],L=s[C-1],J=o[C],Y=s[C],le=C<o.length-1?o[C+1]:null,De=C<s.length-1?s[C+1]:null,ut=this.segment_gaode2(l,y,P,J,le,L,Y,De);y+=ut}if(this.dash)for(var Rt=0;Rt<l.positions.length/6;Rt++)l.positions[Rt*6+5]=this.totalDistance;return l.startIndex=l.positions.length/6,l}},{key:"extrude",value:function(o){var s=this.complex;if(o.length<=1)return s;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var l=o.length,d=s.startIndex,y=1;y<l;y++){var C=o[y-1],P=o[y],L=y<o.length-1?o[y+1]:null,J=this.segment(s,d,C,P,L);d+=J}if(this.dash)for(var Y=0;Y<s.positions.length/6;Y++)s.positions[Y*6+5]=this.totalDistance;return s.startIndex=s.positions.length/6,s}},{key:"segment_gaode2",value:function(o,s,l,d,y,C,P,L){var J=0,Y=o.indices,le=o.positions,De=o.normals,ut=this.cap==="square",Rt=this.join==="bevel",mr=(0,$e.Z)([P[0],P[1]]),br=(0,$e.Z)([C[0],C[1]]);rs(Ra,d,l);var Zr=0;if(this.dash&&(Zr=this.lineSegmentDistance(mr,br),this.totalDistance+=Zr),this.normal||(this.normal=qn.create(),zs(this.normal,Ra)),!this.started)if(this.started=!0,ut){var fn=qn.create(),xn=qn.create();qn.add(fn,this.normal,Ra),qn.add(xn,this.normal,Ra),De.push(xn[0],xn[1],0),De.push(fn[0],fn[1],0),le.push(l[0],l[1],0,this.totalDistance-Zr,-this.thickness,0),le.push(l[0],l[1],0,this.totalDistance-Zr,this.thickness,0)}else this.extrusions(le,De,l,this.normal,this.thickness,this.totalDistance-Zr);if(Y.push(s+0,s+1,s+2),y){Iu(d,y)&&qn.add(y,d,qn.normalize(y,qn.subtract(y,d,l))),rs(Ro,y,d);var Nn=Ys(xu,qn.create(),Ra,Ro,this.thickness),xi=(0,X.Z)(Nn,2),Ji=xi[0],ga=xi[1],hi=qn.dot(xu,this.normal)<0?-1:1,wa=Rt;if(!wa&&this.join==="miter"){var co=Ji;co>this.miterLimit&&(wa=!0)}wa?(De.push(this.normal[0],this.normal[1],0),De.push(ga[0],ga[1],0),le.push(d[0],d[1],0,this.totalDistance,-this.thickness*hi,0),le.push(d[0],d[1],0,this.totalDistance,this.thickness*hi,0),Y.push.apply(Y,(0,ti.Z)(this.lastFlip!==-hi?[s,s+2,s+3]:[s+2,s+1,s+3])),Y.push(s+2,s+3,s+4),zs(ba,Ro),qn.copy(this.normal,ba),De.push(this.normal[0],this.normal[1],0),le.push(d[0],d[1],0,this.totalDistance,-this.thickness*hi,0),J+=3):(this.extrusions(le,De,d,ga,Ji,this.totalDistance),Y.push.apply(Y,(0,ti.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),hi=-1,qn.copy(this.normal,ga),J+=2),this.lastFlip=hi}else{if(zs(this.normal,Ra),ut){var Ln=qn.create(),ni=qn.create();qn.sub(ni,Ra,this.normal),qn.add(Ln,Ra,this.normal),De.push(ni[0],ni[1],0),De.push(Ln[0],Ln[1],0),le.push(d[0],d[1],0,this.totalDistance,this.thickness,0),le.push(d[0],d[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(le,De,d,this.normal,this.thickness,this.totalDistance);Y.push.apply(Y,(0,ti.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),J+=2}return J}},{key:"segment",value:function(o,s,l,d,y){var C=0,P=o.indices,L=o.positions,J=o.normals,Y=this.cap==="square",le=this.join==="bevel",De=(0,$e.Z)([d[0],d[1]]),ut=(0,$e.Z)([l[0],l[1]]);rs(Ra,De,ut);var Rt=0;if(this.dash&&(Rt=this.lineSegmentDistance(De,ut),this.totalDistance+=Rt),this.normal||(this.normal=qn.create(),zs(this.normal,Ra)),!this.started)if(this.started=!0,Y){var mr=qn.create(),br=qn.create();qn.add(mr,this.normal,Ra),qn.add(br,this.normal,Ra),J.push(br[0],br[1],0),J.push(mr[0],mr[1],0),L.push(l[0],l[1],0,this.totalDistance-Rt,-this.thickness,0),L.push(l[0],l[1],0,this.totalDistance-Rt,this.thickness,0)}else this.extrusions(L,J,l,this.normal,this.thickness,this.totalDistance-Rt);if(P.push(s+0,s+1,s+2),y){var xn=(0,$e.Z)([y[0],y[1]]);Iu(De,xn)&&qn.add(xn,De,qn.normalize(xn,qn.subtract(xn,De,ut))),rs(Ro,xn,De);var Ln=Ys(xu,qn.create(),Ra,Ro,this.thickness),ni=(0,X.Z)(Ln,2),Nn=ni[0],xi=ni[1],Ji=qn.dot(xu,this.normal)<0?-1:1,ga=le;if(!ga&&this.join==="miter"){var hi=Nn;hi>this.miterLimit&&(ga=!0)}ga?(J.push(this.normal[0],this.normal[1],0),J.push(xi[0],xi[1],0),L.push(d[0],d[1],0,this.totalDistance,-this.thickness*Ji,0),L.push(d[0],d[1],0,this.totalDistance,this.thickness*Ji,0),P.push.apply(P,(0,ti.Z)(this.lastFlip!==-Ji?[s,s+2,s+3]:[s+2,s+1,s+3])),P.push(s+2,s+3,s+4),zs(ba,Ro),qn.copy(this.normal,ba),J.push(this.normal[0],this.normal[1],0),L.push(d[0],d[1],0,this.totalDistance,-this.thickness*Ji,0),C+=3):(this.extrusions(L,J,d,xi,Nn,this.totalDistance),P.push.apply(P,(0,ti.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),Ji=-1,qn.copy(this.normal,xi),C+=2),this.lastFlip=Ji}else{if(zs(this.normal,Ra),Y){var Zr=qn.create(),fn=qn.create();qn.sub(fn,Ra,this.normal),qn.add(Zr,Ra,this.normal),J.push(fn[0],fn[1],0),J.push(Zr[0],Zr[1],0),L.push(d[0],d[1],0,this.totalDistance,this.thickness,0),L.push(d[0],d[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(L,J,d,this.normal,this.thickness,this.totalDistance);P.push.apply(P,(0,ti.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),C+=2}return C}},{key:"extrusions",value:function(o,s,l,d,y,C){s.push(d[0],d[1],0),s.push(d[0],d[1],0),o.push(l[0],l[1],0,C,-y,0),o.push(l[0],l[1],0,C,y,0)}},{key:"lineSegmentDistance",value:function(o,s){var l=s[0]-o[0],d=s[1]-o[1];return Math.sqrt(l*l+d*d)}}]),n}();function ul(n){if(va()(n[0]))return n;if(va()(n[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(va()(n[0][0][0])){var c=n,o=0,s=0,l=0;return c.forEach(function(d){d.forEach(function(y){o+=y[0],s+=y[1],l++})}),[o/l,s/l,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}var Ui=_(77160);function Hf(n){var c=n[0][0],o=n[0][n[0].length-1];c[0]===o[0]&&c[1]===o[1]&&(n[0]=n[0].slice(0,n[0].length-1));for(var s=n[0].length,l=eo().flatten(n),d=l.vertices,y=l.dimensions,C=[],P=[],L=0;L<d.length/y;L++)y===2?C.push(d[L*2],d[L*2+1],1):C.push(d[L*3],d[L*3+1],1);var J=eo()(l.vertices,l.holes,l.dimensions);P.push.apply(P,(0,ti.Z)(J));for(var Y=function(ut){var Rt=l.vertices.slice(ut*y,(ut+1)*y),mr=l.vertices.slice((ut+1)*y,(ut+2)*y);mr.length===0&&(mr=l.vertices.slice(0,y));var br=C.length/3;C.push(Rt[0],Rt[1],1,mr[0],mr[1],1,Rt[0],Rt[1],0,mr[0],mr[1],0),P.push.apply(P,(0,ti.Z)([0,2,1,2,3,1].map(function(Zr){return Zr+br})))},le=0;le<s;le++)Y(le);return{positions:C,index:P}}function Ql(n){var c=eo().flatten(n),o=eo()(c.vertices,c.holes,c.dimensions);return{positions:c.vertices,index:o}}function Sf(n){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=n[0][0],s=n[0][n[0].length-1];o[0]===s[0]&&o[1]===s[1]&&(n[0]=n[0].slice(0,n[0].length-1));for(var l=n[0].length,d=eo().flatten(n),y=d.vertices,C=d.dimensions,P=[],L=[],J=[],Y=0;Y<y.length/C;Y++)C===2?P.push(y[Y*2],y[Y*2+1],1,-1,-1):P.push(y[Y*3],y[Y*3+1],1,-1,-1),J.push(0,0,1);var le=eo()(d.vertices,d.holes,d.dimensions);L.push.apply(L,(0,ti.Z)(le));for(var De=function(mr){var br=d.vertices.slice(mr*C,(mr+1)*C),Zr=d.vertices.slice((mr+1)*C,(mr+2)*C);Zr.length===0&&(Zr=d.vertices.slice(0,C));var fn=P.length/5;P.push(br[0],br[1],1,0,0,Zr[0],Zr[1],1,.1,0,br[0],br[1],0,0,.8,Zr[0],Zr[1],0,.1,.8);var xn=Ll([Zr[0],Zr[1],1],[br[0],br[1],0],[br[0],br[1],1],c);J.push.apply(J,(0,ti.Z)(xn).concat((0,ti.Z)(xn),(0,ti.Z)(xn),(0,ti.Z)(xn))),L.push.apply(L,(0,ti.Z)([1,2,0,3,2,1].map(function(Ln){return Ln+fn})))},ut=0;ut<l;ut++)De(ut);return{positions:P,index:L,normals:J}}function Ll(n,c,o){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=Ui.create(),d=Ui.create(),y=Ui.create();s&&(n=(0,$e.vP)(n),c=(0,$e.vP)(c),o=(0,$e.vP)(o));var C=Ui.fromValues.apply(Ui,(0,ti.Z)(n)),P=Ui.fromValues.apply(Ui,(0,ti.Z)(c)),L=Ui.fromValues.apply(Ui,(0,ti.Z)(o));Ui.sub(l,L,P),Ui.sub(d,C,P),Ui.cross(y,l,d);var J=Ui.create();return Ui.normalize(J,y),J}var Ko,Aa;(function(n){n.CYLINDER="cylinder",n.SQUARECOLUMN="squareColumn",n.TRIANGLECOLUMN="triangleColumn",n.HEXAGONCOLUMN="hexagonColumn",n.PENTAGONCOLUMN="pentagonColumn"})(Aa||(Aa={}));var to;(function(n){n.CIRCLE="circle",n.SQUARE="square",n.TRIANGLE="triangle",n.HEXAGON="hexagon",n.PENTAGON="pentagon"})(to||(to={}));function Ks(n){for(var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=Math.PI*2/n,s=[],l=0;l<n;l++)s.push(o*l+c*Math.PI/12);var d=s.map(function(y){var C=Math.sin(y+Math.PI/4),P=Math.cos(y+Math.PI/4);return[C,P,0]});return d}function ns(){return Ks(30)}function fc(){return Ks(4)}function Rl(){return Ks(3)}function bu(){return Ks(6,1)}function Su(){return Ks(5)}var Ou=(Ko={},(0,I.Z)(Ko,to.CIRCLE,ns),(0,I.Z)(Ko,to.HEXAGON,bu),(0,I.Z)(Ko,to.TRIANGLE,Rl),(0,I.Z)(Ko,to.SQUARE,fc),(0,I.Z)(Ko,to.PENTAGON,Su),(0,I.Z)(Ko,Aa.CYLINDER,ns),(0,I.Z)(Ko,Aa.HEXAGONCOLUMN,bu),(0,I.Z)(Ko,Aa.TRIANGLECOLUMN,Rl),(0,I.Z)(Ko,Aa.SQUARECOLUMN,fc),(0,I.Z)(Ko,Aa.PENTAGONCOLUMN,Su),Ko),Zs={};function Eu(n){var c=ul(n.coordinates);return{vertices:[].concat((0,ti.Z)(c),(0,ti.Z)(c),(0,ti.Z)(c),(0,ti.Z)(c)),indices:[0,1,2,2,3,0],size:c.length}}function hc(n){var c=n.shape,o=ql(c,!1),s=o.positions,l=o.index,d=o.normals;return{vertices:s,indices:l,normals:d,size:5}}function Gu(n){var c=ul(n.coordinates);return{vertices:(0,ti.Z)(c),indices:[0],size:c.length}}function ma(n){var c=n.coordinates,o=n.originCoordinates,s=n.version,l=new rf({dash:!0,join:"bevel"});if(s==="GAODE2.x"){var d=c;Array.isArray(d[0][0])||(d=[c]);var y=o;Array.isArray(y[0][0])||(y=[o]);for(var C=0;C<d.length;C++){var P=d[C],L=y[C];l.extrude_gaode2(P,L)}}else{var J=c;Array.isArray(J[0][0])||(J=[c]),J.forEach(function(le){l.extrude(le)})}var Y=l.complex;return{vertices:Y.positions,indices:Y.indices,normals:Y.normals,size:6}}function Pc(n){var c=n.coordinates,o=eo().flatten(c),s=o.vertices,l=o.dimensions,d=o.holes;return{indices:eo()(s,d,l),vertices:s,size:l}}function Ef(n){var c=n.coordinates,o=Sf(c,!0),s=o.positions,l=o.index,d=o.normals;return{vertices:s,indices:l,normals:d,size:5}}function ll(n){var c=n.shape,o=fl(c),s=o.positions,l=o.index;return{vertices:s,indices:l,size:3}}function nf(n){var c=n.coordinates,o=[].concat((0,ti.Z)(c[0]),[0,0,1,c[1][0],c[0][1],0,1,1],(0,ti.Z)(c[1]),[0,1,0],(0,ti.Z)(c[0]),[0,0,1],(0,ti.Z)(c[1]),[0,1,0,c[0][0],c[1][1],0,0,0]),s=[0,1,2,3,4,5];return{vertices:o,indices:s,size:5}}function Mc(n){for(var c=30,o=n.coordinates,s=[],l=[],d=function(P){s.push(P,1,P,o[0][0],o[0][1],o[1][0],o[1][1],P,-1,P,o[0][0],o[0][1],o[1][0],o[1][1]),P!==c-1&&l.push.apply(l,(0,ti.Z)([0,1,2,1,3,2].map(function(L){return P*2+L})))},y=0;y<c;y++)d(y);return{vertices:s,indices:l,size:7}}function pc(n){var c=n.coordinates;c.length===2&&c.push(0);var o=n.size,s=uu(-1,1),l=uu(1,1),d=uu(-1,-1),y=uu(1,-1),C=[].concat((0,ti.Z)(c),(0,ti.Z)(s),(0,ti.Z)(c),(0,ti.Z)(d),(0,ti.Z)(c),(0,ti.Z)(y),(0,ti.Z)(c),(0,ti.Z)(l)),P=[0,1,2,3,0,2];return{vertices:C,indices:P,size:5}}function ql(n){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Zs&&Zs[n])return Zs[n];var o=Ou[n]?Ou[n]():Ou.cylinder(),s=Sf([o],c);return Zs[n]=s,s}function cl(n,c){for(var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=new Float32Array(n.length/o*3),d,y,C,P=vec3.create(),L=vec3.create(),J=vec3.create(),Y=0,le=c.length;Y<le;Y+=3){d=c[Y+0]*3,y=c[Y+1]*3,C=c[Y+2]*3;var De=[n[d],n[d+1]],ut=[n[y],n[y+1]],Rt=[n[C],n[C+1]];s&&(De=lngLatToMeters(De),ut=lngLatToMeters(ut),Rt=lngLatToMeters(Rt));var mr=De,br=_slicedToArray(mr,2),Zr=br[0],fn=br[1],xn=vec3.fromValues(Zr,fn,n[d+2]),Ln=ut,ni=_slicedToArray(Ln,2),Nn=ni[0],xi=ni[1],Ji=vec3.fromValues(Nn,xi,n[y+2]),ga=Rt,hi=_slicedToArray(ga,2),wa=hi[0],co=hi[1],ju=vec3.fromValues(wa,co,n[C+2]);vec3.sub(P,ju,Ji),vec3.sub(L,xn,Ji),vec3.cross(J,P,L),l[d]+=P[0],l[d+1]+=P[1],l[d+2]+=P[2],l[y]+=P[0],l[y+1]+=P[1],l[y+2]+=P[2],l[C]+=P[0],l[C+1]+=P[1],l[C+2]+=P[2]}return wu(l),l}function wu(n){for(var c=0,o=n.length;c<o;c+=3){var s=vec3.fromValues(n[c],n[c+1],n[c+2]),l=vec3.create();vec3.normalize(l,s),n.set(l,c)}}function ec(n){var c=n[0][0],o=n[0][n[0].length-1];return c[0]===o[0]&&c[1]===o[1]}function fl(n){var c=["cylinder","triangleColumn","hexagonColumn","squareColumn"],o=Ou[n]?Ou[n]():Ou.circle(),s=c.indexOf(n)===-1?Ql([o]):Hf([o]);return s}function uu(n,c){var o=(n+1)/2,s=(c+1)/2;return[o,s]}function dc(n){var c=hl();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function hl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var $s=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Ic=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);
   v_texCoord = a_Uv;
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,Oc=function(n){(0,Ce.Z)(o,n);var c=dc(o);function o(){return(0,W.Z)(this,o),c.apply(this,arguments)}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d,C=l.baseColor,P=C===void 0?"rgb(16,16,16)":C,L=l.brightColor,J=L===void 0?"rgb(255,176,38)":L,Y=l.windowColor,le=Y===void 0?"rgb(30,60,89)":Y,De=l.time,ut=De===void 0?0:De;return{u_opacity:y,u_baseColor:(0,$e.CI)(P),u_brightColor:(0,$e.CI)(J),u_windowColor:(0,$e.CI)(le),u_time:this.layer.getLayerAnimateTime()||ut}}},{key:"initModels",value:function(){return this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:Ic,fragmentShader:$s,triangulation:Ef})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:b.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(d,y,C,P,L){return L}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:b.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(d,y,C,P){var L=d.size,J=L===void 0?10:L;return Array.isArray(J)?[J[0]]:[J]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(d,y,C,P){var L=d.size;return[C[3],C[4]]}}})}}]),o}(vi);function Lc(n){var c=Hu();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Hu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Dl=function(n){(0,Ce.Z)(o,n);var c=Lc(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"type","PolygonLayer"),s}return(0,$.Z)(o,[{key:"buildModels",value:function(){this.layerModel=new Oc(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(l){this.updateLayerConfig({time:l})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),o}(Ps);function tc(n){var c=Wu();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Wu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var kl=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,Rc=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Xu=function(n){(0,Ce.Z)(o,n);var c=tc(o);function o(){return(0,W.Z)(this,o),c.apply(this,arguments)}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.coverage,C=l.angle;return{u_opacity:d||1,u_coverage:y||.9,u_angle:C||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:kl,fragmentShader:Rc,triangulation:ll,depth:{enable:!1},primitive:b.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:b.GC.Attribute,descriptor:{name:"a_Pos",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(d,y){var C=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[C[0],C[1],0]}}})}}]),o}(vi);function No(n){var c=af();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function af(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var of=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,Fl=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Dc=function(n){(0,Ce.Z)(o,n);var c=No(o);function o(){return(0,W.Z)(this,o),c.apply(this,arguments)}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.coverage,C=l.angle;return{u_opacity:d||1,u_coverage:y||1,u_angle:C||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:of,fragmentShader:Fl,triangulation:hc,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:b.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(d,y,C,P){var L=d.size;return Array.isArray(L)?[L[0]]:[L]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:b.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(d,y,C,P,L){return L}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:b.GC.Attribute,descriptor:{name:"a_Pos",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(d,y){var C=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[C[0],C[1],0]}}})}}]),o}(vi),Fa=_(85975);function kc(n,c){for(var o=[],s=[],l=[],d=n+1,y=c+1,C=n/2,P=c/2,L=0;L<y;L++)for(var J=L-P,Y=0;Y<d;Y++){var le=Y-C;s.push(le/C,-J/P,0),l.push(Y/n),l.push(1-L/c)}for(var De=0;De<c;De++)for(var ut=0;ut<n;ut++){var Rt=ut+d*De,mr=ut+d*(De+1),br=ut+1+d*(De+1),Zr=ut+1+d*De;o.push(Rt,mr,Zr),o.push(mr,br,Zr)}return{vertices:s,indices:o,uvs:l}}var Yu,Fc;function Cu(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function Pa(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Cu(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Cu(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function rc(n){var c=Lu();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Lu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ku=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,Hi=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,Ma=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,Us=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,vc=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 3.0;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,nc=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,ic=(Yu=(0,V.b2)(),Yu(Fc=function(n){(0,Ce.Z)(o,n);var c=rc(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"texture",void 0),(0,I.Z)((0,k.Z)(s),"colorTexture",void 0),(0,I.Z)((0,k.Z)(s),"heatmapFramerBuffer",void 0),(0,I.Z)((0,k.Z)(s),"intensityModel",void 0),(0,I.Z)((0,k.Z)(s),"colorModel",void 0),(0,I.Z)((0,k.Z)(s),"shapeType",void 0),s}return(0,$.Z)(o,[{key:"render",value:function(){var l=this,d=this.rendererService,y=d.clear,C=d.useFramebuffer;C(this.heatmapFramerBuffer,function(){y({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l.heatmapFramerBuffer}),l.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var l,d=this.rendererService,y=d.createFramebuffer,C=d.clear,P=d.getViewportSize,L=d.createTexture2D,J=d.useFramebuffer,Y=this.styleAttributeService.getLayerStyleAttribute("shape"),le=(Y==null||(l=Y.scale)===null||l===void 0?void 0:l.field)||"heatmap";this.shapeType=le,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=le==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var De=this.layer.getLayerConfig(),ut=De.rampColors,Rt=(0,$e.Cl)(ut),mr=P(),br=mr.width,Zr=mr.height;return this.heatmapFramerBuffer=y({color:L({width:Math.floor(br/4),height:Math.floor(Zr/4),wrapS:b.gl.CLAMP_TO_EDGE,wrapT:b.gl.CLAMP_TO_EDGE,min:b.gl.LINEAR,mag:b.gl.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:b.GC.Attribute,descriptor:{name:"a_Dir",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(d,y,C,P){return[C[3],C[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:b.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(d,y,C,P){var L=d.size,J=L===void 0?1:L;return[J]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:vc,fragmentShader:Us,triangulation:pc,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:b.gl.ONE,srcAlpha:1,dstRGB:b.gl.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:nc,fs:Ma});var l=this.shaderModuleService.getModule("heatmapColor"),d=l.vs,y=l.fs,C=l.uniforms,P=this.rendererService,L=P.createAttribute,J=P.createElements,Y=P.createBuffer,le=P.createModel;return le({vs:d,fs:y,attributes:{a_Position:L({buffer:Y({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:b.gl.FLOAT}),size:3}),a_Uv:L({buffer:Y({data:[0,1,1,1,0,0,1,0],type:b.gl.FLOAT}),size:2})},uniforms:Pa({},C),depth:{enable:!1},blend:this.getBlend(),count:6,elements:J({data:[0,2,1,2,3,1],type:b.gl.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.intensity,C=y===void 0?10:y,P=l.radius,L=P===void 0?5:P;this.intensityModel.draw({uniforms:{u_opacity:d||1,u_radius:L,u_intensity:C}})}},{key:"drawColorMode",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;this.colorModel.draw({uniforms:{u_opacity:d||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=Fa.create();Fa.invert(y,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:d||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,ti.Z)(y)}})}},{key:"build3dHeatMap",value:function(){var l=this.rendererService.getViewportSize,d=l(),y=d.width,C=d.height,P=kc(y/4,C/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:Hi,fs:Ku});var L=this.shaderModuleService.getModule("heatmap3dColor"),J=L.vs,Y=L.fs,le=L.uniforms,De=this.rendererService,ut=De.createAttribute,Rt=De.createElements,mr=De.createBuffer,br=De.createModel;return br({vs:J,fs:Y,attributes:{a_Position:ut({buffer:mr({data:P.vertices,type:b.gl.FLOAT}),size:3}),a_Uv:ut({buffer:mr({data:P.uvs,type:b.gl.FLOAT}),size:2})},primitive:b.gl.TRIANGLES,uniforms:Pa({},le),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:b.gl.SRC_ALPHA,srcAlpha:1,dstRGB:b.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:Rt({data:P.indices,type:b.gl.UNSIGNED_INT,count:P.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var l=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var d=this.layer.getLayerConfig(),y=d.rampColors,C=(0,$e.Cl)(y);this.colorTexture=l({data:new Uint8Array(C.data),width:C.width,height:C.height,wrapS:b.gl.CLAMP_TO_EDGE,wrapT:b.gl.CLAMP_TO_EDGE,min:b.gl.NEAREST,mag:b.gl.NEAREST,flipY:!1})}}]),o}(vi))||Fc);function Of(n){var c=Lf();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Lf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ac=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,$u=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Ru=function(n){(0,Ce.Z)(o,n);var c=Of(o);function o(){return(0,W.Z)(this,o),c.apply(this,arguments)}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.coverage,C=l.angle;return{u_opacity:d||1,u_coverage:y||.9,u_angle:C||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:$u,fragmentShader:ac,triangulation:ll,depth:{enable:!1},primitive:b.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:b.GC.Attribute,descriptor:{name:"a_Pos",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(d,y){var C=d.version==="GAODE2.x"?d.originCoordinates:d.coordinates;return[C[0],C[1],0]}}})}}]),o}(vi),ro={heatmap:ic,heatmap3d:ic,grid:Xu,grid3d:Dc,hexagon:Ru},hs=ro;function pl(n){var c=Va();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Va(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var wn=function(n){(0,Ce.Z)(o,n);var c=pl(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"type","HeatMapLayer"),s}return(0,$.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new hs[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var l=this,d=this.getModelType();return d==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(y){return y.draw({uniforms:l.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),y=this.getLayerConfig(),C=y.shape3d,P=this.getSource(),L=P.data.type,J=(d==null||(l=d.scale)===null||l===void 0?void 0:l.field)||"heatmap";return J==="heatmap"||J==="heatmap3d"?"heatmap":L==="hexagon"?(C==null?void 0:C.indexOf(J))===-1?"hexagon":"grid3d":L==="grid"?(C==null?void 0:C.indexOf(J))===-1?"grid":"grid3d":"heatmap"}}]),o}(Ps);function js(n){var c=mc();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function mc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Bl=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,lu=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Vs=function(n){(0,Ce.Z)(o,n);var c=js(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"texture",void 0),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;return{u_opacity:d||1,u_texture:this.texture}}},{key:"initModels",value:function(){var l=this,d=this.layer.getSource(),y=this.rendererService.createTexture2D;return this.texture=y({height:0,width:0}),d.data.images.then(function(C){l.texture=y({data:C[0],width:C[0].width,height:C[0].height}),l.layerService.renderLayers()}),[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:lu,fragmentShader:Bl,triangulation:nf,primitive:b.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(d,y,C,P){return[C[3],C[4]]}}})}}]),o}(vi),dl={image:Vs},$r=dl;function Bc(n){var c=gc();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function gc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ju=function(n){(0,Ce.Z)(o,n);var c=Bc(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"type","ImageLayer"),s}return(0,$.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new $r[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={image:{}};return d[l]}},{key:"getModelType",value:function(){return"image"}}]),o}(Ps);function Js(n){var c=Ms();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Ms(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Nc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // gl_FragColor = v_color;
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, v_distance_ratio);
    // float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);

    float u = 1.0 - fract(arcRadio * count + animateSpeed);

    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }
    float v = length(v_offset)/(v_a); // \u6A2A\u5411
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    // gl_FragColor = vec4(1.0 - fract(arcRadio * 20000.0), 0.0, 0.0, 1.0);
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
    // gl_FragColor = filterColor(texture2D(u_texture, uv));
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);

}`,zc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  

  vec2 source = a_Instance.rg;
  vec2 target =  a_Instance.ba;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  if(u_line_type == LineTypeDash) {
      v_distance_ratio = segmentIndex / segmentNumber;
      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        v_distance_ratio = 1.0 - v_distance_ratio;
      }
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  v_segmentIndex = a_Position.x + 1.0;
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    v_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      v_arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // v_arcDistrance *= 8.0;
      v_arcDistrance = project_pixel_allmap(v_arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;
    v_pixelLen = project_pixel(u_icon_step);
    v_a = project_pixel(a_Size);
    v_offset = offset + offset * sign(a_Position.y);
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Gs={solid:0,dash:1},Qu=function(n){(0,Ce.Z)(o,n);var c=Js(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"texture",void 0),(0,I.Z)((0,k.Z)(s),"updateTexture",function(){var C=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=C({data:s.iconService.getCanvas(),mag:b.gl.NEAREST,min:b.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.sourceColor,C=l.targetColor,P=l.textureBlend,L=P===void 0?"normal":P,J=l.lineType,Y=J===void 0?"solid":J,le=l.dashArray,De=le===void 0?[10,5]:le,ut=l.forward,Rt=ut===void 0?!0:ut,mr=l.lineTexture,br=mr===void 0?!1:mr,Zr=l.iconStep,fn=Zr===void 0?100:Zr;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var xn=this.layer.getEncodedData(),Ln=this.calDataFrame(this.cellLength,xn,this.cellProperties),ni=Ln.data,Nn=Ln.width,xi=Ln.height;this.rowCount=xi,this.dataTexture=this.cellLength>0&&ni.length>0?this.createTexture2D({flipY:!0,data:ni,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:Nn,height:xi}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}De.length===2&&De.push(0,0);var Ji=0,ga=[0,0,0,0],hi=[0,0,0,0];return y&&C&&(ga=(0,$e.CI)(y),hi=(0,$e.CI)(C),Ji=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:va()(d)?d:1,u_textureBlend:L==="normal"?0:1,segmentNumber:30,u_line_type:Gs[Y||"solid"],u_dash_array:De,u_blur:.9,u_lineDir:Rt?1:-1,u_texture:this.texture,u_line_texture:br?1:0,u_icon_step:fn,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ji,u_sourceColor:ga,u_targetColor:hi}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:zc,fragmentShader:Nc,triangulation:Mc,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:b.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(y,C,P,L){var J=y.size,Y=J===void 0?1:J;return Array.isArray(Y)?[Y[0]]:[Y]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:b.GC.Attribute,descriptor:{name:"a_Instance",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:4,update:function(y,C,P,L){return[P[3],P[4],P[5],P[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(y,C,P,L){var J=l.iconService.getIconMap(),Y=y.texture,le=J[Y]||{x:0,y:0},De=le.x,ut=le.y;return[De,ut]}}})}}]),o}(vi);function Nl(n){var c=Du();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Du(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Zc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);

    float u = fract(arcRadio * count - animateSpeed * count);
 
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }
    float v = length(v_offset)/(v_a); // \u6A2A\u5411

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,yc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;
varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

   if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    v_arcDistrance = length(source - target);
    v_pixelLen = project_pixel(u_icon_step);

    vec2 projectOffset = project_pixel(offset);
    v_offset = projectOffset + projectOffset * sign(a_Position.y);
    v_a = project_pixel(a_Size);
    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,cu={solid:0,dash:1},Is=function(n){(0,Ce.Z)(o,n);var c=Nl(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"texture",void 0),(0,I.Z)((0,k.Z)(s),"updateTexture",function(){var C=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=C({data:s.iconService.getCanvas(),mag:b.gl.NEAREST,min:b.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.sourceColor,C=l.targetColor,P=l.textureBlend,L=P===void 0?"normal":P,J=l.lineType,Y=J===void 0?"solid":J,le=l.dashArray,De=le===void 0?[10,5]:le,ut=l.lineTexture,Rt=ut===void 0?!1:ut,mr=l.iconStep,br=mr===void 0?100:mr;De.length===2&&De.push(0,0);var Zr=0,fn=[0,0,0,0],xn=[0,0,0,0];if(y&&C&&(fn=(0,$e.CI)(y),xn=(0,$e.CI)(C),Zr=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var Ln=this.layer.getEncodedData(),ni=this.calDataFrame(this.cellLength,Ln,this.cellProperties),Nn=ni.data,xi=ni.width,Ji=ni.height;this.rowCount=Ji,this.dataTexture=this.cellLength>0&&Nn.length>0?this.createTexture2D({flipY:!0,data:Nn,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:xi,height:Ji}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:va()(d)?d:1,u_textureBlend:L==="normal"?0:1,segmentNumber:30,u_line_type:cu[Y]||0,u_dash_array:De,u_texture:this.texture,u_line_texture:Rt?1:0,u_icon_step:br,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Zr,u_sourceColor:fn,u_targetColor:xn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:yc,fragmentShader:Zc,triangulation:Mc,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:b.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(y,C,P,L){var J=y.size,Y=J===void 0?1:J;return Array.isArray(Y)?[Y[0]]:[Y]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:b.GC.Attribute,descriptor:{name:"a_Instance",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:4,update:function(y,C,P,L){return[P[3],P[4],P[5],P[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(y,C,P,L){var J=l.iconService.getIconMap(),Y=y.texture,le=J[Y]||{x:0,y:0},De=le.x,ut=le.y;return[De,ut]}}})}}]),o}(vi);function Bi(n){var c=Qs();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Qs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var $o=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying vec2 v_offset;
varying float v_a;
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  // gl_FragColor = v_color;
  
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F
    float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = length(v_offset)/(v_a); // \u6A2A\u5411

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,Ao=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying vec2 v_offset;
varying float v_a;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // v_arcDistrance = length(source - target);
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    v_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      v_arcDistrance = v_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
    //   v_arcDistrance *= 10.0;
      v_arcDistrance = project_pixel_allmap(v_arcDistrance);
    }
    v_pixelLen = project_pixel(u_icon_step)/8.0;

    v_a = project_pixel(a_Size);
    v_offset = offset + offset * sign(a_Position.y);
    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,vl={solid:0,dash:1},qu=function(n){(0,Ce.Z)(o,n);var c=Bi(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"texture",void 0),(0,I.Z)((0,k.Z)(s),"updateTexture",function(){var C=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=C({data:s.iconService.getCanvas(),mag:b.gl.NEAREST,min:b.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.sourceColor,C=l.targetColor,P=l.textureBlend,L=P===void 0?"normal":P,J=l.lineType,Y=J===void 0?"solid":J,le=l.dashArray,De=le===void 0?[10,5]:le,ut=l.lineTexture,Rt=ut===void 0?!1:ut,mr=l.iconStep,br=mr===void 0?100:mr;De.length===2&&De.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Zr=0,fn=[0,0,0,0],xn=[0,0,0,0];if(y&&C&&(fn=(0,$e.CI)(y),xn=(0,$e.CI)(C),Zr=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var Ln=this.layer.getEncodedData(),ni=this.calDataFrame(this.cellLength,Ln,this.cellProperties),Nn=ni.data,xi=ni.width,Ji=ni.height;this.rowCount=Ji,this.dataTexture=this.cellLength>0&&Nn.length>0?this.createTexture2D({flipY:!0,data:Nn,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:xi,height:Ji}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:va()(d)?d:1,u_textureBlend:L==="normal"?0:1,segmentNumber:30,u_line_type:vl[Y]||0,u_dash_array:De,u_texture:this.texture,u_line_texture:Rt?1:0,u_icon_step:br,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Zr,u_sourceColor:fn,u_targetColor:xn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:Ao,fragmentShader:$o,triangulation:Mc,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:b.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(y,C,P,L){var J=y.size,Y=J===void 0?1:J;return Array.isArray(Y)?[Y[0]]:[Y]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:b.GC.Attribute,descriptor:{name:"a_Instance",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:4,update:function(y,C,P,L){return[P[3],P[4],P[5],P[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(y,C,P,L){var J=l.iconService.getIconMap(),Y=y.texture,le=J[Y]||{x:0,y:0},De=le.x,ut=le.y;return[De,ut]}}})}}]),o}(vi);function fu(n){var c=is();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function is(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var zl=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
varying vec4 v_color;
varying vec2 v_normal;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying float v_distance_ratio;
varying vec4 v_dash_array;
varying float v_side;

varying float v_distance;
varying vec2 v_offset;
varying float v_a;
varying float v_pixelLen;
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  
  // gl_FragColor = v_color;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
    // gl_FragColor.a *=(1.0- step(v_dash_array.x, mod(v_distance_ratio, dashLength)));
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float u = fract(mod(v_distance, v_pixelLen)/v_pixelLen - animateSpeed);
    float v = length(v_offset)/(v_a*2.0);
    v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(vec4(1.0, 0.0, 0.0, 1.0));
 
  // if(rV < r || rV > 1.0 - r) {
  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  // } 
  // float v = length(v_offset)/(v_a*2.0);
  // if(v > 0.9) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // } else if(v < 0.1) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,Un=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying vec2 v_normal;
varying float v_distance_ratio;
varying float v_side;

varying float v_distance;
varying vec2 v_offset;
varying float v_size;
varying float v_a;
varying float v_pixelLen;
varying vec2 v_iconMapUV;
uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_iconMapUV = a_iconMapUV;
  v_distance = a_Distance;
  v_pixelLen = project_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    v_pixelLen *= 10.0;
  }

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = a_Distance / a_Total_Distance;
    // v_distance_ratio = 0.01;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      v_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));


  v_color = a_Color;
  v_a = project_pixel(a_Size.x);
  

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  v_offset = offset + offset * sign(a_Miter);

  v_side = a_Miter * a_Size.x;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 8.0, 1.0)); // \u989D\u5916\u9664 8.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      lineHeight = lineHeight*2.0/pow(2.0, 20.0 - u_Zoom);
    }
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,On={solid:0,dash:1},Zl=function(n){(0,Ce.Z)(o,n);var c=fu(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"texture",void 0),(0,I.Z)((0,k.Z)(s),"updateTexture",function(){var C=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=C({data:s.iconService.getCanvas(),mag:b.gl.NEAREST,min:b.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.sourceColor,C=l.targetColor,P=l.textureBlend,L=P===void 0?"normal":P,J=l.lineType,Y=J===void 0?"solid":J,le=l.dashArray,De=le===void 0?[10,5,0,0]:le,ut=l.lineTexture,Rt=ut===void 0?!1:ut,mr=l.iconStep,br=mr===void 0?100:mr;De.length===2&&De.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Zr=0,fn=[0,0,0,0],xn=[0,0,0,0];if(y&&C&&(fn=(0,$e.CI)(y),xn=(0,$e.CI)(C),Zr=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var Ln=this.layer.getEncodedData(),ni=this.calDataFrame(this.cellLength,Ln,this.cellProperties),Nn=ni.data,xi=ni.width,Ji=ni.height;this.rowCount=Ji,this.dataTexture=this.cellLength>0&&Nn.length>0?this.createTexture2D({flipY:!0,data:Nn,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:xi,height:Ji}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:va()(d)?d:1,u_textureBlend:L==="normal"?0:1,u_line_type:On[Y],u_dash_array:De,u_texture:this.texture,u_line_texture:Rt?1:0,u_icon_step:br,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Zr,u_sourceColor:fn,u_targetColor:xn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:Un,fragmentShader:zl,triangulation:ma,primitive:b.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var l=this,d=this.layer.getLayerConfig(),y=d.lineType,C=y===void 0?"solid":y;this.styleAttributeService.registerStyleAttribute({name:"distance",type:b.GC.Attribute,descriptor:{name:"a_Distance",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(L,J,Y,le){return[Y[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:b.GC.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(L,J,Y,le){return[Y[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:b.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(L,J,Y,le){var De=L.size,ut=De===void 0?1:De;return Array.isArray(ut)?[ut[0],ut[1]]:[ut,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:b.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(L,J,Y,le,De){return De}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:b.GC.Attribute,descriptor:{name:"a_Miter",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(L,J,Y,le){return[Y[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.GC.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(L,J,Y,le){var De=l.iconService.getIconMap(),ut=L.texture,Rt=De[ut]||{x:0,y:0},mr=Rt.x,br=Rt.y;return[mr,br]}}})}},{key:"loadImage",value:function(l){return new Promise(function(d,y){if(l instanceof HTMLImageElement){d(l);return}var C=new Image;C.crossOrigin="anonymous",C.onload=function(){d(C)},C.onerror=function(){y(new Error("Could not load image at "+l))},C.src=l instanceof File?URL.createObjectURL(l):l})}}]),o}(vi),ps={arc:Qu,arc3d:Is,greatcircle:qu,line:Zl},Do=ps;function zo(n){var c=ku();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function ku(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var hu=function(n){(0,Ce.Z)(o,n);var c=zo(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"type","LineLayer"),s}return(0,$.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Do[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"}};return d[l]}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),y=d==null||(l=d.scale)===null||l===void 0?void 0:l.field;return y||"line"}}]),o}(Ps);function Ul(n){var c=ra();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function ra(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var po=`varying vec4 v_color;
uniform float u_opacity: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Uc=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);

  float lightWeight = calc_lighting(pos);
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  setPickingColor(a_PickingColor);
}
`,Fu=function(n){(0,Ce.Z)(o,n);var c=Ul(o);function o(){return(0,W.Z)(this,o),c.apply(this,arguments)}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:y})){this.judgeStyleAttributes({opacity:y});var C=this.layer.getEncodedData(),P=this.calDataFrame(this.cellLength,C,this.cellProperties),L=P.data,J=P.width,Y=P.height;this.rowCount=Y,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:J,height:Y}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:va()(y)?y:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:Uc,fragmentShader:po,triangulation:hc,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:b.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(d,y,C,P){var L=d.size;if(L){var J=[];return Array.isArray(L)&&(J=L.length===2?[L[0],L[0],L[1]]:L),Array.isArray(L)||(J=[L]),J}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:b.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(d,y,C,P,L){return L}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:b.GC.Attribute,descriptor:{name:"a_Pos",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(d,y){var C=ul(d.coordinates);return[C[0],C[1],0]}}})}}]),o}(vi);function _c(n){var c=Bu();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Bu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Os=`#define Animate 0.0

uniform float u_blur : 0;
// uniform float u_stroke_width : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

 
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float antialiased_blur = -max(u_blur, antialiasblur);
  // float r = v_radius / (v_radius + u_stroke_width);
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);
  // float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
  //   antialiased_blur,
  //   0.0,
  //   inner_df
  // );
   float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);

  
  gl_FragColor.a = gl_FragColor.a * opacity_t;
  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    gl_FragColor = vec4(gl_FragColor.xyz, intensity);
  }

  gl_FragColor = filterColor(gl_FragColor);

}
`,oc=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec2 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec2 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  float antialiasblur = 1.0 / u_DevicePixelRatio / (newSize + u_stroke_width);

  // construct point coords
  v_data = vec4(extrude, antialiasblur,shape_type);

  // vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + u_offsets);
  vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + textrueOffsets);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,as=function(n){(0,Ce.Z)(o,n);var c=_c(o);function o(){return(0,W.Z)(this,o),c.apply(this,arguments)}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d,C=l.strokeOpacity,P=C===void 0?1:C,L=l.strokeWidth,J=L===void 0?0:L,Y=l.stroke,le=Y===void 0?"rgba(0,0,0,0)":Y,De=l.offsets,ut=De===void 0?[0,0]:De;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:y,strokeOpacity:P,strokeWidth:J,stroke:le,offsets:ut})){this.judgeStyleAttributes({opacity:y,strokeOpacity:P,strokeWidth:J,stroke:le,offsets:ut});var Rt=this.layer.getEncodedData(),mr=this.calDataFrame(this.cellLength,Rt,this.cellProperties),br=mr.data,Zr=mr.width,fn=mr.height;this.rowCount=fn,this.dataTexture=this.cellLength>0&&br.length>0?this.createTexture2D({flipY:!0,data:br,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:Zr,height:fn}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:va()(y)?y:1,u_stroke_opacity:va()(P)?P:1,u_stroke_width:va()(J)?J:0,u_stroke_color:this.getStrokeColor(le),u_offsets:this.isOffsetStatic(ut)?ut:[0,0]}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),d=l.animateOption;return{u_aimate:this.animateOption2Array(d),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Eu)}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:oc,fragmentShader:Os,triangulation:Eu,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"animateOption2Array",value:function(l){return[l.enable?0:1,l.speed||1,l.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:b.GC.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(y,C,P,L){var J=[1,1,-1,1,-1,-1,1,-1],Y=L%4*2;return[J[Y],J[Y+1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:b.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(y,C,P,L){var J=y.size,Y=J===void 0?5:J;return Array.isArray(Y)?[Y[0]]:[Y]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:b.GC.Attribute,descriptor:{name:"a_Shape",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(y,C,P,L){var J=y.shape,Y=J===void 0?2:J,le=l.layer.getLayerConfig().shape2d,De=le.indexOf(Y);return[De]}}})}}]),o}(vi);function xc(n){var c=jl();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function jl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var sc=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_size;
#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,jc=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;
varying float v_size;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   v_size = a_Size;
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,uc=function(n){(0,Ce.Z)(o,n);var c=xc(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"texture",void 0),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity;return{u_opacity:d||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var l=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){l.updateTexture(),l.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:jc,fragmentShader:sc,triangulation:Gu,primitive:b.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:b.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(y,C,P,L){var J=y.size;return Array.isArray(J)?[J[0]]:[J]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(y,C,P,L){var J=l.fontService.mapping,Y=y.shape,le=l.fontService.getGlyph(Y),De=J[le],ut=De.x,Rt=De.y;return[ut,Rt]}}})}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,d=this.fontService.canvas;this.texture=l({data:d,mag:b.gl.LINEAR,min:b.gl.LINEAR,width:d.width,height:d.height})}},{key:"initIconFontGlyphs",value:function(){var l=this,d=this.layer.getLayerConfig(),y=d.fontWeight,C=y===void 0?"normal":y,P=d.fontFamily,L=P===void 0?"sans-serif":P,J=this.layer.getEncodedData(),Y=[];J.forEach(function(le){var De=le.shape,ut=De===void 0?"":De;ut=ut.toString();var Rt=l.fontService.getGlyph(ut);Y.indexOf(Rt)===-1&&Y.push(Rt)}),this.fontService.setFontOptions({characterSet:Y,fontWeight:C,fontFamily:L,fontSize:48})}}]),o}(vi);function ml(n){var c=Vc();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Vc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var gl=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_size;
#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,yl=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;
varying float v_size;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   v_size = a_Size;
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,_l=function(n){(0,Ce.Z)(o,n);var c=ml(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"texture",void 0),(0,I.Z)((0,k.Z)(s),"updateTexture",function(){var C=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=C({data:s.iconService.getCanvas(),mag:b.gl.NEAREST,min:b.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=l.offsets,C=y===void 0?[0,0]:y;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,offsets:C})){this.judgeStyleAttributes({opacity:d,offsets:C});var P=this.layer.getEncodedData(),L=this.calDataFrame(this.cellLength,P,this.cellProperties),J=L.data,Y=L.width,le=L.height;this.rowCount=le,this.dataTexture=this.cellLength>0&&J.length>0?this.createTexture2D({flipY:!0,data:J,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:Y,height:le}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:va()(d)?d:1,u_offsets:this.isOffsetStatic(C)?C:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,d;(l=this.texture)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:yl,fragmentShader:gl,triangulation:Gu,primitive:b.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:b.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(y,C,P,L){var J=y.size,Y=J===void 0?5:J;return Array.isArray(Y)?[Y[0]]:[Y]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(y,C,P,L){var J=l.iconService.getIconMap(),Y=y.shape,le=J[Y]||{x:0,y:0},De=le.x,ut=le.y;return[De,ut]}}})}}]),o}(vi);function pu(n){var c=qs();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function qs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Gc=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,bc=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;



uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function sf(n){var c=n.coordinates;return{vertices:(0,ti.Z)(c),indices:[0],size:c.length}}var Sc=function(n){(0,Ce.Z)(o,n);var c=pu(o);function o(){return(0,W.Z)(this,o),c.apply(this,arguments)}return(0,$.Z)(o,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d,C=l.offsets,P=C===void 0?[0,0]:C;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:y,offsets:P})){this.judgeStyleAttributes({opacity:y,offsets:P});var L=this.layer.getEncodedData(),J=this.calDataFrame(this.cellLength,L,this.cellProperties),Y=J.data,le=J.width,De=J.height;this.rowCount=De,this.dataTexture=this.cellLength>0&&Y.length>0?this.createTexture2D({flipY:!0,data:Y,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:le,height:De}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:va()(y)?y:1,u_offsets:this.isOffsetStatic(P)?P:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:bc,fragmentShader:Gc,triangulation:sf,depth:{enable:!1},primitive:b.gl.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:b.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(d,y,C,P){var L=d.size,J=L===void 0?1:L;return Array.isArray(J)?[J[0]]:[J]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:b.h0.additive}}}]),o}(vi),i=_(98333);function u(n,c){var o=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!o){if(Array.isArray(n)||(o=a(n))||c&&n&&typeof n.length=="number"){o&&(n=o);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(L){throw L},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,y=!1,C;return{s:function(){o=o.call(n)},n:function(){var L=o.next();return d=L.done,L},e:function(L){y=!0,C=L},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(y)throw C}}}}function a(n,c){if(!!n){if(typeof n=="string")return h(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return h(n,c)}}function h(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}var g=function(){function n(c,o,s){(0,W.Z)(this,n),(0,I.Z)(this,"boxCells",[]),(0,I.Z)(this,"xCellCount",void 0),(0,I.Z)(this,"yCellCount",void 0),(0,I.Z)(this,"boxKeys",void 0),(0,I.Z)(this,"bboxes",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"xScale",void 0),(0,I.Z)(this,"yScale",void 0),(0,I.Z)(this,"boxUid",void 0);var l=this.boxCells;this.xCellCount=Math.ceil(c/s),this.yCellCount=Math.ceil(o/s);for(var d=0;d<this.xCellCount*this.yCellCount;d++)l.push([]);this.boxKeys=[],this.bboxes=[],this.width=c,this.height=o,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/o,this.boxUid=0}return(0,$.Z)(n,[{key:"insert",value:function(o,s,l,d,y){this.forEachCell(s,l,d,y,this.insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(y)}},{key:"query",value:function(o,s,l,d,y){return this.queryHitTest(o,s,l,d,!1,y)}},{key:"hitTest",value:function(o,s,l,d,y){return this.queryHitTest(o,s,l,d,!0,y)}},{key:"insertBoxCell",value:function(o,s,l,d,y,C){this.boxCells[y].push(C)}},{key:"queryHitTest",value:function(o,s,l,d,y,C){if(l<0||o>this.width||d<0||s>this.height)return y?!1:[];var P=[];if(o<=0&&s<=0&&this.width<=l&&this.height<=d){if(y)return!0;for(var L=0;L<this.boxKeys.length;L++)P.push({key:this.boxKeys[L],x1:this.bboxes[L*4],y1:this.bboxes[L*4+1],x2:this.bboxes[L*4+2],y2:this.bboxes[L*4+3]});return C?P.filter(C):P}var J={hitTest:y,seenUids:{box:{},circle:{}}};return this.forEachCell(o,s,l,d,this.queryCell,P,J,C),y?P.length>0:P}},{key:"queryCell",value:function(o,s,l,d,y,C,P,L){var J=P.seenUids,Y=this.boxCells[y];if(Y!==null){var le=this.bboxes,De=u(Y),ut;try{for(De.s();!(ut=De.n()).done;){var Rt=ut.value;if(!J.box[Rt]){J.box[Rt]=!0;var mr=Rt*4;if(o<=le[mr+2]&&s<=le[mr+3]&&l>=le[mr+0]&&d>=le[mr+1]&&(!L||L(this.boxKeys[Rt]))){if(P.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[Rt],x1:le[mr],y1:le[mr+1],x2:le[mr+2],y2:le[mr+3]})}}}}catch(br){De.e(br)}finally{De.f()}}return!1}},{key:"forEachCell",value:function(o,s,l,d,y,C,P,L){for(var J=this.convertToXCellCoord(o),Y=this.convertToYCellCoord(s),le=this.convertToXCellCoord(l),De=this.convertToYCellCoord(d),ut=J;ut<=le;ut++)for(var Rt=Y;Rt<=De;Rt++){var mr=this.xCellCount*Rt+ut;if(y.call(this,o,s,l,d,mr,C,P,L))return}}},{key:"convertToXCellCoord",value:function(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}},{key:"convertToYCellCoord",value:function(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}}]),n}(),S=g,T=function(){function n(c,o){(0,W.Z)(this,n),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"grid",void 0),(0,I.Z)(this,"viewportPadding",100),(0,I.Z)(this,"screenRightBoundary",void 0),(0,I.Z)(this,"screenBottomBoundary",void 0),(0,I.Z)(this,"gridRightBoundary",void 0),(0,I.Z)(this,"gridBottomBoundary",void 0),this.width=c,this.height=o,this.viewportPadding=Math.max(c,o),this.grid=new S(c+this.viewportPadding,o+this.viewportPadding,25),this.screenRightBoundary=c+this.viewportPadding,this.screenBottomBoundary=o+this.viewportPadding,this.gridRightBoundary=c+2*this.viewportPadding,this.gridBottomBoundary=o+2*this.viewportPadding}return(0,$.Z)(n,[{key:"placeCollisionBox",value:function(o){var s=o.x1+o.anchorPointX+this.viewportPadding,l=o.y1+o.anchorPointY+this.viewportPadding,d=o.x2+o.anchorPointX+this.viewportPadding,y=o.y2+o.anchorPointY+this.viewportPadding;return!this.isInsideGrid(s,l,d,y)||this.grid.hitTest(s,l,d,y)?{box:[]}:{box:[s,l,d,y]}}},{key:"insertCollisionBox",value:function(o,s){var l={featureIndex:s};this.grid.insert(l,o[0],o[1],o[2],o[3])}},{key:"project",value:function(o,s,l){var d=i.al(s,l,0,1),y=i.Ue(),C=Fa.fromValues.apply(Fa,(0,ti.Z)(o));return i.fF(y,d,C),{x:(y[0]/y[3]+1)/2*this.width+this.viewportPadding,y:(-y[1]/y[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(o,s,l,d){return l>=0&&o<this.gridRightBoundary&&d>=0&&s<this.gridBottomBoundary}}]),n}();function R(n,c){var o=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!o){if(Array.isArray(n)||(o=G(n))||c&&n&&typeof n.length=="number"){o&&(n=o);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(L){throw L},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,y=!1,C;return{s:function(){o=o.call(n)},n:function(){var L=o.next();return d=L.done,L},e:function(L){y=!0,C=L},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(y)throw C}}}}function G(n,c){if(!!n){if(typeof n=="string")return ee(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return ee(n,c)}}function ee(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}function ve(n){var c=.5,o=.5;switch(n){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0;break;default:c=.5}switch(n){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0;break;default:o=.5}return{horizontalAlign:c,verticalAlign:o}}function ye(n,c,o,s,l){if(!!l){var d=n[s],y=d.glyph;if(y)for(var C=c[y].advance*d.scale,P=(n[s].x+C)*l,L=o;L<=s;L++)n[L].x-=P}}function we(n,c,o,s,l,d,y){var C=(c-o)*l,P=(-s*y+.5)*d,L=R(n),J;try{for(L.s();!(J=L.n()).done;){var Y=J.value;Y.x+=C,Y.y+=P}}catch(le){L.e(le)}finally{L.f()}}function Ke(n,c,o,s,l,d,y){var C=-8,P=0,L=C,J=0,Y=n.positionedGlyphs,le=d==="right"?1:d==="left"?0:.5,De=Y.length;o.forEach(function(Zr){if(Zr.split("").forEach(function(xn){var Ln=c[xn],ni=0;Ln&&(Y.push({glyph:xn,x:P,y:L+ni,vertical:!1,scale:1,metrics:Ln}),P+=Ln.advance+y)}),Y.length!==De){var fn=P-y;J=Math.max(fn,J),ye(Y,c,De,Y.length-1,le)}P=0,L+=s});var ut=ve(l),Rt=ut.horizontalAlign,mr=ut.verticalAlign;we(Y,le,Rt,mr,J,s,o.length);var br=L-C;n.top+=-mr*br,n.bottom=n.top+br,n.left+=-Rt*J,n.right=n.left+J}function He(n,c,o,s,l,d,y){var C=-8,P=0,L=C,J=0,Y=n.positionedGlyphs,le=d==="right"?1:d==="left"?0:.5,De=Y.length;o.forEach(function(Zr){var fn=c[Zr],xn=0;if(fn&&(Y.push({glyph:Zr,x:P,y:L+xn,vertical:!1,scale:1,metrics:fn}),P+=fn.advance+y),Y.length!==De){var Ln=P-y;J=Math.max(Ln,J),ye(Y,c,De,Y.length-1,le)}P=0,L+=s});var ut=ve(l),Rt=ut.horizontalAlign,mr=ut.verticalAlign;we(Y,le,Rt,mr,J,s,o.length);var br=L-C;n.top+=-mr*br,n.bottom=n.top+br,n.left+=-Rt*J,n.right=n.left+J}function at(n,c,o,s,l,d){var y=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],C=arguments.length>7?arguments[7]:void 0,P=n.split(`
`),L=[],J={positionedGlyphs:L,top:y[1],bottom:y[1],left:y[0],right:y[0],lineCount:P.length,text:n};return C?He(J,c,P,o,s,l,d):Ke(J,c,P,o,s,l,d),L.length?J:!1}function ze(n){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],o=arguments.length>2?arguments[2]:void 0,s=n.positionedGlyphs,l=s===void 0?[]:s,d=[],y=R(l),C;try{for(y.s();!(C=y.n()).done;){var P=C.value,L=P.metrics,J=4,Y=L.advance*P.scale/2,le=o?[P.x+Y,P.y]:[0,0],De=o?[0,0]:[P.x+Y+c[0],P.y+c[1]],ut=(0-J)*P.scale-Y+De[0],Rt=(0-J)*P.scale+De[1],mr=ut+L.width*P.scale,br=Rt+L.height*P.scale,Zr={x:ut,y:Rt},fn={x:mr,y:Rt},xn={x:ut,y:br},Ln={x:mr,y:br};d.push({tl:Zr,tr:fn,bl:xn,br:Ln,tex:L,glyphOffset:le})}}catch(ni){y.e(ni)}finally{y.f()}return d}function it(n,c){var o=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!o){if(Array.isArray(n)||(o=mt(n))||c&&n&&typeof n.length=="number"){o&&(n=o);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(L){throw L},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,y=!1,C;return{s:function(){o=o.call(n)},n:function(){var L=o.next();return d=L.done,L},e:function(L){y=!0,C=L},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(y)throw C}}}}function mt(n,c){if(!!n){if(typeof n=="string")return Ut(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Ut(n,c)}}function Ut(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}function sr(n){var c=nr();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function nr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var cr=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Rr=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function tn(n){var c=this,o=n.id,s=[],l=[];if(!c.glyphInfoMap||!c.glyphInfoMap[o])return{vertices:[],indices:[],size:7};var d=c.glyphInfoMap[o].centroid,y=d.length===2?[d[0],d[1],0]:d;return c.glyphInfoMap[o].glyphQuads.forEach(function(C,P){s.push.apply(s,(0,ti.Z)(y).concat([C.tex.x,C.tex.y+C.tex.height,C.tl.x,C.tl.y],(0,ti.Z)(y),[C.tex.x+C.tex.width,C.tex.y+C.tex.height,C.tr.x,C.tr.y],(0,ti.Z)(y),[C.tex.x+C.tex.width,C.tex.y,C.br.x,C.br.y],(0,ti.Z)(y),[C.tex.x,C.tex.y,C.bl.x,C.bl.y])),l.push(0+P*4,1+P*4,2+P*4,2+P*4,3+P*4,0+P*4)}),{vertices:s,indices:l,size:7}}var Xr=function(n){(0,Ce.Z)(o,n);var c=sr(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"glyphInfo",void 0),(0,I.Z)((0,k.Z)(s),"glyphInfoMap",{}),(0,I.Z)((0,k.Z)(s),"texture",void 0),(0,I.Z)((0,k.Z)(s),"currentZoom",-1),(0,I.Z)((0,k.Z)(s),"extent",void 0),(0,I.Z)((0,k.Z)(s),"textureHeight",0),(0,I.Z)((0,k.Z)(s),"textCount",0),(0,I.Z)((0,k.Z)(s),"preTextStyle",{}),(0,I.Z)((0,k.Z)(s),"buildModels",function(){return s.initGlyph(),s.updateTexture(),s.filterGlyphs(),s.reBuildModel(),[s.layer.buildLayerModel({moduleName:"pointText",vertexShader:Rr,fragmentShader:cr,triangulation:tn.bind((0,k.Z)(s)),depth:{enable:!1},blend:s.getBlend()})]}),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d,C=l.stroke,P=C===void 0?"#fff":C,L=l.strokeWidth,J=L===void 0?0:L,Y=l.textAnchor,le=Y===void 0?"center":Y,De=l.textAllowOverlap,ut=De===void 0?!1:De,Rt=l.halo,mr=Rt===void 0?.5:Rt,br=l.gamma,Zr=br===void 0?2:br,fn=this.fontService,xn=fn.canvas,Ln=fn.mapping;if(Object.keys(Ln).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Ln).length),this.preTextStyle={textAnchor:le,textAllowOverlap:ut},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:y,strokeWidth:J,stroke:P})){this.judgeStyleAttributes({opacity:y,strokeWidth:J,stroke:P});var ni=this.layer.getEncodedData(),Nn=this.calDataFrame(this.cellLength,ni,this.cellProperties),xi=Nn.data,Ji=Nn.width,ga=Nn.height;this.rowCount=ga,this.dataTexture=this.cellLength>0&&xi.length>0?this.createTexture2D({flipY:!0,data:xi,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:Ji,height:ga}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:va()(y)?y:1,u_stroke_width:va()(J)?J:0,u_stroke_color:this.getStrokeColor(P),u_sdf_map:this.texture,u_halo_blur:mr,u_gamma_scale:Zr,u_sdf_map_size:[xn.width,xn.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var l=this.layer.getLayerConfig(),d=l.textAnchor,y=d===void 0?"center":d,C=l.textAllowOverlap,P=C===void 0?!0:C;return this.preTextStyle={textAnchor:y,textAllowOverlap:P},this.buildModels()}},{key:"needUpdate",value:function(){var l=this.layer.getLayerConfig(),d=l.textAllowOverlap,y=d===void 0?!1:d,C=this.mapService.getZoom(),P=this.mapService.getBounds(),L=(0,$e.oO)(this.extent,P);return!y&&(Math.abs(this.currentZoom-C)>1||!L)||y!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:b.GC.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(d,y,C,P){var L=d.rotate,J=L===void 0?0:L;return Array.isArray(J)?[J[0]]:[J]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:b.GC.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(d,y,C,P){return[C[5],C[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:b.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(d,y,C,P){var L=d.size,J=L===void 0?12:L;return Array.isArray(J)?[J[0]]:[J]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:b.GC.Attribute,descriptor:{name:"a_tex",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(d,y,C,P){return[C[3],C[4]]}}})}},{key:"textExtent",value:function(){var l=this.mapService.getBounds();return(0,$e.yA)(l,.5)}},{key:"initTextFont",value:function(){var l=this.layer.getLayerConfig(),d=l.fontWeight,y=d===void 0?"400":d,C=l.fontFamily,P=C===void 0?"sans-serif":C,L=this.layer.getEncodedData(),J=[];L.forEach(function(Y){var le=Y.shape,De=le===void 0?"":le;De=De.toString();var ut=it(De),Rt;try{for(ut.s();!(Rt=ut.n()).done;){var mr=Rt.value;J.indexOf(mr)===-1&&J.push(mr)}}catch(br){ut.e(br)}finally{ut.f()}}),this.fontService.setFontOptions({characterSet:J,fontWeight:y,fontFamily:P,iconfont:!1})}},{key:"initIconFontTex",value:function(){var l=this.layer.getLayerConfig(),d=l.fontWeight,y=d===void 0?"400":d,C=l.fontFamily,P=C===void 0?"sans-serif":C,L=this.layer.getEncodedData(),J=[];L.forEach(function(Y){var le=Y.shape,De=le===void 0?"":le;De=De.toString(),J.indexOf(De)===-1&&J.push(De)}),this.fontService.setFontOptions({characterSet:J,fontWeight:y,fontFamily:P,iconfont:!0})}},{key:"generateGlyphLayout",value:function(l){var d=this,y=this.fontService.mapping,C=this.layer.getLayerConfig(),P=C.spacing,L=P===void 0?2:P,J=C.textAnchor,Y=J===void 0?"center":J,le=this.layer.getEncodedData();this.glyphInfo=le.map(function(De){var ut=De.shape,Rt=ut===void 0?"":ut,mr=De.id,br=De.size,Zr=br===void 0?1:br,fn=De.textOffset,xn=fn===void 0?[0,0]:fn,Ln=at(Rt.toString(),y,Zr,Y,"center",L,xn,l),ni=ze(Ln,xn,!1);return De.shaping=Ln,De.glyphQuads=ni,De.centroid=ul(De.coordinates),De.originCentroid=De.version==="GAODE2.x"?ul(De.originCoordinates):De.originCentroid=De.centroid,d.glyphInfoMap[mr]={shaping:Ln,glyphQuads:ni,centroid:ul(De.coordinates)},De})}},{key:"filterGlyphs",value:function(){var l=this,d=this.layer.getLayerConfig(),y=d.padding,C=y===void 0?[4,4]:y,P=d.textAllowOverlap,L=P===void 0?!1:P;if(!L){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var J=this.rendererService.getViewportSize(),Y=J.width,le=J.height,De=new T(Y,le),ut=this.glyphInfo.filter(function(Rt){var mr=Rt.shaping,br=Rt.id,Zr=br===void 0?0:br,fn=Rt.version==="GAODE2.x"?Rt.originCentroid:Rt.centroid,xn=Rt.size,Ln=xn/24,ni=l.mapService.lngLatToContainer(fn),Nn=De.placeCollisionBox({x1:mr.left*Ln-C[0],x2:mr.right*Ln+C[0],y1:mr.top*Ln-C[1],y2:mr.bottom*Ln+C[1],anchorPointX:ni.x,anchorPointY:ni.y}),xi=Nn.box;return xi&&xi.length?(De.insertCollisionBox(xi,Zr),!0):!1});ut.forEach(function(Rt){l.glyphInfoMap[Rt.id]=Rt})}}},{key:"initGlyph",value:function(){var l=this.layer.getLayerConfig(),d=l.iconfont,y=d===void 0?!1:d;y?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(y)}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,d=this.fontService.canvas;this.textureHeight=d.height,this.texture&&this.texture.destroy(),this.texture=l({data:d,mag:b.gl.LINEAR,min:b.gl.LINEAR,width:d.width,height:d.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Rr,fragmentShader:cr,triangulation:tn.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),o}(vi),yn={fill:as,image:_l,normal:Sc,extrude:Fu,text:Xr,icon:uc},Fn=yn;function Vn(n){var c=jn();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function jn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Qi=function(n){(0,Ce.Z)(o,n);var c=Vn(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"type","PointLayer"),s}return(0,$.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Fn[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return d[l]}},{key:"getModelType",value:function(){var l=this.getEncodedData(),d=this.getLayerConfig(),y=d.shape2d,C=d.shape3d,P=this.iconService.getIconMap(),L=l.find(function(Y){return Y.hasOwnProperty("shape")});if(L){var J=L.shape;return J==="dot"?"normal":(y==null?void 0:y.indexOf(J))!==-1?"fill":(C==null?void 0:C.indexOf(J))!==-1?"extrude":P.hasOwnProperty(J)?"image":this.fontService.getGlyph(J)!==""?"icon":"text"}else return"normal"}}]),o}(Ps);function _n(n){var c=ci();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function ci(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ci=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,fi=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,oi=function(n){(0,Ce.Z)(o,n);var c=_n(o);function o(){return(0,W.Z)(this,o),c.apply(this,arguments)}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:y})){this.judgeStyleAttributes({opacity:y});var C=this.layer.getEncodedData(),P=this.calDataFrame(this.cellLength,C,this.cellProperties),L=P.data,J=P.width,Y=P.height;this.rowCount=Y,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:J,height:Y}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:va()(y)?y:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:fi,fragmentShader:Ci,triangulation:Ef})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:b.GC.Attribute,descriptor:{name:"a_Normal",buffer:{usage:b.gl.STATIC_DRAW,data:[],type:b.gl.FLOAT},size:3,update:function(d,y,C,P,L){return L}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:b.GC.Attribute,descriptor:{name:"a_Size",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(d,y,C,P){var L=d.size,J=L===void 0?10:L;return Array.isArray(J)?[J[0]]:[J]}}})}}]),o}(vi);function Ti(n){var c=ii();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function ii(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ri=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Po=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,Ja=function(n){(0,Ce.Z)(o,n);var c=Ti(o);function o(){return(0,W.Z)(this,o),c.apply(this,arguments)}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:y})){this.judgeStyleAttributes({opacity:y});var C=this.layer.getEncodedData(),P=this.calDataFrame(this.cellLength,C,this.cellProperties),L=P.data,J=P.width,Y=P.height;this.rowCount=Y,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:J,height:Y}):this.createTexture2D({flipY:!0,data:[1],format:b.gl.LUMINANCE,type:b.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:va()(y)?y:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:Po,fragmentShader:ri,triangulation:Pc,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){}}]),o}(vi),os={fill:Ja,line:Zl,extrude:oi,text:Xr,point_fill:as,point_image:_l,point_normal:Sc,point_extrude:Fu},Zo=os;function Ga(n){var c=no();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function no(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ds=function(n){(0,Ce.Z)(o,n);var c=Ga(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"type","PolygonLayer"),s}return(0,$.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Zo[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,d=this.styleAttributeService.getLayerStyleAttribute("shape"),y=d==null||(l=d.scale)===null||l===void 0?void 0:l.field;return y==="fill"?"fill":y==="extrude"?"extrude":y==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var l=this.getEncodedData(),d=this.getLayerConfig(),y=d.shape2d,C=d.shape3d,P=this.iconService.getIconMap(),L=l.find(function(Y){return Y.hasOwnProperty("shape")});if(L){var J=L.shape;return J==="dot"?"point_normal":(y==null?void 0:y.indexOf(J))!==-1?"point_fill":(C==null?void 0:C.indexOf(J))!==-1?"point_extrude":P.hasOwnProperty(J)?"point_image":"text"}else return"fill"}}]),o}(Ps);function vs(n){var c=el();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function el(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ms=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,eu=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Ls=function(n){(0,Ce.Z)(o,n);var c=vs(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"texture",void 0),(0,I.Z)((0,k.Z)(s),"colorTexture",void 0),s}return(0,$.Z)(o,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),d=l.opacity,y=d===void 0?1:d,C=l.clampLow,P=C===void 0?!0:C,L=l.clampHigh,J=L===void 0?!0:L,Y=l.noDataValue,le=Y===void 0?-9999999:Y,De=l.domain,ut=De===void 0?[0,1]:De;return this.updateColorTexure(),{u_opacity:y||1,u_texture:this.texture,u_domain:ut,u_clampLow:P,u_clampHigh:typeof J!="undefined"?J:P,u_noDataValue:le,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var l=this.layer.getSource(),d=this.rendererService.createTexture2D,y=l.data.dataArray[0];this.texture=d({data:y.data,width:y.width,height:y.height,format:b.gl.LUMINANCE,type:b.gl.FLOAT});var C=this.layer.getLayerConfig(),P=C.rampColors,L=(0,$e.Cl)(P);return this.colorTexture=d({data:L.data,width:L.width,height:L.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:eu,fragmentShader:ms,triangulation:nf,primitive:b.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:b.GC.Attribute,descriptor:{name:"a_Uv",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:2,update:function(d,y,C,P){return[C[3],C[4]]}}})}},{key:"updateColorTexure",value:function(){var l=this.rendererService.createTexture2D,d=this.layer.getLayerConfig(),y=d.rampColors,C=(0,$e.Cl)(y);this.colorTexture=l({data:C.data,width:C.width,height:C.height,flipY:!1})}}]),o}(vi),xl={raster:Ls,raster3d:Ls},bl=xl;function Nu(n){var c=tu();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function tu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Vl=function(n){(0,Ce.Z)(o,n);var c=Nu(o);function o(){var s;(0,W.Z)(this,o);for(var l=arguments.length,d=new Array(l),y=0;y<l;y++)d[y]=arguments[y];return s=c.call.apply(c,[this].concat(d)),(0,I.Z)((0,k.Z)(s),"type","RasterLayer"),s}return(0,$.Z)(o,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new bl[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),d={raster:{},raster3d:{}};return d[l]}},{key:"getModelType",value:function(){return"raster"}}]),o}(Ps),Tu=_(50361),zu=_.n(Tu),Hs,io,Au,du,gs,qi,ao,ko,Rs,tl,vu;function rl(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function nl(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?rl(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):rl(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}var Ec=(Hs=(0,V.b2)(),io=(0,V.f3)(b.vK.IGlobalConfigService),Au=(0,V.f3)(b.vK.ILogService),du=(0,V.f3)(b.vK.IMapService),gs=(0,V.f3)(b.vK.IFontService),Hs(qi=(ao=function(){function n(){(0,W.Z)(this,n),(0,Wn.Z)(this,"configService",ko,this),(0,Wn.Z)(this,"logger",Rs,this),(0,Wn.Z)(this,"mapService",tl,this),(0,Wn.Z)(this,"fontService",vu,this)}return(0,$.Z)(n,[{key:"apply",value:function(o,s){var l=this,d=s.styleAttributeService;o.hooks.init.tap("DataMappingPlugin",function(){l.generateMaping(o,{styleAttributeService:d})}),o.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return o.dataState.dataMappingNeedUpdate=!1,l.generateMaping(o,{styleAttributeService:d}),!0}),o.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!o.layerModelNeedUpdate){var y=d.getLayerStyleAttributes()||[],C=d.getLayerStyleAttribute("filter"),P=o.getSource().data.dataArray,L=y.filter(function(Y){return Y.needRemapping}),J=P;C!=null&&C.needRemapping&&C!==null&&C!==void 0&&C.scale&&(J=P.filter(function(Y){return l.applyAttributeMapping(C,Y)[0]})),L.length&&(C!=null&&C.needRemapping?(o.setEncodedData(l.mapping(y,J)),C.needRemapping=!1):o.setEncodedData(l.mapping(L,J,o.getEncodedData())),l.logger.debug("remapping finished"),o.emit("remapping",null))}})}},{key:"generateMaping",value:function(o,s){var l=this,d=s.styleAttributeService,y=d.getLayerStyleAttributes()||[],C=d.getLayerStyleAttribute("filter"),P=o.getSource().data.dataArray,L=P;C!=null&&C.scale&&(L=P.filter(function(J){return l.applyAttributeMapping(C,J)[0]})),o.setEncodedData(this.mapping(y,L))}},{key:"mapping",value:function(o,s,l){var d=this,y=s.map(function(C,P){var L=l?l[P]:{},J=nl({id:C._id,coordinates:C.coordinates},L);return o.filter(function(Y){return Y.scale!==void 0}).forEach(function(Y){var le=d.applyAttributeMapping(Y,C);Y.needRemapping=!1,Y.name==="color"&&(le=le.map(function(De){return(0,$e.CI)(De)})),J[Y.name]=Array.isArray(le)&&le.length===1?le[0]:le,Y.name==="shape"&&(J.shape=d.fontService.getIconFontKey(J[Y.name]))}),J});return y.length>0&&this.mapService.version==="GAODE2.x"&&(typeof y[0].coordinates[0]=="number"?y.map(function(C){C.version="GAODE2.x",C.originCoordinates=zu()(C.coordinates),C.coordinates=d.mapService.lngLatToCoord(C.coordinates)}):y.map(function(C){C.version="GAODE2.x",C.originCoordinates=zu()(C.coordinates),C.coordinates=d.mapService.lngLatToCoords(C.coordinates)})),y}},{key:"applyAttributeMapping",value:function(o,s){var l;if(!o.scale)return[];var d=(o==null||(l=o.scale)===null||l===void 0?void 0:l.scalers)||[],y=[];return d.forEach(function(C){var P,L=C.field;(s.hasOwnProperty(L)||((P=o.scale)===null||P===void 0?void 0:P.type)==="variable")&&y.push(s[L])}),o.mapping?o.mapping(y):[]}}]),n}(),ko=(0,ai.Z)(ao.prototype,"configService",[io],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rs=(0,ai.Z)(ao.prototype,"logger",[Au],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tl=(0,ai.Z)(ao.prototype,"mapService",[du],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vu=(0,ai.Z)(ao.prototype,"fontService",[gs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ao))||qi),Pu={},Gl={},wc=function(c){return Gl[c]},Ws=function(c,o){Gl[c]=o},Uo=function(c){return Pu[c]},Hc=function(c,o){Pu[c]=o},Rf={},Sl={},uf=34,Wc=10,Wf=13;function Hl(n){return new Function("d","return {"+n.map(function(c,o){return JSON.stringify(c)+": d["+o+'] || ""'}).join(",")+"}")}function ih(n,c){var o=Hl(n);return function(s,l){return c(o(s),l,n)}}function lf(n){var c=Object.create(null),o=[];return n.forEach(function(s){for(var l in s)l in c||o.push(c[l]=l)}),o}function ru(n,c){var o=n+"",s=o.length;return s<c?new Array(c-s+1).join(0)+o:o}function j(n){return n<0?"-"+ru(-n,6):n>9999?"+"+ru(n,6):ru(n,4)}function z(n){var c=n.getUTCHours(),o=n.getUTCMinutes(),s=n.getUTCSeconds(),l=n.getUTCMilliseconds();return isNaN(n)?"Invalid Date":j(n.getUTCFullYear(),4)+"-"+ru(n.getUTCMonth()+1,2)+"-"+ru(n.getUTCDate(),2)+(l?"T"+ru(c,2)+":"+ru(o,2)+":"+ru(s,2)+"."+ru(l,3)+"Z":s?"T"+ru(c,2)+":"+ru(o,2)+":"+ru(s,2)+"Z":o||c?"T"+ru(c,2)+":"+ru(o,2)+"Z":"")}function M(n){var c=new RegExp('["'+n+`
\r]`),o=n.charCodeAt(0);function s(Y,le){var De,ut,Rt=l(Y,function(mr,br){if(De)return De(mr,br-1);ut=mr,De=le?ih(mr,le):Hl(mr)});return Rt.columns=ut||[],Rt}function l(Y,le){var De=[],ut=Y.length,Rt=0,mr=0,br,Zr=ut<=0,fn=!1;Y.charCodeAt(ut-1)===Wc&&--ut,Y.charCodeAt(ut-1)===Wf&&--ut;function xn(){if(Zr)return Sl;if(fn)return fn=!1,Rf;var ni,Nn=Rt,xi;if(Y.charCodeAt(Nn)===uf){for(;Rt++<ut&&Y.charCodeAt(Rt)!==uf||Y.charCodeAt(++Rt)===uf;);return(ni=Rt)>=ut?Zr=!0:(xi=Y.charCodeAt(Rt++))===Wc?fn=!0:xi===Wf&&(fn=!0,Y.charCodeAt(Rt)===Wc&&++Rt),Y.slice(Nn+1,ni-1).replace(/""/g,'"')}for(;Rt<ut;){if((xi=Y.charCodeAt(ni=Rt++))===Wc)fn=!0;else if(xi===Wf)fn=!0,Y.charCodeAt(Rt)===Wc&&++Rt;else if(xi!==o)continue;return Y.slice(Nn,ni)}return Zr=!0,Y.slice(Nn,ut)}for(;(br=xn())!==Sl;){for(var Ln=[];br!==Rf&&br!==Sl;)Ln.push(br),br=xn();le&&(Ln=le(Ln,mr++))==null||De.push(Ln)}return De}function d(Y,le){return Y.map(function(De){return le.map(function(ut){return J(De[ut])}).join(n)})}function y(Y,le){return le==null&&(le=lf(Y)),[le.map(J).join(n)].concat(d(Y,le)).join(`
`)}function C(Y,le){return le==null&&(le=lf(Y)),d(Y,le).join(`
`)}function P(Y){return Y.map(L).join(`
`)}function L(Y){return Y.map(J).join(n)}function J(Y){return Y==null?"":Y instanceof Date?z(Y):c.test(Y+="")?'"'+Y.replace(/"/g,'""')+'"':Y}return{parse:s,parseRows:l,format:y,formatBody:C,formatRows:P,formatRow:L,formatValue:J}}var D=M(","),ne=D.parse,_e=D.parseRows,gt=D.format,Gt=D.formatBody,zt=D.formatRows,Sr=D.formatRow,qr=D.formatValue,Rn=_(38163),Gn=_.n(Rn);function Mn(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function di(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Mn(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Mn(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function yi(n,c){var o=c.x,s=c.y,l=c.x1,d=c.y1,y=c.coordinates,C=[];return n.forEach(function(P,L){var J=[];if(o&&s&&(J=[parseFloat(P[o]),parseFloat(P[s])]),o&&s&&l&&d){var Y=[parseFloat(P[o]),parseFloat(P[s])],le=[parseFloat(P[l]),parseFloat(P[d])];J=[Y,le]}if(y){var De="Polygon";Array.isArray(y[0])||(De="Point"),Array.isArray(y[0])&&!Array.isArray(y[0][0])&&(De="LineString");var ut={type:De,coordinates:(0,ti.Z)(P[y])};Gn()(ut,!0),J=ut.coordinates}var Rt=di(di({},P),{},{_id:L,coordinates:J});C.push(Rt)}),{dataArray:C}}function aa(n,c){var o=ne(n);return yi(o,c)}var Mi=_(40271);function Ha(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Mo(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function bo(n){if(n.length>1&&isNumber(n[0])&&isNumber(n[1]))return!0;if(Array.isArray(n[0])&&n[0].length)return bo(n[0]);throw new Error("coordinates must only contain numbers")}function So(n,c,o){if(!c||!o)throw new Error("type and name required");if(!n||n.type!==c)throw new Error("Invalid input to "+o+": must be a "+c+", given "+n.type)}function Qa(n,c,o){if(!n)throw new Error("No feature passed");if(!o)throw new Error(".featureOf() requires a name");if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+o+", Feature with geometry required");if(!n.geometry||n.geometry.type!==c)throw new Error("Invalid input to "+o+": must be a "+c+", given "+n.geometry.type)}function ca(n,c,o){if(!n)throw new Error("No featureCollection passed");if(!o)throw new Error(".collectionOf() requires a name");if(!n||n.type!=="FeatureCollection")throw new Error("Invalid input to "+o+", FeatureCollection required");for(var s=0,l=n.features;s<l.length;s++){var d=l[s];if(!d||d.type!=="Feature"||!d.geometry)throw new Error("Invalid input to "+o+", Feature with geometry required");if(!d.geometry||d.geometry.type!==c)throw new Error("Invalid input to "+o+": must be a "+c+", given "+d.geometry.type)}}function Wa(n){return n.type==="Feature"?n.geometry:n}function Eo(n,c){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}function oo(n,c,o){if(n!==null)for(var s,l,d,y,C,P,L,J=0,Y=0,le,De=n.type,ut=De==="FeatureCollection",Rt=De==="Feature",mr=ut?n.features.length:1,br=0;br<mr;br++){L=ut?n.features[br].geometry:Rt?n.geometry:n,le=L?L.type==="GeometryCollection":!1,C=le?L.geometries.length:1;for(var Zr=0;Zr<C;Zr++){var fn=0,xn=0;if(y=le?L.geometries[Zr]:L,y!==null){P=y.coordinates;var Ln=y.type;switch(J=o&&(Ln==="Polygon"||Ln==="MultiPolygon")?1:0,Ln){case null:break;case"Point":if(c(P,Y,br,fn,xn)===!1)return!1;Y++,fn++;break;case"LineString":case"MultiPoint":for(s=0;s<P.length;s++){if(c(P[s],Y,br,fn,xn)===!1)return!1;Y++,Ln==="MultiPoint"&&fn++}Ln==="LineString"&&fn++;break;case"Polygon":case"MultiLineString":for(s=0;s<P.length;s++){for(l=0;l<P[s].length-J;l++){if(c(P[s][l],Y,br,fn,xn)===!1)return!1;Y++}Ln==="MultiLineString"&&fn++,Ln==="Polygon"&&xn++}Ln==="Polygon"&&fn++;break;case"MultiPolygon":for(s=0;s<P.length;s++){for(xn=0,l=0;l<P[s].length;l++){for(d=0;d<P[s][l].length-J;d++){if(c(P[s][l][d],Y,br,fn,xn)===!1)return!1;Y++}xn++}fn++}break;case"GeometryCollection":for(s=0;s<y.geometries.length;s++)if(oo(y.geometries[s],c,o)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function wo(n,c,o,s){var l=o;return oo(n,function(d,y,C,P,L){y===0&&o===void 0?l=d:l=c(l,d,y,C,P,L)},s),l}function Ds(n,c){var o;switch(n.type){case"FeatureCollection":for(o=0;o<n.features.length&&c(n.features[o].properties,o)!==!1;o++);break;case"Feature":c(n.properties,0);break}}function mu(n,c,o){var s=o;return Ds(n,function(l,d){d===0&&o===void 0?s=l:s=c(s,l,d)}),s}function Zu(n,c){if(n.type==="Feature")c(n,0);else if(n.type==="FeatureCollection")for(var o=0;o<n.features.length&&c(n.features[o],o)!==!1;o++);}function Ss(n,c,o){var s=o;return Zu(n,function(l,d){d===0&&o===void 0?s=l:s=c(s,l,d)}),s}function Xc(n){var c=[];return oo(n,function(o){c.push(o)}),c}function cf(n,c){var o,s,l,d,y,C,P,L,J,Y,le=0,De=n.type==="FeatureCollection",ut=n.type==="Feature",Rt=De?n.features.length:1;for(o=0;o<Rt;o++){for(C=De?n.features[o].geometry:ut?n.geometry:n,L=De?n.features[o].properties:ut?n.properties:{},J=De?n.features[o].bbox:ut?n.bbox:void 0,Y=De?n.features[o].id:ut?n.id:void 0,P=C?C.type==="GeometryCollection":!1,y=P?C.geometries.length:1,l=0;l<y;l++){if(d=P?C.geometries[l]:C,d===null){if(c(null,le,L,J,Y)===!1)return!1;continue}switch(d.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(c(d,le,L,J,Y)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<d.geometries.length;s++)if(c(d.geometries[s],le,L,J,Y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}le++}}function jp(n,c,o){var s=o;return cf(n,function(l,d,y,C,P){d===0&&o===void 0?s=l:s=c(s,l,d,y,C,P)}),s}function Xf(n,c){cf(n,function(o,s,l,d,y){var C=o===null?null:o.type;switch(C){case null:case"Point":case"LineString":case"Polygon":return c((0,Mi.zL)(o,l,{bbox:d,id:y}),s,0)===!1?!1:void 0}var P;switch(C){case"MultiPoint":P="Point";break;case"MultiLineString":P="LineString";break;case"MultiPolygon":P="Polygon";break}for(var L=0;L<o.coordinates.length;L++){var J=o.coordinates[L],Y={type:P,coordinates:J};if(c((0,Mi.zL)(Y,l),s,L)===!1)return!1}})}function Yc(n,c,o){var s=o;return Xf(n,function(l,d,y){d===0&&y===0&&o===void 0?s=l:s=c(s,l,d,y)}),s}function ff(n,c){Xf(n,function(o,s,l){var d=0;if(!!o.geometry){var y=o.geometry.type;if(!(y==="Point"||y==="MultiPoint")){var C,P=0,L=0,J=0;if(oo(o,function(Y,le,De,ut,Rt){if(C===void 0||s>P||ut>L||Rt>J){C=Y,P=s,L=ut,J=Rt,d=0;return}var mr=lineString([C,Y],o.properties);if(c(mr,s,l,Rt,d)===!1)return!1;d++,C=Y})===!1)return!1}}})}function fp(n,c,o){var s=o,l=!1;return ff(n,function(d,y,C,P,L){l===!1&&o===void 0?s=d:s=c(s,d,y,C,P,L),l=!0}),s}function Mh(n,c){if(!n)throw new Error("geojson is required");Xf(n,function(o,s,l){if(o.geometry!==null){var d=o.geometry.type,y=o.geometry.coordinates;switch(d){case"LineString":if(c(o,s,l,0,0)===!1)return!1;break;case"Polygon":for(var C=0;C<y.length;C++)if(c(lineString(y[C],o.properties),s,l,C)===!1)return!1;break}}})}function hp(n,c,o){var s=o;return Mh(n,function(l,d,y,C){d===0&&o===void 0?s=l:s=c(s,l,d,y,C)}),s}function Ih(n,c){if(c=c||{},!isObject(c))throw new Error("options is invalid");var o=c.featureIndex||0,s=c.multiFeatureIndex||0,l=c.geometryIndex||0,d=c.segmentIndex||0,y=c.properties,C;switch(n.type){case"FeatureCollection":o<0&&(o=n.features.length+o),y=y||n.features[o].properties,C=n.features[o].geometry;break;case"Feature":y=y||n.properties,C=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":C=n;break;default:throw new Error("geojson is invalid")}if(C===null)return null;var P=C.coordinates;switch(C.type){case"Point":case"MultiPoint":return null;case"LineString":return d<0&&(d=P.length+d-1),lineString([P[d],P[d+1]],y,c);case"Polygon":return l<0&&(l=P.length+l),d<0&&(d=P[l].length+d-1),lineString([P[l][d],P[l][d+1]],y,c);case"MultiLineString":return s<0&&(s=P.length+s),d<0&&(d=P[s].length+d-1),lineString([P[s][d],P[s][d+1]],y,c);case"MultiPolygon":return s<0&&(s=P.length+s),l<0&&(l=P[s].length+l),d<0&&(d=P[s][l].length-d-1),lineString([P[s][l][d],P[s][l][d+1]],y,c)}throw new Error("geojson is invalid")}function Vp(n,c){if(c=c||{},!isObject(c))throw new Error("options is invalid");var o=c.featureIndex||0,s=c.multiFeatureIndex||0,l=c.geometryIndex||0,d=c.coordIndex||0,y=c.properties,C;switch(n.type){case"FeatureCollection":o<0&&(o=n.features.length+o),y=y||n.features[o].properties,C=n.features[o].geometry;break;case"Feature":y=y||n.properties,C=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":C=n;break;default:throw new Error("geojson is invalid")}if(C===null)return null;var P=C.coordinates;switch(C.type){case"Point":return point(P,y,c);case"MultiPoint":return s<0&&(s=P.length+s),point(P[s],y,c);case"LineString":return d<0&&(d=P.length+d),point(P[d],y,c);case"Polygon":return l<0&&(l=P.length+l),d<0&&(d=P[l].length+d),point(P[l][d],y,c);case"MultiLineString":return s<0&&(s=P.length+s),d<0&&(d=P[s].length+d),point(P[s][d],y,c);case"MultiPolygon":return s<0&&(s=P.length+s),l<0&&(l=P[s].length+l),d<0&&(d=P[s][l].length-d),point(P[s][l][d],y,c)}throw new Error("geojson is invalid")}function Wl(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function Kc(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Wl(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Wl(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function wf(n,c){var o=[],s={};if(n.features=n.features.filter(function(d){var y=d.geometry;return d!=null&&y&&y.type&&y.coordinates&&y.coordinates.length>0}),Gn()(n,!0),n.features.length===0)return{dataArray:[],featureKeys:s};var l=0;return Xf(n,function(d,y){var C=Mo(d),P=y,L=Kc(Kc({},d.properties),{},{coordinates:C,_id:P});o.push(L)}),{dataArray:o,featureKeys:s}}function Xl(n,c){var o=c.extent,s=new Promise(function(d){Cf(n,function(y){d(y)})}),l={images:s,_id:1,dataArray:[{_id:0,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]};return l}function Cf(n,c){var o=n,s=[];if(typeof o=="string")(0,$e.gJ)({url:o},function(y,C){s.push(C),c(s)});else{var l=o.length,d=0;o.forEach(function(y){(0,$e.gJ)({url:y},function(C,P){d++,s.push(P),d===l&&c(s)})})}return Xl}function il(n,c){var o=c.extent,s=c.width,l=c.height,d=c.min,y=c.max,C={_id:1,dataArray:[{_id:1,data:Array.from(n),width:s,height:l,min:d,max:y,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]};return C}var Yf=_(30236),Oh=_.n(Yf);function gu(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function al(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?gu(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):gu(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function jo(n,c){var o=c.radius,s=o===void 0?40:o,l=c.maxZoom,d=l===void 0?18:l,y=c.minZoom,C=y===void 0?0:y,P=c.zoom,L=P===void 0?2:P;if(n.pointIndex){var J=n.pointIndex.getClusters(n.extent,Math.floor(L));return n.dataArray=Uu(J),n}var Y=new(tr())({radius:s,minZoom:C,maxZoom:d}),le={type:"FeatureCollection",features:[]};return le.features=n.dataArray.map(function(De){return{type:"Feature",geometry:{type:"Point",coordinates:De.coordinates},properties:al({},De)}}),Y.load(le.features),Y}function Uu(n){return n.map(function(c,o){return al({coordinates:c.geometry.coordinates,_id:o+1},c.properties)})}function Lh(n){if(n.length===0)throw new Error("max requires at least one data point");for(var c=n[0],o=1;o<n.length;o++)n[o]>c&&(c=n[o]);return c}function pp(n){if(n.length===0)throw new Error("min requires at least one data point");for(var c=n[0],o=1;o<n.length;o++)n[o]<c&&(c=n[o]);return c}function Rh(n){if(n.length===0)return 0;for(var c=n[0],o=0,s,l=1;l<n.length;l++)s=c+n[l]*1,Math.abs(c)>=Math.abs(n[l])?o+=c-s+n[l]:o+=n[l]-s+c,c=s;return c+o*1}function Dh(n){if(n.length===0)throw new Error("mean requires at least one data point");return Rh(n)/n.length}var nu={min:pp,max:Lh,mean:Dh,sum:Rh};function kh(n,c){return n.map(function(o){return o[c]*1})}function ah(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function oh(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?ah(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):ah(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function dp(n){var c=Fh();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Fh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function vp(n,c){if(Array.isArray(c))return c}var Bh=function(n){(0,Ce.Z)(o,n);var c=dp(o);function o(s,l){var d;return(0,W.Z)(this,o),d=c.call(this),(0,I.Z)((0,k.Z)(d),"data",void 0),(0,I.Z)((0,k.Z)(d),"extent",void 0),(0,I.Z)((0,k.Z)(d),"hooks",{init:new Xa.ni}),(0,I.Z)((0,k.Z)(d),"parser",{type:"geojson"}),(0,I.Z)((0,k.Z)(d),"transforms",[]),(0,I.Z)((0,k.Z)(d),"cluster",!1),(0,I.Z)((0,k.Z)(d),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,I.Z)((0,k.Z)(d),"mapService",void 0),(0,I.Z)((0,k.Z)(d),"invalidExtent",!1),(0,I.Z)((0,k.Z)(d),"originData",void 0),(0,I.Z)((0,k.Z)(d),"rawData",void 0),(0,I.Z)((0,k.Z)(d),"cfg",{}),(0,I.Z)((0,k.Z)(d),"clusterIndex",void 0),d.originData=s,d.initCfg(l),d.hooks.init.tap("parser",function(){d.excuteParser()}),d.hooks.init.tap("cluster",function(){d.initCluster()}),d.hooks.init.tap("transform",function(){d.executeTrans()}),d.init(),d}return(0,$.Z)(o,[{key:"setData",value:function(l,d){this.rawData=l,this.originData=l,this.initCfg(d),this.init(),this.emit("update")}},{key:"getClusters",value:function(l){return this.clusterIndex.getClusters(this.caculClusterExtent(2),l)}},{key:"getClustersLeaves",value:function(l){return this.clusterIndex.getLeaves(l,Infinity)}},{key:"updateClusterData",value:function(l){var d=this,y=this.clusterOptions,C=y.method,P=C===void 0?"sum":C,L=y.field,J=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(l));this.clusterOptions.zoom=l,J.forEach(function(Y){Y.id||(Y.properties.point_count=1)}),(L||ya()(P))&&(J=J.map(function(Y){var le=Y.id;if(le){var De=d.clusterIndex.getLeaves(le,Infinity),ut=De.map(function(br){return br.properties}),Rt;if(Za()(P)&&L){var mr=kh(ut,L);Rt=nu[P](mr)}ya()(P)&&(Rt=P(ut)),Y.properties.stat=Rt}else Y.properties.point_count=1;return Y})),this.data=wc("geojson")({type:"FeatureCollection",features:J}),this.executeTrans()}},{key:"getFeatureById",value:function(l){var d=this.parser.type,y=d===void 0?"geojson":d;if(y==="geojson"&&!this.cluster){var C=l<this.originData.features.length?this.originData.features[l]:"null",P=zu()(C);if(this.transforms.length!==0){var L=this.data.dataArray.find(function(J){return J._id===l});P.properties=L}return P}else return l<this.data.dataArray.length?this.data.dataArray[l]:"null"}},{key:"getFeatureId",value:function(l,d){var y=this.data.dataArray.find(function(C){return C[l]===name});return y==null?void 0:y._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(l){var d=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(d=(0,$e.yA)((0,$e.ds)(this.extent),l)),d[0].concat(d[1])}},{key:"initCfg",value:function(l){this.cfg=Oh()(this.cfg,l,vp);var d=this.cfg;d&&(d.parser&&(this.parser=d.parser),d.transforms&&(this.transforms=d.transforms),this.cluster=d.cluster||!1,d.clusterOptions&&(this.cluster=!0,this.clusterOptions=oh(oh({},this.clusterOptions),d.clusterOptions)))}},{key:"excuteParser",value:function(){var l=this.parser,d=l.type||"geojson",y=wc(d);this.data=y(this.originData,l),this.extent=(0,$e.We)(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var l=this,d=this.transforms;d.forEach(function(y){var C=y.type,P=Uo(C)(l.data,y);Object.assign(l.data,P)})}},{key:"initCluster",value:function(){if(!!this.cluster){var l=this.clusterOptions||{};this.clusterIndex=jo(this.data,l)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),o}(Vt.EventEmitter);function Nh(n,c){var o=c.callback;return o&&(n.dataArray=n.dataArray.filter(o)),n}function Kf(n,c){var o=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!o){if(Array.isArray(n)||(o=mp(n))||c&&n&&typeof n.length=="number"){o&&(n=o);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(L){throw L},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var d=!0,y=!1,C;return{s:function(){o=o.call(n)},n:function(){var L=o.next();return d=L.done,L},e:function(L){y=!0,C=L},f:function(){try{!d&&o.return!=null&&o.return()}finally{if(y)throw C}}}}function mp(n,c){if(!!n){if(typeof n=="string")return zh(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return zh(n,c)}}function zh(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}var $c=6378e3;function Zh(n,c){var o=n.dataArray,s=c.size,l=s===void 0?10:s,d=l/(2*Math.PI*$c)*(256<<20)/2,y=U(o,l),C=y.gridHash,P=y.gridOffset,L=wr(C,P,c);return{yOffset:d,xOffset:d,radius:d,type:"grid",dataArray:L}}function U(n,c){var o=Infinity,s=-Infinity,l,d=Kf(n),y;try{for(d.s();!(y=d.n()).done;){var C=y.value;l=C.coordinates[1],Number.isFinite(l)&&(o=l<o?l:o,s=l>s?l:s)}}catch(fn){d.e(fn)}finally{d.f()}var P=(o+s)/2,L=Pe(c,P);if(L.xOffset<=0||L.yOffset<=0)return{gridHash:{},gridOffset:L};var J={},Y=Kf(n),le;try{for(Y.s();!(le=Y.n()).done;){var De=le.value,ut=De.coordinates[1],Rt=De.coordinates[0];if(Number.isFinite(ut)&&Number.isFinite(Rt)){var mr=Math.floor((ut+90)/L.yOffset),br=Math.floor((Rt+180)/L.xOffset),Zr="".concat(mr,"-").concat(br);J[Zr]=J[Zr]||{count:0,points:[]},J[Zr].count+=1,J[Zr].points.push(De)}}}catch(fn){Y.e(fn)}finally{Y.f()}return{gridHash:J,gridOffset:L}}function Pe(n,c){var o=Ze(n),s=rr(c,n);return{yOffset:o,xOffset:s}}function Ze(n){return n/$c*(180/Math.PI)}function rr(n,c){return c/$c*(180/Math.PI)/Math.cos(n*Math.PI/180)}function wr(n,c,o){return Object.keys(n).reduce(function(s,l,d){var y=l.split("-"),C=parseInt(y[0],10),P=parseInt(y[1],10),L={};if(o.field&&o.method){var J=$e.a5.getColumn(n[l].points,o.field);L[o.method]=$e.a5.statMap[o.method](J)}return Object.assign(L,{_id:d,coordinates:(0,$e.Z)([-180+c.xOffset*(P+.5),-90+c.yOffset*(C+.5)]),rawData:n[l].points,count:n[l].count}),s.push(L),s},[])}var Xt=Math.PI/3,vr=[0,Xt,2*Xt,3*Xt,4*Xt,5*Xt];function Ur(n){return n[0]}function Hr(n){return n[1]}function Jr(){var n=0,c=0,o=1,s=1,l=Ur,d=Hr,y,C,P;function L(Y){var le={},De=[],ut,Rt=Y.length;for(ut=0;ut<Rt;++ut)if(!(isNaN(br=+l.call(null,mr=Y[ut],ut,Y))||isNaN(Zr=+d.call(null,mr,ut,Y)))){var mr,br,Zr,fn=Math.round(Zr=Zr/P),xn=Math.round(br=br/C-(fn&1)/2),Ln=Zr-fn;if(Math.abs(Ln)*3>1){var ni=br-xn,Nn=xn+(br<xn?-1:1)/2,xi=fn+(Zr<fn?-1:1),Ji=br-Nn,ga=Zr-xi;ni*ni+Ln*Ln>Ji*Ji+ga*ga&&(xn=Nn+(fn&1?1:-1)/2,fn=xi)}var hi=xn+"-"+fn,wa=le[hi];wa?wa.push(mr):(De.push(wa=le[hi]=[mr]),wa.x=(xn+(fn&1)/2)*C,wa.y=fn*P)}return De}function J(Y){var le=0,De=0;return vr.map(function(ut){var Rt=Math.sin(ut)*Y,mr=-Math.cos(ut)*Y,br=Rt-le,Zr=mr-De;return le=Rt,De=mr,[br,Zr]})}return L.hexagon=function(Y){return"m"+J(Y==null?y:+Y).join("l")+"z"},L.centers=function(){for(var Y=[],le=Math.round(c/P),De=Math.round(n/C),ut=le*P;ut<s+y;ut+=P,++le)for(var Rt=De*C+(le&1)*C/2;Rt<o+C/2;Rt+=C)Y.push([Rt,ut]);return Y},L.mesh=function(){var Y=J(y).slice(0,4).join("l");return L.centers().map(function(le){return"M"+le+"m"+Y}).join("")},L.x=function(Y){return arguments.length?(l=Y,L):l},L.y=function(Y){return arguments.length?(d=Y,L):d},L.radius=function(Y){return arguments.length?(y=+Y,C=y*2*Math.sin(Xt),P=y*1.5,L):y},L.size=function(Y){return arguments.length?(n=c=0,o=+Y[0],s=+Y[1],L):[o-n,s-c]},L.extent=function(Y){return arguments.length?(n=+Y[0][0],c=+Y[0][1],o=+Y[1][0],s=+Y[1][1],L):[[n,c],[o,s]]},L.radius(1)}function Gr(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function rn(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Gr(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Gr(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}var hn=6378e3;function jr(n,c){var o=n.dataArray,s=c.size,l=s===void 0?10:s,d=c.method,y=d===void 0?"sum":d,C=l/(2*Math.PI*hn)*(256<<20)/2,P=o.map(function(le){var De=(0,$e.Z)(le.coordinates),ut=(0,X.Z)(De,2),Rt=ut[0],mr=ut[1];return rn(rn({},le),{},{coordinates:[Rt,mr]})}),L=Jr().radius(C).x(function(le){return le.coordinates[0]}).y(function(le){return le.coordinates[1]}),J=L(P),Y={dataArray:J.map(function(le,De){var ut;if(c.field&&y){var Rt=$e.a5.getColumn(le,c.field);le[y]=$e.a5.statMap[y](Rt)}return ut={},(0,I.Z)(ut,c.method,le[y]),(0,I.Z)(ut,"count",le.length),(0,I.Z)(ut,"rawData",le),(0,I.Z)(ut,"coordinates",[le.x,le.y]),(0,I.Z)(ut,"_id",De),ut}),radius:C,xOffset:C,yOffset:C,type:"hexagon"};return Y}function an(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function Zt(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?an(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):an(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function pr(n,c){var o=c.sourceField,s=c.targetField,l=c.data,d={};return l.forEach(function(y){d[y[o]]=y}),n.dataArray=n.dataArray.map(function(y){var C=y[s];return Zt(Zt({},y),d[C])}),n}function Vr(n,c){var o=c.callback;return o&&(n.dataArray=n.dataArray.map(o)),n}var mn=_(4771),Br=Bh;Ws("geojson",wf),Ws("image",Xl),Ws("csv",aa),Ws("json",yi),Ws("raster",il),Hc("cluster",jo),Hc("filter",Nh),Hc("join",pr),Hc("map",Vr),Hc("grid",Zh),Hc("hexagon",jr);var Sn,zr,un=(Sn=(0,V.b2)(),Sn(zr=function(){function n(){(0,W.Z)(this,n),(0,I.Z)(this,"mapService",void 0)}return(0,$.Z)(n,[{key:"apply",value:function(o){var s=this;this.mapService=o.getContainer().get(b.vK.IMapService),o.hooks.init.tap("DataSourcePlugin",function(){var l=o.getSource();if(!l){var d=o.sourceOption,y=d.data,C=d.options;o.setSource(new Br(y,C))}s.updateClusterData(o)}),o.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var l=s.updateClusterData(o),d=o.dataState.dataSourceNeedUpdate;return o.dataState.dataSourceNeedUpdate=!1,l||d})}},{key:"updateClusterData",value:function(o){var s=o.getSource(),l=s.cluster,d=s.clusterOptions,y=d.zoom,C=y===void 0?0:y,P=d.maxZoom,L=P===void 0?16:P,J=this.mapService.getZoom()-1,Y=o.dataState.dataSourceNeedUpdate;return l&&(Y||Math.abs(C-J)>1)&&L>C?(s.updateClusterData(Math.floor(J)),!0):!1}}]),n}())||zr),kr=_(44908),nn=_.n(kr),Xn=_(14293),Kn=_.n(Xn);function sn(n,c){return n<c?-1:n>c?1:n>=c?0:NaN}function Nr(n){return n.length===1&&(n=Ir(n)),{left:function(c,o,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var d=s+l>>>1;n(c[d],o)<0?s=d+1:l=d}return s},right:function(c,o,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var d=s+l>>>1;n(c[d],o)>0?l=d:s=d+1}return s}}}function Ir(n){return function(c,o){return sn(n(c),o)}}var si=Nr(sn),ui=si.right,kn=si.left,ea=null;function Pi(n,c){var o=n.length,s=-1,l,d,y;if(c==null){for(;++s<o;)if((l=n[s])!=null&&l>=l)for(d=y=l;++s<o;)(l=n[s])!=null&&(d>l&&(d=l),y<l&&(y=l))}else for(;++s<o;)if((l=c(n[s],s,n))!=null&&l>=l)for(d=y=l;++s<o;)(l=c(n[s],s,n))!=null&&(d>l&&(d=l),y<l&&(y=l));return[d,y]}var ji=Array.prototype,fa=ji.slice,Jo=ji.map,ss=Math.sqrt(50),$i=Math.sqrt(10),vo=Math.sqrt(2);function so(n,c,o){var s,l=-1,d,y,C;if(c=+c,n=+n,o=+o,n===c&&o>0)return[n];if((s=c<n)&&(d=n,n=c,c=d),(C=Qo(n,c,o))===0||!isFinite(C))return[];if(C>0)for(n=Math.ceil(n/C),c=Math.floor(c/C),y=new Array(d=Math.ceil(c-n+1));++l<d;)y[l]=(n+l)*C;else for(n=Math.floor(n*C),c=Math.ceil(c*C),y=new Array(d=Math.ceil(n-c+1));++l<d;)y[l]=(n-l)/C;return s&&y.reverse(),y}function Qo(n,c,o){var s=(c-n)/Math.max(0,o),l=Math.floor(Math.log(s)/Math.LN10),d=s/Math.pow(10,l);return l>=0?(d>=ss?10:d>=$i?5:d>=vo?2:1)*Math.pow(10,l):-Math.pow(10,-l)/(d>=ss?10:d>=$i?5:d>=vo?2:1)}function ys(n,c,o){var s=Math.abs(c-n)/Math.max(0,o),l=Math.pow(10,Math.floor(Math.log(s)/Math.LN10)),d=s/l;return d>=ss?l*=10:d>=$i?l*=5:d>=vo&&(l*=2),c<n?-l:l}function Es(){var n=identity,c=extent,o=sturges;function s(l){var d,y=l.length,C,P=new Array(y);for(d=0;d<y;++d)P[d]=n(l[d],d,l);var L=c(P),J=L[0],Y=L[1],le=o(P,J,Y);Array.isArray(le)||(le=tickStep(J,Y,le),le=range(Math.ceil(J/le)*le,Y,le));for(var De=le.length;le[0]<=J;)le.shift(),--De;for(;le[De-1]>Y;)le.pop(),--De;var ut=new Array(De+1),Rt;for(d=0;d<=De;++d)Rt=ut[d]=[],Rt.x0=d>0?le[d-1]:J,Rt.x1=d<De?le[d]:Y;for(d=0;d<y;++d)C=P[d],J<=C&&C<=Y&&ut[bisect(le,C,0,De)].push(l[d]);return ut}return s.value=function(l){return arguments.length?(n=typeof l=="function"?l:constant(l),s):n},s.domain=function(l){return arguments.length?(c=typeof l=="function"?l:constant([l[0],l[1]]),s):c},s.thresholds=function(l){return arguments.length?(o=typeof l=="function"?l:Array.isArray(l)?constant(slice.call(l)):constant(l),s):o},s}function ks(n,c,o){return n=map.call(n,number).sort(ascending),Math.ceil((o-c)/(2*(quantile(n,.75)-quantile(n,.25))*Math.pow(n.length,-1/3)))}function _s(n,c){return n<c?-1:n>c?1:n>=c?0:NaN}function Fo(n){return n.length===1&&(n=Ni(n)),{left:function(c,o,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var d=s+l>>>1;n(c[d],o)<0?s=d+1:l=d}return s},right:function(c,o,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var d=s+l>>>1;n(c[d],o)>0?l=d:s=d+1}return s}}}function Ni(n){return function(c,o){return _s(n(c),o)}}var Fs=Fo(_s),Sa=Fs.right,li=Fs.left,Wi=Sa,oa=Array.prototype,qo=oa.slice,El=oa.map,wl=Math.sqrt(50),Ve=Math.sqrt(10),qt=Math.sqrt(2);function Kt(n,c,o){var s,l=-1,d,y,C;if(c=+c,n=+n,o=+o,n===c&&o>0)return[n];if((s=c<n)&&(d=n,n=c,c=d),(C=Cn(n,c,o))===0||!isFinite(C))return[];if(C>0)for(n=Math.ceil(n/C),c=Math.floor(c/C),y=new Array(d=Math.ceil(c-n+1));++l<d;)y[l]=(n+l)*C;else for(n=Math.floor(n*C),c=Math.ceil(c*C),y=new Array(d=Math.ceil(n-c+1));++l<d;)y[l]=(n-l)/C;return s&&y.reverse(),y}function Cn(n,c,o){var s=(c-n)/Math.max(0,o),l=Math.floor(Math.log(s)/Math.LN10),d=s/Math.pow(10,l);return l>=0?(d>=wl?10:d>=Ve?5:d>=qt?2:1)*Math.pow(10,l):-Math.pow(10,-l)/(d>=wl?10:d>=Ve?5:d>=qt?2:1)}function Xi(n,c,o){var s=Math.abs(c-n)/Math.max(0,o),l=Math.pow(10,Math.floor(Math.log(s)/Math.LN10)),d=s/l;return d>=wl?l*=10:d>=Ve?l*=5:d>=qt&&(l*=2),c<n?-l:l}function Re(){var n=identity,c=extent,o=sturges;function s(l){var d,y=l.length,C,P=new Array(y);for(d=0;d<y;++d)P[d]=n(l[d],d,l);var L=c(P),J=L[0],Y=L[1],le=o(P,J,Y);Array.isArray(le)||(le=tickStep(J,Y,le),le=range(Math.ceil(J/le)*le,Y,le));for(var De=le.length;le[0]<=J;)le.shift(),--De;for(;le[De-1]>Y;)le.pop(),--De;var ut=new Array(De+1),Rt;for(d=0;d<=De;++d)Rt=ut[d]=[],Rt.x0=d>0?le[d-1]:J,Rt.x1=d<De?le[d]:Y;for(d=0;d<y;++d)C=P[d],J<=C&&C<=Y&&ut[bisect(le,C,0,De)].push(l[d]);return ut}return s.value=function(l){return arguments.length?(n=typeof l=="function"?l:constant(l),s):n},s.domain=function(l){return arguments.length?(c=typeof l=="function"?l:constant([l[0],l[1]]),s):c},s.thresholds=function(l){return arguments.length?(o=typeof l=="function"?l:Array.isArray(l)?constant(slice.call(l)):constant(l),s):o},s}function xe(n,c,o){return n=map.call(n,number).sort(ascending),Math.ceil((o-c)/(2*(quantile(n,.75)-quantile(n,.25))*Math.pow(n.length,-1/3)))}function ot(n){return n===null?NaN:+n}function Dt(n,c,o){if(o==null&&(o=ot),!!(s=n.length)){if((c=+c)<=0||s<2)return+o(n[0],0,n);if(c>=1)return+o(n[s-1],s-1,n);var s,l=(s-1)*c,d=Math.floor(l),y=+o(n[d],d,n),C=+o(n[d+1],d+1,n);return y+(C-y)*(l-d)}}var Mt="$";function ft(){}ft.prototype=st.prototype={constructor:ft,has:function(n){return Mt+n in this},get:function(n){return this[Mt+n]},set:function(n,c){return this[Mt+n]=c,this},remove:function(n){var c=Mt+n;return c in this&&delete this[c]},clear:function(){for(var n in this)n[0]===Mt&&delete this[n]},keys:function(){var n=[];for(var c in this)c[0]===Mt&&n.push(c.slice(1));return n},values:function(){var n=[];for(var c in this)c[0]===Mt&&n.push(this[c]);return n},entries:function(){var n=[];for(var c in this)c[0]===Mt&&n.push({key:c.slice(1),value:this[c]});return n},size:function(){var n=0;for(var c in this)c[0]===Mt&&++n;return n},empty:function(){for(var n in this)if(n[0]===Mt)return!1;return!0},each:function(n){for(var c in this)c[0]===Mt&&n(this[c],c.slice(1),this)}};function st(n,c){var o=new ft;if(n instanceof ft)n.each(function(C,P){o.set(P,C)});else if(Array.isArray(n)){var s=-1,l=n.length,d;if(c==null)for(;++s<l;)o.set(s,n[s]);else for(;++s<l;)o.set(c(d=n[s],s,n),d)}else if(n)for(var y in n)o.set(y,n[y]);return o}var Et=st;function ke(){var n=[],c=[],o,s,l;function d(C,P,L,J){if(P>=n.length)return o!=null&&C.sort(o),s!=null?s(C):C;for(var Y=-1,le=C.length,De=n[P++],ut,Rt,mr=map(),br,Zr=L();++Y<le;)(br=mr.get(ut=De(Rt=C[Y])+""))?br.push(Rt):mr.set(ut,[Rt]);return mr.each(function(fn,xn){J(Zr,xn,d(fn,P,L,J))}),Zr}function y(C,P){if(++P>n.length)return C;var L,J=c[P-1];return s!=null&&P>=n.length?L=C.entries():(L=[],C.each(function(Y,le){L.push({key:le,values:y(Y,P)})})),J!=null?L.sort(function(Y,le){return J(Y.key,le.key)}):L}return l={object:function(C){return d(C,0,nt,Oe)},map:function(C){return d(C,0,Tt,jt)},entries:function(C){return y(d(C,0,Tt,jt),0)},key:function(C){return n.push(C),l},sortKeys:function(C){return c[n.length-1]=C,l},sortValues:function(C){return o=C,l},rollup:function(C){return s=C,l}}}function nt(){return{}}function Oe(n,c,o){n[c]=o}function Tt(){return map()}function jt(n,c,o){n.set(c,o)}function Er(){}var $t=Et.prototype;Er.prototype=xr.prototype={constructor:Er,has:$t.has,add:function(n){return n+="",this[Mt+n]=n,this},remove:$t.remove,clear:$t.clear,values:$t.keys,size:$t.size,empty:$t.empty,each:$t.each};function xr(n,c){var o=new Er;if(n instanceof Er)n.each(function(d){o.add(d)});else if(n){var s=-1,l=n.length;if(c==null)for(;++s<l;)o.add(n[s]);else for(;++s<l;)o.add(c(n[s],s,n))}return o}var Yr=null,zn=Array.prototype,Ii=zn.map,In=zn.slice;function $n(n,c){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(c).domain(n);break}return this}function Oi(n,c){switch(arguments.length){case 0:break;case 1:this.interpolator(n);break;default:this.interpolator(c).domain(n);break}return this}var ha={name:"implicit"};function Co(){var n=Et(),c=[],o=[],s=ha;function l(d){var y=d+"",C=n.get(y);if(!C){if(s!==ha)return s;n.set(y,C=c.push(d))}return o[(C-1)%o.length]}return l.domain=function(d){if(!arguments.length)return c.slice();c=[],n=Et();for(var y=-1,C=d.length,P,L;++y<C;)n.has(L=(P=d[y])+"")||n.set(L,c.push(P));return l},l.range=function(d){return arguments.length?(o=In.call(d),l):o.slice()},l.unknown=function(d){return arguments.length?(s=d,l):s},l.copy=function(){return Co(c,o).unknown(s)},$n.apply(l,arguments),l}function yu(){var n=ordinal().unknown(void 0),c=n.domain,o=n.range,s=[0,1],l,d,y=!1,C=0,P=0,L=.5;delete n.unknown;function J(){var Y=c().length,le=s[1]<s[0],De=s[le-0],ut=s[1-le];l=(ut-De)/Math.max(1,Y-C+P*2),y&&(l=Math.floor(l)),De+=(ut-De-l*(Y-C))*L,d=l*(1-C),y&&(De=Math.round(De),d=Math.round(d));var Rt=sequence(Y).map(function(mr){return De+l*mr});return o(le?Rt.reverse():Rt)}return n.domain=function(Y){return arguments.length?(c(Y),J()):c()},n.range=function(Y){return arguments.length?(s=[+Y[0],+Y[1]],J()):s.slice()},n.rangeRound=function(Y){return s=[+Y[0],+Y[1]],y=!0,J()},n.bandwidth=function(){return d},n.step=function(){return l},n.round=function(Y){return arguments.length?(y=!!Y,J()):y},n.padding=function(Y){return arguments.length?(C=Math.min(1,P=+Y),J()):C},n.paddingInner=function(Y){return arguments.length?(C=Math.min(1,Y),J()):C},n.paddingOuter=function(Y){return arguments.length?(P=+Y,J()):P},n.align=function(Y){return arguments.length?(L=Math.max(0,Math.min(1,Y)),J()):L},n.copy=function(){return yu(c(),s).round(y).paddingInner(C).paddingOuter(P).align(L)},initRange.apply(J(),arguments)}function Df(n){var c=n.copy;return n.padding=n.paddingOuter,delete n.paddingInner,delete n.paddingOuter,n.copy=function(){return Df(c())},n}function Cl(){return Df(yu.apply(null,arguments).paddingInner(1))}var sh=_(26257),Tl=_(73626);function kf(n,c){return n=+n,c=+c,function(o){return Math.round(n*(1-o)+c*o)}}function Ff(n){return function(){return n}}function uh(n){return+n}var Bf=[0,1];function Yl(n){return n}function es(n,c){return(c-=n=+n)?function(o){return(o-n)/c}:Ff(isNaN(c)?NaN:.5)}function mo(n){var c=n[0],o=n[n.length-1],s;return c>o&&(s=c,c=o,o=s),function(l){return Math.max(c,Math.min(o,l))}}function Gp(n,c,o){var s=n[0],l=n[1],d=c[0],y=c[1];return l<s?(s=es(l,s),d=o(y,d)):(s=es(s,l),d=o(d,y)),function(C){return d(s(C))}}function Hp(n,c,o){var s=Math.min(n.length,c.length)-1,l=new Array(s),d=new Array(s),y=-1;for(n[s]<n[0]&&(n=n.slice().reverse(),c=c.slice().reverse());++y<s;)l[y]=es(n[y],n[y+1]),d[y]=o(c[y],c[y+1]);return function(C){var P=Wi(n,C,1,s)-1;return d[P](l[P](C))}}function lh(n,c){return c.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function Uh(){var n=Bf,c=Bf,o=sh.Z,s,l,d,y=Yl,C,P,L;function J(){return C=Math.min(n.length,c.length)>2?Hp:Gp,P=L=null,Y}function Y(le){return isNaN(le=+le)?d:(P||(P=C(n.map(s),c,o)))(s(y(le)))}return Y.invert=function(le){return y(l((L||(L=C(c,n.map(s),Tl.Z)))(le)))},Y.domain=function(le){return arguments.length?(n=Ii.call(le,uh),y===Yl||(y=mo(n)),J()):n.slice()},Y.range=function(le){return arguments.length?(c=In.call(le),J()):c.slice()},Y.rangeRound=function(le){return c=In.call(le),o=kf,J()},Y.clamp=function(le){return arguments.length?(y=le?mo(n):Yl,Y):y!==Yl},Y.interpolate=function(le){return arguments.length?(o=le,J()):o},Y.unknown=function(le){return arguments.length?(d=le,Y):d},function(le,De){return s=le,l=De,J()}}function gp(n,c){return Uh()(n,c)}var yp=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Jc(n){if(!(c=yp.exec(n)))throw new Error("invalid format: "+n);var c;return new hf({fill:c[1],align:c[2],sign:c[3],symbol:c[4],zero:c[5],width:c[6],comma:c[7],precision:c[8]&&c[8].slice(1),trim:c[9],type:c[10]})}Jc.prototype=hf.prototype;function hf(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}hf.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Wp(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function Vo(n,c){if((o=(n=c?n.toExponential(c-1):n.toExponential()).indexOf("e"))<0)return null;var o,s=n.slice(0,o);return[s.length>1?s[0]+s.slice(2):s,+n.slice(o+1)]}function Qc(n){return n=Vo(Math.abs(n)),n?n[1]:NaN}function pf(n,c){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Qc(c)/3)))*3-Qc(Math.abs(n)))}function jh(n,c){return function(o,s){for(var l=o.length,d=[],y=0,C=n[0],P=0;l>0&&C>0&&(P+C+1>s&&(C=Math.max(1,s-P)),d.push(o.substring(l-=C,l+C)),!((P+=C+1)>s));)C=n[y=(y+1)%n.length];return d.reverse().join(c)}}function Vh(n){return function(c){return c.replace(/[0-9]/g,function(o){return n[+o]})}}function _p(n){e:for(var c=n.length,o=1,s=-1,l;o<c;++o)switch(n[o]){case".":s=l=o;break;case"0":s===0&&(s=o),l=o;break;default:if(!+n[o])break e;s>0&&(s=0);break}return s>0?n.slice(0,s)+n.slice(l+1):n}var Nf;function df(n,c){var o=Vo(n,c);if(!o)return n+"";var s=o[0],l=o[1],d=l-(Nf=Math.max(-8,Math.min(8,Math.floor(l/3)))*3)+1,y=s.length;return d===y?s:d>y?s+new Array(d-y+1).join("0"):d>0?s.slice(0,d)+"."+s.slice(d):"0."+new Array(1-d).join("0")+Vo(n,Math.max(0,c+d-1))[0]}function xp(n,c){var o=Vo(n,c);if(!o)return n+"";var s=o[0],l=o[1];return l<0?"0."+new Array(-l).join("0")+s:s.length>l+1?s.slice(0,l+1)+"."+s.slice(l+1):s+new Array(l-s.length+2).join("0")}var bp={"%":function(n,c){return(n*100).toFixed(c)},b:function(n){return Math.round(n).toString(2)},c:function(n){return n+""},d:Wp,e:function(n,c){return n.toExponential(c)},f:function(n,c){return n.toFixed(c)},g:function(n,c){return n.toPrecision(c)},o:function(n){return Math.round(n).toString(8)},p:function(n,c){return xp(n*100,c)},r:xp,s:df,X:function(n){return Math.round(n).toString(16).toUpperCase()},x:function(n){return Math.round(n).toString(16)}};function Xp(n){return n}var ws=Array.prototype.map,vf=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function Yp(n){var c=n.grouping===void 0||n.thousands===void 0?Xp:jh(ws.call(n.grouping,Number),n.thousands+""),o=n.currency===void 0?"":n.currency[0]+"",s=n.currency===void 0?"":n.currency[1]+"",l=n.decimal===void 0?".":n.decimal+"",d=n.numerals===void 0?Xp:Vh(ws.call(n.numerals,String)),y=n.percent===void 0?"%":n.percent+"",C=n.minus===void 0?"-":n.minus+"",P=n.nan===void 0?"NaN":n.nan+"";function L(Y){Y=Jc(Y);var le=Y.fill,De=Y.align,ut=Y.sign,Rt=Y.symbol,mr=Y.zero,br=Y.width,Zr=Y.comma,fn=Y.precision,xn=Y.trim,Ln=Y.type;Ln==="n"?(Zr=!0,Ln="g"):bp[Ln]||(fn===void 0&&(fn=12),xn=!0,Ln="g"),(mr||le==="0"&&De==="=")&&(mr=!0,le="0",De="=");var ni=Rt==="$"?o:Rt==="#"&&/[boxX]/.test(Ln)?"0"+Ln.toLowerCase():"",Nn=Rt==="$"?s:/[%p]/.test(Ln)?y:"",xi=bp[Ln],Ji=/[defgprs%]/.test(Ln);fn=fn===void 0?6:/[gprs]/.test(Ln)?Math.max(1,Math.min(21,fn)):Math.max(0,Math.min(20,fn));function ga(hi){var wa=ni,co=Nn,ju,sp,up;if(Ln==="c")co=xi(hi)+co,hi="";else{hi=+hi;var lp=hi<0||1/hi<0;if(hi=isNaN(hi)?P:xi(Math.abs(hi),fn),xn&&(hi=_p(hi)),lp&&+hi==0&&ut!=="+"&&(lp=!1),wa=(lp?ut==="("?ut:C:ut==="-"||ut==="("?"":ut)+wa,co=(Ln==="s"?vf[8+Nf/3]:"")+co+(lp&&ut==="("?")":""),Ji){for(ju=-1,sp=hi.length;++ju<sp;)if(up=hi.charCodeAt(ju),48>up||up>57){co=(up===46?l+hi.slice(ju+1):hi.slice(ju))+co,hi=hi.slice(0,ju);break}}}Zr&&!mr&&(hi=c(hi,Infinity));var cp=wa.length+hi.length+co.length,bf=cp<br?new Array(br-cp+1).join(le):"";switch(Zr&&mr&&(hi=c(bf+hi,bf.length?br-co.length:Infinity),bf=""),De){case"<":hi=wa+hi+co+bf;break;case"=":hi=wa+bf+hi+co;break;case"^":hi=bf.slice(0,cp=bf.length>>1)+wa+hi+co+bf.slice(cp);break;default:hi=bf+wa+hi+co;break}return d(hi)}return ga.toString=function(){return Y+""},ga}function J(Y,le){var De=L((Y=Jc(Y),Y.type="f",Y)),ut=Math.max(-8,Math.min(8,Math.floor(Qc(le)/3)))*3,Rt=Math.pow(10,-ut),mr=vf[8+ut/3];return function(br){return De(Rt*br)+mr}}return{format:L,formatPrefix:J}}var e,t,r;f({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function f(n){return e=Yp(n),t=e.format,r=e.formatPrefix,e}function v(n,c){return n=Math.abs(n),c=Math.abs(c)-n,Math.max(0,Qc(c)-Qc(n))+1}function m(n){return Math.max(0,-Qc(Math.abs(n)))}function x(n,c,o,s){var l=Xi(n,c,o),d;switch(s=Jc(s==null?",f":s),s.type){case"s":{var y=Math.max(Math.abs(n),Math.abs(c));return s.precision==null&&!isNaN(d=pf(l,y))&&(s.precision=d),r(s,y)}case"":case"e":case"g":case"p":case"r":{s.precision==null&&!isNaN(d=v(l,Math.max(Math.abs(n),Math.abs(c))))&&(s.precision=d-(s.type==="e"));break}case"f":case"%":{s.precision==null&&!isNaN(d=m(l))&&(s.precision=d-(s.type==="%")*2);break}}return t(s)}function A(n){var c=n.domain;return n.ticks=function(o){var s=c();return Kt(s[0],s[s.length-1],o==null?10:o)},n.tickFormat=function(o,s){var l=c();return x(l[0],l[l.length-1],o==null?10:o,s)},n.nice=function(o){o==null&&(o=10);var s=c(),l=0,d=s.length-1,y=s[l],C=s[d],P;return C<y&&(P=y,y=C,C=P,P=l,l=d,d=P),P=Cn(y,C,o),P>0?(y=Math.floor(y/P)*P,C=Math.ceil(C/P)*P,P=Cn(y,C,o)):P<0&&(y=Math.ceil(y*P)/P,C=Math.floor(C*P)/P,P=Cn(y,C,o)),P>0?(s[l]=Math.floor(y/P)*P,s[d]=Math.ceil(C/P)*P,c(s)):P<0&&(s[l]=Math.ceil(y*P)/P,s[d]=Math.floor(C*P)/P,c(s)),n},n}function F(){var n=gp(Yl,Yl);return n.copy=function(){return lh(n,F())},$n.apply(n,arguments),A(n)}function Z(n){var c;function o(s){return isNaN(s=+s)?c:s}return o.invert=o,o.domain=o.range=function(s){return arguments.length?(n=Ii.call(s,uh),o):n.slice()},o.unknown=function(s){return arguments.length?(c=s,o):c},o.copy=function(){return Z(n).unknown(c)},n=arguments.length?Ii.call(n,uh):[0,1],A(o)}function K(n,c){n=n.slice();var o=0,s=n.length-1,l=n[o],d=n[s],y;return d<l&&(y=o,o=s,s=y,y=l,l=d,d=y),n[o]=c.floor(l),n[s]=c.ceil(d),n}function q(n){return Math.log(n)}function ue(n){return Math.exp(n)}function de(n){return-Math.log(-n)}function Ge(n){return-Math.exp(-n)}function Ye(n){return isFinite(n)?+("1e"+n):n<0?0:n}function ct(n){return n===10?Ye:n===Math.E?Math.exp:function(c){return Math.pow(n,c)}}function rt(n){return n===Math.E?Math.log:n===10&&Math.log10||n===2&&Math.log2||(n=Math.log(n),function(c){return Math.log(c)/n})}function It(n){return function(c){return-n(-c)}}function Wt(n){var c=n(q,ue),o=c.domain,s=10,l,d;function y(){return l=rt(s),d=ct(s),o()[0]<0?(l=It(l),d=It(d),n(de,Ge)):n(q,ue),c}return c.base=function(C){return arguments.length?(s=+C,y()):s},c.domain=function(C){return arguments.length?(o(C),y()):o()},c.ticks=function(C){var P=o(),L=P[0],J=P[P.length-1],Y;(Y=J<L)&&(le=L,L=J,J=le);var le=l(L),De=l(J),ut,Rt,mr,br=C==null?10:+C,Zr=[];if(!(s%1)&&De-le<br){if(le=Math.round(le)-1,De=Math.round(De)+1,L>0){for(;le<De;++le)for(Rt=1,ut=d(le);Rt<s;++Rt)if(mr=ut*Rt,!(mr<L)){if(mr>J)break;Zr.push(mr)}}else for(;le<De;++le)for(Rt=s-1,ut=d(le);Rt>=1;--Rt)if(mr=ut*Rt,!(mr<L)){if(mr>J)break;Zr.push(mr)}}else Zr=Kt(le,De,Math.min(De-le,br)).map(d);return Y?Zr.reverse():Zr},c.tickFormat=function(C,P){if(P==null&&(P=s===10?".0e":","),typeof P!="function"&&(P=t(P)),C===Infinity)return P;C==null&&(C=10);var L=Math.max(1,s*C/c.ticks().length);return function(J){var Y=J/d(Math.round(l(J)));return Y*s<s-.5&&(Y*=s),Y<=L?P(J):""}},c.nice=function(){return o(K(o(),{floor:function(C){return d(Math.floor(l(C)))},ceil:function(C){return d(Math.ceil(l(C)))}}))},c}function ir(){var n=Wt(Uh()).domain([1,10]);return n.copy=function(){return lh(n,ir()).base(n.base())},$n.apply(n,arguments),n}function dr(n){return function(c){return Math.sign(c)*Math.log1p(Math.abs(c/n))}}function Mr(n){return function(c){return Math.sign(c)*Math.expm1(Math.abs(c))*n}}function en(n){var c=1,o=n(dr(c),Mr(c));return o.constant=function(s){return arguments.length?n(dr(c=+s),Mr(c)):c},linearish(o)}function dn(){var n=en(transformer());return n.copy=function(){return copy(n,dn()).constant(n.constant())},initRange.apply(n,arguments)}function Hn(n){return function(c){return c<0?-Math.pow(-c,n):Math.pow(c,n)}}function En(n){return n<0?-Math.sqrt(-n):Math.sqrt(n)}function ei(n){return n<0?-n*n:n*n}function Tn(n){var c=n(Yl,Yl),o=1;function s(){return o===1?n(Yl,Yl):o===.5?n(En,ei):n(Hn(o),Hn(1/o))}return c.exponent=function(l){return arguments.length?(o=+l,s()):o},A(c)}function Vi(){var n=Tn(Uh());return n.copy=function(){return lh(n,Vi()).exponent(n.exponent())},$n.apply(n,arguments),n}function mi(){return Vi.apply(null,arguments).exponent(.5)}function Bn(){var n=[],c=[],o=[],s;function l(){var y=0,C=Math.max(1,c.length);for(o=new Array(C-1);++y<C;)o[y-1]=Dt(n,y/C);return d}function d(y){return isNaN(y=+y)?s:c[Wi(o,y)]}return d.invertExtent=function(y){var C=c.indexOf(y);return C<0?[NaN,NaN]:[C>0?o[C-1]:n[0],C<o.length?o[C]:n[n.length-1]]},d.domain=function(y){if(!arguments.length)return n.slice();n=[];for(var C=0,P=y.length,L;C<P;++C)L=y[C],L!=null&&!isNaN(L=+L)&&n.push(L);return n.sort(_s),l()},d.range=function(y){return arguments.length?(c=In.call(y),l()):c.slice()},d.unknown=function(y){return arguments.length?(s=y,d):s},d.quantiles=function(){return o.slice()},d.copy=function(){return Bn().domain(n).range(c).unknown(s)},$n.apply(d,arguments)}function ta(){var n=0,c=1,o=1,s=[.5],l=[0,1],d;function y(P){return P<=P?l[Wi(s,P,0,o)]:d}function C(){var P=-1;for(s=new Array(o);++P<o;)s[P]=((P+1)*c-(P-o)*n)/(o+1);return y}return y.domain=function(P){return arguments.length?(n=+P[0],c=+P[1],C()):[n,c]},y.range=function(P){return arguments.length?(o=(l=In.call(P)).length-1,C()):l.slice()},y.invertExtent=function(P){var L=l.indexOf(P);return L<0?[NaN,NaN]:L<1?[n,s[0]]:L>=o?[s[o-1],c]:[s[L-1],s[L]]},y.unknown=function(P){return arguments.length&&(d=P),y},y.thresholds=function(){return s.slice()},y.copy=function(){return ta().domain([n,c]).range(l).unknown(d)},$n.apply(A(y),arguments)}function Li(){var n=[.5],c=[0,1],o,s=1;function l(d){return d<=d?c[Wi(n,d,0,s)]:o}return l.domain=function(d){return arguments.length?(n=In.call(d),s=Math.min(n.length,c.length-1),l):n.slice()},l.range=function(d){return arguments.length?(c=In.call(d),s=Math.min(n.length,c.length-1),l):c.slice()},l.invertExtent=function(d){var y=c.indexOf(d);return[n[y-1],n[y]]},l.unknown=function(d){return arguments.length?(o=d,l):o},l.copy=function(){return Li().domain(n).range(c).unknown(o)},$n.apply(l,arguments)}var la=new Date,Jn=new Date;function zi(n,c,o,s){function l(d){return n(d=arguments.length===0?new Date:new Date(+d)),d}return l.floor=function(d){return n(d=new Date(+d)),d},l.ceil=function(d){return n(d=new Date(d-1)),c(d,1),n(d),d},l.round=function(d){var y=l(d),C=l.ceil(d);return d-y<C-d?y:C},l.offset=function(d,y){return c(d=new Date(+d),y==null?1:Math.floor(y)),d},l.range=function(d,y,C){var P=[],L;if(d=l.ceil(d),C=C==null?1:Math.floor(C),!(d<y)||!(C>0))return P;do P.push(L=new Date(+d)),c(d,C),n(d);while(L<d&&d<y);return P},l.filter=function(d){return zi(function(y){if(y>=y)for(;n(y),!d(y);)y.setTime(y-1)},function(y,C){if(y>=y)if(C<0)for(;++C<=0;)for(;c(y,-1),!d(y););else for(;--C>=0;)for(;c(y,1),!d(y););})},o&&(l.count=function(d,y){return la.setTime(+d),Jn.setTime(+y),n(la),n(Jn),Math.floor(o(la,Jn))},l.every=function(d){return d=Math.floor(d),!isFinite(d)||!(d>0)?null:d>1?l.filter(s?function(y){return s(y)%d==0}:function(y){return l.count(0,y)%d==0}):l}),l}var uo=zi(function(n){n.setMonth(0,1),n.setHours(0,0,0,0)},function(n,c){n.setFullYear(n.getFullYear()+c)},function(n,c){return c.getFullYear()-n.getFullYear()},function(n){return n.getFullYear()});uo.every=function(n){return!isFinite(n=Math.floor(n))||!(n>0)?null:zi(function(c){c.setFullYear(Math.floor(c.getFullYear()/n)*n),c.setMonth(0,1),c.setHours(0,0,0,0)},function(c,o){c.setFullYear(c.getFullYear()+o*n)})};var lo=uo,Go=uo.range,go=zi(function(n){n.setDate(1),n.setHours(0,0,0,0)},function(n,c){n.setMonth(n.getMonth()+c)},function(n,c){return c.getMonth()-n.getMonth()+(c.getFullYear()-n.getFullYear())*12},function(n){return n.getMonth()}),Ho=go,Bs=go.range,ts=1e3,Cs=6e4,Ts=36e5,iu=864e5,Wo=6048e5;function Bo(n){return zi(function(c){c.setDate(c.getDate()-(c.getDay()+7-n)%7),c.setHours(0,0,0,0)},function(c,o){c.setDate(c.getDate()+o*7)},function(c,o){return(o-c-(o.getTimezoneOffset()-c.getTimezoneOffset())*Cs)/Wo})}var na=Bo(0),Ia=Bo(1),Da=Bo(2),pa=Bo(3),As=Bo(4),au=Bo(5),yo=Bo(6),xs=na.range,_u=Ia.range,Ea=Da.range,mf=pa.range,Kl=As.range,gf=au.range,us=yo.range,Cc=zi(function(n){n.setHours(0,0,0,0)},function(n,c){n.setDate(n.getDate()+c)},function(n,c){return(c-n-(c.getTimezoneOffset()-n.getTimezoneOffset())*Cs)/iu},function(n){return n.getDate()-1}),Al=Cc,ch=Cc.range,Tf=zi(function(n){n.setTime(n-n.getMilliseconds()-n.getSeconds()*ts-n.getMinutes()*Cs)},function(n,c){n.setTime(+n+c*Ts)},function(n,c){return(c-n)/Ts},function(n){return n.getHours()}),$f=Tf,Af=Tf.range,zf=zi(function(n){n.setTime(n-n.getMilliseconds()-n.getSeconds()*ts)},function(n,c){n.setTime(+n+c*Cs)},function(n,c){return(c-n)/Cs},function(n){return n.getMinutes()}),Gh=zf,fh=zf.range,Jf=zi(function(n){n.setTime(n-n.getMilliseconds())},function(n,c){n.setTime(+n+c*ts)},function(n,c){return(c-n)/ts},function(n){return n.getUTCSeconds()}),Hh=Jf,Sp=Jf.range,lc=zi(function(){},function(n,c){n.setTime(+n+c)},function(n,c){return c-n});lc.every=function(n){return n=Math.floor(n),!isFinite(n)||!(n>0)?null:n>1?zi(function(c){c.setTime(Math.floor(c/n)*n)},function(c,o){c.setTime(+c+o*n)},function(c,o){return(o-c)/n}):lc};var hh=lc,ph=lc.range;function Pl(n){return zi(function(c){c.setUTCDate(c.getUTCDate()-(c.getUTCDay()+7-n)%7),c.setUTCHours(0,0,0,0)},function(c,o){c.setUTCDate(c.getUTCDate()+o*7)},function(c,o){return(o-c)/Wo})}var Zf=Pl(0),Uf=Pl(1),Wh=Pl(2),dh=Pl(3),qc=Pl(4),Xh=Pl(5),vh=Pl(6),Yh=Zf.range,Kh=Uf.range,Ep=Wh.range,mh=dh.range,wp=qc.range,gh=Xh.range,$h=vh.range,Pf=zi(function(n){n.setUTCHours(0,0,0,0)},function(n,c){n.setUTCDate(n.getUTCDate()+c)},function(n,c){return(c-n)/iu},function(n){return n.getUTCDate()-1}),Qf=Pf,yh=Pf.range,_h=zi(function(n){n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},function(n,c){n.setUTCFullYear(n.getUTCFullYear()+c)},function(n,c){return c.getUTCFullYear()-n.getUTCFullYear()},function(n){return n.getUTCFullYear()});_h.every=function(n){return!isFinite(n=Math.floor(n))||!(n>0)?null:zi(function(c){c.setUTCFullYear(Math.floor(c.getUTCFullYear()/n)*n),c.setUTCMonth(0,1),c.setUTCHours(0,0,0,0)},function(c,o){c.setUTCFullYear(c.getUTCFullYear()+o*n)})};var qf=_h,Kp=_h.range;function Jh(n){if(0<=n.y&&n.y<100){var c=new Date(-1,n.m,n.d,n.H,n.M,n.S,n.L);return c.setFullYear(n.y),c}return new Date(n.y,n.m,n.d,n.H,n.M,n.S,n.L)}function xh(n){if(0<=n.y&&n.y<100){var c=new Date(Date.UTC(-1,n.m,n.d,n.H,n.M,n.S,n.L));return c.setUTCFullYear(n.y),c}return new Date(Date.UTC(n.y,n.m,n.d,n.H,n.M,n.S,n.L))}function bh(n,c,o){return{y:n,m:c,d:o,H:0,M:0,S:0,L:0}}function Sh(n){var c=n.dateTime,o=n.date,s=n.time,l=n.periods,d=n.days,y=n.shortDays,C=n.months,P=n.shortMonths,L=If(l),J=Ml(l),Y=If(d),le=Ml(d),De=If(y),ut=Ml(y),Rt=If(C),mr=Ml(C),br=If(P),Zr=Ml(P),fn={a:lp,A:cp,b:bf,B:d0,c:null,d:Vf,e:Vf,f:id,g:ld,G:cd,H:rh,I:nh,j:nd,L:Pp,m:ad,M:Mp,p:v0,q:m0,Q:Kd,s:$d,S:Ip,u:yf,U:od,V:Op,w:sd,W:Lp,x:null,X:null,y:ud,Y:Rp,Z:wh,"%":Yd},xn={a:g0,A:y0,b:_0,B:x0,c:null,d:Dp,e:Dp,f:Rd,g:vd,G:Um,H:np,I:Ld,j:fd,L:hd,m:Dd,M:kd,p:b0,q:S0,Q:Kd,s:$d,S:Fd,u:Bd,U:Nd,V:tf,w:ip,W:dd,x:null,X:null,y:Ch,Y:Zm,Z:jm,"%":Yd},Ln={a:ga,A:hi,b:wa,B:co,c:ju,d:Ap,e:Ap,f:Od,g:eh,G:Tp,H:ol,I:ol,j:ed,L:ef,m:qp,M:tp,p:Ji,q:Qp,Q:jf,s:th,S:td,u:Eh,U:qh,V:ep,w:Qh,W:Cp,x:sp,X:up,y:eh,Y:Tp,Z:Jp,"%":rd};fn.x=ni(o,fn),fn.X=ni(s,fn),fn.c=ni(c,fn),xn.x=ni(o,xn),xn.X=ni(s,xn),xn.c=ni(c,xn);function ni(_i,Na){return function(_o){var An=[],cc=-1,ls=0,Tc=_i.length,Ac,Ph,zm;for(_o instanceof Date||(_o=new Date(+_o));++cc<Tc;)_i.charCodeAt(cc)===37&&(An.push(_i.slice(ls,cc)),(Ph=Xo[Ac=_i.charAt(++cc)])!=null?Ac=_i.charAt(++cc):Ph=Ac==="e"?" ":"0",(zm=Na[Ac])&&(Ac=zm(_o,Ph)),An.push(Ac),ls=cc+1);return An.push(_i.slice(ls,cc)),An.join("")}}function Nn(_i,Na){return function(_o){var An=bh(1900,void 0,1),cc=xi(An,_i,_o+="",0),ls,Tc;if(cc!=_o.length)return null;if("Q"in An)return new Date(An.Q);if("s"in An)return new Date(An.s*1e3+("L"in An?An.L:0));if(Na&&!("Z"in An)&&(An.Z=0),"p"in An&&(An.H=An.H%12+An.p*12),An.m===void 0&&(An.m="q"in An?An.q:0),"V"in An){if(An.V<1||An.V>53)return null;"w"in An||(An.w=1),"Z"in An?(ls=xh(bh(An.y,0,1)),Tc=ls.getUTCDay(),ls=Tc>4||Tc===0?Uf.ceil(ls):Uf(ls),ls=Qf.offset(ls,(An.V-1)*7),An.y=ls.getUTCFullYear(),An.m=ls.getUTCMonth(),An.d=ls.getUTCDate()+(An.w+6)%7):(ls=Jh(bh(An.y,0,1)),Tc=ls.getDay(),ls=Tc>4||Tc===0?Ia.ceil(ls):Ia(ls),ls=Al.offset(ls,(An.V-1)*7),An.y=ls.getFullYear(),An.m=ls.getMonth(),An.d=ls.getDate()+(An.w+6)%7)}else("W"in An||"U"in An)&&("w"in An||(An.w="u"in An?An.u%7:"W"in An?1:0),Tc="Z"in An?xh(bh(An.y,0,1)).getUTCDay():Jh(bh(An.y,0,1)).getDay(),An.m=0,An.d="W"in An?(An.w+6)%7+An.W*7-(Tc+5)%7:An.w+An.U*7-(Tc+6)%7);return"Z"in An?(An.H+=An.Z/100|0,An.M+=An.Z%100,xh(An)):Jh(An)}}function xi(_i,Na,_o,An){for(var cc=0,ls=Na.length,Tc=_o.length,Ac,Ph;cc<ls;){if(An>=Tc)return-1;if(Ac=Na.charCodeAt(cc++),Ac===37){if(Ac=Na.charAt(cc++),Ph=Ln[Ac in Xo?Na.charAt(cc++):Ac],!Ph||(An=Ph(_i,_o,An))<0)return-1}else if(Ac!=_o.charCodeAt(An++))return-1}return An}function Ji(_i,Na,_o){var An=L.exec(Na.slice(_o));return An?(_i.p=J[An[0].toLowerCase()],_o+An[0].length):-1}function ga(_i,Na,_o){var An=De.exec(Na.slice(_o));return An?(_i.w=ut[An[0].toLowerCase()],_o+An[0].length):-1}function hi(_i,Na,_o){var An=Y.exec(Na.slice(_o));return An?(_i.w=le[An[0].toLowerCase()],_o+An[0].length):-1}function wa(_i,Na,_o){var An=br.exec(Na.slice(_o));return An?(_i.m=Zr[An[0].toLowerCase()],_o+An[0].length):-1}function co(_i,Na,_o){var An=Rt.exec(Na.slice(_o));return An?(_i.m=mr[An[0].toLowerCase()],_o+An[0].length):-1}function ju(_i,Na,_o){return xi(_i,c,Na,_o)}function sp(_i,Na,_o){return xi(_i,o,Na,_o)}function up(_i,Na,_o){return xi(_i,s,Na,_o)}function lp(_i){return y[_i.getDay()]}function cp(_i){return d[_i.getDay()]}function bf(_i){return P[_i.getMonth()]}function d0(_i){return C[_i.getMonth()]}function v0(_i){return l[+(_i.getHours()>=12)]}function m0(_i){return 1+~~(_i.getMonth()/3)}function g0(_i){return y[_i.getUTCDay()]}function y0(_i){return d[_i.getUTCDay()]}function _0(_i){return P[_i.getUTCMonth()]}function x0(_i){return C[_i.getUTCMonth()]}function b0(_i){return l[+(_i.getUTCHours()>=12)]}function S0(_i){return 1+~~(_i.getUTCMonth()/3)}return{format:function(_i){var Na=ni(_i+="",fn);return Na.toString=function(){return _i},Na},parse:function(_i){var Na=Nn(_i+="",!1);return Na.toString=function(){return _i},Na},utcFormat:function(_i){var Na=ni(_i+="",xn);return Na.toString=function(){return _i},Na},utcParse:function(_i){var Na=Nn(_i+="",!0);return Na.toString=function(){return _i},Na}}}var Xo={"-":"",_:" ","0":"0"},Io=/^\s*\d+/,Id=/^%/,Mf=/[\\^$*+?|[\]().{}]/g;function Ba(n,c,o){var s=n<0?"-":"",l=(s?-n:n)+"",d=l.length;return s+(d<o?new Array(o-d+1).join(c)+l:l)}function $p(n){return n.replace(Mf,"\\$&")}function If(n){return new RegExp("^(?:"+n.map($p).join("|")+")","i")}function Ml(n){for(var c={},o=-1,s=n.length;++o<s;)c[n[o].toLowerCase()]=o;return c}function Qh(n,c,o){var s=Io.exec(c.slice(o,o+1));return s?(n.w=+s[0],o+s[0].length):-1}function Eh(n,c,o){var s=Io.exec(c.slice(o,o+1));return s?(n.u=+s[0],o+s[0].length):-1}function qh(n,c,o){var s=Io.exec(c.slice(o,o+2));return s?(n.U=+s[0],o+s[0].length):-1}function ep(n,c,o){var s=Io.exec(c.slice(o,o+2));return s?(n.V=+s[0],o+s[0].length):-1}function Cp(n,c,o){var s=Io.exec(c.slice(o,o+2));return s?(n.W=+s[0],o+s[0].length):-1}function Tp(n,c,o){var s=Io.exec(c.slice(o,o+4));return s?(n.y=+s[0],o+s[0].length):-1}function eh(n,c,o){var s=Io.exec(c.slice(o,o+2));return s?(n.y=+s[0]+(+s[0]>68?1900:2e3),o+s[0].length):-1}function Jp(n,c,o){var s=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(c.slice(o,o+6));return s?(n.Z=s[1]?0:-(s[2]+(s[3]||"00")),o+s[0].length):-1}function Qp(n,c,o){var s=Io.exec(c.slice(o,o+1));return s?(n.q=s[0]*3-3,o+s[0].length):-1}function qp(n,c,o){var s=Io.exec(c.slice(o,o+2));return s?(n.m=s[0]-1,o+s[0].length):-1}function Ap(n,c,o){var s=Io.exec(c.slice(o,o+2));return s?(n.d=+s[0],o+s[0].length):-1}function ed(n,c,o){var s=Io.exec(c.slice(o,o+3));return s?(n.m=0,n.d=+s[0],o+s[0].length):-1}function ol(n,c,o){var s=Io.exec(c.slice(o,o+2));return s?(n.H=+s[0],o+s[0].length):-1}function tp(n,c,o){var s=Io.exec(c.slice(o,o+2));return s?(n.M=+s[0],o+s[0].length):-1}function td(n,c,o){var s=Io.exec(c.slice(o,o+2));return s?(n.S=+s[0],o+s[0].length):-1}function ef(n,c,o){var s=Io.exec(c.slice(o,o+3));return s?(n.L=+s[0],o+s[0].length):-1}function Od(n,c,o){var s=Io.exec(c.slice(o,o+6));return s?(n.L=Math.floor(s[0]/1e3),o+s[0].length):-1}function rd(n,c,o){var s=Id.exec(c.slice(o,o+1));return s?o+s[0].length:-1}function jf(n,c,o){var s=Io.exec(c.slice(o));return s?(n.Q=+s[0],o+s[0].length):-1}function th(n,c,o){var s=Io.exec(c.slice(o));return s?(n.s=+s[0],o+s[0].length):-1}function Vf(n,c){return Ba(n.getDate(),c,2)}function rh(n,c){return Ba(n.getHours(),c,2)}function nh(n,c){return Ba(n.getHours()%12||12,c,2)}function nd(n,c){return Ba(1+Al.count(lo(n),n),c,3)}function Pp(n,c){return Ba(n.getMilliseconds(),c,3)}function id(n,c){return Pp(n,c)+"000"}function ad(n,c){return Ba(n.getMonth()+1,c,2)}function Mp(n,c){return Ba(n.getMinutes(),c,2)}function Ip(n,c){return Ba(n.getSeconds(),c,2)}function yf(n){var c=n.getDay();return c===0?7:c}function od(n,c){return Ba(na.count(lo(n)-1,n),c,2)}function rp(n){var c=n.getDay();return c>=4||c===0?As(n):As.ceil(n)}function Op(n,c){return n=rp(n),Ba(As.count(lo(n),n)+(lo(n).getDay()===4),c,2)}function sd(n){return n.getDay()}function Lp(n,c){return Ba(Ia.count(lo(n)-1,n),c,2)}function ud(n,c){return Ba(n.getFullYear()%100,c,2)}function ld(n,c){return n=rp(n),Ba(n.getFullYear()%100,c,2)}function Rp(n,c){return Ba(n.getFullYear()%1e4,c,4)}function cd(n,c){var o=n.getDay();return n=o>=4||o===0?As(n):As.ceil(n),Ba(n.getFullYear()%1e4,c,4)}function wh(n){var c=n.getTimezoneOffset();return(c>0?"-":(c*=-1,"+"))+Ba(c/60|0,"0",2)+Ba(c%60,"0",2)}function Dp(n,c){return Ba(n.getUTCDate(),c,2)}function np(n,c){return Ba(n.getUTCHours(),c,2)}function Ld(n,c){return Ba(n.getUTCHours()%12||12,c,2)}function fd(n,c){return Ba(1+Qf.count(qf(n),n),c,3)}function hd(n,c){return Ba(n.getUTCMilliseconds(),c,3)}function Rd(n,c){return hd(n,c)+"000"}function Dd(n,c){return Ba(n.getUTCMonth()+1,c,2)}function kd(n,c){return Ba(n.getUTCMinutes(),c,2)}function Fd(n,c){return Ba(n.getUTCSeconds(),c,2)}function Bd(n){var c=n.getUTCDay();return c===0?7:c}function Nd(n,c){return Ba(Zf.count(qf(n)-1,n),c,2)}function pd(n){var c=n.getUTCDay();return c>=4||c===0?qc(n):qc.ceil(n)}function tf(n,c){return n=pd(n),Ba(qc.count(qf(n),n)+(qf(n).getUTCDay()===4),c,2)}function ip(n){return n.getUTCDay()}function dd(n,c){return Ba(Uf.count(qf(n)-1,n),c,2)}function Ch(n,c){return Ba(n.getUTCFullYear()%100,c,2)}function vd(n,c){return n=pd(n),Ba(n.getUTCFullYear()%100,c,2)}function Zm(n,c){return Ba(n.getUTCFullYear()%1e4,c,4)}function Um(n,c){var o=n.getUTCDay();return n=o>=4||o===0?qc(n):qc.ceil(n),Ba(n.getUTCFullYear()%1e4,c,4)}function jm(){return"+0000"}function Yd(){return"%"}function Kd(n){return+n}function $d(n){return Math.floor(+n/1e3)}var ap,Jd,Vm,Gm,Hm;Wm({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Wm(n){return ap=Sh(n),Jd=ap.format,Vm=ap.parse,Gm=ap.utcFormat,Hm=ap.utcParse,ap}var kp=1e3,Fp=kp*60,Bp=Fp*60,Np=Bp*24,Xm=Np*7,Qd=Np*30,zd=Np*365;function Ym(n){return new Date(n)}function Km(n){return n instanceof Date?+n:+new Date(+n)}function qd(n,c,o,s,l,d,y,C,P){var L=gp(Yl,Yl),J=L.invert,Y=L.domain,le=P(".%L"),De=P(":%S"),ut=P("%I:%M"),Rt=P("%I %p"),mr=P("%a %d"),br=P("%b %d"),Zr=P("%B"),fn=P("%Y"),xn=[[y,1,kp],[y,5,5*kp],[y,15,15*kp],[y,30,30*kp],[d,1,Fp],[d,5,5*Fp],[d,15,15*Fp],[d,30,30*Fp],[l,1,Bp],[l,3,3*Bp],[l,6,6*Bp],[l,12,12*Bp],[s,1,Np],[s,2,2*Np],[o,1,Xm],[c,1,Qd],[c,3,3*Qd],[n,1,zd]];function Ln(Nn){return(y(Nn)<Nn?le:d(Nn)<Nn?De:l(Nn)<Nn?ut:s(Nn)<Nn?Rt:c(Nn)<Nn?o(Nn)<Nn?mr:br:n(Nn)<Nn?Zr:fn)(Nn)}function ni(Nn,xi,Ji,ga){if(Nn==null&&(Nn=10),typeof Nn=="number"){var hi=Math.abs(Ji-xi)/Nn,wa=Fo(function(co){return co[2]}).right(xn,hi);wa===xn.length?(ga=Xi(xi/zd,Ji/zd,Nn),Nn=n):wa?(wa=xn[hi/xn[wa-1][2]<xn[wa][2]/hi?wa-1:wa],ga=wa[1],Nn=wa[0]):(ga=Math.max(Xi(xi,Ji,Nn),1),Nn=C)}return ga==null?Nn:Nn.every(ga)}return L.invert=function(Nn){return new Date(J(Nn))},L.domain=function(Nn){return arguments.length?Y(Ii.call(Nn,Km)):Y().map(Ym)},L.ticks=function(Nn,xi){var Ji=Y(),ga=Ji[0],hi=Ji[Ji.length-1],wa=hi<ga,co;return wa&&(co=ga,ga=hi,hi=co),co=ni(Nn,ga,hi,xi),co=co?co.range(ga,hi+1):[],wa?co.reverse():co},L.tickFormat=function(Nn,xi){return xi==null?Ln:P(xi)},L.nice=function(Nn,xi){var Ji=Y();return(Nn=ni(Nn,Ji[0],Ji[Ji.length-1],xi))?Y(K(Ji,Nn)):L},L.copy=function(){return lh(L,qd(n,c,o,s,l,d,y,C,P))},L}function $m(){return $n.apply(qd(lo,Ho,na,Al,$f,Gh,Hh,hh,Jd).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function E0(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function md(){var n=0,c=1,o,s,l,d,y=identity,C=!1,P;function L(J){return isNaN(J=+J)?P:y(l===0?.5:(J=(d(J)-o)*l,C?Math.max(0,Math.min(1,J)):J))}return L.domain=function(J){return arguments.length?(o=d(n=+J[0]),s=d(c=+J[1]),l=o===s?0:1/(s-o),L):[n,c]},L.clamp=function(J){return arguments.length?(C=!!J,L):C},L.interpolator=function(J){return arguments.length?(y=J,L):y},L.unknown=function(J){return arguments.length?(P=J,L):P},function(J){return d=J,o=J(n),s=J(c),l=o===s?0:1/(s-o),L}}function gd(n,c){return c.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function Jm(){var n=linearish(md()(identity));return n.copy=function(){return gd(n,Jm())},initInterpolator.apply(n,arguments)}function Qm(){var n=loggish(md()).domain([1,10]);return n.copy=function(){return gd(n,Qm()).base(n.base())},initInterpolator.apply(n,arguments)}function qm(){var n=symlogish(md());return n.copy=function(){return gd(n,qm()).constant(n.constant())},initInterpolator.apply(n,arguments)}function ev(){var n=powish(md());return n.copy=function(){return gd(n,ev()).exponent(n.exponent())},initInterpolator.apply(n,arguments)}function w0(){return ev.apply(null,arguments).exponent(.5)}function eg(){var n=[],c=identity;function o(s){if(!isNaN(s=+s))return c((bisect(n,s)-1)/(n.length-1))}return o.domain=function(s){if(!arguments.length)return n.slice();n=[];for(var l=0,d=s.length,y;l<d;++l)y=s[l],y!=null&&!isNaN(y=+y)&&n.push(y);return n.sort(ascending),o},o.interpolator=function(s){return arguments.length?(c=s,o):c},o.copy=function(){return eg(c).domain(n)},initInterpolator.apply(o,arguments)}function yd(){var n=0,c=.5,o=1,s,l,d,y,C,P=identity,L,J=!1,Y;function le(De){return isNaN(De=+De)?Y:(De=.5+((De=+L(De))-l)*(De<l?y:C),P(J?Math.max(0,Math.min(1,De)):De))}return le.domain=function(De){return arguments.length?(s=L(n=+De[0]),l=L(c=+De[1]),d=L(o=+De[2]),y=s===l?0:.5/(l-s),C=l===d?0:.5/(d-l),le):[n,c,o]},le.clamp=function(De){return arguments.length?(J=!!De,le):J},le.interpolator=function(De){return arguments.length?(P=De,le):P},le.unknown=function(De){return arguments.length?(Y=De,le):Y},function(De){return L=De,s=De(n),l=De(c),d=De(o),y=s===l?0:.5/(l-s),C=l===d?0:.5/(d-l),le}}function tg(){var n=linearish(yd()(identity));return n.copy=function(){return copy(n,tg())},initInterpolator.apply(n,arguments)}function rg(){var n=loggish(yd()).domain([.1,1,10]);return n.copy=function(){return copy(n,rg()).base(n.base())},initInterpolator.apply(n,arguments)}function ng(){var n=symlogish(yd());return n.copy=function(){return copy(n,ng()).constant(n.constant())},initInterpolator.apply(n,arguments)}function tv(){var n=powish(yd());return n.copy=function(){return copy(n,tv()).exponent(n.exponent())},initInterpolator.apply(n,arguments)}function C0(){return tv.apply(null,arguments).exponent(.5)}var _f,rv,nv,iv,av,_d,ov,sv,ig=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,ag=(_f={},(0,I.Z)(_f,b.vY.LINEAR,F),(0,I.Z)(_f,b.vY.POWER,Vi),(0,I.Z)(_f,b.vY.LOG,ir),(0,I.Z)(_f,b.vY.IDENTITY,Z),(0,I.Z)(_f,b.vY.TIME,$m),(0,I.Z)(_f,b.vY.QUANTILE,Bn),(0,I.Z)(_f,b.vY.QUANTIZE,ta),(0,I.Z)(_f,b.vY.THRESHOLD,Li),(0,I.Z)(_f,b.vY.CAT,Co),_f),og=(rv=(0,V.b2)(),nv=(0,V.f3)(b.vK.IGlobalConfigService),iv=(0,V.f3)(b.vK.ILogService),rv(av=(_d=function(){function n(){(0,W.Z)(this,n),(0,Wn.Z)(this,"configService",ov,this),(0,Wn.Z)(this,"logger",sv,this),(0,I.Z)(this,"scaleCache",{}),(0,I.Z)(this,"scaleOptions",{})}return(0,$.Z)(n,[{key:"apply",value:function(o,s){var l=this,d=s.styleAttributeService;o.hooks.init.tap("FeatureScalePlugin",function(){l.scaleOptions=o.getScaleOptions();var y=d.getLayerStyleAttributes(),C=o.getSource().data.dataArray;C.length!==0&&l.caculateScalesForAttributes(y||[],C)}),o.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){l.scaleOptions=o.getScaleOptions();var y=d.getLayerStyleAttributes(),C=o.getSource().data.dataArray;return l.caculateScalesForAttributes(y||[],C),o.layerModelNeedUpdate=!0,!0}),o.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!o.layerModelNeedUpdate){l.scaleOptions=o.getScaleOptions();var y=d.getLayerStyleAttributes();if(y){var C=o.getSource().data.dataArray;if(C.length===0)return;var P=y.filter(function(L){return L.needRescale});P.length&&(l.caculateScalesForAttributes(P,C),l.logger.debug("rescale finished"))}}})}},{key:"isNumber",value:function(o){return!isNaN(parseFloat(o))&&isFinite(o)}},{key:"caculateScalesForAttributes",value:function(o,s){var l=this;this.scaleCache={},o.forEach(function(d){if(d.scale){var y=d.scale,C=d.name;y.names=l.parseFields(d.scale.field||[]);var P=[];y.names.forEach(function(L){P.push(l.getOrCreateScale(L,d,s))}),P.some(function(L){return L.type===b.ee.VARIABLE})?(y.type=b.ee.VARIABLE,P.forEach(function(L){if(!y.callback){var J;if(y.values&&y.values!=="text"){var Y;if(((Y=L.option)===null||Y===void 0?void 0:Y.type)==="linear"&&y.values.length>2){var le=L.scale.ticks(y.values.length);C==="color"&&L.scale.domain(le)}L.scale.range(y.values)}else((J=L.option)===null||J===void 0?void 0:J.type)==="cat"&&L.scale.range(L.option.domain)}})):(y.type=b.ee.CONSTANT,y.defaultValues=P.map(function(L,J){return L.scale(y.names[J])})),y.scalers=P.map(function(L){return{field:L.field,func:L.scale,option:L.option}}),d.needRescale=!1}})}},{key:"getOrCreateScale",value:function(o,s,l){var d,y=[o,s.name].join("_"),C=(d=s.scale)===null||d===void 0?void 0:d.values,P=this.createScale(o,s.name,C,l);return P}},{key:"parseFields",value:function(o){return Array.isArray(o)?o:Za()(o)?o.split("*"):[o]}},{key:"createScale",value:function(o,s,l,d){var y,C,P=this.scaleOptions[s]&&((y=this.scaleOptions[s])===null||y===void 0?void 0:y.field)===o?this.scaleOptions[s]:this.scaleOptions[o],L={field:o,scale:void 0,type:b.ee.VARIABLE,option:P};if(!d||!d.length)return P&&P.type?L.scale=this.createDefaultScale(P):(L.scale=Co([o]),L.type=b.ee.CONSTANT),L;var J=(C=d.find(function(De){return!Kn()(De[o])}))===null||C===void 0?void 0:C[o];if(this.isNumber(o)||Kn()(J)&&!P)L.scale=Co([o]),L.type=b.ee.CONSTANT;else{var Y=P&&P.type||this.getDefaultType(J);l==="text"&&(Y=b.vY.CAT);var le=this.createDefaultScaleConfig(Y,o,d);Object.assign(le,P),L.scale=this.createDefaultScale(le),L.option=le}return L}},{key:"getDefaultType",value:function(o){var s=b.vY.LINEAR;return typeof o=="string"&&(s=ig.test(o)?b.vY.TIME:b.vY.CAT),s}},{key:"createDefaultScaleConfig",value:function(o,s,l){var d={type:o},y=(l==null?void 0:l.map(function(C){return C[s]}))||[];return o!==b.vY.CAT&&o!==b.vY.QUANTILE?d.domain=Pi(y):o===b.vY.CAT?d.domain=nn()(y):o===b.vY.QUANTILE&&(d.domain=y),d}},{key:"createDefaultScale",value:function(o){var s=o.type,l=o.domain,d=ag[s]();return l&&d.domain(l),d}}]),n}(),ov=(0,ai.Z)(_d.prototype,"configService",[nv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sv=(0,ai.Z)(_d.prototype,"logger",[iv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_d))||av),uv,lv,cv,fv,xd,hv,pv;function dv(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function sg(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?dv(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):dv(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}var ug=(uv=(0,V.b2)(),lv=(0,V.f3)(b.vK.ICameraService),cv=(0,V.f3)(b.vK.IRendererService),uv(fv=(xd=function(){function n(){(0,W.Z)(this,n),(0,Wn.Z)(this,"cameraService",hv,this),(0,Wn.Z)(this,"rendererService",pv,this)}return(0,$.Z)(n,[{key:"apply",value:function(o){o.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){o.models.forEach(function(s){s.addUniforms(sg({},o.layerModel.getAnimateUniforms()))})})}}]),n}(),hv=(0,ai.Z)(xd.prototype,"cameraService",[lv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pv=(0,ai.Z)(xd.prototype,"rendererService",[cv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xd))||fv),vv,mv,lg=(vv=(0,V.b2)(),vv(mv=function(){function n(){(0,W.Z)(this,n)}return(0,$.Z)(n,[{key:"apply",value:function(o){o.hooks.init.tap("LayerModelPlugin",function(){o.prepareBuildModel(),o.buildModels(),o.styleNeedUpdate=!1}),o.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return o.prepareBuildModel(),o.clearModels(),o.buildModels(),o.layerModelNeedUpdate=!1,!1})}}]),n}())||mv),gv,yv,cg=(gv=(0,V.b2)(),gv(yv=function(){function n(){(0,W.Z)(this,n)}return(0,$.Z)(n,[{key:"apply",value:function(o){o.hooks.afterInit.tap("LayerStylePlugin",function(){o.updateLayerConfig({});var s=o.getLayerConfig(),l=s.autoFit,d=s.fitBoundsOptions;l&&setTimeout(function(){o.fitBounds(d)},100)})}}]),n}())||yv),_v,xv;function bv(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function zp(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?bv(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):bv(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}var Sv={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},fg={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},hg={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},pg={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},T0=null;function dg(n){var c={u_DirectionalLights:new Array(3).fill(zp({},hg)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(zp({},pg)),u_NumOfSpotLights:0};return(!n||!n.length)&&(n=[fg]),n.forEach(function(o,s){var l=o.type,d=l===void 0?"directional":l,y=(0,za.Z)(o,["type"]),C=Sv[d].lights,P=Sv[d].num,L=c[P];c[C][L]=zp(zp({},c[C][L]),y),c[P]++}),c}var vg=(_v=(0,V.b2)(),_v(xv=function(){function n(){(0,W.Z)(this,n)}return(0,$.Z)(n,[{key:"apply",value:function(o){o.hooks.beforeRender.tap("LightingPlugin",function(){var s=o.getLayerConfig(),l=s.enableLighting;l&&o.models.forEach(function(d){return d.addUniforms(zp({},dg()))})})}}]),n}())||xv),Ev,wv,bd={NONE:0,ENCODE:1,HIGHLIGHT:2},mg=(Ev=(0,V.b2)(),Ev(wv=function(){function n(){(0,W.Z)(this,n)}return(0,$.Z)(n,[{key:"apply",value:function(o,s){var l=s.rendererService,d=s.styleAttributeService;o.hooks.init.tap("PixelPickingPlugin",function(){var y=o.getLayerConfig(),C=y.enablePicking;d.registerStyleAttribute({name:"pickingColor",type:b.GC.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:b.gl.FLOAT},size:3,update:function(L,J){var Y=L.id;return C?(0,$e.Z6)(Y):[0,0,0]}}})}),o.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var y=o.getLayerConfig(),C=y.enablePicking;C&&o.isVisible()&&o.models.forEach(function(P){return P.addUniforms({u_PickingStage:bd.ENCODE})})}),o.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var y=o.getLayerConfig(),C=y.enablePicking;C&&o.isVisible()&&o.models.forEach(function(P){return P.addUniforms({u_PickingStage:bd.HIGHLIGHT})})}),o.hooks.beforeHighlight.tap("PixelPickingPlugin",function(y){var C=o.getLayerConfig(),P=C.highlightColor,L=typeof P=="string"?(0,$e.CI)(P):P||[1,0,0,1];o.updateLayerConfig({pickedFeatureID:(0,$e.W0)(new Uint8Array(y))}),o.models.forEach(function(J){return J.addUniforms({u_PickingStage:bd.HIGHLIGHT,u_PickingColor:y,u_HighlightColor:L.map(function(Y){return Y*255})})})}),o.hooks.beforeSelect.tap("PixelPickingPlugin",function(y){var C=o.getLayerConfig(),P=C.selectColor,L=typeof P=="string"?(0,$e.CI)(P):P||[1,0,0,1];o.updateLayerConfig({pickedFeatureID:(0,$e.W0)(new Uint8Array(y))}),o.models.forEach(function(J){return J.addUniforms({u_PickingStage:bd.HIGHLIGHT,u_PickingColor:y,u_HighlightColor:L.map(function(Y){return Y*255})})})})}}]),n}())||wv),Cv,Tv,Av,Zd,Pv,gg=(Cv=(0,V.b2)(),Tv=(0,V.f3)(b.vK.ILogService),Cv(Av=(Zd=function(){function n(){(0,W.Z)(this,n),(0,Wn.Z)(this,"logger",Pv,this)}return(0,$.Z)(n,[{key:"apply",value:function(o,s){var l=this,d=s.styleAttributeService;o.hooks.init.tap("RegisterStyleAttributePlugin",function(){l.registerBuiltinAttributes(d)})}},{key:"registerBuiltinAttributes",value:function(o){o.registerStyleAttribute({name:"position",type:b.GC.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:b.gl.FLOAT},size:3,update:function(l,d,y){return y.length===2?[y[0],y[1],0]:[y[0],y[1],y[2]]}}}),o.registerStyleAttribute({name:"filter",type:b.GC.Attribute,descriptor:{name:"filter",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(l,d){var y=l.filter;return y?[1]:[0]}}}),o.registerStyleAttribute({name:"color",type:b.GC.Attribute,descriptor:{name:"a_Color",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:4,update:function(l,d){var y=l.color;return!y||!y.length?[1,1,1,1]:y}}}),o.registerStyleAttribute({name:"vertexId",type:b.GC.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:b.gl.DYNAMIC_DRAW,data:[],type:b.gl.FLOAT},size:1,update:function(l,d,y,C){return[d]}}})}}]),n}(),Pv=(0,ai.Z)(Zd.prototype,"logger",[Tv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zd))||Av),Mv,Iv,Ov,Lv,Rv,Dv,op,kv,Fv,Bv,Nv,yg=(Mv=(0,V.b2)(),Iv=(0,V.f3)(b.vK.ICameraService),Ov=(0,V.f3)(b.vK.ICoordinateSystemService),Lv=(0,V.f3)(b.vK.IRendererService),Rv=(0,V.f3)(b.vK.IMapService),Mv(Dv=(op=function(){function n(){(0,W.Z)(this,n),(0,Wn.Z)(this,"cameraService",kv,this),(0,Wn.Z)(this,"coordinateSystemService",Fv,this),(0,Wn.Z)(this,"rendererService",Bv,this),(0,Wn.Z)(this,"mapService",Nv,this)}return(0,$.Z)(n,[{key:"apply",value:function(o){var s=this,l=this.mapService.version,d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],y=[0,0];o.hooks.beforeRender.tap("ShaderUniformPlugin",function(){s.coordinateSystemService.refresh(),l==="GAODE2.x"&&(d=s.mapService.map.customCoords.getMVPMatrix(),y=s.mapService.getCustomCoordCenter());var C=s.rendererService.getViewportSize(),P=C.width,L=C.height;o.models.forEach(function(J){var Y;J.addUniforms((Y={},(0,I.Z)(Y,b.CameraUniform.ProjectionMatrix,s.cameraService.getProjectionMatrix()),(0,I.Z)(Y,b.CameraUniform.ViewMatrix,s.cameraService.getViewMatrix()),(0,I.Z)(Y,b.CameraUniform.ViewProjectionMatrix,s.cameraService.getViewProjectionMatrix()),(0,I.Z)(Y,b.CameraUniform.Zoom,s.cameraService.getZoom()),(0,I.Z)(Y,b.CameraUniform.ZoomScale,s.cameraService.getZoomScale()),(0,I.Z)(Y,b.CameraUniform.FocalDistance,s.cameraService.getFocalDistance()),(0,I.Z)(Y,b.CameraUniform.CameraPosition,s.cameraService.getCameraPosition()),(0,I.Z)(Y,b.CoordinateUniform.CoordinateSystem,s.coordinateSystemService.getCoordinateSystem()),(0,I.Z)(Y,b.CoordinateUniform.ViewportCenter,s.coordinateSystemService.getViewportCenter()),(0,I.Z)(Y,b.CoordinateUniform.ViewportCenterProjection,s.coordinateSystemService.getViewportCenterProjection()),(0,I.Z)(Y,b.CoordinateUniform.PixelsPerDegree,s.coordinateSystemService.getPixelsPerDegree()),(0,I.Z)(Y,b.CoordinateUniform.PixelsPerDegree2,s.coordinateSystemService.getPixelsPerDegree2()),(0,I.Z)(Y,b.CoordinateUniform.PixelsPerMeter,s.coordinateSystemService.getPixelsPerMeter()),(0,I.Z)(Y,b.CoordinateUniform.Mvp,d),(0,I.Z)(Y,"u_SceneCenterMKT",y),(0,I.Z)(Y,"u_ViewportSize",[P,L]),(0,I.Z)(Y,"u_DevicePixelRatio",window.devicePixelRatio),(0,I.Z)(Y,"u_ModelMatrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),(0,I.Z)(Y,"u_PickingBuffer",o.getLayerConfig().pickingBuffer||0),Y))})})}}]),n}(),kv=(0,ai.Z)(op.prototype,"cameraService",[Iv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fv=(0,ai.Z)(op.prototype,"coordinateSystemService",[Ov],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bv=(0,ai.Z)(op.prototype,"rendererService",[Lv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nv=(0,ai.Z)(op.prototype,"mapService",[Rv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),op))||Dv),zv,Zv,_g=(zv=(0,V.b2)(),zv(Zv=function(){function n(){(0,W.Z)(this,n)}return(0,$.Z)(n,[{key:"apply",value:function(o){o.hooks.beforeRender.tap("UpdateModelPlugin",function(){o.layerModel&&o.layerModel.needUpdate()})}}]),n}())||Zv),Uv,jv,Vv,Ud,Gv,xg=(Uv=(0,V.b2)(),jv=(0,V.f3)(b.vK.ILogService),Uv(Vv=(Ud=function(){function n(){(0,W.Z)(this,n),(0,Wn.Z)(this,"logger",Gv,this)}return(0,$.Z)(n,[{key:"apply",value:function(o,s){var l=this,d=s.styleAttributeService;o.hooks.init.tap("UpdateStyleAttributePlugin",function(){l.initStyleAttribute(o,{styleAttributeService:d})}),o.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){o.layerModelNeedUpdate||l.updateStyleAtrribute(o,{styleAttributeService:d})})}},{key:"updateStyleAtrribute",value:function(o,s){var l=this,d=s.styleAttributeService,y=d.getLayerStyleAttributes()||[],C=d.getLayerStyleAttribute("filter"),P=d.getLayerStyleAttribute("shape");if(C&&C.needRegenerateVertices||P&&P.needRegenerateVertices){o.layerModelNeedUpdate=!0,y.forEach(function(L){return L.needRegenerateVertices=!1});return}y.filter(function(L){return L.needRegenerateVertices}).forEach(function(L){d.updateAttributeByFeatureRange(L.name,o.getEncodedData(),L.featureRange.startIndex,L.featureRange.endIndex),L.needRegenerateVertices=!1,l.logger.debug("regenerate vertex attributes: ".concat(L.name," finished"))})}},{key:"initStyleAttribute",value:function(o,s){var l=this,d=s.styleAttributeService,y=d.getLayerStyleAttributes()||[];y.filter(function(C){return C.needRegenerateVertices}).forEach(function(C){d.updateAttributeByFeatureRange(C.name,o.getEncodedData(),C.featureRange.startIndex,C.featureRange.endIndex),C.needRegenerateVertices=!1,l.logger.debug("init vertex attributes: ".concat(C.name," finished"))})}}]),n}(),Gv=(0,ai.Z)(Ud.prototype,"logger",[jv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ud))||Vv);b.nC.bind(b.vK.ILayerPlugin).to(un).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(gg).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(og).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(Ec).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(cg).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(xg).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(_g).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(Yo).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(yg).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(ug).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(vg).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(mg).inRequestScope(),b.nC.bind(b.vK.ILayerPlugin).to(lg).inRequestScope();var A0="2.5.5";function Hv(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function P0(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Hv(Object(o),!0).forEach(function(s){bg(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Hv(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function bg(n,c,o){return c in n?Object.defineProperty(n,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[c]=o,n}function M0(n,c){return Cg(n)||wg(n,c)||Eg(n,c)||Sg()}function Sg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Eg(n,c){if(!!n){if(typeof n=="string")return Wv(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Wv(n,c)}}function Wv(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}function wg(n,c){var o=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,y,C;try{for(o=o.call(n);!(l=(y=o.next()).done)&&(s.push(y.value),!(c&&s.length===c));l=!0);}catch(P){d=!0,C=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw C}}return s}}function Cg(n){if(Array.isArray(n))return n}var I0=null,O0=null,Xv,Yv,Sd,Kv,$v;function Jv(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function Qv(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Jv(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Jv(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}var Tg=(Xv=(0,b.yT)(b.vK.ILogService),Yv=(0,b.yT)(b.vK.IGlobalConfigService),Sd=function(){function n(c){(0,W.Z)(this,n),(0,Wn.Z)(this,"logger",Kv,this),(0,Wn.Z)(this,"configService",$v,this),(0,I.Z)(this,"config",void 0),this.config=c}return(0,$.Z)(n,[{key:"setContainer",value:function(o,s){o.bind(b.vK.MapConfig).toConstantValue(Qv(Qv({},this.config),{},{id:s})),o.bind(b.vK.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),n}(),Kv=(0,ai.Z)(Sd.prototype,"logger",[Xv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$v=(0,ai.Z)(Sd.prototype,"configService",[Yv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sd),Ag=_(6158),Pg=_.n(Ag),jd;(function(n){n["GAODE1.x"]="GAODE1.x",n["GAODE2.x"]="GAODE2.x",n.MAPBOX="MAPBOX",n.L7MAP="L7MAP"})(jd||(jd={}));function Zp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Ed(n,c){var o=i.fF([],c,n);return i.bA(o,o,1/o[3]),o}function L0(n,c){var o=n%c;return o<0?c+o:o}function R0(n,c,o){return o*c+(1-o)*n}function Th(n,c){if(!n)throw new Error(c||"viewport-mercator-project: assertion failed.")}var xf=Math.PI,qv=xf/4,Gf=xf/180,em=180/xf,Vd=512,Gd=4003e4,Mg=1.5;function tm(n){return Math.pow(2,n)}function Ig(n){return Math.log2(n)}function wd(n,c){var o=(0,X.Z)(n,2),s=o[0],l=o[1];Th(Number.isFinite(s)&&Number.isFinite(c)),Th(Number.isFinite(l)&&l>=-90&&l<=90,"invalid latitude"),c*=Vd;var d=s*Gf,y=l*Gf,C=c*(d+xf)/(2*xf),P=c*(xf-Math.log(Math.tan(qv+y*.5)))/(2*xf);return[C,P]}function Hd(n,c){var o=(0,X.Z)(n,2),s=o[0],l=o[1];c*=Vd;var d=s/c*(2*xf)-xf,y=2*(Math.atan(Math.exp(xf-l/c*(2*xf)))-qv);return[d*em,y*em]}function D0(n){var c=n.latitude;assert(Number.isFinite(c));var o=Math.cos(c*Gf);return Ig(Gd*o)-9}function rm(n){var c=n.latitude,o=n.longitude,s=n.zoom,l=n.scale,d=n.highPrecision,y=d===void 0?!1:d;l=l!==void 0?l:tm(s),Th(Number.isFinite(c)&&Number.isFinite(o)&&Number.isFinite(l));var C={},P=Vd*l,L=Math.cos(c*Gf),J=P/360,Y=J/L,le=P/Gd/L;if(C.pixelsPerMeter=[le,-le,le],C.metersPerPixel=[1/le,-1/le,1/le],C.pixelsPerDegree=[J,-Y,le],C.degreesPerPixel=[1/J,-1/Y,1/le],y){var De=Gf*Math.tan(c*Gf)/L,ut=J*De/2,Rt=P/Gd*De,mr=Rt/Y*le;C.pixelsPerDegree2=[0,-ut,Rt],C.pixelsPerMeter2=[mr,0,mr]}return C}function k0(n,c){var o=_slicedToArray(n,3),s=o[0],l=o[1],d=o[2],y=_slicedToArray(c,3),C=y[0],P=y[1],L=y[2],J=1,Y=rm({longitude:s,latitude:l,scale:J,highPrecision:!0}),le=Y.pixelsPerMeter,De=Y.pixelsPerMeter2,ut=wd(n,J);ut[0]+=C*(le[0]+De[0]*P),ut[1]+=P*(le[1]+De[1]*P);var Rt=Hd(ut,J),mr=(d||0)+(L||0);return Number.isFinite(d)||Number.isFinite(L)?[Rt[0],Rt[1],mr]:Rt}function Og(n){var c=n.height,o=n.pitch,s=n.bearing,l=n.altitude,d=n.center,y=d===void 0?null:d,C=n.flipY,P=C===void 0?!1:C,L=Zp();return Fa.translate(L,L,[0,0,-l]),Fa.scale(L,L,[1,1,1/c]),Fa.rotateX(L,L,-o*Gf),Fa.rotateZ(L,L,s*Gf),P&&Fa.scale(L,L,[1,-1,1]),y&&Fa.translate(L,L,Ui.negate([],y)),L}function Lg(n){var c=n.width,o=n.height,s=n.altitude,l=s===void 0?Mg:s,d=n.pitch,y=d===void 0?0:d,C=n.nearZMultiplier,P=C===void 0?1:C,L=n.farZMultiplier,J=L===void 0?1:L,Y=y*Gf,le=Math.atan(.5/l),De=Math.sin(le)*l/Math.sin(Math.PI/2-Y-le),ut=Math.cos(Math.PI/2-Y)*De+l;return{fov:2*Math.atan(o/2/l),aspect:c/o,focalDistance:l,near:P,far:ut*J}}function Rg(n){var c=n.width,o=n.height,s=n.pitch,l=n.altitude,d=n.nearZMultiplier,y=n.farZMultiplier,C=Lg({width:c,height:o,altitude:l,pitch:s,nearZMultiplier:d,farZMultiplier:y}),P=C.fov,L=C.aspect,J=C.near,Y=C.far,le=Fa.perspective([],P,L,J,Y);return le}function Dg(n,c){var o=(0,X.Z)(n,3),s=o[0],l=o[1],d=o[2],y=d===void 0?0:d;return Th(Number.isFinite(s)&&Number.isFinite(l)&&Number.isFinite(y)),Ed(c,[s,l,y,1])}function nm(n,c){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=(0,X.Z)(n,3),l=s[0],d=s[1],y=s[2];if(Th(Number.isFinite(l)&&Number.isFinite(d),"invalid pixel coordinate"),Number.isFinite(y)){var C=Ed(c,[l,d,y,1]);return C}var P=Ed(c,[l,d,0,1]),L=Ed(c,[l,d,1,1]),J=P[2],Y=L[2],le=J===Y?0:((o||0)-J)/(Y-J);return qn.lerp([],P,L,le)}var im=Zp(),kg=function(){function n(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=c.width,s=c.height,l=c.viewMatrix,d=l===void 0?im:l,y=c.projectionMatrix,C=y===void 0?im:y;(0,W.Z)(this,n),this.width=o||1,this.height=s||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=d,this.projectionMatrix=C;var P=Zp();Fa.multiply(P,P,this.projectionMatrix),Fa.multiply(P,P,this.viewMatrix),this.viewProjectionMatrix=P;var L=Zp();Fa.scale(L,L,[this.width/2,-this.height/2,1]),Fa.translate(L,L,[1,-1,0]),Fa.multiply(L,L,this.viewProjectionMatrix);var J=Fa.invert(Zp(),L);if(!J)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=L,this.pixelUnprojectionMatrix=J,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,$.Z)(n,[{key:"equals",value:function(o){return o instanceof n?o.width===this.width&&o.height===this.height&&Fa.equals(o.projectionMatrix,this.projectionMatrix)&&Fa.equals(o.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,d=l===void 0?!0:l,y=this.projectPosition(o),C=Dg(y,this.pixelProjectionMatrix),P=(0,X.Z)(C,2),L=P[0],J=P[1],Y=d?J:this.height-J;return o.length===2?[L,Y]:[L,Y,C[2]]}},{key:"unproject",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,d=l===void 0?!0:l,y=s.targetZ,C=(0,X.Z)(o,3),P=C[0],L=C[1],J=C[2],Y=d?L:this.height-L,le=y&&y*this.pixelsPerMeter,De=nm([P,Y,J],this.pixelUnprojectionMatrix,le),ut=this.unprojectPosition(De),Rt=(0,X.Z)(ut,3),mr=Rt[0],br=Rt[1],Zr=Rt[2];return Number.isFinite(J)?[mr,br,Zr]:Number.isFinite(y)?[mr,br,y]:[mr,br]}},{key:"projectPosition",value:function(o){var s=this.projectFlat(o),l=(0,X.Z)(s,2),d=l[0],y=l[1],C=(o[2]||0)*this.pixelsPerMeter;return[d,y,C]}},{key:"unprojectPosition",value:function(o){var s=this.unprojectFlat(o),l=(0,X.Z)(s,2),d=l[0],y=l[1],C=(o[2]||0)/this.pixelsPerMeter;return[d,y,C]}},{key:"projectFlat",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return o}},{key:"unprojectFlat",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return o}}]),n}();function Fg(n){var c=n.width,o=n.height,s=n.bounds,l=n.minExtent,d=l===void 0?0:l,y=n.maxZoom,C=y===void 0?24:y,P=n.padding,L=P===void 0?0:P,J=n.offset,Y=J===void 0?[0,0]:J,le=(0,X.Z)(s,2),De=(0,X.Z)(le[0],2),ut=De[0],Rt=De[1],mr=(0,X.Z)(le[1],2),br=mr[0],Zr=mr[1];if(Number.isFinite(L)){var fn=L;L={top:fn,bottom:fn,left:fn,right:fn}}else Th(Number.isFinite(L.top)&&Number.isFinite(L.bottom)&&Number.isFinite(L.left)&&Number.isFinite(L.right));var xn=new am({width:c,height:o,longitude:0,latitude:0,zoom:0}),Ln=xn.project([ut,Zr]),ni=xn.project([br,Rt]),Nn=[Math.max(Math.abs(ni[0]-Ln[0]),d),Math.max(Math.abs(ni[1]-Ln[1]),d)],xi=[c-L.left-L.right-Math.abs(Y[0])*2,o-L.top-L.bottom-Math.abs(Y[1])*2];Th(xi[0]>0&&xi[1]>0);var Ji=xi[0]/Nn[0],ga=xi[1]/Nn[1],hi=(L.right-L.left)/2/Ji,wa=(L.bottom-L.top)/2/ga,co=[(ni[0]+Ln[0])/2+hi,(ni[1]+Ln[1])/2+wa],ju=xn.unproject(co),sp=xn.zoom+Math.log2(Math.abs(Math.min(Ji,ga)));return{longitude:ju[0],latitude:ju[1],zoom:Math.min(sp,C)}}var am=function(n){(0,Ce.Z)(c,n);function c(){var o,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=s.width,d=s.height,y=s.latitude,C=y===void 0?0:y,P=s.longitude,L=P===void 0?0:P,J=s.zoom,Y=J===void 0?0:J,le=s.pitch,De=le===void 0?0:le,ut=s.bearing,Rt=ut===void 0?0:ut,mr=s.altitude,br=mr===void 0?1.5:mr,Zr=s.nearZMultiplier,fn=s.farZMultiplier;(0,W.Z)(this,c),l=l||1,d=d||1;var xn=tm(Y);br=Math.max(.75,br);var Ln=wd([L,C],xn);Ln[2]=0;var ni=Rg({width:l,height:d,pitch:De,bearing:Rt,altitude:br,nearZMultiplier:Zr||1/d,farZMultiplier:fn||1.01}),Nn=Og({height:d,center:Ln,pitch:De,bearing:Rt,altitude:br,flipY:!0});return o=(0,Be.Z)(this,(0,We.Z)(c).call(this,{width:l,height:d,viewMatrix:Nn,projectionMatrix:ni})),o.latitude=C,o.longitude=L,o.zoom=Y,o.pitch=De,o.bearing=Rt,o.altitude=br,o.scale=xn,o.center=Ln,o.pixelsPerMeter=rm((0,k.Z)((0,k.Z)(o))).pixelsPerMeter[2],Object.freeze((0,k.Z)((0,k.Z)(o))),o}return(0,$.Z)(c,[{key:"projectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return wd(s,l)}},{key:"unprojectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Hd(s,l)}},{key:"getMapCenterByLngLatPosition",value:function(s){var l=s.lngLat,d=s.pos,y=nm(d,this.pixelUnprojectionMatrix),C=wd(l,this.scale),P=qn.add([],C,qn.negate([],y)),L=qn.add([],this.center,P);return Hd(L,this.scale)}},{key:"getLocationAtPoint",value:function(s){var l=s.lngLat,d=s.pos;return this.getMapCenterByLngLatPosition({lngLat:l,pos:d})}},{key:"fitBounds",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=this.width,y=this.height,C=Fg(Object.assign({width:d,height:y,bounds:s},l)),P=C.longitude,L=C.latitude,J=C.zoom;return new c({width:d,height:y,longitude:P,latitude:L,zoom:J})}}]),c}(kg),Bg=function(){function n(){(0,W.Z)(this,n),(0,I.Z)(this,"viewport",void 0)}return(0,$.Z)(n,[{key:"syncWithMapCamera",value:function(o){var s=o.center,l=o.zoom,d=o.pitch,y=o.bearing,C=o.viewportHeight,P=o.viewportWidth;this.viewport=new am({width:P,height:C,longitude:s&&s[0],latitude:s&&s[1],zoom:l,pitch:d,bearing:y})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(o,s){return this.viewport.projectFlat(o,s)}}]),n}(),om={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},sm,um,lm,cm,fm,hm,pm,Ah,dm,vm,mm,gm,ym;function _m(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function Ng(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?_m(Object(o),!0).forEach(function(s){(0,I.Z)(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):_m(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}_(68982)(`/* @antv/l7-maps */
.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-flex;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-flex-direction:column;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-flex-direction:column-reverse;-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-flex-direction:row;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-flex-direction:row-reverse;-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Pg();var xm={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},zg=0,Zg=12,bm="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",Ug=(sm=(0,V.b2)(),um=(0,V.f3)(b.vK.MapConfig),lm=(0,V.f3)(b.vK.IGlobalConfigService),cm=(0,V.f3)(b.vK.ILogService),fm=(0,V.f3)(b.vK.ICoordinateSystemService),hm=(0,V.f3)(b.vK.IEventEmitter),sm(pm=(Ah=function(){function n(){var c=this;(0,W.Z)(this,n),(0,I.Z)(this,"version",jd.MAPBOX),(0,I.Z)(this,"map",void 0),(0,Wn.Z)(this,"config",dm,this),(0,Wn.Z)(this,"configService",vm,this),(0,Wn.Z)(this,"logger",mm,this),(0,Wn.Z)(this,"coordinateSystemService",gm,this),(0,Wn.Z)(this,"eventEmitter",ym,this),(0,I.Z)(this,"viewport",void 0),(0,I.Z)(this,"markerContainer",void 0),(0,I.Z)(this,"cameraChangedCallback",void 0),(0,I.Z)(this,"$mapContainer",void 0),(0,I.Z)(this,"handleCameraChanged",function(){var o=c.map.getCenter().wrap(),s=o.lat,l=o.lng;c.viewport.syncWithMapCamera({bearing:c.map.getBearing(),center:[l,s],viewportHeight:c.map.transform.height,pitch:c.map.getPitch(),viewportWidth:c.map.transform.width,zoom:c.map.getZoom(),cameraHeight:0});var d=c.config.offsetZoom,y=d===void 0?Zg:d;c.viewport.getZoom()>y?c.coordinateSystemService.setCoordinateSystem(b.CoordinateSystem.LNGLAT_OFFSET):c.coordinateSystemService.setCoordinateSystem(b.CoordinateSystem.LNGLAT),c.cameraChangedCallback(c.viewport)})}return(0,$.Z)(n,[{key:"addMarkerContainer",value:function(){var o=this.map.getCanvasContainer();this.markerContainer=$e.SO.create("div","l7-marker-container",o),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(o,s){b.MapServiceEvent.indexOf(o)!==-1?this.eventEmitter.on(o,s):this.map.on(xm[o]||o,s)}},{key:"off",value:function(o,s){this.map.off(xm[o]||o,s)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var o=this.map.transform;return[o.width,o.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(o){return this.map.setZoom(o)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(o){this.map.setCenter(o)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(o){this.map.setBearing(o)}},{key:"zoomIn",value:function(o,s){this.map.zoomIn(o,s)}},{key:"zoomOut",value:function(o,s){this.map.zoomOut(o,s)}},{key:"setPitch",value:function(o){return this.map.setPitch(o)}},{key:"panTo",value:function(o){this.map.panTo(o)}},{key:"panBy",value:function(o){this.panTo(o)}},{key:"fitBounds",value:function(o,s){this.map.fitBounds(o,s)}},{key:"setMaxZoom",value:function(o){this.map.setMaxZoom(o)}},{key:"setMinZoom",value:function(o){this.map.setMinZoom(o)}},{key:"setMapStatus",value:function(o){o.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),o.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),o.dragEnable===!1&&this.map.dragPan.disable(),o.dragEnable===!0&&this.map.dragPan.enable(),o.rotateEnable===!1&&this.map.dragRotate.disable(),o.rotateEnable===!0&&this.map.dragRotate.enable(),o.keyboardEnable===!1&&this.map.keyboard.disable(),o.keyboardEnable===!0&&this.map.keyboard.enable(),o.zoomEnable===!1&&this.map.scrollZoom.disable(),o.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(o,s){this.map.flyTo({zoom:o,center:s})}},{key:"setMapStyle",value:function(o){this.map.setStyle(this.getMapStyle(o))}},{key:"pixelToLngLat",value:function(o){return this.map.unproject(o)}},{key:"lngLatToPixel",value:function(o){return this.map.project(o)}},{key:"containerToLngLat",value:function(o){return this.map.unproject(o)}},{key:"lngLatToContainer",value:function(o){return this.map.project(o)}},{key:"lngLatToMercator",value:function(o,s){var l=window.mapboxgl.MercatorCoordinate.fromLngLat(o,s),d=l.x,y=d===void 0?0:d,C=l.y,P=C===void 0?0:C,L=l.z,J=L===void 0?0:L;return{x:y,y:P,z:J}}},{key:"getModelMatrix",value:function(o,s,l){var d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],y=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},C=window.mapboxgl.MercatorCoordinate.fromLngLat(o,s),P=C.meterInMercatorCoordinateUnits(),L=Fa.create();return Fa.translate(L,L,Ui.fromValues(C.x-y.x,C.y-y.y,C.z||0-y.z)),Fa.scale(L,L,Ui.fromValues(P*d[0],-P*d[1],P*d[2])),Fa.rotateX(L,L,l[0]),Fa.rotateY(L,L,l[1]),Fa.rotateZ(L,L,l[2]),L}},{key:"init",value:function(){var c=(0,et.Z)(Ct().mark(function s(){var l,d,y,C,P,L,J,Y,le,De,ut,Rt,mr;return Ct().wrap(function(Zr){for(;;)switch(Zr.prev=Zr.next){case 0:l=this.config,d=l.id,y=d===void 0?"map":d,C=l.attributionControl,P=C===void 0?!1:C,L=l.style,J=L===void 0?"light":L,Y=l.token,le=Y===void 0?bm:Y,De=l.rotation,ut=De===void 0?0:De,Rt=l.mapInstance,mr=(0,za.Z)(l,["id","attributionControl","style","token","rotation","mapInstance"]),this.viewport=new Bg,!Rt&&!window.mapboxgl&&this.logger.error(this.configService.getSceneWarninfo("SDK")),le===bm&&J!=="blank"&&!window.mapboxgl.accessToken&&!Rt&&this.logger.warn(this.configService.getSceneWarninfo("MapToken")),!Rt&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=le),Rt?(this.map=Rt,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(y),this.map=new window.mapboxgl.Map(Ng({container:this.$mapContainer,style:this.getMapStyle(J),attributionControl:P,bearing:ut},mr))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Zr.stop()}},s,this)}));function o(){return c.apply(this,arguments)}return o}()},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(o){for(var s,l=arguments.length,d=new Array(l>1?l-1:0),y=1;y<l;y++)d[y-1]=arguments[y];(s=this.eventEmitter).emit.apply(s,[o].concat(d))}},{key:"once",value:function(o){for(var s,l=arguments.length,d=new Array(l>1?l-1:0),y=1;y<l;y++)d[y-1]=arguments[y];(s=this.eventEmitter).once.apply(s,[o].concat(d))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(o){var s=this.map.getCanvas(),l=o==="jpg"?s==null?void 0:s.toDataURL("image/jpeg"):s==null?void 0:s.toDataURL("image/png");return l}},{key:"onCameraChanged",value:function(o){this.cameraChangedCallback=o}},{key:"creatAmapContainer",value:function(o){var s=o;typeof o=="string"&&(s=document.getElementById(o));var l=document.createElement("div");return l.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,l.id="l7_mapbox_div"+zg++,s.appendChild(l),l}},{key:"getMapStyle",value:function(o){return typeof o!="string"?o:om[o]?om[o]:o}}]),n}(),dm=(0,ai.Z)(Ah.prototype,"config",[um],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vm=(0,ai.Z)(Ah.prototype,"configService",[lm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mm=(0,ai.Z)(Ah.prototype,"logger",[cm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gm=(0,ai.Z)(Ah.prototype,"coordinateSystemService",[fm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ym=(0,ai.Z)(Ah.prototype,"eventEmitter",[hm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ah))||pm);function jg(n){var c=Vg();return function(){var s=(0,We.Z)(n),l;if(c){var d=(0,We.Z)(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return(0,Be.Z)(this,l)}}function Vg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}_(68982)(`/* @antv/l7-maps */
.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var Gg=function(n){(0,Ce.Z)(o,n);var c=jg(o);function o(){return(0,W.Z)(this,o),c.apply(this,arguments)}return(0,$.Z)(o,[{key:"getServiceConstructor",value:function(){return Ug}}]),o}(Tg);function Sm(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function Em(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Sm(Object(o),!0).forEach(function(s){Hg(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Sm(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function Hg(n,c,o){return c in n?Object.defineProperty(n,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[c]=o,n}function Wg(n,c){return $g(n)||Kg(n,c)||Yg(n,c)||Xg()}function Xg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Yg(n,c){if(!!n){if(typeof n=="string")return wm(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return wm(n,c)}}function wm(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}function Kg(n,c){var o=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,y,C;try{for(o=o.call(n);!(l=(y=o.next()).done)&&(s.push(y.value),!(c&&s.length===c));l=!0);}catch(P){d=!0,C=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw C}}return s}}function $g(n){if(Array.isArray(n))return n}var Jg=Q.memo(function(n){var c=n.style,o=n.className,s=n.map,l=n.option,d=n.onSceneLoaded,y=(0,Q.createRef)(),C=(0,Q.useState)(),P=Wg(C,2),L=P[0],J=P[1];return(0,Q.useEffect)(function(){var Y=new ki(Em(Em({id:y.current},l),{},{map:new Gg(s)}));return Y.on("loaded",function(){J(Y),d&&d(Y)}),function(){Y.destroy()}},[]),(0,Q.useEffect)(function(){L&&s.style&&L.setMapStyle(s.style)},[JSON.stringify(s.style)]),(0,Q.useEffect)(function(){L&&s.zoom&&L.setZoom(s.zoom)},[s.zoom]),(0,Q.useEffect)(function(){L&&s.center&&L.setCenter(s.center)},[JSON.stringify(s.center)]),(0,Q.useEffect)(function(){L&&s.pitch!==void 0&&L.setPitch(s.pitch||0)},[s.pitch]),(0,Q.useEffect)(function(){L&&s.rotation&&L.setRotation(s.rotation)},[s.rotation]),Q.createElement(E.Provider,{value:L},(0,Q.createElement)("div",{ref:y,style:c,className:o},L&&n.children))}),Qg=Jg;function Cm(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function F0(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Cm(Object(o),!0).forEach(function(s){qg(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Cm(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function qg(n,c,o){return c in n?Object.defineProperty(n,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[c]=o,n}function B0(n,c){return ny(n)||ry(n,c)||ty(n,c)||ey()}function ey(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ty(n,c){if(!!n){if(typeof n=="string")return Tm(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Tm(n,c)}}function Tm(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}function ry(n,c){var o=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,y,C;try{for(o=o.call(n);!(l=(y=o.next()).done)&&(s.push(y.value),!(c&&s.length===c));l=!0);}catch(P){d=!0,C=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw C}}return s}}function ny(n){if(Array.isArray(n))return n}var N0=null,z0=null;function Am(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function Z0(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Am(Object(o),!0).forEach(function(s){iy(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Am(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function iy(n,c,o){return c in n?Object.defineProperty(n,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[c]=o,n}function U0(n,c){return uy(n)||sy(n,c)||oy(n,c)||ay()}function ay(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oy(n,c){if(!!n){if(typeof n=="string")return Pm(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Pm(n,c)}}function Pm(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}function sy(n,c){var o=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,y,C;try{for(o=o.call(n);!(l=(y=o.next()).done)&&(s.push(y.value),!(c&&s.length===c));l=!0);}catch(P){d=!0,C=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw C}}return s}}function uy(n){if(Array.isArray(n))return n}var j0=null,V0=null;function G0(n,c){return hy(n)||fy(n,c)||cy(n,c)||ly()}function ly(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cy(n,c){if(!!n){if(typeof n=="string")return Mm(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Mm(n,c)}}function Mm(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}function fy(n,c){var o=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,y,C;try{for(o=o.call(n);!(l=(y=o.next()).done)&&(s.push(y.value),!(c&&s.length===c));l=!0);}catch(P){d=!0,C=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw C}}return s}}function hy(n){if(Array.isArray(n))return n}var H0=null,W0=null;function Im(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function X0(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Im(Object(o),!0).forEach(function(s){py(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Im(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function py(n,c,o){return c in n?Object.defineProperty(n,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[c]=o,n}function Y0(n,c){if(n==null)return{};var o=dy(n,c),s,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(n);for(l=0;l<d.length;l++)s=d[l],!(c.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,s)||(o[s]=n[s]))}return o}function dy(n,c){if(n==null)return{};var o={},s=Object.keys(n),l,d;for(d=0;d<s.length;d++)l=s[d],!(c.indexOf(l)>=0)&&(o[l]=n[l]);return o}var K0=null,Om=_(73935);function vy(n,c){return _y(n)||yy(n,c)||gy(n,c)||my()}function my(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gy(n,c){if(!!n){if(typeof n=="string")return Lm(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Lm(n,c)}}function Lm(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}function yy(n,c){var o=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,y,C;try{for(o=o.call(n);!(l=(y=o.next()).done)&&(s.push(y.value),!(c&&s.length===c));l=!0);}catch(P){d=!0,C=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw C}}return s}}function _y(n){if(Array.isArray(n))return n}var xy=Q.useEffect,by=Q.useState;function $0(n){var c=n.className,o=n.style,s=n.children,l=n.position,d=useSceneValue(),y=by(function(){return document.createElement("div")}),C=vy(y,1),P=C[0];return xy(function(){var L=new Control({position:l});return L.onAdd=function(){if(c&&(P.className=c),o){var J=Object.keys(o).map(function(Y){return"".concat(Y,":").concat(o[Y])}).join(";");P.style.cssText=J}return P},d.addControl(L),function(){d.removeControl(L)}},[]),createPortal(s,P)}var Rm=(0,Q.createContext)({});function J0(){return useContext(Rm)}var Sy=Q.useEffect,Ey=Q.memo(function(c){var o=c.layer,s=c.active;return Sy(function(){o.active(s.option)},[JSON.stringify(s)]),null}),wy=Q.useEffect,Cy=Q.memo(function(c){var o=c.layer,s=c.animate;return wy(function(){o.animate(s)},[JSON.stringify(s)]),null}),Ty=Q.useEffect,Ay=Q.memo(function(c){var o=c.layer,s=c.color;return Ty(function(){s.field?o.color(s.field,s.values):o.color(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),Py=Q.useEffect,My=Q.memo(function(c){var o=c.layer,s=c.filter;return Py(function(){s.field&&o.filter(s.field,s.values)},[s.field,s.values,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),Iy=Q.useEffect,Oy=Q.memo(function(c){var o=c.layer,s=c.scale;return Iy(function(){o.scale(s.values)},[s.values]),null}),Ly=Q.useEffect,Ry=Q.memo(function(c){var o=c.layer,s=c.select;return Ly(function(){o.select(s.option)},[JSON.stringify(s)]),null}),Dy=Q.useEffect,ky=Q.memo(function(c){var o=c.layer,s=c.shape;return Dy(function(){s.field?o.shape(s.field,s.values):o.shape(s.values)},[s.field,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),Fy=Q.useEffect,By=Q.memo(function(c){var o=c.layer,s=c.size;return Fy(function(){s.field?o.size(s.field,s.values):o.size(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),Ny=["data"];function zy(n,c){if(n==null)return{};var o=Zy(n,c),s,l;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(n);for(l=0;l<d.length;l++)s=d[l],!(c.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,s)||(o[s]=n[s]))}return o}function Zy(n,c){if(n==null)return{};var o={},s=Object.keys(n),l,d;for(d=0;d<s.length;d++)l=s[d],!(c.indexOf(l)>=0)&&(o[l]=n[l]);return o}var Uy=Q.useEffect,jy=Q.memo(function(c){var o=c.layer,s=c.source,l=s.data,d=zy(s,Ny);return Uy(function(){o.inited?o.setData(l,d):o.source(l,d),d.autoFit&&o.fitBounds(d&&d.fitBoundsOptions)},[l,JSON.stringify(d)]),null}),Vy=Q.useEffect,Gy=Q.memo(function(c){var o=c.layer,s=c.style;return Vy(function(){o.style(s)},Object.keys(s).map(function(l){return s[l]})),null});function Hy(n,c){return Ky(n)||Yy(n,c)||Xy(n,c)||Wy()}function Wy(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Xy(n,c){if(!!n){if(typeof n=="string")return Dm(n,c);var o=Object.prototype.toString.call(n).slice(8,-1);if(o==="Object"&&n.constructor&&(o=n.constructor.name),o==="Map"||o==="Set")return Array.from(n);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Dm(n,c)}}function Dm(n,c){(c==null||c>n.length)&&(c=n.length);for(var o=0,s=new Array(c);o<c;o++)s[o]=n[o];return s}function Yy(n,c){var o=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(o!=null){var s=[],l=!0,d=!1,y,C;try{for(o=o.call(n);!(l=(y=o.next()).done)&&(s.push(y.value),!(c&&s.length===c));l=!0);}catch(P){d=!0,C=P}finally{try{!l&&o.return!=null&&o.return()}finally{if(d)throw C}}return s}}function Ky(n){if(Array.isArray(n))return n}var Up=Q.useEffect,$y=Q.useState;function km(n,c){var o=c.source,s=c.color,l=c.shape,d=c.style,y=c.size,C=c.scale,P=c.active,L=c.select,J=c.filter,Y=c.animate,le=c.options,De=c.onLayerLoaded,ut=p(),Rt=$y(function(){var Zr;switch(n){case"polygonLayer":Zr=new ds(le);break;case"lineLayer":Zr=new hu(le);break;case"pointLayer":Zr=new Qi(le);break;case"heatmapLayer":Zr=new wn(le);break;case"rasterLayer":Zr=new Vl(le);break;case"imageLayer":Zr=new Ju(le);break;case"citybuildingLayer":Zr=new Dl(le);break;default:Zr=new ds(le)}return Zr.on("inited",function(){De&&De(Zr,ut)}),Zr}),mr=Hy(Rt,1),br=mr[0];return Up(function(){return ut.addLayer(br),function(){ut.removeLayer(br)}},[]),Up(function(){br.inited&&le&&br.updateLayerConfig(le)},[le==null?void 0:le.minZoom,le==null?void 0:le.maxZoom,le==null?void 0:le.visible]),Up(function(){br.inited&&(le==null?void 0:le.zIndex)&&br.setIndex(le.zIndex)},[le==null?void 0:le.zIndex]),Up(function(){br.inited&&(le==null?void 0:le.blend)&&br.setBlend(le.blend)},[le==null?void 0:le.blend]),Up(function(){ut.render()}),Q.createElement(Rm.Provider,{value:br},Q.createElement(jy,{layer:br,source:o}),C&&Q.createElement(Oy,{layer:br,scale:C}),s&&Q.createElement(Ay,{layer:br,color:s}),y&&Q.createElement(By,{layer:br,size:y}),l&&Q.createElement(ky,{layer:br,shape:l}),d&&Q.createElement(Gy,{layer:br,style:d}),P&&Q.createElement(Ey,{layer:br,active:P}),L&&Q.createElement(Ry,{layer:br,select:L}),J&&Q.createElement(My,{layer:br,filter:J}),Y&&Q.createElement(Cy,{layer:br,animate:Y}),c.children)}var Q0=null,q0=null,Jy=Q.memo(function(c){return km("pointLayer",c)}),Qy=Q.memo(function(c){return km("heatmapLayer",c)}),e1=null,t1=null,r1=null,n1=Q.useEffect,i1=null,a1=null;function Cd(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Cd=function(o){return typeof o}:Cd=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},Cd(n)}function Fm(n,c){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),o.push.apply(o,s)}return o}function Td(n){for(var c=1;c<arguments.length;c++){var o=arguments[c]!=null?arguments[c]:{};c%2?Fm(Object(o),!0).forEach(function(s){qy(n,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):Fm(Object(o)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(o,s))})}return n}function qy(n,c,o){return c in n?Object.defineProperty(n,c,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[c]=o,n}function e0(n,c){if(!(n instanceof c))throw new TypeError("Cannot call a class as a function")}function Bm(n,c){for(var o=0;o<c.length;o++){var s=c[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function t0(n,c,o){return c&&Bm(n.prototype,c),o&&Bm(n,o),n}function r0(n,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(c&&c.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),c&&Wd(n,c)}function Wd(n,c){return Wd=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},Wd(n,c)}function n0(n){var c=o0();return function(){var s=Ad(n),l;if(c){var d=Ad(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return i0(this,l)}}function i0(n,c){return c&&(Cd(c)==="object"||typeof c=="function")?c:a0(n)}function a0(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function o0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function Ad(n){return Ad=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Ad(n)}var o1=function(n){r0(o,n);var c=n0(o);function o(s){var l;return e0(this,o),l=c.call(this,s),l.el=void 0,l.scene=void 0,l.popup=void 0,l.el=document.createElement("div"),l}return t0(o,[{key:"componentDidMount",value:function(){var l,d=this.props,y=d.lnglat,C=d.children,P=d.option,L=d.lngLat,J=new je(Td(Td({},P),{},{stopPropagation:(l=this.props.option)===null||l===void 0?void 0:l.stopPropagation}));y&&J.setLnglat(y),L&&J.setLnglat(L),C&&J.setDOMContent(this.el),this.popup=J,this.scene.addPopup(J)}},{key:"componentDidUpdate",value:function(l){var d,y,C,P,L,J,Y=Array.isArray(l.lnglat)?l.lnglat:[l==null||(d=l.lnglat)===null||d===void 0?void 0:d.lng,l==null||(y=l.lnglat)===null||y===void 0?void 0:y.lat],le=Array.isArray(this.props.lnglat)?this.props.lnglat:[(C=this.props)===null||C===void 0||(P=C.lnglat)===null||P===void 0?void 0:P.lng,(L=this.props)===null||L===void 0||(J=L.lnglat)===null||J===void 0?void 0:J.lat],De=Y.toString()!==le.toString();if(De){var ut;this.popup.remove(),this.popup=new je(Td(Td({},this.props.option),{},{stopPropagation:(ut=this.props.option)===null||ut===void 0?void 0:ut.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var l=this;return Q.createElement(E.Consumer,{},function(d){return d&&(l.scene=d),(0,Om.createPortal)(l.props.children,l.el)})}}]),o}(Q.PureComponent);function Pd(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Pd=function(o){return typeof o}:Pd=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},Pd(n)}function s0(n,c){if(!(n instanceof c))throw new TypeError("Cannot call a class as a function")}function Nm(n,c){for(var o=0;o<c.length;o++){var s=c[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function u0(n,c,o){return c&&Nm(n.prototype,c),o&&Nm(n,o),n}function l0(n,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(c&&c.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),c&&Xd(n,c)}function Xd(n,c){return Xd=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},Xd(n,c)}function c0(n){var c=p0();return function(){var s=Md(n),l;if(c){var d=Md(this).constructor;l=Reflect.construct(s,arguments,d)}else l=s.apply(this,arguments);return f0(this,l)}}function f0(n,c){return c&&(Pd(c)==="object"||typeof c=="function")?c:h0(n)}function h0(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function p0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function Md(n){return Md=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},Md(n)}var s1=function(n){l0(o,n);var c=c0(o);function o(s){var l;return s0(this,o),l=c.call(this,s),l.el=void 0,l.scene=void 0,l.marker=void 0,l.el=document.createElement("div"),l}return u0(o,[{key:"componentDidMount",value:function(){var l=this.props,d=l.lnglat,y=l.children,C=l.option,P=l.onMarkerLoaded,L=new Qt(C);d&&L.setLnglat(d),y&&L.setElement(this.el),this.marker=L,P&&P(L),this.scene.addMarker(L)}},{key:"componentDidUpdate",value:function(l){var d,y=(l==null?void 0:l.lnglat.toString())!==((d=this.props)===null||d===void 0?void 0:d.lnglat.toString());y&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var l=this;return Q.createElement(E.Consumer,{},function(d){return d&&(l.scene=d),(0,Om.createPortal)(l.props.children,l.el)})}}]),o}(Q.PureComponent),u1=Q.useEffect,l1=null,c1=null,f1=Q.useEffect,h1=null},4771:function(){},6901:function(ar,O,_){"use strict";_.d(O,{SO:function(){return Q},z6:function(){return xt},a5:function(){return E},Z:function(){return Yt},rQ:function(){return cn},bV:function(){return or},zi:function(){return Pn},ds:function(){return Je},Ev:function(){return ht},oO:function(){return Ar},W0:function(){return lt},Z6:function(){return Lt},We:function(){return Bt},Cl:function(){return Jt},gJ:function(){return Fe},vP:function(){return je},yM:function(){return fr},yA:function(){return Tr},CI:function(){return Kr}});var Q={};_.r(Q),_.d(Q,{DPR:function(){return Ne},addClass:function(){return $e},create:function(){return Be},empty:function(){return bt},getClass:function(){return Ot},getContainer:function(){return $},getViewPortScale:function(){return tt},hasClass:function(){return Ht},printCanvas:function(){return Ft},remove:function(){return We},removeClass:function(){return Vt},setClass:function(){return At},setTransform:function(){return Pr},splitWords:function(){return k},triggerResize:function(){return er},trim:function(){return I}});var E={};_.r(E),_.d(E,{getColumn:function(){return ie},getSatByColumn:function(){return ce},max:function(){return bi},mean:function(){return ia},min:function(){return Si},mode:function(){return pi},statMap:function(){return H},sum:function(){return Ri}});function p(B){var re=131,fe=137,Se=0;B+="x";for(var te=Math.floor(9007199254740991/fe),ge=0;ge<B.length;ge++)Se>te&&(Se=Math.floor(Se/fe)),Se=Se*re+B.charCodeAt(ge);return Se}function b(B){B=B.toString();for(var re=5381,fe=B.length;fe;)re=re*33^B.charCodeAt(--fe);return re>>>0}var X=_(28481),W=window.document.documentElement.style;function $(B){var re=B;return typeof B=="string"&&(re=document.getElementById(B)),re}function I(B){return B.trim?B.trim():B.replace(/^\s+|\s+$/g,"")}function k(B){return I(B).split(/\s+/)}function Ce(B){if(!W)return B[0];for(var re in B)if(B[re]&&B[re]in W)return B[re];return B[0]}function Be(B,re,fe){var Se=document.createElement(B);return Se.className=re||"",fe&&fe.appendChild(Se),Se}function We(B){var re=B.parentNode;re&&re.removeChild(B)}function $e(B,re){if(B.classList!==void 0)for(var fe=k(re),Se=0,te=fe.length;Se<te;Se++)B.classList.add(fe[Se]);else if(!Ht(B,re)){var ge=Ot(B);At(B,(ge?ge+" ":"")+re)}}function Vt(B,re){B.classList!==void 0?B.classList.remove(re):At(B,I((" "+Ot(B)+" ").replace(" "+re+" "," ")))}function Ht(B,re){if(B.classList!==void 0)return B.classList.contains(re);var fe=Ot(B);return fe.length>0&&new RegExp("(^|\\s)"+re+"(\\s|$)").test(fe)}function At(B,re){B instanceof HTMLElement?B.className=re:B.className.baseVal=re}function Ot(B){return B instanceof SVGElement&&(B=B.correspondingElement),B.className.baseVal===void 0?B.className:B.className.baseVal}function bt(B){for(;B&&B.firstChild;)B.removeChild(B.firstChild)}var dt=Ce(["transform","WebkitTransform"]);function Pr(B,re){B.style[dt]=re}function er(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var B=window.document.createEvent("UIEvents");B.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(B)}}function Ft(B){var re=["padding: "+(B.height/2-8)+"px "+B.width/2+"px;","line-height: "+B.height+"px;","background-image: url("+B.toDataURL()+");"];console.log(`%c
`,re.join(""))}function tt(){var B,re=document.querySelector('meta[name="viewport"]');if(!re)return 1;var fe=(B=re.content)===null||B===void 0?void 0:B.split(","),Se=fe.find(function(te){var ge=te.split("="),pt=(0,X.Z)(ge,2),yr=pt[0],Lr=pt[1];return yr==="initial-scale"});return Se?Se.split("=")[1]*1:1}var Ne=tt()<1?1:window.devicePixelRatio,Qe=_(6610),Ie=_(5991),Ae=_(63349),Ue=_(10379),St=_(46070),ur=_(77608),ae=_(14665);function Te(B){return Function.toString.call(B).indexOf("[native code]")!==-1}var oe=_(51814);function me(B,re,fe){return(0,oe.Z)()?me=Reflect.construct:me=function(te,ge,pt){var yr=[null];yr.push.apply(yr,ge);var Lr=Function.bind.apply(te,yr),Nt=new Lr;return pt&&(0,ae.Z)(Nt,pt.prototype),Nt},me.apply(null,arguments)}function Me(B){var re=typeof Map=="function"?new Map:void 0;return Me=function(Se){if(Se===null||!Te(Se))return Se;if(typeof Se!="function")throw new TypeError("Super expression must either be null or a function");if(typeof re!="undefined"){if(re.has(Se))return re.get(Se);re.set(Se,te)}function te(){return me(Se,arguments,(0,ur.Z)(this).constructor)}return te.prototype=Object.create(Se.prototype,{constructor:{value:te,enumerable:!1,writable:!0,configurable:!0}}),(0,ae.Z)(te,Se)},Me(B)}var qe=_(96156);function yt(B){var re=Qt();return function(){var Se=(0,ur.Z)(B),te;if(re){var ge=(0,ur.Z)(this).constructor;te=Reflect.construct(Se,arguments,ge)}else te=Se.apply(this,arguments);return(0,St.Z)(this,te)}}function Qt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(B){return!1}}var Or=function(B){(0,Ue.Z)(fe,B);var re=yt(fe);function fe(Se,te,ge){var pt;return(0,Qe.Z)(this,fe),pt=re.call(this,Se),(0,qe.Z)((0,Ae.Z)(pt),"status",void 0),(0,qe.Z)((0,Ae.Z)(pt),"url",void 0),pt.status=te,pt.url=ge,pt.name=pt.constructor.name,pt.message=Se,pt}return(0,Ie.Z)(fe,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),fe}(Me(Error));function Dr(B){var re=new XMLHttpRequest;re.open("GET",B.url,!0);for(var fe in B.headers)B.headers.hasOwnProperty(fe)&&re.setRequestHeader(fe,B.headers[fe]);return re.withCredentials=B.credentials==="include",re}var on=function(re,fe){var Se=Dr(re);return Se.setRequestHeader("Accept","application/json"),Se.onerror=function(){fe(new Error(Se.statusText))},Se.onload=function(){if(Se.status>=200&&Se.status<300&&Se.response){var te;try{te=JSON.parse(Se.response)}catch(ge){return fe(ge)}fe(null,te)}else Se.status===401?fe(new Or("".concat(Se.statusText),Se.status,re.url)):fe(new Or(Se.statusText,Se.status,re.url))},Se.send(),Se},tr=function(re,fe){var Se=Dr(re);return Se.responseType="arraybuffer",Se.onerror=function(){fe(new Error(Se.statusText))},Se.onload=function(){var te=Se.response;if(te.byteLength===0&&Se.status===200)return fe(new Error("http status 200 returned without content."));Se.status>=200&&Se.status<300&&Se.response?fe(null,{data:te,cacheControl:Se.getResponseHeader("Cache-Control"),expires:Se.getResponseHeader("Expires")}):fe(new Or(Se.statusText,Se.status,re.url))},Se.send(),Se};function se(B){var re=window.document.createElement("a");return re.href=B,re.protocol===window.document.location.protocol&&re.host===window.document.location.host}var be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Fe=function(re,fe){return tr(re,function(Se,te){if(Se)fe(Se);else if(te){var ge=new window.Image;ge.crossOrigin="anonymous";var pt=window.URL||window.webkitURL;ge.onload=function(){fe(null,ge),pt.revokeObjectURL(ge.src)};var yr=new window.Blob([new Uint8Array(te.data)],{type:"image/png"});ge.src=te.data.byteLength?pt.createObjectURL(yr):be}})},Ee=_(40271),wt=2*Math.PI*6378137/2;function Bt(B){var re=[Infinity,Infinity,-Infinity,-Infinity];return B.forEach(function(fe){var Se=fe.coordinates;w(re,Se)}),re}function w(B,re){return Array.isArray(re[0])?re.forEach(function(fe){w(B,fe)}):(B[0]>re[0]&&(B[0]=re[0]),B[1]>re[1]&&(B[1]=re[1]),B[2]<re[0]&&(B[2]=re[0]),B[3]<re[1]&&(B[3]=re[1])),B}function N(B,re){return he(B,re)}function he(B,re){return Array.isArray(B[0])?B.map(function(fe){return he(fe,re)}):re(B)}function je(B){var re=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,fe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};B=V(B,re);var Se=B[0],te=B[1],ge=Se*wt/180,pt=Math.log(Math.tan((90+te)*Math.PI/360))/(Math.PI/180);return pt=pt*wt/180,fe.enable&&(ge=Number(ge.toFixed(fe.decimal)),pt=Number(pt.toFixed(fe.decimal))),B.length===3?[ge,pt,B[2]]:[ge,pt]}function et(B){var re=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,fe=B[0],Se=B[1],te=fe/wt*180,ge=Se/wt*180;return ge=180/Math.PI*(2*Math.atan(Math.exp(ge*Math.PI/180))-Math.PI/2),re!=null&&(te=Number(te.toFixed(re)),ge=Number(ge.toFixed(re))),B.length===3?[te,ge,B[2]]:[te,ge]}function _t(B){if(B==null)throw new Error("lng is required");return(B>180||B<-180)&&(B=B%360,B>180&&(B=-360+B),B<-180&&(B=360+B),B===0&&(B=0)),B}function Ct(B){if(B==null)throw new Error("lat is required");return(B>90||B<-90)&&(B=B%180,B>90&&(B=-180+B),B<-90&&(B=180+B),B===0&&(B=0)),B}function V(B,re){if(re===!1)return B;var fe=_t(B[0]),Se=Ct(B[1]);return Se>85&&(Se=85),Se<-85&&(Se=-85),B.length===3?[fe,Se,B[2]]:[fe,Se]}function Yt(B){var re=85.0511287798,fe=Math.max(Math.min(re,B[1]),-re),Se=256<<20,te=Math.PI/180,ge=B[0]*te,pt=fe*te;pt=Math.log(Math.tan(Math.PI/4+pt/2));var yr=.5/Math.PI,Lr=.5,Nt=-.5/Math.PI;return te=.5,ge=Se*(yr*ge+Lr),pt=Se*(Nt*pt+te),[Math.floor(ge),Math.floor(pt)]}function kt(B){var re=.5/Math.PI,fe=.5,Se=-.5/Math.PI,te=.5,ge=256<<20,pt=_slicedToArray(B,2),yr=pt[0],Lr=pt[1];yr=(yr/ge-fe)/re,Lr=(Lr/ge-te)/Se,Lr=(Math.atan(Math.pow(Math.E,Lr))-Math.PI/4)*2,te=Math.PI/180;var Nt=Lr/te,Fr=yr/te;return[Fr,Nt]}function fr(B,re,fe){var Se=(0,Ee.Ht)(re[1]-B[1]),te=(0,Ee.Ht)(re[0]-B[0]),ge=(0,Ee.Ht)(B[1]),pt=(0,Ee.Ht)(re[1]),yr=Math.pow(Math.sin(Se/2),2)+Math.pow(Math.sin(te/2),2)*Math.cos(ge)*Math.cos(pt);return(0,Ee.DL)(2*Math.atan2(Math.sqrt(yr),Math.sqrt(1-yr)),fe="meters")}function Cr(B){var re=Math.PI/180,fe=85.0511287798,Se=6378137,te=Math.max(Math.min(fe,B[1]),-fe),ge=Math.sin(te*re),pt=Se*B[0]*re,yr=Se*Math.log((1+ge)/(1-ge))/2;return[pt,yr]}function Tr(B,re){var fe=Math.abs(B[1][1]-B[0][1])*re,Se=Math.abs(B[1][0]-B[0][0])*re;return[[B[0][0]-Se,B[0][1]-fe],[B[1][0]+Se,B[1][1]+fe]]}function Ar(B,re){return B[0][0]<=re[0][0]&&B[0][1]<=re[0][1]&&B[1][0]>=re[1][0]&&B[1][1]>=re[1][1]}function Je(B){return[[B[0],B[1]],[B[2],B[3]]]}var xt=function(){function B(){var re=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,fe=arguments.length>1?arguments[1]:void 0;(0,Qe.Z)(this,B),(0,qe.Z)(this,"limit",void 0),(0,qe.Z)(this,"cache",void 0),(0,qe.Z)(this,"destroy",void 0),(0,qe.Z)(this,"order",void 0),this.limit=re,this.destroy=fe||this.defaultDestroy,this.order=[],this.clear()}return(0,Ie.Z)(B,[{key:"clear",value:function(){var fe=this;this.order.forEach(function(Se){fe.delete(Se)}),this.cache={},this.order=[]}},{key:"get",value:function(fe){var Se=this.cache[fe];return Se&&(this.deleteOrder(fe),this.appendOrder(fe)),Se}},{key:"set",value:function(fe,Se){this.cache[fe]?(this.delete(fe),this.cache[fe]=Se,this.appendOrder(fe)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[fe]=Se,this.appendOrder(fe))}},{key:"delete",value:function(fe){var Se=this.cache[fe];Se&&(this.deleteCache(fe),this.deleteOrder(fe),this.destroy(Se,fe))}},{key:"deleteCache",value:function(fe){delete this.cache[fe]}},{key:"deleteOrder",value:function(fe){var Se=this.order.findIndex(function(te){return te===fe});Se>=0&&this.order.splice(Se,1)}},{key:"appendOrder",value:function(fe){this.order.push(fe)}},{key:"defaultDestroy",value:function(fe,Se){return null}}]),B}();function ht(B,re){B.forEach(function(fe){!re[fe]||(re[fe]=re[fe].bind(re))})}var lr=_(2650);function Kr(B){var re=lr.ZP(B),fe=[0,0,0,0];return re!=null&&(fe[0]=re.r/255,fe[1]=re.g/255,fe[2]=re.b/255,fe[3]=re.opacity),fe}function lt(B){var re=B&&B[0],fe=B&&B[1],Se=B&&B[2],te=re+fe*256+Se*65536-1;return te}function Lt(B){return[B+1&255,B+1>>8&255,B+1>>8>>8&255]}function Jt(B){var re=document.createElement("canvas"),fe=re.getContext("2d");re.width=256,re.height=1;for(var Se=fe.createLinearGradient(0,0,256,1),te=null,ge=B.positions[0],pt=B.positions[B.positions.length-1],yr=0;yr<B.colors.length;++yr){var Lr=(B.positions[yr]-ge)/(pt-ge);Se.addColorStop(Lr,B.colors[yr])}return fe.fillStyle=Se,fe.fillRect(0,0,256,1),te=new Uint8ClampedArray(fe.getImageData(0,0,256,1).data),new ImageData(te,256,1)}var or;(function(B){B.CENTER="center",B.TOP="top",B["TOP-LEFT"]="top-left",B["TOP-RIGHT"]="top-right",B.BOTTOM="bottom",B["BOTTOM-LEFT"]="bottom-left",B.LEFT="left",B.RIGHT="right"})(or||(or={}));var cn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Pn(B,re,fe){var Se=B.classList;for(var te in cn)cn.hasOwnProperty(te)&&Se.remove("l7-".concat(fe,"-anchor-").concat(te));Se.add("l7-".concat(fe,"-anchor-").concat(re))}function bi(B){if(B.length===0)throw new Error("max requires at least one data point");for(var re=B[0],fe=1;fe<B.length;fe++)B[fe]>re&&(re=B[fe]);return re*1}function Si(B){if(B.length===0)throw new Error("min requires at least one data point");for(var re=B[0],fe=1;fe<B.length;fe++)B[fe]<re&&(re=B[fe]);return re*1}function Ri(B){if(B.length===0)return 0;for(var re=B[0]*1,fe=1;fe<B.length;fe++)re+=B[fe]*1;return re}function ia(B){if(B.length===0)throw new Error("mean requires at least one data point");return Ri(B)/B.length}function pi(B){if(B.length===0)throw new Error("mean requires at least one data point");if(B.length<3)return B[0];B.sort();for(var re=B[0],fe=NaN,Se=0,te=1,ge=1;ge<B.length+1;ge++)B[ge]!==re?(te>Se&&(Se=te,fe=re),te=1,re=B[ge]):te++;return fe*1}var H={min:Si,max:bi,mean:ia,sum:Ri,mode:pi};function ie(B,re){return B.map(function(fe){return fe[re]})}function ce(B,re){return H[B](re)}},3473:function(ar,O,_){"use strict";_.d(O,{Z:function(){return Q}});function Q(E,p,b,X,W){var $={};return Object.keys(X).forEach(function(I){$[I]=X[I]}),$.enumerable=!!$.enumerable,$.configurable=!!$.configurable,("value"in $||$.initializer)&&($.writable=!0),$=b.slice().reverse().reduce(function(I,k){return k(E,p,I)||I},$),W&&$.initializer!==void 0&&($.value=$.initializer?$.initializer.call(W):void 0,$.initializer=void 0),$.initializer===void 0&&(Object.defineProperty(E,p,$),$=null),$}},66213:function(ar,O,_){"use strict";_.d(O,{Z:function(){return p}});var Q=_(77608);function E(b,X){for(;!Object.prototype.hasOwnProperty.call(b,X)&&(b=(0,Q.Z)(b),b!==null););return b}function p(b,X,W){return typeof Reflect!="undefined"&&Reflect.get?p=Reflect.get:p=function(I,k,Ce){var Be=E(I,k);if(!!Be){var We=Object.getOwnPropertyDescriptor(Be,k);return We.get?We.get.call(Ce):We.value}},p(b,X,W||b)}},55770:function(ar,O,_){"use strict";_.d(O,{Z:function(){return Q}});function Q(E,p,b,X){!b||Object.defineProperty(E,p,{enumerable:b.enumerable,configurable:b.configurable,writable:b.writable,value:b.initializer?b.initializer.call(X):void 0})}},31795:function(ar,O,_){var Q=_(75752);ar.exports.geometry=E,ar.exports.ring=b;function E(W){var $=0,I;switch(W.type){case"Polygon":return p(W.coordinates);case"MultiPolygon":for(I=0;I<W.coordinates.length;I++)$+=p(W.coordinates[I]);return $;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(I=0;I<W.geometries.length;I++)$+=E(W.geometries[I]);return $}}function p(W){var $=0;if(W&&W.length>0){$+=Math.abs(b(W[0]));for(var I=1;I<W.length;I++)$-=Math.abs(b(W[I]))}return $}function b(W){var $,I,k,Ce,Be,We,$e,Vt=0,Ht=W.length;if(Ht>2){for($e=0;$e<Ht;$e++)$e===Ht-2?(Ce=Ht-2,Be=Ht-1,We=0):$e===Ht-1?(Ce=Ht-1,Be=0,We=1):(Ce=$e,Be=$e+1,We=$e+2),$=W[Ce],I=W[Be],k=W[We],Vt+=(X(k[0])-X($[0]))*Math.sin(X(I[1]));Vt=Vt*Q.RADIUS*Q.RADIUS/2}return Vt}function X(W){return W*Math.PI/180}},38163:function(ar,O,_){var Q=_(31795);ar.exports=E;function E(I,k){switch(I&&I.type||null){case"FeatureCollection":return I.features=I.features.map(p(E,k)),I;case"GeometryCollection":return I.geometries=I.geometries.map(p(E,k)),I;case"Feature":return I.geometry=E(I.geometry,k),I;case"Polygon":case"MultiPolygon":return b(I,k);default:return I}}function p(I,k){return function(Ce){return I(Ce,k)}}function b(I,k){return I.type==="Polygon"?I.coordinates=X(I.coordinates,k):I.type==="MultiPolygon"&&(I.coordinates=I.coordinates.map(p(X,k))),I}function X(I,k){k=!!k,I[0]=W(I[0],k);for(var Ce=1;Ce<I.length;Ce++)I[Ce]=W(I[Ce],!k);return I}function W(I,k){return $(I)===k?I:I.reverse()}function $(I){return Q.ring(I)>=0}},49296:function(ar){"use strict";ar.exports=_,ar.exports.default=_;var O=1e20;function _(X,W,$,I,k,Ce){this.fontSize=X||24,this.buffer=W===void 0?3:W,this.cutoff=I||.25,this.fontFamily=k||"sans-serif",this.fontWeight=Ce||"normal",this.radius=$||8;var Be=this.size=this.fontSize+this.buffer*2,We=Be+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Be,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(We*We),this.gridInner=new Float64Array(We*We),this.f=new Float64Array(We),this.z=new Float64Array(We+1),this.v=new Uint16Array(We),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(Be/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Q(X,W,$,I,k,Ce,Be){Ce.fill(O,0,W*$),Be.fill(0,0,W*$);for(var We=(W-I)/2,$e=0;$e<k;$e++)for(var Vt=0;Vt<I;Vt++){var Ht=($e+We)*W+Vt+We,At=X.data[4*($e*I+Vt)+3]/255;if(At===1)Ce[Ht]=0,Be[Ht]=O;else if(At===0)Ce[Ht]=O,Be[Ht]=0;else{var Ot=Math.max(0,.5-At),bt=Math.max(0,At-.5);Ce[Ht]=Ot*Ot,Be[Ht]=bt*bt}}}function E(X,W,$,I,k,Ce,Be){for(var We=0;We<W*$;We++){var $e=Math.sqrt(I[We])-Math.sqrt(k[We]);X[We]=Math.round(255-255*($e/Ce+Be))}}_.prototype._draw=function(X,W){var $=this.ctx.measureText(X),I=$.width,k=2*this.buffer,Ce,Be,We,$e,Vt,Ht,At,Ot;W&&this.useMetrics?(Vt=Math.floor($.actualBoundingBoxAscent),Ot=this.buffer+Math.ceil($.actualBoundingBoxAscent),Ht=this.buffer,At=this.buffer,Be=Math.min(this.size,Math.ceil($.actualBoundingBoxRight-$.actualBoundingBoxLeft)),$e=Math.min(this.size-Ht,Math.ceil($.actualBoundingBoxAscent+$.actualBoundingBoxDescent)),Ce=Be+k,We=$e+k,this.ctx.textBaseline="alphabetic"):(Ce=Be=this.size,We=$e=this.size,Vt=19*this.fontSize/24,Ht=At=0,Ot=this.middle,this.ctx.textBaseline="middle");var bt;Be&&$e&&(this.ctx.clearRect(At,Ht,Be,$e),this.ctx.fillText(X,this.buffer,Ot),bt=this.ctx.getImageData(At,Ht,Be,$e));var dt=new Uint8ClampedArray(Ce*We);return Q(bt,Ce,We,Be,$e,this.gridOuter,this.gridInner),p(this.gridOuter,Ce,We,this.f,this.v,this.z),p(this.gridInner,Ce,We,this.f,this.v,this.z),E(dt,Ce,We,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:dt,metrics:{width:Be,height:$e,sdfWidth:Ce,sdfHeight:We,top:Vt,left:0,advance:I}}},_.prototype.draw=function(X){return this._draw(X,!1).data},_.prototype.drawWithMetrics=function(X){return this._draw(X,!0)};function p(X,W,$,I,k,Ce){for(var Be=0;Be<W;Be++)b(X,Be,W,$,I,k,Ce);for(var We=0;We<$;We++)b(X,We*W,1,W,I,k,Ce)}function b(X,W,$,I,k,Ce,Be){var We,$e,Vt,Ht;for(Ce[0]=0,Be[0]=-O,Be[1]=O,We=0;We<I;We++)k[We]=X[W+We*$];for(We=1,$e=0,Vt=0;We<I;We++){do Ht=Ce[$e],Vt=(k[We]-k[Ht]+We*We-Ht*Ht)/(We-Ht)/2;while(Vt<=Be[$e]&&--$e>-1);$e++,Ce[$e]=We,Be[$e]=Vt,Be[$e+1]=O}for(We=0,$e=0;We<I;We++){for(;Be[$e+1]<We;)$e++;Ht=Ce[$e],X[W+We*$]=k[Ht]+(We-Ht)*(We-Ht)}}},40271:function(ar,O,_){"use strict";_.d(O,{zL:function(){return X},DL:function(){return dt},Ht:function(){return Ne}});var Q=63710088e-1,E={centimeters:Q*100,centimetres:Q*100,degrees:Q/111325,feet:Q*3.28084,inches:Q*39.37,kilometers:Q/1e3,kilometres:Q/1e3,meters:Q,metres:Q,miles:Q/1609.344,millimeters:Q*1e3,millimetres:Q*1e3,nauticalmiles:Q/1852,radians:1,yards:Q*1.0936},p={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Q,yards:1.0936133},b={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function X(ae,Te,oe){oe===void 0&&(oe={});var me={type:"Feature"};return(oe.id===0||oe.id)&&(me.id=oe.id),oe.bbox&&(me.bbox=oe.bbox),me.properties=Te||{},me.geometry=ae,me}function W(ae,Te,oe){switch(oe===void 0&&(oe={}),ae){case"Point":return $(Te).geometry;case"LineString":return Be(Te).geometry;case"Polygon":return k(Te).geometry;case"MultiPoint":return Ht(Te).geometry;case"MultiLineString":return Vt(Te).geometry;case"MultiPolygon":return At(Te).geometry;default:throw new Error(ae+" is invalid")}}function $(ae,Te,oe){if(oe===void 0&&(oe={}),!ae)throw new Error("coordinates is required");if(!Array.isArray(ae))throw new Error("coordinates must be an Array");if(ae.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ae(ae[0])||!Ae(ae[1]))throw new Error("coordinates must contain numbers");var me={type:"Point",coordinates:ae};return X(me,Te,oe)}function I(ae,Te,oe){return oe===void 0&&(oe={}),$e(ae.map(function(me){return $(me,Te)}),oe)}function k(ae,Te,oe){oe===void 0&&(oe={});for(var me=0,Me=ae;me<Me.length;me++){var qe=Me[me];if(qe.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var yt=0;yt<qe[qe.length-1].length;yt++)if(qe[qe.length-1][yt]!==qe[0][yt])throw new Error("First and last Position are not equivalent.")}var Qt={type:"Polygon",coordinates:ae};return X(Qt,Te,oe)}function Ce(ae,Te,oe){return oe===void 0&&(oe={}),$e(ae.map(function(me){return k(me,Te)}),oe)}function Be(ae,Te,oe){if(oe===void 0&&(oe={}),ae.length<2)throw new Error("coordinates must be an array of two or more positions");var me={type:"LineString",coordinates:ae};return X(me,Te,oe)}function We(ae,Te,oe){return oe===void 0&&(oe={}),$e(ae.map(function(me){return Be(me,Te)}),oe)}function $e(ae,Te){Te===void 0&&(Te={});var oe={type:"FeatureCollection"};return Te.id&&(oe.id=Te.id),Te.bbox&&(oe.bbox=Te.bbox),oe.features=ae,oe}function Vt(ae,Te,oe){oe===void 0&&(oe={});var me={type:"MultiLineString",coordinates:ae};return X(me,Te,oe)}function Ht(ae,Te,oe){oe===void 0&&(oe={});var me={type:"MultiPoint",coordinates:ae};return X(me,Te,oe)}function At(ae,Te,oe){oe===void 0&&(oe={});var me={type:"MultiPolygon",coordinates:ae};return X(me,Te,oe)}function Ot(ae,Te,oe){oe===void 0&&(oe={});var me={type:"GeometryCollection",geometries:ae};return X(me,Te,oe)}function bt(ae,Te){if(Te===void 0&&(Te=0),Te&&!(Te>=0))throw new Error("precision must be a positive number");var oe=Math.pow(10,Te||0);return Math.round(ae*oe)/oe}function dt(ae,Te){Te===void 0&&(Te="kilometers");var oe=E[Te];if(!oe)throw new Error(Te+" units is invalid");return ae*oe}function Pr(ae,Te){Te===void 0&&(Te="kilometers");var oe=E[Te];if(!oe)throw new Error(Te+" units is invalid");return ae/oe}function er(ae,Te){return tt(Pr(ae,Te))}function Ft(ae){var Te=ae%360;return Te<0&&(Te+=360),Te}function tt(ae){var Te=ae%(2*Math.PI);return Te*180/Math.PI}function Ne(ae){var Te=ae%360;return Te*Math.PI/180}function Qe(ae,Te,oe){if(Te===void 0&&(Te="kilometers"),oe===void 0&&(oe="kilometers"),!(ae>=0))throw new Error("length must be a positive number");return dt(Pr(ae,Te),oe)}function Ie(ae,Te,oe){if(Te===void 0&&(Te="meters"),oe===void 0&&(oe="kilometers"),!(ae>=0))throw new Error("area must be a positive number");var me=b[Te];if(!me)throw new Error("invalid original units");var Me=b[oe];if(!Me)throw new Error("invalid final units");return ae/me*Me}function Ae(ae){return!isNaN(ae)&&ae!==null&&!Array.isArray(ae)}function Ue(ae){return!!ae&&ae.constructor===Object}function St(ae){if(!ae)throw new Error("bbox is required");if(!Array.isArray(ae))throw new Error("bbox must be an Array");if(ae.length!==4&&ae.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");ae.forEach(function(Te){if(!Ae(Te))throw new Error("bbox must only contain numbers")})}function ur(ae){if(!ae)throw new Error("id is required");if(["string","number"].indexOf(typeof ae)===-1)throw new Error("id must be a number or a string")}},17781:function(){},97432:function(){},39144:function(ar,O,_){"use strict";_.d(O,{Z:function(){return er}});var Q=_(96156),E=_(22122),p=_(67294),b=_(94184),X=_.n(b),W=_(98423),$=_(65632),I=function(Ft,tt){var Ne={};for(var Qe in Ft)Object.prototype.hasOwnProperty.call(Ft,Qe)&&tt.indexOf(Qe)<0&&(Ne[Qe]=Ft[Qe]);if(Ft!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Ie=0,Qe=Object.getOwnPropertySymbols(Ft);Ie<Qe.length;Ie++)tt.indexOf(Qe[Ie])<0&&Object.prototype.propertyIsEnumerable.call(Ft,Qe[Ie])&&(Ne[Qe[Ie]]=Ft[Qe[Ie]]);return Ne},k=function(tt){var Ne=tt.prefixCls,Qe=tt.className,Ie=tt.hoverable,Ae=Ie===void 0?!0:Ie,Ue=I(tt,["prefixCls","className","hoverable"]);return p.createElement($.C,null,function(St){var ur=St.getPrefixCls,ae=ur("card",Ne),Te=X()("".concat(ae,"-grid"),Qe,(0,Q.Z)({},"".concat(ae,"-grid-hoverable"),Ae));return p.createElement("div",(0,E.Z)({},Ue,{className:Te}))})},Ce=k,Be=function(Ft,tt){var Ne={};for(var Qe in Ft)Object.prototype.hasOwnProperty.call(Ft,Qe)&&tt.indexOf(Qe)<0&&(Ne[Qe]=Ft[Qe]);if(Ft!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Ie=0,Qe=Object.getOwnPropertySymbols(Ft);Ie<Qe.length;Ie++)tt.indexOf(Qe[Ie])<0&&Object.prototype.propertyIsEnumerable.call(Ft,Qe[Ie])&&(Ne[Qe[Ie]]=Ft[Qe[Ie]]);return Ne},We=function(tt){return p.createElement($.C,null,function(Ne){var Qe=Ne.getPrefixCls,Ie=tt.prefixCls,Ae=tt.className,Ue=tt.avatar,St=tt.title,ur=tt.description,ae=Be(tt,["prefixCls","className","avatar","title","description"]),Te=Qe("card",Ie),oe=X()("".concat(Te,"-meta"),Ae),me=Ue?p.createElement("div",{className:"".concat(Te,"-meta-avatar")},Ue):null,Me=St?p.createElement("div",{className:"".concat(Te,"-meta-title")},St):null,qe=ur?p.createElement("div",{className:"".concat(Te,"-meta-description")},ur):null,yt=Me||qe?p.createElement("div",{className:"".concat(Te,"-meta-detail")},Me,qe):null;return p.createElement("div",(0,E.Z)({},ae,{className:oe}),me,yt)})},$e=We,Vt=_(45934),Ht=_(71230),At=_(15746),Ot=_(97647),bt=function(Ft,tt){var Ne={};for(var Qe in Ft)Object.prototype.hasOwnProperty.call(Ft,Qe)&&tt.indexOf(Qe)<0&&(Ne[Qe]=Ft[Qe]);if(Ft!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Ie=0,Qe=Object.getOwnPropertySymbols(Ft);Ie<Qe.length;Ie++)tt.indexOf(Qe[Ie])<0&&Object.prototype.propertyIsEnumerable.call(Ft,Qe[Ie])&&(Ne[Qe[Ie]]=Ft[Qe[Ie]]);return Ne};function dt(Ft){var tt=Ft.map(function(Ne,Qe){return p.createElement("li",{style:{width:"".concat(100/Ft.length,"%")},key:"action-".concat(Qe)},p.createElement("span",null,Ne))});return tt}var Pr=function(tt){var Ne,Qe,Ie=p.useContext($.E_),Ae=Ie.getPrefixCls,Ue=Ie.direction,St=p.useContext(Ot.Z),ur=function(or){var cn;(cn=tt.onTabChange)===null||cn===void 0||cn.call(tt,or)},ae=function(){var or;return p.Children.forEach(tt.children,function(cn){cn&&cn.type&&cn.type===Ce&&(or=!0)}),or},Te=tt.prefixCls,oe=tt.className,me=tt.extra,Me=tt.headStyle,qe=Me===void 0?{}:Me,yt=tt.bodyStyle,Qt=yt===void 0?{}:yt,Or=tt.title,Dr=tt.loading,on=tt.bordered,tr=on===void 0?!0:on,se=tt.size,be=tt.type,Fe=tt.cover,Ee=tt.actions,wt=tt.tabList,Bt=tt.children,w=tt.activeTabKey,N=tt.defaultActiveTabKey,he=tt.tabBarExtraContent,je=tt.hoverable,et=tt.tabProps,_t=et===void 0?{}:et,Ct=bt(tt,["prefixCls","className","extra","headStyle","bodyStyle","title","loading","bordered","size","type","cover","actions","tabList","children","activeTabKey","defaultActiveTabKey","tabBarExtraContent","hoverable","tabProps"]),V=Ae("card",Te),Yt=Qt.padding===0||Qt.padding==="0px"?{padding:24}:void 0,kt=p.createElement("div",{className:"".concat(V,"-loading-block")}),fr=p.createElement("div",{className:"".concat(V,"-loading-content"),style:Yt},p.createElement(Ht.Z,{gutter:8},p.createElement(At.Z,{span:22},kt)),p.createElement(Ht.Z,{gutter:8},p.createElement(At.Z,{span:8},kt),p.createElement(At.Z,{span:15},kt)),p.createElement(Ht.Z,{gutter:8},p.createElement(At.Z,{span:6},kt),p.createElement(At.Z,{span:18},kt)),p.createElement(Ht.Z,{gutter:8},p.createElement(At.Z,{span:13},kt),p.createElement(At.Z,{span:9},kt)),p.createElement(Ht.Z,{gutter:8},p.createElement(At.Z,{span:4},kt),p.createElement(At.Z,{span:3},kt),p.createElement(At.Z,{span:16},kt))),Cr=w!==void 0,Tr=(0,E.Z)((0,E.Z)({},_t),(Ne={},(0,Q.Z)(Ne,Cr?"activeKey":"defaultActiveKey",Cr?w:N),(0,Q.Z)(Ne,"tabBarExtraContent",he),Ne)),Ar,Je=wt&&wt.length?p.createElement(Vt.Z,(0,E.Z)({size:"large"},Tr,{className:"".concat(V,"-head-tabs"),onChange:ur}),wt.map(function(Jt){return p.createElement(Vt.Z.TabPane,{tab:Jt.tab,disabled:Jt.disabled,key:Jt.key})})):null;(Or||me||Je)&&(Ar=p.createElement("div",{className:"".concat(V,"-head"),style:qe},p.createElement("div",{className:"".concat(V,"-head-wrapper")},Or&&p.createElement("div",{className:"".concat(V,"-head-title")},Or),me&&p.createElement("div",{className:"".concat(V,"-extra")},me)),Je));var xt=Fe?p.createElement("div",{className:"".concat(V,"-cover")},Fe):null,ht=p.createElement("div",{className:"".concat(V,"-body"),style:Qt},Dr?fr:Bt),lr=Ee&&Ee.length?p.createElement("ul",{className:"".concat(V,"-actions")},dt(Ee)):null,Kr=(0,W.Z)(Ct,["onTabChange"]),lt=se||St,Lt=X()(V,(Qe={},(0,Q.Z)(Qe,"".concat(V,"-loading"),Dr),(0,Q.Z)(Qe,"".concat(V,"-bordered"),tr),(0,Q.Z)(Qe,"".concat(V,"-hoverable"),je),(0,Q.Z)(Qe,"".concat(V,"-contain-grid"),ae()),(0,Q.Z)(Qe,"".concat(V,"-contain-tabs"),wt&&wt.length),(0,Q.Z)(Qe,"".concat(V,"-").concat(lt),lt),(0,Q.Z)(Qe,"".concat(V,"-type-").concat(be),!!be),(0,Q.Z)(Qe,"".concat(V,"-rtl"),Ue==="rtl"),Qe),oe);return p.createElement("div",(0,E.Z)({},Kr,{className:Lt}),Ar,xt,ht,lr)};Pr.Grid=Ce,Pr.Meta=$e;var er=Pr},72012:function(ar,O,_){"use strict";var Q=_(43673),E=_.n(Q),p=_(97432),b=_.n(p),X=_(18106),W=_(13062),$=_(89032)},15746:function(ar,O,_){"use strict";var Q=_(21584);O.Z=Q.Z},89032:function(ar,O,_){"use strict";var Q=_(43673),E=_.n(Q),p=_(6999)},71230:function(ar,O,_){"use strict";var Q=_(92820);O.Z=Q.Z},13062:function(ar,O,_){"use strict";var Q=_(43673),E=_.n(Q),p=_(6999)},48583:function(ar,O,_){"use strict";var Q=_(27418);/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */function E(Ae,Ue){if(Ae===Ue)return 0;for(var St=Ae.length,ur=Ue.length,ae=0,Te=Math.min(St,ur);ae<Te;++ae)if(Ae[ae]!==Ue[ae]){St=Ae[ae],ur=Ue[ae];break}return St<ur?-1:ur<St?1:0}function p(Ae){return _.g.Buffer&&typeof _.g.Buffer.isBuffer=="function"?_.g.Buffer.isBuffer(Ae):!!(Ae!=null&&Ae._isBuffer)}var b=_(30069),X=Object.prototype.hasOwnProperty,W=Array.prototype.slice,$=function(){return function(){}.name==="foo"}();function I(Ae){return Object.prototype.toString.call(Ae)}function k(Ae){return p(Ae)||typeof _.g.ArrayBuffer!="function"?!1:typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(Ae):Ae?!!(Ae instanceof DataView||Ae.buffer&&Ae.buffer instanceof ArrayBuffer):!1}var Ce=ar.exports=Ot,Be=/\s*function\s+([^\(\s]*)\s*/;function We(Ae){if(!!b.isFunction(Ae)){if($)return Ae.name;var Ue=Ae.toString(),St=Ue.match(Be);return St&&St[1]}}Ce.AssertionError=function(Ue){this.name="AssertionError",this.actual=Ue.actual,this.expected=Ue.expected,this.operator=Ue.operator,Ue.message?(this.message=Ue.message,this.generatedMessage=!1):(this.message=Ht(this),this.generatedMessage=!0);var St=Ue.stackStartFunction||At;if(Error.captureStackTrace)Error.captureStackTrace(this,St);else{var ur=new Error;if(ur.stack){var ae=ur.stack,Te=We(St),oe=ae.indexOf(`
`+Te);if(oe>=0){var me=ae.indexOf(`
`,oe+1);ae=ae.substring(me+1)}this.stack=ae}}},b.inherits(Ce.AssertionError,Error);function $e(Ae,Ue){return typeof Ae=="string"?Ae.length<Ue?Ae:Ae.slice(0,Ue):Ae}function Vt(Ae){if($||!b.isFunction(Ae))return b.inspect(Ae);var Ue=We(Ae),St=Ue?": "+Ue:"";return"[Function"+St+"]"}function Ht(Ae){return $e(Vt(Ae.actual),128)+" "+Ae.operator+" "+$e(Vt(Ae.expected),128)}function At(Ae,Ue,St,ur,ae){throw new Ce.AssertionError({message:St,actual:Ae,expected:Ue,operator:ur,stackStartFunction:ae})}Ce.fail=At;function Ot(Ae,Ue){Ae||At(Ae,!0,Ue,"==",Ce.ok)}Ce.ok=Ot,Ce.equal=function(Ue,St,ur){Ue!=St&&At(Ue,St,ur,"==",Ce.equal)},Ce.notEqual=function(Ue,St,ur){Ue==St&&At(Ue,St,ur,"!=",Ce.notEqual)},Ce.deepEqual=function(Ue,St,ur){bt(Ue,St,!1)||At(Ue,St,ur,"deepEqual",Ce.deepEqual)},Ce.deepStrictEqual=function(Ue,St,ur){bt(Ue,St,!0)||At(Ue,St,ur,"deepStrictEqual",Ce.deepStrictEqual)};function bt(Ae,Ue,St,ur){if(Ae===Ue)return!0;if(p(Ae)&&p(Ue))return E(Ae,Ue)===0;if(b.isDate(Ae)&&b.isDate(Ue))return Ae.getTime()===Ue.getTime();if(b.isRegExp(Ae)&&b.isRegExp(Ue))return Ae.source===Ue.source&&Ae.global===Ue.global&&Ae.multiline===Ue.multiline&&Ae.lastIndex===Ue.lastIndex&&Ae.ignoreCase===Ue.ignoreCase;if((Ae===null||typeof Ae!="object")&&(Ue===null||typeof Ue!="object"))return St?Ae===Ue:Ae==Ue;if(k(Ae)&&k(Ue)&&I(Ae)===I(Ue)&&!(Ae instanceof Float32Array||Ae instanceof Float64Array))return E(new Uint8Array(Ae.buffer),new Uint8Array(Ue.buffer))===0;if(p(Ae)!==p(Ue))return!1;ur=ur||{actual:[],expected:[]};var ae=ur.actual.indexOf(Ae);return ae!==-1&&ae===ur.expected.indexOf(Ue)?!0:(ur.actual.push(Ae),ur.expected.push(Ue),Pr(Ae,Ue,St,ur))}function dt(Ae){return Object.prototype.toString.call(Ae)=="[object Arguments]"}function Pr(Ae,Ue,St,ur){if(Ae==null||Ue===null||Ue===void 0)return!1;if(b.isPrimitive(Ae)||b.isPrimitive(Ue))return Ae===Ue;if(St&&Object.getPrototypeOf(Ae)!==Object.getPrototypeOf(Ue))return!1;var ae=dt(Ae),Te=dt(Ue);if(ae&&!Te||!ae&&Te)return!1;if(ae)return Ae=W.call(Ae),Ue=W.call(Ue),bt(Ae,Ue,St);var oe=Ie(Ae),me=Ie(Ue),Me,qe;if(oe.length!==me.length)return!1;for(oe.sort(),me.sort(),qe=oe.length-1;qe>=0;qe--)if(oe[qe]!==me[qe])return!1;for(qe=oe.length-1;qe>=0;qe--)if(Me=oe[qe],!bt(Ae[Me],Ue[Me],St,ur))return!1;return!0}Ce.notDeepEqual=function(Ue,St,ur){bt(Ue,St,!1)&&At(Ue,St,ur,"notDeepEqual",Ce.notDeepEqual)},Ce.notDeepStrictEqual=er;function er(Ae,Ue,St){bt(Ae,Ue,!0)&&At(Ae,Ue,St,"notDeepStrictEqual",er)}Ce.strictEqual=function(Ue,St,ur){Ue!==St&&At(Ue,St,ur,"===",Ce.strictEqual)},Ce.notStrictEqual=function(Ue,St,ur){Ue===St&&At(Ue,St,ur,"!==",Ce.notStrictEqual)};function Ft(Ae,Ue){if(!Ae||!Ue)return!1;if(Object.prototype.toString.call(Ue)=="[object RegExp]")return Ue.test(Ae);try{if(Ae instanceof Ue)return!0}catch(St){}return Error.isPrototypeOf(Ue)?!1:Ue.call({},Ae)===!0}function tt(Ae){var Ue;try{Ae()}catch(St){Ue=St}return Ue}function Ne(Ae,Ue,St,ur){var ae;if(typeof Ue!="function")throw new TypeError('"block" argument must be a function');typeof St=="string"&&(ur=St,St=null),ae=tt(Ue),ur=(St&&St.name?" ("+St.name+").":".")+(ur?" "+ur:"."),Ae&&!ae&&At(ae,St,"Missing expected exception"+ur);var Te=typeof ur=="string",oe=!Ae&&b.isError(ae),me=!Ae&&ae&&!St;if((oe&&Te&&Ft(ae,St)||me)&&At(ae,St,"Got unwanted exception"+ur),Ae&&ae&&St&&!Ft(ae,St)||!Ae&&ae)throw ae}Ce.throws=function(Ae,Ue,St){Ne(!0,Ae,Ue,St)},Ce.doesNotThrow=function(Ae,Ue,St){Ne(!1,Ae,Ue,St)},Ce.ifError=function(Ae){if(Ae)throw Ae};function Qe(Ae,Ue){Ae||At(Ae,!0,Ue,"==",Qe)}Ce.strict=Q(Qe,Ce,{equal:Ce.strictEqual,deepEqual:Ce.deepStrictEqual,notEqual:Ce.notStrictEqual,notDeepEqual:Ce.notDeepStrictEqual}),Ce.strict.strict=Ce.strict;var Ie=Object.keys||function(Ae){var Ue=[];for(var St in Ae)X.call(Ae,St)&&Ue.push(St);return Ue}},16076:function(ar){typeof Object.create=="function"?ar.exports=function(_,Q){_.super_=Q,_.prototype=Object.create(Q.prototype,{constructor:{value:_,enumerable:!1,writable:!0,configurable:!0}})}:ar.exports=function(_,Q){_.super_=Q;var E=function(){};E.prototype=Q.prototype,_.prototype=new E,_.prototype.constructor=_}},52014:function(ar){ar.exports=function(_){return _&&typeof _=="object"&&typeof _.copy=="function"&&typeof _.fill=="function"&&typeof _.readUInt8=="function"}},30069:function(ar,O,_){var Q=_(34155),E=/%[sdj%]/g;O.format=function(me){if(!Pr(me)){for(var Me=[],qe=0;qe<arguments.length;qe++)Me.push(X(arguments[qe]));return Me.join(" ")}for(var qe=1,yt=arguments,Qt=yt.length,Or=String(me).replace(E,function(on){if(on==="%%")return"%";if(qe>=Qt)return on;switch(on){case"%s":return String(yt[qe++]);case"%d":return Number(yt[qe++]);case"%j":try{return JSON.stringify(yt[qe++])}catch(tr){return"[Circular]"}default:return on}}),Dr=yt[qe];qe<Qt;Dr=yt[++qe])Ot(Dr)||!Ne(Dr)?Or+=" "+Dr:Or+=" "+X(Dr);return Or},O.deprecate=function(me,Me){if(Ft(_.g.process))return function(){return O.deprecate(me,Me).apply(this,arguments)};if(Q.noDeprecation===!0)return me;var qe=!1;function yt(){if(!qe){if(Q.throwDeprecation)throw new Error(Me);Q.traceDeprecation?console.trace(Me):console.error(Me),qe=!0}return me.apply(this,arguments)}return yt};var p={},b;O.debuglog=function(me){if(Ft(b)&&(b={NODE_ENV:"production"}.NODE_DEBUG||""),me=me.toUpperCase(),!p[me])if(new RegExp("\\b"+me+"\\b","i").test(b)){var Me=Q.pid;p[me]=function(){var qe=O.format.apply(O,arguments);console.error("%s %d: %s",me,Me,qe)}}else p[me]=function(){};return p[me]};function X(me,Me){var qe={seen:[],stylize:$};return arguments.length>=3&&(qe.depth=arguments[2]),arguments.length>=4&&(qe.colors=arguments[3]),At(Me)?qe.showHidden=Me:Me&&O._extend(qe,Me),Ft(qe.showHidden)&&(qe.showHidden=!1),Ft(qe.depth)&&(qe.depth=2),Ft(qe.colors)&&(qe.colors=!1),Ft(qe.customInspect)&&(qe.customInspect=!0),qe.colors&&(qe.stylize=W),k(qe,me,qe.depth)}O.inspect=X,X.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},X.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function W(me,Me){var qe=X.styles[Me];return qe?"["+X.colors[qe][0]+"m"+me+"["+X.colors[qe][1]+"m":me}function $(me,Me){return me}function I(me){var Me={};return me.forEach(function(qe,yt){Me[qe]=!0}),Me}function k(me,Me,qe){if(me.customInspect&&Me&&Ae(Me.inspect)&&Me.inspect!==O.inspect&&!(Me.constructor&&Me.constructor.prototype===Me)){var yt=Me.inspect(qe,me);return Pr(yt)||(yt=k(me,yt,qe)),yt}var Qt=Ce(me,Me);if(Qt)return Qt;var Or=Object.keys(Me),Dr=I(Or);if(me.showHidden&&(Or=Object.getOwnPropertyNames(Me)),Ie(Me)&&(Or.indexOf("message")>=0||Or.indexOf("description")>=0))return Be(Me);if(Or.length===0){if(Ae(Me)){var on=Me.name?": "+Me.name:"";return me.stylize("[Function"+on+"]","special")}if(tt(Me))return me.stylize(RegExp.prototype.toString.call(Me),"regexp");if(Qe(Me))return me.stylize(Date.prototype.toString.call(Me),"date");if(Ie(Me))return Be(Me)}var tr="",se=!1,be=["{","}"];if(Ht(Me)&&(se=!0,be=["[","]"]),Ae(Me)){var Fe=Me.name?": "+Me.name:"";tr=" [Function"+Fe+"]"}if(tt(Me)&&(tr=" "+RegExp.prototype.toString.call(Me)),Qe(Me)&&(tr=" "+Date.prototype.toUTCString.call(Me)),Ie(Me)&&(tr=" "+Be(Me)),Or.length===0&&(!se||Me.length==0))return be[0]+tr+be[1];if(qe<0)return tt(Me)?me.stylize(RegExp.prototype.toString.call(Me),"regexp"):me.stylize("[Object]","special");me.seen.push(Me);var Ee;return se?Ee=We(me,Me,qe,Dr,Or):Ee=Or.map(function(wt){return $e(me,Me,qe,Dr,wt,se)}),me.seen.pop(),Vt(Ee,tr,be)}function Ce(me,Me){if(Ft(Me))return me.stylize("undefined","undefined");if(Pr(Me)){var qe="'"+JSON.stringify(Me).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return me.stylize(qe,"string")}if(dt(Me))return me.stylize(""+Me,"number");if(At(Me))return me.stylize(""+Me,"boolean");if(Ot(Me))return me.stylize("null","null")}function Be(me){return"["+Error.prototype.toString.call(me)+"]"}function We(me,Me,qe,yt,Qt){for(var Or=[],Dr=0,on=Me.length;Dr<on;++Dr)oe(Me,String(Dr))?Or.push($e(me,Me,qe,yt,String(Dr),!0)):Or.push("");return Qt.forEach(function(tr){tr.match(/^\d+$/)||Or.push($e(me,Me,qe,yt,tr,!0))}),Or}function $e(me,Me,qe,yt,Qt,Or){var Dr,on,tr;if(tr=Object.getOwnPropertyDescriptor(Me,Qt)||{value:Me[Qt]},tr.get?tr.set?on=me.stylize("[Getter/Setter]","special"):on=me.stylize("[Getter]","special"):tr.set&&(on=me.stylize("[Setter]","special")),oe(yt,Qt)||(Dr="["+Qt+"]"),on||(me.seen.indexOf(tr.value)<0?(Ot(qe)?on=k(me,tr.value,null):on=k(me,tr.value,qe-1),on.indexOf(`
`)>-1&&(Or?on=on.split(`
`).map(function(se){return"  "+se}).join(`
`).substr(2):on=`
`+on.split(`
`).map(function(se){return"   "+se}).join(`
`))):on=me.stylize("[Circular]","special")),Ft(Dr)){if(Or&&Qt.match(/^\d+$/))return on;Dr=JSON.stringify(""+Qt),Dr.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(Dr=Dr.substr(1,Dr.length-2),Dr=me.stylize(Dr,"name")):(Dr=Dr.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),Dr=me.stylize(Dr,"string"))}return Dr+": "+on}function Vt(me,Me,qe){var yt=0,Qt=me.reduce(function(Or,Dr){return yt++,Dr.indexOf(`
`)>=0&&yt++,Or+Dr.replace(/\u001b\[\d\d?m/g,"").length+1},0);return Qt>60?qe[0]+(Me===""?"":Me+`
 `)+" "+me.join(`,
  `)+" "+qe[1]:qe[0]+Me+" "+me.join(", ")+" "+qe[1]}function Ht(me){return Array.isArray(me)}O.isArray=Ht;function At(me){return typeof me=="boolean"}O.isBoolean=At;function Ot(me){return me===null}O.isNull=Ot;function bt(me){return me==null}O.isNullOrUndefined=bt;function dt(me){return typeof me=="number"}O.isNumber=dt;function Pr(me){return typeof me=="string"}O.isString=Pr;function er(me){return typeof me=="symbol"}O.isSymbol=er;function Ft(me){return me===void 0}O.isUndefined=Ft;function tt(me){return Ne(me)&&St(me)==="[object RegExp]"}O.isRegExp=tt;function Ne(me){return typeof me=="object"&&me!==null}O.isObject=Ne;function Qe(me){return Ne(me)&&St(me)==="[object Date]"}O.isDate=Qe;function Ie(me){return Ne(me)&&(St(me)==="[object Error]"||me instanceof Error)}O.isError=Ie;function Ae(me){return typeof me=="function"}O.isFunction=Ae;function Ue(me){return me===null||typeof me=="boolean"||typeof me=="number"||typeof me=="string"||typeof me=="symbol"||typeof me=="undefined"}O.isPrimitive=Ue,O.isBuffer=_(52014);function St(me){return Object.prototype.toString.call(me)}function ur(me){return me<10?"0"+me.toString(10):me.toString(10)}var ae=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function Te(){var me=new Date,Me=[ur(me.getHours()),ur(me.getMinutes()),ur(me.getSeconds())].join(":");return[me.getDate(),ae[me.getMonth()],Me].join(" ")}O.log=function(){console.log("%s - %s",Te(),O.format.apply(O,arguments))},O.inherits=_(16076),O._extend=function(me,Me){if(!Me||!Ne(Me))return me;for(var qe=Object.keys(Me),yt=qe.length;yt--;)me[qe[yt]]=Me[qe[yt]];return me};function oe(me,Me){return Object.prototype.hasOwnProperty.call(me,Me)}},9187:function(ar){"use strict";ar.exports=O,ar.exports.default=O;function O(ae,Te,oe){oe=oe||2;var me=Te&&Te.length,Me=me?Te[0]*oe:ae.length,qe=_(ae,0,Me,oe,!0),yt=[];if(!qe||qe.next===qe.prev)return yt;var Qt,Or,Dr,on,tr,se,be;if(me&&(qe=$(ae,Te,qe,oe)),ae.length>80*oe){Qt=Dr=ae[0],Or=on=ae[1];for(var Fe=oe;Fe<Me;Fe+=oe)tr=ae[Fe],se=ae[Fe+1],tr<Qt&&(Qt=tr),se<Or&&(Or=se),tr>Dr&&(Dr=tr),se>on&&(on=se);be=Math.max(Dr-Qt,on-Or),be=be!==0?1/be:0}return E(qe,yt,oe,Qt,Or,be),yt}function _(ae,Te,oe,me,Me){var qe,yt;if(Me===ur(ae,Te,oe,me)>0)for(qe=Te;qe<oe;qe+=me)yt=Ae(qe,ae[qe],ae[qe+1],yt);else for(qe=oe-me;qe>=Te;qe-=me)yt=Ae(qe,ae[qe],ae[qe+1],yt);return yt&&dt(yt,yt.next)&&(Ue(yt),yt=yt.next),yt}function Q(ae,Te){if(!ae)return ae;Te||(Te=ae);var oe=ae,me;do if(me=!1,!oe.steiner&&(dt(oe,oe.next)||bt(oe.prev,oe,oe.next)===0)){if(Ue(oe),oe=Te=oe.prev,oe===oe.next)break;me=!0}else oe=oe.next;while(me||oe!==Te);return Te}function E(ae,Te,oe,me,Me,qe,yt){if(!!ae){!yt&&qe&&We(ae,me,Me,qe);for(var Qt=ae,Or,Dr;ae.prev!==ae.next;){if(Or=ae.prev,Dr=ae.next,qe?b(ae,me,Me,qe):p(ae)){Te.push(Or.i/oe),Te.push(ae.i/oe),Te.push(Dr.i/oe),Ue(ae),ae=Dr.next,Qt=Dr.next;continue}if(ae=Dr,ae===Qt){yt?yt===1?(ae=X(Q(ae),Te,oe),E(ae,Te,oe,me,Me,qe,2)):yt===2&&W(ae,Te,oe,me,Me,qe):E(Q(ae),Te,oe,me,Me,qe,1);break}}}}function p(ae){var Te=ae.prev,oe=ae,me=ae.next;if(bt(Te,oe,me)>=0)return!1;for(var Me=ae.next.next;Me!==ae.prev;){if(At(Te.x,Te.y,oe.x,oe.y,me.x,me.y,Me.x,Me.y)&&bt(Me.prev,Me,Me.next)>=0)return!1;Me=Me.next}return!0}function b(ae,Te,oe,me){var Me=ae.prev,qe=ae,yt=ae.next;if(bt(Me,qe,yt)>=0)return!1;for(var Qt=Me.x<qe.x?Me.x<yt.x?Me.x:yt.x:qe.x<yt.x?qe.x:yt.x,Or=Me.y<qe.y?Me.y<yt.y?Me.y:yt.y:qe.y<yt.y?qe.y:yt.y,Dr=Me.x>qe.x?Me.x>yt.x?Me.x:yt.x:qe.x>yt.x?qe.x:yt.x,on=Me.y>qe.y?Me.y>yt.y?Me.y:yt.y:qe.y>yt.y?qe.y:yt.y,tr=Vt(Qt,Or,Te,oe,me),se=Vt(Dr,on,Te,oe,me),be=ae.prevZ,Fe=ae.nextZ;be&&be.z>=tr&&Fe&&Fe.z<=se;){if(be!==ae.prev&&be!==ae.next&&At(Me.x,Me.y,qe.x,qe.y,yt.x,yt.y,be.x,be.y)&&bt(be.prev,be,be.next)>=0||(be=be.prevZ,Fe!==ae.prev&&Fe!==ae.next&&At(Me.x,Me.y,qe.x,qe.y,yt.x,yt.y,Fe.x,Fe.y)&&bt(Fe.prev,Fe,Fe.next)>=0))return!1;Fe=Fe.nextZ}for(;be&&be.z>=tr;){if(be!==ae.prev&&be!==ae.next&&At(Me.x,Me.y,qe.x,qe.y,yt.x,yt.y,be.x,be.y)&&bt(be.prev,be,be.next)>=0)return!1;be=be.prevZ}for(;Fe&&Fe.z<=se;){if(Fe!==ae.prev&&Fe!==ae.next&&At(Me.x,Me.y,qe.x,qe.y,yt.x,yt.y,Fe.x,Fe.y)&&bt(Fe.prev,Fe,Fe.next)>=0)return!1;Fe=Fe.nextZ}return!0}function X(ae,Te,oe){var me=ae;do{var Me=me.prev,qe=me.next.next;!dt(Me,qe)&&Pr(Me,me,me.next,qe)&&Ne(Me,qe)&&Ne(qe,Me)&&(Te.push(Me.i/oe),Te.push(me.i/oe),Te.push(qe.i/oe),Ue(me),Ue(me.next),me=ae=qe),me=me.next}while(me!==ae);return Q(me)}function W(ae,Te,oe,me,Me,qe){var yt=ae;do{for(var Qt=yt.next.next;Qt!==yt.prev;){if(yt.i!==Qt.i&&Ot(yt,Qt)){var Or=Ie(yt,Qt);yt=Q(yt,yt.next),Or=Q(Or,Or.next),E(yt,Te,oe,me,Me,qe),E(Or,Te,oe,me,Me,qe);return}Qt=Qt.next}yt=yt.next}while(yt!==ae)}function $(ae,Te,oe,me){var Me=[],qe,yt,Qt,Or,Dr;for(qe=0,yt=Te.length;qe<yt;qe++)Qt=Te[qe]*me,Or=qe<yt-1?Te[qe+1]*me:ae.length,Dr=_(ae,Qt,Or,me,!1),Dr===Dr.next&&(Dr.steiner=!0),Me.push(Ht(Dr));for(Me.sort(I),qe=0;qe<Me.length;qe++)oe=k(Me[qe],oe),oe=Q(oe,oe.next);return oe}function I(ae,Te){return ae.x-Te.x}function k(ae,Te){var oe=Ce(ae,Te);if(!oe)return Te;var me=Ie(oe,ae),Me=Q(oe,oe.next);return Q(me,me.next),Te===oe?Me:Te}function Ce(ae,Te){var oe=Te,me=ae.x,Me=ae.y,qe=-Infinity,yt;do{if(Me<=oe.y&&Me>=oe.next.y&&oe.next.y!==oe.y){var Qt=oe.x+(Me-oe.y)*(oe.next.x-oe.x)/(oe.next.y-oe.y);if(Qt<=me&&Qt>qe){if(qe=Qt,Qt===me){if(Me===oe.y)return oe;if(Me===oe.next.y)return oe.next}yt=oe.x<oe.next.x?oe:oe.next}}oe=oe.next}while(oe!==Te);if(!yt)return null;if(me===qe)return yt;var Or=yt,Dr=yt.x,on=yt.y,tr=Infinity,se;oe=yt;do me>=oe.x&&oe.x>=Dr&&me!==oe.x&&At(Me<on?me:qe,Me,Dr,on,Me<on?qe:me,Me,oe.x,oe.y)&&(se=Math.abs(Me-oe.y)/(me-oe.x),Ne(oe,ae)&&(se<tr||se===tr&&(oe.x>yt.x||oe.x===yt.x&&Be(yt,oe)))&&(yt=oe,tr=se)),oe=oe.next;while(oe!==Or);return yt}function Be(ae,Te){return bt(ae.prev,ae,Te.prev)<0&&bt(Te.next,ae,ae.next)<0}function We(ae,Te,oe,me){var Me=ae;do Me.z===null&&(Me.z=Vt(Me.x,Me.y,Te,oe,me)),Me.prevZ=Me.prev,Me.nextZ=Me.next,Me=Me.next;while(Me!==ae);Me.prevZ.nextZ=null,Me.prevZ=null,$e(Me)}function $e(ae){var Te,oe,me,Me,qe,yt,Qt,Or,Dr=1;do{for(oe=ae,ae=null,qe=null,yt=0;oe;){for(yt++,me=oe,Qt=0,Te=0;Te<Dr&&(Qt++,me=me.nextZ,!!me);Te++);for(Or=Dr;Qt>0||Or>0&&me;)Qt!==0&&(Or===0||!me||oe.z<=me.z)?(Me=oe,oe=oe.nextZ,Qt--):(Me=me,me=me.nextZ,Or--),qe?qe.nextZ=Me:ae=Me,Me.prevZ=qe,qe=Me;oe=me}qe.nextZ=null,Dr*=2}while(yt>1);return ae}function Vt(ae,Te,oe,me,Me){return ae=32767*(ae-oe)*Me,Te=32767*(Te-me)*Me,ae=(ae|ae<<8)&16711935,ae=(ae|ae<<4)&252645135,ae=(ae|ae<<2)&858993459,ae=(ae|ae<<1)&1431655765,Te=(Te|Te<<8)&16711935,Te=(Te|Te<<4)&252645135,Te=(Te|Te<<2)&858993459,Te=(Te|Te<<1)&1431655765,ae|Te<<1}function Ht(ae){var Te=ae,oe=ae;do(Te.x<oe.x||Te.x===oe.x&&Te.y<oe.y)&&(oe=Te),Te=Te.next;while(Te!==ae);return oe}function At(ae,Te,oe,me,Me,qe,yt,Qt){return(Me-yt)*(Te-Qt)-(ae-yt)*(qe-Qt)>=0&&(ae-yt)*(me-Qt)-(oe-yt)*(Te-Qt)>=0&&(oe-yt)*(qe-Qt)-(Me-yt)*(me-Qt)>=0}function Ot(ae,Te){return ae.next.i!==Te.i&&ae.prev.i!==Te.i&&!tt(ae,Te)&&(Ne(ae,Te)&&Ne(Te,ae)&&Qe(ae,Te)&&(bt(ae.prev,ae,Te.prev)||bt(ae,Te.prev,Te))||dt(ae,Te)&&bt(ae.prev,ae,ae.next)>0&&bt(Te.prev,Te,Te.next)>0)}function bt(ae,Te,oe){return(Te.y-ae.y)*(oe.x-Te.x)-(Te.x-ae.x)*(oe.y-Te.y)}function dt(ae,Te){return ae.x===Te.x&&ae.y===Te.y}function Pr(ae,Te,oe,me){var Me=Ft(bt(ae,Te,oe)),qe=Ft(bt(ae,Te,me)),yt=Ft(bt(oe,me,ae)),Qt=Ft(bt(oe,me,Te));return!!(Me!==qe&&yt!==Qt||Me===0&&er(ae,oe,Te)||qe===0&&er(ae,me,Te)||yt===0&&er(oe,ae,me)||Qt===0&&er(oe,Te,me))}function er(ae,Te,oe){return Te.x<=Math.max(ae.x,oe.x)&&Te.x>=Math.min(ae.x,oe.x)&&Te.y<=Math.max(ae.y,oe.y)&&Te.y>=Math.min(ae.y,oe.y)}function Ft(ae){return ae>0?1:ae<0?-1:0}function tt(ae,Te){var oe=ae;do{if(oe.i!==ae.i&&oe.next.i!==ae.i&&oe.i!==Te.i&&oe.next.i!==Te.i&&Pr(oe,oe.next,ae,Te))return!0;oe=oe.next}while(oe!==ae);return!1}function Ne(ae,Te){return bt(ae.prev,ae,ae.next)<0?bt(ae,Te,ae.next)>=0&&bt(ae,ae.prev,Te)>=0:bt(ae,Te,ae.prev)<0||bt(ae,ae.next,Te)<0}function Qe(ae,Te){var oe=ae,me=!1,Me=(ae.x+Te.x)/2,qe=(ae.y+Te.y)/2;do oe.y>qe!=oe.next.y>qe&&oe.next.y!==oe.y&&Me<(oe.next.x-oe.x)*(qe-oe.y)/(oe.next.y-oe.y)+oe.x&&(me=!me),oe=oe.next;while(oe!==ae);return me}function Ie(ae,Te){var oe=new St(ae.i,ae.x,ae.y),me=new St(Te.i,Te.x,Te.y),Me=ae.next,qe=Te.prev;return ae.next=Te,Te.prev=ae,oe.next=Me,Me.prev=oe,me.next=oe,oe.prev=me,qe.next=me,me.prev=qe,me}function Ae(ae,Te,oe,me){var Me=new St(ae,Te,oe);return me?(Me.next=me.next,Me.prev=me,me.next.prev=Me,me.next=Me):(Me.prev=Me,Me.next=Me),Me}function Ue(ae){ae.next.prev=ae.prev,ae.prev.next=ae.next,ae.prevZ&&(ae.prevZ.nextZ=ae.nextZ),ae.nextZ&&(ae.nextZ.prevZ=ae.prevZ)}function St(ae,Te,oe){this.i=ae,this.x=Te,this.y=oe,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}O.deviation=function(ae,Te,oe,me){var Me=Te&&Te.length,qe=Me?Te[0]*oe:ae.length,yt=Math.abs(ur(ae,0,qe,oe));if(Me)for(var Qt=0,Or=Te.length;Qt<Or;Qt++){var Dr=Te[Qt]*oe,on=Qt<Or-1?Te[Qt+1]*oe:ae.length;yt-=Math.abs(ur(ae,Dr,on,oe))}var tr=0;for(Qt=0;Qt<me.length;Qt+=3){var se=me[Qt]*oe,be=me[Qt+1]*oe,Fe=me[Qt+2]*oe;tr+=Math.abs((ae[se]-ae[Fe])*(ae[be+1]-ae[se+1])-(ae[se]-ae[be])*(ae[Fe+1]-ae[se+1]))}return yt===0&&tr===0?0:Math.abs((tr-yt)/yt)};function ur(ae,Te,oe,me){for(var Me=0,qe=Te,yt=oe-me;qe<oe;qe+=me)Me+=(ae[yt]-ae[qe])*(ae[qe+1]+ae[yt+1]),yt=qe;return Me}O.flatten=function(ae){for(var Te=ae[0][0].length,oe={vertices:[],holes:[],dimensions:Te},me=0,Me=0;Me<ae.length;Me++){for(var qe=0;qe<ae[Me].length;qe++)for(var yt=0;yt<Te;yt++)oe.vertices.push(ae[Me][qe][yt]);Me>0&&(me+=ae[Me-1].length,oe.holes.push(me))}return oe}},67709:function(ar){function O(Q){var E=Q.target||Q.srcElement;E.__resizeRAF__&&cancelAnimationFrame(E.__resizeRAF__),E.__resizeRAF__=requestAnimationFrame(function(){var p=E.__resizeTrigger__,b=p&&p.__resizeListeners__;b&&b.forEach(function(X){X.call(p,Q)})})}var _=function(E,p){var b=this,X=b.document,W,$=X.attachEvent;typeof navigator!="undefined"&&(W=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function I(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",O)}if(!E.__resizeListeners__)if(E.__resizeListeners__=[],$)E.__resizeTrigger__=E,E.attachEvent("onresize",O);else{getComputedStyle(E).position==="static"&&(E.style.position="relative");var k=E.__resizeTrigger__=X.createElement("object");k.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),k.setAttribute("class","resize-sensor"),k.setAttribute("tabindex","-1"),k.setAttribute("title",""),k.__resizeElement__=E,k.onload=I,k.type="text/html",W&&E.appendChild(k),k.data="about:blank",W||E.appendChild(k)}E.__resizeListeners__.push(p)};ar.exports=typeof window=="undefined"?_:_.bind(window),ar.exports.unbind=function(Q,E){var p=document.attachEvent,b=Q.__resizeListeners__||[];if(E){var X=b.indexOf(E);X!==-1&&b.splice(X,1)}else b=Q.__resizeListeners__=[];if(!b.length){if(p)Q.detachEvent("onresize",O);else if(Q.__resizeTrigger__){var W=Q.__resizeTrigger__.contentDocument,$=W&&W.defaultView;$&&($.removeEventListener("resize",O),delete $.__resizeTrigger__),Q.__resizeTrigger__=!Q.removeChild(Q.__resizeTrigger__)}delete Q.__resizeListeners__}}},26729:function(ar){"use strict";var O=Object.prototype.hasOwnProperty,_="~";function Q(){}Object.create&&(Q.prototype=Object.create(null),new Q().__proto__||(_=!1));function E(W,$,I){this.fn=W,this.context=$,this.once=I||!1}function p(W,$,I,k,Ce){if(typeof I!="function")throw new TypeError("The listener must be a function");var Be=new E(I,k||W,Ce),We=_?_+$:$;return W._events[We]?W._events[We].fn?W._events[We]=[W._events[We],Be]:W._events[We].push(Be):(W._events[We]=Be,W._eventsCount++),W}function b(W,$){--W._eventsCount==0?W._events=new Q:delete W._events[$]}function X(){this._events=new Q,this._eventsCount=0}X.prototype.eventNames=function(){var $=[],I,k;if(this._eventsCount===0)return $;for(k in I=this._events)O.call(I,k)&&$.push(_?k.slice(1):k);return Object.getOwnPropertySymbols?$.concat(Object.getOwnPropertySymbols(I)):$},X.prototype.listeners=function($){var I=_?_+$:$,k=this._events[I];if(!k)return[];if(k.fn)return[k.fn];for(var Ce=0,Be=k.length,We=new Array(Be);Ce<Be;Ce++)We[Ce]=k[Ce].fn;return We},X.prototype.listenerCount=function($){var I=_?_+$:$,k=this._events[I];return k?k.fn?1:k.length:0},X.prototype.emit=function($,I,k,Ce,Be,We){var $e=_?_+$:$;if(!this._events[$e])return!1;var Vt=this._events[$e],Ht=arguments.length,At,Ot;if(Vt.fn){switch(Vt.once&&this.removeListener($,Vt.fn,void 0,!0),Ht){case 1:return Vt.fn.call(Vt.context),!0;case 2:return Vt.fn.call(Vt.context,I),!0;case 3:return Vt.fn.call(Vt.context,I,k),!0;case 4:return Vt.fn.call(Vt.context,I,k,Ce),!0;case 5:return Vt.fn.call(Vt.context,I,k,Ce,Be),!0;case 6:return Vt.fn.call(Vt.context,I,k,Ce,Be,We),!0}for(Ot=1,At=new Array(Ht-1);Ot<Ht;Ot++)At[Ot-1]=arguments[Ot];Vt.fn.apply(Vt.context,At)}else{var bt=Vt.length,dt;for(Ot=0;Ot<bt;Ot++)switch(Vt[Ot].once&&this.removeListener($,Vt[Ot].fn,void 0,!0),Ht){case 1:Vt[Ot].fn.call(Vt[Ot].context);break;case 2:Vt[Ot].fn.call(Vt[Ot].context,I);break;case 3:Vt[Ot].fn.call(Vt[Ot].context,I,k);break;case 4:Vt[Ot].fn.call(Vt[Ot].context,I,k,Ce);break;default:if(!At)for(dt=1,At=new Array(Ht-1);dt<Ht;dt++)At[dt-1]=arguments[dt];Vt[Ot].fn.apply(Vt[Ot].context,At)}}return!0},X.prototype.on=function($,I,k){return p(this,$,I,k,!1)},X.prototype.once=function($,I,k){return p(this,$,I,k,!0)},X.prototype.removeListener=function($,I,k,Ce){var Be=_?_+$:$;if(!this._events[Be])return this;if(!I)return b(this,Be),this;var We=this._events[Be];if(We.fn)We.fn===I&&(!Ce||We.once)&&(!k||We.context===k)&&b(this,Be);else{for(var $e=0,Vt=[],Ht=We.length;$e<Ht;$e++)(We[$e].fn!==I||Ce&&!We[$e].once||k&&We[$e].context!==k)&&Vt.push(We[$e]);Vt.length?this._events[Be]=Vt.length===1?Vt[0]:Vt:b(this,Be)}return this},X.prototype.removeAllListeners=function($){var I;return $?(I=_?_+$:$,this._events[I]&&b(this,I)):(this._events=new Q,this._eventsCount=0),this},X.prototype.off=X.prototype.removeListener,X.prototype.addListener=X.prototype.on,X.prefixed=_,X.EventEmitter=X,ar.exports=X},85975:function(ar,O,_){"use strict";_.r(O),_.d(O,{create:function(){return E},clone:function(){return p},copy:function(){return b},fromValues:function(){return X},set:function(){return W},identity:function(){return $},transpose:function(){return I},invert:function(){return k},adjoint:function(){return Ce},determinant:function(){return Be},multiply:function(){return We},translate:function(){return $e},scale:function(){return Vt},rotate:function(){return Ht},rotateX:function(){return At},rotateY:function(){return Ot},rotateZ:function(){return bt},fromTranslation:function(){return dt},fromScaling:function(){return Pr},fromRotation:function(){return er},fromXRotation:function(){return Ft},fromYRotation:function(){return tt},fromZRotation:function(){return Ne},fromRotationTranslation:function(){return Qe},fromQuat2:function(){return Ie},getTranslation:function(){return Ae},getScaling:function(){return Ue},getRotation:function(){return St},fromRotationTranslationScale:function(){return ur},fromRotationTranslationScaleOrigin:function(){return ae},fromQuat:function(){return Te},frustum:function(){return oe},perspective:function(){return me},perspectiveFromFieldOfView:function(){return Me},ortho:function(){return qe},lookAt:function(){return yt},targetTo:function(){return Qt},str:function(){return Or},frob:function(){return Dr},add:function(){return on},subtract:function(){return tr},multiplyScalar:function(){return se},multiplyScalarAndAdd:function(){return be},exactEquals:function(){return Fe},equals:function(){return Ee},mul:function(){return wt},sub:function(){return Bt}});var Q=_(49685);function E(){var w=new Q.WT(16);return Q.WT!=Float32Array&&(w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=0,w[12]=0,w[13]=0,w[14]=0),w[0]=1,w[5]=1,w[10]=1,w[15]=1,w}function p(w){var N=new Q.WT(16);return N[0]=w[0],N[1]=w[1],N[2]=w[2],N[3]=w[3],N[4]=w[4],N[5]=w[5],N[6]=w[6],N[7]=w[7],N[8]=w[8],N[9]=w[9],N[10]=w[10],N[11]=w[11],N[12]=w[12],N[13]=w[13],N[14]=w[14],N[15]=w[15],N}function b(w,N){return w[0]=N[0],w[1]=N[1],w[2]=N[2],w[3]=N[3],w[4]=N[4],w[5]=N[5],w[6]=N[6],w[7]=N[7],w[8]=N[8],w[9]=N[9],w[10]=N[10],w[11]=N[11],w[12]=N[12],w[13]=N[13],w[14]=N[14],w[15]=N[15],w}function X(w,N,he,je,et,_t,Ct,V,Yt,kt,fr,Cr,Tr,Ar,Je,xt){var ht=new Q.WT(16);return ht[0]=w,ht[1]=N,ht[2]=he,ht[3]=je,ht[4]=et,ht[5]=_t,ht[6]=Ct,ht[7]=V,ht[8]=Yt,ht[9]=kt,ht[10]=fr,ht[11]=Cr,ht[12]=Tr,ht[13]=Ar,ht[14]=Je,ht[15]=xt,ht}function W(w,N,he,je,et,_t,Ct,V,Yt,kt,fr,Cr,Tr,Ar,Je,xt,ht){return w[0]=N,w[1]=he,w[2]=je,w[3]=et,w[4]=_t,w[5]=Ct,w[6]=V,w[7]=Yt,w[8]=kt,w[9]=fr,w[10]=Cr,w[11]=Tr,w[12]=Ar,w[13]=Je,w[14]=xt,w[15]=ht,w}function $(w){return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function I(w,N){if(w===N){var he=N[1],je=N[2],et=N[3],_t=N[6],Ct=N[7],V=N[11];w[1]=N[4],w[2]=N[8],w[3]=N[12],w[4]=he,w[6]=N[9],w[7]=N[13],w[8]=je,w[9]=_t,w[11]=N[14],w[12]=et,w[13]=Ct,w[14]=V}else w[0]=N[0],w[1]=N[4],w[2]=N[8],w[3]=N[12],w[4]=N[1],w[5]=N[5],w[6]=N[9],w[7]=N[13],w[8]=N[2],w[9]=N[6],w[10]=N[10],w[11]=N[14],w[12]=N[3],w[13]=N[7],w[14]=N[11],w[15]=N[15];return w}function k(w,N){var he=N[0],je=N[1],et=N[2],_t=N[3],Ct=N[4],V=N[5],Yt=N[6],kt=N[7],fr=N[8],Cr=N[9],Tr=N[10],Ar=N[11],Je=N[12],xt=N[13],ht=N[14],lr=N[15],Kr=he*V-je*Ct,lt=he*Yt-et*Ct,Lt=he*kt-_t*Ct,Jt=je*Yt-et*V,or=je*kt-_t*V,cn=et*kt-_t*Yt,Pn=fr*xt-Cr*Je,bi=fr*ht-Tr*Je,Si=fr*lr-Ar*Je,Ri=Cr*ht-Tr*xt,ia=Cr*lr-Ar*xt,pi=Tr*lr-Ar*ht,H=Kr*pi-lt*ia+Lt*Ri+Jt*Si-or*bi+cn*Pn;return H?(H=1/H,w[0]=(V*pi-Yt*ia+kt*Ri)*H,w[1]=(et*ia-je*pi-_t*Ri)*H,w[2]=(xt*cn-ht*or+lr*Jt)*H,w[3]=(Tr*or-Cr*cn-Ar*Jt)*H,w[4]=(Yt*Si-Ct*pi-kt*bi)*H,w[5]=(he*pi-et*Si+_t*bi)*H,w[6]=(ht*Lt-Je*cn-lr*lt)*H,w[7]=(fr*cn-Tr*Lt+Ar*lt)*H,w[8]=(Ct*ia-V*Si+kt*Pn)*H,w[9]=(je*Si-he*ia-_t*Pn)*H,w[10]=(Je*or-xt*Lt+lr*Kr)*H,w[11]=(Cr*Lt-fr*or-Ar*Kr)*H,w[12]=(V*bi-Ct*Ri-Yt*Pn)*H,w[13]=(he*Ri-je*bi+et*Pn)*H,w[14]=(xt*lt-Je*Jt-ht*Kr)*H,w[15]=(fr*Jt-Cr*lt+Tr*Kr)*H,w):null}function Ce(w,N){var he=N[0],je=N[1],et=N[2],_t=N[3],Ct=N[4],V=N[5],Yt=N[6],kt=N[7],fr=N[8],Cr=N[9],Tr=N[10],Ar=N[11],Je=N[12],xt=N[13],ht=N[14],lr=N[15];return w[0]=V*(Tr*lr-Ar*ht)-Cr*(Yt*lr-kt*ht)+xt*(Yt*Ar-kt*Tr),w[1]=-(je*(Tr*lr-Ar*ht)-Cr*(et*lr-_t*ht)+xt*(et*Ar-_t*Tr)),w[2]=je*(Yt*lr-kt*ht)-V*(et*lr-_t*ht)+xt*(et*kt-_t*Yt),w[3]=-(je*(Yt*Ar-kt*Tr)-V*(et*Ar-_t*Tr)+Cr*(et*kt-_t*Yt)),w[4]=-(Ct*(Tr*lr-Ar*ht)-fr*(Yt*lr-kt*ht)+Je*(Yt*Ar-kt*Tr)),w[5]=he*(Tr*lr-Ar*ht)-fr*(et*lr-_t*ht)+Je*(et*Ar-_t*Tr),w[6]=-(he*(Yt*lr-kt*ht)-Ct*(et*lr-_t*ht)+Je*(et*kt-_t*Yt)),w[7]=he*(Yt*Ar-kt*Tr)-Ct*(et*Ar-_t*Tr)+fr*(et*kt-_t*Yt),w[8]=Ct*(Cr*lr-Ar*xt)-fr*(V*lr-kt*xt)+Je*(V*Ar-kt*Cr),w[9]=-(he*(Cr*lr-Ar*xt)-fr*(je*lr-_t*xt)+Je*(je*Ar-_t*Cr)),w[10]=he*(V*lr-kt*xt)-Ct*(je*lr-_t*xt)+Je*(je*kt-_t*V),w[11]=-(he*(V*Ar-kt*Cr)-Ct*(je*Ar-_t*Cr)+fr*(je*kt-_t*V)),w[12]=-(Ct*(Cr*ht-Tr*xt)-fr*(V*ht-Yt*xt)+Je*(V*Tr-Yt*Cr)),w[13]=he*(Cr*ht-Tr*xt)-fr*(je*ht-et*xt)+Je*(je*Tr-et*Cr),w[14]=-(he*(V*ht-Yt*xt)-Ct*(je*ht-et*xt)+Je*(je*Yt-et*V)),w[15]=he*(V*Tr-Yt*Cr)-Ct*(je*Tr-et*Cr)+fr*(je*Yt-et*V),w}function Be(w){var N=w[0],he=w[1],je=w[2],et=w[3],_t=w[4],Ct=w[5],V=w[6],Yt=w[7],kt=w[8],fr=w[9],Cr=w[10],Tr=w[11],Ar=w[12],Je=w[13],xt=w[14],ht=w[15],lr=N*Ct-he*_t,Kr=N*V-je*_t,lt=N*Yt-et*_t,Lt=he*V-je*Ct,Jt=he*Yt-et*Ct,or=je*Yt-et*V,cn=kt*Je-fr*Ar,Pn=kt*xt-Cr*Ar,bi=kt*ht-Tr*Ar,Si=fr*xt-Cr*Je,Ri=fr*ht-Tr*Je,ia=Cr*ht-Tr*xt;return lr*ia-Kr*Ri+lt*Si+Lt*bi-Jt*Pn+or*cn}function We(w,N,he){var je=N[0],et=N[1],_t=N[2],Ct=N[3],V=N[4],Yt=N[5],kt=N[6],fr=N[7],Cr=N[8],Tr=N[9],Ar=N[10],Je=N[11],xt=N[12],ht=N[13],lr=N[14],Kr=N[15],lt=he[0],Lt=he[1],Jt=he[2],or=he[3];return w[0]=lt*je+Lt*V+Jt*Cr+or*xt,w[1]=lt*et+Lt*Yt+Jt*Tr+or*ht,w[2]=lt*_t+Lt*kt+Jt*Ar+or*lr,w[3]=lt*Ct+Lt*fr+Jt*Je+or*Kr,lt=he[4],Lt=he[5],Jt=he[6],or=he[7],w[4]=lt*je+Lt*V+Jt*Cr+or*xt,w[5]=lt*et+Lt*Yt+Jt*Tr+or*ht,w[6]=lt*_t+Lt*kt+Jt*Ar+or*lr,w[7]=lt*Ct+Lt*fr+Jt*Je+or*Kr,lt=he[8],Lt=he[9],Jt=he[10],or=he[11],w[8]=lt*je+Lt*V+Jt*Cr+or*xt,w[9]=lt*et+Lt*Yt+Jt*Tr+or*ht,w[10]=lt*_t+Lt*kt+Jt*Ar+or*lr,w[11]=lt*Ct+Lt*fr+Jt*Je+or*Kr,lt=he[12],Lt=he[13],Jt=he[14],or=he[15],w[12]=lt*je+Lt*V+Jt*Cr+or*xt,w[13]=lt*et+Lt*Yt+Jt*Tr+or*ht,w[14]=lt*_t+Lt*kt+Jt*Ar+or*lr,w[15]=lt*Ct+Lt*fr+Jt*Je+or*Kr,w}function $e(w,N,he){var je=he[0],et=he[1],_t=he[2],Ct,V,Yt,kt,fr,Cr,Tr,Ar,Je,xt,ht,lr;return N===w?(w[12]=N[0]*je+N[4]*et+N[8]*_t+N[12],w[13]=N[1]*je+N[5]*et+N[9]*_t+N[13],w[14]=N[2]*je+N[6]*et+N[10]*_t+N[14],w[15]=N[3]*je+N[7]*et+N[11]*_t+N[15]):(Ct=N[0],V=N[1],Yt=N[2],kt=N[3],fr=N[4],Cr=N[5],Tr=N[6],Ar=N[7],Je=N[8],xt=N[9],ht=N[10],lr=N[11],w[0]=Ct,w[1]=V,w[2]=Yt,w[3]=kt,w[4]=fr,w[5]=Cr,w[6]=Tr,w[7]=Ar,w[8]=Je,w[9]=xt,w[10]=ht,w[11]=lr,w[12]=Ct*je+fr*et+Je*_t+N[12],w[13]=V*je+Cr*et+xt*_t+N[13],w[14]=Yt*je+Tr*et+ht*_t+N[14],w[15]=kt*je+Ar*et+lr*_t+N[15]),w}function Vt(w,N,he){var je=he[0],et=he[1],_t=he[2];return w[0]=N[0]*je,w[1]=N[1]*je,w[2]=N[2]*je,w[3]=N[3]*je,w[4]=N[4]*et,w[5]=N[5]*et,w[6]=N[6]*et,w[7]=N[7]*et,w[8]=N[8]*_t,w[9]=N[9]*_t,w[10]=N[10]*_t,w[11]=N[11]*_t,w[12]=N[12],w[13]=N[13],w[14]=N[14],w[15]=N[15],w}function Ht(w,N,he,je){var et=je[0],_t=je[1],Ct=je[2],V=Math.hypot(et,_t,Ct),Yt,kt,fr,Cr,Tr,Ar,Je,xt,ht,lr,Kr,lt,Lt,Jt,or,cn,Pn,bi,Si,Ri,ia,pi,H,ie;return V<Q.Ib?null:(V=1/V,et*=V,_t*=V,Ct*=V,Yt=Math.sin(he),kt=Math.cos(he),fr=1-kt,Cr=N[0],Tr=N[1],Ar=N[2],Je=N[3],xt=N[4],ht=N[5],lr=N[6],Kr=N[7],lt=N[8],Lt=N[9],Jt=N[10],or=N[11],cn=et*et*fr+kt,Pn=_t*et*fr+Ct*Yt,bi=Ct*et*fr-_t*Yt,Si=et*_t*fr-Ct*Yt,Ri=_t*_t*fr+kt,ia=Ct*_t*fr+et*Yt,pi=et*Ct*fr+_t*Yt,H=_t*Ct*fr-et*Yt,ie=Ct*Ct*fr+kt,w[0]=Cr*cn+xt*Pn+lt*bi,w[1]=Tr*cn+ht*Pn+Lt*bi,w[2]=Ar*cn+lr*Pn+Jt*bi,w[3]=Je*cn+Kr*Pn+or*bi,w[4]=Cr*Si+xt*Ri+lt*ia,w[5]=Tr*Si+ht*Ri+Lt*ia,w[6]=Ar*Si+lr*Ri+Jt*ia,w[7]=Je*Si+Kr*Ri+or*ia,w[8]=Cr*pi+xt*H+lt*ie,w[9]=Tr*pi+ht*H+Lt*ie,w[10]=Ar*pi+lr*H+Jt*ie,w[11]=Je*pi+Kr*H+or*ie,N!==w&&(w[12]=N[12],w[13]=N[13],w[14]=N[14],w[15]=N[15]),w)}function At(w,N,he){var je=Math.sin(he),et=Math.cos(he),_t=N[4],Ct=N[5],V=N[6],Yt=N[7],kt=N[8],fr=N[9],Cr=N[10],Tr=N[11];return N!==w&&(w[0]=N[0],w[1]=N[1],w[2]=N[2],w[3]=N[3],w[12]=N[12],w[13]=N[13],w[14]=N[14],w[15]=N[15]),w[4]=_t*et+kt*je,w[5]=Ct*et+fr*je,w[6]=V*et+Cr*je,w[7]=Yt*et+Tr*je,w[8]=kt*et-_t*je,w[9]=fr*et-Ct*je,w[10]=Cr*et-V*je,w[11]=Tr*et-Yt*je,w}function Ot(w,N,he){var je=Math.sin(he),et=Math.cos(he),_t=N[0],Ct=N[1],V=N[2],Yt=N[3],kt=N[8],fr=N[9],Cr=N[10],Tr=N[11];return N!==w&&(w[4]=N[4],w[5]=N[5],w[6]=N[6],w[7]=N[7],w[12]=N[12],w[13]=N[13],w[14]=N[14],w[15]=N[15]),w[0]=_t*et-kt*je,w[1]=Ct*et-fr*je,w[2]=V*et-Cr*je,w[3]=Yt*et-Tr*je,w[8]=_t*je+kt*et,w[9]=Ct*je+fr*et,w[10]=V*je+Cr*et,w[11]=Yt*je+Tr*et,w}function bt(w,N,he){var je=Math.sin(he),et=Math.cos(he),_t=N[0],Ct=N[1],V=N[2],Yt=N[3],kt=N[4],fr=N[5],Cr=N[6],Tr=N[7];return N!==w&&(w[8]=N[8],w[9]=N[9],w[10]=N[10],w[11]=N[11],w[12]=N[12],w[13]=N[13],w[14]=N[14],w[15]=N[15]),w[0]=_t*et+kt*je,w[1]=Ct*et+fr*je,w[2]=V*et+Cr*je,w[3]=Yt*et+Tr*je,w[4]=kt*et-_t*je,w[5]=fr*et-Ct*je,w[6]=Cr*et-V*je,w[7]=Tr*et-Yt*je,w}function dt(w,N){return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=N[0],w[13]=N[1],w[14]=N[2],w[15]=1,w}function Pr(w,N){return w[0]=N[0],w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=N[1],w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=N[2],w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function er(w,N,he){var je=he[0],et=he[1],_t=he[2],Ct=Math.hypot(je,et,_t),V,Yt,kt;return Ct<Q.Ib?null:(Ct=1/Ct,je*=Ct,et*=Ct,_t*=Ct,V=Math.sin(N),Yt=Math.cos(N),kt=1-Yt,w[0]=je*je*kt+Yt,w[1]=et*je*kt+_t*V,w[2]=_t*je*kt-et*V,w[3]=0,w[4]=je*et*kt-_t*V,w[5]=et*et*kt+Yt,w[6]=_t*et*kt+je*V,w[7]=0,w[8]=je*_t*kt+et*V,w[9]=et*_t*kt-je*V,w[10]=_t*_t*kt+Yt,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w)}function Ft(w,N){var he=Math.sin(N),je=Math.cos(N);return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=je,w[6]=he,w[7]=0,w[8]=0,w[9]=-he,w[10]=je,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function tt(w,N){var he=Math.sin(N),je=Math.cos(N);return w[0]=je,w[1]=0,w[2]=-he,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=he,w[9]=0,w[10]=je,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function Ne(w,N){var he=Math.sin(N),je=Math.cos(N);return w[0]=je,w[1]=he,w[2]=0,w[3]=0,w[4]=-he,w[5]=je,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function Qe(w,N,he){var je=N[0],et=N[1],_t=N[2],Ct=N[3],V=je+je,Yt=et+et,kt=_t+_t,fr=je*V,Cr=je*Yt,Tr=je*kt,Ar=et*Yt,Je=et*kt,xt=_t*kt,ht=Ct*V,lr=Ct*Yt,Kr=Ct*kt;return w[0]=1-(Ar+xt),w[1]=Cr+Kr,w[2]=Tr-lr,w[3]=0,w[4]=Cr-Kr,w[5]=1-(fr+xt),w[6]=Je+ht,w[7]=0,w[8]=Tr+lr,w[9]=Je-ht,w[10]=1-(fr+Ar),w[11]=0,w[12]=he[0],w[13]=he[1],w[14]=he[2],w[15]=1,w}function Ie(w,N){var he=new Q.WT(3),je=-N[0],et=-N[1],_t=-N[2],Ct=N[3],V=N[4],Yt=N[5],kt=N[6],fr=N[7],Cr=je*je+et*et+_t*_t+Ct*Ct;return Cr>0?(he[0]=(V*Ct+fr*je+Yt*_t-kt*et)*2/Cr,he[1]=(Yt*Ct+fr*et+kt*je-V*_t)*2/Cr,he[2]=(kt*Ct+fr*_t+V*et-Yt*je)*2/Cr):(he[0]=(V*Ct+fr*je+Yt*_t-kt*et)*2,he[1]=(Yt*Ct+fr*et+kt*je-V*_t)*2,he[2]=(kt*Ct+fr*_t+V*et-Yt*je)*2),Qe(w,N,he),w}function Ae(w,N){return w[0]=N[12],w[1]=N[13],w[2]=N[14],w}function Ue(w,N){var he=N[0],je=N[1],et=N[2],_t=N[4],Ct=N[5],V=N[6],Yt=N[8],kt=N[9],fr=N[10];return w[0]=Math.hypot(he,je,et),w[1]=Math.hypot(_t,Ct,V),w[2]=Math.hypot(Yt,kt,fr),w}function St(w,N){var he=new Q.WT(3);Ue(he,N);var je=1/he[0],et=1/he[1],_t=1/he[2],Ct=N[0]*je,V=N[1]*et,Yt=N[2]*_t,kt=N[4]*je,fr=N[5]*et,Cr=N[6]*_t,Tr=N[8]*je,Ar=N[9]*et,Je=N[10]*_t,xt=Ct+fr+Je,ht=0;return xt>0?(ht=Math.sqrt(xt+1)*2,w[3]=.25*ht,w[0]=(Cr-Ar)/ht,w[1]=(Tr-Yt)/ht,w[2]=(V-kt)/ht):Ct>fr&&Ct>Je?(ht=Math.sqrt(1+Ct-fr-Je)*2,w[3]=(Cr-Ar)/ht,w[0]=.25*ht,w[1]=(V+kt)/ht,w[2]=(Tr+Yt)/ht):fr>Je?(ht=Math.sqrt(1+fr-Ct-Je)*2,w[3]=(Tr-Yt)/ht,w[0]=(V+kt)/ht,w[1]=.25*ht,w[2]=(Cr+Ar)/ht):(ht=Math.sqrt(1+Je-Ct-fr)*2,w[3]=(V-kt)/ht,w[0]=(Tr+Yt)/ht,w[1]=(Cr+Ar)/ht,w[2]=.25*ht),w}function ur(w,N,he,je){var et=N[0],_t=N[1],Ct=N[2],V=N[3],Yt=et+et,kt=_t+_t,fr=Ct+Ct,Cr=et*Yt,Tr=et*kt,Ar=et*fr,Je=_t*kt,xt=_t*fr,ht=Ct*fr,lr=V*Yt,Kr=V*kt,lt=V*fr,Lt=je[0],Jt=je[1],or=je[2];return w[0]=(1-(Je+ht))*Lt,w[1]=(Tr+lt)*Lt,w[2]=(Ar-Kr)*Lt,w[3]=0,w[4]=(Tr-lt)*Jt,w[5]=(1-(Cr+ht))*Jt,w[6]=(xt+lr)*Jt,w[7]=0,w[8]=(Ar+Kr)*or,w[9]=(xt-lr)*or,w[10]=(1-(Cr+Je))*or,w[11]=0,w[12]=he[0],w[13]=he[1],w[14]=he[2],w[15]=1,w}function ae(w,N,he,je,et){var _t=N[0],Ct=N[1],V=N[2],Yt=N[3],kt=_t+_t,fr=Ct+Ct,Cr=V+V,Tr=_t*kt,Ar=_t*fr,Je=_t*Cr,xt=Ct*fr,ht=Ct*Cr,lr=V*Cr,Kr=Yt*kt,lt=Yt*fr,Lt=Yt*Cr,Jt=je[0],or=je[1],cn=je[2],Pn=et[0],bi=et[1],Si=et[2],Ri=(1-(xt+lr))*Jt,ia=(Ar+Lt)*Jt,pi=(Je-lt)*Jt,H=(Ar-Lt)*or,ie=(1-(Tr+lr))*or,ce=(ht+Kr)*or,B=(Je+lt)*cn,re=(ht-Kr)*cn,fe=(1-(Tr+xt))*cn;return w[0]=Ri,w[1]=ia,w[2]=pi,w[3]=0,w[4]=H,w[5]=ie,w[6]=ce,w[7]=0,w[8]=B,w[9]=re,w[10]=fe,w[11]=0,w[12]=he[0]+Pn-(Ri*Pn+H*bi+B*Si),w[13]=he[1]+bi-(ia*Pn+ie*bi+re*Si),w[14]=he[2]+Si-(pi*Pn+ce*bi+fe*Si),w[15]=1,w}function Te(w,N){var he=N[0],je=N[1],et=N[2],_t=N[3],Ct=he+he,V=je+je,Yt=et+et,kt=he*Ct,fr=je*Ct,Cr=je*V,Tr=et*Ct,Ar=et*V,Je=et*Yt,xt=_t*Ct,ht=_t*V,lr=_t*Yt;return w[0]=1-Cr-Je,w[1]=fr+lr,w[2]=Tr-ht,w[3]=0,w[4]=fr-lr,w[5]=1-kt-Je,w[6]=Ar+xt,w[7]=0,w[8]=Tr+ht,w[9]=Ar-xt,w[10]=1-kt-Cr,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function oe(w,N,he,je,et,_t,Ct){var V=1/(he-N),Yt=1/(et-je),kt=1/(_t-Ct);return w[0]=_t*2*V,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=_t*2*Yt,w[6]=0,w[7]=0,w[8]=(he+N)*V,w[9]=(et+je)*Yt,w[10]=(Ct+_t)*kt,w[11]=-1,w[12]=0,w[13]=0,w[14]=Ct*_t*2*kt,w[15]=0,w}function me(w,N,he,je,et){var _t=1/Math.tan(N/2),Ct;return w[0]=_t/he,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=_t,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=-1,w[12]=0,w[13]=0,w[15]=0,et!=null&&et!==Infinity?(Ct=1/(je-et),w[10]=(et+je)*Ct,w[14]=2*et*je*Ct):(w[10]=-1,w[14]=-2*je),w}function Me(w,N,he,je){var et=Math.tan(N.upDegrees*Math.PI/180),_t=Math.tan(N.downDegrees*Math.PI/180),Ct=Math.tan(N.leftDegrees*Math.PI/180),V=Math.tan(N.rightDegrees*Math.PI/180),Yt=2/(Ct+V),kt=2/(et+_t);return w[0]=Yt,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=kt,w[6]=0,w[7]=0,w[8]=-((Ct-V)*Yt*.5),w[9]=(et-_t)*kt*.5,w[10]=je/(he-je),w[11]=-1,w[12]=0,w[13]=0,w[14]=je*he/(he-je),w[15]=0,w}function qe(w,N,he,je,et,_t,Ct){var V=1/(N-he),Yt=1/(je-et),kt=1/(_t-Ct);return w[0]=-2*V,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=-2*Yt,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=2*kt,w[11]=0,w[12]=(N+he)*V,w[13]=(et+je)*Yt,w[14]=(Ct+_t)*kt,w[15]=1,w}function yt(w,N,he,je){var et,_t,Ct,V,Yt,kt,fr,Cr,Tr,Ar,Je=N[0],xt=N[1],ht=N[2],lr=je[0],Kr=je[1],lt=je[2],Lt=he[0],Jt=he[1],or=he[2];return Math.abs(Je-Lt)<Q.Ib&&Math.abs(xt-Jt)<Q.Ib&&Math.abs(ht-or)<Q.Ib?$(w):(fr=Je-Lt,Cr=xt-Jt,Tr=ht-or,Ar=1/Math.hypot(fr,Cr,Tr),fr*=Ar,Cr*=Ar,Tr*=Ar,et=Kr*Tr-lt*Cr,_t=lt*fr-lr*Tr,Ct=lr*Cr-Kr*fr,Ar=Math.hypot(et,_t,Ct),Ar?(Ar=1/Ar,et*=Ar,_t*=Ar,Ct*=Ar):(et=0,_t=0,Ct=0),V=Cr*Ct-Tr*_t,Yt=Tr*et-fr*Ct,kt=fr*_t-Cr*et,Ar=Math.hypot(V,Yt,kt),Ar?(Ar=1/Ar,V*=Ar,Yt*=Ar,kt*=Ar):(V=0,Yt=0,kt=0),w[0]=et,w[1]=V,w[2]=fr,w[3]=0,w[4]=_t,w[5]=Yt,w[6]=Cr,w[7]=0,w[8]=Ct,w[9]=kt,w[10]=Tr,w[11]=0,w[12]=-(et*Je+_t*xt+Ct*ht),w[13]=-(V*Je+Yt*xt+kt*ht),w[14]=-(fr*Je+Cr*xt+Tr*ht),w[15]=1,w)}function Qt(w,N,he,je){var et=N[0],_t=N[1],Ct=N[2],V=je[0],Yt=je[1],kt=je[2],fr=et-he[0],Cr=_t-he[1],Tr=Ct-he[2],Ar=fr*fr+Cr*Cr+Tr*Tr;Ar>0&&(Ar=1/Math.sqrt(Ar),fr*=Ar,Cr*=Ar,Tr*=Ar);var Je=Yt*Tr-kt*Cr,xt=kt*fr-V*Tr,ht=V*Cr-Yt*fr;return Ar=Je*Je+xt*xt+ht*ht,Ar>0&&(Ar=1/Math.sqrt(Ar),Je*=Ar,xt*=Ar,ht*=Ar),w[0]=Je,w[1]=xt,w[2]=ht,w[3]=0,w[4]=Cr*ht-Tr*xt,w[5]=Tr*Je-fr*ht,w[6]=fr*xt-Cr*Je,w[7]=0,w[8]=fr,w[9]=Cr,w[10]=Tr,w[11]=0,w[12]=et,w[13]=_t,w[14]=Ct,w[15]=1,w}function Or(w){return"mat4("+w[0]+", "+w[1]+", "+w[2]+", "+w[3]+", "+w[4]+", "+w[5]+", "+w[6]+", "+w[7]+", "+w[8]+", "+w[9]+", "+w[10]+", "+w[11]+", "+w[12]+", "+w[13]+", "+w[14]+", "+w[15]+")"}function Dr(w){return Math.hypot(w[0],w[1],w[2],w[3],w[4],w[5],w[6],w[7],w[8],w[9],w[10],w[11],w[12],w[13],w[14],w[15])}function on(w,N,he){return w[0]=N[0]+he[0],w[1]=N[1]+he[1],w[2]=N[2]+he[2],w[3]=N[3]+he[3],w[4]=N[4]+he[4],w[5]=N[5]+he[5],w[6]=N[6]+he[6],w[7]=N[7]+he[7],w[8]=N[8]+he[8],w[9]=N[9]+he[9],w[10]=N[10]+he[10],w[11]=N[11]+he[11],w[12]=N[12]+he[12],w[13]=N[13]+he[13],w[14]=N[14]+he[14],w[15]=N[15]+he[15],w}function tr(w,N,he){return w[0]=N[0]-he[0],w[1]=N[1]-he[1],w[2]=N[2]-he[2],w[3]=N[3]-he[3],w[4]=N[4]-he[4],w[5]=N[5]-he[5],w[6]=N[6]-he[6],w[7]=N[7]-he[7],w[8]=N[8]-he[8],w[9]=N[9]-he[9],w[10]=N[10]-he[10],w[11]=N[11]-he[11],w[12]=N[12]-he[12],w[13]=N[13]-he[13],w[14]=N[14]-he[14],w[15]=N[15]-he[15],w}function se(w,N,he){return w[0]=N[0]*he,w[1]=N[1]*he,w[2]=N[2]*he,w[3]=N[3]*he,w[4]=N[4]*he,w[5]=N[5]*he,w[6]=N[6]*he,w[7]=N[7]*he,w[8]=N[8]*he,w[9]=N[9]*he,w[10]=N[10]*he,w[11]=N[11]*he,w[12]=N[12]*he,w[13]=N[13]*he,w[14]=N[14]*he,w[15]=N[15]*he,w}function be(w,N,he,je){return w[0]=N[0]+he[0]*je,w[1]=N[1]+he[1]*je,w[2]=N[2]+he[2]*je,w[3]=N[3]+he[3]*je,w[4]=N[4]+he[4]*je,w[5]=N[5]+he[5]*je,w[6]=N[6]+he[6]*je,w[7]=N[7]+he[7]*je,w[8]=N[8]+he[8]*je,w[9]=N[9]+he[9]*je,w[10]=N[10]+he[10]*je,w[11]=N[11]+he[11]*je,w[12]=N[12]+he[12]*je,w[13]=N[13]+he[13]*je,w[14]=N[14]+he[14]*je,w[15]=N[15]+he[15]*je,w}function Fe(w,N){return w[0]===N[0]&&w[1]===N[1]&&w[2]===N[2]&&w[3]===N[3]&&w[4]===N[4]&&w[5]===N[5]&&w[6]===N[6]&&w[7]===N[7]&&w[8]===N[8]&&w[9]===N[9]&&w[10]===N[10]&&w[11]===N[11]&&w[12]===N[12]&&w[13]===N[13]&&w[14]===N[14]&&w[15]===N[15]}function Ee(w,N){var he=w[0],je=w[1],et=w[2],_t=w[3],Ct=w[4],V=w[5],Yt=w[6],kt=w[7],fr=w[8],Cr=w[9],Tr=w[10],Ar=w[11],Je=w[12],xt=w[13],ht=w[14],lr=w[15],Kr=N[0],lt=N[1],Lt=N[2],Jt=N[3],or=N[4],cn=N[5],Pn=N[6],bi=N[7],Si=N[8],Ri=N[9],ia=N[10],pi=N[11],H=N[12],ie=N[13],ce=N[14],B=N[15];return Math.abs(he-Kr)<=Q.Ib*Math.max(1,Math.abs(he),Math.abs(Kr))&&Math.abs(je-lt)<=Q.Ib*Math.max(1,Math.abs(je),Math.abs(lt))&&Math.abs(et-Lt)<=Q.Ib*Math.max(1,Math.abs(et),Math.abs(Lt))&&Math.abs(_t-Jt)<=Q.Ib*Math.max(1,Math.abs(_t),Math.abs(Jt))&&Math.abs(Ct-or)<=Q.Ib*Math.max(1,Math.abs(Ct),Math.abs(or))&&Math.abs(V-cn)<=Q.Ib*Math.max(1,Math.abs(V),Math.abs(cn))&&Math.abs(Yt-Pn)<=Q.Ib*Math.max(1,Math.abs(Yt),Math.abs(Pn))&&Math.abs(kt-bi)<=Q.Ib*Math.max(1,Math.abs(kt),Math.abs(bi))&&Math.abs(fr-Si)<=Q.Ib*Math.max(1,Math.abs(fr),Math.abs(Si))&&Math.abs(Cr-Ri)<=Q.Ib*Math.max(1,Math.abs(Cr),Math.abs(Ri))&&Math.abs(Tr-ia)<=Q.Ib*Math.max(1,Math.abs(Tr),Math.abs(ia))&&Math.abs(Ar-pi)<=Q.Ib*Math.max(1,Math.abs(Ar),Math.abs(pi))&&Math.abs(Je-H)<=Q.Ib*Math.max(1,Math.abs(Je),Math.abs(H))&&Math.abs(xt-ie)<=Q.Ib*Math.max(1,Math.abs(xt),Math.abs(ie))&&Math.abs(ht-ce)<=Q.Ib*Math.max(1,Math.abs(ht),Math.abs(ce))&&Math.abs(lr-B)<=Q.Ib*Math.max(1,Math.abs(lr),Math.abs(B))}var wt=We,Bt=tr},98333:function(ar,O,_){"use strict";_.d(O,{Ue:function(){return E},al:function(){return b},bA:function(){return At},fF:function(){return St}});var Q=_(49685);function E(){var se=new Q.WT(4);return Q.WT!=Float32Array&&(se[0]=0,se[1]=0,se[2]=0,se[3]=0),se}function p(se){var be=new glMatrix.ARRAY_TYPE(4);return be[0]=se[0],be[1]=se[1],be[2]=se[2],be[3]=se[3],be}function b(se,be,Fe,Ee){var wt=new Q.WT(4);return wt[0]=se,wt[1]=be,wt[2]=Fe,wt[3]=Ee,wt}function X(se,be){return se[0]=be[0],se[1]=be[1],se[2]=be[2],se[3]=be[3],se}function W(se,be,Fe,Ee,wt){return se[0]=be,se[1]=Fe,se[2]=Ee,se[3]=wt,se}function $(se,be,Fe){return se[0]=be[0]+Fe[0],se[1]=be[1]+Fe[1],se[2]=be[2]+Fe[2],se[3]=be[3]+Fe[3],se}function I(se,be,Fe){return se[0]=be[0]-Fe[0],se[1]=be[1]-Fe[1],se[2]=be[2]-Fe[2],se[3]=be[3]-Fe[3],se}function k(se,be,Fe){return se[0]=be[0]*Fe[0],se[1]=be[1]*Fe[1],se[2]=be[2]*Fe[2],se[3]=be[3]*Fe[3],se}function Ce(se,be,Fe){return se[0]=be[0]/Fe[0],se[1]=be[1]/Fe[1],se[2]=be[2]/Fe[2],se[3]=be[3]/Fe[3],se}function Be(se,be){return se[0]=Math.ceil(be[0]),se[1]=Math.ceil(be[1]),se[2]=Math.ceil(be[2]),se[3]=Math.ceil(be[3]),se}function We(se,be){return se[0]=Math.floor(be[0]),se[1]=Math.floor(be[1]),se[2]=Math.floor(be[2]),se[3]=Math.floor(be[3]),se}function $e(se,be,Fe){return se[0]=Math.min(be[0],Fe[0]),se[1]=Math.min(be[1],Fe[1]),se[2]=Math.min(be[2],Fe[2]),se[3]=Math.min(be[3],Fe[3]),se}function Vt(se,be,Fe){return se[0]=Math.max(be[0],Fe[0]),se[1]=Math.max(be[1],Fe[1]),se[2]=Math.max(be[2],Fe[2]),se[3]=Math.max(be[3],Fe[3]),se}function Ht(se,be){return se[0]=Math.round(be[0]),se[1]=Math.round(be[1]),se[2]=Math.round(be[2]),se[3]=Math.round(be[3]),se}function At(se,be,Fe){return se[0]=be[0]*Fe,se[1]=be[1]*Fe,se[2]=be[2]*Fe,se[3]=be[3]*Fe,se}function Ot(se,be,Fe,Ee){return se[0]=be[0]+Fe[0]*Ee,se[1]=be[1]+Fe[1]*Ee,se[2]=be[2]+Fe[2]*Ee,se[3]=be[3]+Fe[3]*Ee,se}function bt(se,be){var Fe=be[0]-se[0],Ee=be[1]-se[1],wt=be[2]-se[2],Bt=be[3]-se[3];return Math.hypot(Fe,Ee,wt,Bt)}function dt(se,be){var Fe=be[0]-se[0],Ee=be[1]-se[1],wt=be[2]-se[2],Bt=be[3]-se[3];return Fe*Fe+Ee*Ee+wt*wt+Bt*Bt}function Pr(se){var be=se[0],Fe=se[1],Ee=se[2],wt=se[3];return Math.hypot(be,Fe,Ee,wt)}function er(se){var be=se[0],Fe=se[1],Ee=se[2],wt=se[3];return be*be+Fe*Fe+Ee*Ee+wt*wt}function Ft(se,be){return se[0]=-be[0],se[1]=-be[1],se[2]=-be[2],se[3]=-be[3],se}function tt(se,be){return se[0]=1/be[0],se[1]=1/be[1],se[2]=1/be[2],se[3]=1/be[3],se}function Ne(se,be){var Fe=be[0],Ee=be[1],wt=be[2],Bt=be[3],w=Fe*Fe+Ee*Ee+wt*wt+Bt*Bt;return w>0&&(w=1/Math.sqrt(w)),se[0]=Fe*w,se[1]=Ee*w,se[2]=wt*w,se[3]=Bt*w,se}function Qe(se,be){return se[0]*be[0]+se[1]*be[1]+se[2]*be[2]+se[3]*be[3]}function Ie(se,be,Fe,Ee){var wt=Fe[0]*Ee[1]-Fe[1]*Ee[0],Bt=Fe[0]*Ee[2]-Fe[2]*Ee[0],w=Fe[0]*Ee[3]-Fe[3]*Ee[0],N=Fe[1]*Ee[2]-Fe[2]*Ee[1],he=Fe[1]*Ee[3]-Fe[3]*Ee[1],je=Fe[2]*Ee[3]-Fe[3]*Ee[2],et=be[0],_t=be[1],Ct=be[2],V=be[3];return se[0]=_t*je-Ct*he+V*N,se[1]=-(et*je)+Ct*w-V*Bt,se[2]=et*he-_t*w+V*wt,se[3]=-(et*N)+_t*Bt-Ct*wt,se}function Ae(se,be,Fe,Ee){var wt=be[0],Bt=be[1],w=be[2],N=be[3];return se[0]=wt+Ee*(Fe[0]-wt),se[1]=Bt+Ee*(Fe[1]-Bt),se[2]=w+Ee*(Fe[2]-w),se[3]=N+Ee*(Fe[3]-N),se}function Ue(se,be){be=be||1;var Fe,Ee,wt,Bt,w,N;do Fe=glMatrix.RANDOM()*2-1,Ee=glMatrix.RANDOM()*2-1,w=Fe*Fe+Ee*Ee;while(w>=1);do wt=glMatrix.RANDOM()*2-1,Bt=glMatrix.RANDOM()*2-1,N=wt*wt+Bt*Bt;while(N>=1);var he=Math.sqrt((1-w)/N);return se[0]=be*Fe,se[1]=be*Ee,se[2]=be*wt*he,se[3]=be*Bt*he,se}function St(se,be,Fe){var Ee=be[0],wt=be[1],Bt=be[2],w=be[3];return se[0]=Fe[0]*Ee+Fe[4]*wt+Fe[8]*Bt+Fe[12]*w,se[1]=Fe[1]*Ee+Fe[5]*wt+Fe[9]*Bt+Fe[13]*w,se[2]=Fe[2]*Ee+Fe[6]*wt+Fe[10]*Bt+Fe[14]*w,se[3]=Fe[3]*Ee+Fe[7]*wt+Fe[11]*Bt+Fe[15]*w,se}function ur(se,be,Fe){var Ee=be[0],wt=be[1],Bt=be[2],w=Fe[0],N=Fe[1],he=Fe[2],je=Fe[3],et=je*Ee+N*Bt-he*wt,_t=je*wt+he*Ee-w*Bt,Ct=je*Bt+w*wt-N*Ee,V=-w*Ee-N*wt-he*Bt;return se[0]=et*je+V*-w+_t*-he-Ct*-N,se[1]=_t*je+V*-N+Ct*-w-et*-he,se[2]=Ct*je+V*-he+et*-N-_t*-w,se[3]=be[3],se}function ae(se){return se[0]=0,se[1]=0,se[2]=0,se[3]=0,se}function Te(se){return"vec4("+se[0]+", "+se[1]+", "+se[2]+", "+se[3]+")"}function oe(se,be){return se[0]===be[0]&&se[1]===be[1]&&se[2]===be[2]&&se[3]===be[3]}function me(se,be){var Fe=se[0],Ee=se[1],wt=se[2],Bt=se[3],w=be[0],N=be[1],he=be[2],je=be[3];return Math.abs(Fe-w)<=glMatrix.EPSILON*Math.max(1,Math.abs(Fe),Math.abs(w))&&Math.abs(Ee-N)<=glMatrix.EPSILON*Math.max(1,Math.abs(Ee),Math.abs(N))&&Math.abs(wt-he)<=glMatrix.EPSILON*Math.max(1,Math.abs(wt),Math.abs(he))&&Math.abs(Bt-je)<=glMatrix.EPSILON*Math.max(1,Math.abs(Bt),Math.abs(je))}var Me=null,qe=null,yt=null,Qt=null,Or=null,Dr=null,on=null,tr=function(){var se=E();return function(be,Fe,Ee,wt,Bt,w){var N,he;for(Fe||(Fe=4),Ee||(Ee=0),wt?he=Math.min(wt*Fe+Ee,be.length):he=be.length,N=Ee;N<he;N+=Fe)se[0]=be[N],se[1]=be[N+1],se[2]=be[N+2],se[3]=be[N+3],Bt(se,se,w),be[N]=se[0],be[N+1]=se[1],be[N+2]=se[2],be[N+3]=se[3];return be}}()},50840:function(ar,O,_){var Q;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(E,p,b,X){"use strict";var W=["","webkit","Moz","MS","ms","o"],$=p.createElement("div"),I="function",k=Math.round,Ce=Math.abs,Be=Date.now;function We(pe,Le,vt){return setTimeout(Pr(pe,vt),Le)}function $e(pe,Le,vt){return Array.isArray(pe)?(Vt(pe,vt[Le],vt),!0):!1}function Vt(pe,Le,vt){var hr;if(!!pe)if(pe.forEach)pe.forEach(Le,vt);else if(pe.length!==X)for(hr=0;hr<pe.length;)Le.call(vt,pe[hr],hr,pe),hr++;else for(hr in pe)pe.hasOwnProperty(hr)&&Le.call(vt,pe[hr],hr,pe)}function Ht(pe,Le,vt){var hr="DEPRECATED METHOD: "+Le+`
`+vt+` AT 
`;return function(){var Qr=new Error("get-stack-trace"),Dn=Qr&&Qr.stack?Qr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ki=E.console&&(E.console.warn||E.console.log);return Ki&&Ki.call(E.console,hr,Dn),pe.apply(this,arguments)}}var At;typeof Object.assign!="function"?At=function(Le){if(Le===X||Le===null)throw new TypeError("Cannot convert undefined or null to object");for(var vt=Object(Le),hr=1;hr<arguments.length;hr++){var Qr=arguments[hr];if(Qr!==X&&Qr!==null)for(var Dn in Qr)Qr.hasOwnProperty(Dn)&&(vt[Dn]=Qr[Dn])}return vt}:At=Object.assign;var Ot=Ht(function(Le,vt,hr){for(var Qr=Object.keys(vt),Dn=0;Dn<Qr.length;)(!hr||hr&&Le[Qr[Dn]]===X)&&(Le[Qr[Dn]]=vt[Qr[Dn]]),Dn++;return Le},"extend","Use `assign`."),bt=Ht(function(Le,vt){return Ot(Le,vt,!0)},"merge","Use `assign`.");function dt(pe,Le,vt){var hr=Le.prototype,Qr;Qr=pe.prototype=Object.create(hr),Qr.constructor=pe,Qr._super=hr,vt&&At(Qr,vt)}function Pr(pe,Le){return function(){return pe.apply(Le,arguments)}}function er(pe,Le){return typeof pe==I?pe.apply(Le&&Le[0]||X,Le):pe}function Ft(pe,Le){return pe===X?Le:pe}function tt(pe,Le,vt){Vt(Ae(Le),function(hr){pe.addEventListener(hr,vt,!1)})}function Ne(pe,Le,vt){Vt(Ae(Le),function(hr){pe.removeEventListener(hr,vt,!1)})}function Qe(pe,Le){for(;pe;){if(pe==Le)return!0;pe=pe.parentNode}return!1}function Ie(pe,Le){return pe.indexOf(Le)>-1}function Ae(pe){return pe.trim().split(/\s+/g)}function Ue(pe,Le,vt){if(pe.indexOf&&!vt)return pe.indexOf(Le);for(var hr=0;hr<pe.length;){if(vt&&pe[hr][vt]==Le||!vt&&pe[hr]===Le)return hr;hr++}return-1}function St(pe){return Array.prototype.slice.call(pe,0)}function ur(pe,Le,vt){for(var hr=[],Qr=[],Dn=0;Dn<pe.length;){var Ki=Le?pe[Dn][Le]:pe[Dn];Ue(Qr,Ki)<0&&hr.push(pe[Dn]),Qr[Dn]=Ki,Dn++}return vt&&(Le?hr=hr.sort(function(La,ja){return La[Le]>ja[Le]}):hr=hr.sort()),hr}function ae(pe,Le){for(var vt,hr,Qr=Le[0].toUpperCase()+Le.slice(1),Dn=0;Dn<W.length;){if(vt=W[Dn],hr=vt?vt+Qr:Le,hr in pe)return hr;Dn++}return X}var Te=1;function oe(){return Te++}function me(pe){var Le=pe.ownerDocument||pe;return Le.defaultView||Le.parentWindow||E}var Me=/mobile|tablet|ip(ad|hone|od)|android/i,qe="ontouchstart"in E,yt=ae(E,"PointerEvent")!==X,Qt=qe&&Me.test(navigator.userAgent),Or="touch",Dr="pen",on="mouse",tr="kinect",se=25,be=1,Fe=2,Ee=4,wt=8,Bt=1,w=2,N=4,he=8,je=16,et=w|N,_t=he|je,Ct=et|_t,V=["x","y"],Yt=["clientX","clientY"];function kt(pe,Le){var vt=this;this.manager=pe,this.callback=Le,this.element=pe.element,this.target=pe.options.inputTarget,this.domHandler=function(hr){er(pe.options.enable,[pe])&&vt.handler(hr)},this.init()}kt.prototype={handler:function(){},init:function(){this.evEl&&tt(this.element,this.evEl,this.domHandler),this.evTarget&&tt(this.target,this.evTarget,this.domHandler),this.evWin&&tt(me(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ne(this.element,this.evEl,this.domHandler),this.evTarget&&Ne(this.target,this.evTarget,this.domHandler),this.evWin&&Ne(me(this.element),this.evWin,this.domHandler)}};function fr(pe){var Le,vt=pe.options.inputClass;return vt?Le=vt:yt?Le=ie:Qt?Le=pt:qe?Le=Fr:Le=Si,new Le(pe,Cr)}function Cr(pe,Le,vt){var hr=vt.pointers.length,Qr=vt.changedPointers.length,Dn=Le&be&&hr-Qr==0,Ki=Le&(Ee|wt)&&hr-Qr==0;vt.isFirst=!!Dn,vt.isFinal=!!Ki,Dn&&(pe.session={}),vt.eventType=Le,Tr(pe,vt),pe.emit("hammer.input",vt),pe.recognize(vt),pe.session.prevInput=vt}function Tr(pe,Le){var vt=pe.session,hr=Le.pointers,Qr=hr.length;vt.firstInput||(vt.firstInput=xt(Le)),Qr>1&&!vt.firstMultiple?vt.firstMultiple=xt(Le):Qr===1&&(vt.firstMultiple=!1);var Dn=vt.firstInput,Ki=vt.firstMultiple,Ua=Ki?Ki.center:Dn.center,La=Le.center=ht(hr);Le.timeStamp=Be(),Le.deltaTime=Le.timeStamp-Dn.timeStamp,Le.angle=Lt(Ua,La),Le.distance=lt(Ua,La),Ar(vt,Le),Le.offsetDirection=Kr(Le.deltaX,Le.deltaY);var ja=lr(Le.deltaTime,Le.deltaX,Le.deltaY);Le.overallVelocityX=ja.x,Le.overallVelocityY=ja.y,Le.overallVelocity=Ce(ja.x)>Ce(ja.y)?ja.x:ja.y,Le.scale=Ki?or(Ki.pointers,hr):1,Le.rotation=Ki?Jt(Ki.pointers,hr):0,Le.maxPointers=vt.prevInput?Le.pointers.length>vt.prevInput.maxPointers?Le.pointers.length:vt.prevInput.maxPointers:Le.pointers.length,Je(vt,Le);var To=pe.element;Qe(Le.srcEvent.target,To)&&(To=Le.srcEvent.target),Le.target=To}function Ar(pe,Le){var vt=Le.center,hr=pe.offsetDelta||{},Qr=pe.prevDelta||{},Dn=pe.prevInput||{};(Le.eventType===be||Dn.eventType===Ee)&&(Qr=pe.prevDelta={x:Dn.deltaX||0,y:Dn.deltaY||0},hr=pe.offsetDelta={x:vt.x,y:vt.y}),Le.deltaX=Qr.x+(vt.x-hr.x),Le.deltaY=Qr.y+(vt.y-hr.y)}function Je(pe,Le){var vt=pe.lastInterval||Le,hr=Le.timeStamp-vt.timeStamp,Qr,Dn,Ki,Ua;if(Le.eventType!=wt&&(hr>se||vt.velocity===X)){var La=Le.deltaX-vt.deltaX,ja=Le.deltaY-vt.deltaY,To=lr(hr,La,ja);Dn=To.x,Ki=To.y,Qr=Ce(To.x)>Ce(To.y)?To.x:To.y,Ua=Kr(La,ja),pe.lastInterval=Le}else Qr=vt.velocity,Dn=vt.velocityX,Ki=vt.velocityY,Ua=vt.direction;Le.velocity=Qr,Le.velocityX=Dn,Le.velocityY=Ki,Le.direction=Ua}function xt(pe){for(var Le=[],vt=0;vt<pe.pointers.length;)Le[vt]={clientX:k(pe.pointers[vt].clientX),clientY:k(pe.pointers[vt].clientY)},vt++;return{timeStamp:Be(),pointers:Le,center:ht(Le),deltaX:pe.deltaX,deltaY:pe.deltaY}}function ht(pe){var Le=pe.length;if(Le===1)return{x:k(pe[0].clientX),y:k(pe[0].clientY)};for(var vt=0,hr=0,Qr=0;Qr<Le;)vt+=pe[Qr].clientX,hr+=pe[Qr].clientY,Qr++;return{x:k(vt/Le),y:k(hr/Le)}}function lr(pe,Le,vt){return{x:Le/pe||0,y:vt/pe||0}}function Kr(pe,Le){return pe===Le?Bt:Ce(pe)>=Ce(Le)?pe<0?w:N:Le<0?he:je}function lt(pe,Le,vt){vt||(vt=V);var hr=Le[vt[0]]-pe[vt[0]],Qr=Le[vt[1]]-pe[vt[1]];return Math.sqrt(hr*hr+Qr*Qr)}function Lt(pe,Le,vt){vt||(vt=V);var hr=Le[vt[0]]-pe[vt[0]],Qr=Le[vt[1]]-pe[vt[1]];return Math.atan2(Qr,hr)*180/Math.PI}function Jt(pe,Le){return Lt(Le[1],Le[0],Yt)+Lt(pe[1],pe[0],Yt)}function or(pe,Le){return lt(Le[0],Le[1],Yt)/lt(pe[0],pe[1],Yt)}var cn={mousedown:be,mousemove:Fe,mouseup:Ee},Pn="mousedown",bi="mousemove mouseup";function Si(){this.evEl=Pn,this.evWin=bi,this.pressed=!1,kt.apply(this,arguments)}dt(Si,kt,{handler:function(Le){var vt=cn[Le.type];vt&be&&Le.button===0&&(this.pressed=!0),vt&Fe&&Le.which!==1&&(vt=Ee),!!this.pressed&&(vt&Ee&&(this.pressed=!1),this.callback(this.manager,vt,{pointers:[Le],changedPointers:[Le],pointerType:on,srcEvent:Le}))}});var Ri={pointerdown:be,pointermove:Fe,pointerup:Ee,pointercancel:wt,pointerout:wt},ia={2:Or,3:Dr,4:on,5:tr},pi="pointerdown",H="pointermove pointerup pointercancel";E.MSPointerEvent&&!E.PointerEvent&&(pi="MSPointerDown",H="MSPointerMove MSPointerUp MSPointerCancel");function ie(){this.evEl=pi,this.evWin=H,kt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}dt(ie,kt,{handler:function(Le){var vt=this.store,hr=!1,Qr=Le.type.toLowerCase().replace("ms",""),Dn=Ri[Qr],Ki=ia[Le.pointerType]||Le.pointerType,Ua=Ki==Or,La=Ue(vt,Le.pointerId,"pointerId");Dn&be&&(Le.button===0||Ua)?La<0&&(vt.push(Le),La=vt.length-1):Dn&(Ee|wt)&&(hr=!0),!(La<0)&&(vt[La]=Le,this.callback(this.manager,Dn,{pointers:vt,changedPointers:[Le],pointerType:Ki,srcEvent:Le}),hr&&vt.splice(La,1))}});var ce={touchstart:be,touchmove:Fe,touchend:Ee,touchcancel:wt},B="touchstart",re="touchstart touchmove touchend touchcancel";function fe(){this.evTarget=B,this.evWin=re,this.started=!1,kt.apply(this,arguments)}dt(fe,kt,{handler:function(Le){var vt=ce[Le.type];if(vt===be&&(this.started=!0),!!this.started){var hr=Se.call(this,Le,vt);vt&(Ee|wt)&&hr[0].length-hr[1].length==0&&(this.started=!1),this.callback(this.manager,vt,{pointers:hr[0],changedPointers:hr[1],pointerType:Or,srcEvent:Le})}}});function Se(pe,Le){var vt=St(pe.touches),hr=St(pe.changedTouches);return Le&(Ee|wt)&&(vt=ur(vt.concat(hr),"identifier",!0)),[vt,hr]}var te={touchstart:be,touchmove:Fe,touchend:Ee,touchcancel:wt},ge="touchstart touchmove touchend touchcancel";function pt(){this.evTarget=ge,this.targetIds={},kt.apply(this,arguments)}dt(pt,kt,{handler:function(Le){var vt=te[Le.type],hr=yr.call(this,Le,vt);!hr||this.callback(this.manager,vt,{pointers:hr[0],changedPointers:hr[1],pointerType:Or,srcEvent:Le})}});function yr(pe,Le){var vt=St(pe.touches),hr=this.targetIds;if(Le&(be|Fe)&&vt.length===1)return hr[vt[0].identifier]=!0,[vt,vt];var Qr,Dn,Ki=St(pe.changedTouches),Ua=[],La=this.target;if(Dn=vt.filter(function(ja){return Qe(ja.target,La)}),Le===be)for(Qr=0;Qr<Dn.length;)hr[Dn[Qr].identifier]=!0,Qr++;for(Qr=0;Qr<Ki.length;)hr[Ki[Qr].identifier]&&Ua.push(Ki[Qr]),Le&(Ee|wt)&&delete hr[Ki[Qr].identifier],Qr++;if(!!Ua.length)return[ur(Dn.concat(Ua),"identifier",!0),Ua]}var Lr=2500,Nt=25;function Fr(){kt.apply(this,arguments);var pe=Pr(this.handler,this);this.touch=new pt(this.manager,pe),this.mouse=new Si(this.manager,pe),this.primaryTouch=null,this.lastTouches=[]}dt(Fr,kt,{handler:function(Le,vt,hr){var Qr=hr.pointerType==Or,Dn=hr.pointerType==on;if(!(Dn&&hr.sourceCapabilities&&hr.sourceCapabilities.firesTouchEvents)){if(Qr)bn.call(this,vt,hr);else if(Dn&&gr.call(this,hr))return;this.callback(Le,vt,hr)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function bn(pe,Le){pe&be?(this.primaryTouch=Le.changedPointers[0].identifier,gn.call(this,Le)):pe&(Ee|wt)&&gn.call(this,Le)}function gn(pe){var Le=pe.changedPointers[0];if(Le.identifier===this.primaryTouch){var vt={x:Le.clientX,y:Le.clientY};this.lastTouches.push(vt);var hr=this.lastTouches,Qr=function(){var Dn=hr.indexOf(vt);Dn>-1&&hr.splice(Dn,1)};setTimeout(Qr,Lr)}}function gr(pe){for(var Le=pe.srcEvent.clientX,vt=pe.srcEvent.clientY,hr=0;hr<this.lastTouches.length;hr++){var Qr=this.lastTouches[hr],Dn=Math.abs(Le-Qr.x),Ki=Math.abs(vt-Qr.y);if(Dn<=Nt&&Ki<=Nt)return!0}return!1}var vn=ae($.style,"touchAction"),Wr=vn!==X,ln="compute",Ei="auto",pn="manipulation",wi="none",Yi="pan-x",Yn="pan-y",Di=Wn();function ki(pe,Le){this.manager=pe,this.set(Le)}ki.prototype={set:function(pe){pe==ln&&(pe=this.compute()),Wr&&this.manager.element.style&&Di[pe]&&(this.manager.element.style[vn]=pe),this.actions=pe.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var pe=[];return Vt(this.manager.recognizers,function(Le){er(Le.options.enable,[Le])&&(pe=pe.concat(Le.getTouchAction()))}),za(pe.join(" "))},preventDefaults:function(pe){var Le=pe.srcEvent,vt=pe.offsetDirection;if(this.manager.session.prevented){Le.preventDefault();return}var hr=this.actions,Qr=Ie(hr,wi)&&!Di[wi],Dn=Ie(hr,Yn)&&!Di[Yn],Ki=Ie(hr,Yi)&&!Di[Yi];if(Qr){var Ua=pe.pointers.length===1,La=pe.distance<2,ja=pe.deltaTime<250;if(Ua&&La&&ja)return}if(!(Ki&&Dn)&&(Qr||Dn&&vt&et||Ki&&vt&_t))return this.preventSrc(Le)},preventSrc:function(pe){this.manager.session.prevented=!0,pe.preventDefault()}};function za(pe){if(Ie(pe,wi))return wi;var Le=Ie(pe,Yi),vt=Ie(pe,Yn);return Le&&vt?wi:Le||vt?Le?Yi:Yn:Ie(pe,pn)?pn:Ei}function Wn(){if(!Wr)return!1;var pe={},Le=E.CSS&&E.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(vt){pe[vt]=Le?E.CSS.supports("touch-action",vt):!0}),pe}var ai=1,Ai=2,Qn=4,Fi=8,ya=Fi,Xa=16,_a=32;function da(pe){this.options=At({},this.defaults,pe||{}),this.id=oe(),this.manager=null,this.options.enable=Ft(this.options.enable,!0),this.state=ai,this.simultaneous={},this.requireFail=[]}da.prototype={defaults:{},set:function(pe){return At(this.options,pe),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(pe){if($e(pe,"recognizeWith",this))return this;var Le=this.simultaneous;return pe=gi(pe,this),Le[pe.id]||(Le[pe.id]=pe,pe.recognizeWith(this)),this},dropRecognizeWith:function(pe){return $e(pe,"dropRecognizeWith",this)?this:(pe=gi(pe,this),delete this.simultaneous[pe.id],this)},requireFailure:function(pe){if($e(pe,"requireFailure",this))return this;var Le=this.requireFail;return pe=gi(pe,this),Ue(Le,pe)===-1&&(Le.push(pe),pe.requireFailure(this)),this},dropRequireFailure:function(pe){if($e(pe,"dropRequireFailure",this))return this;pe=gi(pe,this);var Le=Ue(this.requireFail,pe);return Le>-1&&this.requireFail.splice(Le,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(pe){return!!this.simultaneous[pe.id]},emit:function(pe){var Le=this,vt=this.state;function hr(Qr){Le.manager.emit(Qr,pe)}vt<Fi&&hr(Le.options.event+Vu(vt)),hr(Le.options.event),pe.additionalEvent&&hr(pe.additionalEvent),vt>=Fi&&hr(Le.options.event+Vu(vt))},tryEmit:function(pe){if(this.canEmit())return this.emit(pe);this.state=_a},canEmit:function(){for(var pe=0;pe<this.requireFail.length;){if(!(this.requireFail[pe].state&(_a|ai)))return!1;pe++}return!0},recognize:function(pe){var Le=At({},pe);if(!er(this.options.enable,[this,Le])){this.reset(),this.state=_a;return}this.state&(ya|Xa|_a)&&(this.state=ai),this.state=this.process(Le),this.state&(Ai|Qn|Fi|Xa)&&this.tryEmit(Le)},process:function(pe){},getTouchAction:function(){},reset:function(){}};function Vu(pe){return pe&Xa?"cancel":pe&Fi?"end":pe&Qn?"move":pe&Ai?"start":""}function Ya(pe){return pe==je?"down":pe==he?"up":pe==w?"left":pe==N?"right":""}function gi(pe,Le){var vt=Le.manager;return vt?vt.get(pe):pe}function qa(){da.apply(this,arguments)}dt(qa,da,{defaults:{pointers:1},attrTest:function(pe){var Le=this.options.pointers;return Le===0||pe.pointers.length===Le},process:function(pe){var Le=this.state,vt=pe.eventType,hr=Le&(Ai|Qn),Qr=this.attrTest(pe);return hr&&(vt&wt||!Qr)?Le|Xa:hr||Qr?vt&Ee?Le|Fi:Le&Ai?Le|Qn:Ai:_a}});function Ka(){qa.apply(this,arguments),this.pX=null,this.pY=null}dt(Ka,qa,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ct},getTouchAction:function(){var pe=this.options.direction,Le=[];return pe&et&&Le.push(Yn),pe&_t&&Le.push(Yi),Le},directionTest:function(pe){var Le=this.options,vt=!0,hr=pe.distance,Qr=pe.direction,Dn=pe.deltaX,Ki=pe.deltaY;return Qr&Le.direction||(Le.direction&et?(Qr=Dn===0?Bt:Dn<0?w:N,vt=Dn!=this.pX,hr=Math.abs(pe.deltaX)):(Qr=Ki===0?Bt:Ki<0?he:je,vt=Ki!=this.pY,hr=Math.abs(pe.deltaY))),pe.direction=Qr,vt&&hr>Le.threshold&&Qr&Le.direction},attrTest:function(pe){return qa.prototype.attrTest.call(this,pe)&&(this.state&Ai||!(this.state&Ai)&&this.directionTest(pe))},emit:function(pe){this.pX=pe.deltaX,this.pY=pe.deltaY;var Le=Ya(pe.direction);Le&&(pe.additionalEvent=this.options.event+Le),this._super.emit.call(this,pe)}});function $a(){qa.apply(this,arguments)}dt($a,qa,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[wi]},attrTest:function(pe){return this._super.attrTest.call(this,pe)&&(Math.abs(pe.scale-1)>this.options.threshold||this.state&Ai)},emit:function(pe){if(pe.scale!==1){var Le=pe.scale<1?"in":"out";pe.additionalEvent=this.options.event+Le}this._super.emit.call(this,pe)}});function Yo(){da.apply(this,arguments),this._timer=null,this._input=null}dt(Yo,da,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ei]},process:function(pe){var Le=this.options,vt=pe.pointers.length===Le.pointers,hr=pe.distance<Le.threshold,Qr=pe.deltaTime>Le.time;if(this._input=pe,!hr||!vt||pe.eventType&(Ee|wt)&&!Qr)this.reset();else if(pe.eventType&be)this.reset(),this._timer=We(function(){this.state=ya,this.tryEmit()},Le.time,this);else if(pe.eventType&Ee)return ya;return _a},reset:function(){clearTimeout(this._timer)},emit:function(pe){this.state===ya&&(pe&&pe.eventType&Ee?this.manager.emit(this.options.event+"up",pe):(this._input.timeStamp=Be(),this.manager.emit(this.options.event,this._input)))}});function Gi(){qa.apply(this,arguments)}dt(Gi,qa,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[wi]},attrTest:function(pe){return this._super.attrTest.call(this,pe)&&(Math.abs(pe.rotation)>this.options.threshold||this.state&Ai)}});function Oo(){qa.apply(this,arguments)}dt(Oo,qa,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:et|_t,pointers:1},getTouchAction:function(){return Ka.prototype.getTouchAction.call(this)},attrTest:function(pe){var Le=this.options.direction,vt;return Le&(et|_t)?vt=pe.overallVelocity:Le&et?vt=pe.overallVelocityX:Le&_t&&(vt=pe.overallVelocityY),this._super.attrTest.call(this,pe)&&Le&pe.offsetDirection&&pe.distance>this.options.threshold&&pe.maxPointers==this.options.pointers&&Ce(vt)>this.options.velocity&&pe.eventType&Ee},emit:function(pe){var Le=Ya(pe.offsetDirection);Le&&this.manager.emit(this.options.event+Le,pe),this.manager.emit(this.options.event,pe)}});function Oa(){da.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}dt(Oa,da,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[pn]},process:function(pe){var Le=this.options,vt=pe.pointers.length===Le.pointers,hr=pe.distance<Le.threshold,Qr=pe.deltaTime<Le.time;if(this.reset(),pe.eventType&be&&this.count===0)return this.failTimeout();if(hr&&Qr&&vt){if(pe.eventType!=Ee)return this.failTimeout();var Dn=this.pTime?pe.timeStamp-this.pTime<Le.interval:!0,Ki=!this.pCenter||lt(this.pCenter,pe.center)<Le.posThreshold;this.pTime=pe.timeStamp,this.pCenter=pe.center,!Ki||!Dn?this.count=1:this.count+=1,this._input=pe;var Ua=this.count%Le.taps;if(Ua===0)return this.hasRequireFailures()?(this._timer=We(function(){this.state=ya,this.tryEmit()},Le.interval,this),Ai):ya}return _a},failTimeout:function(){return this._timer=We(function(){this.state=_a},this.options.interval,this),_a},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ya&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Za(pe,Le){return Le=Le||{},Le.recognizers=Ft(Le.recognizers,Za.defaults.preset),new fs(pe,Le)}Za.VERSION="2.0.7",Za.defaults={domEvents:!1,touchAction:ln,enable:!0,inputTarget:null,inputClass:null,preset:[[Gi,{enable:!1}],[$a,{enable:!1},["rotate"]],[Oo,{direction:et}],[Ka,{direction:et},["swipe"]],[Oa],[Oa,{event:"doubletap",taps:2},["tap"]],[Yo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var cs=1,va=2;function fs(pe,Le){this.options=At({},Za.defaults,Le||{}),this.options.inputTarget=this.options.inputTarget||pe,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=pe,this.input=fr(this),this.touchAction=new ki(this,this.options.touchAction),Ca(this,!0),Vt(this.options.recognizers,function(vt){var hr=this.add(new vt[0](vt[1]));vt[2]&&hr.recognizeWith(vt[2]),vt[3]&&hr.requireFailure(vt[3])},this)}fs.prototype={set:function(pe){return At(this.options,pe),pe.touchAction&&this.touchAction.update(),pe.inputTarget&&(this.input.destroy(),this.input.target=pe.inputTarget,this.input.init()),this},stop:function(pe){this.session.stopped=pe?va:cs},recognize:function(pe){var Le=this.session;if(!Le.stopped){this.touchAction.preventDefaults(pe);var vt,hr=this.recognizers,Qr=Le.curRecognizer;(!Qr||Qr&&Qr.state&ya)&&(Qr=Le.curRecognizer=null);for(var Dn=0;Dn<hr.length;)vt=hr[Dn],Le.stopped!==va&&(!Qr||vt==Qr||vt.canRecognizeWith(Qr))?vt.recognize(pe):vt.reset(),!Qr&&vt.state&(Ai|Qn|Fi)&&(Qr=Le.curRecognizer=vt),Dn++}},get:function(pe){if(pe instanceof da)return pe;for(var Le=this.recognizers,vt=0;vt<Le.length;vt++)if(Le[vt].options.event==pe)return Le[vt];return null},add:function(pe){if($e(pe,"add",this))return this;var Le=this.get(pe.options.event);return Le&&this.remove(Le),this.recognizers.push(pe),pe.manager=this,this.touchAction.update(),pe},remove:function(pe){if($e(pe,"remove",this))return this;if(pe=this.get(pe),pe){var Le=this.recognizers,vt=Ue(Le,pe);vt!==-1&&(Le.splice(vt,1),this.touchAction.update())}return this},on:function(pe,Le){if(pe!==X&&Le!==X){var vt=this.handlers;return Vt(Ae(pe),function(hr){vt[hr]=vt[hr]||[],vt[hr].push(Le)}),this}},off:function(pe,Le){if(pe!==X){var vt=this.handlers;return Vt(Ae(pe),function(hr){Le?vt[hr]&&vt[hr].splice(Ue(vt[hr],Le),1):delete vt[hr]}),this}},emit:function(pe,Le){this.options.domEvents&&fo(pe,Le);var vt=this.handlers[pe]&&this.handlers[pe].slice();if(!(!vt||!vt.length)){Le.type=pe,Le.preventDefault=function(){Le.srcEvent.preventDefault()};for(var hr=0;hr<vt.length;)vt[hr](Le),hr++}},destroy:function(){this.element&&Ca(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ca(pe,Le){var vt=pe.element;if(!!vt.style){var hr;Vt(pe.options.cssProps,function(Qr,Dn){hr=ae(vt.style,Dn),Le?(pe.oldCssProps[hr]=vt.style[hr],vt.style[hr]=Qr):vt.style[hr]=pe.oldCssProps[hr]||""}),Le||(pe.oldCssProps={})}}function fo(pe,Le){var vt=p.createEvent("Event");vt.initEvent(pe,!0,!0),vt.gesture=Le,Le.target.dispatchEvent(vt)}At(Za,{INPUT_START:be,INPUT_MOVE:Fe,INPUT_END:Ee,INPUT_CANCEL:wt,STATE_POSSIBLE:ai,STATE_BEGAN:Ai,STATE_CHANGED:Qn,STATE_ENDED:Fi,STATE_RECOGNIZED:ya,STATE_CANCELLED:Xa,STATE_FAILED:_a,DIRECTION_NONE:Bt,DIRECTION_LEFT:w,DIRECTION_RIGHT:N,DIRECTION_UP:he,DIRECTION_DOWN:je,DIRECTION_HORIZONTAL:et,DIRECTION_VERTICAL:_t,DIRECTION_ALL:Ct,Manager:fs,Input:kt,TouchAction:ki,TouchInput:pt,MouseInput:Si,PointerEventInput:ie,TouchMouseInput:Fr,SingleTouchInput:fe,Recognizer:da,AttrRecognizer:qa,Tap:Oa,Pan:Ka,Swipe:Oo,Pinch:$a,Rotate:Gi,Press:Yo,on:tt,off:Ne,each:Vt,merge:bt,extend:Ot,assign:At,inherit:dt,bindFn:Pr,prefixed:ae});var Zi=typeof E!="undefined"?E:typeof self!="undefined"?self:{};Zi.Hammer=Za,Q=function(){return Za}.call(O,_,O,ar),Q!==X&&(ar.exports=Q)})(window,document,"Hammer")},7375:function(ar,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0});var _=Symbol.for("INJECTION");function Q(W,$,I,k){function Ce(){return k&&!Reflect.hasMetadata(_,this,$)&&Reflect.defineMetadata(_,I(),this,$),Reflect.hasMetadata(_,this,$)?Reflect.getMetadata(_,this,$):I()}function Be(We){Reflect.defineMetadata(_,We,this,$)}Object.defineProperty(W,$,{configurable:!0,enumerable:!0,get:Ce,set:Be})}function E(W,$){return function(I){return function(k,Ce){var Be=function(){return W.get(I)};Q(k,Ce,Be,$)}}}O.makePropertyInjectDecorator=E;function p(W,$){return function(I,k){return function(Ce,Be){var We=function(){return W.getNamed(I,k)};Q(Ce,Be,We,$)}}}O.makePropertyInjectNamedDecorator=p;function b(W,$){return function(I,k,Ce){return function(Be,We){var $e=function(){return W.getTagged(I,k,Ce)};Q(Be,We,$e,$)}}}O.makePropertyInjectTaggedDecorator=b;function X(W,$){return function(I){return function(k,Ce){var Be=function(){return W.getAll(I)};Q(k,Ce,Be,$)}}}O.makePropertyMultiInjectDecorator=X},84879:function(ar,O,_){"use strict";var Q;Q={value:!0};var E=_(7375);function p(b,X){X===void 0&&(X=!0);var W=E.makePropertyInjectDecorator(b,X),$=E.makePropertyInjectNamedDecorator(b,X),I=E.makePropertyInjectTaggedDecorator(b,X),k=E.makePropertyMultiInjectDecorator(b,X);return{lazyInject:W,lazyInjectNamed:$,lazyInjectTagged:I,lazyMultiInject:k}}O.Z=p},99934:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.tagProperty=O.tagParameter=O.decorate=void 0;var Q=_(16674),E=_(6867);function p(k,Ce,Be,We){var $e=E.TAGGED;X($e,k,Ce,We,Be)}O.tagParameter=p;function b(k,Ce,Be){var We=E.TAGGED_PROP;X(We,k.constructor,Ce,Be)}O.tagProperty=b;function X(k,Ce,Be,We,$e){var Vt={},Ht=typeof $e=="number",At=$e!==void 0&&Ht?$e.toString():Be;if(Ht&&Be!==void 0)throw new Error(Q.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(k,Ce)&&(Vt=Reflect.getMetadata(k,Ce));var Ot=Vt[At];if(!Array.isArray(Ot))Ot=[];else for(var bt=0,dt=Ot;bt<dt.length;bt++){var Pr=dt[bt];if(Pr.key===We.key)throw new Error(Q.DUPLICATED_METADATA+" "+Pr.key.toString())}Ot.push(We),Vt[At]=Ot,Reflect.defineMetadata(k,Vt,Ce)}function W(k,Ce){Reflect.decorate(k,Ce)}function $(k,Ce){return function(Be,We){Ce(Be,We,k)}}function I(k,Ce,Be){typeof Be=="number"?W([$(Be,k)],Ce):typeof Be=="string"?Reflect.decorate([k],Ce,Be):W([k],Ce)}O.decorate=I},5744:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.inject=O.LazyServiceIdentifer=void 0;var Q=_(16674),E=_(6867),p=_(47738),b=_(99934),X=function(){function $(I){this._cb=I}return $.prototype.unwrap=function(){return this._cb()},$}();O.LazyServiceIdentifer=X;function W($){return function(I,k,Ce){if($===void 0)throw new Error(Q.UNDEFINED_INJECT_ANNOTATION(I.name));var Be=new p.Metadata(E.INJECT_TAG,$);typeof Ce=="number"?b.tagParameter(I,k,Ce,Be):b.tagProperty(I,k,Be)}}O.inject=W},64315:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.injectable=void 0;var Q=_(16674),E=_(6867);function p(){return function(b){if(Reflect.hasOwnMetadata(E.PARAM_TYPES,b))throw new Error(Q.DUPLICATED_INJECTABLE_DECORATOR);var X=Reflect.getMetadata(E.DESIGN_PARAM_TYPES,b)||[];return Reflect.defineMetadata(E.PARAM_TYPES,X,b),b}}O.injectable=p},71693:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.multiInject=void 0;var Q=_(6867),E=_(47738),p=_(99934);function b(X){return function(W,$,I){var k=new E.Metadata(Q.MULTI_INJECT_TAG,X);typeof I=="number"?p.tagParameter(W,$,I,k):p.tagProperty(W,$,k)}}O.multiInject=b},38085:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.named=void 0;var Q=_(6867),E=_(47738),p=_(99934);function b(X){return function(W,$,I){var k=new E.Metadata(Q.NAMED_TAG,X);typeof I=="number"?p.tagParameter(W,$,I,k):p.tagProperty(W,$,k)}}O.named=b},6515:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.optional=void 0;var Q=_(6867),E=_(47738),p=_(99934);function b(){return function(X,W,$){var I=new E.Metadata(Q.OPTIONAL_TAG,!0);typeof $=="number"?p.tagParameter(X,W,$,I):p.tagProperty(X,W,I)}}O.optional=b},7014:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.postConstruct=void 0;var Q=_(16674),E=_(6867),p=_(47738);function b(){return function(X,W,$){var I=new p.Metadata(E.POST_CONSTRUCT,W);if(Reflect.hasOwnMetadata(E.POST_CONSTRUCT,X.constructor))throw new Error(Q.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(E.POST_CONSTRUCT,I,X.constructor)}}O.postConstruct=b},32052:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.tagged=void 0;var Q=_(47738),E=_(99934);function p(b,X){return function(W,$,I){var k=new Q.Metadata(b,X);typeof I=="number"?E.tagParameter(W,$,I,k):E.tagProperty(W,$,k)}}O.tagged=p},55638:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.targetName=void 0;var Q=_(6867),E=_(47738),p=_(99934);function b(X){return function(W,$,I){var k=new E.Metadata(Q.NAME_TAG,X);p.tagParameter(W,$,I,k)}}O.targetName=b},86757:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.unmanaged=void 0;var Q=_(6867),E=_(47738),p=_(99934);function b(){return function(X,W,$){var I=new E.Metadata(Q.UNMANAGED_TAG,!0);p.tagParameter(X,W,$,I)}}O.unmanaged=b},44290:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Binding=void 0;var Q=_(28421),E=_(37791),p=function(){function b(X,W){this.id=E.id(),this.activated=!1,this.serviceIdentifier=X,this.scope=W,this.type=Q.BindingTypeEnum.Invalid,this.constraint=function($){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return b.prototype.clone=function(){var X=new b(this.serviceIdentifier,this.scope);return X.activated=X.scope===Q.BindingScopeEnum.Singleton?this.activated:!1,X.implementationType=this.implementationType,X.dynamicValue=this.dynamicValue,X.scope=this.scope,X.type=this.type,X.factory=this.factory,X.provider=this.provider,X.constraint=this.constraint,X.onActivation=this.onActivation,X.cache=this.cache,X},b}();O.Binding=p},23184:function(ar,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingCount=void 0;var _={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};O.BindingCount=_},16674:function(ar,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.STACK_OVERFLOW=O.CIRCULAR_DEPENDENCY_IN_FACTORY=O.POST_CONSTRUCT_ERROR=O.MULTIPLE_POST_CONSTRUCT_METHODS=O.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=O.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=O.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=O.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=O.ARGUMENTS_LENGTH_MISMATCH=O.INVALID_DECORATOR_OPERATION=O.INVALID_TO_SELF_VALUE=O.INVALID_FUNCTION_BINDING=O.INVALID_MIDDLEWARE_RETURN=O.NO_MORE_SNAPSHOTS_AVAILABLE=O.INVALID_BINDING_TYPE=O.NOT_IMPLEMENTED=O.CIRCULAR_DEPENDENCY=O.UNDEFINED_INJECT_ANNOTATION=O.MISSING_INJECT_ANNOTATION=O.MISSING_INJECTABLE_ANNOTATION=O.NOT_REGISTERED=O.CANNOT_UNBIND=O.AMBIGUOUS_MATCH=O.KEY_NOT_FOUND=O.NULL_ARGUMENT=O.DUPLICATED_METADATA=O.DUPLICATED_INJECTABLE_DECORATOR=void 0,O.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",O.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",O.NULL_ARGUMENT="NULL argument",O.KEY_NOT_FOUND="Key Not Found",O.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",O.CANNOT_UNBIND="Could not unbind serviceIdentifier:",O.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",O.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",O.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var _=function(b){return"@inject called with undefined this could mean that the class "+b+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};O.UNDEFINED_INJECT_ANNOTATION=_,O.CIRCULAR_DEPENDENCY="Circular dependency found:",O.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",O.INVALID_BINDING_TYPE="Invalid binding type:",O.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",O.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",O.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",O.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",O.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var Q=function(){for(var b=[],X=0;X<arguments.length;X++)b[X]=arguments[X];return"The number of constructor arguments in the derived class "+(b[0]+" must be >= than the number of constructor arguments of its base class.")};O.ARGUMENTS_LENGTH_MISMATCH=Q,O.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",O.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",O.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",O.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",O.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var E=function(){for(var b=[],X=0;X<arguments.length;X++)b[X]=arguments[X];return"@postConstruct error in class "+b[0]+": "+b[1]};O.POST_CONSTRUCT_ERROR=E;var p=function(){for(var b=[],X=0;X<arguments.length;X++)b[X]=arguments[X];return"It looks like there is a circular dependency "+("in one of the '"+b[0]+"' bindings. Please investigate bindings with")+("service identifier '"+b[1]+"'.")};O.CIRCULAR_DEPENDENCY_IN_FACTORY=p,O.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(ar,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.TargetTypeEnum=O.BindingTypeEnum=O.BindingScopeEnum=void 0;var _={Request:"Request",Singleton:"Singleton",Transient:"Transient"};O.BindingScopeEnum=_;var Q={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};O.BindingTypeEnum=Q;var E={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};O.TargetTypeEnum=E},6867:function(ar,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.NON_CUSTOM_TAG_KEYS=O.POST_CONSTRUCT=O.DESIGN_PARAM_TYPES=O.PARAM_TYPES=O.TAGGED_PROP=O.TAGGED=O.MULTI_INJECT_TAG=O.INJECT_TAG=O.OPTIONAL_TAG=O.UNMANAGED_TAG=O.NAME_TAG=O.NAMED_TAG=void 0,O.NAMED_TAG="named",O.NAME_TAG="name",O.UNMANAGED_TAG="unmanaged",O.OPTIONAL_TAG="optional",O.INJECT_TAG="inject",O.MULTI_INJECT_TAG="multi_inject",O.TAGGED="inversify:tagged",O.TAGGED_PROP="inversify:tagged_props",O.PARAM_TYPES="inversify:paramtypes",O.DESIGN_PARAM_TYPES="design:paramtypes",O.POST_CONSTRUCT="post_construct";function _(){return[O.INJECT_TAG,O.MULTI_INJECT_TAG,O.NAME_TAG,O.UNMANAGED_TAG,O.NAMED_TAG,O.OPTIONAL_TAG]}O.NON_CUSTOM_TAG_KEYS=_()},51389:function(ar,O,_){"use strict";var Q=this&&this.__awaiter||function(Ot,bt,dt,Pr){function er(Ft){return Ft instanceof dt?Ft:new dt(function(tt){tt(Ft)})}return new(dt||(dt=Promise))(function(Ft,tt){function Ne(Ae){try{Ie(Pr.next(Ae))}catch(Ue){tt(Ue)}}function Qe(Ae){try{Ie(Pr.throw(Ae))}catch(Ue){tt(Ue)}}function Ie(Ae){Ae.done?Ft(Ae.value):er(Ae.value).then(Ne,Qe)}Ie((Pr=Pr.apply(Ot,bt||[])).next())})},E=this&&this.__generator||function(Ot,bt){var dt={label:0,sent:function(){if(Ft[0]&1)throw Ft[1];return Ft[1]},trys:[],ops:[]},Pr,er,Ft,tt;return tt={next:Ne(0),throw:Ne(1),return:Ne(2)},typeof Symbol=="function"&&(tt[Symbol.iterator]=function(){return this}),tt;function Ne(Ie){return function(Ae){return Qe([Ie,Ae])}}function Qe(Ie){if(Pr)throw new TypeError("Generator is already executing.");for(;dt;)try{if(Pr=1,er&&(Ft=Ie[0]&2?er.return:Ie[0]?er.throw||((Ft=er.return)&&Ft.call(er),0):er.next)&&!(Ft=Ft.call(er,Ie[1])).done)return Ft;switch(er=0,Ft&&(Ie=[Ie[0]&2,Ft.value]),Ie[0]){case 0:case 1:Ft=Ie;break;case 4:return dt.label++,{value:Ie[1],done:!1};case 5:dt.label++,er=Ie[1],Ie=[0];continue;case 7:Ie=dt.ops.pop(),dt.trys.pop();continue;default:if(Ft=dt.trys,!(Ft=Ft.length>0&&Ft[Ft.length-1])&&(Ie[0]===6||Ie[0]===2)){dt=0;continue}if(Ie[0]===3&&(!Ft||Ie[1]>Ft[0]&&Ie[1]<Ft[3])){dt.label=Ie[1];break}if(Ie[0]===6&&dt.label<Ft[1]){dt.label=Ft[1],Ft=Ie;break}if(Ft&&dt.label<Ft[2]){dt.label=Ft[2],dt.ops.push(Ie);break}Ft[2]&&dt.ops.pop(),dt.trys.pop();continue}Ie=bt.call(Ot,dt)}catch(Ae){Ie=[6,Ae],er=0}finally{Pr=Ft=0}if(Ie[0]&5)throw Ie[1];return{value:Ie[0]?Ie[1]:void 0,done:!0}}},p=this&&this.__spreadArray||function(Ot,bt){for(var dt=0,Pr=bt.length,er=Ot.length;dt<Pr;dt++,er++)Ot[er]=bt[dt];return Ot};Object.defineProperty(O,"__esModule",{value:!0}),O.Container=void 0;var b=_(44290),X=_(16674),W=_(28421),$=_(6867),I=_(51377),k=_(86311),Ce=_(31927),Be=_(15451),We=_(37791),$e=_(55800),Vt=_(85700),Ht=_(80175),At=function(){function Ot(bt){this._appliedMiddleware=[];var dt=bt||{};if(typeof dt!="object")throw new Error(""+X.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(dt.defaultScope===void 0)dt.defaultScope=W.BindingScopeEnum.Transient;else if(dt.defaultScope!==W.BindingScopeEnum.Singleton&&dt.defaultScope!==W.BindingScopeEnum.Transient&&dt.defaultScope!==W.BindingScopeEnum.Request)throw new Error(""+X.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(dt.autoBindInjectable===void 0)dt.autoBindInjectable=!1;else if(typeof dt.autoBindInjectable!="boolean")throw new Error(""+X.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(dt.skipBaseClassChecks===void 0)dt.skipBaseClassChecks=!1;else if(typeof dt.skipBaseClassChecks!="boolean")throw new Error(""+X.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:dt.autoBindInjectable,defaultScope:dt.defaultScope,skipBaseClassChecks:dt.skipBaseClassChecks},this.id=We.id(),this._bindingDictionary=new Ht.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new I.MetadataReader}return Ot.merge=function(bt,dt){for(var Pr=[],er=2;er<arguments.length;er++)Pr[er-2]=arguments[er];var Ft=new Ot,tt=p([bt,dt],Pr).map(function(Ie){return k.getBindingDictionary(Ie)}),Ne=k.getBindingDictionary(Ft);function Qe(Ie,Ae){Ie.traverse(function(Ue,St){St.forEach(function(ur){Ae.add(ur.serviceIdentifier,ur.clone())})})}return tt.forEach(function(Ie){Qe(Ie,Ne)}),Ft},Ot.prototype.load=function(){for(var bt=[],dt=0;dt<arguments.length;dt++)bt[dt]=arguments[dt];for(var Pr=this._getContainerModuleHelpersFactory(),er=0,Ft=bt;er<Ft.length;er++){var tt=Ft[er],Ne=Pr(tt.id);tt.registry(Ne.bindFunction,Ne.unbindFunction,Ne.isboundFunction,Ne.rebindFunction)}},Ot.prototype.loadAsync=function(){for(var bt=[],dt=0;dt<arguments.length;dt++)bt[dt]=arguments[dt];return Q(this,void 0,void 0,function(){var Pr,er,Ft,tt,Ne;return E(this,function(Qe){switch(Qe.label){case 0:Pr=this._getContainerModuleHelpersFactory(),er=0,Ft=bt,Qe.label=1;case 1:return er<Ft.length?(tt=Ft[er],Ne=Pr(tt.id),[4,tt.registry(Ne.bindFunction,Ne.unbindFunction,Ne.isboundFunction,Ne.rebindFunction)]):[3,4];case 2:Qe.sent(),Qe.label=3;case 3:return er++,[3,1];case 4:return[2]}})})},Ot.prototype.unload=function(){for(var bt=this,dt=[],Pr=0;Pr<arguments.length;Pr++)dt[Pr]=arguments[Pr];var er=function(Ft){return function(tt){return tt.moduleId===Ft}};dt.forEach(function(Ft){var tt=er(Ft.id);bt._bindingDictionary.removeByCondition(tt)})},Ot.prototype.bind=function(bt){var dt=this.options.defaultScope||W.BindingScopeEnum.Transient,Pr=new b.Binding(bt,dt);return this._bindingDictionary.add(bt,Pr),new Be.BindingToSyntax(Pr)},Ot.prototype.rebind=function(bt){return this.unbind(bt),this.bind(bt)},Ot.prototype.unbind=function(bt){try{this._bindingDictionary.remove(bt)}catch(dt){throw new Error(X.CANNOT_UNBIND+" "+$e.getServiceIdentifierAsString(bt))}},Ot.prototype.unbindAll=function(){this._bindingDictionary=new Ht.Lookup},Ot.prototype.isBound=function(bt){var dt=this._bindingDictionary.hasKey(bt);return!dt&&this.parent&&(dt=this.parent.isBound(bt)),dt},Ot.prototype.isBoundNamed=function(bt,dt){return this.isBoundTagged(bt,$.NAMED_TAG,dt)},Ot.prototype.isBoundTagged=function(bt,dt,Pr){var er=!1;if(this._bindingDictionary.hasKey(bt)){var Ft=this._bindingDictionary.get(bt),tt=k.createMockRequest(this,bt,dt,Pr);er=Ft.some(function(Ne){return Ne.constraint(tt)})}return!er&&this.parent&&(er=this.parent.isBoundTagged(bt,dt,Pr)),er},Ot.prototype.snapshot=function(){this._snapshots.push(Vt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Ot.prototype.restore=function(){var bt=this._snapshots.pop();if(bt===void 0)throw new Error(X.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=bt.bindings,this._middleware=bt.middleware},Ot.prototype.createChild=function(bt){var dt=new Ot(bt||this.options);return dt.parent=this,dt},Ot.prototype.applyMiddleware=function(){for(var bt=[],dt=0;dt<arguments.length;dt++)bt[dt]=arguments[dt];this._appliedMiddleware=this._appliedMiddleware.concat(bt);var Pr=this._middleware?this._middleware:this._planAndResolve();this._middleware=bt.reduce(function(er,Ft){return Ft(er)},Pr)},Ot.prototype.applyCustomMetadataReader=function(bt){this._metadataReader=bt},Ot.prototype.get=function(bt){return this._get(!1,!1,W.TargetTypeEnum.Variable,bt)},Ot.prototype.getTagged=function(bt,dt,Pr){return this._get(!1,!1,W.TargetTypeEnum.Variable,bt,dt,Pr)},Ot.prototype.getNamed=function(bt,dt){return this.getTagged(bt,$.NAMED_TAG,dt)},Ot.prototype.getAll=function(bt){return this._get(!0,!0,W.TargetTypeEnum.Variable,bt)},Ot.prototype.getAllTagged=function(bt,dt,Pr){return this._get(!1,!0,W.TargetTypeEnum.Variable,bt,dt,Pr)},Ot.prototype.getAllNamed=function(bt,dt){return this.getAllTagged(bt,$.NAMED_TAG,dt)},Ot.prototype.resolve=function(bt){var dt=this.createChild();return dt.bind(bt).toSelf(),this._appliedMiddleware.forEach(function(Pr){dt.applyMiddleware(Pr)}),dt.get(bt)},Ot.prototype._getContainerModuleHelpersFactory=function(){var bt=this,dt=function(Ne,Qe){Ne._binding.moduleId=Qe},Pr=function(Ne){return function(Qe){var Ie=bt.bind.bind(bt),Ae=Ie(Qe);return dt(Ae,Ne),Ae}},er=function(Ne){return function(Qe){var Ie=bt.unbind.bind(bt);Ie(Qe)}},Ft=function(Ne){return function(Qe){var Ie=bt.isBound.bind(bt);return Ie(Qe)}},tt=function(Ne){return function(Qe){var Ie=bt.rebind.bind(bt),Ae=Ie(Qe);return dt(Ae,Ne),Ae}};return function(Ne){return{bindFunction:Pr(Ne),isboundFunction:Ft(Ne),rebindFunction:tt(Ne),unbindFunction:er(Ne)}}},Ot.prototype._get=function(bt,dt,Pr,er,Ft,tt){var Ne=null,Qe={avoidConstraints:bt,contextInterceptor:function(Ie){return Ie},isMultiInject:dt,key:Ft,serviceIdentifier:er,targetType:Pr,value:tt};if(this._middleware){if(Ne=this._middleware(Qe),Ne==null)throw new Error(X.INVALID_MIDDLEWARE_RETURN)}else Ne=this._planAndResolve()(Qe);return Ne},Ot.prototype._planAndResolve=function(){var bt=this;return function(dt){var Pr=k.plan(bt._metadataReader,bt,dt.isMultiInject,dt.targetType,dt.serviceIdentifier,dt.key,dt.value,dt.avoidConstraints);Pr=dt.contextInterceptor(Pr);var er=Ce.resolve(Pr);return er}},Ot}();O.Container=At},33244:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.AsyncContainerModule=O.ContainerModule=void 0;var Q=_(37791),E=function(){function b(X){this.id=Q.id(),this.registry=X}return b}();O.ContainerModule=E;var p=function(){function b(X){this.id=Q.id(),this.registry=X}return b}();O.AsyncContainerModule=p},85700:function(ar,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.ContainerSnapshot=void 0;var _=function(){function Q(){}return Q.of=function(E,p){var b=new Q;return b.bindings=E,b.middleware=p,b},Q}();O.ContainerSnapshot=_},80175:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Lookup=void 0;var Q=_(16674),E=function(){function p(){this._map=new Map}return p.prototype.getMap=function(){return this._map},p.prototype.add=function(b,X){if(b==null)throw new Error(Q.NULL_ARGUMENT);if(X==null)throw new Error(Q.NULL_ARGUMENT);var W=this._map.get(b);W!==void 0?(W.push(X),this._map.set(b,W)):this._map.set(b,[X])},p.prototype.get=function(b){if(b==null)throw new Error(Q.NULL_ARGUMENT);var X=this._map.get(b);if(X!==void 0)return X;throw new Error(Q.KEY_NOT_FOUND)},p.prototype.remove=function(b){if(b==null)throw new Error(Q.NULL_ARGUMENT);if(!this._map.delete(b))throw new Error(Q.KEY_NOT_FOUND)},p.prototype.removeByCondition=function(b){var X=this;this._map.forEach(function(W,$){var I=W.filter(function(k){return!b(k)});I.length>0?X._map.set($,I):X._map.delete($)})},p.prototype.hasKey=function(b){if(b==null)throw new Error(Q.NULL_ARGUMENT);return this._map.has(b)},p.prototype.clone=function(){var b=new p;return this._map.forEach(function(X,W){X.forEach(function($){return b.add(W,$.clone())})}),b},p.prototype.traverse=function(b){this._map.forEach(function(X,W){b(W,X)})},p}();O.Lookup=E},86700:function(ar,O,_){"use strict";var Q;Q={value:!0},Q=Q=Q=Q=Q=Q=O.GW=Q=Q=O.zY=Q=Q=Q=Q=Q=O.f3=Q=Q=O.b2=Q=Q=Q=Q=Q=O.W2=Q=void 0;var E=_(6867);Q=E;var p=_(51389);Object.defineProperty(O,"W2",{enumerable:!0,get:function(){return p.Container}});var b=_(28421);Q={enumerable:!0,get:function(){return b.BindingScopeEnum}},Q={enumerable:!0,get:function(){return b.BindingTypeEnum}},Q={enumerable:!0,get:function(){return b.TargetTypeEnum}};var X=_(33244);Q={enumerable:!0,get:function(){return X.AsyncContainerModule}},Q={enumerable:!0,get:function(){return X.ContainerModule}};var W=_(64315);Object.defineProperty(O,"b2",{enumerable:!0,get:function(){return W.injectable}});var $=_(32052);Q={enumerable:!0,get:function(){return $.tagged}};var I=_(38085);Q={enumerable:!0,get:function(){return I.named}};var k=_(5744);Object.defineProperty(O,"f3",{enumerable:!0,get:function(){return k.inject}}),Q={enumerable:!0,get:function(){return k.LazyServiceIdentifer}};var Ce=_(6515);Q={enumerable:!0,get:function(){return Ce.optional}};var Be=_(86757);Q={enumerable:!0,get:function(){return Be.unmanaged}};var We=_(71693);Q={enumerable:!0,get:function(){return We.multiInject}};var $e=_(55638);Q={enumerable:!0,get:function(){return $e.targetName}};var Vt=_(7014);Object.defineProperty(O,"zY",{enumerable:!0,get:function(){return Vt.postConstruct}});var Ht=_(51377);Q={enumerable:!0,get:function(){return Ht.MetadataReader}};var At=_(37791);Q={enumerable:!0,get:function(){return At.id}};var Ot=_(99934);Object.defineProperty(O,"GW",{enumerable:!0,get:function(){return Ot.decorate}});var bt=_(80758);Q={enumerable:!0,get:function(){return bt.traverseAncerstors}},Q={enumerable:!0,get:function(){return bt.taggedConstraint}},Q={enumerable:!0,get:function(){return bt.namedConstraint}},Q={enumerable:!0,get:function(){return bt.typeConstraint}};var dt=_(55800);Q={enumerable:!0,get:function(){return dt.getServiceIdentifierAsString}};var Pr=_(70600);Q={enumerable:!0,get:function(){return Pr.multiBindToService}}},95228:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Context=void 0;var Q=_(37791),E=function(){function p(b){this.id=Q.id(),this.container=b}return p.prototype.addPlan=function(b){this.plan=b},p.prototype.setCurrentRequest=function(b){this.currentRequest=b},p}();O.Context=E},47738:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Metadata=void 0;var Q=_(6867),E=function(){function p(b,X){this.key=b,this.value=X}return p.prototype.toString=function(){return this.key===Q.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},p}();O.Metadata=E},51377:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.MetadataReader=void 0;var Q=_(6867),E=function(){function p(){}return p.prototype.getConstructorMetadata=function(b){var X=Reflect.getMetadata(Q.PARAM_TYPES,b),W=Reflect.getMetadata(Q.TAGGED,b);return{compilerGeneratedMetadata:X,userGeneratedMetadata:W||{}}},p.prototype.getPropertiesMetadata=function(b){var X=Reflect.getMetadata(Q.TAGGED_PROP,b)||[];return X},p}();O.MetadataReader=E},55314:function(ar,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Plan=void 0;var _=function(){function Q(E,p){this.parentContext=E,this.rootRequest=p}return Q}();O.Plan=_},86311:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.getBindingDictionary=O.createMockRequest=O.plan=void 0;var Q=_(23184),E=_(16674),p=_(28421),b=_(6867),X=_(85265),W=_(55800),$=_(95228),I=_(47738),k=_(55314),Ce=_(6e3),Be=_(6748),We=_(18924);function $e(er){return er._bindingDictionary}O.getBindingDictionary=$e;function Vt(er,Ft,tt,Ne,Qe,Ie){var Ae=er?b.MULTI_INJECT_TAG:b.INJECT_TAG,Ue=new I.Metadata(Ae,tt),St=new We.Target(Ft,Ne,tt,Ue);if(Qe!==void 0){var ur=new I.Metadata(Qe,Ie);St.metadata.push(ur)}return St}function Ht(er,Ft,tt,Ne,Qe){var Ie=bt(tt.container,Qe.serviceIdentifier),Ae=[];return Ie.length===Q.BindingCount.NoBindingsAvailable&&tt.container.options.autoBindInjectable&&typeof Qe.serviceIdentifier=="function"&&er.getConstructorMetadata(Qe.serviceIdentifier).compilerGeneratedMetadata&&(tt.container.bind(Qe.serviceIdentifier).toSelf(),Ie=bt(tt.container,Qe.serviceIdentifier)),Ft?Ae=Ie:Ae=Ie.filter(function(Ue){var St=new Be.Request(Ue.serviceIdentifier,tt,Ne,Ue,Qe);return Ue.constraint(St)}),At(Qe.serviceIdentifier,Ae,Qe,tt.container),Ae}function At(er,Ft,tt,Ne){switch(Ft.length){case Q.BindingCount.NoBindingsAvailable:if(tt.isOptional())return Ft;var Qe=W.getServiceIdentifierAsString(er),Ie=E.NOT_REGISTERED;throw Ie+=W.listMetadataForTarget(Qe,tt),Ie+=W.listRegisteredBindingsForServiceIdentifier(Ne,Qe,bt),new Error(Ie);case Q.BindingCount.OnlyOneBindingAvailable:if(!tt.isArray())return Ft;case Q.BindingCount.MultipleBindingsAvailable:default:if(tt.isArray())return Ft;var Qe=W.getServiceIdentifierAsString(er),Ie=E.AMBIGUOUS_MATCH+" "+Qe;throw Ie+=W.listRegisteredBindingsForServiceIdentifier(Ne,Qe,bt),new Error(Ie)}}function Ot(er,Ft,tt,Ne,Qe,Ie){var Ae,Ue;if(Qe===null){Ae=Ht(er,Ft,Ne,null,Ie),Ue=new Be.Request(tt,Ne,null,Ae,Ie);var St=new k.Plan(Ne,Ue);Ne.addPlan(St)}else Ae=Ht(er,Ft,Ne,Qe,Ie),Ue=Qe.addChildRequest(Ie.serviceIdentifier,Ae,Ie);Ae.forEach(function(ur){var ae=null;if(Ie.isArray())ae=Ue.addChildRequest(ur.serviceIdentifier,ur,Ie);else{if(ur.cache)return;ae=Ue}if(ur.type===p.BindingTypeEnum.Instance&&ur.implementationType!==null){var Te=Ce.getDependencies(er,ur.implementationType);if(!Ne.container.options.skipBaseClassChecks){var oe=Ce.getBaseClassDependencyCount(er,ur.implementationType);if(Te.length<oe){var me=E.ARGUMENTS_LENGTH_MISMATCH(Ce.getFunctionName(ur.implementationType));throw new Error(me)}}Te.forEach(function(Me){Ot(er,!1,Me.serviceIdentifier,Ne,ae,Me)})}})}function bt(er,Ft){var tt=[],Ne=$e(er);return Ne.hasKey(Ft)?tt=Ne.get(Ft):er.parent!==null&&(tt=bt(er.parent,Ft)),tt}function dt(er,Ft,tt,Ne,Qe,Ie,Ae,Ue){Ue===void 0&&(Ue=!1);var St=new $.Context(Ft),ur=Vt(tt,Ne,Qe,"",Ie,Ae);try{return Ot(er,Ue,Qe,St,null,ur),St}catch(ae){throw X.isStackOverflowExeption(ae)&&St.plan&&W.circularDependencyToException(St.plan.rootRequest),ae}}O.plan=dt;function Pr(er,Ft,tt,Ne){var Qe=new We.Target(p.TargetTypeEnum.Variable,"",Ft,new I.Metadata(tt,Ne)),Ie=new $.Context(er),Ae=new Be.Request(Ft,Ie,null,[],Qe);return Ae}O.createMockRequest=Pr},88460:function(ar,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.QueryableString=void 0;var _=function(){function Q(E){this.str=E}return Q.prototype.startsWith=function(E){return this.str.indexOf(E)===0},Q.prototype.endsWith=function(E){var p="",b=E.split("").reverse().join("");return p=this.str.split("").reverse().join(""),this.startsWith.call({str:p},b)},Q.prototype.contains=function(E){return this.str.indexOf(E)!==-1},Q.prototype.equals=function(E){return this.str===E},Q.prototype.value=function(){return this.str},Q}();O.QueryableString=_},6e3:function(ar,O,_){"use strict";var Q=this&&this.__spreadArray||function(Ht,At){for(var Ot=0,bt=At.length,dt=Ht.length;Ot<bt;Ot++,dt++)Ht[dt]=At[Ot];return Ht};Object.defineProperty(O,"__esModule",{value:!0}),O.getFunctionName=O.getBaseClassDependencyCount=O.getDependencies=void 0;var E=_(5744),p=_(16674),b=_(28421),X=_(6867),W=_(55800);Object.defineProperty(O,"getFunctionName",{enumerable:!0,get:function(){return W.getFunctionName}});var $=_(18924);function I(Ht,At){var Ot=W.getFunctionName(At),bt=k(Ht,Ot,At,!1);return bt}O.getDependencies=I;function k(Ht,At,Ot,bt){var dt=Ht.getConstructorMetadata(Ot),Pr=dt.compilerGeneratedMetadata;if(Pr===void 0){var er=p.MISSING_INJECTABLE_ANNOTATION+" "+At+".";throw new Error(er)}var Ft=dt.userGeneratedMetadata,tt=Object.keys(Ft),Ne=Ot.length===0&&tt.length>0,Qe=tt.length>Ot.length,Ie=Ne||Qe?tt.length:Ot.length,Ae=Be(bt,At,Pr,Ft,Ie),Ue=We(Ht,Ot),St=Q(Q([],Ae),Ue);return St}function Ce(Ht,At,Ot,bt,dt){var Pr=dt[Ht.toString()]||[],er=Vt(Pr),Ft=er.unmanaged!==!0,tt=bt[Ht],Ne=er.inject||er.multiInject;if(tt=Ne||tt,tt instanceof E.LazyServiceIdentifer&&(tt=tt.unwrap()),Ft){var Qe=tt===Object,Ie=tt===Function,Ae=tt===void 0,Ue=Qe||Ie||Ae;if(!At&&Ue){var St=p.MISSING_INJECT_ANNOTATION+" argument "+Ht+" in class "+Ot+".";throw new Error(St)}var ur=new $.Target(b.TargetTypeEnum.ConstructorArgument,er.targetName,tt);return ur.metadata=Pr,ur}return null}function Be(Ht,At,Ot,bt,dt){for(var Pr=[],er=0;er<dt;er++){var Ft=er,tt=Ce(Ft,Ht,At,Ot,bt);tt!==null&&Pr.push(tt)}return Pr}function We(Ht,At){for(var Ot=Ht.getPropertiesMetadata(At),bt=[],dt=Object.keys(Ot),Pr=0,er=dt;Pr<er.length;Pr++){var Ft=er[Pr],tt=Ot[Ft],Ne=Vt(Ot[Ft]),Qe=Ne.targetName||Ft,Ie=Ne.inject||Ne.multiInject,Ae=new $.Target(b.TargetTypeEnum.ClassProperty,Qe,Ie);Ae.metadata=tt,bt.push(Ae)}var Ue=Object.getPrototypeOf(At.prototype).constructor;if(Ue!==Object){var St=We(Ht,Ue);bt=Q(Q([],bt),St)}return bt}function $e(Ht,At){var Ot=Object.getPrototypeOf(At.prototype).constructor;if(Ot!==Object){var bt=W.getFunctionName(Ot),dt=k(Ht,bt,Ot,!0),Pr=dt.map(function(tt){return tt.metadata.filter(function(Ne){return Ne.key===X.UNMANAGED_TAG})}),er=[].concat.apply([],Pr).length,Ft=dt.length-er;return Ft>0?Ft:$e(Ht,Ot)}else return 0}O.getBaseClassDependencyCount=$e;function Vt(Ht){var At={};return Ht.forEach(function(Ot){At[Ot.key.toString()]=Ot.value}),{inject:At[X.INJECT_TAG],multiInject:At[X.MULTI_INJECT_TAG],targetName:At[X.NAME_TAG],unmanaged:At[X.UNMANAGED_TAG]}}},6748:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Request=void 0;var Q=_(37791),E=function(){function p(b,X,W,$,I){this.id=Q.id(),this.serviceIdentifier=b,this.parentContext=X,this.parentRequest=W,this.target=I,this.childRequests=[],this.bindings=Array.isArray($)?$:[$],this.requestScope=W===null?new Map:null}return p.prototype.addChildRequest=function(b,X,W){var $=new p(b,this.parentContext,this,X,W);return this.childRequests.push($),$},p}();O.Request=E},18924:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.Target=void 0;var Q=_(6867),E=_(37791),p=_(47738),b=_(88460),X=function(){function W($,I,k,Ce){this.id=E.id(),this.type=$,this.serviceIdentifier=k,this.name=new b.QueryableString(I||""),this.metadata=new Array;var Be=null;typeof Ce=="string"?Be=new p.Metadata(Q.NAMED_TAG,Ce):Ce instanceof p.Metadata&&(Be=Ce),Be!==null&&this.metadata.push(Be)}return W.prototype.hasTag=function($){for(var I=0,k=this.metadata;I<k.length;I++){var Ce=k[I];if(Ce.key===$)return!0}return!1},W.prototype.isArray=function(){return this.hasTag(Q.MULTI_INJECT_TAG)},W.prototype.matchesArray=function($){return this.matchesTag(Q.MULTI_INJECT_TAG)($)},W.prototype.isNamed=function(){return this.hasTag(Q.NAMED_TAG)},W.prototype.isTagged=function(){return this.metadata.some(function($){return Q.NON_CUSTOM_TAG_KEYS.every(function(I){return $.key!==I})})},W.prototype.isOptional=function(){return this.matchesTag(Q.OPTIONAL_TAG)(!0)},W.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function($){return $.key===Q.NAMED_TAG})[0]:null},W.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function($){return Q.NON_CUSTOM_TAG_KEYS.every(function(I){return $.key!==I})}):null},W.prototype.matchesNamedTag=function($){return this.matchesTag(Q.NAMED_TAG)($)},W.prototype.matchesTag=function($){var I=this;return function(k){for(var Ce=0,Be=I.metadata;Ce<Be.length;Ce++){var We=Be[Ce];if(We.key===$&&We.value===k)return!0}return!1}},W}();O.Target=X},52279:function(ar,O,_){"use strict";var Q=this&&this.__spreadArray||function(k,Ce){for(var Be=0,We=Ce.length,$e=k.length;Be<We;Be++,$e++)k[$e]=Ce[Be];return k};Object.defineProperty(O,"__esModule",{value:!0}),O.resolveInstance=void 0;var E=_(16674),p=_(28421),b=_(6867);function X(k,Ce,Be){var We=Ce.filter(function(Vt){return Vt.target!==null&&Vt.target.type===p.TargetTypeEnum.ClassProperty}),$e=We.map(Be);return We.forEach(function(Vt,Ht){var At="";At=Vt.target.name.value();var Ot=$e[Ht];k[At]=Ot}),k}function W(k,Ce){return new(k.bind.apply(k,Q([void 0],Ce)))}function $(k,Ce){if(Reflect.hasMetadata(b.POST_CONSTRUCT,k)){var Be=Reflect.getMetadata(b.POST_CONSTRUCT,k);try{Ce[Be.value]()}catch(We){throw new Error(E.POST_CONSTRUCT_ERROR(k.name,We.message))}}}function I(k,Ce,Be){var We=null;if(Ce.length>0){var $e=Ce.filter(function(Ht){return Ht.target!==null&&Ht.target.type===p.TargetTypeEnum.ConstructorArgument}),Vt=$e.map(Be);We=W(k,Vt),We=X(We,Ce,Be)}else We=new k;return $(k,We),We}O.resolveInstance=I},31927:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.resolve=void 0;var Q=_(16674),E=_(28421),p=_(85265),b=_(55800),X=_(52279),W=function(k,Ce,Be){try{return Be()}catch(We){throw p.isStackOverflowExeption(We)?new Error(Q.CIRCULAR_DEPENDENCY_IN_FACTORY(k,Ce.toString())):We}},$=function(k){return function(Ce){Ce.parentContext.setCurrentRequest(Ce);var Be=Ce.bindings,We=Ce.childRequests,$e=Ce.target&&Ce.target.isArray(),Vt=!Ce.parentRequest||!Ce.parentRequest.target||!Ce.target||!Ce.parentRequest.target.matchesArray(Ce.target.serviceIdentifier);if($e&&Vt)return We.map(function(Pr){var er=$(k);return er(Pr)});var Ht=null;if(Ce.target.isOptional()&&Be.length===0)return;var At=Be[0],Ot=At.scope===E.BindingScopeEnum.Singleton,bt=At.scope===E.BindingScopeEnum.Request;if(Ot&&At.activated)return At.cache;if(bt&&k!==null&&k.has(At.id))return k.get(At.id);if(At.type===E.BindingTypeEnum.ConstantValue)Ht=At.cache,At.activated=!0;else if(At.type===E.BindingTypeEnum.Function)Ht=At.cache,At.activated=!0;else if(At.type===E.BindingTypeEnum.Constructor)Ht=At.implementationType;else if(At.type===E.BindingTypeEnum.DynamicValue&&At.dynamicValue!==null)Ht=W("toDynamicValue",At.serviceIdentifier,function(){return At.dynamicValue(Ce.parentContext)});else if(At.type===E.BindingTypeEnum.Factory&&At.factory!==null)Ht=W("toFactory",At.serviceIdentifier,function(){return At.factory(Ce.parentContext)});else if(At.type===E.BindingTypeEnum.Provider&&At.provider!==null)Ht=W("toProvider",At.serviceIdentifier,function(){return At.provider(Ce.parentContext)});else if(At.type===E.BindingTypeEnum.Instance&&At.implementationType!==null)Ht=X.resolveInstance(At.implementationType,We,$(k));else{var dt=b.getServiceIdentifierAsString(Ce.serviceIdentifier);throw new Error(Q.INVALID_BINDING_TYPE+" "+dt)}return typeof At.onActivation=="function"&&(Ht=At.onActivation(Ce.parentContext,Ht)),Ot&&(At.cache=Ht,At.activated=!0),bt&&k!==null&&!k.has(At.id)&&k.set(At.id,Ht),Ht}};function I(k){var Ce=$(k.plan.rootRequest.requestScope);return Ce(k.plan.rootRequest)}O.resolve=I},83366:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingInSyntax=void 0;var Q=_(28421),E=_(71325),p=function(){function b(X){this._binding=X}return b.prototype.inRequestScope=function(){return this._binding.scope=Q.BindingScopeEnum.Request,new E.BindingWhenOnSyntax(this._binding)},b.prototype.inSingletonScope=function(){return this._binding.scope=Q.BindingScopeEnum.Singleton,new E.BindingWhenOnSyntax(this._binding)},b.prototype.inTransientScope=function(){return this._binding.scope=Q.BindingScopeEnum.Transient,new E.BindingWhenOnSyntax(this._binding)},b}();O.BindingInSyntax=p},74889:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingInWhenOnSyntax=void 0;var Q=_(83366),E=_(51811),p=_(98370),b=function(){function X(W){this._binding=W,this._bindingWhenSyntax=new p.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new E.BindingOnSyntax(this._binding),this._bindingInSyntax=new Q.BindingInSyntax(W)}return X.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},X.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},X.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},X.prototype.when=function(W){return this._bindingWhenSyntax.when(W)},X.prototype.whenTargetNamed=function(W){return this._bindingWhenSyntax.whenTargetNamed(W)},X.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},X.prototype.whenTargetTagged=function(W,$){return this._bindingWhenSyntax.whenTargetTagged(W,$)},X.prototype.whenInjectedInto=function(W){return this._bindingWhenSyntax.whenInjectedInto(W)},X.prototype.whenParentNamed=function(W){return this._bindingWhenSyntax.whenParentNamed(W)},X.prototype.whenParentTagged=function(W,$){return this._bindingWhenSyntax.whenParentTagged(W,$)},X.prototype.whenAnyAncestorIs=function(W){return this._bindingWhenSyntax.whenAnyAncestorIs(W)},X.prototype.whenNoAncestorIs=function(W){return this._bindingWhenSyntax.whenNoAncestorIs(W)},X.prototype.whenAnyAncestorNamed=function(W){return this._bindingWhenSyntax.whenAnyAncestorNamed(W)},X.prototype.whenAnyAncestorTagged=function(W,$){return this._bindingWhenSyntax.whenAnyAncestorTagged(W,$)},X.prototype.whenNoAncestorNamed=function(W){return this._bindingWhenSyntax.whenNoAncestorNamed(W)},X.prototype.whenNoAncestorTagged=function(W,$){return this._bindingWhenSyntax.whenNoAncestorTagged(W,$)},X.prototype.whenAnyAncestorMatches=function(W){return this._bindingWhenSyntax.whenAnyAncestorMatches(W)},X.prototype.whenNoAncestorMatches=function(W){return this._bindingWhenSyntax.whenNoAncestorMatches(W)},X.prototype.onActivation=function(W){return this._bindingOnSyntax.onActivation(W)},X}();O.BindingInWhenOnSyntax=b},51811:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingOnSyntax=void 0;var Q=_(98370),E=function(){function p(b){this._binding=b}return p.prototype.onActivation=function(b){return this._binding.onActivation=b,new Q.BindingWhenSyntax(this._binding)},p}();O.BindingOnSyntax=E},15451:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingToSyntax=void 0;var Q=_(16674),E=_(28421),p=_(74889),b=_(71325),X=function(){function W($){this._binding=$}return W.prototype.to=function($){return this._binding.type=E.BindingTypeEnum.Instance,this._binding.implementationType=$,new p.BindingInWhenOnSyntax(this._binding)},W.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Q.INVALID_TO_SELF_VALUE);var $=this._binding.serviceIdentifier;return this.to($)},W.prototype.toConstantValue=function($){return this._binding.type=E.BindingTypeEnum.ConstantValue,this._binding.cache=$,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=E.BindingScopeEnum.Singleton,new b.BindingWhenOnSyntax(this._binding)},W.prototype.toDynamicValue=function($){return this._binding.type=E.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=$,this._binding.implementationType=null,new p.BindingInWhenOnSyntax(this._binding)},W.prototype.toConstructor=function($){return this._binding.type=E.BindingTypeEnum.Constructor,this._binding.implementationType=$,this._binding.scope=E.BindingScopeEnum.Singleton,new b.BindingWhenOnSyntax(this._binding)},W.prototype.toFactory=function($){return this._binding.type=E.BindingTypeEnum.Factory,this._binding.factory=$,this._binding.scope=E.BindingScopeEnum.Singleton,new b.BindingWhenOnSyntax(this._binding)},W.prototype.toFunction=function($){if(typeof $!="function")throw new Error(Q.INVALID_FUNCTION_BINDING);var I=this.toConstantValue($);return this._binding.type=E.BindingTypeEnum.Function,this._binding.scope=E.BindingScopeEnum.Singleton,I},W.prototype.toAutoFactory=function($){return this._binding.type=E.BindingTypeEnum.Factory,this._binding.factory=function(I){var k=function(){return I.container.get($)};return k},this._binding.scope=E.BindingScopeEnum.Singleton,new b.BindingWhenOnSyntax(this._binding)},W.prototype.toProvider=function($){return this._binding.type=E.BindingTypeEnum.Provider,this._binding.provider=$,this._binding.scope=E.BindingScopeEnum.Singleton,new b.BindingWhenOnSyntax(this._binding)},W.prototype.toService=function($){this.toDynamicValue(function(I){return I.container.get($)})},W}();O.BindingToSyntax=X},71325:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingWhenOnSyntax=void 0;var Q=_(51811),E=_(98370),p=function(){function b(X){this._binding=X,this._bindingWhenSyntax=new E.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Q.BindingOnSyntax(this._binding)}return b.prototype.when=function(X){return this._bindingWhenSyntax.when(X)},b.prototype.whenTargetNamed=function(X){return this._bindingWhenSyntax.whenTargetNamed(X)},b.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},b.prototype.whenTargetTagged=function(X,W){return this._bindingWhenSyntax.whenTargetTagged(X,W)},b.prototype.whenInjectedInto=function(X){return this._bindingWhenSyntax.whenInjectedInto(X)},b.prototype.whenParentNamed=function(X){return this._bindingWhenSyntax.whenParentNamed(X)},b.prototype.whenParentTagged=function(X,W){return this._bindingWhenSyntax.whenParentTagged(X,W)},b.prototype.whenAnyAncestorIs=function(X){return this._bindingWhenSyntax.whenAnyAncestorIs(X)},b.prototype.whenNoAncestorIs=function(X){return this._bindingWhenSyntax.whenNoAncestorIs(X)},b.prototype.whenAnyAncestorNamed=function(X){return this._bindingWhenSyntax.whenAnyAncestorNamed(X)},b.prototype.whenAnyAncestorTagged=function(X,W){return this._bindingWhenSyntax.whenAnyAncestorTagged(X,W)},b.prototype.whenNoAncestorNamed=function(X){return this._bindingWhenSyntax.whenNoAncestorNamed(X)},b.prototype.whenNoAncestorTagged=function(X,W){return this._bindingWhenSyntax.whenNoAncestorTagged(X,W)},b.prototype.whenAnyAncestorMatches=function(X){return this._bindingWhenSyntax.whenAnyAncestorMatches(X)},b.prototype.whenNoAncestorMatches=function(X){return this._bindingWhenSyntax.whenNoAncestorMatches(X)},b.prototype.onActivation=function(X){return this._bindingOnSyntax.onActivation(X)},b}();O.BindingWhenOnSyntax=p},98370:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.BindingWhenSyntax=void 0;var Q=_(51811),E=_(80758),p=function(){function b(X){this._binding=X}return b.prototype.when=function(X){return this._binding.constraint=X,new Q.BindingOnSyntax(this._binding)},b.prototype.whenTargetNamed=function(X){return this._binding.constraint=E.namedConstraint(X),new Q.BindingOnSyntax(this._binding)},b.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(X){var W=X.target!==null&&!X.target.isNamed()&&!X.target.isTagged();return W},new Q.BindingOnSyntax(this._binding)},b.prototype.whenTargetTagged=function(X,W){return this._binding.constraint=E.taggedConstraint(X)(W),new Q.BindingOnSyntax(this._binding)},b.prototype.whenInjectedInto=function(X){return this._binding.constraint=function(W){return E.typeConstraint(X)(W.parentRequest)},new Q.BindingOnSyntax(this._binding)},b.prototype.whenParentNamed=function(X){return this._binding.constraint=function(W){return E.namedConstraint(X)(W.parentRequest)},new Q.BindingOnSyntax(this._binding)},b.prototype.whenParentTagged=function(X,W){return this._binding.constraint=function($){return E.taggedConstraint(X)(W)($.parentRequest)},new Q.BindingOnSyntax(this._binding)},b.prototype.whenAnyAncestorIs=function(X){return this._binding.constraint=function(W){return E.traverseAncerstors(W,E.typeConstraint(X))},new Q.BindingOnSyntax(this._binding)},b.prototype.whenNoAncestorIs=function(X){return this._binding.constraint=function(W){return!E.traverseAncerstors(W,E.typeConstraint(X))},new Q.BindingOnSyntax(this._binding)},b.prototype.whenAnyAncestorNamed=function(X){return this._binding.constraint=function(W){return E.traverseAncerstors(W,E.namedConstraint(X))},new Q.BindingOnSyntax(this._binding)},b.prototype.whenNoAncestorNamed=function(X){return this._binding.constraint=function(W){return!E.traverseAncerstors(W,E.namedConstraint(X))},new Q.BindingOnSyntax(this._binding)},b.prototype.whenAnyAncestorTagged=function(X,W){return this._binding.constraint=function($){return E.traverseAncerstors($,E.taggedConstraint(X)(W))},new Q.BindingOnSyntax(this._binding)},b.prototype.whenNoAncestorTagged=function(X,W){return this._binding.constraint=function($){return!E.traverseAncerstors($,E.taggedConstraint(X)(W))},new Q.BindingOnSyntax(this._binding)},b.prototype.whenAnyAncestorMatches=function(X){return this._binding.constraint=function(W){return E.traverseAncerstors(W,X)},new Q.BindingOnSyntax(this._binding)},b.prototype.whenNoAncestorMatches=function(X){return this._binding.constraint=function(W){return!E.traverseAncerstors(W,X)},new Q.BindingOnSyntax(this._binding)},b}();O.BindingWhenSyntax=p},80758:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.typeConstraint=O.namedConstraint=O.taggedConstraint=O.traverseAncerstors=void 0;var Q=_(6867),E=_(47738),p=function($,I){var k=$.parentRequest;return k!==null?I(k)?!0:p(k,I):!1};O.traverseAncerstors=p;var b=function($){return function(I){var k=function(Ce){return Ce!==null&&Ce.target!==null&&Ce.target.matchesTag($)(I)};return k.metaData=new E.Metadata($,I),k}};O.taggedConstraint=b;var X=b(Q.NAMED_TAG);O.namedConstraint=X;var W=function($){return function(I){var k=null;if(I!==null)if(k=I.bindings[0],typeof $=="string"){var Ce=k.serviceIdentifier;return Ce===$}else{var Be=I.bindings[0].implementationType;return $===Be}return!1}};O.typeConstraint=W},70600:function(ar,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.multiBindToService=void 0;var _=function(Q){return function(E){return function(){for(var p=[],b=0;b<arguments.length;b++)p[b]=arguments[b];return p.forEach(function(X){return Q.bind(X).toService(E)})}}};O.multiBindToService=_},85265:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.isStackOverflowExeption=void 0;var Q=_(16674);function E(p){return p instanceof RangeError||p.message===Q.STACK_OVERFLOW}O.isStackOverflowExeption=E},37791:function(ar,O){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.id=void 0;var _=0;function Q(){return _++}O.id=Q},55800:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.circularDependencyToException=O.listMetadataForTarget=O.listRegisteredBindingsForServiceIdentifier=O.getServiceIdentifierAsString=O.getFunctionName=void 0;var Q=_(16674);function E(k){if(typeof k=="function"){var Ce=k;return Ce.name}else{if(typeof k=="symbol")return k.toString();var Ce=k;return Ce}}O.getServiceIdentifierAsString=E;function p(k,Ce,Be){var We="",$e=Be(k,Ce);return $e.length!==0&&(We=`
Registered bindings:`,$e.forEach(function(Vt){var Ht="Object";Vt.implementationType!==null&&(Ht=I(Vt.implementationType)),We=We+`
 `+Ht,Vt.constraint.metaData&&(We=We+" - "+Vt.constraint.metaData)})),We}O.listRegisteredBindingsForServiceIdentifier=p;function b(k,Ce){return k.parentRequest===null?!1:k.parentRequest.serviceIdentifier===Ce?!0:b(k.parentRequest,Ce)}function X(k){function Ce(We,$e){$e===void 0&&($e=[]);var Vt=E(We.serviceIdentifier);return $e.push(Vt),We.parentRequest!==null?Ce(We.parentRequest,$e):$e}var Be=Ce(k);return Be.reverse().join(" --> ")}function W(k){k.childRequests.forEach(function(Ce){if(b(Ce,Ce.serviceIdentifier)){var Be=X(Ce);throw new Error(Q.CIRCULAR_DEPENDENCY+" "+Be)}else W(Ce)})}O.circularDependencyToException=W;function $(k,Ce){if(Ce.isTagged()||Ce.isNamed()){var Be="",We=Ce.getNamedTag(),$e=Ce.getCustomTags();return We!==null&&(Be+=We.toString()+`
`),$e!==null&&$e.forEach(function(Vt){Be+=Vt.toString()+`
`})," "+k+`
 `+k+" - "+Be}else return" "+k}O.listMetadataForTarget=$;function I(k){if(k.name)return k.name;var Ce=k.toString(),Be=Ce.match(/^function\s*([^\s(]+)/);return Be?Be[1]:"Anonymous function: "+Ce}O.getFunctionName=I},68982:function(ar){ar.exports=O;function O(_,Q){Q||(Q=document);var E=Q.head||Q.getElementsByTagName("head")[0];if(!E){E=Q.createElement("head");var p=Q.body||Q.getElementsByTagName("body")[0];p?p.parentNode.insertBefore(E,p):Q.documentElement.appendChild(E)}var b=Q.createElement("style");return b.type="text/css",b.styleSheet?b.styleSheet.cssText=_:b.appendChild(Q.createTextNode(_)),E.appendChild(b),b}},53778:function(ar){var O=Array.isArray;ar.exports=O},59722:function(ar){function O(_){return _==null}ar.exports=O},8146:function(ar){var O="[object Object]";function _(Be){var We=!1;if(Be!=null&&typeof Be.toString!="function")try{We=!!(Be+"")}catch($e){}return We}function Q(Be,We){return function($e){return Be(We($e))}}var E=Function.prototype,p=Object.prototype,b=E.toString,X=p.hasOwnProperty,W=b.call(Object),$=p.toString,I=Q(Object.getPrototypeOf,Object);function k(Be){return!!Be&&typeof Be=="object"}function Ce(Be){if(!k(Be)||$.call(Be)!=O||_(Be))return!1;var We=I(Be);if(We===null)return!0;var $e=X.call(We,"constructor")&&We.constructor;return typeof $e=="function"&&$e instanceof $e&&b.call($e)==W}ar.exports=Ce},38554:function(ar,O,_){ar=_.nmd(ar);var Q=200,E="__lodash_hash_undefined__",p=800,b=16,X=9007199254740991,W="[object Arguments]",$="[object Array]",I="[object AsyncFunction]",k="[object Boolean]",Ce="[object Date]",Be="[object Error]",We="[object Function]",$e="[object GeneratorFunction]",Vt="[object Map]",Ht="[object Number]",At="[object Null]",Ot="[object Object]",bt="[object Proxy]",dt="[object RegExp]",Pr="[object Set]",er="[object String]",Ft="[object Undefined]",tt="[object WeakMap]",Ne="[object ArrayBuffer]",Qe="[object DataView]",Ie="[object Float32Array]",Ae="[object Float64Array]",Ue="[object Int8Array]",St="[object Int16Array]",ur="[object Int32Array]",ae="[object Uint8Array]",Te="[object Uint8ClampedArray]",oe="[object Uint16Array]",me="[object Uint32Array]",Me=/[\\^$.*+?()[\]{}|]/g,qe=/^\[object .+?Constructor\]$/,yt=/^(?:0|[1-9]\d*)$/,Qt={};Qt[Ie]=Qt[Ae]=Qt[Ue]=Qt[St]=Qt[ur]=Qt[ae]=Qt[Te]=Qt[oe]=Qt[me]=!0,Qt[W]=Qt[$]=Qt[Ne]=Qt[k]=Qt[Qe]=Qt[Ce]=Qt[Be]=Qt[We]=Qt[Vt]=Qt[Ht]=Qt[Ot]=Qt[dt]=Qt[Pr]=Qt[er]=Qt[tt]=!1;var Or=typeof _.g=="object"&&_.g&&_.g.Object===Object&&_.g,Dr=typeof self=="object"&&self&&self.Object===Object&&self,on=Or||Dr||Function("return this")(),tr=O&&!O.nodeType&&O,se=tr&&!0&&ar&&!ar.nodeType&&ar,be=se&&se.exports===tr,Fe=be&&Or.process,Ee=function(){try{var Xe=se&&se.require&&se.require("util").types;return Xe||Fe&&Fe.binding&&Fe.binding("util")}catch(Pt){}}(),wt=Ee&&Ee.isTypedArray;function Bt(Xe,Pt,_r){switch(_r.length){case 0:return Xe.call(Pt);case 1:return Xe.call(Pt,_r[0]);case 2:return Xe.call(Pt,_r[0],_r[1]);case 3:return Xe.call(Pt,_r[0],_r[1],_r[2])}return Xe.apply(Pt,_r)}function w(Xe,Pt){for(var _r=-1,Zn=Array(Xe);++_r<Xe;)Zn[_r]=Pt(_r);return Zn}function N(Xe){return function(Pt){return Xe(Pt)}}function he(Xe,Pt){return Xe==null?void 0:Xe[Pt]}function je(Xe,Pt){return function(_r){return Xe(Pt(_r))}}var et=Array.prototype,_t=Function.prototype,Ct=Object.prototype,V=on["__core-js_shared__"],Yt=_t.toString,kt=Ct.hasOwnProperty,fr=function(){var Xe=/[^.]+$/.exec(V&&V.keys&&V.keys.IE_PROTO||"");return Xe?"Symbol(src)_1."+Xe:""}(),Cr=Ct.toString,Tr=Yt.call(Object),Ar=RegExp("^"+Yt.call(kt).replace(Me,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Je=be?on.Buffer:void 0,xt=on.Symbol,ht=on.Uint8Array,lr=Je?Je.allocUnsafe:void 0,Kr=je(Object.getPrototypeOf,Object),lt=Object.create,Lt=Ct.propertyIsEnumerable,Jt=et.splice,or=xt?xt.toStringTag:void 0,cn=function(){try{var Xe=Za(Object,"defineProperty");return Xe({},"",{}),Xe}catch(Pt){}}(),Pn=Je?Je.isBuffer:void 0,bi=Math.max,Si=Date.now,Ri=Za(on,"Map"),ia=Za(Object,"create"),pi=function(){function Xe(){}return function(Pt){if(!ua(Pt))return{};if(lt)return lt(Pt);Xe.prototype=Pt;var _r=new Xe;return Xe.prototype=void 0,_r}}();function H(Xe){var Pt=-1,_r=Xe==null?0:Xe.length;for(this.clear();++Pt<_r;){var Zn=Xe[Pt];this.set(Zn[0],Zn[1])}}function ie(){this.__data__=ia?ia(null):{},this.size=0}function ce(Xe){var Pt=this.has(Xe)&&delete this.__data__[Xe];return this.size-=Pt?1:0,Pt}function B(Xe){var Pt=this.__data__;if(ia){var _r=Pt[Xe];return _r===E?void 0:_r}return kt.call(Pt,Xe)?Pt[Xe]:void 0}function re(Xe){var Pt=this.__data__;return ia?Pt[Xe]!==void 0:kt.call(Pt,Xe)}function fe(Xe,Pt){var _r=this.__data__;return this.size+=this.has(Xe)?0:1,_r[Xe]=ia&&Pt===void 0?E:Pt,this}H.prototype.clear=ie,H.prototype.delete=ce,H.prototype.get=B,H.prototype.has=re,H.prototype.set=fe;function Se(Xe){var Pt=-1,_r=Xe==null?0:Xe.length;for(this.clear();++Pt<_r;){var Zn=Xe[Pt];this.set(Zn[0],Zn[1])}}function te(){this.__data__=[],this.size=0}function ge(Xe){var Pt=this.__data__,_r=za(Pt,Xe);if(_r<0)return!1;var Zn=Pt.length-1;return _r==Zn?Pt.pop():Jt.call(Pt,_r,1),--this.size,!0}function pt(Xe){var Pt=this.__data__,_r=za(Pt,Xe);return _r<0?void 0:Pt[_r][1]}function yr(Xe){return za(this.__data__,Xe)>-1}function Lr(Xe,Pt){var _r=this.__data__,Zn=za(_r,Xe);return Zn<0?(++this.size,_r.push([Xe,Pt])):_r[Zn][1]=Pt,this}Se.prototype.clear=te,Se.prototype.delete=ge,Se.prototype.get=pt,Se.prototype.has=yr,Se.prototype.set=Lr;function Nt(Xe){var Pt=-1,_r=Xe==null?0:Xe.length;for(this.clear();++Pt<_r;){var Zn=Xe[Pt];this.set(Zn[0],Zn[1])}}function Fr(){this.size=0,this.__data__={hash:new H,map:new(Ri||Se),string:new H}}function bn(Xe){var Pt=Oa(this,Xe).delete(Xe);return this.size-=Pt?1:0,Pt}function gn(Xe){return Oa(this,Xe).get(Xe)}function gr(Xe){return Oa(this,Xe).has(Xe)}function vn(Xe,Pt){var _r=Oa(this,Xe),Zn=_r.size;return _r.set(Xe,Pt),this.size+=_r.size==Zn?0:1,this}Nt.prototype.clear=Fr,Nt.prototype.delete=bn,Nt.prototype.get=gn,Nt.prototype.has=gr,Nt.prototype.set=vn;function Wr(Xe){var Pt=this.__data__=new Se(Xe);this.size=Pt.size}function ln(){this.__data__=new Se,this.size=0}function Ei(Xe){var Pt=this.__data__,_r=Pt.delete(Xe);return this.size=Pt.size,_r}function pn(Xe){return this.__data__.get(Xe)}function wi(Xe){return this.__data__.has(Xe)}function Yi(Xe,Pt){var _r=this.__data__;if(_r instanceof Se){var Zn=_r.__data__;if(!Ri||Zn.length<Q-1)return Zn.push([Xe,Pt]),this.size=++_r.size,this;_r=this.__data__=new Nt(Zn)}return _r.set(Xe,Pt),this.size=_r.size,this}Wr.prototype.clear=ln,Wr.prototype.delete=Ei,Wr.prototype.get=pn,Wr.prototype.has=wi,Wr.prototype.set=Yi;function Yn(Xe,Pt){var _r=To(Xe),Zn=!_r&&ja(Xe),sa=!_r&&!Zn&&Il(Xe),xa=!_r&&!Zn&&!sa&&bs(Xe),ka=_r||Zn||sa||xa,vi=ka?w(Xe.length,String):[],Ta=vi.length;for(var eo in Xe)(Pt||kt.call(Xe,eo))&&!(ka&&(eo=="length"||sa&&(eo=="offset"||eo=="parent")||xa&&(eo=="buffer"||eo=="byteLength"||eo=="byteOffset")||fs(eo,Ta)))&&vi.push(eo);return vi}function Di(Xe,Pt,_r){(_r!==void 0&&!La(Xe[Pt],_r)||_r===void 0&&!(Pt in Xe))&&Wn(Xe,Pt,_r)}function ki(Xe,Pt,_r){var Zn=Xe[Pt];(!(kt.call(Xe,Pt)&&La(Zn,_r))||_r===void 0&&!(Pt in Xe))&&Wn(Xe,Pt,_r)}function za(Xe,Pt){for(var _r=Xe.length;_r--;)if(La(Xe[_r][0],Pt))return _r;return-1}function Wn(Xe,Pt,_r){Pt=="__proto__"&&cn?cn(Xe,Pt,{configurable:!0,enumerable:!0,value:_r,writable:!0}):Xe[Pt]=_r}var ai=Oo();function Ai(Xe){return Xe==null?Xe===void 0?Ft:At:or&&or in Object(Xe)?cs(Xe):vt(Xe)}function Qn(Xe){return Ns(Xe)&&Ai(Xe)==W}function Fi(Xe){if(!ua(Xe)||Zi(Xe))return!1;var Pt=Lo(Xe)?Ar:qe;return Pt.test(Ua(Xe))}function ya(Xe){return Ns(Xe)&&Xs(Xe.length)&&!!Qt[Ai(Xe)]}function Xa(Xe){if(!ua(Xe))return Le(Xe);var Pt=pe(Xe),_r=[];for(var Zn in Xe)Zn=="constructor"&&(Pt||!kt.call(Xe,Zn))||_r.push(Zn);return _r}function _a(Xe,Pt,_r,Zn,sa){Xe!==Pt&&ai(Pt,function(xa,ka){if(sa||(sa=new Wr),ua(xa))da(Xe,Pt,ka,_r,_a,Zn,sa);else{var vi=Zn?Zn(Qr(Xe,ka),xa,ka+"",Xe,Pt,sa):void 0;vi===void 0&&(vi=xa),Di(Xe,ka,vi)}},ti)}function da(Xe,Pt,_r,Zn,sa,xa,ka){var vi=Qr(Xe,_r),Ta=Qr(Pt,_r),eo=ka.get(Ta);if(eo){Di(Xe,_r,eo);return}var qn=xa?xa(vi,Ta,_r+"",Xe,Pt,ka):void 0,ba=qn===void 0;if(ba){var Jl=To(Ta),Ra=!Jl&&Il(Ta),Ro=!Jl&&!Ra&&bs(Ta);qn=Ta,Jl||Ra||Ro?To(vi)?qn=vi:$l(vi)?qn=$a(vi):Ra?(ba=!1,qn=gi(Ta,!0)):Ro?(ba=!1,qn=Ka(Ta,!0)):qn=[]:ou(Ta)||ja(Ta)?(qn=vi,ja(vi)?qn=Ps(vi):(!ua(vi)||Lo(vi))&&(qn=va(Ta))):ba=!1}ba&&(ka.set(Ta,qn),sa(qn,Ta,Zn,xa,ka),ka.delete(Ta)),Di(Xe,_r,qn)}function Vu(Xe,Pt){return Dn(hr(Xe,Pt,Ol),Xe+"")}var Ya=cn?function(Xe,Pt){return cn(Xe,"toString",{configurable:!0,enumerable:!1,value:su(Pt),writable:!0})}:Ol;function gi(Xe,Pt){if(Pt)return Xe.slice();var _r=Xe.length,Zn=lr?lr(_r):new Xe.constructor(_r);return Xe.copy(Zn),Zn}function qa(Xe){var Pt=new Xe.constructor(Xe.byteLength);return new ht(Pt).set(new ht(Xe)),Pt}function Ka(Xe,Pt){var _r=Pt?qa(Xe.buffer):Xe.buffer;return new Xe.constructor(_r,Xe.byteOffset,Xe.length)}function $a(Xe,Pt){var _r=-1,Zn=Xe.length;for(Pt||(Pt=Array(Zn));++_r<Zn;)Pt[_r]=Xe[_r];return Pt}function Yo(Xe,Pt,_r,Zn){var sa=!_r;_r||(_r={});for(var xa=-1,ka=Pt.length;++xa<ka;){var vi=Pt[xa],Ta=Zn?Zn(_r[vi],Xe[vi],vi,_r,Xe):void 0;Ta===void 0&&(Ta=Xe[vi]),sa?Wn(_r,vi,Ta):ki(_r,vi,Ta)}return _r}function Gi(Xe){return Vu(function(Pt,_r){var Zn=-1,sa=_r.length,xa=sa>1?_r[sa-1]:void 0,ka=sa>2?_r[2]:void 0;for(xa=Xe.length>3&&typeof xa=="function"?(sa--,xa):void 0,ka&&Ca(_r[0],_r[1],ka)&&(xa=sa<3?void 0:xa,sa=1),Pt=Object(Pt);++Zn<sa;){var vi=_r[Zn];vi&&Xe(Pt,vi,Zn,xa)}return Pt})}function Oo(Xe){return function(Pt,_r,Zn){for(var sa=-1,xa=Object(Pt),ka=Zn(Pt),vi=ka.length;vi--;){var Ta=ka[Xe?vi:++sa];if(_r(xa[Ta],Ta,xa)===!1)break}return Pt}}function Oa(Xe,Pt){var _r=Xe.__data__;return fo(Pt)?_r[typeof Pt=="string"?"string":"hash"]:_r.map}function Za(Xe,Pt){var _r=he(Xe,Pt);return Fi(_r)?_r:void 0}function cs(Xe){var Pt=kt.call(Xe,or),_r=Xe[or];try{Xe[or]=void 0;var Zn=!0}catch(xa){}var sa=Cr.call(Xe);return Zn&&(Pt?Xe[or]=_r:delete Xe[or]),sa}function va(Xe){return typeof Xe.constructor=="function"&&!pe(Xe)?pi(Kr(Xe)):{}}function fs(Xe,Pt){var _r=typeof Xe;return Pt=Pt==null?X:Pt,!!Pt&&(_r=="number"||_r!="symbol"&&yt.test(Xe))&&Xe>-1&&Xe%1==0&&Xe<Pt}function Ca(Xe,Pt,_r){if(!ua(_r))return!1;var Zn=typeof Pt;return(Zn=="number"?Mu(_r)&&fs(Pt,_r.length):Zn=="string"&&Pt in _r)?La(_r[Pt],Xe):!1}function fo(Xe){var Pt=typeof Xe;return Pt=="string"||Pt=="number"||Pt=="symbol"||Pt=="boolean"?Xe!=="__proto__":Xe===null}function Zi(Xe){return!!fr&&fr in Xe}function pe(Xe){var Pt=Xe&&Xe.constructor,_r=typeof Pt=="function"&&Pt.prototype||Ct;return Xe===_r}function Le(Xe){var Pt=[];if(Xe!=null)for(var _r in Object(Xe))Pt.push(_r);return Pt}function vt(Xe){return Cr.call(Xe)}function hr(Xe,Pt,_r){return Pt=bi(Pt===void 0?Xe.length-1:Pt,0),function(){for(var Zn=arguments,sa=-1,xa=bi(Zn.length-Pt,0),ka=Array(xa);++sa<xa;)ka[sa]=Zn[Pt+sa];sa=-1;for(var vi=Array(Pt+1);++sa<Pt;)vi[sa]=Zn[sa];return vi[Pt]=_r(ka),Bt(Xe,this,vi)}}function Qr(Xe,Pt){if(!(Pt==="constructor"&&typeof Xe[Pt]=="function")&&Pt!="__proto__")return Xe[Pt]}var Dn=Ki(Ya);function Ki(Xe){var Pt=0,_r=0;return function(){var Zn=Si(),sa=b-(Zn-_r);if(_r=Zn,sa>0){if(++Pt>=p)return arguments[0]}else Pt=0;return Xe.apply(void 0,arguments)}}function Ua(Xe){if(Xe!=null){try{return Yt.call(Xe)}catch(Pt){}try{return Xe+""}catch(Pt){}}return""}function La(Xe,Pt){return Xe===Pt||Xe!==Xe&&Pt!==Pt}var ja=Qn(function(){return arguments}())?Qn:function(Xe){return Ns(Xe)&&kt.call(Xe,"callee")&&!Lt.call(Xe,"callee")},To=Array.isArray;function Mu(Xe){return Xe!=null&&Xs(Xe.length)&&!Lo(Xe)}function $l(Xe){return Ns(Xe)&&Mu(Xe)}var Il=Pn||sl;function Lo(Xe){if(!ua(Xe))return!1;var Pt=Ai(Xe);return Pt==We||Pt==$e||Pt==I||Pt==bt}function Xs(Xe){return typeof Xe=="number"&&Xe>-1&&Xe%1==0&&Xe<=X}function ua(Xe){var Pt=typeof Xe;return Xe!=null&&(Pt=="object"||Pt=="function")}function Ns(Xe){return Xe!=null&&typeof Xe=="object"}function ou(Xe){if(!Ns(Xe)||Ai(Xe)!=Ot)return!1;var Pt=Kr(Xe);if(Pt===null)return!0;var _r=kt.call(Pt,"constructor")&&Pt.constructor;return typeof _r=="function"&&_r instanceof _r&&Yt.call(_r)==Tr}var bs=wt?N(wt):ya;function Ps(Xe){return Yo(Xe,ti(Xe))}function ti(Xe){return Mu(Xe)?Yn(Xe,!0):Xa(Xe)}var ho=Gi(function(Xe,Pt,_r,Zn){_a(Xe,Pt,_r,Zn)});function su(Xe){return function(){return Xe}}function Ol(Xe){return Xe}function sl(){return!1}ar.exports=ho},97644:function(ar,O,_){var Q=200,E="__lodash_hash_undefined__",p=1/0,b="[object Function]",X="[object GeneratorFunction]",W=/[\\^$.*+?()[\]{}|]/g,$=/^\[object .+?Constructor\]$/,I=typeof _.g=="object"&&_.g&&_.g.Object===Object&&_.g,k=typeof self=="object"&&self&&self.Object===Object&&self,Ce=I||k||Function("return this")();function Be(lt,Lt){var Jt=lt?lt.length:0;return!!Jt&&Vt(lt,Lt,0)>-1}function We(lt,Lt,Jt){for(var or=-1,cn=lt?lt.length:0;++or<cn;)if(Jt(Lt,lt[or]))return!0;return!1}function $e(lt,Lt,Jt,or){for(var cn=lt.length,Pn=Jt+(or?1:-1);or?Pn--:++Pn<cn;)if(Lt(lt[Pn],Pn,lt))return Pn;return-1}function Vt(lt,Lt,Jt){if(Lt!==Lt)return $e(lt,Ht,Jt);for(var or=Jt-1,cn=lt.length;++or<cn;)if(lt[or]===Lt)return or;return-1}function Ht(lt){return lt!==lt}function At(lt,Lt){return lt.has(Lt)}function Ot(lt,Lt){return lt==null?void 0:lt[Lt]}function bt(lt){var Lt=!1;if(lt!=null&&typeof lt.toString!="function")try{Lt=!!(lt+"")}catch(Jt){}return Lt}function dt(lt){var Lt=-1,Jt=Array(lt.size);return lt.forEach(function(or){Jt[++Lt]=or}),Jt}var Pr=Array.prototype,er=Function.prototype,Ft=Object.prototype,tt=Ce["__core-js_shared__"],Ne=function(){var lt=/[^.]+$/.exec(tt&&tt.keys&&tt.keys.IE_PROTO||"");return lt?"Symbol(src)_1."+lt:""}(),Qe=er.toString,Ie=Ft.hasOwnProperty,Ae=Ft.toString,Ue=RegExp("^"+Qe.call(Ie).replace(W,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),St=Pr.splice,ur=fr(Ce,"Map"),ae=fr(Ce,"Set"),Te=fr(Object,"create");function oe(lt){var Lt=-1,Jt=lt?lt.length:0;for(this.clear();++Lt<Jt;){var or=lt[Lt];this.set(or[0],or[1])}}function me(){this.__data__=Te?Te(null):{}}function Me(lt){return this.has(lt)&&delete this.__data__[lt]}function qe(lt){var Lt=this.__data__;if(Te){var Jt=Lt[lt];return Jt===E?void 0:Jt}return Ie.call(Lt,lt)?Lt[lt]:void 0}function yt(lt){var Lt=this.__data__;return Te?Lt[lt]!==void 0:Ie.call(Lt,lt)}function Qt(lt,Lt){var Jt=this.__data__;return Jt[lt]=Te&&Lt===void 0?E:Lt,this}oe.prototype.clear=me,oe.prototype.delete=Me,oe.prototype.get=qe,oe.prototype.has=yt,oe.prototype.set=Qt;function Or(lt){var Lt=-1,Jt=lt?lt.length:0;for(this.clear();++Lt<Jt;){var or=lt[Lt];this.set(or[0],or[1])}}function Dr(){this.__data__=[]}function on(lt){var Lt=this.__data__,Jt=_t(Lt,lt);if(Jt<0)return!1;var or=Lt.length-1;return Jt==or?Lt.pop():St.call(Lt,Jt,1),!0}function tr(lt){var Lt=this.__data__,Jt=_t(Lt,lt);return Jt<0?void 0:Lt[Jt][1]}function se(lt){return _t(this.__data__,lt)>-1}function be(lt,Lt){var Jt=this.__data__,or=_t(Jt,lt);return or<0?Jt.push([lt,Lt]):Jt[or][1]=Lt,this}Or.prototype.clear=Dr,Or.prototype.delete=on,Or.prototype.get=tr,Or.prototype.has=se,Or.prototype.set=be;function Fe(lt){var Lt=-1,Jt=lt?lt.length:0;for(this.clear();++Lt<Jt;){var or=lt[Lt];this.set(or[0],or[1])}}function Ee(){this.__data__={hash:new oe,map:new(ur||Or),string:new oe}}function wt(lt){return kt(this,lt).delete(lt)}function Bt(lt){return kt(this,lt).get(lt)}function w(lt){return kt(this,lt).has(lt)}function N(lt,Lt){return kt(this,lt).set(lt,Lt),this}Fe.prototype.clear=Ee,Fe.prototype.delete=wt,Fe.prototype.get=Bt,Fe.prototype.has=w,Fe.prototype.set=N;function he(lt){var Lt=-1,Jt=lt?lt.length:0;for(this.__data__=new Fe;++Lt<Jt;)this.add(lt[Lt])}function je(lt){return this.__data__.set(lt,E),this}function et(lt){return this.__data__.has(lt)}he.prototype.add=he.prototype.push=je,he.prototype.has=et;function _t(lt,Lt){for(var Jt=lt.length;Jt--;)if(xt(lt[Jt][0],Lt))return Jt;return-1}function Ct(lt){if(!lr(lt)||Tr(lt))return!1;var Lt=ht(lt)||bt(lt)?Ue:$;return Lt.test(Ar(lt))}function V(lt,Lt,Jt){var or=-1,cn=Be,Pn=lt.length,bi=!0,Si=[],Ri=Si;if(Jt)bi=!1,cn=We;else if(Pn>=Q){var ia=Lt?null:Yt(lt);if(ia)return dt(ia);bi=!1,cn=At,Ri=new he}else Ri=Lt?[]:Si;e:for(;++or<Pn;){var pi=lt[or],H=Lt?Lt(pi):pi;if(pi=Jt||pi!==0?pi:0,bi&&H===H){for(var ie=Ri.length;ie--;)if(Ri[ie]===H)continue e;Lt&&Ri.push(H),Si.push(pi)}else cn(Ri,H,Jt)||(Ri!==Si&&Ri.push(H),Si.push(pi))}return Si}var Yt=ae&&1/dt(new ae([,-0]))[1]==p?function(lt){return new ae(lt)}:Kr;function kt(lt,Lt){var Jt=lt.__data__;return Cr(Lt)?Jt[typeof Lt=="string"?"string":"hash"]:Jt.map}function fr(lt,Lt){var Jt=Ot(lt,Lt);return Ct(Jt)?Jt:void 0}function Cr(lt){var Lt=typeof lt;return Lt=="string"||Lt=="number"||Lt=="symbol"||Lt=="boolean"?lt!=="__proto__":lt===null}function Tr(lt){return!!Ne&&Ne in lt}function Ar(lt){if(lt!=null){try{return Qe.call(lt)}catch(Lt){}try{return lt+""}catch(Lt){}}return""}function Je(lt){return lt&&lt.length?V(lt):[]}function xt(lt,Lt){return lt===Lt||lt!==lt&&Lt!==Lt}function ht(lt){var Lt=lr(lt)?Ae.call(lt):"";return Lt==b||Lt==X}function lr(lt){var Lt=typeof lt;return!!lt&&(Lt=="object"||Lt=="function")}function Kr(){}ar.exports=Je},49029:function(ar){var O=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function _(Q){return Q.match(O)||[]}ar.exports=_},29750:function(ar){function O(_,Q,E){return _===_&&(E!==void 0&&(_=_<=E?_:E),Q!==void 0&&(_=_>=Q?_:Q)),_}ar.exports=O},18674:function(ar){function O(_){return function(Q){return _==null?void 0:_[Q]}}ar.exports=O},98805:function(ar,O,_){var Q=_(40180),E=_(62689),p=_(83140),b=_(79833);function X(W){return function($){$=b($);var I=E($)?p($):void 0,k=I?I[0]:$.charAt(0),Ce=I?Q(I,1).join(""):$.slice(1);return k[W]()+Ce}}ar.exports=X},35393:function(ar,O,_){var Q=_(62663),E=_(53816),p=_(58748),b="['\u2019]",X=RegExp(b,"g");function W($){return function(I){return Q(p(E(I).replace(X,"")),$,"")}}ar.exports=W},69389:function(ar,O,_){var Q=_(18674),E={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},p=Q(E);ar.exports=p},93157:function(ar){var O=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function _(Q){return O.test(Q)}ar.exports=_},2757:function(ar){var O="\\ud800-\\udfff",_="\\u0300-\\u036f",Q="\\ufe20-\\ufe2f",E="\\u20d0-\\u20ff",p=_+Q+E,b="\\u2700-\\u27bf",X="a-z\\xdf-\\xf6\\xf8-\\xff",W="\\xac\\xb1\\xd7\\xf7",$="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",I="\\u2000-\\u206f",k=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ce="A-Z\\xc0-\\xd6\\xd8-\\xde",Be="\\ufe0e\\ufe0f",We=W+$+I+k,$e="['\u2019]",Vt="["+We+"]",Ht="["+p+"]",At="\\d+",Ot="["+b+"]",bt="["+X+"]",dt="[^"+O+We+At+b+X+Ce+"]",Pr="\\ud83c[\\udffb-\\udfff]",er="(?:"+Ht+"|"+Pr+")",Ft="[^"+O+"]",tt="(?:\\ud83c[\\udde6-\\uddff]){2}",Ne="[\\ud800-\\udbff][\\udc00-\\udfff]",Qe="["+Ce+"]",Ie="\\u200d",Ae="(?:"+bt+"|"+dt+")",Ue="(?:"+Qe+"|"+dt+")",St="(?:"+$e+"(?:d|ll|m|re|s|t|ve))?",ur="(?:"+$e+"(?:D|LL|M|RE|S|T|VE))?",ae=er+"?",Te="["+Be+"]?",oe="(?:"+Ie+"(?:"+[Ft,tt,Ne].join("|")+")"+Te+ae+")*",me="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Me="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",qe=Te+ae+oe,yt="(?:"+[Ot,tt,Ne].join("|")+")"+qe,Qt=RegExp([Qe+"?"+bt+"+"+St+"(?="+[Vt,Qe,"$"].join("|")+")",Ue+"+"+ur+"(?="+[Vt,Qe+Ae,"$"].join("|")+")",Qe+"?"+Ae+"+"+St,Qe+"+"+ur,Me,me,At,yt].join("|"),"g");function Or(Dr){return Dr.match(Qt)||[]}ar.exports=Or},68929:function(ar,O,_){var Q=_(48403),E=_(35393),p=E(function(b,X,W){return X=X.toLowerCase(),b+(W?Q(X):X)});ar.exports=p},48403:function(ar,O,_){var Q=_(79833),E=_(11700);function p(b){return E(Q(b).toLowerCase())}ar.exports=p},74691:function(ar,O,_){var Q=_(29750),E=_(14841);function p(b,X,W){return W===void 0&&(W=X,X=void 0),W!==void 0&&(W=E(W),W=W===W?W:0),X!==void 0&&(X=E(X),X=X===X?X:0),Q(E(b),X,W)}ar.exports=p},53816:function(ar,O,_){var Q=_(69389),E=_(79833),p=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,b="\\u0300-\\u036f",X="\\ufe20-\\ufe2f",W="\\u20d0-\\u20ff",$=b+X+W,I="["+$+"]",k=RegExp(I,"g");function Ce(Be){return Be=E(Be),Be&&Be.replace(p,Q).replace(k,"")}ar.exports=Ce},14293:function(ar){function O(_){return _==null}ar.exports=O},81763:function(ar,O,_){var Q=_(44239),E=_(37005),p="[object Number]";function b(X){return typeof X=="number"||E(X)&&Q(X)==p}ar.exports=b},30236:function(ar,O,_){var Q=_(42980),E=_(21463),p=E(function(b,X,W,$){Q(b,X,W,$)});ar.exports=p},44908:function(ar,O,_){var Q=_(45652);function E(p){return p&&p.length?Q(p):[]}ar.exports=E},11700:function(ar,O,_){var Q=_(98805),E=Q("toUpperCase");ar.exports=E},58748:function(ar,O,_){var Q=_(49029),E=_(93157),p=_(79833),b=_(2757);function X(W,$,I){return W=p(W),$=I?void 0:$,$===void 0?E(W)?b(W):Q(W):W.match($)||[]}ar.exports=X},6158:function(ar){(function(O,_){ar.exports=_()})(this,function(){"use strict";var O,_,Q;function E(p,b){if(!O)O=b;else if(!_)_=b;else{var X="var sharedChunk = {}; ("+O+")(sharedChunk); ("+_+")(sharedChunk);",W={};O(W),Q=b(W),typeof window!="undefined"&&(Q.workerUrl=window.URL.createObjectURL(new Blob([X],{type:"text/javascript"})))}}return E(["exports"],function(p){"use strict";function b(e,t){return e(t={exports:{}},t.exports),t.exports}var X=W;function W(e,t,r,f){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(f-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=f,this.p2x=r,this.p2y=f}W.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},W.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},W.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},W.prototype.solveCurveX=function(e,t){var r,f,v,m,x;for(t===void 0&&(t=1e-6),v=e,x=0;x<8;x++){if(m=this.sampleCurveX(v)-e,Math.abs(m)<t)return v;var A=this.sampleCurveDerivativeX(v);if(Math.abs(A)<1e-6)break;v-=m/A}if((v=e)<(r=0))return r;if(v>(f=1))return f;for(;r<f;){if(m=this.sampleCurveX(v),Math.abs(m-e)<t)return v;e>m?r=v:f=v,v=.5*(f-r)+r}return v},W.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var $=I;function I(e,t){this.x=e,this.y=t}I.prototype={clone:function(){return new I(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),f=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=f,this},_rotateAround:function(e,t){var r=Math.cos(e),f=Math.sin(e),v=t.y+f*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-f*(this.y-t.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},I.convert=function(e){return e instanceof I?e:Array.isArray(e)?new I(e[0],e[1]):e};var k=typeof self!="undefined"?self:{},Ce=Math.pow(2,53)-1;function Be(e,t,r,f){var v=new X(e,t,r,f);return function(m){return v.solve(m)}}var We=Be(.25,.1,.25,1);function $e(e,t,r){return Math.min(r,Math.max(t,e))}function Vt(e,t,r){var f=r-t,v=((e-t)%f+f)%f+t;return v===t?r:v}function Ht(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var m=v[f];for(var x in m)e[x]=m[x]}return e}var At=1;function Ot(){return At++}function bt(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function dt(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function Pr(e,t){e.forEach(function(r){t[r]&&(t[r]=t[r].bind(t))})}function er(e,t){return e.indexOf(t,e.length-t.length)!==-1}function Ft(e,t,r){var f={};for(var v in e)f[v]=t.call(r||this,e[v],v,e);return f}function tt(e,t,r){var f={};for(var v in e)t.call(r||this,e[v],v,e)&&(f[v]=e[v]);return f}function Ne(e){return Array.isArray(e)?e.map(Ne):typeof e=="object"&&e?Ft(e,Ne):e}var Qe={};function Ie(e){Qe[e]||(typeof console!="undefined"&&console.warn(e),Qe[e]=!0)}function Ae(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function Ue(e){for(var t=0,r=0,f=e.length,v=f-1,m=void 0,x=void 0;r<f;v=r++)t+=((x=e[v]).x-(m=e[r]).x)*(m.y+x.y);return t}function St(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function ur(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(f,v,m,x){var A=m||x;return t[v]=!A||A.toLowerCase(),""}),t["max-age"]){var r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}var ae=null;function Te(e){if(ae==null){var t=e.navigator?e.navigator.userAgent:null;ae=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return ae}function oe(e){try{var t=k[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(r){return!1}}var me,Me,qe,yt,Qt=k.performance&&k.performance.now?k.performance.now.bind(k.performance):Date.now.bind(Date),Or=k.requestAnimationFrame||k.mozRequestAnimationFrame||k.webkitRequestAnimationFrame||k.msRequestAnimationFrame,Dr=k.cancelAnimationFrame||k.mozCancelAnimationFrame||k.webkitCancelAnimationFrame||k.msCancelAnimationFrame,on={now:Qt,frame:function(e){var t=Or(e);return{cancel:function(){return Dr(t)}}},getImageData:function(e,t){t===void 0&&(t=0);var r=k.document.createElement("canvas"),f=r.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return r.width=e.width,r.height=e.height,f.drawImage(e,0,0,e.width,e.height),f.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:function(e){return me||(me=k.document.createElement("a")),me.href=e,me.href},hardwareConcurrency:k.navigator&&k.navigator.hardwareConcurrency||4,get devicePixelRatio(){return k.devicePixelRatio},get prefersReducedMotion(){return!!k.matchMedia&&(Me==null&&(Me=k.matchMedia("(prefers-reduced-motion: reduce)")),Me.matches)}},tr={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},se={supported:!1,testSupport:function(e){!be&&yt&&(Fe?Ee(e):qe=e)}},be=!1,Fe=!1;function Ee(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,yt),e.isContextLost())return;se.supported=!0}catch(r){}e.deleteTexture(t),be=!0}k.document&&((yt=k.document.createElement("img")).onload=function(){qe&&Ee(qe),qe=null,Fe=!0},yt.onerror=function(){be=!0,qe=null},yt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var wt="01",Bt=function(e,t){this._transformRequestFn=e,this._customAccessToken=t,this._createSkuToken()};function w(e){return e.indexOf("mapbox:")===0}Bt.prototype._createSkuToken=function(){var e=function(){for(var t="",r=0;r<10;r++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",wt,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},Bt.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Bt.prototype.transformRequest=function(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}},Bt.prototype.normalizeStyleURL=function(e,t){if(!w(e))return e;var r=et(e);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},Bt.prototype.normalizeGlyphsURL=function(e,t){if(!w(e))return e;var r=et(e);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},Bt.prototype.normalizeSourceURL=function(e,t){if(!w(e))return e;var r=et(e);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||t)},Bt.prototype.normalizeSpriteURL=function(e,t,r,f){var v=et(e);return w(e)?(v.path="/styles/v1"+v.path+"/sprite"+t+r,this._makeAPIURL(v,this._customAccessToken||f)):(v.path+=""+t+r,_t(v))},Bt.prototype.normalizeTileURL=function(e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!w(e))return e;var r=et(e);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,(on.devicePixelRatio>=2||t===512?"@2x":"")+(se.supported?".webp":"$1")),r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/v4"+r.path;var f=this._customAccessToken||function(v){for(var m=0,x=v;m<x.length;m+=1){var A=x[m].match(/^access_token=(.*)$/);if(A)return A[1]}return null}(r.params)||tr.ACCESS_TOKEN;return tr.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,f)},Bt.prototype.canonicalizeTileURL=function(e,t){var r=et(e);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return e;var f="mapbox://tiles/";f+=r.path.replace("/v4/","");var v=r.params;return t&&(v=v.filter(function(m){return!m.match(/^access_token=/)})),v.length&&(f+="?"+v.join("&")),f},Bt.prototype.canonicalizeTileset=function(e,t){for(var r=!!t&&w(t),f=[],v=0,m=e.tiles||[];v<m.length;v+=1){var x=m[v];he(x)?f.push(this.canonicalizeTileURL(x,r)):f.push(x)}return f},Bt.prototype._makeAPIURL=function(e,t){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",f=et(tr.API_URL);if(e.protocol=f.protocol,e.authority=f.authority,e.protocol==="http"){var v=e.params.indexOf("secure");v>=0&&e.params.splice(v,1)}if(f.path!=="/"&&(e.path=""+f.path+e.path),!tr.REQUIRE_ACCESS_TOKEN)return _t(e);if(!(t=t||tr.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if(t[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return e.params=e.params.filter(function(m){return m.indexOf("access_token")===-1}),e.params.push("access_token="+t),_t(e)};var N=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function he(e){return N.test(e)}var je=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function et(e){var t=e.match(je);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function _t(e){var t=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+t}function Ct(e){if(!e)return null;var t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(k.atob(t[1]).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(r){return null}}var V=function(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};V.prototype.getStorageKey=function(e){var t,r=Ct(tr.ACCESS_TOKEN);return t=r&&r.u?k.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,function(f,v){return String.fromCharCode(Number("0x"+v))})):tr.ACCESS_TOKEN||"",e?"mapbox.eventData."+e+":"+t:"mapbox.eventData:"+t},V.prototype.fetchEventData=function(){var e=oe("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{var f=k.localStorage.getItem(t);f&&(this.eventData=JSON.parse(f));var v=k.localStorage.getItem(r);v&&(this.anonId=v)}catch(m){Ie("Unable to read from LocalStorage")}},V.prototype.saveEventData=function(){var e=oe("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{k.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&k.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(f){Ie("Unable to write to LocalStorage")}},V.prototype.processRequests=function(e){},V.prototype.postEvent=function(e,t,r,f){var v=this;if(tr.EVENTS_URL){var m=et(tr.EVENTS_URL);m.params.push("access_token="+(f||tr.ACCESS_TOKEN||""));var x={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.1",skuId:wt,userId:this.anonId},A=t?Ht(x,t):x,F={url:_t(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([A])};this.pendingRequest=pi(F,function(Z){v.pendingRequest=null,r(Z),v.saveEventData(),v.processRequests(f)})}},V.prototype.queueRequest=function(e,t){this.queue.push(e),this.processRequests(t)};var Yt,kt,fr=function(e){function t(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postMapLoadEvent=function(r,f,v,m){this.skuToken=v,(tr.EVENTS_URL&&m||tr.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(x){return w(x)||he(x)}))&&this.queueRequest({id:f,timestamp:Date.now()},m)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){var v=this.queue.shift(),m=v.id,x=v.timestamp;m&&this.success[m]||(this.anonId||this.fetchEventData(),dt(this.anonId)||(this.anonId=bt()),this.postEvent(x,{skuToken:this.skuToken},function(A){A||m&&(f.success[m]=!0)},r))}},t}(V),Cr=new(function(e){function t(r){e.call(this,"appUserTurnstile"),this._customAccessToken=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postTurnstileEvent=function(r,f){tr.EVENTS_URL&&tr.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(v){return w(v)||he(v)})&&this.queueRequest(Date.now(),f)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var v=Ct(tr.ACCESS_TOKEN),m=v?v.u:tr.ACCESS_TOKEN,x=m!==this.eventData.tokenU;dt(this.anonId)||(this.anonId=bt(),x=!0);var A=this.queue.shift();if(this.eventData.lastSuccess){var F=new Date(this.eventData.lastSuccess),Z=new Date(A),K=(A-this.eventData.lastSuccess)/864e5;x=x||K>=1||K<-1||F.getDate()!==Z.getDate()}else x=!0;if(!x)return this.processRequests();this.postEvent(A,{"enabled.telemetry":!1},function(q){q||(f.eventData.lastSuccess=A,f.eventData.tokenU=m)},r)}},t}(V)),Tr=Cr.postTurnstileEvent.bind(Cr),Ar=new fr,Je=Ar.postMapLoadEvent.bind(Ar),xt=500,ht=50;function lr(){k.caches&&!Yt&&(Yt=k.caches.open("mapbox-tiles"))}function Kr(e){var t=e.indexOf("?");return t<0?e:e.slice(0,t)}var lt,Lt=1/0;function Jt(){return lt==null&&(lt=k.OffscreenCanvas&&new k.OffscreenCanvas(1,1).getContext("2d")&&typeof k.createImageBitmap=="function"),lt}var or={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(or);var cn=function(e){function t(r,f,v){f===401&&he(v)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,r),this.status=f,this.url=v,this.name=this.constructor.name,this.message=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},t}(Error),Pn=St()?function(){return self.worker&&self.worker.referrer}:function(){return(k.location.protocol==="blob:"?k.parent:k).location.href},bi,Si,Ri=function(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(Pn())&&!/^\w+:/.test(r))){if(k.fetch&&k.Request&&k.AbortController&&k.Request.prototype.hasOwnProperty("signal"))return function(f,v){var m,x=new k.AbortController,A=new k.Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:Pn(),signal:x.signal}),F=!1,Z=!1,K=(m=A.url).indexOf("sku=")>0&&he(m);f.type==="json"&&A.headers.set("Accept","application/json");var q=function(de,Ge,Ye){if(!Z){if(de&&de.message!=="SecurityError"&&Ie(de),Ge&&Ye)return ue(Ge);var ct=Date.now();k.fetch(A).then(function(rt){if(rt.ok){var It=K?rt.clone():null;return ue(rt,It,ct)}return v(new cn(rt.statusText,rt.status,f.url))}).catch(function(rt){rt.code!==20&&v(new Error(rt.message))})}},ue=function(de,Ge,Ye){(f.type==="arrayBuffer"?de.arrayBuffer():f.type==="json"?de.json():de.text()).then(function(ct){Z||(Ge&&Ye&&function(rt,It,Wt){if(lr(),Yt){var ir={status:It.status,statusText:It.statusText,headers:new k.Headers};It.headers.forEach(function(Mr,en){return ir.headers.set(en,Mr)});var dr=ur(It.headers.get("Cache-Control")||"");dr["no-store"]||(dr["max-age"]&&ir.headers.set("Expires",new Date(Wt+1e3*dr["max-age"]).toUTCString()),new Date(ir.headers.get("Expires")).getTime()-Wt<42e4||function(Mr,en){if(kt===void 0)try{new Response(new ReadableStream),kt=!0}catch(dn){kt=!1}kt?en(Mr.body):Mr.blob().then(en)}(It,function(Mr){var en=new k.Response(Mr,ir);lr(),Yt&&Yt.then(function(dn){return dn.put(Kr(rt.url),en)}).catch(function(dn){return Ie(dn.message)})}))}}(A,Ge,Ye),F=!0,v(null,ct,de.headers.get("Cache-Control"),de.headers.get("Expires")))}).catch(function(ct){Z||v(new Error(ct.message))})};return K?function(de,Ge){if(lr(),!Yt)return Ge(null);var Ye=Kr(de.url);Yt.then(function(ct){ct.match(Ye).then(function(rt){var It=function(Wt){if(!Wt)return!1;var ir=new Date(Wt.headers.get("Expires")||0),dr=ur(Wt.headers.get("Cache-Control")||"");return ir>Date.now()&&!dr["no-cache"]}(rt);ct.delete(Ye),It&&ct.put(Ye,rt.clone()),Ge(null,rt,It)}).catch(Ge)}).catch(Ge)}(A,q):q(null,null),{cancel:function(){Z=!0,F||x.abort()}}}(e,t);if(St()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(f,v){var m=new k.XMLHttpRequest;for(var x in m.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(m.responseType="arraybuffer"),f.headers)m.setRequestHeader(x,f.headers[x]);return f.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=f.credentials==="include",m.onerror=function(){v(new Error(m.statusText))},m.onload=function(){if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){var A=m.response;if(f.type==="json")try{A=JSON.parse(m.response)}catch(F){return v(F)}v(null,A,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else v(new cn(m.statusText,m.status,f.url))},m.send(f.body),{cancel:function(){return m.abort()}}}(e,t)},ia=function(e,t){return Ri(Ht(e,{type:"arrayBuffer"}),t)},pi=function(e,t){return Ri(Ht(e,{method:"POST"}),t)},H="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";bi=[],Si=0;var ie=function(e,t){if(se.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Si>=tr.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:e,callback:t,cancelled:!1,cancel:function(){this.cancelled=!0}};return bi.push(r),r}Si++;var f=!1,v=function(){if(!f)for(f=!0,Si--;bi.length&&Si<tr.MAX_PARALLEL_IMAGE_REQUESTS;){var x=bi.shift();x.cancelled||(x.cancel=ie(x.requestParameters,x.callback).cancel)}},m=ia(e,function(x,A,F,Z){v(),x?t(x):A&&(Jt()?function(K,q){var ue=new k.Blob([new Uint8Array(K)],{type:"image/png"});k.createImageBitmap(ue).then(function(de){q(null,de)}).catch(function(de){q(new Error("Could not load image because of "+de.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(A,t):function(K,q,ue,de){var Ge=new k.Image,Ye=k.URL;Ge.onload=function(){q(null,Ge),Ye.revokeObjectURL(Ge.src),Ge.onload=null,k.requestAnimationFrame(function(){Ge.src=H})},Ge.onerror=function(){return q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var ct=new k.Blob([new Uint8Array(K)],{type:"image/png"});Ge.cacheControl=ue,Ge.expires=de,Ge.src=K.byteLength?Ye.createObjectURL(ct):H}(A,t,F,Z))});return{cancel:function(){m.cancel(),v()}}};function ce(e,t,r){r[e]&&r[e].indexOf(t)!==-1||(r[e]=r[e]||[],r[e].push(t))}function B(e,t,r){if(r&&r[e]){var f=r[e].indexOf(t);f!==-1&&r[e].splice(f,1)}}var re=function(e,t){t===void 0&&(t={}),Ht(this,t),this.type=e},fe=function(e){function t(r,f){f===void 0&&(f={}),e.call(this,"error",Ht({error:r},f))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(re),Se=function(){};Se.prototype.on=function(e,t){return this._listeners=this._listeners||{},ce(e,t,this._listeners),this},Se.prototype.off=function(e,t){return B(e,t,this._listeners),B(e,t,this._oneTimeListeners),this},Se.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},ce(e,t,this._oneTimeListeners),this},Se.prototype.fire=function(e,t){typeof e=="string"&&(e=new re(e,t||{}));var r=e.type;if(this.listens(r)){e.target=this;for(var f=0,v=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];f<v.length;f+=1)v[f].call(this,e);for(var m=0,x=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];m<x.length;m+=1){var A=x[m];B(r,A,this._oneTimeListeners),A.call(this,e)}var F=this._eventedParent;F&&(Ht(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),F.fire(e))}else e instanceof fe&&console.error(e.error);return this},Se.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},Se.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this};var te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},ge=function(e,t,r,f){this.message=(e?e+": ":"")+r,f&&(this.identifier=f),t!=null&&t.__line__&&(this.line=t.__line__)};function pt(e){var t=e.value;return t?[new ge(e.key,t,"constants have been deprecated as of v8")]:[]}function yr(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var m=v[f];for(var x in m)e[x]=m[x]}return e}function Lr(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Nt(e){if(Array.isArray(e))return e.map(Nt);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var r in e)t[r]=Nt(e[r]);return t}return Lr(e)}var Fr=function(e){function t(r,f){e.call(this,f),this.message=f,this.key=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Error),bn=function(e,t){t===void 0&&(t=[]),this.parent=e,this.bindings={};for(var r=0,f=t;r<f.length;r+=1){var v=f[r];this.bindings[v[0]]=v[1]}};bn.prototype.concat=function(e){return new bn(this,e)},bn.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")},bn.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var gn={kind:"null"},gr={kind:"number"},vn={kind:"string"},Wr={kind:"boolean"},ln={kind:"color"},Ei={kind:"object"},pn={kind:"value"},wi={kind:"collator"},Yi={kind:"formatted"},Yn={kind:"resolvedImage"};function Di(e,t){return{kind:"array",itemType:e,N:t}}function ki(e){if(e.kind==="array"){var t=ki(e.itemType);return typeof e.N=="number"?"array<"+t+", "+e.N+">":e.itemType.kind==="value"?"array":"array<"+t+">"}return e.kind}var za=[gn,gr,vn,Wr,ln,Yi,Ei,Di(pn),Yn];function Wn(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Wn(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(var r=0,f=za;r<f.length;r+=1)if(!Wn(f[r],t))return null}}return"Expected "+ki(e)+" but found "+ki(t)+" instead."}function ai(e,t){return t.some(function(r){return r.kind===e.kind})}function Ai(e,t){return t.some(function(r){return r==="null"?e===null:r==="array"?Array.isArray(e):r==="object"?e&&!Array.isArray(e)&&typeof e=="object":r===typeof e})}var Qn=b(function(e,t){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function f(A){return(A=Math.round(A))<0?0:A>255?255:A}function v(A){return f(A[A.length-1]==="%"?parseFloat(A)/100*255:parseInt(A))}function m(A){return(F=A[A.length-1]==="%"?parseFloat(A)/100:parseFloat(A))<0?0:F>1?1:F;var F}function x(A,F,Z){return Z<0?Z+=1:Z>1&&(Z-=1),6*Z<1?A+(F-A)*Z*6:2*Z<1?F:3*Z<2?A+(F-A)*(2/3-Z)*6:A}try{t.parseCSSColor=function(A){var F,Z=A.replace(/ /g,"").toLowerCase();if(Z in r)return r[Z].slice();if(Z[0]==="#")return Z.length===4?(F=parseInt(Z.substr(1),16))>=0&&F<=4095?[(3840&F)>>4|(3840&F)>>8,240&F|(240&F)>>4,15&F|(15&F)<<4,1]:null:Z.length===7&&(F=parseInt(Z.substr(1),16))>=0&&F<=16777215?[(16711680&F)>>16,(65280&F)>>8,255&F,1]:null;var K=Z.indexOf("("),q=Z.indexOf(")");if(K!==-1&&q+1===Z.length){var ue=Z.substr(0,K),de=Z.substr(K+1,q-(K+1)).split(","),Ge=1;switch(ue){case"rgba":if(de.length!==4)return null;Ge=m(de.pop());case"rgb":return de.length!==3?null:[v(de[0]),v(de[1]),v(de[2]),Ge];case"hsla":if(de.length!==4)return null;Ge=m(de.pop());case"hsl":if(de.length!==3)return null;var Ye=(parseFloat(de[0])%360+360)%360/360,ct=m(de[1]),rt=m(de[2]),It=rt<=.5?rt*(ct+1):rt+ct-rt*ct,Wt=2*rt-It;return[f(255*x(Wt,It,Ye+1/3)),f(255*x(Wt,It,Ye)),f(255*x(Wt,It,Ye-1/3)),Ge];default:return null}}return null}}catch(A){}}).parseCSSColor,Fi=function(e,t,r,f){f===void 0&&(f=1),this.r=e,this.g=t,this.b=r,this.a=f};Fi.parse=function(e){if(e){if(e instanceof Fi)return e;if(typeof e=="string"){var t=Qn(e);if(t)return new Fi(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}}},Fi.prototype.toString=function(){var e=this.toArray(),t=e[1],r=e[2],f=e[3];return"rgba("+Math.round(e[0])+","+Math.round(t)+","+Math.round(r)+","+f+")"},Fi.prototype.toArray=function(){var e=this.a;return e===0?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},Fi.black=new Fi(0,0,0,1),Fi.white=new Fi(1,1,1,1),Fi.transparent=new Fi(0,0,0,0),Fi.red=new Fi(1,0,0,1);var ya=function(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};ya.prototype.compare=function(e,t){return this.collator.compare(e,t)},ya.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Xa=function(e,t,r,f,v){this.text=e,this.image=t,this.scale=r,this.fontStack=f,this.textColor=v},_a=function(e){this.sections=e};_a.fromString=function(e){return new _a([new Xa(e,null,null,null,null)])},_a.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(e){return e.text.length!==0||e.image&&e.image.name.length!==0})},_a.factory=function(e){return e instanceof _a?e:_a.fromString(e)},_a.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(e){return e.text}).join("")},_a.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];if(f.image)e.push(["image",f.image.name]);else{e.push(f.text);var v={};f.fontStack&&(v["text-font"]=["literal",f.fontStack.split(",")]),f.scale&&(v["font-scale"]=f.scale),f.textColor&&(v["text-color"]=["rgba"].concat(f.textColor.toArray())),e.push(v)}}return e};var da=function(e){this.name=e.name,this.available=e.available};function Vu(e,t,r,f){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:"Invalid rgba value ["+[e,t,r,f].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof f=="number"?[e,t,r,f]:[e,t,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Ya(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof Fi||e instanceof ya||e instanceof _a||e instanceof da)return!0;if(Array.isArray(e)){for(var t=0,r=e;t<r.length;t+=1)if(!Ya(r[t]))return!1;return!0}if(typeof e=="object"){for(var f in e)if(!Ya(e[f]))return!1;return!0}return!1}function gi(e){if(e===null)return gn;if(typeof e=="string")return vn;if(typeof e=="boolean")return Wr;if(typeof e=="number")return gr;if(e instanceof Fi)return ln;if(e instanceof ya)return wi;if(e instanceof _a)return Yi;if(e instanceof da)return Yn;if(Array.isArray(e)){for(var t,r=e.length,f=0,v=e;f<v.length;f+=1){var m=gi(v[f]);if(t){if(t===m)continue;t=pn;break}t=m}return Di(t||pn,r)}return Ei}function qa(e){var t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof Fi||e instanceof _a||e instanceof da?e.toString():JSON.stringify(e)}da.prototype.toString=function(){return this.name},da.fromString=function(e){return e?new da({name:e,available:!1}):null},da.prototype.serialize=function(){return["image",this.name]};var Ka=function(e,t){this.type=e,this.value=t};Ka.parse=function(e,t){if(e.length!==2)return t.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!Ya(e[1]))return t.error("invalid value");var r=e[1],f=gi(r),v=t.expectedType;return f.kind!=="array"||f.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(f=v),new Ka(f,r)},Ka.prototype.evaluate=function(){return this.value},Ka.prototype.eachChild=function(){},Ka.prototype.outputDefined=function(){return!0},Ka.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Fi?["rgba"].concat(this.value.toArray()):this.value instanceof _a?this.value.serialize():this.value};var $a=function(e){this.name="ExpressionEvaluationError",this.message=e};$a.prototype.toJSON=function(){return this.message};var Yo={string:vn,number:gr,boolean:Wr,object:Ei},Gi=function(e,t){this.type=e,this.args=t};Gi.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r,f=1,v=e[0];if(v==="array"){var m,x;if(e.length>2){var A=e[1];if(typeof A!="string"||!(A in Yo)||A==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);m=Yo[A],f++}else m=pn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);x=e[2],f++}r=Di(m,x)}else r=Yo[v];for(var F=[];f<e.length;f++){var Z=t.parse(e[f],f,pn);if(!Z)return null;F.push(Z)}return new Gi(r,F)},Gi.prototype.evaluate=function(e){for(var t=0;t<this.args.length;t++){var r=this.args[t].evaluate(e);if(!Wn(this.type,gi(r)))return r;if(t===this.args.length-1)throw new $a("Expected value to be of type "+ki(this.type)+", but found "+ki(gi(r))+" instead.")}return null},Gi.prototype.eachChild=function(e){this.args.forEach(e)},Gi.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Gi.prototype.serialize=function(){var e=this.type,t=[e.kind];if(e.kind==="array"){var r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){t.push(r.kind);var f=e.N;(typeof f=="number"||this.args.length>1)&&t.push(f)}}return t.concat(this.args.map(function(v){return v.serialize()}))};var Oo=function(e){this.type=Yi,this.sections=e};Oo.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[1];if(!Array.isArray(r)&&typeof r=="object")return t.error("First argument must be an image or text section.");for(var f=[],v=!1,m=1;m<=e.length-1;++m){var x=e[m];if(v&&typeof x=="object"&&!Array.isArray(x)){v=!1;var A=null;if(x["font-scale"]&&!(A=t.parse(x["font-scale"],1,gr)))return null;var F=null;if(x["text-font"]&&!(F=t.parse(x["text-font"],1,Di(vn))))return null;var Z=null;if(x["text-color"]&&!(Z=t.parse(x["text-color"],1,ln)))return null;var K=f[f.length-1];K.scale=A,K.font=F,K.textColor=Z}else{var q=t.parse(e[m],1,pn);if(!q)return null;var ue=q.type.kind;if(ue!=="string"&&ue!=="value"&&ue!=="null"&&ue!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,f.push({content:q,scale:null,font:null,textColor:null})}}return new Oo(f)},Oo.prototype.evaluate=function(e){return new _a(this.sections.map(function(t){var r=t.content.evaluate(e);return gi(r)===Yn?new Xa("",r,null,null,null):new Xa(qa(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))},Oo.prototype.eachChild=function(e){for(var t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e(f.content),f.scale&&e(f.scale),f.font&&e(f.font),f.textColor&&e(f.textColor)}},Oo.prototype.outputDefined=function(){return!1},Oo.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e.push(f.content.serialize());var v={};f.scale&&(v["font-scale"]=f.scale.serialize()),f.font&&(v["text-font"]=f.font.serialize()),f.textColor&&(v["text-color"]=f.textColor.serialize()),e.push(v)}return e};var Oa=function(e){this.type=Yn,this.input=e};Oa.parse=function(e,t){if(e.length!==2)return t.error("Expected two arguments.");var r=t.parse(e[1],1,vn);return r?new Oa(r):t.error("No image name provided.")},Oa.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=da.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r},Oa.prototype.eachChild=function(e){e(this.input)},Oa.prototype.outputDefined=function(){return!1},Oa.prototype.serialize=function(){return["image",this.input.serialize()]};var Za={"to-boolean":Wr,"to-color":ln,"to-number":gr,"to-string":vn},cs=function(e,t){this.type=e,this.args=t};cs.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[0];if((r==="to-boolean"||r==="to-string")&&e.length!==2)return t.error("Expected one argument.");for(var f=Za[r],v=[],m=1;m<e.length;m++){var x=t.parse(e[m],m,pn);if(!x)return null;v.push(x)}return new cs(f,v)},cs.prototype.evaluate=function(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){for(var t,r,f=0,v=this.args;f<v.length;f+=1){if(r=null,(t=v[f].evaluate(e))instanceof Fi)return t;if(typeof t=="string"){var m=e.parseColor(t);if(m)return m}else if(Array.isArray(t)&&!(r=t.length<3||t.length>4?"Invalid rbga value "+JSON.stringify(t)+": expected an array containing either three or four numeric values.":Vu(t[0],t[1],t[2],t[3])))return new Fi(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new $a(r||"Could not parse color from value '"+(typeof t=="string"?t:String(JSON.stringify(t)))+"'")}if(this.type.kind==="number"){for(var x=null,A=0,F=this.args;A<F.length;A+=1){if((x=F[A].evaluate(e))===null)return 0;var Z=Number(x);if(!isNaN(Z))return Z}throw new $a("Could not convert "+JSON.stringify(x)+" to number.")}return this.type.kind==="formatted"?_a.fromString(qa(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?da.fromString(qa(this.args[0].evaluate(e))):qa(this.args[0].evaluate(e))},cs.prototype.eachChild=function(e){this.args.forEach(e)},cs.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},cs.prototype.serialize=function(){if(this.type.kind==="formatted")return new Oo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Oa(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild(function(t){e.push(t.serialize())}),e};var va=["Unknown","Point","LineString","Polygon"],fs=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};fs.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},fs.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?va[this.feature.type]:this.feature.type:null},fs.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},fs.prototype.canonicalID=function(){return this.canonical},fs.prototype.properties=function(){return this.feature&&this.feature.properties||{}},fs.prototype.parseColor=function(e){var t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Fi.parse(e)),t};var Ca=function(e,t,r,f){this.name=e,this.type=t,this._evaluate=r,this.args=f};Ca.prototype.evaluate=function(e){return this._evaluate(e,this.args)},Ca.prototype.eachChild=function(e){this.args.forEach(e)},Ca.prototype.outputDefined=function(){return!1},Ca.prototype.serialize=function(){return[this.name].concat(this.args.map(function(e){return e.serialize()}))},Ca.parse=function(e,t){var r,f=e[0],v=Ca.definitions[f];if(!v)return t.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0);for(var m=Array.isArray(v)?v[0]:v.type,x=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,A=x.filter(function(ei){var Tn=ei[0];return!Array.isArray(Tn)||Tn.length===e.length-1}),F=null,Z=0,K=A;Z<K.length;Z+=1){var q=K[Z],ue=q[0],de=q[1];F=new bs(t.registry,t.path,null,t.scope);for(var Ge=[],Ye=!1,ct=1;ct<e.length;ct++){var rt=e[ct],It=Array.isArray(ue)?ue[ct-1]:ue.type,Wt=F.parse(rt,1+Ge.length,It);if(!Wt){Ye=!0;break}Ge.push(Wt)}if(!Ye)if(Array.isArray(ue)&&ue.length!==Ge.length)F.error("Expected "+ue.length+" arguments, but found "+Ge.length+" instead.");else{for(var ir=0;ir<Ge.length;ir++){var dr=Array.isArray(ue)?ue[ir]:ue.type,Mr=Ge[ir];F.concat(ir+1).checkSubtype(dr,Mr.type)}if(F.errors.length===0)return new Ca(f,m,de,Ge)}}if(A.length===1)(r=t.errors).push.apply(r,F.errors);else{for(var en=(A.length?A:x).map(function(ei){var Tn;return Tn=ei[0],Array.isArray(Tn)?"("+Tn.map(ki).join(", ")+")":"("+ki(Tn.type)+"...)"}).join(" | "),dn=[],Hn=1;Hn<e.length;Hn++){var En=t.parse(e[Hn],1+dn.length);if(!En)return null;dn.push(ki(En.type))}t.error("Expected arguments of type "+en+", but found ("+dn.join(", ")+") instead.")}return null},Ca.register=function(e,t){for(var r in Ca.definitions=t,t)e[r]=Ca};var fo=function(e,t,r){this.type=wi,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t};function Zi(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function pe(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Le(e,t){var r=(180+e[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,v=Math.pow(2,t.z);return[Math.round(r*v*8192),Math.round(f*v*8192)]}function vt(e,t,r){return t[1]>e[1]!=r[1]>e[1]&&e[0]<(r[0]-t[0])*(e[1]-t[1])/(r[1]-t[1])+t[0]}function hr(e,t){for(var r,f,v,m,x,A,F,Z=!1,K=0,q=t.length;K<q;K++)for(var ue=t[K],de=0,Ge=ue.length;de<Ge-1;de++){if((m=(r=e)[0]-(f=ue[de])[0])*(F=r[1]-(v=ue[de+1])[1])-(A=r[0]-v[0])*(x=r[1]-f[1])==0&&m*A<=0&&x*F<=0)return!1;vt(e,ue[de],ue[de+1])&&(Z=!Z)}return Z}function Qr(e,t){for(var r=0;r<t.length;r++)if(hr(e,t[r]))return!0;return!1}function Dn(e,t,r,f){var v=f[0]-r[0],m=f[1]-r[1],x=(e[0]-r[0])*m-v*(e[1]-r[1]),A=(t[0]-r[0])*m-v*(t[1]-r[1]);return x>0&&A<0||x<0&&A>0}function Ki(e,t,r){for(var f=0,v=r;f<v.length;f+=1)for(var m=v[f],x=0;x<m.length-1;++x)if((q=[(K=m[x+1])[0]-(Z=m[x])[0],K[1]-Z[1]])[0]*(ue=[(F=t)[0]-(A=e)[0],F[1]-A[1]])[1]-q[1]*ue[0]!=0&&Dn(A,F,Z,K)&&Dn(Z,K,A,F))return!0;var A,F,Z,K,q,ue;return!1}function Ua(e,t){for(var r=0;r<e.length;++r)if(!hr(e[r],t))return!1;for(var f=0;f<e.length-1;++f)if(Ki(e[f],e[f+1],t))return!1;return!0}function La(e,t){for(var r=0;r<t.length;r++)if(Ua(e,t[r]))return!0;return!1}function ja(e,t,r){for(var f=[],v=0;v<e.length;v++){for(var m=[],x=0;x<e[v].length;x++){var A=Le(e[v][x],r);Zi(t,A),m.push(A)}f.push(m)}return f}function To(e,t,r){for(var f=[],v=0;v<e.length;v++){var m=ja(e[v],t,r);f.push(m)}return f}function Mu(e,t,r,f){if(e[0]<r[0]||e[0]>r[2]){var v=.5*f,m=e[0]-r[0]>v?-f:r[0]-e[0]>v?f:0;m===0&&(m=e[0]-r[2]>v?-f:r[2]-e[0]>v?f:0),e[0]+=m}Zi(t,e)}function $l(e,t,r,f){for(var v=8192*Math.pow(2,f.z),m=[8192*f.x,8192*f.y],x=[],A=0,F=e;A<F.length;A+=1)for(var Z=0,K=F[A];Z<K.length;Z+=1){var q=K[Z],ue=[q.x+m[0],q.y+m[1]];Mu(ue,t,r,v),x.push(ue)}return x}function Il(e,t,r,f){for(var v,m=8192*Math.pow(2,f.z),x=[8192*f.x,8192*f.y],A=[],F=0,Z=e;F<Z.length;F+=1){for(var K=[],q=0,ue=Z[F];q<ue.length;q+=1){var de=ue[q],Ge=[de.x+x[0],de.y+x[1]];Zi(t,Ge),K.push(Ge)}A.push(K)}if(t[2]-t[0]<=m/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(var Ye=0,ct=A;Ye<ct.length;Ye+=1)for(var rt=0,It=ct[Ye];rt<It.length;rt+=1)Mu(It[rt],t,r,m)}return A}fo.parse=function(e,t){if(e.length!==2)return t.error("Expected one argument.");var r=e[1];if(typeof r!="object"||Array.isArray(r))return t.error("Collator options argument must be an object.");var f=t.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,Wr);if(!f)return null;var v=t.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,Wr);if(!v)return null;var m=null;return r.locale&&!(m=t.parse(r.locale,1,vn))?null:new fo(f,v,m)},fo.prototype.evaluate=function(e){return new ya(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},fo.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},fo.prototype.outputDefined=function(){return!1},fo.prototype.serialize=function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]};var Lo=function(e,t){this.type=Wr,this.geojson=e,this.geometries=t};function Xs(e){if(e instanceof Ca&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof Lo)return!1;var t=!0;return e.eachChild(function(r){t&&!Xs(r)&&(t=!1)}),t}function ua(e){if(e instanceof Ca&&e.name==="feature-state")return!1;var t=!0;return e.eachChild(function(r){t&&!ua(r)&&(t=!1)}),t}function Ns(e,t){if(e instanceof Ca&&t.indexOf(e.name)>=0)return!1;var r=!0;return e.eachChild(function(f){r&&!Ns(f,t)&&(r=!1)}),r}Lo.parse=function(e,t){if(e.length!==2)return t.error("'within' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(Ya(e[1])){var r=e[1];if(r.type==="FeatureCollection")for(var f=0;f<r.features.length;++f){var v=r.features[f].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Lo(r,r.features[f].geometry)}else if(r.type==="Feature"){var m=r.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Lo(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new Lo(r,r)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Lo.prototype.evaluate=function(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],m=t.canonicalID();if(r.type==="Polygon"){var x=ja(r.coordinates,v,m),A=$l(t.geometry(),f,v,m);if(!pe(f,v))return!1;for(var F=0,Z=A;F<Z.length;F+=1)if(!hr(Z[F],x))return!1}if(r.type==="MultiPolygon"){var K=To(r.coordinates,v,m),q=$l(t.geometry(),f,v,m);if(!pe(f,v))return!1;for(var ue=0,de=q;ue<de.length;ue+=1)if(!Qr(de[ue],K))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],m=t.canonicalID();if(r.type==="Polygon"){var x=ja(r.coordinates,v,m),A=Il(t.geometry(),f,v,m);if(!pe(f,v))return!1;for(var F=0,Z=A;F<Z.length;F+=1)if(!Ua(Z[F],x))return!1}if(r.type==="MultiPolygon"){var K=To(r.coordinates,v,m),q=Il(t.geometry(),f,v,m);if(!pe(f,v))return!1;for(var ue=0,de=q;ue<de.length;ue+=1)if(!La(de[ue],K))return!1}return!0}(e,this.geometries)}return!1},Lo.prototype.eachChild=function(){},Lo.prototype.outputDefined=function(){return!0},Lo.prototype.serialize=function(){return["within",this.geojson]};var ou=function(e,t){this.type=t.type,this.name=e,this.boundExpression=t};ou.parse=function(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");var r=e[1];return t.scope.has(r)?new ou(r,t.scope.get(r)):t.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},ou.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},ou.prototype.eachChild=function(){},ou.prototype.outputDefined=function(){return!1},ou.prototype.serialize=function(){return["var",this.name]};var bs=function(e,t,r,f,v){t===void 0&&(t=[]),f===void 0&&(f=new bn),v===void 0&&(v=[]),this.registry=e,this.path=t,this.key=t.map(function(m){return"["+m+"]"}).join(""),this.scope=f,this.errors=v,this.expectedType=r};function Ps(e,t){for(var r,f=e.length-1,v=0,m=f,x=0;v<=m;)if((r=e[x=Math.floor((v+m)/2)])<=t){if(x===f||t<e[x+1])return x;v=x+1}else{if(!(r>t))throw new $a("Input is not a number.");m=x-1}return 0}bs.prototype.parse=function(e,t,r,f,v){return v===void 0&&(v={}),t?this.concat(t,r,f)._parse(e,v):this._parse(e,v)},bs.prototype._parse=function(e,t){function r(Z,K,q){return q==="assert"?new Gi(K,[Z]):q==="coerce"?new cs(K,[Z]):Z}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var f=e[0];if(typeof f!="string")return this.error("Expression name must be a string, but found "+typeof f+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var v=this.registry[f];if(v){var m=v.parse(e,this);if(!m)return null;if(this.expectedType){var x=this.expectedType,A=m.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||A.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||A.kind!=="value"&&A.kind!=="string"){if(this.checkSubtype(x,A))return null}else m=r(m,x,t.typeAnnotation||"coerce");else m=r(m,x,t.typeAnnotation||"assert")}if(!(m instanceof Ka)&&m.type.kind!=="resolvedImage"&&function Z(K){if(K instanceof ou)return Z(K.boundExpression);if(K instanceof Ca&&K.name==="error"||K instanceof fo||K instanceof Lo)return!1;var q=K instanceof cs||K instanceof Gi,ue=!0;return K.eachChild(function(de){ue=q?ue&&Z(de):ue&&de instanceof Ka}),!!ue&&Xs(K)&&Ns(K,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(m)){var F=new fs;try{m=new Ka(m.type,m.evaluate(F))}catch(Z){return this.error(Z.message),null}}return m}return this.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof e+" instead.")},bs.prototype.concat=function(e,t,r){var f=typeof e=="number"?this.path.concat(e):this.path,v=r?this.scope.concat(r):this.scope;return new bs(this.registry,f,t||null,v,this.errors)},bs.prototype.error=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var f=""+this.key+t.map(function(v){return"["+v+"]"}).join("");this.errors.push(new Fr(f,e))},bs.prototype.checkSubtype=function(e,t){var r=Wn(e,t);return r&&this.error(r),r};var ti=function(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(var f=0,v=r;f<v.length;f+=1){var m=v[f],x=m[1];this.labels.push(m[0]),this.outputs.push(x)}};function ho(e,t,r){return e*(1-r)+t*r}ti.parse=function(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");var r=t.parse(e[1],1,gr);if(!r)return null;var f=[],v=null;t.expectedType&&t.expectedType.kind!=="value"&&(v=t.expectedType);for(var m=1;m<e.length;m+=2){var x=m===1?-1/0:e[m],A=e[m+1],F=m,Z=m+1;if(typeof x!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(f.length&&f[f.length-1][0]>=x)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);var K=t.parse(A,Z,v);if(!K)return null;v=v||K.type,f.push([x,K])}return new ti(v,r,f)},ti.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;return f>=t[v-1]?r[v-1].evaluate(e):r[Ps(t,f)].evaluate(e)},ti.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},ti.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},ti.prototype.serialize=function(){for(var e=["step",this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e};var su=Object.freeze({__proto__:null,number:ho,color:function(e,t,r){return new Fi(ho(e.r,t.r,r),ho(e.g,t.g,r),ho(e.b,t.b,r),ho(e.a,t.a,r))},array:function(e,t,r){return e.map(function(f,v){return ho(f,t[v],r)})}}),Ol=6/29*3*(6/29),sl=Math.PI/180,Xe=180/Math.PI;function Pt(e){return e>.008856451679035631?Math.pow(e,1/3):e/Ol+4/29}function _r(e){return e>6/29?e*e*e:Ol*(e-4/29)}function Zn(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function sa(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function xa(e){var t=sa(e.r),r=sa(e.g),f=sa(e.b),v=Pt((.4124564*t+.3575761*r+.1804375*f)/.95047),m=Pt((.2126729*t+.7151522*r+.072175*f)/1);return{l:116*m-16,a:500*(v-m),b:200*(m-Pt((.0193339*t+.119192*r+.9503041*f)/1.08883)),alpha:e.a}}function ka(e){var t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,f=isNaN(e.b)?t:t-e.b/200;return t=1*_r(t),r=.95047*_r(r),f=1.08883*_r(f),new Fi(Zn(3.2404542*r-1.5371385*t-.4985314*f),Zn(-.969266*r+1.8760108*t+.041556*f),Zn(.0556434*r-.2040259*t+1.0572252*f),e.alpha)}function vi(e,t,r){var f=t-e;return e+r*(f>180||f<-180?f-360*Math.round(f/360):f)}var Ta={forward:xa,reverse:ka,interpolate:function(e,t,r){return{l:ho(e.l,t.l,r),a:ho(e.a,t.a,r),b:ho(e.b,t.b,r),alpha:ho(e.alpha,t.alpha,r)}}},eo={forward:function(e){var t=xa(e),r=t.l,f=t.a,v=t.b,m=Math.atan2(v,f)*Xe;return{h:m<0?m+360:m,c:Math.sqrt(f*f+v*v),l:r,alpha:e.a}},reverse:function(e){var t=e.h*sl,r=e.c;return ka({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:vi(e.h,t.h,r),c:ho(e.c,t.c,r),l:ho(e.l,t.l,r),alpha:ho(e.alpha,t.alpha,r)}}},qn=Object.freeze({__proto__:null,lab:Ta,hcl:eo}),ba=function(e,t,r,f,v){this.type=e,this.operator=t,this.interpolation=r,this.input=f,this.labels=[],this.outputs=[];for(var m=0,x=v;m<x.length;m+=1){var A=x[m],F=A[1];this.labels.push(A[0]),this.outputs.push(F)}};function Jl(e,t,r,f){var v=f-r,m=e-r;return v===0?0:t===1?m/v:(Math.pow(t,m)-1)/(Math.pow(t,v)-1)}ba.interpolationFactor=function(e,t,r,f){var v=0;if(e.name==="exponential")v=Jl(t,e.base,r,f);else if(e.name==="linear")v=Jl(t,1,r,f);else if(e.name==="cubic-bezier"){var m=e.controlPoints;v=new X(m[0],m[1],m[2],m[3]).solve(Jl(t,1,r,f))}return v},ba.parse=function(e,t){var r=e[0],f=e[1],v=e[2],m=e.slice(3);if(!Array.isArray(f)||f.length===0)return t.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){var x=f[1];if(typeof x!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:x}}else{if(f[0]!=="cubic-bezier")return t.error("Unknown interpolation type "+String(f[0]),1,0);var A=f.slice(1);if(A.length!==4||A.some(function(ct){return typeof ct!="number"||ct<0||ct>1}))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:A}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(v=t.parse(v,2,gr)))return null;var F=[],Z=null;r==="interpolate-hcl"||r==="interpolate-lab"?Z=ln:t.expectedType&&t.expectedType.kind!=="value"&&(Z=t.expectedType);for(var K=0;K<m.length;K+=2){var q=m[K],ue=m[K+1],de=K+3,Ge=K+4;if(typeof q!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',de);if(F.length&&F[F.length-1][0]>=q)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',de);var Ye=t.parse(ue,Ge,Z);if(!Ye)return null;Z=Z||Ye.type,F.push([q,Ye])}return Z.kind==="number"||Z.kind==="color"||Z.kind==="array"&&Z.itemType.kind==="number"&&typeof Z.N=="number"?new ba(Z,r,f,v,F):t.error("Type "+ki(Z)+" is not interpolatable.")},ba.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;if(f>=t[v-1])return r[v-1].evaluate(e);var m=Ps(t,f),x=ba.interpolationFactor(this.interpolation,f,t[m],t[m+1]),A=r[m].evaluate(e),F=r[m+1].evaluate(e);return this.operator==="interpolate"?su[this.type.kind.toLowerCase()](A,F,x):this.operator==="interpolate-hcl"?eo.reverse(eo.interpolate(eo.forward(A),eo.forward(F),x)):Ta.reverse(Ta.interpolate(Ta.forward(A),Ta.forward(F),x))},ba.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},ba.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},ba.prototype.serialize=function(){var e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var t=[this.operator,e,this.input.serialize()],r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t};var Ra=function(e,t){this.type=e,this.args=t};Ra.parse=function(e,t){if(e.length<2)return t.error("Expectected at least one argument.");var r=null,f=t.expectedType;f&&f.kind!=="value"&&(r=f);for(var v=[],m=0,x=e.slice(1);m<x.length;m+=1){var A=t.parse(x[m],1+v.length,r,void 0,{typeAnnotation:"omit"});if(!A)return null;r=r||A.type,v.push(A)}var F=f&&v.some(function(Z){return Wn(f,Z.type)});return new Ra(F?pn:r,v)},Ra.prototype.evaluate=function(e){for(var t,r=null,f=0,v=0,m=this.args;v<m.length&&(f++,(r=m[v].evaluate(e))&&r instanceof da&&!r.available&&(t||(t=r.name),r=null,f===this.args.length&&(r=t)),r===null);v+=1);return r},Ra.prototype.eachChild=function(e){this.args.forEach(e)},Ra.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Ra.prototype.serialize=function(){var e=["coalesce"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Ro=function(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t};Ro.prototype.evaluate=function(e){return this.result.evaluate(e)},Ro.prototype.eachChild=function(e){for(var t=0,r=this.bindings;t<r.length;t+=1)e(r[t][1]);e(this.result)},Ro.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found "+(e.length-1)+" instead.");for(var r=[],f=1;f<e.length-1;f+=2){var v=e[f];if(typeof v!="string")return t.error("Expected string, but found "+typeof v+" instead.",f);if(/[^a-zA-Z0-9_]/.test(v))return t.error("Variable names must contain only alphanumeric characters or '_'.",f);var m=t.parse(e[f+1],f+1);if(!m)return null;r.push([v,m])}var x=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return x?new Ro(r,x):null},Ro.prototype.outputDefined=function(){return this.result.outputDefined()},Ro.prototype.serialize=function(){for(var e=["let"],t=0,r=this.bindings;t<r.length;t+=1){var f=r[t];e.push(f[0],f[1].serialize())}return e.push(this.result.serialize()),e};var xu=function(e,t,r){this.type=e,this.index=t,this.input=r};xu.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,gr),f=t.parse(e[2],2,Di(t.expectedType||pn));return r&&f?new xu(f.type.itemType,r,f):null},xu.prototype.evaluate=function(e){var t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new $a("Array index out of bounds: "+t+" < 0.");if(t>=r.length)throw new $a("Array index out of bounds: "+t+" > "+(r.length-1)+".");if(t!==Math.floor(t))throw new $a("Array index must be an integer, but found "+t+" instead.");return r[t]},xu.prototype.eachChild=function(e){e(this.index),e(this.input)},xu.prototype.outputDefined=function(){return!1},xu.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Ys=function(e,t){this.type=Wr,this.needle=e,this.haystack=t};Ys.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,pn),f=t.parse(e[2],2,pn);return r&&f?ai(r.type,[Wr,vn,gr,gn,pn])?new Ys(r,f):t.error("Expected first argument to be of type boolean, string, number or null, but found "+ki(r.type)+" instead"):null},Ys.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!Ai(t,["boolean","string","number","null"]))throw new $a("Expected first argument to be of type boolean, string, number or null, but found "+ki(gi(t))+" instead.");if(!Ai(r,["string","array"]))throw new $a("Expected second argument to be of type array or string, but found "+ki(gi(r))+" instead.");return r.indexOf(t)>=0},Ys.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},Ys.prototype.outputDefined=function(){return!0},Ys.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var zs=function(e,t,r){this.type=gr,this.needle=e,this.haystack=t,this.fromIndex=r};zs.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,pn),f=t.parse(e[2],2,pn);if(!r||!f)return null;if(!ai(r.type,[Wr,vn,gr,gn,pn]))return t.error("Expected first argument to be of type boolean, string, number or null, but found "+ki(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,gr);return v?new zs(r,f,v):null}return new zs(r,f)},zs.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Ai(t,["boolean","string","number","null"]))throw new $a("Expected first argument to be of type boolean, string, number or null, but found "+ki(gi(t))+" instead.");if(!Ai(r,["string","array"]))throw new $a("Expected second argument to be of type array or string, but found "+ki(gi(r))+" instead.");if(this.fromIndex){var f=this.fromIndex.evaluate(e);return r.indexOf(t,f)}return r.indexOf(t)},zs.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},zs.prototype.outputDefined=function(){return!1},zs.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var rs=function(e,t,r,f,v,m){this.inputType=e,this.type=t,this.input=r,this.cases=f,this.outputs=v,this.otherwise=m};rs.parse=function(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return t.error("Expected an even number of arguments.");var r,f;t.expectedType&&t.expectedType.kind!=="value"&&(f=t.expectedType);for(var v={},m=[],x=2;x<e.length-1;x+=2){var A=e[x],F=e[x+1];Array.isArray(A)||(A=[A]);var Z=t.concat(x);if(A.length===0)return Z.error("Expected at least one branch label.");for(var K=0,q=A;K<q.length;K+=1){var ue=q[K];if(typeof ue!="number"&&typeof ue!="string")return Z.error("Branch labels must be numbers or strings.");if(typeof ue=="number"&&Math.abs(ue)>Number.MAX_SAFE_INTEGER)return Z.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof ue=="number"&&Math.floor(ue)!==ue)return Z.error("Numeric branch labels must be integer values.");if(r){if(Z.checkSubtype(r,gi(ue)))return null}else r=gi(ue);if(v[String(ue)]!==void 0)return Z.error("Branch labels must be unique.");v[String(ue)]=m.length}var de=t.parse(F,x,f);if(!de)return null;f=f||de.type,m.push(de)}var Ge=t.parse(e[1],1,pn);if(!Ge)return null;var Ye=t.parse(e[e.length-1],e.length-1,f);return Ye?Ge.type.kind!=="value"&&t.concat(1).checkSubtype(r,Ge.type)?null:new rs(r,f,Ge,v,m,Ye):null},rs.prototype.evaluate=function(e){var t=this.input.evaluate(e);return(gi(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)},rs.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},rs.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})&&this.otherwise.outputDefined()},rs.prototype.serialize=function(){for(var e=this,t=["match",this.input.serialize()],r=[],f={},v=0,m=Object.keys(this.cases).sort();v<m.length;v+=1){var x=m[v];(q=f[this.cases[x]])===void 0?(f[this.cases[x]]=r.length,r.push([this.cases[x],[x]])):r[q][1].push(x)}for(var A=function(de){return e.inputType.kind==="number"?Number(de):de},F=0,Z=r;F<Z.length;F+=1){var K=Z[F],q=K[0],ue=K[1];t.push(ue.length===1?A(ue[0]):ue.map(A)),t.push(this.outputs[outputIndex$1].serialize())}return t.push(this.otherwise.serialize()),t};var Iu=function(e,t,r){this.type=e,this.branches=t,this.otherwise=r};Iu.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return t.error("Expected an odd number of arguments.");var r;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);for(var f=[],v=1;v<e.length-1;v+=2){var m=t.parse(e[v],v,Wr);if(!m)return null;var x=t.parse(e[v+1],v+1,r);if(!x)return null;f.push([m,x]),r=r||x.type}var A=t.parse(e[e.length-1],e.length-1,r);return A?new Iu(r,f,A):null},Iu.prototype.evaluate=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];if(f[0].evaluate(e))return v.evaluate(e)}return this.otherwise.evaluate(e)},Iu.prototype.eachChild=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];e(f[0]),e(v)}e(this.otherwise)},Iu.prototype.outputDefined=function(){return this.branches.every(function(e){return e[1].outputDefined()})&&this.otherwise.outputDefined()},Iu.prototype.serialize=function(){var e=["case"];return this.eachChild(function(t){e.push(t.serialize())}),e};var xo=function(e,t,r,f){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=f};function rf(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function ul(e,t,r,f){return f.compare(t,r)===0}function Ui(e,t,r){var f=e!=="=="&&e!=="!=";return function(){function v(m,x,A){this.type=Wr,this.lhs=m,this.rhs=x,this.collator=A,this.hasUntypedArgument=m.type.kind==="value"||x.type.kind==="value"}return v.parse=function(m,x){if(m.length!==3&&m.length!==4)return x.error("Expected two or three arguments.");var A=m[0],F=x.parse(m[1],1,pn);if(!F)return null;if(!rf(A,F.type))return x.concat(1).error('"'+A+`" comparisons are not supported for type '`+ki(F.type)+"'.");var Z=x.parse(m[2],2,pn);if(!Z)return null;if(!rf(A,Z.type))return x.concat(2).error('"'+A+`" comparisons are not supported for type '`+ki(Z.type)+"'.");if(F.type.kind!==Z.type.kind&&F.type.kind!=="value"&&Z.type.kind!=="value")return x.error("Cannot compare types '"+ki(F.type)+"' and '"+ki(Z.type)+"'.");f&&(F.type.kind==="value"&&Z.type.kind!=="value"?F=new Gi(Z.type,[F]):F.type.kind!=="value"&&Z.type.kind==="value"&&(Z=new Gi(F.type,[Z])));var K=null;if(m.length===4){if(F.type.kind!=="string"&&Z.type.kind!=="string"&&F.type.kind!=="value"&&Z.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(!(K=x.parse(m[3],3,wi)))return null}return new v(F,Z,K)},v.prototype.evaluate=function(m){var x=this.lhs.evaluate(m),A=this.rhs.evaluate(m);if(f&&this.hasUntypedArgument){var F=gi(x),Z=gi(A);if(F.kind!==Z.kind||F.kind!=="string"&&F.kind!=="number")throw new $a('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+F.kind+", "+Z.kind+") instead.")}if(this.collator&&!f&&this.hasUntypedArgument){var K=gi(x),q=gi(A);if(K.kind!=="string"||q.kind!=="string")return t(m,x,A)}return this.collator?r(m,x,A,this.collator.evaluate(m)):t(m,x,A)},v.prototype.eachChild=function(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)},v.prototype.outputDefined=function(){return!0},v.prototype.serialize=function(){var m=[e];return this.eachChild(function(x){m.push(x.serialize())}),m},v}()}xo.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,pn),f=t.parse(e[2],2,gr);if(!r||!f)return null;if(!ai(r.type,[Di(pn),vn,pn]))return t.error("Expected first argument to be of type array or string, but found "+ki(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,gr);return v?new xo(r.type,r,f,v):null}return new xo(r.type,r,f)},xo.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!Ai(t,["string","array"]))throw new $a("Expected first argument to be of type array or string, but found "+ki(gi(t))+" instead.");if(this.endIndex){var f=this.endIndex.evaluate(e);return t.slice(r,f)}return t.slice(r)},xo.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},xo.prototype.outputDefined=function(){return!1},xo.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Hf=Ui("==",function(e,t,r){return t===r},ul),Ql=Ui("!=",function(e,t,r){return t!==r},function(e,t,r,f){return!ul(0,t,r,f)}),Sf=Ui("<",function(e,t,r){return t<r},function(e,t,r,f){return f.compare(t,r)<0}),Ll=Ui(">",function(e,t,r){return t>r},function(e,t,r,f){return f.compare(t,r)>0}),Ko=Ui("<=",function(e,t,r){return t<=r},function(e,t,r,f){return f.compare(t,r)<=0}),Aa=Ui(">=",function(e,t,r){return t>=r},function(e,t,r,f){return f.compare(t,r)>=0}),to=function(e,t,r,f,v){this.type=vn,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=f,this.maxFractionDigits=v};to.parse=function(e,t){if(e.length!==3)return t.error("Expected two arguments.");var r=t.parse(e[1],1,gr);if(!r)return null;var f=e[2];if(typeof f!="object"||Array.isArray(f))return t.error("NumberFormat options argument must be an object.");var v=null;if(f.locale&&!(v=t.parse(f.locale,1,vn)))return null;var m=null;if(f.currency&&!(m=t.parse(f.currency,1,vn)))return null;var x=null;if(f["min-fraction-digits"]&&!(x=t.parse(f["min-fraction-digits"],1,gr)))return null;var A=null;return f["max-fraction-digits"]&&!(A=t.parse(f["max-fraction-digits"],1,gr))?null:new to(r,v,m,x,A)},to.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},to.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},to.prototype.outputDefined=function(){return!1},to.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]};var Ks=function(e){this.type=gr,this.input=e};Ks.parse=function(e,t){if(e.length!==2)return t.error("Expected 1 argument, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?t.error("Expected argument of type string or array, but found "+ki(r.type)+" instead."):new Ks(r):null},Ks.prototype.evaluate=function(e){var t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new $a("Expected value to be of type string or array, but found "+ki(gi(t))+" instead.")},Ks.prototype.eachChild=function(e){e(this.input)},Ks.prototype.outputDefined=function(){return!1},Ks.prototype.serialize=function(){var e=["length"];return this.eachChild(function(t){e.push(t.serialize())}),e};var ns={"==":Hf,"!=":Ql,">":Ll,"<":Sf,">=":Aa,"<=":Ko,array:Gi,at:xu,boolean:Gi,case:Iu,coalesce:Ra,collator:fo,format:Oo,image:Oa,in:Ys,"index-of":zs,interpolate:ba,"interpolate-hcl":ba,"interpolate-lab":ba,length:Ks,let:Ro,literal:Ka,match:rs,number:Gi,"number-format":to,object:Gi,slice:xo,step:ti,string:Gi,"to-boolean":cs,"to-color":cs,"to-number":cs,"to-string":cs,var:ou,within:Lo};function fc(e,t){var r=t[0],f=t[1],v=t[2],m=t[3];r=r.evaluate(e),f=f.evaluate(e),v=v.evaluate(e);var x=m?m.evaluate(e):1,A=Vu(r,f,v,x);if(A)throw new $a(A);return new Fi(r/255*x,f/255*x,v/255*x,x)}function Rl(e,t){return e in t}function bu(e,t){var r=t[e];return r===void 0?null:r}function Su(e){return{type:e}}function Ou(e){return{result:"success",value:e}}function Zs(e){return{result:"error",value:e}}function Eu(e){return e["property-type"]==="data-driven"||e["property-type"]==="cross-faded-data-driven"}function hc(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Gu(e){return!!e.expression&&e.expression.interpolated}function ma(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}function Pc(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function Ef(e){return e}function ll(e,t,r){return e!==void 0?e:t!==void 0?t:r!==void 0?r:void 0}function nf(e,t,r,f,v){return ll(typeof r===v?f[r]:void 0,e.default,t.default)}function Mc(e,t,r){if(ma(r)!=="number")return ll(e.default,t.default);var f=e.stops.length;if(f===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[f-1][0])return e.stops[f-1][1];var v=Ps(e.stops.map(function(m){return m[0]}),r);return e.stops[v][1]}function pc(e,t,r){var f=e.base!==void 0?e.base:1;if(ma(r)!=="number")return ll(e.default,t.default);var v=e.stops.length;if(v===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[v-1][0])return e.stops[v-1][1];var m=Ps(e.stops.map(function(q){return q[0]}),r),x=function(q,ue,de,Ge){var Ye=Ge-de,ct=q-de;return Ye===0?0:ue===1?ct/Ye:(Math.pow(ue,ct)-1)/(Math.pow(ue,Ye)-1)}(r,f,e.stops[m][0],e.stops[m+1][0]),A=e.stops[m][1],F=e.stops[m+1][1],Z=su[t.type]||Ef;if(e.colorSpace&&e.colorSpace!=="rgb"){var K=qn[e.colorSpace];Z=function(q,ue){return K.reverse(K.interpolate(K.forward(q),K.forward(ue),x))}}return typeof A.evaluate=="function"?{evaluate:function(){for(var q=[],ue=arguments.length;ue--;)q[ue]=arguments[ue];var de=A.evaluate.apply(void 0,q),Ge=F.evaluate.apply(void 0,q);if(de!==void 0&&Ge!==void 0)return Z(de,Ge,x)}}:Z(A,F,x)}function ql(e,t,r){return t.type==="color"?r=Fi.parse(r):t.type==="formatted"?r=_a.fromString(r.toString()):t.type==="resolvedImage"?r=da.fromString(r.toString()):ma(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),ll(r,e.default,t.default)}Ca.register(ns,{error:[{kind:"error"},[vn],function(e,t){throw new $a(t[0].evaluate(e))}],typeof:[vn,[pn],function(e,t){return ki(gi(t[0].evaluate(e)))}],"to-rgba":[Di(gr,4),[ln],function(e,t){return t[0].evaluate(e).toArray()}],rgb:[ln,[gr,gr,gr],fc],rgba:[ln,[gr,gr,gr,gr],fc],has:{type:Wr,overloads:[[[vn],function(e,t){return Rl(t[0].evaluate(e),e.properties())}],[[vn,Ei],function(e,t){var r=t[1];return Rl(t[0].evaluate(e),r.evaluate(e))}]]},get:{type:pn,overloads:[[[vn],function(e,t){return bu(t[0].evaluate(e),e.properties())}],[[vn,Ei],function(e,t){var r=t[1];return bu(t[0].evaluate(e),r.evaluate(e))}]]},"feature-state":[pn,[vn],function(e,t){return bu(t[0].evaluate(e),e.featureState||{})}],properties:[Ei,[],function(e){return e.properties()}],"geometry-type":[vn,[],function(e){return e.geometryType()}],id:[pn,[],function(e){return e.id()}],zoom:[gr,[],function(e){return e.globals.zoom}],"heatmap-density":[gr,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[gr,[],function(e){return e.globals.lineProgress||0}],accumulated:[pn,[],function(e){return e.globals.accumulated===void 0?null:e.globals.accumulated}],"+":[gr,Su(gr),function(e,t){for(var r=0,f=0,v=t;f<v.length;f+=1)r+=v[f].evaluate(e);return r}],"*":[gr,Su(gr),function(e,t){for(var r=1,f=0,v=t;f<v.length;f+=1)r*=v[f].evaluate(e);return r}],"-":{type:gr,overloads:[[[gr,gr],function(e,t){var r=t[1];return t[0].evaluate(e)-r.evaluate(e)}],[[gr],function(e,t){return-t[0].evaluate(e)}]]},"/":[gr,[gr,gr],function(e,t){var r=t[1];return t[0].evaluate(e)/r.evaluate(e)}],"%":[gr,[gr,gr],function(e,t){var r=t[1];return t[0].evaluate(e)%r.evaluate(e)}],ln2:[gr,[],function(){return Math.LN2}],pi:[gr,[],function(){return Math.PI}],e:[gr,[],function(){return Math.E}],"^":[gr,[gr,gr],function(e,t){var r=t[1];return Math.pow(t[0].evaluate(e),r.evaluate(e))}],sqrt:[gr,[gr],function(e,t){return Math.sqrt(t[0].evaluate(e))}],log10:[gr,[gr],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN10}],ln:[gr,[gr],function(e,t){return Math.log(t[0].evaluate(e))}],log2:[gr,[gr],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN2}],sin:[gr,[gr],function(e,t){return Math.sin(t[0].evaluate(e))}],cos:[gr,[gr],function(e,t){return Math.cos(t[0].evaluate(e))}],tan:[gr,[gr],function(e,t){return Math.tan(t[0].evaluate(e))}],asin:[gr,[gr],function(e,t){return Math.asin(t[0].evaluate(e))}],acos:[gr,[gr],function(e,t){return Math.acos(t[0].evaluate(e))}],atan:[gr,[gr],function(e,t){return Math.atan(t[0].evaluate(e))}],min:[gr,Su(gr),function(e,t){return Math.min.apply(Math,t.map(function(r){return r.evaluate(e)}))}],max:[gr,Su(gr),function(e,t){return Math.max.apply(Math,t.map(function(r){return r.evaluate(e)}))}],abs:[gr,[gr],function(e,t){return Math.abs(t[0].evaluate(e))}],round:[gr,[gr],function(e,t){var r=t[0].evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[gr,[gr],function(e,t){return Math.floor(t[0].evaluate(e))}],ceil:[gr,[gr],function(e,t){return Math.ceil(t[0].evaluate(e))}],"filter-==":[Wr,[vn,pn],function(e,t){var r=t[0],f=t[1];return e.properties()[r.value]===f.value}],"filter-id-==":[Wr,[pn],function(e,t){var r=t[0];return e.id()===r.value}],"filter-type-==":[Wr,[vn],function(e,t){var r=t[0];return e.geometryType()===r.value}],"filter-<":[Wr,[vn,pn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],m=f.value;return typeof v==typeof m&&v<m}],"filter-id-<":[Wr,[pn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<v}],"filter->":[Wr,[vn,pn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],m=f.value;return typeof v==typeof m&&v>m}],"filter-id->":[Wr,[pn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>v}],"filter-<=":[Wr,[vn,pn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],m=f.value;return typeof v==typeof m&&v<=m}],"filter-id-<=":[Wr,[pn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<=v}],"filter->=":[Wr,[vn,pn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],m=f.value;return typeof v==typeof m&&v>=m}],"filter-id->=":[Wr,[pn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>=v}],"filter-has":[Wr,[pn],function(e,t){return t[0].value in e.properties()}],"filter-has-id":[Wr,[],function(e){return e.id()!==null&&e.id()!==void 0}],"filter-type-in":[Wr,[Di(vn)],function(e,t){return t[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[Wr,[Di(pn)],function(e,t){return t[0].value.indexOf(e.id())>=0}],"filter-in-small":[Wr,[vn,Di(pn)],function(e,t){var r=t[0];return t[1].value.indexOf(e.properties()[r.value])>=0}],"filter-in-large":[Wr,[vn,Di(pn)],function(e,t){var r=t[0],f=t[1];return function(v,m,x,A){for(;x<=A;){var F=x+A>>1;if(m[F]===v)return!0;m[F]>v?A=F-1:x=F+1}return!1}(e.properties()[r.value],f.value,0,f.value.length-1)}],all:{type:Wr,overloads:[[[Wr,Wr],function(e,t){var r=t[1];return t[0].evaluate(e)&&r.evaluate(e)}],[Su(Wr),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(!f[r].evaluate(e))return!1;return!0}]]},any:{type:Wr,overloads:[[[Wr,Wr],function(e,t){var r=t[1];return t[0].evaluate(e)||r.evaluate(e)}],[Su(Wr),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(f[r].evaluate(e))return!0;return!1}]]},"!":[Wr,[Wr],function(e,t){return!t[0].evaluate(e)}],"is-supported-script":[Wr,[vn],function(e,t){var r=e.globals&&e.globals.isSupportedScript;return!r||r(t[0].evaluate(e))}],upcase:[vn,[vn],function(e,t){return t[0].evaluate(e).toUpperCase()}],downcase:[vn,[vn],function(e,t){return t[0].evaluate(e).toLowerCase()}],concat:[vn,Su(pn),function(e,t){return t.map(function(r){return qa(r.evaluate(e))}).join("")}],"resolved-locale":[vn,[wi],function(e,t){return t[0].evaluate(e).resolvedLocale()}]});var cl=function(e,t){this.expression=e,this._warningHistory={},this._evaluator=new fs,this._defaultValue=t?function(r){return r.type==="color"&&Pc(r.default)?new Fi(0,0,0,0):r.type==="color"?Fi.parse(r.default)||null:r.default===void 0?null:r.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null};function wu(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in ns}function ec(e,t){var r=new bs(ns,[],t?function(v){var m={color:ln,string:vn,number:gr,enum:vn,boolean:Wr,formatted:Yi,resolvedImage:Yn};return v.type==="array"?Di(m[v.value]||pn,v.length):m[v.type]}(t):void 0),f=r.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Ou(new cl(f,t)):Zs(r.errors)}cl.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,m){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)},cl.prototype.evaluate=function(e,t,r,f,v,m){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=m||null;try{var x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new $a("Expected value to be one of "+Object.keys(this._enumValues).map(function(A){return JSON.stringify(A)}).join(", ")+", but found "+JSON.stringify(x)+" instead.");return x}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console!="undefined"&&console.warn(A.message)),this._defaultValue}};var fl=function(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!ua(t.expression)};fl.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,m){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,m)},fl.prototype.evaluate=function(e,t,r,f,v,m){return this._styleExpression.evaluate(e,t,r,f,v,m)};var uu=function(e,t,r,f){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!ua(t.expression),this.interpolationType=f};function dc(e,t){if((e=ec(e,t)).result==="error")return e;var r=e.value.expression,f=Xs(r);if(!f&&!Eu(t))return Zs([new Fr("","data expressions not supported")]);var v=Ns(r,["zoom"]);if(!v&&!hc(t))return Zs([new Fr("","zoom expressions not supported")]);var m=function x(A){var F=null;if(A instanceof Ro)F=x(A.result);else if(A instanceof Ra)for(var Z=0,K=A.args;Z<K.length&&!(F=x(K[Z]));Z+=1);else(A instanceof ti||A instanceof ba)&&A.input instanceof Ca&&A.input.name==="zoom"&&(F=A);return F instanceof Fr||A.eachChild(function(q){var ue=x(q);ue instanceof Fr?F=ue:!F&&ue?F=new Fr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):F&&ue&&F!==ue&&(F=new Fr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),F}(r);return m||v?m instanceof Fr?Zs([m]):m instanceof ba&&!Gu(t)?Zs([new Fr("",'"interpolate" expressions cannot be used with this property')]):Ou(m?new uu(f?"camera":"composite",e.value,m.labels,m instanceof ba?m.interpolation:void 0):new fl(f?"constant":"source",e.value)):Zs([new Fr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}uu.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,m){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,m)},uu.prototype.evaluate=function(e,t,r,f,v,m){return this._styleExpression.evaluate(e,t,r,f,v,m)},uu.prototype.interpolationFactor=function(e,t,r){return this.interpolationType?ba.interpolationFactor(this.interpolationType,e,t,r):0};var hl=function(e,t){this._parameters=e,this._specification=t,yr(this,function r(f,v){var m,x,A,F=v.type==="color",Z=f.stops&&typeof f.stops[0][0]=="object",K=Z||!(Z||f.property!==void 0),q=f.type||(Gu(v)?"exponential":"interval");if(F&&((f=yr({},f)).stops&&(f.stops=f.stops.map(function(En){return[En[0],Fi.parse(En[1])]})),f.default=Fi.parse(f.default?f.default:v.default)),f.colorSpace&&f.colorSpace!=="rgb"&&!qn[f.colorSpace])throw new Error("Unknown color space: "+f.colorSpace);if(q==="exponential")m=pc;else if(q==="interval")m=Mc;else if(q==="categorical"){m=nf,x=Object.create(null);for(var ue=0,de=f.stops;ue<de.length;ue+=1){var Ge=de[ue];x[Ge[0]]=Ge[1]}A=typeof f.stops[0][0]}else{if(q!=="identity")throw new Error('Unknown function type "'+q+'"');m=ql}if(Z){for(var Ye={},ct=[],rt=0;rt<f.stops.length;rt++){var It=f.stops[rt],Wt=It[0].zoom;Ye[Wt]===void 0&&(Ye[Wt]={zoom:Wt,type:f.type,property:f.property,default:f.default,stops:[]},ct.push(Wt)),Ye[Wt].stops.push([It[0].value,It[1]])}for(var ir=[],dr=0,Mr=ct;dr<Mr.length;dr+=1){var en=Mr[dr];ir.push([Ye[en].zoom,r(Ye[en],v)])}var dn={name:"linear"};return{kind:"composite",interpolationType:dn,interpolationFactor:ba.interpolationFactor.bind(void 0,dn),zoomStops:ir.map(function(En){return En[0]}),evaluate:function(En,ei){var Tn=En.zoom;return pc({stops:ir,base:f.base},v,Tn).evaluate(Tn,ei)}}}if(K){var Hn=q==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:Hn,interpolationFactor:ba.interpolationFactor.bind(void 0,Hn),zoomStops:f.stops.map(function(En){return En[0]}),evaluate:function(En){return m(f,v,En.zoom,x,A)}}}return{kind:"source",evaluate:function(En,ei){var Tn=ei&&ei.properties?ei.properties[f.property]:void 0;return Tn===void 0?ll(f.default,v.default):m(f,v,Tn,x,A)}}}(this._parameters,this._specification))};function $s(e){var t=e.key,r=e.value,f=e.valueSpec||{},v=e.objectElementValidators||{},m=e.style,x=e.styleSpec,A=[],F=ma(r);if(F!=="object")return[new ge(t,r,"object expected, "+F+" found")];for(var Z in r){var K=Z.split(".")[0],q=f[K]||f["*"],ue=void 0;if(v[K])ue=v[K];else if(f[K])ue=Hi;else if(v["*"])ue=v["*"];else{if(!f["*"]){A.push(new ge(t,r[Z],'unknown property "'+Z+'"'));continue}ue=Hi}A=A.concat(ue({key:(t&&t+".")+Z,value:r[Z],valueSpec:q,style:m,styleSpec:x,object:r,objectKey:Z},r))}for(var de in f)v[de]||f[de].required&&f[de].default===void 0&&r[de]===void 0&&A.push(new ge(t,r,'missing required property "'+de+'"'));return A}function Ic(e){var t=e.value,r=e.valueSpec,f=e.style,v=e.styleSpec,m=e.key,x=e.arrayElementValidator||Hi;if(ma(t)!=="array")return[new ge(m,t,"array expected, "+ma(t)+" found")];if(r.length&&t.length!==r.length)return[new ge(m,t,"array length "+r.length+" expected, length "+t.length+" found")];if(r["min-length"]&&t.length<r["min-length"])return[new ge(m,t,"array length at least "+r["min-length"]+" expected, length "+t.length+" found")];var A={type:r.value,values:r.values};v.$version<7&&(A.function=r.function),ma(r.value)==="object"&&(A=r.value);for(var F=[],Z=0;Z<t.length;Z++)F=F.concat(x({array:t,arrayIndex:Z,value:t[Z],valueSpec:A,style:f,styleSpec:v,key:m+"["+Z+"]"}));return F}function Oc(e){var t=e.key,r=e.value,f=e.valueSpec,v=ma(r);return v==="number"&&r!=r&&(v="NaN"),v!=="number"?[new ge(t,r,"number expected, "+v+" found")]:"minimum"in f&&r<f.minimum?[new ge(t,r,r+" is less than the minimum value "+f.minimum)]:"maximum"in f&&r>f.maximum?[new ge(t,r,r+" is greater than the maximum value "+f.maximum)]:[]}function Lc(e){var t,r,f,v=e.valueSpec,m=Lr(e.value.type),x={},A=m!=="categorical"&&e.value.property===void 0,F=!A,Z=ma(e.value.stops)==="array"&&ma(e.value.stops[0])==="array"&&ma(e.value.stops[0][0])==="object",K=$s({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(de){if(m==="identity")return[new ge(de.key,de.value,'identity function may not have a "stops" property')];var Ge=[],Ye=de.value;return Ge=Ge.concat(Ic({key:de.key,value:Ye,valueSpec:de.valueSpec,style:de.style,styleSpec:de.styleSpec,arrayElementValidator:q})),ma(Ye)==="array"&&Ye.length===0&&Ge.push(new ge(de.key,Ye,"array must have at least one stop")),Ge},default:function(de){return Hi({key:de.key,value:de.value,valueSpec:v,style:de.style,styleSpec:de.styleSpec})}}});return m==="identity"&&A&&K.push(new ge(e.key,e.value,'missing required property "property"')),m==="identity"||e.value.stops||K.push(new ge(e.key,e.value,'missing required property "stops"')),m==="exponential"&&e.valueSpec.expression&&!Gu(e.valueSpec)&&K.push(new ge(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(F&&!Eu(e.valueSpec)?K.push(new ge(e.key,e.value,"property functions not supported")):A&&!hc(e.valueSpec)&&K.push(new ge(e.key,e.value,"zoom functions not supported"))),m!=="categorical"&&!Z||e.value.property!==void 0||K.push(new ge(e.key,e.value,'"property" property is required')),K;function q(de){var Ge=[],Ye=de.value,ct=de.key;if(ma(Ye)!=="array")return[new ge(ct,Ye,"array expected, "+ma(Ye)+" found")];if(Ye.length!==2)return[new ge(ct,Ye,"array length 2 expected, length "+Ye.length+" found")];if(Z){if(ma(Ye[0])!=="object")return[new ge(ct,Ye,"object expected, "+ma(Ye[0])+" found")];if(Ye[0].zoom===void 0)return[new ge(ct,Ye,"object stop key must have zoom")];if(Ye[0].value===void 0)return[new ge(ct,Ye,"object stop key must have value")];if(f&&f>Lr(Ye[0].zoom))return[new ge(ct,Ye[0].zoom,"stop zoom values must appear in ascending order")];Lr(Ye[0].zoom)!==f&&(f=Lr(Ye[0].zoom),r=void 0,x={}),Ge=Ge.concat($s({key:ct+"[0]",value:Ye[0],valueSpec:{zoom:{}},style:de.style,styleSpec:de.styleSpec,objectElementValidators:{zoom:Oc,value:ue}}))}else Ge=Ge.concat(ue({key:ct+"[0]",value:Ye[0],valueSpec:{},style:de.style,styleSpec:de.styleSpec},Ye));return wu(Nt(Ye[1]))?Ge.concat([new ge(ct+"[1]",Ye[1],"expressions are not allowed in function stops.")]):Ge.concat(Hi({key:ct+"[1]",value:Ye[1],valueSpec:v,style:de.style,styleSpec:de.styleSpec}))}function ue(de,Ge){var Ye=ma(de.value),ct=Lr(de.value),rt=de.value!==null?de.value:Ge;if(t){if(Ye!==t)return[new ge(de.key,rt,Ye+" stop domain type must match previous stop domain type "+t)]}else t=Ye;if(Ye!=="number"&&Ye!=="string"&&Ye!=="boolean")return[new ge(de.key,rt,"stop domain value must be a number, string, or boolean")];if(Ye!=="number"&&m!=="categorical"){var It="number expected, "+Ye+" found";return Eu(v)&&m===void 0&&(It+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ge(de.key,rt,It)]}return m!=="categorical"||Ye!=="number"||isFinite(ct)&&Math.floor(ct)===ct?m!=="categorical"&&Ye==="number"&&r!==void 0&&ct<r?[new ge(de.key,rt,"stop domain values must appear in ascending order")]:(r=ct,m==="categorical"&&ct in x?[new ge(de.key,rt,"stop domain values must be unique")]:(x[ct]=!0,[])):[new ge(de.key,rt,"integer expected, found "+ct)]}}function Hu(e){var t=(e.expressionContext==="property"?dc:ec)(Nt(e.value),e.valueSpec);if(t.result==="error")return t.value.map(function(f){return new ge(""+e.key+f.key,e.value,f.message)});var r=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!r.outputDefined())return[new ge(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!ua(r))return[new ge(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter"&&!ua(r))return[new ge(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!Ns(r,["zoom","feature-state"]))return[new ge(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!Xs(r))return[new ge(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Dl(e){var t=e.key,r=e.value,f=e.valueSpec,v=[];return Array.isArray(f.values)?f.values.indexOf(Lr(r))===-1&&v.push(new ge(t,r,"expected one of ["+f.values.join(", ")+"], "+JSON.stringify(r)+" found")):Object.keys(f.values).indexOf(Lr(r))===-1&&v.push(new ge(t,r,"expected one of ["+Object.keys(f.values).join(", ")+"], "+JSON.stringify(r)+" found")),v}function tc(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var t=0,r=e.slice(1);t<r.length;t+=1){var f=r[t];if(!tc(f)&&typeof f!="boolean")return!1}return!0;default:return!0}}hl.deserialize=function(e){return new hl(e._parameters,e._specification)},hl.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var Wu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function kl(e){if(e==null)return{filter:function(){return!0},needGeometry:!1};tc(e)||(e=Xu(e));var t=ec(e,Wu);if(t.result==="error")throw new Error(t.value.map(function(r){return r.key+": "+r.message}).join(", "));return{filter:function(r,f,v){return t.value.evaluate(r,f,{},v)},needGeometry:function r(f){if(!Array.isArray(f))return!1;if(f[0]==="within")return!0;for(var v=1;v<f.length;v++)if(r(f[v]))return!0;return!1}(e)}}function Rc(e,t){return e<t?-1:e>t?1:0}function Xu(e){if(!e)return!0;var t,r=e[0];return e.length<=1?r!=="any":r==="=="?No(e[1],e[2],"=="):r==="!="?Fl(No(e[1],e[2],"==")):r==="<"||r===">"||r==="<="||r===">="?No(e[1],e[2],r):r==="any"?(t=e.slice(1),["any"].concat(t.map(Xu))):r==="all"?["all"].concat(e.slice(1).map(Xu)):r==="none"?["all"].concat(e.slice(1).map(Xu).map(Fl)):r==="in"?af(e[1],e.slice(2)):r==="!in"?Fl(af(e[1],e.slice(2))):r==="has"?of(e[1]):r==="!has"?Fl(of(e[1])):r!=="within"||e}function No(e,t,r){switch(e){case"$type":return["filter-type-"+r,t];case"$id":return["filter-id-"+r,t];default:return["filter-"+r,e,t]}}function af(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(function(r){return typeof r!=typeof t[0]})?["filter-in-large",e,["literal",t.sort(Rc)]]:["filter-in-small",e,["literal",t]]}}function of(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Fl(e){return["!",e]}function Dc(e){return tc(Nt(e.value))?Hu(yr({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(r){var f=r.value,v=r.key;if(ma(f)!=="array")return[new ge(v,f,"array expected, "+ma(f)+" found")];var m,x=r.styleSpec,A=[];if(f.length<1)return[new ge(v,f,"filter array must have at least 1 element")];switch(A=A.concat(Dl({key:v+"[0]",value:f[0],valueSpec:x.filter_operator,style:r.style,styleSpec:r.styleSpec})),Lr(f[0])){case"<":case"<=":case">":case">=":f.length>=2&&Lr(f[1])==="$type"&&A.push(new ge(v,f,'"$type" cannot be use with operator "'+f[0]+'"'));case"==":case"!=":f.length!==3&&A.push(new ge(v,f,'filter array for operator "'+f[0]+'" must have 3 elements'));case"in":case"!in":f.length>=2&&(m=ma(f[1]))!=="string"&&A.push(new ge(v+"[1]",f[1],"string expected, "+m+" found"));for(var F=2;F<f.length;F++)m=ma(f[F]),Lr(f[1])==="$type"?A=A.concat(Dl({key:v+"["+F+"]",value:f[F],valueSpec:x.geometry_type,style:r.style,styleSpec:r.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&A.push(new ge(v+"["+F+"]",f[F],"string, number, or boolean expected, "+m+" found"));break;case"any":case"all":case"none":for(var Z=1;Z<f.length;Z++)A=A.concat(t({key:v+"["+Z+"]",value:f[Z],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":m=ma(f[1]),f.length!==2?A.push(new ge(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):m!=="string"&&A.push(new ge(v+"[1]",f[1],"string expected, "+m+" found"));break;case"within":m=ma(f[1]),f.length!==2?A.push(new ge(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):m!=="object"&&A.push(new ge(v+"[1]",f[1],"object expected, "+m+" found"))}return A}(e)}function Fa(e,t){var r=e.key,f=e.style,v=e.styleSpec,m=e.value,x=e.objectKey,A=v[t+"_"+e.layerType];if(!A)return[];var F=x.match(/^(.*)-transition$/);if(t==="paint"&&F&&A[F[1]]&&A[F[1]].transition)return Hi({key:r,value:m,valueSpec:v.transition,style:f,styleSpec:v});var Z,K=e.valueSpec||A[x];if(!K)return[new ge(r,m,'unknown property "'+x+'"')];if(ma(m)==="string"&&Eu(K)&&!K.tokens&&(Z=/^{([^}]+)}$/.exec(m)))return[new ge(r,m,'"'+x+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(Z[1])+" }`.")];var q=[];return e.layerType==="symbol"&&(x==="text-field"&&f&&!f.glyphs&&q.push(new ge(r,m,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&Pc(Nt(m))&&Lr(m.type)==="identity"&&q.push(new ge(r,m,'"text-font" does not support identity functions'))),q.concat(Hi({key:e.key,value:m,valueSpec:K,style:f,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:x}))}function kc(e){return Fa(e,"paint")}function Yu(e){return Fa(e,"layout")}function Fc(e){var t=[],r=e.value,f=e.key,v=e.style,m=e.styleSpec;r.type||r.ref||t.push(new ge(f,r,'either "type" or "ref" is required'));var x,A=Lr(r.type),F=Lr(r.ref);if(r.id)for(var Z=Lr(r.id),K=0;K<e.arrayIndex;K++){var q=v.layers[K];Lr(q.id)===Z&&t.push(new ge(f,r.id,'duplicate layer id "'+r.id+'", previously used at line '+q.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(Ge){Ge in r&&t.push(new ge(f,r[Ge],'"'+Ge+'" is prohibited for ref layers'))}),v.layers.forEach(function(Ge){Lr(Ge.id)===F&&(x=Ge)}),x?x.ref?t.push(new ge(f,r.ref,"ref cannot reference another ref layer")):A=Lr(x.type):t.push(new ge(f,r.ref,'ref layer "'+F+'" not found'));else if(A!=="background")if(r.source){var ue=v.sources&&v.sources[r.source],de=ue&&Lr(ue.type);ue?de==="vector"&&A==="raster"?t.push(new ge(f,r.source,'layer "'+r.id+'" requires a raster source')):de==="raster"&&A!=="raster"?t.push(new ge(f,r.source,'layer "'+r.id+'" requires a vector source')):de!=="vector"||r["source-layer"]?de==="raster-dem"&&A!=="hillshade"?t.push(new ge(f,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):A!=="line"||!r.paint||!r.paint["line-gradient"]||de==="geojson"&&ue.lineMetrics||t.push(new ge(f,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):t.push(new ge(f,r,'layer "'+r.id+'" must specify a "source-layer"')):t.push(new ge(f,r.source,'source "'+r.source+'" not found'))}else t.push(new ge(f,r,'missing required property "source"'));return t=t.concat($s({key:f,value:r,valueSpec:m.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Hi({key:f+".type",value:r.type,valueSpec:m.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"})},filter:Dc,layout:function(Ge){return $s({layer:r,key:Ge.key,value:Ge.value,style:Ge.style,styleSpec:Ge.styleSpec,objectElementValidators:{"*":function(Ye){return Yu(yr({layerType:A},Ye))}}})},paint:function(Ge){return $s({layer:r,key:Ge.key,value:Ge.value,style:Ge.style,styleSpec:Ge.styleSpec,objectElementValidators:{"*":function(Ye){return kc(yr({layerType:A},Ye))}}})}}}))}function Cu(e){var t=e.value,r=e.key,f=ma(t);return f!=="string"?[new ge(r,t,"string expected, "+f+" found")]:[]}var Pa={promoteId:function(e){var t=e.key,r=e.value;if(ma(r)==="string")return Cu({key:t,value:r});var f=[];for(var v in r)f.push.apply(f,Cu({key:t+"."+v,value:r[v]}));return f}};function rc(e){var t=e.value,r=e.key,f=e.styleSpec,v=e.style;if(!t.type)return[new ge(r,t,'"type" is required')];var m,x=Lr(t.type);switch(x){case"vector":case"raster":case"raster-dem":return $s({key:r,value:t,valueSpec:f["source_"+x.replace("-","_")],style:e.style,styleSpec:f,objectElementValidators:Pa});case"geojson":if(m=$s({key:r,value:t,valueSpec:f.source_geojson,style:v,styleSpec:f,objectElementValidators:Pa}),t.cluster)for(var A in t.clusterProperties){var F=t.clusterProperties[A],Z=F[0],K=typeof Z=="string"?[Z,["accumulated"],["get",A]]:Z;m.push.apply(m,Hu({key:r+"."+A+".map",value:F[1],expressionContext:"cluster-map"})),m.push.apply(m,Hu({key:r+"."+A+".reduce",value:K,expressionContext:"cluster-reduce"}))}return m;case"video":return $s({key:r,value:t,valueSpec:f.source_video,style:v,styleSpec:f});case"image":return $s({key:r,value:t,valueSpec:f.source_image,style:v,styleSpec:f});case"canvas":return[new ge(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Dl({key:r+".type",value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,styleSpec:f})}}function Lu(e){var t=e.value,r=e.styleSpec,f=r.light,v=e.style,m=[],x=ma(t);if(t===void 0)return m;if(x!=="object")return m.concat([new ge("light",t,"object expected, "+x+" found")]);for(var A in t){var F=A.match(/^(.*)-transition$/);m=m.concat(F&&f[F[1]]&&f[F[1]].transition?Hi({key:A,value:t[A],valueSpec:r.transition,style:v,styleSpec:r}):f[A]?Hi({key:A,value:t[A],valueSpec:f[A],style:v,styleSpec:r}):[new ge(A,t[A],'unknown property "'+A+'"')])}return m}var Ku={"*":function(){return[]},array:Ic,boolean:function(e){var t=e.value,r=e.key,f=ma(t);return f!=="boolean"?[new ge(r,t,"boolean expected, "+f+" found")]:[]},number:Oc,color:function(e){var t=e.key,r=e.value,f=ma(r);return f!=="string"?[new ge(t,r,"color expected, "+f+" found")]:Qn(r)===null?[new ge(t,r,'color expected, "'+r+'" found')]:[]},constants:pt,enum:Dl,filter:Dc,function:Lc,layer:Fc,object:$s,source:rc,light:Lu,string:Cu,formatted:function(e){return Cu(e).length===0?[]:Hu(e)},resolvedImage:function(e){return Cu(e).length===0?[]:Hu(e)}};function Hi(e){var t=e.value,r=e.valueSpec,f=e.styleSpec;return r.expression&&Pc(Lr(t))?Lc(e):r.expression&&wu(Nt(t))?Hu(e):r.type&&Ku[r.type]?Ku[r.type](e):$s(yr({},e,{valueSpec:r.type?f[r.type]:r}))}function Ma(e){var t=e.value,r=e.key,f=Cu(e);return f.length||(t.indexOf("{fontstack}")===-1&&f.push(new ge(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&f.push(new ge(r,t,'"glyphs" url must include a "{range}" token'))),f}function Us(e,t){t===void 0&&(t=te);var r=[];return r=r.concat(Hi({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Ma,"*":function(){return[]}}})),e.constants&&(r=r.concat(pt({key:"constants",value:e.constants,style:e,styleSpec:t}))),vc(r)}function vc(e){return[].concat(e).sort(function(t,r){return t.line-r.line})}function nc(e){return function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return vc(e.apply(this,t))}}Us.source=nc(rc),Us.light=nc(Lu),Us.layer=nc(Fc),Us.filter=nc(Dc),Us.paintProperty=nc(kc),Us.layoutProperty=nc(Yu);var ic=Us,Of=ic.light,Lf=ic.paintProperty,ac=ic.layoutProperty;function $u(e,t){var r=!1;if(t&&t.length)for(var f=0,v=t;f<v.length;f+=1)e.fire(new fe(new Error(v[f].message))),r=!0;return r}var Ru=ro;function ro(e,t,r){var f=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var v=new Int32Array(this.arrayBuffer);e=v[0],this.d=(t=v[1])+2*(r=v[2]);for(var m=0;m<this.d*this.d;m++){var x=v[3+m],A=v[3+m+1];f.push(x===A?null:v.subarray(x,A))}var F=v[3+f.length+1];this.keys=v.subarray(v[3+f.length],F),this.bboxes=v.subarray(F),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var Z=0;Z<this.d*this.d;Z++)f.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var K=r/t*e;this.min=-K,this.max=e+K}ro.prototype.insert=function(e,t,r,f,v){this._forEachCell(t,r,f,v,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(f),this.bboxes.push(v)},ro.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ro.prototype._insertCell=function(e,t,r,f,v,m){this.cells[v].push(m)},ro.prototype.query=function(e,t,r,f,v){var m=this.min,x=this.max;if(e<=m&&t<=m&&x<=r&&x<=f&&!v)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(e,t,r,f,this._queryCell,A,{},v),A},ro.prototype._queryCell=function(e,t,r,f,v,m,x,A){var F=this.cells[v];if(F!==null)for(var Z=this.keys,K=this.bboxes,q=0;q<F.length;q++){var ue=F[q];if(x[ue]===void 0){var de=4*ue;(A?A(K[de+0],K[de+1],K[de+2],K[de+3]):e<=K[de+2]&&t<=K[de+3]&&r>=K[de+0]&&f>=K[de+1])?(x[ue]=!0,m.push(Z[ue])):x[ue]=!1}}},ro.prototype._forEachCell=function(e,t,r,f,v,m,x,A){for(var F=this._convertToCellCoord(e),Z=this._convertToCellCoord(t),K=this._convertToCellCoord(r),q=this._convertToCellCoord(f),ue=F;ue<=K;ue++)for(var de=Z;de<=q;de++){var Ge=this.d*de+ue;if((!A||A(this._convertFromCellCoord(ue),this._convertFromCellCoord(de),this._convertFromCellCoord(ue+1),this._convertFromCellCoord(de+1)))&&v.call(this,e,t,r,f,Ge,m,x,A))return}},ro.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},ro.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},ro.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,r=0,f=0;f<this.cells.length;f++)r+=this.cells[f].length;var v=new Int32Array(t+r+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;for(var m=t,x=0;x<e.length;x++){var A=e[x];v[3+x]=m,v.set(A,m),m+=A.length}return v[3+e.length]=m,v.set(this.keys,m),v[3+e.length+1]=m+=this.keys.length,v.set(this.bboxes,m),m+=this.bboxes.length,v.buffer};var hs=k.ImageData,pl=k.ImageBitmap,Va={};function wn(e,t,r){r===void 0&&(r={}),Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Va[e]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}for(var js in wn("Object",Object),Ru.serialize=function(e,t){var r=e.toArrayBuffer();return t&&t.push(r),{buffer:r}},Ru.deserialize=function(e){return new Ru(e.buffer)},wn("Grid",Ru),wn("Color",Fi),wn("Error",Error),wn("ResolvedImage",da),wn("StylePropertyFunction",hl),wn("StyleExpression",cl,{omit:["_evaluator"]}),wn("ZoomDependentExpression",uu),wn("ZoomConstantExpression",fl),wn("CompoundExpression",Ca,{omit:["_evaluate"]}),ns)ns[js]._classRegistryKey||wn("Expression_"+js,ns[js]);function mc(e){return e&&typeof ArrayBuffer!="undefined"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function Bl(e){return pl&&e instanceof pl}function lu(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(mc(e)||Bl(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var r=e;return t&&t.push(r.buffer),r}if(e instanceof hs)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){for(var f=[],v=0,m=e;v<m.length;v+=1)f.push(lu(m[v],t));return f}if(typeof e=="object"){var x=e.constructor,A=x._classRegistryKey;if(!A)throw new Error("can't serialize object of unregistered class");var F=x.serialize?x.serialize(e,t):{};if(!x.serialize){for(var Z in e)if(e.hasOwnProperty(Z)&&!(Va[A].omit.indexOf(Z)>=0)){var K=e[Z];F[Z]=Va[A].shallow.indexOf(Z)>=0?K:lu(K,t)}e instanceof Error&&(F.message=e.message)}if(F.$name)throw new Error("$name property is reserved for worker serialization logic.");return A!=="Object"&&(F.$name=A),F}throw new Error("can't serialize object of type "+typeof e)}function Vs(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||mc(e)||Bl(e)||ArrayBuffer.isView(e)||e instanceof hs)return e;if(Array.isArray(e))return e.map(Vs);if(typeof e=="object"){var t=e.$name||"Object",r=Va[t].klass;if(!r)throw new Error("can't deserialize unregistered class "+t);if(r.deserialize)return r.deserialize(e);for(var f=Object.create(r.prototype),v=0,m=Object.keys(e);v<m.length;v+=1){var x=m[v];if(x!=="$name"){var A=e[x];f[x]=Va[t].shallow.indexOf(x)>=0?A:Vs(A)}}return f}throw new Error("can't deserialize object of type "+typeof e)}var dl=function(){this.first=!0};dl.prototype.update=function(e,t){var r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))};var $r={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function Bc(e){for(var t=0,r=e;t<r.length;t+=1)if(gc(r[t].charCodeAt(0)))return!0;return!1}function gc(e){return!(e!==746&&e!==747&&(e<4352||!($r["Bopomofo Extended"](e)||$r.Bopomofo(e)||$r["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||$r["CJK Compatibility Ideographs"](e)||$r["CJK Compatibility"](e)||$r["CJK Radicals Supplement"](e)||$r["CJK Strokes"](e)||!(!$r["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||$r["CJK Unified Ideographs Extension A"](e)||$r["CJK Unified Ideographs"](e)||$r["Enclosed CJK Letters and Months"](e)||$r["Hangul Compatibility Jamo"](e)||$r["Hangul Jamo Extended-A"](e)||$r["Hangul Jamo Extended-B"](e)||$r["Hangul Jamo"](e)||$r["Hangul Syllables"](e)||$r.Hiragana(e)||$r["Ideographic Description Characters"](e)||$r.Kanbun(e)||$r["Kangxi Radicals"](e)||$r["Katakana Phonetic Extensions"](e)||$r.Katakana(e)&&e!==12540||!(!$r["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!$r["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||$r["Unified Canadian Aboriginal Syllabics"](e)||$r["Unified Canadian Aboriginal Syllabics Extended"](e)||$r["Vertical Forms"](e)||$r["Yijing Hexagram Symbols"](e)||$r["Yi Syllables"](e)||$r["Yi Radicals"](e))))}function Ju(e){return!(gc(e)||function(t){return!!($r["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||$r["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||$r["Letterlike Symbols"](t)||$r["Number Forms"](t)||$r["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||$r["Control Pictures"](t)&&t!==9251||$r["Optical Character Recognition"](t)||$r["Enclosed Alphanumerics"](t)||$r["Geometric Shapes"](t)||$r["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||$r["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||$r["CJK Symbols and Punctuation"](t)||$r.Katakana(t)||$r["Private Use Area"](t)||$r["CJK Compatibility Forms"](t)||$r["Small Form Variants"](t)||$r["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function Js(e){return e>=1424&&e<=2303||$r["Arabic Presentation Forms-A"](e)||$r["Arabic Presentation Forms-B"](e)}function Ms(e,t){return!(!t&&Js(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||$r.Khmer(e))}function Nc(e){for(var t=0,r=e;t<r.length;t+=1)if(Js(r[t].charCodeAt(0)))return!0;return!1}var zc=null,Gs="unavailable",Qu=null,Nl=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(Gs="error"),zc&&zc(e)};function Du(){Zc.fire(new re("pluginStateChange",{pluginStatus:Gs,pluginURL:Qu}))}var Zc=new Se,yc=function(){return Gs},cu=function(){if(Gs!=="deferred"||!Qu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Gs="loading",Du(),Qu&&ia({url:Qu},function(e){e?Nl(e):(Gs="loaded",Du())})},Is={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Gs==="loaded"||Is.applyArabicShaping!=null},isLoading:function(){return Gs==="loading"},setState:function(e){Gs=e.pluginStatus,Qu=e.pluginURL},isParsed:function(){return Is.applyArabicShaping!=null&&Is.processBidirectionalText!=null&&Is.processStyledBidirectionalText!=null},getPluginURL:function(){return Qu}},Bi=function(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new dl,this.transition={})};Bi.prototype.isSupportedScript=function(e){return function(t,r){for(var f=0,v=t;f<v.length;f+=1)if(!Ms(v[f].charCodeAt(0),r))return!1;return!0}(e,Is.isLoaded())},Bi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Bi.prototype.getCrossfadeParameters=function(){var e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}};var Qs=function(e,t){this.property=e,this.value=t,this.expression=function(r,f){if(Pc(r))return new hl(r,f);if(wu(r)){var v=dc(r,f);if(v.result==="error")throw new Error(v.value.map(function(x){return x.key+": "+x.message}).join(", "));return v.value}var m=r;return typeof r=="string"&&f.type==="color"&&(m=Fi.parse(r)),{kind:"constant",evaluate:function(){return m}}}(t===void 0?e.specification.default:t,e.specification)};Qs.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Qs.prototype.possiblyEvaluate=function(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)};var $o=function(e){this.property=e,this.value=new Qs(e,void 0)};$o.prototype.transitioned=function(e,t){return new vl(this.property,this.value,t,Ht({},e.transition,this.transition),e.now)},$o.prototype.untransitioned=function(){return new vl(this.property,this.value,null,{},0)};var Ao=function(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)};Ao.prototype.getValue=function(e){return Ne(this._values[e].value.value)},Ao.prototype.setValue=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new $o(this._values[e].property)),this._values[e].value=new Qs(this._values[e].property,t===null?void 0:Ne(t))},Ao.prototype.getTransition=function(e){return Ne(this._values[e].transition)},Ao.prototype.setTransition=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new $o(this._values[e].property)),this._values[e].transition=Ne(t)||void 0},Ao.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v);var m=this.getTransition(f);m!==void 0&&(e[f+"-transition"]=m)}return e},Ao.prototype.transitioned=function(e,t){for(var r=new qu(this._properties),f=0,v=Object.keys(this._values);f<v.length;f+=1){var m=v[f];r._values[m]=this._values[m].transitioned(e,t._values[m])}return r},Ao.prototype.untransitioned=function(){for(var e=new qu(this._properties),t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t];e._values[f]=this._values[f].untransitioned()}return e};var vl=function(e,t,r,f,v){this.property=e,this.value=t,this.begin=v+f.delay||0,this.end=this.begin+f.duration||0,e.specification.transition&&(f.delay||f.duration)&&(this.prior=r)};vl.prototype.possiblyEvaluate=function(e,t,r){var f=e.now||0,v=this.value.possiblyEvaluate(e,t,r),m=this.prior;if(m){if(f>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(f<this.begin)return m.possiblyEvaluate(e,t,r);var x=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,t,r),v,function(A){if(A<=0)return 0;if(A>=1)return 1;var F=A*A,Z=F*A;return 4*(A<.5?Z:3*(A-F)+Z-.75)}(x))}return v};var qu=function(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)};qu.prototype.possiblyEvaluate=function(e,t,r){for(var f=new zl(this._properties),v=0,m=Object.keys(this._values);v<m.length;v+=1){var x=m[v];f._values[x]=this._values[x].possiblyEvaluate(e,t,r)}return f},qu.prototype.hasTransition=function(){for(var e=0,t=Object.keys(this._values);e<t.length;e+=1)if(this._values[t[e]].prior)return!0;return!1};var fu=function(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)};fu.prototype.getValue=function(e){return Ne(this._values[e].value)},fu.prototype.setValue=function(e,t){this._values[e]=new Qs(this._values[e].property,t===null?void 0:Ne(t))},fu.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v)}return e},fu.prototype.possiblyEvaluate=function(e,t,r){for(var f=new zl(this._properties),v=0,m=Object.keys(this._values);v<m.length;v+=1){var x=m[v];f._values[x]=this._values[x].possiblyEvaluate(e,t,r)}return f};var is=function(e,t,r){this.property=e,this.value=t,this.parameters=r};is.prototype.isConstant=function(){return this.value.kind==="constant"},is.prototype.constantOr=function(e){return this.value.kind==="constant"?this.value.value:e},is.prototype.evaluate=function(e,t,r,f){return this.property.evaluate(this.value,this.parameters,e,t,r,f)};var zl=function(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)};zl.prototype.get=function(e){return this._values[e]};var Un=function(e){this.specification=e};Un.prototype.possiblyEvaluate=function(e,t){return e.expression.evaluate(t)},Un.prototype.interpolate=function(e,t,r){var f=su[this.specification.type];return f?f(e,t,r):e};var On=function(e,t){this.specification=e,this.overrides=t};On.prototype.possiblyEvaluate=function(e,t,r,f){return new is(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},r,f)}:e.expression,t)},On.prototype.interpolate=function(e,t,r){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new is(this,{kind:"constant",value:void 0},e.parameters);var f=su[this.specification.type];return f?new is(this,{kind:"constant",value:f(e.value.value,t.value.value,r)},e.parameters):e},On.prototype.evaluate=function(e,t,r,f,v,m){return e.kind==="constant"?e.value:e.evaluate(t,r,f,v,m)};var Zl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f,v,m){if(r.value===void 0)return new is(this,{kind:"constant",value:void 0},f);if(r.expression.kind==="constant"){var x=r.expression.evaluate(f,null,{},v,m),A=r.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,F=this._calculate(A,A,A,f);return new is(this,{kind:"constant",value:F},f)}if(r.expression.kind==="camera"){var Z=this._calculate(r.expression.evaluate({zoom:f.zoom-1}),r.expression.evaluate({zoom:f.zoom}),r.expression.evaluate({zoom:f.zoom+1}),f);return new is(this,{kind:"constant",value:Z},f)}return new is(this,r.expression,f)},t.prototype.evaluate=function(r,f,v,m,x,A){if(r.kind==="source"){var F=r.evaluate(f,v,m,x,A);return this._calculate(F,F,F,f)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(f.zoom)-1},v,m),r.evaluate({zoom:Math.floor(f.zoom)},v,m),r.evaluate({zoom:Math.floor(f.zoom)+1},v,m),f):r.value},t.prototype._calculate=function(r,f,v,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:r,to:f}:{from:v,to:f}},t.prototype.interpolate=function(r){return r},t}(On),ps=function(e){this.specification=e};ps.prototype.possiblyEvaluate=function(e,t,r,f){if(e.value!==void 0){if(e.expression.kind==="constant"){var v=e.expression.evaluate(t,null,{},r,f);return this._calculate(v,v,v,t)}return this._calculate(e.expression.evaluate(new Bi(Math.floor(t.zoom-1),t)),e.expression.evaluate(new Bi(Math.floor(t.zoom),t)),e.expression.evaluate(new Bi(Math.floor(t.zoom+1),t)),t)}},ps.prototype._calculate=function(e,t,r,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}},ps.prototype.interpolate=function(e){return e};var Do=function(e){this.specification=e};Do.prototype.possiblyEvaluate=function(e,t,r,f){return!!e.expression.evaluate(t,null,{},r,f)},Do.prototype.interpolate=function(){return!1};var zo=function(e){for(var t in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){var r=e[t];r.specification.overridable&&this.overridableProperties.push(t);var f=this.defaultPropertyValues[t]=new Qs(r,void 0),v=this.defaultTransitionablePropertyValues[t]=new $o(r);this.defaultTransitioningPropertyValues[t]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=f.possiblyEvaluate({})}};wn("DataDrivenProperty",On),wn("DataConstantProperty",Un),wn("CrossFadedDataDrivenProperty",Zl),wn("CrossFadedProperty",ps),wn("ColorRampProperty",Do);var ku=function(e){function t(r,f){if(e.call(this),this.id=r.id,this.type=r.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},r.type!=="custom"&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),f.layout&&(this._unevaluatedLayout=new fu(f.layout)),f.paint)){for(var v in this._transitionablePaint=new Ao(f.paint),r.paint)this.setPaintProperty(v,r.paint[v],{validate:!1});for(var m in r.layout)this.setLayoutProperty(m,r.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new zl(f.paint)}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},t.prototype.getLayoutProperty=function(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)},t.prototype.setLayoutProperty=function(r,f,v){v===void 0&&(v={}),f!=null&&this._validate(ac,"layers."+this.id+".layout."+r,r,f,v)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,f):this.visibility=f)},t.prototype.getPaintProperty=function(r){return er(r,"-transition")?this._transitionablePaint.getTransition(r.slice(0,-"-transition".length)):this._transitionablePaint.getValue(r)},t.prototype.setPaintProperty=function(r,f,v){if(v===void 0&&(v={}),f!=null&&this._validate(Lf,"layers."+this.id+".paint."+r,r,f,v))return!1;if(er(r,"-transition"))return this._transitionablePaint.setTransition(r.slice(0,-"-transition".length),f||void 0),!1;var m=this._transitionablePaint._values[r],x=m.property.specification["property-type"]==="cross-faded-data-driven",A=m.value.isDataDriven(),F=m.value;this._transitionablePaint.setValue(r,f),this._handleSpecialPaintPropertyUpdate(r);var Z=this._transitionablePaint._values[r].value;return Z.isDataDriven()||A||x||this._handleOverridablePaintPropertyUpdate(r,F,Z)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!1},t.prototype.isHidden=function(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"},t.prototype.updateTransitions=function(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)},t.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},t.prototype.recalculate=function(r,f){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,f)},t.prototype.serialize=function(){var r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),tt(r,function(f,v){return!(f===void 0||v==="layout"&&!Object.keys(f).length||v==="paint"&&!Object.keys(f).length)})},t.prototype._validate=function(r,f,v,m,x){return x===void 0&&(x={}),(!x||x.validate!==!1)&&$u(this,r.call(ic,{key:f,layerType:this.type,objectKey:v,value:m,styleSpec:te,style:{glyphs:!0,sprite:!0}}))},t.prototype.is3D=function(){return!1},t.prototype.isTileClipped=function(){return!1},t.prototype.hasOffscreenPass=function(){return!1},t.prototype.resize=function(){},t.prototype.isStateDependent=function(){for(var r in this.paint._values){var f=this.paint.get(r);if(f instanceof is&&Eu(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1},t}(Se),hu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Ul=function(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ra=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function po(e,t){t===void 0&&(t=1);var r=0,f=0;return{members:e.map(function(v){var m=hu[v.type].BYTES_PER_ELEMENT,x=r=Uc(r,Math.max(t,m)),A=v.components||1;return f=Math.max(f,m),r+=m*A,{name:v.name,type:v.type,components:A,offset:x}}),size:Uc(r,Math.max(f,t)),alignment:t}}function Uc(e,t){return Math.ceil(e/t)*t}ra.serialize=function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},ra.deserialize=function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t},ra.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ra.prototype.clear=function(){this.length=0},ra.prototype.resize=function(e){this.reserve(e),this.length=e},ra.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}},ra.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Fu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var m=2*r;return this.int16[m+0]=f,this.int16[m+1]=v,r},t}(ra);Fu.prototype.bytesPerElement=4,wn("StructArrayLayout2i4",Fu);var _c=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,m)},t.prototype.emplace=function(r,f,v,m,x){var A=4*r;return this.int16[A+0]=f,this.int16[A+1]=v,this.int16[A+2]=m,this.int16[A+3]=x,r},t}(ra);_c.prototype.bytesPerElement=8,wn("StructArrayLayout4i8",_c);var Bu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x,A){var F=this.length;return this.resize(F+1),this.emplace(F,r,f,v,m,x,A)},t.prototype.emplace=function(r,f,v,m,x,A,F){var Z=6*r;return this.int16[Z+0]=f,this.int16[Z+1]=v,this.int16[Z+2]=m,this.int16[Z+3]=x,this.int16[Z+4]=A,this.int16[Z+5]=F,r},t}(ra);Bu.prototype.bytesPerElement=12,wn("StructArrayLayout2i4i12",Bu);var Os=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x,A){var F=this.length;return this.resize(F+1),this.emplace(F,r,f,v,m,x,A)},t.prototype.emplace=function(r,f,v,m,x,A,F){var Z=4*r,K=8*r;return this.int16[Z+0]=f,this.int16[Z+1]=v,this.uint8[K+4]=m,this.uint8[K+5]=x,this.uint8[K+6]=A,this.uint8[K+7]=F,r},t}(ra);Os.prototype.bytesPerElement=8,wn("StructArrayLayout2i4ub8",Os);var oc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var m=2*r;return this.float32[m+0]=f,this.float32[m+1]=v,r},t}(ra);oc.prototype.bytesPerElement=8,wn("StructArrayLayout2f8",oc);var as=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x,A,F,Z,K,q){var ue=this.length;return this.resize(ue+1),this.emplace(ue,r,f,v,m,x,A,F,Z,K,q)},t.prototype.emplace=function(r,f,v,m,x,A,F,Z,K,q,ue){var de=10*r;return this.uint16[de+0]=f,this.uint16[de+1]=v,this.uint16[de+2]=m,this.uint16[de+3]=x,this.uint16[de+4]=A,this.uint16[de+5]=F,this.uint16[de+6]=Z,this.uint16[de+7]=K,this.uint16[de+8]=q,this.uint16[de+9]=ue,r},t}(ra);as.prototype.bytesPerElement=20,wn("StructArrayLayout10ui20",as);var xc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x,A,F,Z,K,q,ue,de){var Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,r,f,v,m,x,A,F,Z,K,q,ue,de)},t.prototype.emplace=function(r,f,v,m,x,A,F,Z,K,q,ue,de,Ge){var Ye=12*r;return this.int16[Ye+0]=f,this.int16[Ye+1]=v,this.int16[Ye+2]=m,this.int16[Ye+3]=x,this.uint16[Ye+4]=A,this.uint16[Ye+5]=F,this.uint16[Ye+6]=Z,this.uint16[Ye+7]=K,this.int16[Ye+8]=q,this.int16[Ye+9]=ue,this.int16[Ye+10]=de,this.int16[Ye+11]=Ge,r},t}(ra);xc.prototype.bytesPerElement=24,wn("StructArrayLayout4i4ui4i24",xc);var jl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,f,v)},t.prototype.emplace=function(r,f,v,m){var x=3*r;return this.float32[x+0]=f,this.float32[x+1]=v,this.float32[x+2]=m,r},t}(ra);jl.prototype.bytesPerElement=12,wn("StructArrayLayout3f12",jl);var sc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint32[1*r+0]=f,r},t}(ra);sc.prototype.bytesPerElement=4,wn("StructArrayLayout1ul4",sc);var jc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x,A,F,Z,K){var q=this.length;return this.resize(q+1),this.emplace(q,r,f,v,m,x,A,F,Z,K)},t.prototype.emplace=function(r,f,v,m,x,A,F,Z,K,q){var ue=10*r,de=5*r;return this.int16[ue+0]=f,this.int16[ue+1]=v,this.int16[ue+2]=m,this.int16[ue+3]=x,this.int16[ue+4]=A,this.int16[ue+5]=F,this.uint32[de+3]=Z,this.uint16[ue+8]=K,this.uint16[ue+9]=q,r},t}(ra);jc.prototype.bytesPerElement=20,wn("StructArrayLayout6i1ul2ui20",jc);var uc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x,A){var F=this.length;return this.resize(F+1),this.emplace(F,r,f,v,m,x,A)},t.prototype.emplace=function(r,f,v,m,x,A,F){var Z=6*r;return this.int16[Z+0]=f,this.int16[Z+1]=v,this.int16[Z+2]=m,this.int16[Z+3]=x,this.int16[Z+4]=A,this.int16[Z+5]=F,r},t}(ra);uc.prototype.bytesPerElement=12,wn("StructArrayLayout2i2i2i12",uc);var ml=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x){var A=this.length;return this.resize(A+1),this.emplace(A,r,f,v,m,x)},t.prototype.emplace=function(r,f,v,m,x,A){var F=4*r,Z=8*r;return this.float32[F+0]=f,this.float32[F+1]=v,this.float32[F+2]=m,this.int16[Z+6]=x,this.int16[Z+7]=A,r},t}(ra);ml.prototype.bytesPerElement=16,wn("StructArrayLayout2f1f2i16",ml);var Vc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,m)},t.prototype.emplace=function(r,f,v,m,x){var A=12*r,F=3*r;return this.uint8[A+0]=f,this.uint8[A+1]=v,this.float32[F+1]=m,this.float32[F+2]=x,r},t}(ra);Vc.prototype.bytesPerElement=12,wn("StructArrayLayout2ub2f12",Vc);var gl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,f,v)},t.prototype.emplace=function(r,f,v,m){var x=3*r;return this.uint16[x+0]=f,this.uint16[x+1]=v,this.uint16[x+2]=m,r},t}(ra);gl.prototype.bytesPerElement=6,wn("StructArrayLayout3ui6",gl);var yl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x,A,F,Z,K,q,ue,de,Ge,Ye,ct,rt,It){var Wt=this.length;return this.resize(Wt+1),this.emplace(Wt,r,f,v,m,x,A,F,Z,K,q,ue,de,Ge,Ye,ct,rt,It)},t.prototype.emplace=function(r,f,v,m,x,A,F,Z,K,q,ue,de,Ge,Ye,ct,rt,It,Wt){var ir=24*r,dr=12*r,Mr=48*r;return this.int16[ir+0]=f,this.int16[ir+1]=v,this.uint16[ir+2]=m,this.uint16[ir+3]=x,this.uint32[dr+2]=A,this.uint32[dr+3]=F,this.uint32[dr+4]=Z,this.uint16[ir+10]=K,this.uint16[ir+11]=q,this.uint16[ir+12]=ue,this.float32[dr+7]=de,this.float32[dr+8]=Ge,this.uint8[Mr+36]=Ye,this.uint8[Mr+37]=ct,this.uint8[Mr+38]=rt,this.uint32[dr+10]=It,this.int16[ir+22]=Wt,r},t}(ra);yl.prototype.bytesPerElement=48,wn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",yl);var _l=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m,x,A,F,Z,K,q,ue,de,Ge,Ye,ct,rt,It,Wt,ir,dr,Mr,en,dn,Hn,En,ei,Tn,Vi){var mi=this.length;return this.resize(mi+1),this.emplace(mi,r,f,v,m,x,A,F,Z,K,q,ue,de,Ge,Ye,ct,rt,It,Wt,ir,dr,Mr,en,dn,Hn,En,ei,Tn,Vi)},t.prototype.emplace=function(r,f,v,m,x,A,F,Z,K,q,ue,de,Ge,Ye,ct,rt,It,Wt,ir,dr,Mr,en,dn,Hn,En,ei,Tn,Vi,mi){var Bn=34*r,ta=17*r;return this.int16[Bn+0]=f,this.int16[Bn+1]=v,this.int16[Bn+2]=m,this.int16[Bn+3]=x,this.int16[Bn+4]=A,this.int16[Bn+5]=F,this.int16[Bn+6]=Z,this.int16[Bn+7]=K,this.uint16[Bn+8]=q,this.uint16[Bn+9]=ue,this.uint16[Bn+10]=de,this.uint16[Bn+11]=Ge,this.uint16[Bn+12]=Ye,this.uint16[Bn+13]=ct,this.uint16[Bn+14]=rt,this.uint16[Bn+15]=It,this.uint16[Bn+16]=Wt,this.uint16[Bn+17]=ir,this.uint16[Bn+18]=dr,this.uint16[Bn+19]=Mr,this.uint16[Bn+20]=en,this.uint16[Bn+21]=dn,this.uint16[Bn+22]=Hn,this.uint32[ta+12]=En,this.float32[ta+13]=ei,this.float32[ta+14]=Tn,this.float32[ta+15]=Vi,this.float32[ta+16]=mi,r},t}(ra);_l.prototype.bytesPerElement=68,wn("StructArrayLayout8i15ui1ul4f68",_l);var pu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.float32[1*r+0]=f,r},t}(ra);pu.prototype.bytesPerElement=4,wn("StructArrayLayout1f4",pu);var qs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,f,v)},t.prototype.emplace=function(r,f,v,m){var x=3*r;return this.int16[x+0]=f,this.int16[x+1]=v,this.int16[x+2]=m,r},t}(ra);qs.prototype.bytesPerElement=6,wn("StructArrayLayout3i6",qs);var Gc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var m=this.length;return this.resize(m+1),this.emplace(m,r,f,v)},t.prototype.emplace=function(r,f,v,m){var x=4*r;return this.uint32[2*r+0]=f,this.uint16[x+2]=v,this.uint16[x+3]=m,r},t}(ra);Gc.prototype.bytesPerElement=8,wn("StructArrayLayout1ul2ui8",Gc);var bc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var m=2*r;return this.uint16[m+0]=f,this.uint16[m+1]=v,r},t}(ra);bc.prototype.bytesPerElement=4,wn("StructArrayLayout2ui4",bc);var sf=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint16[1*r+0]=f,r},t}(ra);sf.prototype.bytesPerElement=2,wn("StructArrayLayout1ui2",sf);var Sc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,m){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,m)},t.prototype.emplace=function(r,f,v,m,x){var A=4*r;return this.float32[A+0]=f,this.float32[A+1]=v,this.float32[A+2]=m,this.float32[A+3]=x,r},t}(ra);Sc.prototype.bytesPerElement=16,wn("StructArrayLayout4f16",Sc);var i=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.anchorPoint.get=function(){return new $(this.anchorPointX,this.anchorPointY)},Object.defineProperties(t.prototype,r),t}(Ul);i.prototype.size=20;var u=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new i(this,r)},t}(jc);wn("CollisionBoxArray",u);var a=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(f){this._structArray.uint8[this._pos1+37]=f},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(f){this._structArray.uint8[this._pos1+38]=f},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+10]=f},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(t.prototype,r),t}(Ul);a.prototype.size=48;var h=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new a(this,r)},t}(yl);wn("PlacedSymbolArray",h);var g=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+12]=f},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},r.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(t.prototype,r),t}(Ul);g.prototype.size=68;var S=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new g(this,r)},t}(_l);wn("SymbolInstanceArray",S);var T=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getoffsetX=function(r){return this.float32[1*r+0]},t}(pu);wn("GlyphOffsetArray",T);var R=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getx=function(r){return this.int16[3*r+0]},t.prototype.gety=function(r){return this.int16[3*r+1]},t.prototype.gettileUnitDistanceFromAnchor=function(r){return this.int16[3*r+2]},t}(qs);wn("SymbolLineVertexArray",R);var G=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(t.prototype,r),t}(Ul);G.prototype.size=8;var ee=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new G(this,r)},t}(Gc);wn("FeatureIndexArray",ee);var ve=po([{name:"a_pos",components:2,type:"Int16"}],4).members,ye=function(e){e===void 0&&(e=[]),this.segments=e};function we(e,t){return 256*(e=$e(Math.floor(e),0,255))+$e(Math.floor(t),0,255)}ye.prototype.prepareSegment=function(e,t,r,f){var v=this.segments[this.segments.length-1];return e>ye.MAX_VERTEX_ARRAY_LENGTH&&Ie("Max vertices per segment is "+ye.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!v||v.vertexLength+e>ye.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==f)&&(v={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},f!==void 0&&(v.sortKey=f),this.segments.push(v)),v},ye.prototype.get=function(){return this.segments},ye.prototype.destroy=function(){for(var e=0,t=this.segments;e<t.length;e+=1){var r=t[e];for(var f in r.vaos)r.vaos[f].destroy()}},ye.simpleSegment=function(e,t,r,f){return new ye([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:f,vaos:{},sortKey:0}])},ye.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,wn("SegmentVector",ye);var Ke=po([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),He=b(function(e){e.exports=function(t,r){var f,v,m,x,A,F,Z,K;for(v=t.length-(f=3&t.length),m=r,A=3432918353,F=461845907,K=0;K<v;)Z=255&t.charCodeAt(K)|(255&t.charCodeAt(++K))<<8|(255&t.charCodeAt(++K))<<16|(255&t.charCodeAt(++K))<<24,++K,m=27492+(65535&(x=5*(65535&(m=(m^=Z=(65535&(Z=(Z=(65535&Z)*A+(((Z>>>16)*A&65535)<<16)&4294967295)<<15|Z>>>17))*F+(((Z>>>16)*F&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(Z=0,f){case 3:Z^=(255&t.charCodeAt(K+2))<<16;case 2:Z^=(255&t.charCodeAt(K+1))<<8;case 1:m^=Z=(65535&(Z=(Z=(65535&(Z^=255&t.charCodeAt(K)))*A+(((Z>>>16)*A&65535)<<16)&4294967295)<<15|Z>>>17))*F+(((Z>>>16)*F&65535)<<16)&4294967295}return m^=t.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}}),at=b(function(e){e.exports=function(t,r){for(var f,v=t.length,m=r^v,x=0;v>=4;)f=1540483477*(65535&(f=255&t.charCodeAt(x)|(255&t.charCodeAt(++x))<<8|(255&t.charCodeAt(++x))<<16|(255&t.charCodeAt(++x))<<24))+((1540483477*(f>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),v-=4,++x;switch(v){case 3:m^=(255&t.charCodeAt(x+2))<<16;case 2:m^=(255&t.charCodeAt(x+1))<<8;case 1:m=1540483477*(65535&(m^=255&t.charCodeAt(x)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}}),ze=He,it=at;ze.murmur3=He,ze.murmur2=it;var mt=function(){this.ids=[],this.positions=[],this.indexed=!1};mt.prototype.add=function(e,t,r,f){this.ids.push(sr(e)),this.positions.push(t,r,f)},mt.prototype.getPositions=function(e){for(var t=sr(e),r=0,f=this.ids.length-1;r<f;){var v=r+f>>1;this.ids[v]>=t?f=v:r=v+1}for(var m=[];this.ids[r]===t;)m.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return m},mt.serialize=function(e,t){var r=new Float64Array(e.ids),f=new Uint32Array(e.positions);return function v(m,x,A,F){for(;A<F;){for(var Z=m[A+F>>1],K=A-1,q=F+1;;){do K++;while(m[K]<Z);do q--;while(m[q]>Z);if(K>=q)break;nr(m,K,q),nr(x,3*K,3*q),nr(x,3*K+1,3*q+1),nr(x,3*K+2,3*q+2)}q-A<F-q?(v(m,x,A,q),A=q+1):(v(m,x,q+1,F),F=q)}}(r,f,0,r.length-1),t&&t.push(r.buffer,f.buffer),{ids:r,positions:f}},mt.deserialize=function(e){var t=new mt;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t};var Ut=Math.pow(2,53)-1;function sr(e){var t=+e;return!isNaN(t)&&t<=Ut?t:ze(String(e))}function nr(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}wn("FeaturePositionMap",mt);var cr=function(e,t){this.gl=e.gl,this.location=t},Rr=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))},t}(cr),tn=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))},t}(cr),Xr=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))},t}(cr),yn=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))},t}(cr),Fn=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))},t}(cr),Vn=function(e){function t(r,f){e.call(this,r,f),this.current=Fi.transparent}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))},t}(cr),jn=new Float32Array(16),Qi=function(e){function t(r,f){e.call(this,r,f),this.current=jn}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(var f=1;f<16;f++)if(r[f]!==this.current[f]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}},t}(cr);function _n(e){return[we(255*e.r,255*e.g),we(255*e.b,255*e.a)]}var ci=function(e,t,r){this.value=e,this.uniformNames=t.map(function(f){return"u_"+f}),this.type=r};ci.prototype.setUniform=function(e,t,r){e.set(r.constantOr(this.value))},ci.prototype.getBinding=function(e,t,r){return this.type==="color"?new Vn(e,t):new tn(e,t)};var Ci=function(e,t){this.uniformNames=t.map(function(r){return"u_"+r}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Ci.prototype.setConstantPatternPositions=function(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr},Ci.prototype.setUniform=function(e,t,r,f){var v=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&e.set(v)},Ci.prototype.getBinding=function(e,t,r){return r.substr(0,9)==="u_pattern"?new Fn(e,t):new tn(e,t)};var fi=function(e,t,r,f){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(function(v){return{name:"a_"+v,type:"Float32",components:r==="color"?2:1,offset:0}}),this.paintVertexArray=new f};fi.prototype.populatePaintArray=function(e,t,r,f,v){var m=this.paintVertexArray.length,x=this.expression.evaluate(new Bi(0),t,{},f,[],v);this.paintVertexArray.resize(e),this._setPaintValue(m,e,x)},fi.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:0},r,f);this._setPaintValue(e,t,v)},fi.prototype._setPaintValue=function(e,t,r){if(this.type==="color")for(var f=_n(r),v=e;v<t;v++)this.paintVertexArray.emplace(v,f[0],f[1]);else{for(var m=e;m<t;m++)this.paintVertexArray.emplace(m,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}},fi.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},fi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var oi=function(e,t,r,f,v,m){this.expression=e,this.uniformNames=t.map(function(x){return"u_"+x+"_t"}),this.type=r,this.useIntegerZoom=f,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=t.map(function(x){return{name:"a_"+x,type:"Float32",components:r==="color"?4:2,offset:0}}),this.paintVertexArray=new m};oi.prototype.populatePaintArray=function(e,t,r,f,v){var m=this.expression.evaluate(new Bi(this.zoom),t,{},f,[],v),x=this.expression.evaluate(new Bi(this.zoom+1),t,{},f,[],v),A=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(A,e,m,x)},oi.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:this.zoom},r,f),m=this.expression.evaluate({zoom:this.zoom+1},r,f);this._setPaintValue(e,t,v,m)},oi.prototype._setPaintValue=function(e,t,r,f){if(this.type==="color")for(var v=_n(r),m=_n(f),x=e;x<t;x++)this.paintVertexArray.emplace(x,v[0],v[1],m[0],m[1]);else{for(var A=e;A<t;A++)this.paintVertexArray.emplace(A,r,f);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(f))}},oi.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},oi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},oi.prototype.setUniform=function(e,t){var r=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,f=$e(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);e.set(f)},oi.prototype.getBinding=function(e,t,r){return new tn(e,t)};var Ti=function(e,t,r,f,v,m){this.expression=e,this.type=t,this.useIntegerZoom=r,this.zoom=f,this.layerId=m,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v};Ti.prototype.populatePaintArray=function(e,t,r){var f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(f,e,t.patterns&&t.patterns[this.layerId],r)},Ti.prototype.updatePaintArray=function(e,t,r,f,v){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],v)},Ti.prototype._setPaintValues=function(e,t,r,f){if(f&&r){var v=f[r.min],m=f[r.mid],x=f[r.max];if(v&&m&&x)for(var A=e;A<t;A++)this.zoomInPaintVertexArray.emplace(A,m.tl[0],m.tl[1],m.br[0],m.br[1],v.tl[0],v.tl[1],v.br[0],v.br[1],m.pixelRatio,v.pixelRatio),this.zoomOutPaintVertexArray.emplace(A,m.tl[0],m.tl[1],m.br[0],m.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],m.pixelRatio,x.pixelRatio)}},Ti.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Ke.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Ke.members,this.expression.isStateDependent))},Ti.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var ii=function(e,t,r){this.binders={},this._buffers=[];var f=[];for(var v in e.paint._values)if(r(v)){var m=e.paint.get(v);if(m instanceof is&&Eu(m.property.specification)){var x=Po(v,e.type),A=m.value,F=m.property.specification.type,Z=m.property.useIntegerZoom,K=m.property.specification["property-type"],q=K==="cross-faded"||K==="cross-faded-data-driven";if(A.kind==="constant")this.binders[v]=q?new Ci(A.value,x):new ci(A.value,x,F),f.push("/u_"+v);else if(A.kind==="source"||q){var ue=Ja(v,F,"source");this.binders[v]=q?new Ti(A,F,Z,t,ue,e.id):new fi(A,x,F,ue),f.push("/a_"+v)}else{var de=Ja(v,F,"composite");this.binders[v]=new oi(A,x,F,Z,t,de),f.push("/z_"+v)}}}this.cacheKey=f.sort().join("")};ii.prototype.getMaxValue=function(e){var t=this.binders[e];return t instanceof fi||t instanceof oi?t.maxValue:0},ii.prototype.populatePaintArrays=function(e,t,r,f,v){for(var m in this.binders){var x=this.binders[m];(x instanceof fi||x instanceof oi||x instanceof Ti)&&x.populatePaintArray(e,t,r,f,v)}},ii.prototype.setConstantPatternPositions=function(e,t){for(var r in this.binders){var f=this.binders[r];f instanceof Ci&&f.setConstantPatternPositions(e,t)}},ii.prototype.updatePaintArrays=function(e,t,r,f,v){var m=!1;for(var x in e)for(var A=0,F=t.getPositions(x);A<F.length;A+=1){var Z=F[A],K=r.feature(Z.index);for(var q in this.binders){var ue=this.binders[q];if((ue instanceof fi||ue instanceof oi||ue instanceof Ti)&&ue.expression.isStateDependent===!0){var de=f.paint.get(q);ue.expression=de.value,ue.updatePaintArray(Z.start,Z.end,K,e[x],v),m=!0}}}return m},ii.prototype.defines=function(){var e=[];for(var t in this.binders){var r=this.binders[t];(r instanceof ci||r instanceof Ci)&&e.push.apply(e,r.uniformNames.map(function(f){return"#define HAS_UNIFORM_"+f}))}return e},ii.prototype.getBinderAttributes=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof fi||r instanceof oi)for(var f=0;f<r.paintVertexAttributes.length;f++)e.push(r.paintVertexAttributes[f].name);else if(r instanceof Ti)for(var v=0;v<Ke.members.length;v++)e.push(Ke.members[v].name)}return e},ii.prototype.getBinderUniforms=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof ci||r instanceof Ci||r instanceof oi)for(var f=0,v=r.uniformNames;f<v.length;f+=1)e.push(v[f])}return e},ii.prototype.getPaintVertexBuffers=function(){return this._buffers},ii.prototype.getUniforms=function(e,t){var r=[];for(var f in this.binders){var v=this.binders[f];if(v instanceof ci||v instanceof Ci||v instanceof oi)for(var m=0,x=v.uniformNames;m<x.length;m+=1){var A=x[m];if(t[A]){var F=v.getBinding(e,t[A],A);r.push({name:A,property:f,binding:F})}}}return r},ii.prototype.setUniforms=function(e,t,r,f){for(var v=0,m=t;v<m.length;v+=1){var x=m[v],A=x.name,F=x.property;this.binders[F].setUniform(x.binding,f,r.get(F),A)}},ii.prototype.updatePaintBuffers=function(e){for(var t in this._buffers=[],this.binders){var r=this.binders[t];if(e&&r instanceof Ti){var f=e.fromScale===2?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(r instanceof fi||r instanceof oi)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}},ii.prototype.upload=function(e){for(var t in this.binders){var r=this.binders[t];(r instanceof fi||r instanceof oi||r instanceof Ti)&&r.upload(e)}this.updatePaintBuffers()},ii.prototype.destroy=function(){for(var e in this.binders){var t=this.binders[e];(t instanceof fi||t instanceof oi||t instanceof Ti)&&t.destroy()}};var ri=function(e,t,r){r===void 0&&(r=function(){return!0}),this.programConfigurations={};for(var f=0,v=e;f<v.length;f+=1){var m=v[f];this.programConfigurations[m.id]=new ii(m,t,r)}this.needsUpload=!1,this._featureMap=new mt,this._bufferOffset=0};function Po(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(t+"-","").replace(/-/g,"_")]}function Ja(e,t,r){var f={color:{source:oc,composite:Sc},number:{source:pu,composite:oc}},v=function(m){return{"line-pattern":{source:as,composite:as},"fill-pattern":{source:as,composite:as},"fill-extrusion-pattern":{source:as,composite:as}}[m]}(e);return v&&v[r]||f[t][r]}ri.prototype.populatePaintArrays=function(e,t,r,f,v,m){for(var x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,t,f,v,m);t.id!==void 0&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},ri.prototype.updatePaintArrays=function(e,t,r,f){for(var v=0,m=r;v<m.length;v+=1){var x=m[v];this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(e,this._featureMap,t,x,f)||this.needsUpload}},ri.prototype.get=function(e){return this.programConfigurations[e]},ri.prototype.upload=function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}},ri.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},wn("ConstantBinder",ci),wn("CrossFadedConstantBinder",Ci),wn("SourceExpressionBinder",fi),wn("CrossFadedCompositeBinder",Ti),wn("CompositeExpressionBinder",oi),wn("ProgramConfiguration",ii,{omit:["_buffers"]}),wn("ProgramConfigurationSet",ri);var os=Math.pow(2,14)-1,Zo=-os-1;function Ga(e){for(var t=8192/e.extent,r=e.loadGeometry(),f=0;f<r.length;f++)for(var v=r[f],m=0;m<v.length;m++){var x=v[m],A=Math.round(x.x*t),F=Math.round(x.y*t);x.x=$e(A,Zo,os),x.y=$e(F,Zo,os),(A<x.x||A>x.x+1||F<x.y||F>x.y+1)&&Ie("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function no(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Ga(e):[]}}function ds(e,t,r,f,v){e.emplaceBack(2*t+(f+1)/2,2*r+(v+1)/2)}var vs=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Fu,this.indexArray=new gl,this.segments=new ye,this.programConfigurations=new ri(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function el(e,t){for(var r=0;r<e.length;r++)if(Tu(t,e[r]))return!0;for(var f=0;f<t.length;f++)if(Tu(e,t[f]))return!0;return!!xl(e,t)}function ms(e,t,r){return!!Tu(e,t)||!!Nu(t,e,r)}function eu(e,t){if(e.length===1)return Vl(t,e[0]);for(var r=0;r<t.length;r++)for(var f=t[r],v=0;v<f.length;v++)if(Tu(e,f[v]))return!0;for(var m=0;m<e.length;m++)if(Vl(t,e[m]))return!0;for(var x=0;x<t.length;x++)if(xl(e,t[x]))return!0;return!1}function Ls(e,t,r){if(e.length>1){if(xl(e,t))return!0;for(var f=0;f<t.length;f++)if(Nu(t[f],e,r))return!0}for(var v=0;v<e.length;v++)if(Nu(e[v],t,r))return!0;return!1}function xl(e,t){if(e.length===0||t.length===0)return!1;for(var r=0;r<e.length-1;r++)for(var f=e[r],v=e[r+1],m=0;m<t.length-1;m++)if(bl(f,v,t[m],t[m+1]))return!0;return!1}function bl(e,t,r,f){return Ae(e,r,f)!==Ae(t,r,f)&&Ae(e,t,r)!==Ae(e,t,f)}function Nu(e,t,r){var f=r*r;if(t.length===1)return e.distSqr(t[0])<f;for(var v=1;v<t.length;v++)if(tu(e,t[v-1],t[v])<f)return!0;return!1}function tu(e,t,r){var f=t.distSqr(r);if(f===0)return e.distSqr(t);var v=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/f;return e.distSqr(v<0?t:v>1?r:r.sub(t)._mult(v)._add(t))}function Vl(e,t){for(var r,f,v,m=!1,x=0;x<e.length;x++)for(var A=0,F=(r=e[x]).length-1;A<r.length;F=A++)(f=r[A]).y>t.y!=(v=r[F]).y>t.y&&t.x<(v.x-f.x)*(t.y-f.y)/(v.y-f.y)+f.x&&(m=!m);return m}function Tu(e,t){for(var r=!1,f=0,v=e.length-1;f<e.length;v=f++){var m=e[f],x=e[v];m.y>t.y!=x.y>t.y&&t.x<(x.x-m.x)*(t.y-m.y)/(x.y-m.y)+m.x&&(r=!r)}return r}function zu(e,t,r){var f=r[0],v=r[2];if(e.x<f.x&&t.x<f.x||e.x>v.x&&t.x>v.x||e.y<f.y&&t.y<f.y||e.y>v.y&&t.y>v.y)return!1;var m=Ae(e,t,r[0]);return m!==Ae(e,t,r[1])||m!==Ae(e,t,r[2])||m!==Ae(e,t,r[3])}function Hs(e,t,r){var f=t.paint.get(e).value;return f.kind==="constant"?f.value:r.programConfigurations.get(t.id).getMaxValue(e)}function io(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Au(e,t,r,f,v){if(!t[0]&&!t[1])return e;var m=$.convert(t)._mult(v);r==="viewport"&&m._rotate(-f);for(var x=[],A=0;A<e.length;A++)x.push(e[A].sub(m));return x}vs.prototype.populate=function(e,t,r){var f=this.layers[0],v=[],m=null;f.type==="circle"&&(m=f.layout.get("circle-sort-key"));for(var x=0,A=e;x<A.length;x+=1){var F=A[x],Z=F.feature,K=F.id,q=F.index,ue=F.sourceLayerIndex,de=this.layers[0]._featureFilter.needGeometry,Ge=no(Z,de);if(this.layers[0]._featureFilter.filter(new Bi(this.zoom),Ge,r)){var Ye=m?m.evaluate(Ge,{},r):void 0,ct={id:K,properties:Z.properties,type:Z.type,sourceLayerIndex:ue,index:q,geometry:de?Ge.geometry:Ga(Z),patterns:{},sortKey:Ye};v.push(ct)}}m&&v.sort(function(dn,Hn){return dn.sortKey-Hn.sortKey});for(var rt=0,It=v;rt<It.length;rt+=1){var Wt=It[rt],ir=Wt.geometry,dr=Wt.index,Mr=Wt.sourceLayerIndex,en=e[dr].feature;this.addFeature(Wt,ir,dr,r),t.featureIndex.insert(en,ir,dr,Mr,this.index)}},vs.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},vs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},vs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},vs.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ve),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},vs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},vs.prototype.addFeature=function(e,t,r,f){for(var v=0,m=t;v<m.length;v+=1)for(var x=0,A=m[v];x<A.length;x+=1){var F=A[x],Z=F.x,K=F.y;if(!(Z<0||Z>=8192||K<0||K>=8192)){var q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),ue=q.vertexLength;ds(this.layoutVertexArray,Z,K,-1,-1),ds(this.layoutVertexArray,Z,K,1,-1),ds(this.layoutVertexArray,Z,K,1,1),ds(this.layoutVertexArray,Z,K,-1,1),this.indexArray.emplaceBack(ue,ue+1,ue+2),this.indexArray.emplaceBack(ue,ue+3,ue+2),q.vertexLength+=4,q.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},f)},wn("CircleBucket",vs,{omit:["layers"]});var du=new zo({"circle-sort-key":new On(te.layout_circle["circle-sort-key"])}),gs={paint:new zo({"circle-radius":new On(te.paint_circle["circle-radius"]),"circle-color":new On(te.paint_circle["circle-color"]),"circle-blur":new On(te.paint_circle["circle-blur"]),"circle-opacity":new On(te.paint_circle["circle-opacity"]),"circle-translate":new Un(te.paint_circle["circle-translate"]),"circle-translate-anchor":new Un(te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Un(te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Un(te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new On(te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new On(te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new On(te.paint_circle["circle-stroke-opacity"])}),layout:du},qi=typeof Float32Array!="undefined"?Float32Array:Array;function ao(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ko(e,t,r){var f=t[0],v=t[1],m=t[2],x=t[3],A=t[4],F=t[5],Z=t[6],K=t[7],q=t[8],ue=t[9],de=t[10],Ge=t[11],Ye=t[12],ct=t[13],rt=t[14],It=t[15],Wt=r[0],ir=r[1],dr=r[2],Mr=r[3];return e[0]=Wt*f+ir*A+dr*q+Mr*Ye,e[1]=Wt*v+ir*F+dr*ue+Mr*ct,e[2]=Wt*m+ir*Z+dr*de+Mr*rt,e[3]=Wt*x+ir*K+dr*Ge+Mr*It,e[4]=(Wt=r[4])*f+(ir=r[5])*A+(dr=r[6])*q+(Mr=r[7])*Ye,e[5]=Wt*v+ir*F+dr*ue+Mr*ct,e[6]=Wt*m+ir*Z+dr*de+Mr*rt,e[7]=Wt*x+ir*K+dr*Ge+Mr*It,e[8]=(Wt=r[8])*f+(ir=r[9])*A+(dr=r[10])*q+(Mr=r[11])*Ye,e[9]=Wt*v+ir*F+dr*ue+Mr*ct,e[10]=Wt*m+ir*Z+dr*de+Mr*rt,e[11]=Wt*x+ir*K+dr*Ge+Mr*It,e[12]=(Wt=r[12])*f+(ir=r[13])*A+(dr=r[14])*q+(Mr=r[15])*Ye,e[13]=Wt*v+ir*F+dr*ue+Mr*ct,e[14]=Wt*m+ir*Z+dr*de+Mr*rt,e[15]=Wt*x+ir*K+dr*Ge+Mr*It,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,t=0,r=arguments.length;r--;)t+=e[r]*e[r];return Math.sqrt(t)});var Rs,tl=ko;function vu(e,t,r){var f=t[0],v=t[1],m=t[2],x=t[3];return e[0]=r[0]*f+r[4]*v+r[8]*m+r[12]*x,e[1]=r[1]*f+r[5]*v+r[9]*m+r[13]*x,e[2]=r[2]*f+r[6]*v+r[10]*m+r[14]*x,e[3]=r[3]*f+r[7]*v+r[11]*m+r[15]*x,e}Rs=new qi(3),qi!=Float32Array&&(Rs[0]=0,Rs[1]=0,Rs[2]=0),function(){var e=new qi(4);qi!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var rl=(function(){var e=new qi(2);qi!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function t(r){e.call(this,r,gs)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new vs(r)},t.prototype.queryRadius=function(r){var f=r;return Hs("circle-radius",this,f)+Hs("circle-stroke-width",this,f)+io(this.paint.get("circle-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,m,x,A,F,Z){for(var K=Au(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),A.angle,F),q=this.paint.get("circle-radius").evaluate(f,v)+this.paint.get("circle-stroke-width").evaluate(f,v),ue=this.paint.get("circle-pitch-alignment")==="map",de=ue?K:function(en,dn){return en.map(function(Hn){return nl(Hn,dn)})}(K,Z),Ge=ue?q*F:q,Ye=0,ct=m;Ye<ct.length;Ye+=1)for(var rt=0,It=ct[Ye];rt<It.length;rt+=1){var Wt=It[rt],ir=ue?Wt:nl(Wt,Z),dr=Ge,Mr=vu([],[Wt.x,Wt.y,0,1],Z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?dr*=Mr[3]/A.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(dr*=A.cameraToCenterDistance/Mr[3]),ms(de,ir,dr))return!0}return!1},t}(ku));function nl(e,t){var r=vu([],[e.x,e.y,0,1],t);return new $(r[0]/r[3],r[1]/r[3])}var Ec=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(vs);function Pu(e,t,r,f){var v=t.width,m=t.height;if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==v*m*r)throw new RangeError("mismatched image size")}else f=new Uint8Array(v*m*r);return e.width=v,e.height=m,e.data=f,e}function Gl(e,t,r){var f=t.width,v=t.height;if(f!==e.width||v!==e.height){var m=Pu({},{width:f,height:v},r);wc(e,m,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,f),height:Math.min(e.height,v)},r),e.width=f,e.height=v,e.data=m.data}}function wc(e,t,r,f,v,m){if(v.width===0||v.height===0)return t;if(v.width>e.width||v.height>e.height||r.x>e.width-v.width||r.y>e.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>t.width||v.height>t.height||f.x>t.width-v.width||f.y>t.height-v.height)throw new RangeError("out of range destination coordinates for image copy");for(var x=e.data,A=t.data,F=0;F<v.height;F++)for(var Z=((r.y+F)*e.width+r.x)*m,K=((f.y+F)*t.width+f.x)*m,q=0;q<v.width*m;q++)A[K+q]=x[Z+q];return t}wn("HeatmapBucket",Ec,{omit:["layers"]});var Ws=function(e,t){Pu(this,e,1,t)};Ws.prototype.resize=function(e){Gl(this,e,1)},Ws.prototype.clone=function(){return new Ws({width:this.width,height:this.height},new Uint8Array(this.data))},Ws.copy=function(e,t,r,f,v){wc(e,t,r,f,v,1)};var Uo=function(e,t){Pu(this,e,4,t)};Uo.prototype.resize=function(e){Gl(this,e,4)},Uo.prototype.replace=function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},Uo.prototype.clone=function(){return new Uo({width:this.width,height:this.height},new Uint8Array(this.data))},Uo.copy=function(e,t,r,f,v){wc(e,t,r,f,v,4)},wn("AlphaImage",Ws),wn("RGBAImage",Uo);var Hc={paint:new zo({"heatmap-radius":new On(te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new On(te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Un(te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Do(te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Un(te.paint_heatmap["heatmap-opacity"])})};function Rf(e){var t={},r=e.resolution||256,f=e.clips?e.clips.length:1,v=e.image||new Uo({width:r,height:f}),m=function(Ge,Ye,ct){t[e.evaluationKey]=ct;var rt=e.expression.evaluate(t);v.data[Ge+Ye+0]=Math.floor(255*rt.r/rt.a),v.data[Ge+Ye+1]=Math.floor(255*rt.g/rt.a),v.data[Ge+Ye+2]=Math.floor(255*rt.b/rt.a),v.data[Ge+Ye+3]=Math.floor(255*rt.a)};if(e.clips)for(var x=0,A=0;x<f;++x,A+=4*r)for(var F=0,Z=0;F<r;F++,Z+=4){var K=F/(r-1),q=e.clips[x];m(A,Z,q.start*(1-K)+q.end*K)}else for(var ue=0,de=0;ue<r;ue++,de+=4)m(0,de,ue/(r-1));return v}var Sl=function(e){function t(r){e.call(this,r,Hc),this._updateColorRamp()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Ec(r)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="heatmap-color"&&this._updateColorRamp()},t.prototype._updateColorRamp=function(){this.colorRamp=Rf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},t.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},t}(ku),uf={paint:new zo({"hillshade-illumination-direction":new Un(te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Un(te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Un(te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Un(te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Un(te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Un(te.paint_hillshade["hillshade-accent-color"])})},Wc=function(e){function t(r){e.call(this,r,uf)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},t}(ku),Wf=po([{name:"a_pos",components:2,type:"Int16"}],4).members,Hl=lf,ih=lf;function lf(e,t,r){r=r||2;var f,v,m,x,A,F,Z,K=t&&t.length,q=K?t[0]*r:e.length,ue=ru(e,0,q,r,!0),de=[];if(!ue||ue.next===ue.prev)return de;if(K&&(ue=function(Ye,ct,rt,It){var Wt,ir,dr,Mr=[];for(Wt=0,ir=ct.length;Wt<ir;Wt++)(dr=ru(Ye,ct[Wt]*It,Wt<ir-1?ct[Wt+1]*It:Ye.length,It,!1))===dr.next&&(dr.steiner=!0),Mr.push(qr(dr));for(Mr.sort(gt),Wt=0;Wt<Mr.length;Wt++)Gt(Mr[Wt],rt),rt=j(rt,rt.next);return rt}(e,t,ue,r)),e.length>80*r){f=m=e[0],v=x=e[1];for(var Ge=r;Ge<q;Ge+=r)(A=e[Ge])<f&&(f=A),(F=e[Ge+1])<v&&(v=F),A>m&&(m=A),F>x&&(x=F);Z=(Z=Math.max(m-f,x-v))!==0?1/Z:0}return z(ue,de,r,f,v,Z),de}function ru(e,t,r,f,v){var m,x;if(v===ca(e,t,r,f)>0)for(m=t;m<r;m+=f)x=bo(m,e[m],e[m+1],x);else for(m=r-f;m>=t;m-=f)x=bo(m,e[m],e[m+1],x);return x&&di(x,x.next)&&(So(x),x=x.next),x}function j(e,t){if(!e)return e;t||(t=e);var r,f=e;do if(r=!1,f.steiner||!di(f,f.next)&&Mn(f.prev,f,f.next)!==0)f=f.next;else{if(So(f),(f=t=f.prev)===f.next)break;r=!0}while(r||f!==t);return t}function z(e,t,r,f,v,m,x){if(e){!x&&m&&function(K,q,ue,de){var Ge=K;do Ge.z===null&&(Ge.z=Sr(Ge.x,Ge.y,q,ue,de)),Ge.prevZ=Ge.prev,Ge.nextZ=Ge.next,Ge=Ge.next;while(Ge!==K);Ge.prevZ.nextZ=null,Ge.prevZ=null,function(Ye){var ct,rt,It,Wt,ir,dr,Mr,en,dn=1;do{for(rt=Ye,Ye=null,ir=null,dr=0;rt;){for(dr++,It=rt,Mr=0,ct=0;ct<dn&&(Mr++,It=It.nextZ);ct++);for(en=dn;Mr>0||en>0&&It;)Mr!==0&&(en===0||!It||rt.z<=It.z)?(Wt=rt,rt=rt.nextZ,Mr--):(Wt=It,It=It.nextZ,en--),ir?ir.nextZ=Wt:Ye=Wt,Wt.prevZ=ir,ir=Wt;rt=It}ir.nextZ=null,dn*=2}while(dr>1)}(Ge)}(e,f,v,m);for(var A,F,Z=e;e.prev!==e.next;)if(A=e.prev,F=e.next,m?D(e,f,v,m):M(e))t.push(A.i/r),t.push(e.i/r),t.push(F.i/r),So(e),e=F.next,Z=F.next;else if((e=F)===Z){x?x===1?z(e=ne(j(e),t,r),t,r,f,v,m,2):x===2&&_e(e,t,r,f,v,m):z(j(e),t,r,f,v,m,1);break}}}function M(e){var t=e.prev,r=e,f=e.next;if(Mn(t,r,f)>=0)return!1;for(var v=e.next.next;v!==e.prev;){if(Rn(t.x,t.y,r.x,r.y,f.x,f.y,v.x,v.y)&&Mn(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function D(e,t,r,f){var v=e.prev,m=e,x=e.next;if(Mn(v,m,x)>=0)return!1;for(var A=v.x>m.x?v.x>x.x?v.x:x.x:m.x>x.x?m.x:x.x,F=v.y>m.y?v.y>x.y?v.y:x.y:m.y>x.y?m.y:x.y,Z=Sr(v.x<m.x?v.x<x.x?v.x:x.x:m.x<x.x?m.x:x.x,v.y<m.y?v.y<x.y?v.y:x.y:m.y<x.y?m.y:x.y,t,r,f),K=Sr(A,F,t,r,f),q=e.prevZ,ue=e.nextZ;q&&q.z>=Z&&ue&&ue.z<=K;){if(q!==e.prev&&q!==e.next&&Rn(v.x,v.y,m.x,m.y,x.x,x.y,q.x,q.y)&&Mn(q.prev,q,q.next)>=0||(q=q.prevZ,ue!==e.prev&&ue!==e.next&&Rn(v.x,v.y,m.x,m.y,x.x,x.y,ue.x,ue.y)&&Mn(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;q&&q.z>=Z;){if(q!==e.prev&&q!==e.next&&Rn(v.x,v.y,m.x,m.y,x.x,x.y,q.x,q.y)&&Mn(q.prev,q,q.next)>=0)return!1;q=q.prevZ}for(;ue&&ue.z<=K;){if(ue!==e.prev&&ue!==e.next&&Rn(v.x,v.y,m.x,m.y,x.x,x.y,ue.x,ue.y)&&Mn(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function ne(e,t,r){var f=e;do{var v=f.prev,m=f.next.next;!di(v,m)&&yi(v,f,f.next,m)&&Ha(v,m)&&Ha(m,v)&&(t.push(v.i/r),t.push(f.i/r),t.push(m.i/r),So(f),So(f.next),f=e=m),f=f.next}while(f!==e);return j(f)}function _e(e,t,r,f,v,m){var x=e;do{for(var A=x.next.next;A!==x.prev;){if(x.i!==A.i&&Gn(x,A)){var F=Mo(x,A);return x=j(x,x.next),F=j(F,F.next),z(x,t,r,f,v,m),void z(F,t,r,f,v,m)}A=A.next}x=x.next}while(x!==e)}function gt(e,t){return e.x-t.x}function Gt(e,t){if(t=function(f,v){var m,x=v,A=f.x,F=f.y,Z=-1/0;do{if(F<=x.y&&F>=x.next.y&&x.next.y!==x.y){var K=x.x+(F-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(K<=A&&K>Z){if(Z=K,K===A){if(F===x.y)return x;if(F===x.next.y)return x.next}m=x.x<x.next.x?x:x.next}}x=x.next}while(x!==v);if(!m)return null;if(A===Z)return m;var q,ue=m,de=m.x,Ge=m.y,Ye=1/0;x=m;do A>=x.x&&x.x>=de&&A!==x.x&&Rn(F<Ge?A:Z,F,de,Ge,F<Ge?Z:A,F,x.x,x.y)&&(q=Math.abs(F-x.y)/(A-x.x),Ha(x,f)&&(q<Ye||q===Ye&&(x.x>m.x||x.x===m.x&&zt(m,x)))&&(m=x,Ye=q)),x=x.next;while(x!==ue);return m}(e,t)){var r=Mo(t,e);j(t,t.next),j(r,r.next)}}function zt(e,t){return Mn(e.prev,e,t.prev)<0&&Mn(t.next,e,e.next)<0}function Sr(e,t,r,f,v){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*v)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-f)*v)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function qr(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function Rn(e,t,r,f,v,m,x,A){return(v-x)*(t-A)-(e-x)*(m-A)>=0&&(e-x)*(f-A)-(r-x)*(t-A)>=0&&(r-x)*(m-A)-(v-x)*(f-A)>=0}function Gn(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(r,f){var v=r;do{if(v.i!==r.i&&v.next.i!==r.i&&v.i!==f.i&&v.next.i!==f.i&&yi(v,v.next,r,f))return!0;v=v.next}while(v!==r);return!1}(e,t)&&(Ha(e,t)&&Ha(t,e)&&function(r,f){var v=r,m=!1,x=(r.x+f.x)/2,A=(r.y+f.y)/2;do v.y>A!=v.next.y>A&&v.next.y!==v.y&&x<(v.next.x-v.x)*(A-v.y)/(v.next.y-v.y)+v.x&&(m=!m),v=v.next;while(v!==r);return m}(e,t)&&(Mn(e.prev,e,t.prev)||Mn(e,t.prev,t))||di(e,t)&&Mn(e.prev,e,e.next)>0&&Mn(t.prev,t,t.next)>0)}function Mn(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function di(e,t){return e.x===t.x&&e.y===t.y}function yi(e,t,r,f){var v=Mi(Mn(e,t,r)),m=Mi(Mn(e,t,f)),x=Mi(Mn(r,f,e)),A=Mi(Mn(r,f,t));return v!==m&&x!==A||!(v!==0||!aa(e,r,t))||!(m!==0||!aa(e,f,t))||!(x!==0||!aa(r,e,f))||!(A!==0||!aa(r,t,f))}function aa(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function Mi(e){return e>0?1:e<0?-1:0}function Ha(e,t){return Mn(e.prev,e,e.next)<0?Mn(e,t,e.next)>=0&&Mn(e,e.prev,t)>=0:Mn(e,t,e.prev)<0||Mn(e,e.next,t)<0}function Mo(e,t){var r=new Qa(e.i,e.x,e.y),f=new Qa(t.i,t.x,t.y),v=e.next,m=t.prev;return e.next=t,t.prev=e,r.next=v,v.prev=r,f.next=r,r.prev=f,m.next=f,f.prev=m,f}function bo(e,t,r,f){var v=new Qa(e,t,r);return f?(v.next=f.next,v.prev=f,f.next.prev=v,f.next=v):(v.prev=v,v.next=v),v}function So(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Qa(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ca(e,t,r,f){for(var v=0,m=t,x=r-f;m<r;m+=f)v+=(e[x]-e[m])*(e[m+1]+e[x+1]),x=m;return v}function Wa(e,t,r,f,v){(function m(x,A,F,Z,K){for(;Z>F;){if(Z-F>600){var q=Z-F+1,ue=A-F+1,de=Math.log(q),Ge=.5*Math.exp(2*de/3),Ye=.5*Math.sqrt(de*Ge*(q-Ge)/q)*(ue-q/2<0?-1:1);m(x,A,Math.max(F,Math.floor(A-ue*Ge/q+Ye)),Math.min(Z,Math.floor(A+(q-ue)*Ge/q+Ye)),K)}var ct=x[A],rt=F,It=Z;for(Eo(x,F,A),K(x[Z],ct)>0&&Eo(x,F,Z);rt<It;){for(Eo(x,rt,It),rt++,It--;K(x[rt],ct)<0;)rt++;for(;K(x[It],ct)>0;)It--}K(x[F],ct)===0?Eo(x,F,It):Eo(x,++It,Z),It<=A&&(F=It+1),A<=It&&(Z=It-1)}})(e,t,r||0,f||e.length-1,v||oo)}function Eo(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}function oo(e,t){return e<t?-1:e>t?1:0}function wo(e,t){var r=e.length;if(r<=1)return[e];for(var f,v,m=[],x=0;x<r;x++){var A=Ue(e[x]);A!==0&&(e[x].area=Math.abs(A),v===void 0&&(v=A<0),v===A<0?(f&&m.push(f),f=[e[x]]):f.push(e[x]))}if(f&&m.push(f),t>1)for(var F=0;F<m.length;F++)m[F].length<=t||(Wa(m[F],t,1,m[F].length-1,Ds),m[F]=m[F].slice(0,t));return m}function Ds(e,t){return t.area-e.area}function mu(e,t,r){for(var f=r.patternDependencies,v=!1,m=0,x=t;m<x.length;m+=1){var A=x[m].paint.get(e+"-pattern");A.isConstant()||(v=!0);var F=A.constantOr(null);F&&(v=!0,f[F.to]=!0,f[F.from]=!0)}return v}function Zu(e,t,r,f,v){for(var m=v.patternDependencies,x=0,A=t;x<A.length;x+=1){var F=A[x],Z=F.paint.get(e+"-pattern").value;if(Z.kind!=="constant"){var K=Z.evaluate({zoom:f-1},r,{},v.availableImages),q=Z.evaluate({zoom:f},r,{},v.availableImages),ue=Z.evaluate({zoom:f+1},r,{},v.availableImages);q=q&&q.name?q.name:q,ue=ue&&ue.name?ue.name:ue,m[K=K&&K.name?K.name:K]=!0,m[q]=!0,m[ue]=!0,r.patterns[F.id]={min:K,mid:q,max:ue}}}return r}lf.deviation=function(e,t,r,f){var v=t&&t.length,m=Math.abs(ca(e,0,v?t[0]*r:e.length,r));if(v)for(var x=0,A=t.length;x<A;x++)m-=Math.abs(ca(e,t[x]*r,x<A-1?t[x+1]*r:e.length,r));var F=0;for(x=0;x<f.length;x+=3){var Z=f[x]*r,K=f[x+1]*r,q=f[x+2]*r;F+=Math.abs((e[Z]-e[q])*(e[K+1]-e[Z+1])-(e[Z]-e[K])*(e[q+1]-e[Z+1]))}return m===0&&F===0?0:Math.abs((F-m)/m)},lf.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},f=0,v=0;v<e.length;v++){for(var m=0;m<e[v].length;m++)for(var x=0;x<t;x++)r.vertices.push(e[v][m][x]);v>0&&r.holes.push(f+=e[v-1].length)}return r},Hl.default=ih;var Ss=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Fu,this.indexArray=new gl,this.indexArray2=new bc,this.programConfigurations=new ri(e.layers,e.zoom),this.segments=new ye,this.segments2=new ye,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};Ss.prototype.populate=function(e,t,r){this.hasPattern=mu("fill",this.layers,t);for(var f=this.layers[0].layout.get("fill-sort-key"),v=[],m=0,x=e;m<x.length;m+=1){var A=x[m],F=A.feature,Z=A.id,K=A.index,q=A.sourceLayerIndex,ue=this.layers[0]._featureFilter.needGeometry,de=no(F,ue);if(this.layers[0]._featureFilter.filter(new Bi(this.zoom),de,r)){var Ge=f?f.evaluate(de,{},r,t.availableImages):void 0,Ye={id:Z,properties:F.properties,type:F.type,sourceLayerIndex:q,index:K,geometry:ue?de.geometry:Ga(F),patterns:{},sortKey:Ge};v.push(Ye)}}f&&v.sort(function(en,dn){return en.sortKey-dn.sortKey});for(var ct=0,rt=v;ct<rt.length;ct+=1){var It=rt[ct],Wt=It.geometry,ir=It.index,dr=It.sourceLayerIndex;if(this.hasPattern){var Mr=Zu("fill",this.layers,It,this.zoom,t);this.patternFeatures.push(Mr)}else this.addFeature(It,Wt,ir,r,{});t.featureIndex.insert(e[ir].feature,Wt,ir,dr,this.index)}},Ss.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Ss.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var m=v[f];this.addFeature(m,m.geometry,m.index,t,r)}},Ss.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ss.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ss.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Wf),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},Ss.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Ss.prototype.addFeature=function(e,t,r,f,v){for(var m=0,x=wo(t,500);m<x.length;m+=1){for(var A=x[m],F=0,Z=0,K=A;Z<K.length;Z+=1)F+=K[Z].length;for(var q=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray),ue=q.vertexLength,de=[],Ge=[],Ye=0,ct=A;Ye<ct.length;Ye+=1){var rt=ct[Ye];if(rt.length!==0){rt!==A[0]&&Ge.push(de.length/2);var It=this.segments2.prepareSegment(rt.length,this.layoutVertexArray,this.indexArray2),Wt=It.vertexLength;this.layoutVertexArray.emplaceBack(rt[0].x,rt[0].y),this.indexArray2.emplaceBack(Wt+rt.length-1,Wt),de.push(rt[0].x),de.push(rt[0].y);for(var ir=1;ir<rt.length;ir++)this.layoutVertexArray.emplaceBack(rt[ir].x,rt[ir].y),this.indexArray2.emplaceBack(Wt+ir-1,Wt+ir),de.push(rt[ir].x),de.push(rt[ir].y);It.vertexLength+=rt.length,It.primitiveLength+=rt.length}}for(var dr=Hl(de,Ge),Mr=0;Mr<dr.length;Mr+=3)this.indexArray.emplaceBack(ue+dr[Mr],ue+dr[Mr+1],ue+dr[Mr+2]);q.vertexLength+=F,q.primitiveLength+=dr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},wn("FillBucket",Ss,{omit:["layers","patternFeatures"]});var Xc=new zo({"fill-sort-key":new On(te.layout_fill["fill-sort-key"])}),cf={paint:new zo({"fill-antialias":new Un(te.paint_fill["fill-antialias"]),"fill-opacity":new On(te.paint_fill["fill-opacity"]),"fill-color":new On(te.paint_fill["fill-color"]),"fill-outline-color":new On(te.paint_fill["fill-outline-color"]),"fill-translate":new Un(te.paint_fill["fill-translate"]),"fill-translate-anchor":new Un(te.paint_fill["fill-translate-anchor"]),"fill-pattern":new Zl(te.paint_fill["fill-pattern"])}),layout:Xc},jp=function(e){function t(r){e.call(this,r,cf)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f);var v=this.paint._values["fill-outline-color"];v.value.kind==="constant"&&v.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},t.prototype.createBucket=function(r){return new Ss(r)},t.prototype.queryRadius=function(){return io(this.paint.get("fill-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,m,x,A,F){return eu(Au(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),A.angle,F),m)},t.prototype.isTileClipped=function(){return!0},t}(ku),Xf=po([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Yc=ff;function ff(e,t,r,f,v){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=f,this._values=v,e.readFields(fp,this,t)}function fp(e,t,r){e==1?t.id=r.readVarint():e==2?function(f,v){for(var m=f.readVarint()+f.pos;f.pos<m;){var x=v._keys[f.readVarint()],A=v._values[f.readVarint()];v.properties[x]=A}}(r,t):e==3?t.type=r.readVarint():e==4&&(t._geometry=r.pos)}function Mh(e){for(var t,r,f=0,v=0,m=e.length,x=m-1;v<m;x=v++)f+=((r=e[x]).x-(t=e[v]).x)*(t.y+r.y);return f}ff.types=["Unknown","Point","LineString","Polygon"],ff.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,f=1,v=0,m=0,x=0,A=[];e.pos<r;){if(v<=0){var F=e.readVarint();f=7&F,v=F>>3}if(v--,f===1||f===2)m+=e.readSVarint(),x+=e.readSVarint(),f===1&&(t&&A.push(t),t=[]),t.push(new $(m,x));else{if(f!==7)throw new Error("unknown command "+f);t&&t.push(t[0].clone())}}return t&&A.push(t),A},ff.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,f=0,v=0,m=0,x=1/0,A=-1/0,F=1/0,Z=-1/0;e.pos<t;){if(f<=0){var K=e.readVarint();r=7&K,f=K>>3}if(f--,r===1||r===2)(v+=e.readSVarint())<x&&(x=v),v>A&&(A=v),(m+=e.readSVarint())<F&&(F=m),m>Z&&(Z=m);else if(r!==7)throw new Error("unknown command "+r)}return[x,F,A,Z]},ff.prototype.toGeoJSON=function(e,t,r){var f,v,m=this.extent*Math.pow(2,r),x=this.extent*e,A=this.extent*t,F=this.loadGeometry(),Z=ff.types[this.type];function K(de){for(var Ge=0;Ge<de.length;Ge++){var Ye=de[Ge];de[Ge]=[360*(Ye.x+x)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ye.y+A)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var q=[];for(f=0;f<F.length;f++)q[f]=F[f][0];K(F=q);break;case 2:for(f=0;f<F.length;f++)K(F[f]);break;case 3:for(F=function(de){var Ge=de.length;if(Ge<=1)return[de];for(var Ye,ct,rt=[],It=0;It<Ge;It++){var Wt=Mh(de[It]);Wt!==0&&(ct===void 0&&(ct=Wt<0),ct===Wt<0?(Ye&&rt.push(Ye),Ye=[de[It]]):Ye.push(de[It]))}return Ye&&rt.push(Ye),rt}(F),f=0;f<F.length;f++)for(v=0;v<F[f].length;v++)K(F[f][v])}F.length===1?F=F[0]:Z="Multi"+Z;var ue={type:"Feature",geometry:{type:Z,coordinates:F},properties:this.properties};return"id"in this&&(ue.id=this.id),ue};var hp=Ih;function Ih(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Vp,this,t),this.length=this._features.length}function Vp(e,t,r){e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(function(f){for(var v=null,m=f.readVarint()+f.pos;f.pos<m;){var x=f.readVarint()>>3;v=x===1?f.readString():x===2?f.readFloat():x===3?f.readDouble():x===4?f.readVarint64():x===5?f.readVarint():x===6?f.readSVarint():x===7?f.readBoolean():null}return v}(r))}function Wl(e,t,r){if(e===3){var f=new hp(r,r.readVarint()+r.pos);f.length&&(t[f.name]=f)}}Ih.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new Yc(this._pbf,t,this.extent,this._keys,this._values)};var Kc={VectorTile:function(e,t){this.layers=e.readFields(Wl,{},t)},VectorTileFeature:Yc,VectorTileLayer:hp},wf=Kc.VectorTileFeature.types,Xl=Math.pow(2,13);function Cf(e,t,r,f,v,m,x,A){e.emplaceBack(t,r,2*Math.floor(f*Xl)+x,v*Xl*2,m*Xl*2,Math.round(A))}var il=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Bu,this.indexArray=new gl,this.programConfigurations=new ri(e.layers,e.zoom),this.segments=new ye,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function Yf(e,t){return e.x===t.x&&(e.x<0||e.x>8192)||e.y===t.y&&(e.y<0||e.y>8192)}il.prototype.populate=function(e,t,r){this.features=[],this.hasPattern=mu("fill-extrusion",this.layers,t);for(var f=0,v=e;f<v.length;f+=1){var m=v[f],x=m.feature,A=m.id,F=m.index,Z=m.sourceLayerIndex,K=this.layers[0]._featureFilter.needGeometry,q=no(x,K);if(this.layers[0]._featureFilter.filter(new Bi(this.zoom),q,r)){var ue={id:A,sourceLayerIndex:Z,index:F,geometry:K?q.geometry:Ga(x),properties:x.properties,type:x.type,patterns:{}};this.hasPattern?this.features.push(Zu("fill-extrusion",this.layers,ue,this.zoom,t)):this.addFeature(ue,ue.geometry,F,r,{}),t.featureIndex.insert(x,ue.geometry,F,Z,this.index,!0)}}},il.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.features;f<v.length;f+=1){var m=v[f];this.addFeature(m,m.geometry,m.index,t,r)}},il.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},il.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},il.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},il.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xf),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},il.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},il.prototype.addFeature=function(e,t,r,f,v){for(var m=0,x=wo(t,500);m<x.length;m+=1){for(var A=x[m],F=0,Z=0,K=A;Z<K.length;Z+=1)F+=K[Z].length;for(var q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ue=0,de=A;ue<de.length;ue+=1){var Ge=de[ue];if(Ge.length!==0&&!((ta=Ge).every(function(Li){return Li.x<0})||ta.every(function(Li){return Li.x>8192})||ta.every(function(Li){return Li.y<0})||ta.every(function(Li){return Li.y>8192})))for(var Ye=0,ct=0;ct<Ge.length;ct++){var rt=Ge[ct];if(ct>=1){var It=Ge[ct-1];if(!Yf(rt,It)){q.vertexLength+4>ye.MAX_VERTEX_ARRAY_LENGTH&&(q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Wt=rt.sub(It)._perp()._unit(),ir=It.dist(rt);Ye+ir>32768&&(Ye=0),Cf(this.layoutVertexArray,rt.x,rt.y,Wt.x,Wt.y,0,0,Ye),Cf(this.layoutVertexArray,rt.x,rt.y,Wt.x,Wt.y,0,1,Ye),Cf(this.layoutVertexArray,It.x,It.y,Wt.x,Wt.y,0,0,Ye+=ir),Cf(this.layoutVertexArray,It.x,It.y,Wt.x,Wt.y,0,1,Ye);var dr=q.vertexLength;this.indexArray.emplaceBack(dr,dr+2,dr+1),this.indexArray.emplaceBack(dr+1,dr+2,dr+3),q.vertexLength+=4,q.primitiveLength+=2}}}}if(q.vertexLength+F>ye.MAX_VERTEX_ARRAY_LENGTH&&(q=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray)),wf[e.type]==="Polygon"){for(var Mr=[],en=[],dn=q.vertexLength,Hn=0,En=A;Hn<En.length;Hn+=1){var ei=En[Hn];if(ei.length!==0){ei!==A[0]&&en.push(Mr.length/2);for(var Tn=0;Tn<ei.length;Tn++){var Vi=ei[Tn];Cf(this.layoutVertexArray,Vi.x,Vi.y,0,0,1,1,0),Mr.push(Vi.x),Mr.push(Vi.y)}}}for(var mi=Hl(Mr,en),Bn=0;Bn<mi.length;Bn+=3)this.indexArray.emplaceBack(dn+mi[Bn],dn+mi[Bn+2],dn+mi[Bn+1]);q.primitiveLength+=mi.length/3,q.vertexLength+=F}}var ta;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},wn("FillExtrusionBucket",il,{omit:["layers","features"]});var Oh={paint:new zo({"fill-extrusion-opacity":new Un(te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new On(te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Un(te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Un(te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Zl(te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new On(te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new On(te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Un(te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},gu=function(e){function t(r){e.call(this,r,Oh)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new il(r)},t.prototype.queryRadius=function(){return io(this.paint.get("fill-extrusion-translate"))},t.prototype.is3D=function(){return!0},t.prototype.queryIntersectsFeature=function(r,f,v,m,x,A,F,Z){var K=Au(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),A.angle,F),q=this.paint.get("fill-extrusion-height").evaluate(f,v),ue=this.paint.get("fill-extrusion-base").evaluate(f,v),de=function(Ye,ct,rt,It){for(var Wt=[],ir=0,dr=Ye;ir<dr.length;ir+=1){var Mr=dr[ir],en=[Mr.x,Mr.y,0,1];vu(en,en,ct),Wt.push(new $(en[0]/en[3],en[1]/en[3]))}return Wt}(K,Z),Ge=function(Ye,ct,rt,It){for(var Wt=[],ir=[],dr=It[8]*ct,Mr=It[9]*ct,en=It[10]*ct,dn=It[11]*ct,Hn=It[8]*rt,En=It[9]*rt,ei=It[10]*rt,Tn=It[11]*rt,Vi=0,mi=Ye;Vi<mi.length;Vi+=1){for(var Bn=[],ta=[],Li=0,la=mi[Vi];Li<la.length;Li+=1){var Jn=la[Li],zi=Jn.x,uo=Jn.y,lo=It[0]*zi+It[4]*uo+It[12],Go=It[1]*zi+It[5]*uo+It[13],go=It[2]*zi+It[6]*uo+It[14],Ho=It[3]*zi+It[7]*uo+It[15],Bs=go+en,ts=Ho+dn,Cs=lo+Hn,Ts=Go+En,iu=go+ei,Wo=Ho+Tn,Bo=new $((lo+dr)/ts,(Go+Mr)/ts);Bo.z=Bs/ts,Bn.push(Bo);var na=new $(Cs/Wo,Ts/Wo);na.z=iu/Wo,ta.push(na)}Wt.push(Bn),ir.push(ta)}return[Wt,ir]}(m,ue,q,Z);return function(Ye,ct,rt){var It=1/0;eu(rt,ct)&&(It=jo(rt,ct[0]));for(var Wt=0;Wt<ct.length;Wt++)for(var ir=ct[Wt],dr=Ye[Wt],Mr=0;Mr<ir.length-1;Mr++){var en=ir[Mr],dn=[en,ir[Mr+1],dr[Mr+1],dr[Mr],en];el(rt,dn)&&(It=Math.min(It,jo(rt,dn)))}return It!==1/0&&It}(Ge[0],Ge[1],de)},t}(ku);function al(e,t){return e.x*t.x+e.y*t.y}function jo(e,t){if(e.length===1){for(var r,f=0,v=t[f++];!r||v.equals(r);)if(!(r=t[f++]))return 1/0;for(;f<t.length;f++){var m=t[f],x=e[0],A=r.sub(v),F=m.sub(v),Z=x.sub(v),K=al(A,A),q=al(A,F),ue=al(F,F),de=al(Z,A),Ge=al(Z,F),Ye=K*ue-q*q,ct=(ue*de-q*Ge)/Ye,rt=(K*Ge-q*de)/Ye,It=v.z*(1-ct-rt)+r.z*ct+m.z*rt;if(isFinite(It))return It}return 1/0}for(var Wt=1/0,ir=0,dr=t;ir<dr.length;ir+=1)Wt=Math.min(Wt,dr[ir].z);return Wt}var Uu=po([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Lh=po([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,pp=Kc.VectorTileFeature.types,Rh=Math.cos(Math.PI/180*37.5),Dh=Math.pow(2,14)/.5,nu=function(e){var t=this;this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(r){t.gradients[r.id]={}}),this.layoutVertexArray=new Os,this.layoutVertexArray2=new oc,this.indexArray=new gl,this.programConfigurations=new ri(e.layers,e.zoom),this.segments=new ye,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};nu.prototype.populate=function(e,t,r){this.hasPattern=mu("line",this.layers,t);for(var f=this.layers[0].layout.get("line-sort-key"),v=[],m=0,x=e;m<x.length;m+=1){var A=x[m],F=A.feature,Z=A.id,K=A.index,q=A.sourceLayerIndex,ue=this.layers[0]._featureFilter.needGeometry,de=no(F,ue);if(this.layers[0]._featureFilter.filter(new Bi(this.zoom),de,r)){var Ge=f?f.evaluate(de,{},r):void 0,Ye={id:Z,properties:F.properties,type:F.type,sourceLayerIndex:q,index:K,geometry:ue?de.geometry:Ga(F),patterns:{},sortKey:Ge};v.push(Ye)}}f&&v.sort(function(en,dn){return en.sortKey-dn.sortKey});for(var ct=0,rt=v;ct<rt.length;ct+=1){var It=rt[ct],Wt=It.geometry,ir=It.index,dr=It.sourceLayerIndex;if(this.hasPattern){var Mr=Zu("line",this.layers,It,this.zoom,t);this.patternFeatures.push(Mr)}else this.addFeature(It,Wt,ir,r,{});t.featureIndex.insert(e[ir].feature,Wt,ir,dr,this.index)}},nu.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},nu.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var m=v[f];this.addFeature(m,m.geometry,m.index,t,r)}},nu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},nu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},nu.prototype.upload=function(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Lh)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Uu),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},nu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},nu.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},nu.prototype.addFeature=function(e,t,r,f,v){var m=this.layers[0].layout,x=m.get("line-join").evaluate(e,{}),A=m.get("line-cap"),F=m.get("line-miter-limit"),Z=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(var K=0,q=t;K<q.length;K+=1)this.addLine(q[K],e,x,A,F,Z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},nu.prototype.addLine=function(e,t,r,f,v,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var x=0;x<e.length-1;x++)this.totalDistance+=e[x].dist(e[x+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var A=pp[t.type]==="Polygon",F=e.length;F>=2&&e[F-1].equals(e[F-2]);)F--;for(var Z=0;Z<F-1&&e[Z].equals(e[Z+1]);)Z++;if(!(F<(A?3:2))){r==="bevel"&&(v=1.05);var K,q=this.overscaling<=16?122880/(512*this.overscaling):0,ue=this.segments.prepareSegment(10*F,this.layoutVertexArray,this.indexArray),de=void 0,Ge=void 0,Ye=void 0,ct=void 0;this.e1=this.e2=-1,A&&(ct=e[Z].sub(K=e[F-2])._unit()._perp());for(var rt=Z;rt<F;rt++)if(!(Ge=rt===F-1?A?e[Z+1]:void 0:e[rt+1])||!e[rt].equals(Ge)){ct&&(Ye=ct),K&&(de=K),K=e[rt],ct=Ge?Ge.sub(K)._unit()._perp():Ye;var It=(Ye=Ye||ct).add(ct);It.x===0&&It.y===0||It._unit();var Wt=Ye.x*ct.x+Ye.y*ct.y,ir=It.x*ct.x+It.y*ct.y,dr=ir!==0?1/ir:1/0,Mr=2*Math.sqrt(2-2*ir),en=ir<Rh&&de&&Ge,dn=Ye.x*ct.y-Ye.y*ct.x>0;if(en&&rt>Z){var Hn=K.dist(de);if(Hn>2*q){var En=K.sub(K.sub(de)._mult(q/Hn)._round());this.updateDistance(de,En),this.addCurrentVertex(En,Ye,0,0,ue),de=En}}var ei=de&&Ge,Tn=ei?r:A?"butt":f;if(ei&&Tn==="round"&&(dr<m?Tn="miter":dr<=2&&(Tn="fakeround")),Tn==="miter"&&dr>v&&(Tn="bevel"),Tn==="bevel"&&(dr>2&&(Tn="flipbevel"),dr<v&&(Tn="miter")),de&&this.updateDistance(de,K),Tn==="miter")It._mult(dr),this.addCurrentVertex(K,It,0,0,ue);else if(Tn==="flipbevel"){if(dr>100)It=ct.mult(-1);else{var Vi=dr*Ye.add(ct).mag()/Ye.sub(ct).mag();It._perp()._mult(Vi*(dn?-1:1))}this.addCurrentVertex(K,It,0,0,ue),this.addCurrentVertex(K,It.mult(-1),0,0,ue)}else if(Tn==="bevel"||Tn==="fakeround"){var mi=-Math.sqrt(dr*dr-1),Bn=dn?mi:0,ta=dn?0:mi;if(de&&this.addCurrentVertex(K,Ye,Bn,ta,ue),Tn==="fakeround")for(var Li=Math.round(180*Mr/Math.PI/20),la=1;la<Li;la++){var Jn=la/Li;if(Jn!==.5){var zi=Jn-.5;Jn+=Jn*zi*(Jn-1)*((1.0904+Wt*(Wt*(3.55645-1.43519*Wt)-3.2452))*zi*zi+(.848013+Wt*(.215638*Wt-1.06021)))}var uo=ct.sub(Ye)._mult(Jn)._add(Ye)._unit()._mult(dn?-1:1);this.addHalfVertex(K,uo.x,uo.y,!1,dn,0,ue)}Ge&&this.addCurrentVertex(K,ct,-Bn,-ta,ue)}else if(Tn==="butt")this.addCurrentVertex(K,It,0,0,ue);else if(Tn==="square"){var lo=de?1:-1;this.addCurrentVertex(K,It,lo,lo,ue)}else Tn==="round"&&(de&&(this.addCurrentVertex(K,Ye,0,0,ue),this.addCurrentVertex(K,Ye,1,1,ue,!0)),Ge&&(this.addCurrentVertex(K,ct,-1,-1,ue,!0),this.addCurrentVertex(K,ct,0,0,ue)));if(en&&rt<F-1){var Go=K.dist(Ge);if(Go>2*q){var go=K.add(Ge.sub(K)._mult(q/Go)._round());this.updateDistance(K,go),this.addCurrentVertex(go,ct,0,0,ue),K=go}}}}},nu.prototype.addCurrentVertex=function(e,t,r,f,v,m){m===void 0&&(m=!1);var x=t.y*f-t.x,A=-t.y-t.x*f;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,m,!1,r,v),this.addHalfVertex(e,x,A,m,!0,-f,v),this.distance>Dh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,t,r,f,v,m))},nu.prototype.addHalfVertex=function(e,t,r,f,v,m,x){var A=.5*(this.lineClips?this.scaledDistance*(Dh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(f?1:0),(e.y<<1)+(v?1:0),Math.round(63*t)+128,Math.round(63*r)+128,1+(m===0?0:m<0?-1:1)|(63&A)<<2,A>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var F=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,F),x.primitiveLength++),v?this.e2=F:this.e1=F},nu.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},nu.prototype.updateDistance=function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()},wn("LineBucket",nu,{omit:["layers","patternFeatures"]});var kh=new zo({"line-cap":new Un(te.layout_line["line-cap"]),"line-join":new On(te.layout_line["line-join"]),"line-miter-limit":new Un(te.layout_line["line-miter-limit"]),"line-round-limit":new Un(te.layout_line["line-round-limit"]),"line-sort-key":new On(te.layout_line["line-sort-key"])}),ah={paint:new zo({"line-opacity":new On(te.paint_line["line-opacity"]),"line-color":new On(te.paint_line["line-color"]),"line-translate":new Un(te.paint_line["line-translate"]),"line-translate-anchor":new Un(te.paint_line["line-translate-anchor"]),"line-width":new On(te.paint_line["line-width"]),"line-gap-width":new On(te.paint_line["line-gap-width"]),"line-offset":new On(te.paint_line["line-offset"]),"line-blur":new On(te.paint_line["line-blur"]),"line-dasharray":new ps(te.paint_line["line-dasharray"]),"line-pattern":new Zl(te.paint_line["line-pattern"]),"line-gradient":new Do(te.paint_line["line-gradient"])}),layout:kh},oh=new(function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f){return f=new Bi(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),e.prototype.possiblyEvaluate.call(this,r,f)},t.prototype.evaluate=function(r,f,v,m){return f=Ht({},f,{zoom:Math.floor(f.zoom)}),e.prototype.evaluate.call(this,r,f,v,m)},t}(On))(ah.paint.properties["line-width"].specification);oh.useIntegerZoom=!0;var dp=function(e){function t(r){e.call(this,r,ah),this.gradientVersion=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ti,this.gradientVersion=(this.gradientVersion+1)%Ce)},t.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f),this.paint._values["line-floorwidth"]=oh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)},t.prototype.createBucket=function(r){return new nu(r)},t.prototype.queryRadius=function(r){var f=r,v=Fh(Hs("line-width",this,f),Hs("line-gap-width",this,f)),m=Hs("line-offset",this,f);return v/2+Math.abs(m)+io(this.paint.get("line-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,m,x,A,F){var Z=Au(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),A.angle,F),K=F/2*Fh(this.paint.get("line-width").evaluate(f,v),this.paint.get("line-gap-width").evaluate(f,v)),q=this.paint.get("line-offset").evaluate(f,v);return q&&(m=function(ue,de){for(var Ge=[],Ye=new $(0,0),ct=0;ct<ue.length;ct++){for(var rt=ue[ct],It=[],Wt=0;Wt<rt.length;Wt++){var ir=rt[Wt],dr=rt[Wt+1],Mr=Wt===0?Ye:ir.sub(rt[Wt-1])._unit()._perp(),en=Wt===rt.length-1?Ye:dr.sub(ir)._unit()._perp(),dn=Mr._add(en)._unit();dn._mult(1/(dn.x*en.x+dn.y*en.y)),It.push(dn._mult(de)._add(ir))}Ge.push(It)}return Ge}(m,q*F)),function(ue,de,Ge){for(var Ye=0;Ye<de.length;Ye++){var ct=de[Ye];if(ue.length>=3){for(var rt=0;rt<ct.length;rt++)if(Tu(ue,ct[rt]))return!0}if(Ls(ue,ct,Ge))return!0}return!1}(Z,m,K)},t.prototype.isTileClipped=function(){return!0},t}(ku);function Fh(e,t){return t>0?t+2*e:e}var vp=po([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Bh=po([{name:"a_projected_pos",components:3,type:"Float32"}],4),Nh=(po([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),po([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Kf=(po([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),po([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),mp=po([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function zh(e,t,r){return e.sections.forEach(function(f){f.text=function(v,m,x){var A=m.layout.get("text-transform").evaluate(x,{});return A==="uppercase"?v=v.toLocaleUpperCase():A==="lowercase"&&(v=v.toLocaleLowerCase()),Is.applyArabicShaping&&(v=Is.applyArabicShaping(v)),v}(f.text,t,r)}),e}po([{name:"triangle",components:3,type:"Uint16"}]),po([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),po([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),po([{type:"Float32",name:"offsetX"}]),po([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var $c={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Zh=function(e,t,r,f,v){var m,x,A=8*v-f-1,F=(1<<A)-1,Z=F>>1,K=-7,q=r?v-1:0,ue=r?-1:1,de=e[t+q];for(q+=ue,m=de&(1<<-K)-1,de>>=-K,K+=A;K>0;m=256*m+e[t+q],q+=ue,K-=8);for(x=m&(1<<-K)-1,m>>=-K,K+=f;K>0;x=256*x+e[t+q],q+=ue,K-=8);if(m===0)m=1-Z;else{if(m===F)return x?NaN:1/0*(de?-1:1);x+=Math.pow(2,f),m-=Z}return(de?-1:1)*x*Math.pow(2,m-f)},U=function(e,t,r,f,v,m){var x,A,F,Z=8*m-v-1,K=(1<<Z)-1,q=K>>1,ue=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,de=f?0:m-1,Ge=f?1:-1,Ye=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(A=isNaN(t)?1:0,x=K):(x=Math.floor(Math.log(t)/Math.LN2),t*(F=Math.pow(2,-x))<1&&(x--,F*=2),(t+=x+q>=1?ue/F:ue*Math.pow(2,1-q))*F>=2&&(x++,F/=2),x+q>=K?(A=0,x=K):x+q>=1?(A=(t*F-1)*Math.pow(2,v),x+=q):(A=t*Math.pow(2,q-1)*Math.pow(2,v),x=0));v>=8;e[r+de]=255&A,de+=Ge,A/=256,v-=8);for(x=x<<v|A,Z+=v;Z>0;e[r+de]=255&x,de+=Ge,x/=256,Z-=8);e[r+de-Ge]|=128*Ye},Pe=Ze;function Ze(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Ze.Varint=0,Ze.Fixed64=1,Ze.Bytes=2,Ze.Fixed32=5;var rr=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function wr(e){return e.type===Ze.Bytes?e.readVarint()+e.pos:e.pos+1}function Xt(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function vr(e,t,r){var f=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(f);for(var v=r.pos-1;v>=e;v--)r.buf[v+f]=r.buf[v]}function Ur(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function Hr(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function Jr(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function Gr(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function rn(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function hn(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function jr(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function an(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function Zt(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function pr(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Vr(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function mn(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function Br(e,t,r){e===1&&r.readMessage(Sn,t)}function Sn(e,t,r){if(e===3){var f=r.readMessage(zr,{}),v=f.width,m=f.height,x=f.left,A=f.top,F=f.advance;t.push({id:f.id,bitmap:new Ws({width:v+6,height:m+6},f.bitmap),metrics:{width:v,height:m,left:x,top:A,advance:F}})}}function zr(e,t,r){e===1?t.id=r.readVarint():e===2?t.bitmap=r.readBytes():e===3?t.width=r.readVarint():e===4?t.height=r.readVarint():e===5?t.left=r.readSVarint():e===6?t.top=r.readSVarint():e===7&&(t.advance=r.readVarint())}function un(e){for(var t=0,r=0,f=0,v=e;f<v.length;f+=1){var m=v[f];t+=m.w*m.h,r=Math.max(r,m.w)}e.sort(function(Ye,ct){return ct.h-Ye.h});for(var x=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],A=0,F=0,Z=0,K=e;Z<K.length;Z+=1)for(var q=K[Z],ue=x.length-1;ue>=0;ue--){var de=x[ue];if(!(q.w>de.w||q.h>de.h)){if(q.x=de.x,q.y=de.y,F=Math.max(F,q.y+q.h),A=Math.max(A,q.x+q.w),q.w===de.w&&q.h===de.h){var Ge=x.pop();ue<x.length&&(x[ue]=Ge)}else q.h===de.h?(de.x+=q.w,de.w-=q.w):q.w===de.w?(de.y+=q.h,de.h-=q.h):(x.push({x:de.x+q.w,y:de.y,w:de.w-q.w,h:q.h}),de.y+=q.h,de.h-=q.h);break}}return{w:A,h:F,fill:t/(A*F)||0}}Ze.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var f=this.readVarint(),v=f>>3,m=this.pos;this.type=7&f,e(v,t,this),this.pos===m&&this.skip(f)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=pr(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=mn(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=pr(this.buf,this.pos)+4294967296*pr(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=pr(this.buf,this.pos)+4294967296*mn(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=Zh(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Zh(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,f=this.buf;return t=127&(r=f[this.pos++]),r<128?t:(t|=(127&(r=f[this.pos++]))<<7,r<128?t:(t|=(127&(r=f[this.pos++]))<<14,r<128?t:(t|=(127&(r=f[this.pos++]))<<21,r<128?t:function(v,m,x){var A,F,Z=x.buf;if(A=(112&(F=Z[x.pos++]))>>4,F<128||(A|=(127&(F=Z[x.pos++]))<<3,F<128)||(A|=(127&(F=Z[x.pos++]))<<10,F<128)||(A|=(127&(F=Z[x.pos++]))<<17,F<128)||(A|=(127&(F=Z[x.pos++]))<<24,F<128)||(A|=(1&(F=Z[x.pos++]))<<31,F<128))return Xt(v,A,m);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=f[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&rr?function(r,f,v){return rr.decode(r.subarray(f,v))}(this.buf,t,e):function(r,f,v){for(var m="",x=f;x<v;){var A,F,Z,K=r[x],q=null,ue=K>239?4:K>223?3:K>191?2:1;if(x+ue>v)break;ue===1?K<128&&(q=K):ue===2?(192&(A=r[x+1]))==128&&(q=(31&K)<<6|63&A)<=127&&(q=null):ue===3?(F=r[x+2],(192&(A=r[x+1]))==128&&(192&F)==128&&((q=(15&K)<<12|(63&A)<<6|63&F)<=2047||q>=55296&&q<=57343)&&(q=null)):ue===4&&(F=r[x+2],Z=r[x+3],(192&(A=r[x+1]))==128&&(192&F)==128&&(192&Z)==128&&((q=(15&K)<<18|(63&A)<<12|(63&F)<<6|63&Z)<=65535||q>=1114112)&&(q=null)),q===null?(q=65533,ue=1):q>65535&&(q-=65536,m+=String.fromCharCode(q>>>10&1023|55296),q=56320|1023&q),m+=String.fromCharCode(q),x+=ue}return m}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Ze.Bytes)return e.push(this.readVarint(t));var r=wr(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Ze.Bytes)return e.push(this.readSVarint());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Ze.Bytes)return e.push(this.readBoolean());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Ze.Bytes)return e.push(this.readFloat());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Ze.Bytes)return e.push(this.readDouble());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Ze.Bytes)return e.push(this.readFixed32());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Ze.Bytes)return e.push(this.readSFixed32());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Ze.Bytes)return e.push(this.readFixed64());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Ze.Bytes)return e.push(this.readSFixed64());var t=wr(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Ze.Varint)for(;this.buf[this.pos++]>127;);else if(t===Ze.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Ze.Fixed32)this.pos+=4;else{if(t!==Ze.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Vr(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Vr(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Vr(this.buf,-1&e,this.pos),Vr(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Vr(this.buf,-1&e,this.pos),Vr(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,r){var f,v;if(t>=0?(f=t%4294967296|0,v=t/4294967296|0):(v=~(-t/4294967296),4294967295^(f=~(-t%4294967296))?f=f+1|0:(f=0,v=v+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(m,x,A){A.buf[A.pos++]=127&m|128,m>>>=7,A.buf[A.pos++]=127&m|128,m>>>=7,A.buf[A.pos++]=127&m|128,m>>>=7,A.buf[A.pos++]=127&m|128,A.buf[A.pos]=127&(m>>>=7)}(f,0,r),function(m,x){var A=(7&m)<<4;x.buf[x.pos++]|=A|((m>>>=3)?128:0),m&&(x.buf[x.pos++]=127&m|((m>>>=7)?128:0),m&&(x.buf[x.pos++]=127&m|((m>>>=7)?128:0),m&&(x.buf[x.pos++]=127&m|((m>>>=7)?128:0),m&&(x.buf[x.pos++]=127&m|((m>>>=7)?128:0),m&&(x.buf[x.pos++]=127&m)))))}(v,r)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(f,v,m){for(var x,A,F=0;F<v.length;F++){if((x=v.charCodeAt(F))>55295&&x<57344){if(!A){x>56319||F+1===v.length?(f[m++]=239,f[m++]=191,f[m++]=189):A=x;continue}if(x<56320){f[m++]=239,f[m++]=191,f[m++]=189,A=x;continue}x=A-55296<<10|x-56320|65536,A=null}else A&&(f[m++]=239,f[m++]=191,f[m++]=189,A=null);x<128?f[m++]=x:(x<2048?f[m++]=x>>6|192:(x<65536?f[m++]=x>>12|224:(f[m++]=x>>18|240,f[m++]=x>>12&63|128),f[m++]=x>>6&63|128),f[m++]=63&x|128)}return m}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&vr(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),U(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),U(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var f=this.pos-r;f>=128&&vr(r,f,this),this.pos=r-1,this.writeVarint(f),this.pos+=f},writeMessage:function(e,t,r){this.writeTag(e,Ze.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Ur,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Hr,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,rn,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Jr,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Gr,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,hn,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,jr,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,an,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Zt,t)},writeBytesField:function(e,t){this.writeTag(e,Ze.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Ze.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Ze.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Ze.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Ze.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Ze.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Ze.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Ze.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Ze.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Ze.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var kr=function(e,t){var r=t.pixelRatio,f=t.version,v=t.stretchX,m=t.stretchY,x=t.content;this.paddedRect=e,this.pixelRatio=r,this.stretchX=v,this.stretchY=m,this.content=x,this.version=f},nn={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};nn.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},nn.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},nn.tlbr.get=function(){return this.tl.concat(this.br)},nn.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(kr.prototype,nn);var Xn=function(e,t){var r={},f={};this.haveRenderCallbacks=[];var v=[];this.addImages(e,r,v),this.addImages(t,f,v);var m=un(v),x=new Uo({width:m.w||1,height:m.h||1});for(var A in e){var F=e[A],Z=r[A].paddedRect;Uo.copy(F.data,x,{x:0,y:0},{x:Z.x+1,y:Z.y+1},F.data)}for(var K in t){var q=t[K],ue=f[K].paddedRect,de=ue.x+1,Ge=ue.y+1,Ye=q.data.width,ct=q.data.height;Uo.copy(q.data,x,{x:0,y:0},{x:de,y:Ge},q.data),Uo.copy(q.data,x,{x:0,y:ct-1},{x:de,y:Ge-1},{width:Ye,height:1}),Uo.copy(q.data,x,{x:0,y:0},{x:de,y:Ge+ct},{width:Ye,height:1}),Uo.copy(q.data,x,{x:Ye-1,y:0},{x:de-1,y:Ge},{width:1,height:ct}),Uo.copy(q.data,x,{x:0,y:0},{x:de+Ye,y:Ge},{width:1,height:ct})}this.image=x,this.iconPositions=r,this.patternPositions=f};Xn.prototype.addImages=function(e,t,r){for(var f in e){var v=e[f],m={x:0,y:0,w:v.data.width+2,h:v.data.height+2};r.push(m),t[f]=new kr(m,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(f)}},Xn.prototype.patchUpdatedImages=function(e,t){for(var r in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)},Xn.prototype.patchUpdatedImage=function(e,t,r){if(e&&t&&e.version!==t.version){e.version=t.version;var f=e.tl;r.update(t.data,void 0,{x:f[0],y:f[1]})}},wn("ImagePosition",kr),wn("ImageAtlas",Xn);var Kn={horizontal:1,vertical:2,horizontalOnly:3},sn=function(){this.scale=1,this.fontStack="",this.imageName=null};sn.forText=function(e,t){var r=new sn;return r.scale=e||1,r.fontStack=t,r},sn.forImage=function(e){var t=new sn;return t.imageName=e,t};var Nr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Ir(e,t,r,f,v,m,x,A,F,Z,K,q,ue,de,Ge,Ye){var ct,rt=Nr.fromFeature(e,v);q===Kn.vertical&&rt.verticalizePunctuation();var It=Is.processBidirectionalText,Wt=Is.processStyledBidirectionalText;if(It&&rt.sections.length===1){ct=[];for(var ir=0,dr=It(rt.toString(),fa(rt,Z,m,t,f,de,Ge));ir<dr.length;ir+=1){var Mr=dr[ir],en=new Nr;en.text=Mr,en.sections=rt.sections;for(var dn=0;dn<Mr.length;dn++)en.sectionIndex.push(0);ct.push(en)}}else if(Wt){ct=[];for(var Hn=0,En=Wt(rt.text,rt.sectionIndex,fa(rt,Z,m,t,f,de,Ge));Hn<En.length;Hn+=1){var ei=En[Hn],Tn=new Nr;Tn.text=ei[0],Tn.sectionIndex=ei[1],Tn.sections=rt.sections,ct.push(Tn)}}else ct=function(Bn,ta){for(var Li=[],la=Bn.text,Jn=0,zi=0,uo=ta;zi<uo.length;zi+=1){var lo=uo[zi];Li.push(Bn.substring(Jn,lo)),Jn=lo}return Jn<la.length&&Li.push(Bn.substring(Jn,la.length)),Li}(rt,fa(rt,Z,m,t,f,de,Ge));var Vi=[],mi={positionedLines:Vi,text:rt.toString(),top:K[1],bottom:K[1],left:K[0],right:K[0],writingMode:q,iconsInText:!1,verticalizable:!1};return function(Bn,ta,Li,la,Jn,zi,uo,lo,Go,go,Ho,Bs){for(var ts=0,Cs=-17,Ts=0,iu=0,Wo=lo==="right"?1:lo==="left"?0:.5,Bo=0,na=0,Ia=Jn;na<Ia.length;na+=1){var Da=Ia[na];Da.trim();var pa=Da.getMaxScale(),As=24*(pa-1),au={positionedGlyphs:[],lineOffset:0};Bn.positionedLines[Bo]=au;var yo=au.positionedGlyphs,xs=0;if(Da.length()){for(var _u=0;_u<Da.length();_u++){var Ea=Da.getSection(_u),mf=Da.getSectionIndex(_u),Kl=Da.getCharCode(_u),gf=0,us=null,Cc=null,Al=null,ch=24,Tf=!(Go===Kn.horizontal||!Ho&&!gc(Kl)||Ho&&(si[Kl]||(lc=Kl,$r.Arabic(lc)||$r["Arabic Supplement"](lc)||$r["Arabic Extended-A"](lc)||$r["Arabic Presentation Forms-A"](lc)||$r["Arabic Presentation Forms-B"](lc))));if(Ea.imageName){var $f=la[Ea.imageName];if(!$f)continue;Al=Ea.imageName,Bn.iconsInText=Bn.iconsInText||!0,Cc=$f.paddedRect;var Af=$f.displaySize;Ea.scale=24*Ea.scale/Bs,gf=As+(24-Af[1]*Ea.scale),ch=(us={width:Af[0],height:Af[1],left:1,top:-3,advance:Tf?Af[1]:Af[0]}).advance;var zf=Tf?Af[0]*Ea.scale-24*pa:Af[1]*Ea.scale-24*pa;zf>0&&zf>xs&&(xs=zf)}else{var Gh=Li[Ea.fontStack],fh=Gh&&Gh[Kl];if(fh&&fh.rect)Cc=fh.rect,us=fh.metrics;else{var Jf=ta[Ea.fontStack],Hh=Jf&&Jf[Kl];if(!Hh)continue;us=Hh.metrics}gf=24*(pa-Ea.scale)}Tf?(Bn.verticalizable=!0,yo.push({glyph:Kl,imageName:Al,x:ts,y:Cs+gf,vertical:Tf,scale:Ea.scale,fontStack:Ea.fontStack,sectionIndex:mf,metrics:us,rect:Cc}),ts+=ch*Ea.scale+go):(yo.push({glyph:Kl,imageName:Al,x:ts,y:Cs+gf,vertical:Tf,scale:Ea.scale,fontStack:Ea.fontStack,sectionIndex:mf,metrics:us,rect:Cc}),ts+=us.advance*Ea.scale+go)}yo.length!==0&&(Ts=Math.max(ts-go,Ts),ss(yo,0,yo.length-1,Wo,xs)),ts=0;var Sp=zi*pa+xs;au.lineOffset=Math.max(xs,As),Cs+=Sp,iu=Math.max(Sp,iu),++Bo}else Cs+=zi,++Bo}var lc,hh=Cs- -17,ph=Jo(uo),Pl=ph.horizontalAlign,Zf=ph.verticalAlign;(function(Uf,Wh,dh,qc,Xh,vh,Yh,Kh,Ep){var mh,wp=(Wh-dh)*Xh;mh=vh!==Yh?-Kh*qc- -17:(-qc*Ep+.5)*Yh;for(var gh=0,$h=Uf;gh<$h.length;gh+=1)for(var Pf=0,Qf=$h[gh].positionedGlyphs;Pf<Qf.length;Pf+=1){var yh=Qf[Pf];yh.x+=wp,yh.y+=mh}})(Bn.positionedLines,Wo,Pl,Zf,Ts,iu,zi,hh,Jn.length),Bn.top+=-Zf*hh,Bn.bottom=Bn.top+hh,Bn.left+=-Pl*Ts,Bn.right=Bn.left+Ts}(mi,t,r,f,ct,x,A,F,q,Z,ue,Ye),!function(Bn){for(var ta=0,Li=Bn;ta<Li.length;ta+=1)if(Li[ta].positionedGlyphs.length!==0)return!1;return!0}(Vi)&&mi}Nr.fromFeature=function(e,t){for(var r=new Nr,f=0;f<e.sections.length;f++){var v=e.sections[f];v.image?r.addImageSection(v):r.addTextSection(v,t)}return r},Nr.prototype.length=function(){return this.text.length},Nr.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},Nr.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},Nr.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},Nr.prototype.verticalizePunctuation=function(){this.text=function(e){for(var t="",r=0;r<e.length;r++){var f=e.charCodeAt(r+1)||null,v=e.charCodeAt(r-1)||null;t+=f&&Ju(f)&&!$c[e[r+1]]||v&&Ju(v)&&!$c[e[r-1]]||!$c[e[r]]?e[r]:$c[e[r]]}return t}(this.text)},Nr.prototype.trim=function(){for(var e=0,t=0;t<this.text.length&&si[this.text.charCodeAt(t)];t++)e++;for(var r=this.text.length,f=this.text.length-1;f>=0&&f>=e&&si[this.text.charCodeAt(f)];f--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)},Nr.prototype.substring=function(e,t){var r=new Nr;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r},Nr.prototype.toString=function(){return this.text},Nr.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce(function(t,r){return Math.max(t,e.sections[r].scale)},0)},Nr.prototype.addTextSection=function(e,t){this.text+=e.text,this.sections.push(sn.forText(e.scale,e.fontStack||t));for(var r=this.sections.length-1,f=0;f<e.text.length;++f)this.sectionIndex.push(r)},Nr.prototype.addImageSection=function(e){var t=e.image?e.image.name:"";if(t.length!==0){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(sn.forImage(t)),this.sectionIndex.push(this.sections.length-1)):Ie("Reached maximum number of images 6401")}else Ie("Can't add FormattedSection with an empty image.")},Nr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var si={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ui={};function kn(e,t,r,f,v,m){if(t.imageName){var x=f[t.imageName];return x?x.displaySize[0]*t.scale*24/m+v:0}var A=r[t.fontStack],F=A&&A[e];return F?F.metrics.advance*t.scale+v:0}function ea(e,t,r,f){var v=Math.pow(e-t,2);return f?e<t?v/2:2*v:v+Math.abs(r)*r}function Pi(e,t,r){var f=0;return e===10&&(f-=1e4),r&&(f+=150),e!==40&&e!==65288||(f+=50),t!==41&&t!==65289||(f+=50),f}function ji(e,t,r,f,v,m){for(var x=null,A=ea(t,r,v,m),F=0,Z=f;F<Z.length;F+=1){var K=Z[F],q=ea(t-K.x,r,v,m)+K.badness;q<=A&&(x=K,A=q)}return{index:e,x:t,priorBreak:x,badness:A}}function fa(e,t,r,f,v,m,x){if(m!=="point")return[];if(!e)return[];for(var A,F=[],Z=function(ct,rt,It,Wt,ir,dr){for(var Mr=0,en=0;en<ct.length();en++){var dn=ct.getSection(en);Mr+=kn(ct.getCharCode(en),dn,Wt,ir,rt,dr)}return Mr/Math.max(1,Math.ceil(Mr/It))}(e,t,r,f,v,x),K=e.text.indexOf("\u200B")>=0,q=0,ue=0;ue<e.length();ue++){var de=e.getSection(ue),Ge=e.getCharCode(ue);if(si[Ge]||(q+=kn(Ge,de,f,v,t,x)),ue<e.length()-1){var Ye=!((A=Ge)<11904||!($r["Bopomofo Extended"](A)||$r.Bopomofo(A)||$r["CJK Compatibility Forms"](A)||$r["CJK Compatibility Ideographs"](A)||$r["CJK Compatibility"](A)||$r["CJK Radicals Supplement"](A)||$r["CJK Strokes"](A)||$r["CJK Symbols and Punctuation"](A)||$r["CJK Unified Ideographs Extension A"](A)||$r["CJK Unified Ideographs"](A)||$r["Enclosed CJK Letters and Months"](A)||$r["Halfwidth and Fullwidth Forms"](A)||$r.Hiragana(A)||$r["Ideographic Description Characters"](A)||$r["Kangxi Radicals"](A)||$r["Katakana Phonetic Extensions"](A)||$r.Katakana(A)||$r["Vertical Forms"](A)||$r["Yi Radicals"](A)||$r["Yi Syllables"](A)));(ui[Ge]||Ye||de.imageName)&&F.push(ji(ue+1,q,Z,F,Pi(Ge,e.getCharCode(ue+1),Ye&&K),!1))}}return function ct(rt){return rt?ct(rt.priorBreak).concat(rt.index):[]}(ji(e.length(),q,Z,F,0,!0))}function Jo(e){var t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function ss(e,t,r,f,v){if(f||v)for(var m=e[r],x=(e[r].x+m.metrics.advance*m.scale)*f,A=t;A<=r;A++)e[A].x-=x,e[A].y+=v}function $i(e,t,r,f,v,m){var x,A=e.image;if(A.content){var F=A.content,Z=A.pixelRatio||1;x=[F[0]/Z,F[1]/Z,A.displaySize[0]-F[2]/Z,A.displaySize[1]-F[3]/Z]}var K,q,ue,de,Ge=t.left*m,Ye=t.right*m;r==="width"||r==="both"?(de=v[0]+Ge-f[3],q=v[0]+Ye+f[1]):q=(de=v[0]+(Ge+Ye-A.displaySize[0])/2)+A.displaySize[0];var ct=t.top*m,rt=t.bottom*m;return r==="height"||r==="both"?(K=v[1]+ct-f[0],ue=v[1]+rt+f[2]):ue=(K=v[1]+(ct+rt-A.displaySize[1])/2)+A.displaySize[1],{image:A,top:K,right:q,bottom:ue,left:de,collisionPadding:x}}ui[10]=!0,ui[32]=!0,ui[38]=!0,ui[40]=!0,ui[41]=!0,ui[43]=!0,ui[45]=!0,ui[47]=!0,ui[173]=!0,ui[183]=!0,ui[8203]=!0,ui[8208]=!0,ui[8211]=!0,ui[8231]=!0;var vo=function(e){function t(r,f,v,m){e.call(this,r,f),this.angle=v,m!==void 0&&(this.segment=m)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.clone=function(){return new t(this.x,this.y,this.angle,this.segment)},t}($);function so(e,t){var r=t.expression;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Bi(e+1))};if(r.kind==="source")return{kind:"source"};for(var f=r.zoomStops,v=r.interpolationType,m=0;m<f.length&&f[m]<=e;)m++;for(var x=m=Math.max(0,m-1);x<f.length&&f[x]<e+1;)x++;x=Math.min(f.length-1,x);var A=f[m],F=f[x];return r.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:F,interpolationType:v}:{kind:"camera",minZoom:A,maxZoom:F,minSize:r.evaluate(new Bi(A)),maxSize:r.evaluate(new Bi(F)),interpolationType:v}}function Qo(e,t,r){var f=t.uSize,v=r.lowerSize;return e.kind==="source"?v/128:e.kind==="composite"?ho(v/128,r.upperSize/128,t.uSizeT):f}function ys(e,t){var r=0,f=0;if(e.kind==="constant")f=e.layoutSize;else if(e.kind!=="source"){var v=e.interpolationType,m=v?$e(ba.interpolationFactor(v,t,e.minZoom,e.maxZoom),0,1):0;e.kind==="camera"?f=ho(e.minSize,e.maxSize,m):r=m}return{uSizeT:r,uSize:f}}wn("Anchor",vo);var Es=Object.freeze({__proto__:null,getSizeData:so,evaluateSizeForFeature:Qo,evaluateSizeForZoom:ys,SIZE_PACK_FACTOR:128});function ks(e,t,r,f,v){if(t.segment===void 0)return!0;for(var m=t,x=t.segment+1,A=0;A>-r/2;){if(--x<0)return!1;A-=e[x].dist(m),m=e[x]}A+=e[x].dist(e[x+1]),x++;for(var F=[],Z=0;A<r/2;){var K=e[x],q=e[x+1];if(!q)return!1;var ue=e[x-1].angleTo(K)-K.angleTo(q);for(ue=Math.abs((ue+3*Math.PI)%(2*Math.PI)-Math.PI),F.push({distance:A,angleDelta:ue}),Z+=ue;A-F[0].distance>f;)Z-=F.shift().angleDelta;if(Z>v)return!1;x++,A+=K.dist(q)}return!0}function _s(e){for(var t=0,r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function Fo(e,t,r){return e?.6*t*r:0}function Ni(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Fs(e,t,r,f,v,m){for(var x=Fo(r,v,m),A=Ni(r,f)*m,F=0,Z=_s(e)/2,K=0;K<e.length-1;K++){var q=e[K],ue=e[K+1],de=q.dist(ue);if(F+de>Z){var Ge=(Z-F)/de,Ye=ho(q.x,ue.x,Ge),ct=ho(q.y,ue.y,Ge),rt=new vo(Ye,ct,ue.angleTo(q),K);return rt._round(),!x||ks(e,rt,A,x,t)?rt:void 0}F+=de}}function Sa(e,t,r,f,v,m,x,A,F){var Z=Fo(f,m,x),K=Ni(f,v),q=K*x,ue=e[0].x===0||e[0].x===F||e[0].y===0||e[0].y===F;return t-q<t/4&&(t=q+t/4),function de(Ge,Ye,ct,rt,It,Wt,ir,dr,Mr){for(var en=Wt/2,dn=_s(Ge),Hn=0,En=Ye-ct,ei=[],Tn=0;Tn<Ge.length-1;Tn++){for(var Vi=Ge[Tn],mi=Ge[Tn+1],Bn=Vi.dist(mi),ta=mi.angleTo(Vi);En+ct<Hn+Bn;){var Li=((En+=ct)-Hn)/Bn,la=ho(Vi.x,mi.x,Li),Jn=ho(Vi.y,mi.y,Li);if(la>=0&&la<Mr&&Jn>=0&&Jn<Mr&&En-en>=0&&En+en<=dn){var zi=new vo(la,Jn,ta,Tn);zi._round(),rt&&!ks(Ge,zi,Wt,rt,It)||ei.push(zi)}}Hn+=Bn}return dr||ei.length||ir||(ei=de(Ge,Hn/2,ct,rt,It,Wt,ir,!0,Mr)),ei}(e,ue?t/2*A%t:(K/2+2*m)*x*A%t,t,Z,r,q,ue,!1,F)}function li(e,t,r,f,v){for(var m=[],x=0;x<e.length;x++)for(var A=e[x],F=void 0,Z=0;Z<A.length-1;Z++){var K=A[Z],q=A[Z+1];K.x<t&&q.x<t||(K.x<t?K=new $(t,K.y+(t-K.x)/(q.x-K.x)*(q.y-K.y))._round():q.x<t&&(q=new $(t,K.y+(t-K.x)/(q.x-K.x)*(q.y-K.y))._round()),K.y<r&&q.y<r||(K.y<r?K=new $(K.x+(r-K.y)/(q.y-K.y)*(q.x-K.x),r)._round():q.y<r&&(q=new $(K.x+(r-K.y)/(q.y-K.y)*(q.x-K.x),r)._round()),K.x>=f&&q.x>=f||(K.x>=f?K=new $(f,K.y+(f-K.x)/(q.x-K.x)*(q.y-K.y))._round():q.x>=f&&(q=new $(f,K.y+(f-K.x)/(q.x-K.x)*(q.y-K.y))._round()),K.y>=v&&q.y>=v||(K.y>=v?K=new $(K.x+(v-K.y)/(q.y-K.y)*(q.x-K.x),v)._round():q.y>=v&&(q=new $(K.x+(v-K.y)/(q.y-K.y)*(q.x-K.x),v)._round()),F&&K.equals(F[F.length-1])||m.push(F=[K]),F.push(q)))))}return m}function Wi(e,t,r,f){var v=[],m=e.image,x=m.pixelRatio,A=m.paddedRect.w-2,F=m.paddedRect.h-2,Z=e.right-e.left,K=e.bottom-e.top,q=m.stretchX||[[0,A]],ue=m.stretchY||[[0,F]],de=function(la,Jn){return la+Jn[1]-Jn[0]},Ge=q.reduce(de,0),Ye=ue.reduce(de,0),ct=A-Ge,rt=F-Ye,It=0,Wt=Ge,ir=0,dr=Ye,Mr=0,en=ct,dn=0,Hn=rt;if(m.content&&f){var En=m.content;It=oa(q,0,En[0]),ir=oa(ue,0,En[1]),Wt=oa(q,En[0],En[2]),dr=oa(ue,En[1],En[3]),Mr=En[0]-It,dn=En[1]-ir,en=En[2]-En[0]-Wt,Hn=En[3]-En[1]-dr}var ei=function(la,Jn,zi,uo){var lo=El(la.stretch-It,Wt,Z,e.left),Go=wl(la.fixed-Mr,en,la.stretch,Ge),go=El(Jn.stretch-ir,dr,K,e.top),Ho=wl(Jn.fixed-dn,Hn,Jn.stretch,Ye),Bs=El(zi.stretch-It,Wt,Z,e.left),ts=wl(zi.fixed-Mr,en,zi.stretch,Ge),Cs=El(uo.stretch-ir,dr,K,e.top),Ts=wl(uo.fixed-dn,Hn,uo.stretch,Ye),iu=new $(lo,go),Wo=new $(Bs,go),Bo=new $(Bs,Cs),na=new $(lo,Cs),Ia=new $(Go/x,Ho/x),Da=new $(ts/x,Ts/x),pa=t*Math.PI/180;if(pa){var As=Math.sin(pa),au=Math.cos(pa),yo=[au,-As,As,au];iu._matMult(yo),Wo._matMult(yo),na._matMult(yo),Bo._matMult(yo)}var xs=la.stretch+la.fixed,_u=Jn.stretch+Jn.fixed;return{tl:iu,tr:Wo,bl:na,br:Bo,tex:{x:m.paddedRect.x+1+xs,y:m.paddedRect.y+1+_u,w:zi.stretch+zi.fixed-xs,h:uo.stretch+uo.fixed-_u},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ia,pixelOffsetBR:Da,minFontScaleX:en/x/Z,minFontScaleY:Hn/x/K,isSDF:r}};if(f&&(m.stretchX||m.stretchY))for(var Tn=qo(q,ct,Ge),Vi=qo(ue,rt,Ye),mi=0;mi<Tn.length-1;mi++)for(var Bn=Tn[mi],ta=Tn[mi+1],Li=0;Li<Vi.length-1;Li++)v.push(ei(Bn,Vi[Li],ta,Vi[Li+1]));else v.push(ei({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:F+1}));return v}function oa(e,t,r){for(var f=0,v=0,m=e;v<m.length;v+=1){var x=m[v];f+=Math.max(t,Math.min(r,x[1]))-Math.max(t,Math.min(r,x[0]))}return f}function qo(e,t,r){for(var f=[{fixed:-1,stretch:0}],v=0,m=e;v<m.length;v+=1){var x=m[v],A=x[0],F=x[1],Z=f[f.length-1];f.push({fixed:A-Z.stretch,stretch:Z.stretch}),f.push({fixed:A-Z.stretch,stretch:Z.stretch+(F-A)})}return f.push({fixed:t+1,stretch:r}),f}function El(e,t,r,f){return e/t*r+f}function wl(e,t,r,f){return e-t*r/f}var Ve=function(e,t,r,f,v,m,x,A,F,Z){if(this.boxStartIndex=e.length,F){var K=m.top,q=m.bottom,ue=m.collisionPadding;ue&&(K-=ue[1],q+=ue[3]);var de=q-K;de>0&&(de=Math.max(10,de),this.circleDiameter=de)}else{var Ge=m.top*x-A,Ye=m.bottom*x+A,ct=m.left*x-A,rt=m.right*x+A,It=m.collisionPadding;if(It&&(ct-=It[0]*x,Ge-=It[1]*x,rt+=It[2]*x,Ye+=It[3]*x),Z){var Wt=new $(ct,Ge),ir=new $(rt,Ge),dr=new $(ct,Ye),Mr=new $(rt,Ye),en=Z*Math.PI/180;Wt._rotate(en),ir._rotate(en),dr._rotate(en),Mr._rotate(en),ct=Math.min(Wt.x,ir.x,dr.x,Mr.x),rt=Math.max(Wt.x,ir.x,dr.x,Mr.x),Ge=Math.min(Wt.y,ir.y,dr.y,Mr.y),Ye=Math.max(Wt.y,ir.y,dr.y,Mr.y)}e.emplaceBack(t.x,t.y,ct,Ge,rt,Ye,r,f,v)}this.boxEndIndex=e.length},qt=function(e,t){if(e===void 0&&(e=[]),t===void 0&&(t=Kt),this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function Kt(e,t){return e<t?-1:e>t?1:0}function Cn(e,t,r){t===void 0&&(t=1),r===void 0&&(r=!1);for(var f=1/0,v=1/0,m=-1/0,x=-1/0,A=e[0],F=0;F<A.length;F++){var Z=A[F];(!F||Z.x<f)&&(f=Z.x),(!F||Z.y<v)&&(v=Z.y),(!F||Z.x>m)&&(m=Z.x),(!F||Z.y>x)&&(x=Z.y)}var K=Math.min(m-f,x-v),q=K/2,ue=new qt([],Xi);if(K===0)return new $(f,v);for(var de=f;de<m;de+=K)for(var Ge=v;Ge<x;Ge+=K)ue.push(new Re(de+q,Ge+q,q,e));for(var Ye=function(It){for(var Wt=0,ir=0,dr=0,Mr=It[0],en=0,dn=Mr.length,Hn=dn-1;en<dn;Hn=en++){var En=Mr[en],ei=Mr[Hn],Tn=En.x*ei.y-ei.x*En.y;ir+=(En.x+ei.x)*Tn,dr+=(En.y+ei.y)*Tn,Wt+=3*Tn}return new Re(ir/Wt,dr/Wt,0,It)}(e),ct=ue.length;ue.length;){var rt=ue.pop();(rt.d>Ye.d||!Ye.d)&&(Ye=rt,r&&console.log("found best %d after %d probes",Math.round(1e4*rt.d)/1e4,ct)),rt.max-Ye.d<=t||(ue.push(new Re(rt.p.x-(q=rt.h/2),rt.p.y-q,q,e)),ue.push(new Re(rt.p.x+q,rt.p.y-q,q,e)),ue.push(new Re(rt.p.x-q,rt.p.y+q,q,e)),ue.push(new Re(rt.p.x+q,rt.p.y+q,q,e)),ct+=4)}return r&&(console.log("num probes: "+ct),console.log("best distance: "+Ye.d)),Ye.p}function Xi(e,t){return t.max-e.max}function Re(e,t,r,f){this.p=new $(e,t),this.h=r,this.d=function(v,m){for(var x=!1,A=1/0,F=0;F<m.length;F++)for(var Z=m[F],K=0,q=Z.length,ue=q-1;K<q;ue=K++){var de=Z[K],Ge=Z[ue];de.y>v.y!=Ge.y>v.y&&v.x<(Ge.x-de.x)*(v.y-de.y)/(Ge.y-de.y)+de.x&&(x=!x),A=Math.min(A,tu(v,de,Ge))}return(x?1:-1)*Math.sqrt(A)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}qt.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},qt.prototype.pop=function(){if(this.length!==0){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},qt.prototype.peek=function(){return this.data[0]},qt.prototype._up=function(e){for(var t=this.data,r=this.compare,f=t[e];e>0;){var v=e-1>>1,m=t[v];if(r(f,m)>=0)break;t[e]=m,e=v}t[e]=f},qt.prototype._down=function(e){for(var t=this.data,r=this.compare,f=this.length>>1,v=t[e];e<f;){var m=1+(e<<1),x=t[m],A=m+1;if(A<this.length&&r(t[A],x)<0&&(m=A,x=t[A]),r(x,v)>=0)break;t[e]=x,e=m}t[e]=v};var xe=Number.POSITIVE_INFINITY;function ot(e,t){return t[1]!==xe?function(r,f,v){var m=0,x=0;switch(f=Math.abs(f),v=Math.abs(v),r){case"top-right":case"top-left":case"top":x=v-7;break;case"bottom-right":case"bottom-left":case"bottom":x=7-v}switch(r){case"top-right":case"bottom-right":case"right":m=-f;break;case"top-left":case"bottom-left":case"left":m=f}return[m,x]}(e,t[0],t[1]):function(r,f){var v=0,m=0;f<0&&(f=0);var x=f/Math.sqrt(2);switch(r){case"top-right":case"top-left":m=x-7;break;case"bottom-right":case"bottom-left":m=7-x;break;case"bottom":m=7-f;break;case"top":m=f-7}switch(r){case"top-right":case"bottom-right":v=-x;break;case"top-left":case"bottom-left":v=x;break;case"left":v=f;break;case"right":v=-f}return[v,m]}(e,t[0])}function Dt(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Mt(e,t,r,f,v,m,x,A,F,Z,K,q,ue,de,Ge){var Ye=function(ir,dr,Mr,en,dn,Hn,En,ei){for(var Tn=en.layout.get("text-rotate").evaluate(Hn,{})*Math.PI/180,Vi=[],mi=0,Bn=dr.positionedLines;mi<Bn.length;mi+=1)for(var ta=Bn[mi],Li=0,la=ta.positionedGlyphs;Li<la.length;Li+=1){var Jn=la[Li];if(Jn.rect){var zi=Jn.rect||{},uo=4,lo=!0,Go=1,go=0,Ho=(dn||ei)&&Jn.vertical,Bs=Jn.metrics.advance*Jn.scale/2;if(ei&&dr.verticalizable&&(go=ta.lineOffset/2-(Jn.imageName?-(24-Jn.metrics.width*Jn.scale)/2:24*(Jn.scale-1))),Jn.imageName){var ts=En[Jn.imageName];lo=ts.sdf,uo=1/(Go=ts.pixelRatio)}var Cs=dn?[Jn.x+Bs,Jn.y]:[0,0],Ts=dn?[0,0]:[Jn.x+Bs+Mr[0],Jn.y+Mr[1]-go],iu=[0,0];Ho&&(iu=Ts,Ts=[0,0]);var Wo=(Jn.metrics.left-uo)*Jn.scale-Bs+Ts[0],Bo=(-Jn.metrics.top-uo)*Jn.scale+Ts[1],na=Wo+zi.w*Jn.scale/Go,Ia=Bo+zi.h*Jn.scale/Go,Da=new $(Wo,Bo),pa=new $(na,Bo),As=new $(Wo,Ia),au=new $(na,Ia);if(Ho){var yo=new $(-Bs,Bs- -17),xs=-Math.PI/2,_u=12-Bs,Ea=new $(22-_u,-(Jn.imageName?_u:0)),mf=new(Function.prototype.bind.apply($,[null].concat(iu)));Da._rotateAround(xs,yo)._add(Ea)._add(mf),pa._rotateAround(xs,yo)._add(Ea)._add(mf),As._rotateAround(xs,yo)._add(Ea)._add(mf),au._rotateAround(xs,yo)._add(Ea)._add(mf)}if(Tn){var Kl=Math.sin(Tn),gf=Math.cos(Tn),us=[gf,-Kl,Kl,gf];Da._matMult(us),pa._matMult(us),As._matMult(us),au._matMult(us)}var Cc=new $(0,0),Al=new $(0,0);Vi.push({tl:Da,tr:pa,bl:As,br:au,tex:zi,writingMode:dr.writingMode,glyphOffset:Cs,sectionIndex:Jn.sectionIndex,isSDF:lo,pixelOffsetTL:Cc,pixelOffsetBR:Al,minFontScaleX:0,minFontScaleY:0})}}return Vi}(0,r,A,v,m,x,f,e.allowVerticalPlacement),ct=e.textSizeData,rt=null;ct.kind==="source"?(rt=[128*v.layout.get("text-size").evaluate(x,{})])[0]>32640&&Ie(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):ct.kind==="composite"&&((rt=[128*de.compositeTextSizes[0].evaluate(x,{},Ge),128*de.compositeTextSizes[1].evaluate(x,{},Ge)])[0]>32640||rt[1]>32640)&&Ie(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,Ye,rt,A,m,x,Z,t,F.lineStartIndex,F.lineLength,ue,Ge);for(var It=0,Wt=K;It<Wt.length;It+=1)q[Wt[It]]=e.text.placedSymbolArray.length-1;return 4*Ye.length}function ft(e){for(var t in e)return e[t];return null}function st(e,t,r,f){var v=e.compareText;if(t in v){for(var m=v[t],x=m.length-1;x>=0;x--)if(f.dist(m[x])<r)return!0}else v[t]=[];return v[t].push(f),!1}var Et=Kc.VectorTileFeature.types,ke=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function nt(e,t,r,f,v,m,x,A,F,Z,K,q,ue){var de=A?Math.min(32640,Math.round(A[0])):0,Ge=A?Math.min(32640,Math.round(A[1])):0;e.emplaceBack(t,r,Math.round(32*f),Math.round(32*v),m,x,(de<<1)+(F?1:0),Ge,16*Z,16*K,256*q,256*ue)}function Oe(e,t,r){e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r)}function Tt(e){for(var t=0,r=e.sections;t<r.length;t+=1)if(Nc(r[t].text))return!0;return!1}var jt=function(e){this.layoutVertexArray=new xc,this.indexArray=new gl,this.programConfigurations=e,this.segments=new ye,this.dynamicLayoutVertexArray=new jl,this.opacityVertexArray=new sc,this.placedSymbolArray=new h};jt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},jt.prototype.upload=function(e,t,r,f){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Bh.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ke,!0),this.opacityVertexBuffer.itemSize=1),(r||f)&&this.programConfigurations.upload(e))},jt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},wn("SymbolBuffers",jt);var Er=function(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new ye,this.collisionVertexArray=new Vc};Er.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Nh.members,!0)},Er.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},wn("CollisionBuffers",Er);var $t=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(m){return m.id}),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ao([]),this.placementViewportMatrix=ao([]);var t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=so(this.zoom,t["text-size"]),this.iconSizeData=so(this.zoom,t["icon-size"]);var r=this.layers[0].layout,f=r.get("symbol-sort-key"),v=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,r.get("symbol-placement")==="point"&&(this.writingModes=r.get("text-writing-mode").map(function(m){return Kn[m]})),this.stateDependentLayerIds=this.layers.filter(function(m){return m.isStateDependent()}).map(function(m){return m.id}),this.sourceID=e.sourceID};$t.prototype.createArrays=function(){this.text=new jt(new ri(this.layers,this.zoom,function(e){return/^text/.test(e)})),this.icon=new jt(new ri(this.layers,this.zoom,function(e){return/^icon/.test(e)})),this.glyphOffsetArray=new T,this.lineVertexArray=new R,this.symbolInstances=new S},$t.prototype.calculateGlyphDependencies=function(e,t,r,f,v){for(var m=0;m<e.length;m++)if(t[e.charCodeAt(m)]=!0,(r||f)&&v){var x=$c[e.charAt(m)];x&&(t[x.charCodeAt(0)]=!0)}},$t.prototype.populate=function(e,t,r){var f=this.layers[0],v=f.layout,m=v.get("text-font"),x=v.get("text-field"),A=v.get("icon-image"),F=(x.value.kind!=="constant"||x.value.value instanceof _a&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),Z=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,K=v.get("symbol-sort-key");if(this.features=[],F||Z){for(var q=t.iconDependencies,ue=t.glyphDependencies,de=t.availableImages,Ge=new Bi(this.zoom),Ye=0,ct=e;Ye<ct.length;Ye+=1){var rt=ct[Ye],It=rt.feature,Wt=rt.id,ir=rt.index,dr=rt.sourceLayerIndex,Mr=f._featureFilter.needGeometry,en=no(It,Mr);if(f._featureFilter.filter(Ge,en,r)){Mr||(en.geometry=Ga(It));var dn=void 0;if(F){var Hn=f.getValueAndResolveTokens("text-field",en,r,de),En=_a.factory(Hn);Tt(En)&&(this.hasRTLText=!0),(!this.hasRTLText||yc()==="unavailable"||this.hasRTLText&&Is.isParsed())&&(dn=zh(En,f,en))}var ei=void 0;if(Z){var Tn=f.getValueAndResolveTokens("icon-image",en,r,de);ei=Tn instanceof da?Tn:da.fromString(Tn)}if(dn||ei){var Vi=this.sortFeaturesByKey?K.evaluate(en,{},r):void 0;if(this.features.push({id:Wt,text:dn,icon:ei,index:ir,sourceLayerIndex:dr,geometry:en.geometry,properties:It.properties,type:Et[It.type],sortKey:Vi}),ei&&(q[ei.name]=!0),dn){var mi=m.evaluate(en,{},r).join(","),Bn=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Kn.vertical)>=0;for(var ta=0,Li=dn.sections;ta<Li.length;ta+=1){var la=Li[ta];if(la.image)q[la.image.name]=!0;else{var Jn=Bc(dn.toString()),zi=la.fontStack||mi,uo=ue[zi]=ue[zi]||{};this.calculateGlyphDependencies(la.text,uo,Bn,this.allowVerticalPlacement,Jn)}}}}}}v.get("symbol-placement")==="line"&&(this.features=function(lo){var Go={},go={},Ho=[],Bs=0;function ts(yo){Ho.push(lo[yo]),Bs++}function Cs(yo,xs,_u){var Ea=go[yo];return delete go[yo],go[xs]=Ea,Ho[Ea].geometry[0].pop(),Ho[Ea].geometry[0]=Ho[Ea].geometry[0].concat(_u[0]),Ea}function Ts(yo,xs,_u){var Ea=Go[xs];return delete Go[xs],Go[yo]=Ea,Ho[Ea].geometry[0].shift(),Ho[Ea].geometry[0]=_u[0].concat(Ho[Ea].geometry[0]),Ea}function iu(yo,xs,_u){var Ea=_u?xs[0][xs[0].length-1]:xs[0][0];return yo+":"+Ea.x+":"+Ea.y}for(var Wo=0;Wo<lo.length;Wo++){var Bo=lo[Wo],na=Bo.geometry,Ia=Bo.text?Bo.text.toString():null;if(Ia){var Da=iu(Ia,na),pa=iu(Ia,na,!0);if(Da in go&&pa in Go&&go[Da]!==Go[pa]){var As=Ts(Da,pa,na),au=Cs(Da,pa,Ho[As].geometry);delete Go[Da],delete go[pa],go[iu(Ia,Ho[au].geometry,!0)]=au,Ho[As].geometry=null}else Da in go?Cs(Da,pa,na):pa in Go?Ts(Da,pa,na):(ts(Wo),Go[Da]=Bs-1,go[pa]=Bs-1)}else ts(Wo)}return Ho.filter(function(yo){return yo.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(lo,Go){return lo.sortKey-Go.sortKey})}},$t.prototype.update=function(e,t,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r))},$t.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},$t.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},$t.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},$t.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},$t.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},$t.prototype.addToLineVertexArray=function(e,t){var r=this.lineVertexArray.length;if(e.segment!==void 0){for(var f=e.dist(t[e.segment+1]),v=e.dist(t[e.segment]),m={},x=e.segment+1;x<t.length;x++)m[x]={x:t[x].x,y:t[x].y,tileUnitDistanceFromAnchor:f},x<t.length-1&&(f+=t[x+1].dist(t[x]));for(var A=e.segment||0;A>=0;A--)m[A]={x:t[A].x,y:t[A].y,tileUnitDistanceFromAnchor:v},A>0&&(v+=t[A-1].dist(t[A]));for(var F=0;F<t.length;F++){var Z=m[F];this.lineVertexArray.emplaceBack(Z.x,Z.y,Z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},$t.prototype.addSymbols=function(e,t,r,f,v,m,x,A,F,Z,K,q){for(var ue=e.indexArray,de=e.layoutVertexArray,Ge=e.segments.prepareSegment(4*t.length,de,ue,this.canOverlap?m.sortKey:void 0),Ye=this.glyphOffsetArray.length,ct=Ge.vertexLength,rt=this.allowVerticalPlacement&&x===Kn.vertical?Math.PI/2:0,It=m.text&&m.text.sections,Wt=0;Wt<t.length;Wt++){var ir=t[Wt],dr=ir.tl,Mr=ir.tr,en=ir.bl,dn=ir.br,Hn=ir.tex,En=ir.pixelOffsetTL,ei=ir.pixelOffsetBR,Tn=ir.minFontScaleX,Vi=ir.minFontScaleY,mi=ir.glyphOffset,Bn=ir.isSDF,ta=ir.sectionIndex,Li=Ge.vertexLength,la=mi[1];nt(de,A.x,A.y,dr.x,la+dr.y,Hn.x,Hn.y,r,Bn,En.x,En.y,Tn,Vi),nt(de,A.x,A.y,Mr.x,la+Mr.y,Hn.x+Hn.w,Hn.y,r,Bn,ei.x,En.y,Tn,Vi),nt(de,A.x,A.y,en.x,la+en.y,Hn.x,Hn.y+Hn.h,r,Bn,En.x,ei.y,Tn,Vi),nt(de,A.x,A.y,dn.x,la+dn.y,Hn.x+Hn.w,Hn.y+Hn.h,r,Bn,ei.x,ei.y,Tn,Vi),Oe(e.dynamicLayoutVertexArray,A,rt),ue.emplaceBack(Li,Li+1,Li+2),ue.emplaceBack(Li+1,Li+2,Li+3),Ge.vertexLength+=4,Ge.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(mi[0]),Wt!==t.length-1&&ta===t[Wt+1].sectionIndex||e.programConfigurations.populatePaintArrays(de.length,m,m.index,{},q,It&&It[ta])}e.placedSymbolArray.emplaceBack(A.x,A.y,Ye,this.glyphOffsetArray.length-Ye,ct,F,Z,A.segment,r?r[0]:0,r?r[1]:0,f[0],f[1],x,0,!1,0,K)},$t.prototype._addCollisionDebugVertex=function(e,t,r,f,v,m){return t.emplaceBack(0,0),e.emplaceBack(r.x,r.y,f,v,Math.round(m.x),Math.round(m.y))},$t.prototype.addCollisionDebugVertices=function(e,t,r,f,v,m,x){var A=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),F=A.vertexLength,Z=v.layoutVertexArray,K=v.collisionVertexArray,q=x.anchorX,ue=x.anchorY;this._addCollisionDebugVertex(Z,K,m,q,ue,new $(e,t)),this._addCollisionDebugVertex(Z,K,m,q,ue,new $(r,t)),this._addCollisionDebugVertex(Z,K,m,q,ue,new $(r,f)),this._addCollisionDebugVertex(Z,K,m,q,ue,new $(e,f)),A.vertexLength+=4;var de=v.indexArray;de.emplaceBack(F,F+1),de.emplaceBack(F+1,F+2),de.emplaceBack(F+2,F+3),de.emplaceBack(F+3,F),A.primitiveLength+=4},$t.prototype.addDebugCollisionBoxes=function(e,t,r,f){for(var v=e;v<t;v++){var m=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,f?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,r)}},$t.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Er(uc,Kf.members,bc),this.iconCollisionBox=new Er(uc,Kf.members,bc);for(var e=0;e<this.symbolInstances.length;e++){var t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}},$t.prototype._deserializeCollisionBoxesForSymbol=function(e,t,r,f,v,m,x,A,F){for(var Z={},K=t;K<r;K++){var q=e.get(K);Z.textBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},Z.textFeatureIndex=q.featureIndex;break}for(var ue=f;ue<v;ue++){var de=e.get(ue);Z.verticalTextBox={x1:de.x1,y1:de.y1,x2:de.x2,y2:de.y2,anchorPointX:de.anchorPointX,anchorPointY:de.anchorPointY},Z.verticalTextFeatureIndex=de.featureIndex;break}for(var Ge=m;Ge<x;Ge++){var Ye=e.get(Ge);Z.iconBox={x1:Ye.x1,y1:Ye.y1,x2:Ye.x2,y2:Ye.y2,anchorPointX:Ye.anchorPointX,anchorPointY:Ye.anchorPointY},Z.iconFeatureIndex=Ye.featureIndex;break}for(var ct=A;ct<F;ct++){var rt=e.get(ct);Z.verticalIconBox={x1:rt.x1,y1:rt.y1,x2:rt.x2,y2:rt.y2,anchorPointX:rt.anchorPointX,anchorPointY:rt.anchorPointY},Z.verticalIconFeatureIndex=rt.featureIndex;break}return Z},$t.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}},$t.prototype.hasTextData=function(){return this.text.segments.get().length>0},$t.prototype.hasIconData=function(){return this.icon.segments.get().length>0},$t.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},$t.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},$t.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},$t.prototype.addIndicesForPlacedSymbol=function(e,t){for(var r=e.placedSymbolArray.get(t),f=r.vertexStartIndex+4*r.numGlyphs,v=r.vertexStartIndex;v<f;v+=4)e.indexArray.emplaceBack(v,v+1,v+2),e.indexArray.emplaceBack(v+1,v+2,v+3)},$t.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var t=Math.sin(e),r=Math.cos(e),f=[],v=[],m=[],x=0;x<this.symbolInstances.length;++x){m.push(x);var A=this.symbolInstances.get(x);f.push(0|Math.round(t*A.anchorX+r*A.anchorY)),v.push(A.featureIndex)}return m.sort(function(F,Z){return f[F]-f[Z]||v[Z]-v[F]}),m},$t.prototype.addToSortKeyRanges=function(e,t){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})},$t.prototype.sortFeatures=function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,f=this.symbolInstanceIndexes;r<f.length;r+=1){var v=this.symbolInstances.get(f[r]);this.featureSortOrder.push(v.featureIndex),[v.rightJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.leftJustifiedTextSymbolIndex].forEach(function(m,x,A){m>=0&&A.indexOf(m)===x&&t.addIndicesForPlacedSymbol(t.text,m)}),v.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,v.verticalPlacedTextSymbolIndex),v.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.placedIconSymbolIndex),v.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},wn("SymbolBucket",$t,{omit:["layers","collisionBoxArray","features","compareText"]}),$t.MAX_GLYPHS=65535,$t.addDynamicAttributes=Oe;var xr=new zo({"symbol-placement":new Un(te.layout_symbol["symbol-placement"]),"symbol-spacing":new Un(te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Un(te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new On(te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Un(te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Un(te.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Un(te.layout_symbol["icon-ignore-placement"]),"icon-optional":new Un(te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Un(te.layout_symbol["icon-rotation-alignment"]),"icon-size":new On(te.layout_symbol["icon-size"]),"icon-text-fit":new Un(te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Un(te.layout_symbol["icon-text-fit-padding"]),"icon-image":new On(te.layout_symbol["icon-image"]),"icon-rotate":new On(te.layout_symbol["icon-rotate"]),"icon-padding":new Un(te.layout_symbol["icon-padding"]),"icon-keep-upright":new Un(te.layout_symbol["icon-keep-upright"]),"icon-offset":new On(te.layout_symbol["icon-offset"]),"icon-anchor":new On(te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Un(te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Un(te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Un(te.layout_symbol["text-rotation-alignment"]),"text-field":new On(te.layout_symbol["text-field"]),"text-font":new On(te.layout_symbol["text-font"]),"text-size":new On(te.layout_symbol["text-size"]),"text-max-width":new On(te.layout_symbol["text-max-width"]),"text-line-height":new Un(te.layout_symbol["text-line-height"]),"text-letter-spacing":new On(te.layout_symbol["text-letter-spacing"]),"text-justify":new On(te.layout_symbol["text-justify"]),"text-radial-offset":new On(te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Un(te.layout_symbol["text-variable-anchor"]),"text-anchor":new On(te.layout_symbol["text-anchor"]),"text-max-angle":new Un(te.layout_symbol["text-max-angle"]),"text-writing-mode":new Un(te.layout_symbol["text-writing-mode"]),"text-rotate":new On(te.layout_symbol["text-rotate"]),"text-padding":new Un(te.layout_symbol["text-padding"]),"text-keep-upright":new Un(te.layout_symbol["text-keep-upright"]),"text-transform":new On(te.layout_symbol["text-transform"]),"text-offset":new On(te.layout_symbol["text-offset"]),"text-allow-overlap":new Un(te.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Un(te.layout_symbol["text-ignore-placement"]),"text-optional":new Un(te.layout_symbol["text-optional"])}),Yr={paint:new zo({"icon-opacity":new On(te.paint_symbol["icon-opacity"]),"icon-color":new On(te.paint_symbol["icon-color"]),"icon-halo-color":new On(te.paint_symbol["icon-halo-color"]),"icon-halo-width":new On(te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new On(te.paint_symbol["icon-halo-blur"]),"icon-translate":new Un(te.paint_symbol["icon-translate"]),"icon-translate-anchor":new Un(te.paint_symbol["icon-translate-anchor"]),"text-opacity":new On(te.paint_symbol["text-opacity"]),"text-color":new On(te.paint_symbol["text-color"],{runtimeType:ln,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new On(te.paint_symbol["text-halo-color"]),"text-halo-width":new On(te.paint_symbol["text-halo-width"]),"text-halo-blur":new On(te.paint_symbol["text-halo-blur"]),"text-translate":new Un(te.paint_symbol["text-translate"]),"text-translate-anchor":new Un(te.paint_symbol["text-translate-anchor"])}),layout:xr},zn=function(e){this.type=e.property.overrides?e.property.overrides.runtimeType:gn,this.defaultValue=e};zn.prototype.evaluate=function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},zn.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},zn.prototype.outputDefined=function(){return!1},zn.prototype.serialize=function(){return null},wn("FormatSectionOverride",zn,{omit:["defaultValue"]});var Ii=function(e){function t(r){e.call(this,r,Yr)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){if(e.prototype.recalculate.call(this,r,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var v=this.layout.get("text-writing-mode");if(v){for(var m=[],x=0,A=v;x<A.length;x+=1){var F=A[x];m.indexOf(F)<0&&m.push(F)}this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},t.prototype.getValueAndResolveTokens=function(r,f,v,m){var x=this.layout.get(r).evaluate(f,{},v,m),A=this._unevaluatedLayout._values[r];return A.isDataDriven()||wu(A.value)||!x?x:function(F,Z){return Z.replace(/{([^{}]+)}/g,function(K,q){return q in F?String(F[q]):""})}(f.properties,x)},t.prototype.createBucket=function(r){return new $t(r)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype._setPaintOverrides=function(){for(var r=0,f=Yr.paint.overridableProperties;r<f.length;r+=1){var v=f[r];if(t.hasPaintOverride(this.layout,v)){var m,x=this.paint.get(v),A=new zn(x),F=new cl(A,x.property.specification);m=x.value.kind==="constant"||x.value.kind==="source"?new fl("source",F):new uu("composite",F,x.value.zoomStops,x.value._interpolationType),this.paint._values[v]=new is(x.property,m,x.parameters)}}},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!(!this.layout||f.isDataDriven()||v.isDataDriven())&&t.hasPaintOverride(this.layout,r)},t.hasPaintOverride=function(r,f){var v=r.get("text-field"),m=Yr.paint.properties[f],x=!1,A=function(K){for(var q=0,ue=K;q<ue.length;q+=1)if(m.overrides&&m.overrides.hasOverride(ue[q]))return void(x=!0)};if(v.value.kind==="constant"&&v.value.value instanceof _a)A(v.value.value.sections);else if(v.value.kind==="source"){var F=function(K){x||(K instanceof Ka&&gi(K.value)===Yi?A(K.value.sections):K instanceof Oo?A(K.sections):K.eachChild(F))},Z=v.value;Z._styleExpression&&F(Z._styleExpression.expression)}return x},t}(ku),In={paint:new zo({"background-color":new Un(te.paint_background["background-color"]),"background-pattern":new ps(te.paint_background["background-pattern"]),"background-opacity":new Un(te.paint_background["background-opacity"])})},$n=function(e){function t(r){e.call(this,r,In)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(ku),Oi={paint:new zo({"raster-opacity":new Un(te.paint_raster["raster-opacity"]),"raster-hue-rotate":new Un(te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Un(te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Un(te.paint_raster["raster-brightness-max"]),"raster-saturation":new Un(te.paint_raster["raster-saturation"]),"raster-contrast":new Un(te.paint_raster["raster-contrast"]),"raster-resampling":new Un(te.paint_raster["raster-resampling"]),"raster-fade-duration":new Un(te.paint_raster["raster-fade-duration"])})},ha=function(e){function t(r){e.call(this,r,Oi)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(ku),Co=function(e){function t(r){e.call(this,r,{}),this.implementation=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},t.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},t.prototype.recalculate=function(){},t.prototype.updateTransitions=function(){},t.prototype.hasTransition=function(){},t.prototype.serialize=function(){},t.prototype.onAdd=function(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},t.prototype.onRemove=function(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},t}(ku),yu={circle:rl,heatmap:Sl,hillshade:Wc,fill:jp,"fill-extrusion":gu,line:dp,symbol:Ii,background:$n,raster:ha},Df=k.HTMLImageElement,Cl=k.HTMLCanvasElement,sh=k.HTMLVideoElement,Tl=k.ImageData,kf=k.ImageBitmap,Ff=function(e,t,r,f){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,f)};Ff.prototype.update=function(e,t,r){var f=e.width,v=e.height,m=!(this.size&&this.size[0]===f&&this.size[1]===v||r),x=this.context,A=x.gl;if(this.useMipmap=Boolean(t&&t.useMipmap),A.bindTexture(A.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!t||t.premultiply!==!1)),m)this.size=[f,v],e instanceof Df||e instanceof Cl||e instanceof sh||e instanceof Tl||kf&&e instanceof kf?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,e):A.texImage2D(A.TEXTURE_2D,0,this.format,f,v,0,this.format,A.UNSIGNED_BYTE,e.data);else{var F=r||{x:0,y:0},Z=F.x,K=F.y;e instanceof Df||e instanceof Cl||e instanceof sh||e instanceof Tl||kf&&e instanceof kf?A.texSubImage2D(A.TEXTURE_2D,0,Z,K,A.RGBA,A.UNSIGNED_BYTE,e):A.texSubImage2D(A.TEXTURE_2D,0,Z,K,f,v,A.RGBA,A.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&A.generateMipmap(A.TEXTURE_2D)},Ff.prototype.bind=function(e,t,r){var f=this.context.gl;f.bindTexture(f.TEXTURE_2D,this.texture),r!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,r||e),this.filter=e),t!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,t),this.wrap=t)},Ff.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Ff.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var uh=function(e){var t=this;this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){t._triggered=!1,t._callback()})};uh.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){e._triggered=!1,e._callback()},0))},uh.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Bf=function(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Pr(["receive","process"],this),this.invoker=new uh(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=St()?e:k};function Yl(e,t,r){var f=2*Math.PI*6378137/256/Math.pow(2,r);return[e*f-2*Math.PI*6378137/2,t*f-2*Math.PI*6378137/2]}Bf.prototype.send=function(e,t,r,f,v){var m=this;v===void 0&&(v=!1);var x=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[x]=r);var A=Te(this.globalScope)?void 0:[];return this.target.postMessage({id:x,type:e,hasCallback:!!r,targetMapId:f,mustQueue:v,sourceMapId:this.mapId,data:lu(t,A)},A),{cancel:function(){r&&delete m.callbacks[x],m.target.postMessage({id:x,type:"<cancel>",targetMapId:f,sourceMapId:m.mapId})}}},Bf.prototype.receive=function(e){var t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[r];var f=this.cancelCallbacks[r];delete this.cancelCallbacks[r],f&&f()}else St()||t.mustQueue?(this.tasks[r]=t,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,t)},Bf.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t)}},Bf.prototype.processTask=function(e,t){var r=this;if(t.type==="<response>"){var f=this.callbacks[e];delete this.callbacks[e],f&&(t.error?f(Vs(t.error)):f(null,Vs(t.data)))}else{var v=!1,m=Te(this.globalScope)?void 0:[],x=t.hasCallback?function(K,q){v=!0,delete r.cancelCallbacks[e],r.target.postMessage({id:e,type:"<response>",sourceMapId:r.mapId,error:K?lu(K):null,data:lu(q,m)},m)}:function(K){v=!0},A=null,F=Vs(t.data);if(this.parent[t.type])A=this.parent[t.type](t.sourceMapId,F,x);else if(this.parent.getWorkerSource){var Z=t.type.split(".");A=this.parent.getWorkerSource(t.sourceMapId,Z[0],F.source)[Z[1]](F,x)}else x(new Error("Could not find function "+t.type));!v&&A&&A.cancel&&(this.cancelCallbacks[e]=A.cancel)}},Bf.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var es=function(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};es.prototype.setNorthEast=function(e){return this._ne=e instanceof mo?new mo(e.lng,e.lat):mo.convert(e),this},es.prototype.setSouthWest=function(e){return this._sw=e instanceof mo?new mo(e.lng,e.lat):mo.convert(e),this},es.prototype.extend=function(e){var t,r,f=this._sw,v=this._ne;if(e instanceof mo)t=e,r=e;else{if(!(e instanceof es))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(es.convert(e)):this.extend(mo.convert(e)):this;if(r=e._ne,!(t=e._sw)||!r)return this}return f||v?(f.lng=Math.min(t.lng,f.lng),f.lat=Math.min(t.lat,f.lat),v.lng=Math.max(r.lng,v.lng),v.lat=Math.max(r.lat,v.lat)):(this._sw=new mo(t.lng,t.lat),this._ne=new mo(r.lng,r.lat)),this},es.prototype.getCenter=function(){return new mo((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},es.prototype.getSouthWest=function(){return this._sw},es.prototype.getNorthEast=function(){return this._ne},es.prototype.getNorthWest=function(){return new mo(this.getWest(),this.getNorth())},es.prototype.getSouthEast=function(){return new mo(this.getEast(),this.getSouth())},es.prototype.getWest=function(){return this._sw.lng},es.prototype.getSouth=function(){return this._sw.lat},es.prototype.getEast=function(){return this._ne.lng},es.prototype.getNorth=function(){return this._ne.lat},es.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},es.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},es.prototype.isEmpty=function(){return!(this._sw&&this._ne)},es.prototype.contains=function(e){var t=mo.convert(e),r=t.lng,f=t.lat,v=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&v},es.convert=function(e){return!e||e instanceof es?e:new es(e)};var mo=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: ("+e+", "+t+")");if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};mo.prototype.wrap=function(){return new mo(Vt(this.lng,-180,180),this.lat)},mo.prototype.toArray=function(){return[this.lng,this.lat]},mo.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},mo.prototype.distanceTo=function(e){var t=Math.PI/180,r=this.lat*t,f=e.lat*t,v=Math.sin(r)*Math.sin(f)+Math.cos(r)*Math.cos(f)*Math.cos((e.lng-this.lng)*t);return 63710088e-1*Math.acos(Math.min(v,1))},mo.prototype.toBounds=function(e){e===void 0&&(e=0);var t=360*e/40075017,r=t/Math.cos(Math.PI/180*this.lat);return new es(new mo(this.lng-r,this.lat-t),new mo(this.lng+r,this.lat+t))},mo.convert=function(e){if(e instanceof mo)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new mo(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new mo(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Gp=2*Math.PI*63710088e-1;function Hp(e){return Gp*Math.cos(e*Math.PI/180)}function lh(e){return(180+e)/360}function Uh(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function gp(e,t){return e/Hp(t)}function yp(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var Jc=function(e,t,r){r===void 0&&(r=0),this.x=+e,this.y=+t,this.z=+r};Jc.fromLngLat=function(e,t){t===void 0&&(t=0);var r=mo.convert(e);return new Jc(lh(r.lng),Uh(r.lat),gp(t,r.lat))},Jc.prototype.toLngLat=function(){return new mo(360*this.x-180,yp(this.y))},Jc.prototype.toAltitude=function(){return this.z*Hp(yp(this.y))},Jc.prototype.meterInMercatorCoordinateUnits=function(){return 1/Gp*(e=yp(this.y),1/Math.cos(e*Math.PI/180));var e};var hf=function(e,t,r){this.z=e,this.x=t,this.y=r,this.key=Qc(0,e,e,t,r)};hf.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},hf.prototype.url=function(e,t){var r,f,v,m,x,A=(f=this.y,v=this.z,m=Yl(256*(r=this.x),256*(f=Math.pow(2,v)-f-1),v),x=Yl(256*(r+1),256*(f+1),v),m[0]+","+m[1]+","+x[0]+","+x[1]),F=function(Z,K,q){for(var ue,de="",Ge=Z;Ge>0;Ge--)de+=(K&(ue=1<<Ge-1)?1:0)+(q&ue?2:0);return de}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",F).replace("{bbox-epsg-3857}",A)},hf.prototype.getTilePoint=function(e){var t=Math.pow(2,this.z);return new $(8192*(e.x*t-this.x),8192*(e.y*t-this.y))},hf.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Wp=function(e,t){this.wrap=e,this.canonical=t,this.key=Qc(e,t.z,t.z,t.x,t.y)},Vo=function(e,t,r,f,v){this.overscaledZ=e,this.wrap=t,this.canonical=new hf(r,+f,+v),this.key=Qc(t,e,r,f,v)};function Qc(e,t,r,f,v){(e*=2)<0&&(e=-1*e-1);var m=1<<r;return(m*m*e+m*v+f).toString(36)+r.toString(36)+t.toString(36)}Vo.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},Vo.prototype.scaledTo=function(e){var t=this.canonical.z-e;return e>this.canonical.z?new Vo(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Vo(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)},Vo.prototype.calculateScaledKey=function(e,t){var r=this.canonical.z-e;return e>this.canonical.z?Qc(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):Qc(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)},Vo.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t},Vo.prototype.children=function(e){if(this.overscaledZ>=e)return[new Vo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var t=this.canonical.z+1,r=2*this.canonical.x,f=2*this.canonical.y;return[new Vo(t,this.wrap,t,r,f),new Vo(t,this.wrap,t,r+1,f),new Vo(t,this.wrap,t,r,f+1),new Vo(t,this.wrap,t,r+1,f+1)]},Vo.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},Vo.prototype.wrapped=function(){return new Vo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Vo.prototype.unwrapTo=function(e){return new Vo(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},Vo.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Vo.prototype.toUnwrapped=function(){return new Wp(this.wrap,this.canonical)},Vo.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Vo.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new Jc(e.x-this.wrap,e.y))},wn("CanonicalTileID",hf),wn("OverscaledTileID",Vo,{omit:["posMatrix"]});var pf=function(e,t,r){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return Ie('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=t.height;var f=this.dim=t.height-2;this.data=new Uint32Array(t.data.buffer),this.encoding=r||"mapbox";for(var v=0;v<f;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(f,v)]=this.data[this._idx(f-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,f)]=this.data[this._idx(v,f-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(f,-1)]=this.data[this._idx(f-1,0)],this.data[this._idx(-1,f)]=this.data[this._idx(0,f-1)],this.data[this._idx(f,f)]=this.data[this._idx(f-1,f-1)]};pf.prototype.get=function(e,t){var r=new Uint8Array(this.data.buffer),f=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(r[f],r[f+1],r[f+2])},pf.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},pf.prototype._idx=function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)},pf.prototype._unpackMapbox=function(e,t,r){return(256*e*256+256*t+r)/10-1e4},pf.prototype._unpackTerrarium=function(e,t,r){return 256*e+t+r/256-32768},pf.prototype.getPixels=function(){return new Uo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},pf.prototype.backfillBorder=function(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var f=t*this.dim,v=t*this.dim+this.dim,m=r*this.dim,x=r*this.dim+this.dim;switch(t){case-1:f=v-1;break;case 1:v=f+1}switch(r){case-1:m=x-1;break;case 1:x=m+1}for(var A=-t*this.dim,F=-r*this.dim,Z=m;Z<x;Z++)for(var K=f;K<v;K++)this.data[this._idx(K,Z)]=e.data[this._idx(K+A,Z+F)]},wn("DEMData",pf);var jh=function(e){this._stringToNumber={},this._numberToString=[];for(var t=0;t<e.length;t++){var r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}};jh.prototype.encode=function(e){return this._stringToNumber[e]},jh.prototype.decode=function(e){return this._numberToString[e]};var Vh=function(e,t,r,f,v){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=r,e._y=f,this.properties=e.properties,this.id=v},_p={geometry:{configurable:!0}};_p.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},_p.geometry.set=function(e){this._geometry=e},Vh.prototype.toJSON=function(){var e={geometry:this.geometry};for(var t in this)t!=="_geometry"&&t!=="_vectorTileFeature"&&(e[t]=this[t]);return e},Object.defineProperties(Vh.prototype,_p);var Nf=function(){this.state={},this.stateChanges={},this.deletedStates={}};Nf.prototype.updateState=function(e,t,r){var f=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},Ht(this.stateChanges[e][f],r),this.deletedStates[e]===null)for(var v in this.deletedStates[e]={},this.state[e])v!==f&&(this.deletedStates[e][v]=null);else if(this.deletedStates[e]&&this.deletedStates[e][f]===null)for(var m in this.deletedStates[e][f]={},this.state[e][f])r[m]||(this.deletedStates[e][f][m]=null);else for(var x in r)this.deletedStates[e]&&this.deletedStates[e][f]&&this.deletedStates[e][f][x]===null&&delete this.deletedStates[e][f][x]},Nf.prototype.removeFeatureState=function(e,t,r){if(this.deletedStates[e]!==null){var f=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&t!==void 0)this.deletedStates[e][f]!==null&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][r]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][f])for(r in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][r]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}},Nf.prototype.getState=function(e,t){var r=String(t),f=Ht({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){var v=this.deletedStates[e][t];if(v===null)return{};for(var m in v)delete f[m]}return f},Nf.prototype.initializeTileState=function(e,t){e.setFeatureState(this.state,t)},Nf.prototype.coalesceChanges=function(e,t){var r={};for(var f in this.stateChanges){this.state[f]=this.state[f]||{};var v={};for(var m in this.stateChanges[f])this.state[f][m]||(this.state[f][m]={}),Ht(this.state[f][m],this.stateChanges[f][m]),v[m]=this.state[f][m];r[f]=v}for(var x in this.deletedStates){this.state[x]=this.state[x]||{};var A={};if(this.deletedStates[x]===null)for(var F in this.state[x])A[F]={},this.state[x][F]={};else for(var Z in this.deletedStates[x]){if(this.deletedStates[x][Z]===null)this.state[x][Z]={};else for(var K=0,q=Object.keys(this.deletedStates[x][Z]);K<q.length;K+=1)delete this.state[x][Z][q[K]];A[Z]=this.state[x][Z]}r[x]=r[x]||{},Ht(r[x],A)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(var ue in e)e[ue].setFeatureState(r,t)};var df=function(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ru(8192,16,0),this.grid3D=new Ru(8192,16,0),this.featureIndexArray=new ee,this.promoteId=t};function xp(e,t,r,f,v){return Ft(e,function(m,x){var A=t instanceof zl?t.get(x):null;return A&&A.evaluate?A.evaluate(r,f,v):A})}function bp(e){for(var t=1/0,r=1/0,f=-1/0,v=-1/0,m=0,x=e;m<x.length;m+=1){var A=x[m];t=Math.min(t,A.x),r=Math.min(r,A.y),f=Math.max(f,A.x),v=Math.max(v,A.y)}return{minX:t,minY:r,maxX:f,maxY:v}}function Xp(e,t){return t-e}df.prototype.insert=function(e,t,r,f,v,m){var x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,f,v);for(var A=m?this.grid3D:this.grid,F=0;F<t.length;F++){for(var Z=t[F],K=[1/0,1/0,-1/0,-1/0],q=0;q<Z.length;q++){var ue=Z[q];K[0]=Math.min(K[0],ue.x),K[1]=Math.min(K[1],ue.y),K[2]=Math.max(K[2],ue.x),K[3]=Math.max(K[3],ue.y)}K[0]<8192&&K[1]<8192&&K[2]>=0&&K[3]>=0&&A.insert(x,K[0],K[1],K[2],K[3])}},df.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Kc.VectorTile(new Pe(this.rawTileData)).layers,this.sourceLayerCoder=new jh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},df.prototype.query=function(e,t,r,f){var v=this;this.loadVTLayers();for(var m=e.params||{},x=8192/e.tileSize/e.scale,A=kl(m.filter),F=e.queryGeometry,Z=e.queryPadding*x,K=bp(F),q=this.grid.query(K.minX-Z,K.minY-Z,K.maxX+Z,K.maxY+Z),ue=bp(e.cameraQueryGeometry),de=this.grid3D.query(ue.minX-Z,ue.minY-Z,ue.maxX+Z,ue.maxY+Z,function(ir,dr,Mr,en){return function(dn,Hn,En,ei,Tn){for(var Vi=0,mi=dn;Vi<mi.length;Vi+=1){var Bn=mi[Vi];if(Hn<=Bn.x&&En<=Bn.y&&ei>=Bn.x&&Tn>=Bn.y)return!0}var ta=[new $(Hn,En),new $(Hn,Tn),new $(ei,Tn),new $(ei,En)];if(dn.length>2){for(var Li=0,la=ta;Li<la.length;Li+=1)if(Tu(dn,la[Li]))return!0}for(var Jn=0;Jn<dn.length-1;Jn++)if(zu(dn[Jn],dn[Jn+1],ta))return!0;return!1}(e.cameraQueryGeometry,ir-Z,dr-Z,Mr+Z,en+Z)}),Ge=0,Ye=de;Ge<Ye.length;Ge+=1)q.push(Ye[Ge]);q.sort(Xp);for(var ct,rt={},It=function(ir){var dr=q[ir];if(dr!==ct){ct=dr;var Mr=v.featureIndexArray.get(dr),en=null;v.loadMatchingFeature(rt,Mr.bucketIndex,Mr.sourceLayerIndex,Mr.featureIndex,A,m.layers,m.availableImages,t,r,f,function(dn,Hn,En){return en||(en=Ga(dn)),Hn.queryIntersectsFeature(F,dn,En,en,v.z,e.transform,x,e.pixelPosMatrix)})}},Wt=0;Wt<q.length;Wt++)It(Wt);return rt},df.prototype.loadMatchingFeature=function(e,t,r,f,v,m,x,A,F,Z,K){var q=this.bucketLayerIDs[t];if(!m||function(dn,Hn){for(var En=0;En<dn.length;En++)if(Hn.indexOf(dn[En])>=0)return!0;return!1}(m,q)){var ue=this.sourceLayerCoder.decode(r),de=this.vtLayers[ue].feature(f);if(v.needGeometry){var Ge=no(de,!0);if(!v.filter(new Bi(this.tileID.overscaledZ),Ge,this.tileID.canonical))return}else if(!v.filter(new Bi(this.tileID.overscaledZ),de))return;for(var Ye=this.getId(de,ue),ct=0;ct<q.length;ct++){var rt=q[ct];if(!(m&&m.indexOf(rt)<0)){var It=A[rt];if(It){var Wt={};Ye!==void 0&&Z&&(Wt=Z.getState(It.sourceLayer||"_geojsonTileLayer",Ye));var ir=Ht({},F[rt]);ir.paint=xp(ir.paint,It.paint,de,Wt,x),ir.layout=xp(ir.layout,It.layout,de,Wt,x);var dr=!K||K(de,It,Wt);if(dr){var Mr=new Vh(de,this.z,this.x,this.y,Ye);Mr.layer=ir;var en=e[rt];en===void 0&&(en=e[rt]=[]),en.push({featureIndex:f,feature:Mr,intersectionZ:dr})}}}}}},df.prototype.lookupSymbolFeatures=function(e,t,r,f,v,m,x,A){var F={};this.loadVTLayers();for(var Z=kl(v),K=0,q=e;K<q.length;K+=1)this.loadMatchingFeature(F,r,f,q[K],Z,m,x,A,t);return F},df.prototype.hasLayer=function(e){for(var t=0,r=this.bucketLayerIDs;t<r.length;t+=1)for(var f=0,v=r[t];f<v.length;f+=1)if(e===v[f])return!0;return!1},df.prototype.getId=function(e,t){var r=e.id;return this.promoteId&&typeof(r=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]])=="boolean"&&(r=Number(r)),r},wn("FeatureIndex",df,{omit:["rawTileData","sourceLayerCoder"]});var ws=function(e,t){this.tileID=e,this.uid=Ot(),this.uses=0,this.tileSize=t,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};ws.prototype.registerFadeDuration=function(e){var t=e+this.timeAdded;t<on.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)},ws.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},ws.prototype.loadVectorData=function(e,t,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var f in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(Z,K){var q={};if(!K)return q;for(var ue=function(){var Ye=Ge[de],ct=Ye.layerIds.map(function(Wt){return K.getLayer(Wt)}).filter(Boolean);if(ct.length!==0){Ye.layers=ct,Ye.stateDependentLayerIds&&(Ye.stateDependentLayers=Ye.stateDependentLayerIds.map(function(Wt){return ct.filter(function(ir){return ir.id===Wt})[0]}));for(var rt=0,It=ct;rt<It.length;rt+=1)q[It[rt].id]=Ye}},de=0,Ge=Z;de<Ge.length;de+=1)ue();return q}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var v=this.buckets[f];if(v instanceof $t){if(this.hasSymbolBuckets=!0,!r)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var m in this.buckets){var x=this.buckets[m];if(x instanceof $t&&x.hasRTLText){this.hasRTLText=!0,Is.isLoading()||Is.isLoaded()||yc()!=="deferred"||cu();break}}for(var A in this.queryPadding=0,this.buckets){var F=this.buckets[A];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(A).queryRadius(F))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new u},ws.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},ws.prototype.getBucket=function(e){return this.buckets[e.id]},ws.prototype.upload=function(e){for(var t in this.buckets){var r=this.buckets[t];r.uploadPending()&&r.upload(e)}var f=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ff(e,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ff(e,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)},ws.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},ws.prototype.queryRenderedFeatures=function(e,t,r,f,v,m,x,A,F,Z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:v,scale:m,tileSize:this.tileSize,pixelPosMatrix:Z,transform:A,params:x,queryPadding:this.queryPadding*F},e,t,r):{}},ws.prototype.querySourceFeatures=function(e,t){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var f=r.loadVTLayers(),v=t?t.sourceLayer:"",m=f._geojsonTileLayer||f[v];if(m)for(var x=kl(t&&t.filter),A=this.tileID.canonical,F=A.z,Z=A.x,K=A.y,q={z:F,x:Z,y:K},ue=0;ue<m.length;ue++){var de=m.feature(ue);if(x.needGeometry){var Ge=no(de,!0);if(!x.filter(new Bi(this.tileID.overscaledZ),Ge,this.tileID.canonical))continue}else if(!x.filter(new Bi(this.tileID.overscaledZ),de))continue;var Ye=r.getId(de,v),ct=new Vh(de,F,Z,K,Ye);ct.tile=q,e.push(ct)}}},ws.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},ws.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},ws.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var r=ur(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var f=Date.now(),v=!1;if(this.expirationTime>f)v=!1;else if(t)if(this.expirationTime<t)v=!0;else{var m=this.expirationTime-t;m?this.expirationTime=f+Math.max(m,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},ws.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},ws.prototype.setFeatureState=function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0){var r=this.latestFeatureIndex.loadVTLayers();for(var f in this.buckets)if(t.style.hasLayer(f)){var v=this.buckets[f],m=v.layers[0].sourceLayer||"_geojsonTileLayer",x=r[m],A=e[m];if(x&&A&&Object.keys(A).length!==0){v.update(A,x,this.imageAtlas&&this.imageAtlas.patternPositions||{});var F=t&&t.style&&t.style.getLayer(f);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(v)))}}}},ws.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},ws.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<on.now()},ws.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},ws.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=on.now()+e},ws.prototype.setDependencies=function(e,t){for(var r={},f=0,v=t;f<v.length;f+=1)r[v[f]]=!0;this.dependencies[e]=r},ws.prototype.hasDependency=function(e,t){for(var r=0,f=e;r<f.length;r+=1){var v=this.dependencies[f[r]];if(v){for(var m=0,x=t;m<x.length;m+=1)if(v[x[m]])return!0}}return!1};var vf=k.performance,Yp=function(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},vf.mark(this._marks.start)};Yp.prototype.finish=function(){vf.mark(this._marks.end);var e=vf.getEntriesByName(this._marks.measure);return e.length===0&&(vf.measure(this._marks.measure,this._marks.start,this._marks.end),e=vf.getEntriesByName(this._marks.measure),vf.clearMarks(this._marks.start),vf.clearMarks(this._marks.end),vf.clearMeasures(this._marks.measure)),e},p.Actor=Bf,p.AlphaImage=Ws,p.CanonicalTileID=hf,p.CollisionBoxArray=u,p.Color=Fi,p.DEMData=pf,p.DataConstantProperty=Un,p.DictionaryCoder=jh,p.EXTENT=8192,p.ErrorEvent=fe,p.EvaluationParameters=Bi,p.Event=re,p.Evented=Se,p.FeatureIndex=df,p.FillBucket=Ss,p.FillExtrusionBucket=il,p.ImageAtlas=Xn,p.ImagePosition=kr,p.LineBucket=nu,p.LngLat=mo,p.LngLatBounds=es,p.MercatorCoordinate=Jc,p.ONE_EM=24,p.OverscaledTileID=Vo,p.Point=$,p.Point$1=$,p.Properties=zo,p.Protobuf=Pe,p.RGBAImage=Uo,p.RequestManager=Bt,p.RequestPerformance=Yp,p.ResourceType=or,p.SegmentVector=ye,p.SourceFeatureState=Nf,p.StructArrayLayout1ui2=sf,p.StructArrayLayout2f1f2i16=ml,p.StructArrayLayout2i4=Fu,p.StructArrayLayout3ui6=gl,p.StructArrayLayout4i8=_c,p.SymbolBucket=$t,p.Texture=Ff,p.Tile=ws,p.Transitionable=Ao,p.Uniform1f=tn,p.Uniform1i=Rr,p.Uniform2f=Xr,p.Uniform3f=yn,p.Uniform4f=Fn,p.UniformColor=Vn,p.UniformMatrix4f=Qi,p.UnwrappedTileID=Wp,p.ValidationError=ge,p.WritingMode=Kn,p.ZoomHistory=dl,p.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},p.addDynamicAttributes=Oe,p.asyncAll=function(e,t,r){if(!e.length)return r(null,[]);var f=e.length,v=new Array(e.length),m=null;e.forEach(function(x,A){t(x,function(F,Z){F&&(m=F),v[A]=Z,--f==0&&r(m,v)})})},p.bezier=Be,p.bindAll=Pr,p.browser=on,p.cacheEntryPossiblyAdded=function(e){++Lt>ht&&(e.getActor().send("enforceCacheSizeLimit",xt),Lt=0)},p.clamp=$e,p.clearTileCache=function(e){var t=k.caches.delete("mapbox-tiles");e&&t.catch(e).then(function(){return e()})},p.clipLine=li,p.clone=function(e){var t=new qi(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},p.clone$1=Ne,p.clone$2=function(e){var t=new qi(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},p.collisionCircleLayout=mp,p.config=tr,p.create=function(){var e=new qi(16);return qi!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},p.create$1=function(){var e=new qi(9);return qi!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},p.create$2=function(){var e=new qi(4);return qi!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},p.createCommonjsModule=b,p.createExpression=ec,p.createLayout=po,p.createStyleLayer=function(e){return e.type==="custom"?new Co(e):new yu[e.type](e)},p.cross=function(e,t,r){var f=t[0],v=t[1],m=t[2],x=r[0],A=r[1],F=r[2];return e[0]=v*F-m*A,e[1]=m*x-f*F,e[2]=f*A-v*x,e},p.deepEqual=function e(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var f=0;f<t.length;f++)if(!e(t[f],r[f]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(var v in t)if(!e(t[v],r[v]))return!1;return!0}return t===r},p.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},p.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},p.ease=We,p.emitValidationErrors=$u,p.endsWith=er,p.enforceCacheSizeLimit=function(e){lr(),Yt&&Yt.then(function(t){t.keys().then(function(r){for(var f=0;f<r.length-e;f++)t.delete(r[f])})})},p.evaluateSizeForFeature=Qo,p.evaluateSizeForZoom=ys,p.evaluateVariableOffset=ot,p.evented=Zc,p.extend=Ht,p.featureFilter=kl,p.filterObject=tt,p.fromRotation=function(e,t){var r=Math.sin(t),f=Math.cos(t);return e[0]=f,e[1]=r,e[2]=0,e[3]=-r,e[4]=f,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.getAnchorAlignment=Jo,p.getAnchorJustification=Dt,p.getArrayBuffer=ia,p.getImage=ie,p.getJSON=function(e,t){return Ri(Ht(e,{type:"json"}),t)},p.getRTLTextPluginStatus=yc,p.getReferrer=Pn,p.getVideo=function(e,t){var r,f,v=k.document.createElement("video");v.muted=!0,v.onloadstart=function(){t(null,v)};for(var m=0;m<e.length;m++){var x=k.document.createElement("source");r=e[m],f=void 0,(f=k.document.createElement("a")).href=r,(f.protocol!==k.document.location.protocol||f.host!==k.document.location.host)&&(v.crossOrigin="Anonymous"),x.src=e[m],v.appendChild(x)}return{cancel:function(){}}},p.identity=ao,p.invert=function(e,t){var r=t[0],f=t[1],v=t[2],m=t[3],x=t[4],A=t[5],F=t[6],Z=t[7],K=t[8],q=t[9],ue=t[10],de=t[11],Ge=t[12],Ye=t[13],ct=t[14],rt=t[15],It=r*A-f*x,Wt=r*F-v*x,ir=r*Z-m*x,dr=f*F-v*A,Mr=f*Z-m*A,en=v*Z-m*F,dn=K*Ye-q*Ge,Hn=K*ct-ue*Ge,En=K*rt-de*Ge,ei=q*ct-ue*Ye,Tn=q*rt-de*Ye,Vi=ue*rt-de*ct,mi=It*Vi-Wt*Tn+ir*ei+dr*En-Mr*Hn+en*dn;return mi?(e[0]=(A*Vi-F*Tn+Z*ei)*(mi=1/mi),e[1]=(v*Tn-f*Vi-m*ei)*mi,e[2]=(Ye*en-ct*Mr+rt*dr)*mi,e[3]=(ue*Mr-q*en-de*dr)*mi,e[4]=(F*En-x*Vi-Z*Hn)*mi,e[5]=(r*Vi-v*En+m*Hn)*mi,e[6]=(ct*ir-Ge*en-rt*Wt)*mi,e[7]=(K*en-ue*ir+de*Wt)*mi,e[8]=(x*Tn-A*En+Z*dn)*mi,e[9]=(f*En-r*Tn-m*dn)*mi,e[10]=(Ge*Mr-Ye*ir+rt*It)*mi,e[11]=(q*ir-K*Mr-de*It)*mi,e[12]=(A*Hn-x*ei-F*dn)*mi,e[13]=(r*ei-f*Hn+v*dn)*mi,e[14]=(Ye*Wt-Ge*dr-ct*It)*mi,e[15]=(K*dr-q*Wt+ue*It)*mi,e):null},p.isChar=$r,p.isMapboxURL=w,p.keysDifference=function(e,t){var r=[];for(var f in e)f in t||r.push(f);return r},p.makeRequest=Ri,p.mapObject=Ft,p.mercatorXfromLng=lh,p.mercatorYfromLat=Uh,p.mercatorZfromAltitude=gp,p.mul=tl,p.multiply=ko,p.mvt=Kc,p.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},p.normalize=function(e,t){var r=t[0],f=t[1],v=t[2],m=r*r+f*f+v*v;return m>0&&(m=1/Math.sqrt(m)),e[0]=t[0]*m,e[1]=t[1]*m,e[2]=t[2]*m,e},p.number=ho,p.offscreenCanvasSupported=Jt,p.ortho=function(e,t,r,f,v,m,x){var A=1/(t-r),F=1/(f-v),Z=1/(m-x);return e[0]=-2*A,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*F,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*Z,e[11]=0,e[12]=(t+r)*A,e[13]=(v+f)*F,e[14]=(x+m)*Z,e[15]=1,e},p.parseGlyphPBF=function(e){return new Pe(e).readFields(Br,[])},p.pbf=Pe,p.performSymbolLayout=function(e,t,r,f,v,m,x){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var A=e.layers[0].layout,F=e.layers[0]._unevaluatedLayout._values,Z={};if(e.textSizeData.kind==="composite"){var K=e.textSizeData,q=K.maxZoom;Z.compositeTextSizes=[F["text-size"].possiblyEvaluate(new Bi(K.minZoom),x),F["text-size"].possiblyEvaluate(new Bi(q),x)]}if(e.iconSizeData.kind==="composite"){var ue=e.iconSizeData,de=ue.maxZoom;Z.compositeIconSizes=[F["icon-size"].possiblyEvaluate(new Bi(ue.minZoom),x),F["icon-size"].possiblyEvaluate(new Bi(de),x)]}Z.layoutTextSize=F["text-size"].possiblyEvaluate(new Bi(e.zoom+1),x),Z.layoutIconSize=F["icon-size"].possiblyEvaluate(new Bi(e.zoom+1),x),Z.textMaxSize=F["text-size"].possiblyEvaluate(new Bi(18));for(var Ge=24*A.get("text-line-height"),Ye=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",ct=A.get("text-keep-upright"),rt=A.get("text-size"),It=function(){var dr=ir[Wt],Mr=A.get("text-font").evaluate(dr,{},x).join(","),en=rt.evaluate(dr,{},x),dn=Z.layoutTextSize.evaluate(dr,{},x),Hn=Z.layoutIconSize.evaluate(dr,{},x),En={horizontal:{},vertical:void 0},ei=dr.text,Tn=[0,0];if(ei){var Vi=ei.toString(),mi=24*A.get("text-letter-spacing").evaluate(dr,{},x),Bn=function(na){for(var Ia=0,Da=na;Ia<Da.length;Ia+=1)if(pa=Da[Ia].charCodeAt(0),$r.Arabic(pa)||$r["Arabic Supplement"](pa)||$r["Arabic Extended-A"](pa)||$r["Arabic Presentation Forms-A"](pa)||$r["Arabic Presentation Forms-B"](pa))return!1;var pa;return!0}(Vi)?mi:0,ta=A.get("text-anchor").evaluate(dr,{},x),Li=A.get("text-variable-anchor");if(!Li){var la=A.get("text-radial-offset").evaluate(dr,{},x);Tn=la?ot(ta,[24*la,xe]):A.get("text-offset").evaluate(dr,{},x).map(function(na){return 24*na})}var Jn=Ye?"center":A.get("text-justify").evaluate(dr,{},x),zi=A.get("symbol-placement"),uo=zi==="point"?24*A.get("text-max-width").evaluate(dr,{},x):0,lo=function(){e.allowVerticalPlacement&&Bc(Vi)&&(En.vertical=Ir(ei,t,r,v,Mr,uo,Ge,ta,"left",Bn,Tn,Kn.vertical,!0,zi,dn,en))};if(!Ye&&Li){for(var Go=Jn==="auto"?Li.map(function(na){return Dt(na)}):[Jn],go=!1,Ho=0;Ho<Go.length;Ho++){var Bs=Go[Ho];if(!En.horizontal[Bs])if(go)En.horizontal[Bs]=En.horizontal[0];else{var ts=Ir(ei,t,r,v,Mr,uo,Ge,"center",Bs,Bn,Tn,Kn.horizontal,!1,zi,dn,en);ts&&(En.horizontal[Bs]=ts,go=ts.positionedLines.length===1)}}lo()}else{Jn==="auto"&&(Jn=Dt(ta));var Cs=Ir(ei,t,r,v,Mr,uo,Ge,ta,Jn,Bn,Tn,Kn.horizontal,!1,zi,dn,en);Cs&&(En.horizontal[Jn]=Cs),lo(),Bc(Vi)&&Ye&&ct&&(En.vertical=Ir(ei,t,r,v,Mr,uo,Ge,ta,Jn,Bn,Tn,Kn.vertical,!1,zi,dn,en))}}var Ts=void 0,iu=!1;if(dr.icon&&dr.icon.name){var Wo=f[dr.icon.name];Wo&&(Ts=function(na,Ia,Da){var pa=Jo(Da),As=Ia[0]-na.displaySize[0]*pa.horizontalAlign,au=Ia[1]-na.displaySize[1]*pa.verticalAlign;return{image:na,top:au,bottom:au+na.displaySize[1],left:As,right:As+na.displaySize[0]}}(v[dr.icon.name],A.get("icon-offset").evaluate(dr,{},x),A.get("icon-anchor").evaluate(dr,{},x)),iu=Wo.sdf,e.sdfIcons===void 0?e.sdfIcons=Wo.sdf:e.sdfIcons!==Wo.sdf&&Ie("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Wo.pixelRatio!==e.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}var Bo=ft(En.horizontal)||En.vertical;e.iconsInText=!!Bo&&Bo.iconsInText,(Bo||Ts)&&function(na,Ia,Da,pa,As,au,yo,xs,_u,Ea,mf){var Kl=au.textMaxSize.evaluate(Ia,{});Kl===void 0&&(Kl=yo);var gf,us=na.layers[0].layout,Cc=us.get("icon-offset").evaluate(Ia,{},mf),Al=ft(Da.horizontal),ch=yo/24,Tf=na.tilePixelRatio*ch,$f=na.tilePixelRatio*Kl/24,Af=na.tilePixelRatio*xs,zf=na.tilePixelRatio*us.get("symbol-spacing"),Gh=us.get("text-padding")*na.tilePixelRatio,fh=us.get("icon-padding")*na.tilePixelRatio,Jf=us.get("text-max-angle")/180*Math.PI,Hh=us.get("text-rotation-alignment")==="map"&&us.get("symbol-placement")!=="point",Sp=us.get("icon-rotation-alignment")==="map"&&us.get("symbol-placement")!=="point",lc=us.get("symbol-placement"),hh=zf/2,ph=us.get("icon-text-fit");pa&&ph!=="none"&&(na.allowVerticalPlacement&&Da.vertical&&(gf=$i(pa,Da.vertical,ph,us.get("icon-text-fit-padding"),Cc,ch)),Al&&(pa=$i(pa,Al,ph,us.get("icon-text-fit-padding"),Cc,ch)));var Pl=function(bh,Sh){Sh.x<0||Sh.x>=8192||Sh.y<0||Sh.y>=8192||function(Xo,Io,Id,Mf,Ba,$p,If,Ml,Qh,Eh,qh,ep,Cp,Tp,eh,Jp,Qp,qp,Ap,ed,ol,tp,td,ef,Od){var rd,jf,th,Vf,rh,nh=Xo.addToLineVertexArray(Io,Id),nd=0,Pp=0,id=0,ad=0,Mp=-1,Ip=-1,yf={},od=ze(""),rp=0,Op=0;if(Ml._unevaluatedLayout.getValue("text-radial-offset")===void 0?(rp=(rd=Ml.layout.get("text-offset").evaluate(ol,{},ef).map(function(Ch){return 24*Ch}))[0],Op=rd[1]):(rp=24*Ml.layout.get("text-radial-offset").evaluate(ol,{},ef),Op=xe),Xo.allowVerticalPlacement&&Mf.vertical){var sd=Ml.layout.get("text-rotate").evaluate(ol,{},ef)+90;Vf=new Ve(Qh,Io,Eh,qh,ep,Mf.vertical,Cp,Tp,eh,sd),If&&(rh=new Ve(Qh,Io,Eh,qh,ep,If,Qp,qp,eh,sd))}if(Ba){var Lp=Ml.layout.get("icon-rotate").evaluate(ol,{}),ud=Ml.layout.get("icon-text-fit")!=="none",ld=Wi(Ba,Lp,td,ud),Rp=If?Wi(If,Lp,td,ud):void 0;th=new Ve(Qh,Io,Eh,qh,ep,Ba,Qp,qp,!1,Lp),nd=4*ld.length;var cd=Xo.iconSizeData,wh=null;cd.kind==="source"?(wh=[128*Ml.layout.get("icon-size").evaluate(ol,{})])[0]>32640&&Ie(Xo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):cd.kind==="composite"&&((wh=[128*tp.compositeIconSizes[0].evaluate(ol,{},ef),128*tp.compositeIconSizes[1].evaluate(ol,{},ef)])[0]>32640||wh[1]>32640)&&Ie(Xo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Xo.addSymbols(Xo.icon,ld,wh,ed,Ap,ol,!1,Io,nh.lineStartIndex,nh.lineLength,-1,ef),Mp=Xo.icon.placedSymbolArray.length-1,Rp&&(Pp=4*Rp.length,Xo.addSymbols(Xo.icon,Rp,wh,ed,Ap,ol,Kn.vertical,Io,nh.lineStartIndex,nh.lineLength,-1,ef),Ip=Xo.icon.placedSymbolArray.length-1)}for(var Dp in Mf.horizontal){var np=Mf.horizontal[Dp];if(!jf){od=ze(np.text);var Ld=Ml.layout.get("text-rotate").evaluate(ol,{},ef);jf=new Ve(Qh,Io,Eh,qh,ep,np,Cp,Tp,eh,Ld)}var fd=np.positionedLines.length===1;if(id+=Mt(Xo,Io,np,$p,Ml,eh,ol,Jp,nh,Mf.vertical?Kn.horizontal:Kn.horizontalOnly,fd?Object.keys(Mf.horizontal):[Dp],yf,Mp,tp,ef),fd)break}Mf.vertical&&(ad+=Mt(Xo,Io,Mf.vertical,$p,Ml,eh,ol,Jp,nh,Kn.vertical,["vertical"],yf,Ip,tp,ef));var hd=jf?jf.boxStartIndex:Xo.collisionBoxArray.length,Rd=jf?jf.boxEndIndex:Xo.collisionBoxArray.length,Dd=Vf?Vf.boxStartIndex:Xo.collisionBoxArray.length,kd=Vf?Vf.boxEndIndex:Xo.collisionBoxArray.length,Fd=th?th.boxStartIndex:Xo.collisionBoxArray.length,Bd=th?th.boxEndIndex:Xo.collisionBoxArray.length,Nd=rh?rh.boxStartIndex:Xo.collisionBoxArray.length,pd=rh?rh.boxEndIndex:Xo.collisionBoxArray.length,tf=-1,ip=function(Ch,vd){return Ch&&Ch.circleDiameter?Math.max(Ch.circleDiameter,vd):vd};tf=ip(jf,tf),tf=ip(Vf,tf),tf=ip(th,tf);var dd=(tf=ip(rh,tf))>-1?1:0;dd&&(tf*=Od/24),Xo.glyphOffsetArray.length>=$t.MAX_GLYPHS&&Ie("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ol.sortKey!==void 0&&Xo.addToSortKeyRanges(Xo.symbolInstances.length,ol.sortKey),Xo.symbolInstances.emplaceBack(Io.x,Io.y,yf.right>=0?yf.right:-1,yf.center>=0?yf.center:-1,yf.left>=0?yf.left:-1,yf.vertical||-1,Mp,Ip,od,hd,Rd,Dd,kd,Fd,Bd,Nd,pd,Eh,id,ad,nd,Pp,dd,0,Cp,rp,Op,tf)}(na,Sh,bh,Da,pa,As,gf,na.layers[0],na.collisionBoxArray,Ia.index,Ia.sourceLayerIndex,na.index,Tf,Gh,Hh,_u,Af,fh,Sp,Cc,Ia,au,Ea,mf,yo)};if(lc==="line")for(var Zf=0,Uf=li(Ia.geometry,0,0,8192,8192);Zf<Uf.length;Zf+=1)for(var Wh=Uf[Zf],dh=0,qc=Sa(Wh,zf,Jf,Da.vertical||Al,pa,24,$f,na.overscaling,8192);dh<qc.length;dh+=1){var Xh=qc[dh];Al&&st(na,Al.text,hh,Xh)||Pl(Wh,Xh)}else if(lc==="line-center")for(var vh=0,Yh=Ia.geometry;vh<Yh.length;vh+=1){var Kh=Yh[vh];if(Kh.length>1){var Ep=Fs(Kh,Jf,Da.vertical||Al,pa,24,$f);Ep&&Pl(Kh,Ep)}}else if(Ia.type==="Polygon")for(var mh=0,wp=wo(Ia.geometry,0);mh<wp.length;mh+=1){var gh=wp[mh],$h=Cn(gh,16);Pl(gh[0],new vo($h.x,$h.y,0))}else if(Ia.type==="LineString")for(var Pf=0,Qf=Ia.geometry;Pf<Qf.length;Pf+=1){var yh=Qf[Pf];Pl(yh,new vo(yh[0].x,yh[0].y,0))}else if(Ia.type==="Point")for(var _h=0,qf=Ia.geometry;_h<qf.length;_h+=1)for(var Kp=0,Jh=qf[_h];Kp<Jh.length;Kp+=1){var xh=Jh[Kp];Pl([xh],new vo(xh.x,xh.y,0))}}(e,dr,En,Ts,f,Z,dn,Hn,Tn,iu,x)},Wt=0,ir=e.features;Wt<ir.length;Wt+=1)It();m&&e.generateCollisionDebugBuffers()},p.perspective=function(e,t,r,f,v){var m,x=1/Math.tan(t/2);return e[0]=x/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,v!=null&&v!==1/0?(e[10]=(v+f)*(m=1/(f-v)),e[14]=2*v*f*m):(e[10]=-1,e[14]=-2*f),e},p.pick=function(e,t){for(var r={},f=0;f<t.length;f++){var v=t[f];v in e&&(r[v]=e[v])}return r},p.plugin=Is,p.polygonIntersectsPolygon=el,p.postMapLoadEvent=Je,p.postTurnstileEvent=Tr,p.potpack=un,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.register=wn,p.registerForPluginStateChange=function(e){return e({pluginStatus:Gs,pluginURL:Qu}),Zc.on("pluginStateChange",e),e},p.renderColorRamp=Rf,p.rotate=function(e,t,r){var f=t[0],v=t[1],m=t[2],x=t[3],A=Math.sin(r),F=Math.cos(r);return e[0]=f*F+m*A,e[1]=v*F+x*A,e[2]=f*-A+m*F,e[3]=v*-A+x*F,e},p.rotateX=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),m=t[4],x=t[5],A=t[6],F=t[7],Z=t[8],K=t[9],q=t[10],ue=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=m*v+Z*f,e[5]=x*v+K*f,e[6]=A*v+q*f,e[7]=F*v+ue*f,e[8]=Z*v-m*f,e[9]=K*v-x*f,e[10]=q*v-A*f,e[11]=ue*v-F*f,e},p.rotateZ=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),m=t[0],x=t[1],A=t[2],F=t[3],Z=t[4],K=t[5],q=t[6],ue=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=m*v+Z*f,e[1]=x*v+K*f,e[2]=A*v+q*f,e[3]=F*v+ue*f,e[4]=Z*v-m*f,e[5]=K*v-x*f,e[6]=q*v-A*f,e[7]=ue*v-F*f,e},p.scale=function(e,t,r){var f=r[0],v=r[1],m=r[2];return e[0]=t[0]*f,e[1]=t[1]*f,e[2]=t[2]*f,e[3]=t[3]*f,e[4]=t[4]*v,e[5]=t[5]*v,e[6]=t[6]*v,e[7]=t[7]*v,e[8]=t[8]*m,e[9]=t[9]*m,e[10]=t[10]*m,e[11]=t[11]*m,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},p.scale$1=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},p.scale$2=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},p.setCacheLimits=function(e,t){xt=e,ht=t},p.setRTLTextPlugin=function(e,t,r){if(r===void 0&&(r=!1),Gs==="deferred"||Gs==="loading"||Gs==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Qu=on.resolveURL(e),Gs="deferred",zc=t,Du(),r||cu()},p.sphericalToCartesian=function(e){var t=e[0],r=e[1],f=e[2];return r+=90,r*=Math.PI/180,f*=Math.PI/180,{x:t*Math.cos(r)*Math.sin(f),y:t*Math.sin(r)*Math.sin(f),z:t*Math.cos(f)}},p.sqrLen=function(e){var t=e[0],r=e[1];return t*t+r*r},p.styleSpec=te,p.sub=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},p.symbolSize=Es,p.transformMat3=function(e,t,r){var f=t[0],v=t[1],m=t[2];return e[0]=f*r[0]+v*r[3]+m*r[6],e[1]=f*r[1]+v*r[4]+m*r[7],e[2]=f*r[2]+v*r[5]+m*r[8],e},p.transformMat4=vu,p.translate=function(e,t,r){var f,v,m,x,A,F,Z,K,q,ue,de,Ge,Ye=r[0],ct=r[1],rt=r[2];return t===e?(e[12]=t[0]*Ye+t[4]*ct+t[8]*rt+t[12],e[13]=t[1]*Ye+t[5]*ct+t[9]*rt+t[13],e[14]=t[2]*Ye+t[6]*ct+t[10]*rt+t[14],e[15]=t[3]*Ye+t[7]*ct+t[11]*rt+t[15]):(v=t[1],m=t[2],x=t[3],A=t[4],F=t[5],Z=t[6],K=t[7],q=t[8],ue=t[9],de=t[10],Ge=t[11],e[0]=f=t[0],e[1]=v,e[2]=m,e[3]=x,e[4]=A,e[5]=F,e[6]=Z,e[7]=K,e[8]=q,e[9]=ue,e[10]=de,e[11]=Ge,e[12]=f*Ye+A*ct+q*rt+t[12],e[13]=v*Ye+F*ct+ue*rt+t[13],e[14]=m*Ye+Z*ct+de*rt+t[14],e[15]=x*Ye+K*ct+Ge*rt+t[15]),e},p.triggerPluginCompletionEvent=Nl,p.uniqueId=Ot,p.validateCustomStyleLayer=function(e){var t=[],r=e.id;return r===void 0&&t.push({message:"layers."+r+': missing required property "id"'}),e.render===void 0&&t.push({message:"layers."+r+': missing required method "render"'}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&t.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),t},p.validateLight=Of,p.validateStyle=ic,p.values=function(e){var t=[];for(var r in e)t.push(e[r]);return t},p.vectorTile=Kc,p.version="1.13.1",p.warnOnce=Ie,p.webpSupported=se,p.window=k,p.wrap=Vt}),E(["./shared"],function(p){"use strict";function b(H){var ie=typeof H;if(ie==="number"||ie==="boolean"||ie==="string"||H==null)return JSON.stringify(H);if(Array.isArray(H)){for(var ce="[",B=0,re=H;B<re.length;B+=1)ce+=b(re[B])+",";return ce+"]"}for(var fe=Object.keys(H).sort(),Se="{",te=0;te<fe.length;te++)Se+=JSON.stringify(fe[te])+":"+b(H[fe[te]])+",";return Se+"}"}function X(H){for(var ie="",ce=0,B=p.refProperties;ce<B.length;ce+=1)ie+="/"+b(H[B[ce]]);return ie}var W=function(H){this.keyCache={},H&&this.replace(H)};W.prototype.replace=function(H){this._layerConfigs={},this._layers={},this.update(H,[])},W.prototype.update=function(H,ie){for(var ce=this,B=0,re=H;B<re.length;B+=1){var fe=re[B];this._layerConfigs[fe.id]=fe;var Se=this._layers[fe.id]=p.createStyleLayer(fe);Se._featureFilter=p.featureFilter(Se.filter),this.keyCache[fe.id]&&delete this.keyCache[fe.id]}for(var te=0,ge=ie;te<ge.length;te+=1){var pt=ge[te];delete this.keyCache[pt],delete this._layerConfigs[pt],delete this._layers[pt]}this.familiesBySource={};for(var yr=0,Lr=function(Wr,ln){for(var Ei={},pn=0;pn<Wr.length;pn++){var wi=ln&&ln[Wr[pn].id]||X(Wr[pn]);ln&&(ln[Wr[pn].id]=wi);var Yi=Ei[wi];Yi||(Yi=Ei[wi]=[]),Yi.push(Wr[pn])}var Yn=[];for(var Di in Ei)Yn.push(Ei[Di]);return Yn}(p.values(this._layerConfigs),this.keyCache);yr<Lr.length;yr+=1){var Nt=Lr[yr].map(function(Wr){return ce._layers[Wr.id]}),Fr=Nt[0];if(Fr.visibility!=="none"){var bn=Fr.source||"",gn=this.familiesBySource[bn];gn||(gn=this.familiesBySource[bn]={});var gr=Fr.sourceLayer||"_geojsonTileLayer",vn=gn[gr];vn||(vn=gn[gr]=[]),vn.push(Nt)}}};var $=function(H){var ie={},ce=[];for(var B in H){var re=H[B],fe=ie[B]={};for(var Se in re){var te=re[+Se];if(te&&te.bitmap.width!==0&&te.bitmap.height!==0){var ge={x:0,y:0,w:te.bitmap.width+2,h:te.bitmap.height+2};ce.push(ge),fe[Se]={rect:ge,metrics:te.metrics}}}}var pt=p.potpack(ce),yr=new p.AlphaImage({width:pt.w||1,height:pt.h||1});for(var Lr in H){var Nt=H[Lr];for(var Fr in Nt){var bn=Nt[+Fr];if(bn&&bn.bitmap.width!==0&&bn.bitmap.height!==0){var gn=ie[Lr][Fr].rect;p.AlphaImage.copy(bn.bitmap,yr,{x:0,y:0},{x:gn.x+1,y:gn.y+1},bn.bitmap)}}}this.image=yr,this.positions=ie};p.register("GlyphAtlas",$);var I=function(H){this.tileID=new p.OverscaledTileID(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.uid=H.uid,this.zoom=H.zoom,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=H.showCollisionBoxes,this.collectResourceTiming=!!H.collectResourceTiming,this.returnDependencies=!!H.returnDependencies,this.promoteId=H.promoteId};function k(H,ie,ce){for(var B=new p.EvaluationParameters(ie),re=0,fe=H;re<fe.length;re+=1)fe[re].recalculate(B,ce)}function Ce(H,ie){var ce=p.getArrayBuffer(H.request,function(B,re,fe,Se){B?ie(B):re&&ie(null,{vectorTile:new p.vectorTile.VectorTile(new p.pbf(re)),rawData:re,cacheControl:fe,expires:Se})});return function(){ce.cancel(),ie()}}I.prototype.parse=function(H,ie,ce,B,re){var fe=this;this.status="parsing",this.data=H,this.collisionBoxArray=new p.CollisionBoxArray;var Se=new p.DictionaryCoder(Object.keys(H.layers).sort()),te=new p.FeatureIndex(this.tileID,this.promoteId);te.bucketLayerIDs=[];var ge,pt,yr,Lr,Nt={},Fr={featureIndex:te,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ce},bn=ie.familiesBySource[this.source];for(var gn in bn){var gr=H.layers[gn];if(gr){gr.version===1&&p.warnOnce('Vector tile source "'+this.source+'" layer "'+gn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var vn=Se.encode(gn),Wr=[],ln=0;ln<gr.length;ln++){var Ei=gr.feature(ln),pn=te.getId(Ei,gn);Wr.push({feature:Ei,id:pn,index:ln,sourceLayerIndex:vn})}for(var wi=0,Yi=bn[gn];wi<Yi.length;wi+=1){var Yn=Yi[wi],Di=Yn[0];Di.minzoom&&this.zoom<Math.floor(Di.minzoom)||Di.maxzoom&&this.zoom>=Di.maxzoom||Di.visibility!=="none"&&(k(Yn,this.zoom,ce),(Nt[Di.id]=Di.createBucket({index:te.bucketLayerIDs.length,layers:Yn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:vn,sourceID:this.source})).populate(Wr,Fr,this.tileID.canonical),te.bucketLayerIDs.push(Yn.map(function(Ai){return Ai.id})))}}}var ki=p.mapObject(Fr.glyphDependencies,function(Ai){return Object.keys(Ai).map(Number)});Object.keys(ki).length?B.send("getGlyphs",{uid:this.uid,stacks:ki},function(Ai,Qn){ge||(ge=Ai,pt=Qn,ai.call(fe))}):pt={};var za=Object.keys(Fr.iconDependencies);za.length?B.send("getImages",{icons:za,source:this.source,tileID:this.tileID,type:"icons"},function(Ai,Qn){ge||(ge=Ai,yr=Qn,ai.call(fe))}):yr={};var Wn=Object.keys(Fr.patternDependencies);function ai(){if(ge)return re(ge);if(pt&&yr&&Lr){var Ai=new $(pt),Qn=new p.ImageAtlas(yr,Lr);for(var Fi in Nt){var ya=Nt[Fi];ya instanceof p.SymbolBucket?(k(ya.layers,this.zoom,ce),p.performSymbolLayout(ya,pt,Ai.positions,yr,Qn.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):ya.hasPattern&&(ya instanceof p.LineBucket||ya instanceof p.FillBucket||ya instanceof p.FillExtrusionBucket)&&(k(ya.layers,this.zoom,ce),ya.addFeatures(Fr,this.tileID.canonical,Qn.patternPositions))}this.status="done",re(null,{buckets:p.values(Nt).filter(function(Xa){return!Xa.isEmpty()}),featureIndex:te,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ai.image,imageAtlas:Qn,glyphMap:this.returnDependencies?pt:null,iconMap:this.returnDependencies?yr:null,glyphPositions:this.returnDependencies?Ai.positions:null})}}Wn.length?B.send("getImages",{icons:Wn,source:this.source,tileID:this.tileID,type:"patterns"},function(Ai,Qn){ge||(ge=Ai,Lr=Qn,ai.call(fe))}):Lr={},ai.call(this)};var Be=function(H,ie,ce,B){this.actor=H,this.layerIndex=ie,this.availableImages=ce,this.loadVectorData=B||Ce,this.loading={},this.loaded={}};Be.prototype.loadTile=function(H,ie){var ce=this,B=H.uid;this.loading||(this.loading={});var re=!!(H&&H.request&&H.request.collectResourceTiming)&&new p.RequestPerformance(H.request),fe=this.loading[B]=new I(H);fe.abort=this.loadVectorData(H,function(Se,te){if(delete ce.loading[B],Se||!te)return fe.status="done",ce.loaded[B]=fe,ie(Se);var ge=te.rawData,pt={};te.expires&&(pt.expires=te.expires),te.cacheControl&&(pt.cacheControl=te.cacheControl);var yr={};if(re){var Lr=re.finish();Lr&&(yr.resourceTiming=JSON.parse(JSON.stringify(Lr)))}fe.vectorTile=te.vectorTile,fe.parse(te.vectorTile,ce.layerIndex,ce.availableImages,ce.actor,function(Nt,Fr){if(Nt||!Fr)return ie(Nt);ie(null,p.extend({rawTileData:ge.slice(0)},Fr,pt,yr))}),ce.loaded=ce.loaded||{},ce.loaded[B]=fe})},Be.prototype.reloadTile=function(H,ie){var ce=this,B=this.loaded,re=H.uid,fe=this;if(B&&B[re]){var Se=B[re];Se.showCollisionBoxes=H.showCollisionBoxes;var te=function(ge,pt){var yr=Se.reloadCallback;yr&&(delete Se.reloadCallback,Se.parse(Se.vectorTile,fe.layerIndex,ce.availableImages,fe.actor,yr)),ie(ge,pt)};Se.status==="parsing"?Se.reloadCallback=te:Se.status==="done"&&(Se.vectorTile?Se.parse(Se.vectorTile,this.layerIndex,this.availableImages,this.actor,te):te())}},Be.prototype.abortTile=function(H,ie){var ce=this.loading,B=H.uid;ce&&ce[B]&&ce[B].abort&&(ce[B].abort(),delete ce[B]),ie()},Be.prototype.removeTile=function(H,ie){var ce=this.loaded,B=H.uid;ce&&ce[B]&&delete ce[B],ie()};var We=p.window.ImageBitmap,$e=function(){this.loaded={}};function Vt(H,ie){if(H.length!==0){Ht(H[0],ie);for(var ce=1;ce<H.length;ce++)Ht(H[ce],!ie)}}function Ht(H,ie){for(var ce=0,B=0,re=H.length,fe=re-1;B<re;fe=B++)ce+=(H[B][0]-H[fe][0])*(H[fe][1]+H[B][1]);ce>=0!=!!ie&&H.reverse()}$e.prototype.loadTile=function(H,ie){var ce=H.uid,B=H.encoding,re=H.rawImageData,fe=We&&re instanceof We?this.getImageData(re):re,Se=new p.DEMData(ce,fe,B);this.loaded=this.loaded||{},this.loaded[ce]=Se,ie(null,Se)},$e.prototype.getImageData=function(H){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(H.width,H.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=H.width,this.offscreenCanvas.height=H.height,this.offscreenCanvasContext.drawImage(H,0,0,H.width,H.height);var ie=this.offscreenCanvasContext.getImageData(-1,-1,H.width+2,H.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new p.RGBAImage({width:ie.width,height:ie.height},ie.data)},$e.prototype.removeTile=function(H){var ie=this.loaded,ce=H.uid;ie&&ie[ce]&&delete ie[ce]};var At=p.vectorTile.VectorTileFeature.prototype.toGeoJSON,Ot=function(H){this._feature=H,this.extent=p.EXTENT,this.type=H.type,this.properties=H.tags,"id"in H&&!isNaN(H.id)&&(this.id=parseInt(H.id,10))};Ot.prototype.loadGeometry=function(){if(this._feature.type===1){for(var H=[],ie=0,ce=this._feature.geometry;ie<ce.length;ie+=1){var B=ce[ie];H.push([new p.Point$1(B[0],B[1])])}return H}for(var re=[],fe=0,Se=this._feature.geometry;fe<Se.length;fe+=1){for(var te=[],ge=0,pt=Se[fe];ge<pt.length;ge+=1){var yr=pt[ge];te.push(new p.Point$1(yr[0],yr[1]))}re.push(te)}return re},Ot.prototype.toGeoJSON=function(H,ie,ce){return At.call(this,H,ie,ce)};var bt=function(H){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=H.length,this._features=H};bt.prototype.feature=function(H){return new Ot(this._features[H])};var dt=p.vectorTile.VectorTileFeature,Pr=er;function er(H,ie){this.options=ie||{},this.features=H,this.length=H.length}function Ft(H,ie){this.id=typeof H.id=="number"?H.id:void 0,this.type=H.type,this.rawGeometry=H.type===1?[H.geometry]:H.geometry,this.properties=H.tags,this.extent=ie||4096}er.prototype.feature=function(H){return new Ft(this.features[H],this.options.extent)},Ft.prototype.loadGeometry=function(){var H=this.rawGeometry;this.geometry=[];for(var ie=0;ie<H.length;ie++){for(var ce=H[ie],B=[],re=0;re<ce.length;re++)B.push(new p.Point$1(ce[re][0],ce[re][1]));this.geometry.push(B)}return this.geometry},Ft.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var H=this.geometry,ie=1/0,ce=-1/0,B=1/0,re=-1/0,fe=0;fe<H.length;fe++)for(var Se=H[fe],te=0;te<Se.length;te++){var ge=Se[te];ie=Math.min(ie,ge.x),ce=Math.max(ce,ge.x),B=Math.min(B,ge.y),re=Math.max(re,ge.y)}return[ie,B,ce,re]},Ft.prototype.toGeoJSON=dt.prototype.toGeoJSON;var tt=Qe,Ne=Pr;function Qe(H){var ie=new p.pbf;return function(ce,B){for(var re in ce.layers)B.writeMessage(3,Ie,ce.layers[re])}(H,ie),ie.finish()}function Ie(H,ie){var ce;ie.writeVarintField(15,H.version||1),ie.writeStringField(1,H.name||""),ie.writeVarintField(5,H.extent||4096);var B={keys:[],values:[],keycache:{},valuecache:{}};for(ce=0;ce<H.length;ce++)B.feature=H.feature(ce),ie.writeMessage(2,Ae,B);var re=B.keys;for(ce=0;ce<re.length;ce++)ie.writeStringField(3,re[ce]);var fe=B.values;for(ce=0;ce<fe.length;ce++)ie.writeMessage(4,Te,fe[ce])}function Ae(H,ie){var ce=H.feature;ce.id!==void 0&&ie.writeVarintField(1,ce.id),ie.writeMessage(2,Ue,H),ie.writeVarintField(3,ce.type),ie.writeMessage(4,ae,ce)}function Ue(H,ie){var ce=H.feature,B=H.keys,re=H.values,fe=H.keycache,Se=H.valuecache;for(var te in ce.properties){var ge=fe[te];ge===void 0&&(B.push(te),fe[te]=ge=B.length-1),ie.writeVarint(ge);var pt=ce.properties[te],yr=typeof pt;yr!=="string"&&yr!=="boolean"&&yr!=="number"&&(pt=JSON.stringify(pt));var Lr=yr+":"+pt,Nt=Se[Lr];Nt===void 0&&(re.push(pt),Se[Lr]=Nt=re.length-1),ie.writeVarint(Nt)}}function St(H,ie){return(ie<<3)+(7&H)}function ur(H){return H<<1^H>>31}function ae(H,ie){for(var ce=H.loadGeometry(),B=H.type,re=0,fe=0,Se=ce.length,te=0;te<Se;te++){var ge=ce[te],pt=1;B===1&&(pt=ge.length),ie.writeVarint(St(1,pt));for(var yr=B===3?ge.length-1:ge.length,Lr=0;Lr<yr;Lr++){Lr===1&&B!==1&&ie.writeVarint(St(2,yr-1));var Nt=ge[Lr].x-re,Fr=ge[Lr].y-fe;ie.writeVarint(ur(Nt)),ie.writeVarint(ur(Fr)),re+=Nt,fe+=Fr}B===3&&ie.writeVarint(St(7,1))}}function Te(H,ie){var ce=typeof H;ce==="string"?ie.writeStringField(1,H):ce==="boolean"?ie.writeBooleanField(7,H):ce==="number"&&(H%1!=0?ie.writeDoubleField(3,H):H<0?ie.writeSVarintField(6,H):ie.writeVarintField(5,H))}function oe(H,ie,ce,B){me(H,ce,B),me(ie,2*ce,2*B),me(ie,2*ce+1,2*B+1)}function me(H,ie,ce){var B=H[ie];H[ie]=H[ce],H[ce]=B}function Me(H,ie,ce,B){var re=H-ce,fe=ie-B;return re*re+fe*fe}tt.fromVectorTileJs=Qe,tt.fromGeojsonVt=function(H,ie){ie=ie||{};var ce={};for(var B in H)ce[B]=new Pr(H[B].features,ie),ce[B].name=B,ce[B].version=ie.version,ce[B].extent=ie.extent;return Qe({layers:ce})},tt.GeoJSONWrapper=Ne;var qe=function(H){return H[0]},yt=function(H){return H[1]},Qt=function(H,ie,ce,B,re){ie===void 0&&(ie=qe),ce===void 0&&(ce=yt),B===void 0&&(B=64),re===void 0&&(re=Float64Array),this.nodeSize=B,this.points=H;for(var fe=H.length<65536?Uint16Array:Uint32Array,Se=this.ids=new fe(H.length),te=this.coords=new re(2*H.length),ge=0;ge<H.length;ge++)Se[ge]=ge,te[2*ge]=ie(H[ge]),te[2*ge+1]=ce(H[ge]);(function pt(yr,Lr,Nt,Fr,bn,gn){if(!(bn-Fr<=Nt)){var gr=Fr+bn>>1;(function vn(Wr,ln,Ei,pn,wi,Yi){for(;wi>pn;){if(wi-pn>600){var Yn=wi-pn+1,Di=Ei-pn+1,ki=Math.log(Yn),za=.5*Math.exp(2*ki/3),Wn=.5*Math.sqrt(ki*za*(Yn-za)/Yn)*(Di-Yn/2<0?-1:1);vn(Wr,ln,Ei,Math.max(pn,Math.floor(Ei-Di*za/Yn+Wn)),Math.min(wi,Math.floor(Ei+(Yn-Di)*za/Yn+Wn)),Yi)}var ai=ln[2*Ei+Yi],Ai=pn,Qn=wi;for(oe(Wr,ln,pn,Ei),ln[2*wi+Yi]>ai&&oe(Wr,ln,pn,wi);Ai<Qn;){for(oe(Wr,ln,Ai,Qn),Ai++,Qn--;ln[2*Ai+Yi]<ai;)Ai++;for(;ln[2*Qn+Yi]>ai;)Qn--}ln[2*pn+Yi]===ai?oe(Wr,ln,pn,Qn):oe(Wr,ln,++Qn,wi),Qn<=Ei&&(pn=Qn+1),Ei<=Qn&&(wi=Qn-1)}})(yr,Lr,gr,Fr,bn,gn%2),pt(yr,Lr,Nt,Fr,gr-1,gn+1),pt(yr,Lr,Nt,gr+1,bn,gn+1)}})(Se,te,B,0,Se.length-1,0)};Qt.prototype.range=function(H,ie,ce,B){return function(re,fe,Se,te,ge,pt,yr){for(var Lr,Nt,Fr=[0,re.length-1,0],bn=[];Fr.length;){var gn=Fr.pop(),gr=Fr.pop(),vn=Fr.pop();if(gr-vn<=yr)for(var Wr=vn;Wr<=gr;Wr++)Nt=fe[2*Wr+1],(Lr=fe[2*Wr])>=Se&&Lr<=ge&&Nt>=te&&Nt<=pt&&bn.push(re[Wr]);else{var ln=Math.floor((vn+gr)/2);Nt=fe[2*ln+1],(Lr=fe[2*ln])>=Se&&Lr<=ge&&Nt>=te&&Nt<=pt&&bn.push(re[ln]);var Ei=(gn+1)%2;(gn===0?Se<=Lr:te<=Nt)&&(Fr.push(vn),Fr.push(ln-1),Fr.push(Ei)),(gn===0?ge>=Lr:pt>=Nt)&&(Fr.push(ln+1),Fr.push(gr),Fr.push(Ei))}}return bn}(this.ids,this.coords,H,ie,ce,B,this.nodeSize)},Qt.prototype.within=function(H,ie,ce){return function(B,re,fe,Se,te,ge){for(var pt=[0,B.length-1,0],yr=[],Lr=te*te;pt.length;){var Nt=pt.pop(),Fr=pt.pop(),bn=pt.pop();if(Fr-bn<=ge)for(var gn=bn;gn<=Fr;gn++)Me(re[2*gn],re[2*gn+1],fe,Se)<=Lr&&yr.push(B[gn]);else{var gr=Math.floor((bn+Fr)/2),vn=re[2*gr],Wr=re[2*gr+1];Me(vn,Wr,fe,Se)<=Lr&&yr.push(B[gr]);var ln=(Nt+1)%2;(Nt===0?fe-te<=vn:Se-te<=Wr)&&(pt.push(bn),pt.push(gr-1),pt.push(ln)),(Nt===0?fe+te>=vn:Se+te>=Wr)&&(pt.push(gr+1),pt.push(Fr),pt.push(ln))}}return yr}(this.ids,this.coords,H,ie,ce,this.nodeSize)};var Or={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(H){return H}},Dr=function(H){this.options=wt(Object.create(Or),H),this.trees=new Array(this.options.maxZoom+1)};function on(H,ie,ce,B,re){return{x:H,y:ie,zoom:1/0,id:ce,parentId:-1,numPoints:B,properties:re}}function tr(H,ie){var ce=H.geometry.coordinates,B=ce[1];return{x:Fe(ce[0]),y:Ee(B),zoom:1/0,index:ie,parentId:-1}}function se(H){return{type:"Feature",id:H.id,properties:be(H),geometry:{type:"Point",coordinates:[(B=H.x,360*(B-.5)),(ie=H.y,ce=(180-360*ie)*Math.PI/180,360*Math.atan(Math.exp(ce))/Math.PI-90)]}};var ie,ce,B}function be(H){var ie=H.numPoints,ce=ie>=1e4?Math.round(ie/1e3)+"k":ie>=1e3?Math.round(ie/100)/10+"k":ie;return wt(wt({},H.properties),{cluster:!0,cluster_id:H.id,point_count:ie,point_count_abbreviated:ce})}function Fe(H){return H/360+.5}function Ee(H){var ie=Math.sin(H*Math.PI/180),ce=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return ce<0?0:ce>1?1:ce}function wt(H,ie){for(var ce in ie)H[ce]=ie[ce];return H}function Bt(H){return H.x}function w(H){return H.y}function N(H,ie,ce,B,re,fe){var Se=re-ce,te=fe-B;if(Se!==0||te!==0){var ge=((H-ce)*Se+(ie-B)*te)/(Se*Se+te*te);ge>1?(ce=re,B=fe):ge>0&&(ce+=Se*ge,B+=te*ge)}return(Se=H-ce)*Se+(te=ie-B)*te}function he(H,ie,ce,B){var re={id:H===void 0?null:H,type:ie,geometry:ce,tags:B,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(fe){var Se=fe.geometry,te=fe.type;if(te==="Point"||te==="MultiPoint"||te==="LineString")je(fe,Se);else if(te==="Polygon"||te==="MultiLineString")for(var ge=0;ge<Se.length;ge++)je(fe,Se[ge]);else if(te==="MultiPolygon")for(ge=0;ge<Se.length;ge++)for(var pt=0;pt<Se[ge].length;pt++)je(fe,Se[ge][pt])}(re),re}function je(H,ie){for(var ce=0;ce<ie.length;ce+=3)H.minX=Math.min(H.minX,ie[ce]),H.minY=Math.min(H.minY,ie[ce+1]),H.maxX=Math.max(H.maxX,ie[ce]),H.maxY=Math.max(H.maxY,ie[ce+1])}function et(H,ie,ce,B){if(ie.geometry){var re=ie.geometry.coordinates,fe=ie.geometry.type,Se=Math.pow(ce.tolerance/((1<<ce.maxZoom)*ce.extent),2),te=[],ge=ie.id;if(ce.promoteId?ge=ie.properties[ce.promoteId]:ce.generateId&&(ge=B||0),fe==="Point")_t(re,te);else if(fe==="MultiPoint")for(var pt=0;pt<re.length;pt++)_t(re[pt],te);else if(fe==="LineString")Ct(re,te,Se,!1);else if(fe==="MultiLineString"){if(ce.lineMetrics){for(pt=0;pt<re.length;pt++)Ct(re[pt],te=[],Se,!1),H.push(he(ge,"LineString",te,ie.properties));return}V(re,te,Se,!1)}else if(fe==="Polygon")V(re,te,Se,!0);else{if(fe!=="MultiPolygon"){if(fe==="GeometryCollection"){for(pt=0;pt<ie.geometry.geometries.length;pt++)et(H,{id:ge,geometry:ie.geometry.geometries[pt],properties:ie.properties},ce,B);return}throw new Error("Input data is not a valid GeoJSON object.")}for(pt=0;pt<re.length;pt++){var yr=[];V(re[pt],yr,Se,!0),te.push(yr)}}H.push(he(ge,fe,te,ie.properties))}}function _t(H,ie){ie.push(Yt(H[0])),ie.push(kt(H[1])),ie.push(0)}function Ct(H,ie,ce,B){for(var re,fe,Se=0,te=0;te<H.length;te++){var ge=Yt(H[te][0]),pt=kt(H[te][1]);ie.push(ge),ie.push(pt),ie.push(0),te>0&&(Se+=B?(re*pt-ge*fe)/2:Math.sqrt(Math.pow(ge-re,2)+Math.pow(pt-fe,2))),re=ge,fe=pt}var yr=ie.length-3;ie[2]=1,function Lr(Nt,Fr,bn,gn){for(var gr,vn=gn,Wr=bn-Fr>>1,ln=bn-Fr,Ei=Nt[Fr],pn=Nt[Fr+1],wi=Nt[bn],Yi=Nt[bn+1],Yn=Fr+3;Yn<bn;Yn+=3){var Di=N(Nt[Yn],Nt[Yn+1],Ei,pn,wi,Yi);if(Di>vn)gr=Yn,vn=Di;else if(Di===vn){var ki=Math.abs(Yn-Wr);ki<ln&&(gr=Yn,ln=ki)}}vn>gn&&(gr-Fr>3&&Lr(Nt,Fr,gr,gn),Nt[gr+2]=vn,bn-gr>3&&Lr(Nt,gr,bn,gn))}(ie,0,yr,ce),ie[yr+2]=1,ie.size=Math.abs(Se),ie.start=0,ie.end=ie.size}function V(H,ie,ce,B){for(var re=0;re<H.length;re++){var fe=[];Ct(H[re],fe,ce,B),ie.push(fe)}}function Yt(H){return H/360+.5}function kt(H){var ie=Math.sin(H*Math.PI/180),ce=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return ce<0?0:ce>1?1:ce}function fr(H,ie,ce,B,re,fe,Se,te){if(B/=ie,fe>=(ce/=ie)&&Se<B)return H;if(Se<ce||fe>=B)return null;for(var ge=[],pt=0;pt<H.length;pt++){var yr=H[pt],Lr=yr.geometry,Nt=yr.type,Fr=re===0?yr.minX:yr.minY,bn=re===0?yr.maxX:yr.maxY;if(Fr>=ce&&bn<B)ge.push(yr);else if(!(bn<ce||Fr>=B)){var gn=[];if(Nt==="Point"||Nt==="MultiPoint")Cr(Lr,gn,ce,B,re);else if(Nt==="LineString")Tr(Lr,gn,ce,B,re,!1,te.lineMetrics);else if(Nt==="MultiLineString")Je(Lr,gn,ce,B,re,!1);else if(Nt==="Polygon")Je(Lr,gn,ce,B,re,!0);else if(Nt==="MultiPolygon")for(var gr=0;gr<Lr.length;gr++){var vn=[];Je(Lr[gr],vn,ce,B,re,!0),vn.length&&gn.push(vn)}if(gn.length){if(te.lineMetrics&&Nt==="LineString"){for(gr=0;gr<gn.length;gr++)ge.push(he(yr.id,Nt,gn[gr],yr.tags));continue}Nt!=="LineString"&&Nt!=="MultiLineString"||(gn.length===1?(Nt="LineString",gn=gn[0]):Nt="MultiLineString"),Nt!=="Point"&&Nt!=="MultiPoint"||(Nt=gn.length===3?"Point":"MultiPoint"),ge.push(he(yr.id,Nt,gn,yr.tags))}}}return ge.length?ge:null}function Cr(H,ie,ce,B,re){for(var fe=0;fe<H.length;fe+=3){var Se=H[fe+re];Se>=ce&&Se<=B&&(ie.push(H[fe]),ie.push(H[fe+1]),ie.push(H[fe+2]))}}function Tr(H,ie,ce,B,re,fe,Se){for(var te,ge,pt=Ar(H),yr=re===0?ht:lr,Lr=H.start,Nt=0;Nt<H.length-3;Nt+=3){var Fr=H[Nt],bn=H[Nt+1],gn=H[Nt+2],gr=H[Nt+3],vn=H[Nt+4],Wr=re===0?Fr:bn,ln=re===0?gr:vn,Ei=!1;Se&&(te=Math.sqrt(Math.pow(Fr-gr,2)+Math.pow(bn-vn,2))),Wr<ce?ln>ce&&(ge=yr(pt,Fr,bn,gr,vn,ce),Se&&(pt.start=Lr+te*ge)):Wr>B?ln<B&&(ge=yr(pt,Fr,bn,gr,vn,B),Se&&(pt.start=Lr+te*ge)):xt(pt,Fr,bn,gn),ln<ce&&Wr>=ce&&(ge=yr(pt,Fr,bn,gr,vn,ce),Ei=!0),ln>B&&Wr<=B&&(ge=yr(pt,Fr,bn,gr,vn,B),Ei=!0),!fe&&Ei&&(Se&&(pt.end=Lr+te*ge),ie.push(pt),pt=Ar(H)),Se&&(Lr+=te)}var pn=H.length-3;Fr=H[pn],bn=H[pn+1],gn=H[pn+2],(Wr=re===0?Fr:bn)>=ce&&Wr<=B&&xt(pt,Fr,bn,gn),pn=pt.length-3,fe&&pn>=3&&(pt[pn]!==pt[0]||pt[pn+1]!==pt[1])&&xt(pt,pt[0],pt[1],pt[2]),pt.length&&ie.push(pt)}function Ar(H){var ie=[];return ie.size=H.size,ie.start=H.start,ie.end=H.end,ie}function Je(H,ie,ce,B,re,fe){for(var Se=0;Se<H.length;Se++)Tr(H[Se],ie,ce,B,re,fe,!1)}function xt(H,ie,ce,B){H.push(ie),H.push(ce),H.push(B)}function ht(H,ie,ce,B,re,fe){var Se=(fe-ie)/(B-ie);return H.push(fe),H.push(ce+(re-ce)*Se),H.push(1),Se}function lr(H,ie,ce,B,re,fe){var Se=(fe-ce)/(re-ce);return H.push(ie+(B-ie)*Se),H.push(fe),H.push(1),Se}function Kr(H,ie){for(var ce=[],B=0;B<H.length;B++){var re,fe=H[B],Se=fe.type;if(Se==="Point"||Se==="MultiPoint"||Se==="LineString")re=lt(fe.geometry,ie);else if(Se==="MultiLineString"||Se==="Polygon"){re=[];for(var te=0;te<fe.geometry.length;te++)re.push(lt(fe.geometry[te],ie))}else if(Se==="MultiPolygon")for(re=[],te=0;te<fe.geometry.length;te++){for(var ge=[],pt=0;pt<fe.geometry[te].length;pt++)ge.push(lt(fe.geometry[te][pt],ie));re.push(ge)}ce.push(he(fe.id,Se,re,fe.tags))}return ce}function lt(H,ie){var ce=[];ce.size=H.size,H.start!==void 0&&(ce.start=H.start,ce.end=H.end);for(var B=0;B<H.length;B+=3)ce.push(H[B]+ie,H[B+1],H[B+2]);return ce}function Lt(H,ie){if(H.transformed)return H;var ce,B,re,fe=1<<H.z,Se=H.x,te=H.y;for(ce=0;ce<H.features.length;ce++){var ge=H.features[ce],pt=ge.geometry,yr=ge.type;if(ge.geometry=[],yr===1)for(B=0;B<pt.length;B+=2)ge.geometry.push(Jt(pt[B],pt[B+1],ie,fe,Se,te));else for(B=0;B<pt.length;B++){var Lr=[];for(re=0;re<pt[B].length;re+=2)Lr.push(Jt(pt[B][re],pt[B][re+1],ie,fe,Se,te));ge.geometry.push(Lr)}}return H.transformed=!0,H}function Jt(H,ie,ce,B,re,fe){return[Math.round(ce*(H*B-re)),Math.round(ce*(ie*B-fe))]}function or(H,ie,ce,B,re){for(var fe=ie===re.maxZoom?0:re.tolerance/((1<<ie)*re.extent),Se={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ce,y:B,z:ie,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},te=0;te<H.length;te++){Se.numFeatures++,cn(Se,H[te],fe,re);var ge=H[te].minX,pt=H[te].minY,yr=H[te].maxX,Lr=H[te].maxY;ge<Se.minX&&(Se.minX=ge),pt<Se.minY&&(Se.minY=pt),yr>Se.maxX&&(Se.maxX=yr),Lr>Se.maxY&&(Se.maxY=Lr)}return Se}function cn(H,ie,ce,B){var re=ie.geometry,fe=ie.type,Se=[];if(fe==="Point"||fe==="MultiPoint")for(var te=0;te<re.length;te+=3)Se.push(re[te]),Se.push(re[te+1]),H.numPoints++,H.numSimplified++;else if(fe==="LineString")Pn(Se,re,H,ce,!1,!1);else if(fe==="MultiLineString"||fe==="Polygon")for(te=0;te<re.length;te++)Pn(Se,re[te],H,ce,fe==="Polygon",te===0);else if(fe==="MultiPolygon")for(var ge=0;ge<re.length;ge++){var pt=re[ge];for(te=0;te<pt.length;te++)Pn(Se,pt[te],H,ce,!0,te===0)}if(Se.length){var yr=ie.tags||null;if(fe==="LineString"&&B.lineMetrics){for(var Lr in yr={},ie.tags)yr[Lr]=ie.tags[Lr];yr.mapbox_clip_start=re.start/re.size,yr.mapbox_clip_end=re.end/re.size}var Nt={geometry:Se,type:fe==="Polygon"||fe==="MultiPolygon"?3:fe==="LineString"||fe==="MultiLineString"?2:1,tags:yr};ie.id!==null&&(Nt.id=ie.id),H.features.push(Nt)}}function Pn(H,ie,ce,B,re,fe){var Se=B*B;if(B>0&&ie.size<(re?Se:B))ce.numPoints+=ie.length/3;else{for(var te=[],ge=0;ge<ie.length;ge+=3)(B===0||ie[ge+2]>Se)&&(ce.numSimplified++,te.push(ie[ge]),te.push(ie[ge+1])),ce.numPoints++;re&&function(pt,yr){for(var Lr=0,Nt=0,Fr=pt.length,bn=Fr-2;Nt<Fr;bn=Nt,Nt+=2)Lr+=(pt[Nt]-pt[bn])*(pt[Nt+1]+pt[bn+1]);if(Lr>0===yr)for(Nt=0,Fr=pt.length;Nt<Fr/2;Nt+=2){var gn=pt[Nt],gr=pt[Nt+1];pt[Nt]=pt[Fr-2-Nt],pt[Nt+1]=pt[Fr-1-Nt],pt[Fr-2-Nt]=gn,pt[Fr-1-Nt]=gr}}(te,fe),H.push(te)}}function bi(H,ie){var ce=(ie=this.options=function(re,fe){for(var Se in fe)re[Se]=fe[Se];return re}(Object.create(this.options),ie)).debug;if(ce&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");var B=function(re,fe){var Se=[];if(re.type==="FeatureCollection")for(var te=0;te<re.features.length;te++)et(Se,re.features[te],fe,te);else et(Se,re.type==="Feature"?re:{geometry:re},fe);return Se}(H,ie);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(B=function(re,fe){var Se=fe.buffer/fe.extent,te=re,ge=fr(re,1,-1-Se,Se,0,-1,2,fe),pt=fr(re,1,1-Se,2+Se,0,-1,2,fe);return(ge||pt)&&(te=fr(re,1,-Se,1+Se,0,-1,2,fe)||[],ge&&(te=Kr(ge,1).concat(te)),pt&&(te=te.concat(Kr(pt,-1)))),te}(B,ie)).length&&this.splitTile(B,0,0,0),ce&&(B.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Si(H,ie,ce){return 32*((1<<H)*ce+ie)+H}function Ri(H,ie){var ce=H.tileID.canonical;if(!this._geoJSONIndex)return ie(null,null);var B=this._geoJSONIndex.getTile(ce.z,ce.x,ce.y);if(!B)return ie(null,null);var re=new bt(B.features),fe=tt(re);fe.byteOffset===0&&fe.byteLength===fe.buffer.byteLength||(fe=new Uint8Array(fe)),ie(null,{vectorTile:re,rawData:fe.buffer})}Dr.prototype.load=function(H){var ie=this.options,ce=ie.log,B=ie.minZoom,re=ie.maxZoom,fe=ie.nodeSize;ce&&console.time("total time");var Se="prepare "+H.length+" points";ce&&console.time(Se),this.points=H;for(var te=[],ge=0;ge<H.length;ge++)H[ge].geometry&&te.push(tr(H[ge],ge));this.trees[re+1]=new Qt(te,Bt,w,fe,Float32Array),ce&&console.timeEnd(Se);for(var pt=re;pt>=B;pt--){var yr=+Date.now();te=this._cluster(te,pt),this.trees[pt]=new Qt(te,Bt,w,fe,Float32Array),ce&&console.log("z%d: %d clusters in %dms",pt,te.length,+Date.now()-yr)}return ce&&console.timeEnd("total time"),this},Dr.prototype.getClusters=function(H,ie){var ce=((H[0]+180)%360+360)%360-180,B=Math.max(-90,Math.min(90,H[1])),re=H[2]===180?180:((H[2]+180)%360+360)%360-180,fe=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)ce=-180,re=180;else if(ce>re){var Se=this.getClusters([ce,B,180,fe],ie),te=this.getClusters([-180,B,re,fe],ie);return Se.concat(te)}for(var ge=this.trees[this._limitZoom(ie)],pt=[],yr=0,Lr=ge.range(Fe(ce),Ee(fe),Fe(re),Ee(B));yr<Lr.length;yr+=1){var Nt=ge.points[Lr[yr]];pt.push(Nt.numPoints?se(Nt):this.points[Nt.index])}return pt},Dr.prototype.getChildren=function(H){var ie=this._getOriginId(H),ce=this._getOriginZoom(H),B="No cluster with the specified id.",re=this.trees[ce];if(!re)throw new Error(B);var fe=re.points[ie];if(!fe)throw new Error(B);for(var Se=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),te=[],ge=0,pt=re.within(fe.x,fe.y,Se);ge<pt.length;ge+=1){var yr=re.points[pt[ge]];yr.parentId===H&&te.push(yr.numPoints?se(yr):this.points[yr.index])}if(te.length===0)throw new Error(B);return te},Dr.prototype.getLeaves=function(H,ie,ce){var B=[];return this._appendLeaves(B,H,ie=ie||10,ce=ce||0,0),B},Dr.prototype.getTile=function(H,ie,ce){var B=this.trees[this._limitZoom(H)],re=Math.pow(2,H),fe=this.options,Se=fe.radius/fe.extent,te=(ce-Se)/re,ge=(ce+1+Se)/re,pt={features:[]};return this._addTileFeatures(B.range((ie-Se)/re,te,(ie+1+Se)/re,ge),B.points,ie,ce,re,pt),ie===0&&this._addTileFeatures(B.range(1-Se/re,te,1,ge),B.points,re,ce,re,pt),ie===re-1&&this._addTileFeatures(B.range(0,te,Se/re,ge),B.points,-1,ce,re,pt),pt.features.length?pt:null},Dr.prototype.getClusterExpansionZoom=function(H){for(var ie=this._getOriginZoom(H)-1;ie<=this.options.maxZoom;){var ce=this.getChildren(H);if(ie++,ce.length!==1)break;H=ce[0].properties.cluster_id}return ie},Dr.prototype._appendLeaves=function(H,ie,ce,B,re){for(var fe=0,Se=this.getChildren(ie);fe<Se.length;fe+=1){var te=Se[fe],ge=te.properties;if(ge&&ge.cluster?re+ge.point_count<=B?re+=ge.point_count:re=this._appendLeaves(H,ge.cluster_id,ce,B,re):re<B?re++:H.push(te),H.length===ce)break}return re},Dr.prototype._addTileFeatures=function(H,ie,ce,B,re,fe){for(var Se=0,te=H;Se<te.length;Se+=1){var ge=ie[te[Se]],pt=ge.numPoints,yr={type:1,geometry:[[Math.round(this.options.extent*(ge.x*re-ce)),Math.round(this.options.extent*(ge.y*re-B))]],tags:pt?be(ge):this.points[ge.index].properties},Lr=void 0;pt?Lr=ge.id:this.options.generateId?Lr=ge.index:this.points[ge.index].id&&(Lr=this.points[ge.index].id),Lr!==void 0&&(yr.id=Lr),fe.features.push(yr)}},Dr.prototype._limitZoom=function(H){return Math.max(this.options.minZoom,Math.min(+H,this.options.maxZoom+1))},Dr.prototype._cluster=function(H,ie){for(var ce=[],B=this.options,re=B.reduce,fe=B.minPoints,Se=B.radius/(B.extent*Math.pow(2,ie)),te=0;te<H.length;te++){var ge=H[te];if(!(ge.zoom<=ie)){ge.zoom=ie;for(var pt=this.trees[ie+1],yr=pt.within(ge.x,ge.y,Se),Lr=ge.numPoints||1,Nt=Lr,Fr=0,bn=yr;Fr<bn.length;Fr+=1){var gn=pt.points[bn[Fr]];gn.zoom>ie&&(Nt+=gn.numPoints||1)}if(Nt>=fe){for(var gr=ge.x*Lr,vn=ge.y*Lr,Wr=re&&Lr>1?this._map(ge,!0):null,ln=(te<<5)+(ie+1)+this.points.length,Ei=0,pn=yr;Ei<pn.length;Ei+=1){var wi=pt.points[pn[Ei]];if(!(wi.zoom<=ie)){wi.zoom=ie;var Yi=wi.numPoints||1;gr+=wi.x*Yi,vn+=wi.y*Yi,wi.parentId=ln,re&&(Wr||(Wr=this._map(ge,!0)),re(Wr,this._map(wi)))}}ge.parentId=ln,ce.push(on(gr/Nt,vn/Nt,ln,Nt,Wr))}else if(ce.push(ge),Nt>1)for(var Yn=0,Di=yr;Yn<Di.length;Yn+=1){var ki=pt.points[Di[Yn]];ki.zoom<=ie||(ki.zoom=ie,ce.push(ki))}}}return ce},Dr.prototype._getOriginId=function(H){return H-this.points.length>>5},Dr.prototype._getOriginZoom=function(H){return(H-this.points.length)%32},Dr.prototype._map=function(H,ie){if(H.numPoints)return ie?wt({},H.properties):H.properties;var ce=this.points[H.index].properties,B=this.options.map(ce);return ie&&B===ce?wt({},B):B},bi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},bi.prototype.splitTile=function(H,ie,ce,B,re,fe,Se){for(var te=[H,ie,ce,B],ge=this.options,pt=ge.debug;te.length;){B=te.pop(),ce=te.pop(),ie=te.pop(),H=te.pop();var yr=1<<ie,Lr=Si(ie,ce,B),Nt=this.tiles[Lr];if(!Nt&&(pt>1&&console.time("creation"),Nt=this.tiles[Lr]=or(H,ie,ce,B,ge),this.tileCoords.push({z:ie,x:ce,y:B}),pt)){pt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,ce,B,Nt.numFeatures,Nt.numPoints,Nt.numSimplified),console.timeEnd("creation"));var Fr="z"+ie;this.stats[Fr]=(this.stats[Fr]||0)+1,this.total++}if(Nt.source=H,re){if(ie===ge.maxZoom||ie===re)continue;var bn=1<<re-ie;if(ce!==Math.floor(fe/bn)||B!==Math.floor(Se/bn))continue}else if(ie===ge.indexMaxZoom||Nt.numPoints<=ge.indexMaxPoints)continue;if(Nt.source=null,H.length!==0){pt>1&&console.time("clipping");var gn,gr,vn,Wr,ln,Ei,pn=.5*ge.buffer/ge.extent,wi=.5-pn,Yi=.5+pn,Yn=1+pn;gn=gr=vn=Wr=null,ln=fr(H,yr,ce-pn,ce+Yi,0,Nt.minX,Nt.maxX,ge),Ei=fr(H,yr,ce+wi,ce+Yn,0,Nt.minX,Nt.maxX,ge),H=null,ln&&(gn=fr(ln,yr,B-pn,B+Yi,1,Nt.minY,Nt.maxY,ge),gr=fr(ln,yr,B+wi,B+Yn,1,Nt.minY,Nt.maxY,ge),ln=null),Ei&&(vn=fr(Ei,yr,B-pn,B+Yi,1,Nt.minY,Nt.maxY,ge),Wr=fr(Ei,yr,B+wi,B+Yn,1,Nt.minY,Nt.maxY,ge),Ei=null),pt>1&&console.timeEnd("clipping"),te.push(gn||[],ie+1,2*ce,2*B),te.push(gr||[],ie+1,2*ce,2*B+1),te.push(vn||[],ie+1,2*ce+1,2*B),te.push(Wr||[],ie+1,2*ce+1,2*B+1)}}},bi.prototype.getTile=function(H,ie,ce){var B=this.options,re=B.extent,fe=B.debug;if(H<0||H>24)return null;var Se=1<<H,te=Si(H,ie=(ie%Se+Se)%Se,ce);if(this.tiles[te])return Lt(this.tiles[te],re);fe>1&&console.log("drilling down to z%d-%d-%d",H,ie,ce);for(var ge,pt=H,yr=ie,Lr=ce;!ge&&pt>0;)pt--,yr=Math.floor(yr/2),Lr=Math.floor(Lr/2),ge=this.tiles[Si(pt,yr,Lr)];return ge&&ge.source?(fe>1&&console.log("found parent tile z%d-%d-%d",pt,yr,Lr),fe>1&&console.time("drilling down"),this.splitTile(ge.source,pt,yr,Lr,H,ie,ce),fe>1&&console.timeEnd("drilling down"),this.tiles[te]?Lt(this.tiles[te],re):null):null};var ia=function(H){function ie(ce,B,re,fe){H.call(this,ce,B,re,Ri),fe&&(this.loadGeoJSON=fe)}return H&&(ie.__proto__=H),(ie.prototype=Object.create(H&&H.prototype)).constructor=ie,ie.prototype.loadData=function(ce,B){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=B,this._pendingLoadDataParams=ce,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ie.prototype._loadData=function(){var ce=this;if(this._pendingCallback&&this._pendingLoadDataParams){var B=this._pendingCallback,re=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var fe=!!(re&&re.request&&re.request.collectResourceTiming)&&new p.RequestPerformance(re.request);this.loadGeoJSON(re,function(Se,te){if(Se||!te)return B(Se);if(typeof te!="object")return B(new Error("Input data given to '"+re.source+"' is not a valid GeoJSON object."));(function Nt(Fr,bn){var gn,gr=Fr&&Fr.type;if(gr==="FeatureCollection")for(gn=0;gn<Fr.features.length;gn++)Nt(Fr.features[gn],bn);else if(gr==="GeometryCollection")for(gn=0;gn<Fr.geometries.length;gn++)Nt(Fr.geometries[gn],bn);else if(gr==="Feature")Nt(Fr.geometry,bn);else if(gr==="Polygon")Vt(Fr.coordinates,bn);else if(gr==="MultiPolygon")for(gn=0;gn<Fr.coordinates.length;gn++)Vt(Fr.coordinates[gn],bn);return Fr})(te,!0);try{if(re.filter){var ge=p.createExpression(re.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ge.result==="error")throw new Error(ge.value.map(function(Nt){return Nt.key+": "+Nt.message}).join(", "));var pt=te.features.filter(function(Nt){return ge.value.evaluate({zoom:0},Nt)});te={type:"FeatureCollection",features:pt}}ce._geoJSONIndex=re.cluster?new Dr(function(Nt){var Fr=Nt.superclusterOptions,bn=Nt.clusterProperties;if(!bn||!Fr)return Fr;for(var gn={},gr={},vn={accumulated:null,zoom:0},Wr={properties:null},ln=Object.keys(bn),Ei=0,pn=ln;Ei<pn.length;Ei+=1){var wi=pn[Ei],Yi=bn[wi],Yn=Yi[0],Di=p.createExpression(Yi[1]),ki=p.createExpression(typeof Yn=="string"?[Yn,["accumulated"],["get",wi]]:Yn);gn[wi]=Di.value,gr[wi]=ki.value}return Fr.map=function(za){Wr.properties=za;for(var Wn={},ai=0,Ai=ln;ai<Ai.length;ai+=1){var Qn=Ai[ai];Wn[Qn]=gn[Qn].evaluate(vn,Wr)}return Wn},Fr.reduce=function(za,Wn){Wr.properties=Wn;for(var ai=0,Ai=ln;ai<Ai.length;ai+=1){var Qn=Ai[ai];vn.accumulated=za[Qn],za[Qn]=gr[Qn].evaluate(vn,Wr)}},Fr}(re)).load(te.features):function(Nt,Fr){return new bi(Nt,Fr)}(te,re.geojsonVtOptions)}catch(Nt){return B(Nt)}ce.loaded={};var yr={};if(fe){var Lr=fe.finish();Lr&&(yr.resourceTiming={},yr.resourceTiming[re.source]=JSON.parse(JSON.stringify(Lr)))}B(null,yr)})}},ie.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ie.prototype.reloadTile=function(ce,B){var re=this.loaded;return re&&re[ce.uid]?H.prototype.reloadTile.call(this,ce,B):this.loadTile(ce,B)},ie.prototype.loadGeoJSON=function(ce,B){if(ce.request)p.getJSON(ce.request,B);else{if(typeof ce.data!="string")return B(new Error("Input data given to '"+ce.source+"' is not a valid GeoJSON object."));try{return B(null,JSON.parse(ce.data))}catch(re){return B(new Error("Input data given to '"+ce.source+"' is not a valid GeoJSON object."))}}},ie.prototype.removeSource=function(ce,B){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),B()},ie.prototype.getClusterExpansionZoom=function(ce,B){try{B(null,this._geoJSONIndex.getClusterExpansionZoom(ce.clusterId))}catch(re){B(re)}},ie.prototype.getClusterChildren=function(ce,B){try{B(null,this._geoJSONIndex.getChildren(ce.clusterId))}catch(re){B(re)}},ie.prototype.getClusterLeaves=function(ce,B){try{B(null,this._geoJSONIndex.getLeaves(ce.clusterId,ce.limit,ce.offset))}catch(re){B(re)}},ie}(Be),pi=function(H){var ie=this;this.self=H,this.actor=new p.Actor(H,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Be,geojson:ia},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ce,B){if(ie.workerSourceTypes[ce])throw new Error('Worker source with name "'+ce+'" already registered.');ie.workerSourceTypes[ce]=B},this.self.registerRTLTextPlugin=function(ce){if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=ce.applyArabicShaping,p.plugin.processBidirectionalText=ce.processBidirectionalText,p.plugin.processStyledBidirectionalText=ce.processStyledBidirectionalText}};return pi.prototype.setReferrer=function(H,ie){this.referrer=ie},pi.prototype.setImages=function(H,ie,ce){for(var B in this.availableImages[H]=ie,this.workerSources[H]){var re=this.workerSources[H][B];for(var fe in re)re[fe].availableImages=ie}ce()},pi.prototype.setLayers=function(H,ie,ce){this.getLayerIndex(H).replace(ie),ce()},pi.prototype.updateLayers=function(H,ie,ce){this.getLayerIndex(H).update(ie.layers,ie.removedIds),ce()},pi.prototype.loadTile=function(H,ie,ce){this.getWorkerSource(H,ie.type,ie.source).loadTile(ie,ce)},pi.prototype.loadDEMTile=function(H,ie,ce){this.getDEMWorkerSource(H,ie.source).loadTile(ie,ce)},pi.prototype.reloadTile=function(H,ie,ce){this.getWorkerSource(H,ie.type,ie.source).reloadTile(ie,ce)},pi.prototype.abortTile=function(H,ie,ce){this.getWorkerSource(H,ie.type,ie.source).abortTile(ie,ce)},pi.prototype.removeTile=function(H,ie,ce){this.getWorkerSource(H,ie.type,ie.source).removeTile(ie,ce)},pi.prototype.removeDEMTile=function(H,ie){this.getDEMWorkerSource(H,ie.source).removeTile(ie)},pi.prototype.removeSource=function(H,ie,ce){if(this.workerSources[H]&&this.workerSources[H][ie.type]&&this.workerSources[H][ie.type][ie.source]){var B=this.workerSources[H][ie.type][ie.source];delete this.workerSources[H][ie.type][ie.source],B.removeSource!==void 0?B.removeSource(ie,ce):ce()}},pi.prototype.loadWorkerSource=function(H,ie,ce){try{this.self.importScripts(ie.url),ce()}catch(B){ce(B.toString())}},pi.prototype.syncRTLPluginState=function(H,ie,ce){try{p.plugin.setState(ie);var B=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&B!=null){this.self.importScripts(B);var re=p.plugin.isParsed();ce(re?void 0:new Error("RTL Text Plugin failed to import scripts from "+B),re)}}catch(fe){ce(fe.toString())}},pi.prototype.getAvailableImages=function(H){var ie=this.availableImages[H];return ie||(ie=[]),ie},pi.prototype.getLayerIndex=function(H){var ie=this.layerIndexes[H];return ie||(ie=this.layerIndexes[H]=new W),ie},pi.prototype.getWorkerSource=function(H,ie,ce){var B=this;return this.workerSources[H]||(this.workerSources[H]={}),this.workerSources[H][ie]||(this.workerSources[H][ie]={}),this.workerSources[H][ie][ce]||(this.workerSources[H][ie][ce]=new this.workerSourceTypes[ie]({send:function(re,fe,Se){B.actor.send(re,fe,Se,H)}},this.getLayerIndex(H),this.getAvailableImages(H))),this.workerSources[H][ie][ce]},pi.prototype.getDEMWorkerSource=function(H,ie){return this.demWorkerSources[H]||(this.demWorkerSources[H]={}),this.demWorkerSources[H][ie]||(this.demWorkerSources[H][ie]=new $e),this.demWorkerSources[H][ie]},pi.prototype.enforceCacheSizeLimit=function(H,ie){p.enforceCacheSizeLimit(ie)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new pi(self)),pi}),E(["./shared"],function(p){"use strict";var b=p.createCommonjsModule(function(i){function u(g){return!a(g)}function a(g){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var T,R,G=new Blob([""],{type:"text/javascript"}),ee=URL.createObjectURL(G);try{R=new Worker(ee),T=!0}catch(ve){T=!1}return R&&R.terminate(),URL.revokeObjectURL(ee),T}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var T=document.createElement("canvas");T.width=T.height=1;var R=T.getContext("2d");if(!R)return!1;var G=R.getImageData(0,0,1,1);return G&&G.width===T.width}()?(h[S=g&&g.failIfMajorPerformanceCaveat]===void 0&&(h[S]=function(T){var R=function(ee){var ve=document.createElement("canvas"),ye=Object.create(u.webGLContextAttributes);return ye.failIfMajorPerformanceCaveat=ee,ve.probablySupportsContext?ve.probablySupportsContext("webgl",ye)||ve.probablySupportsContext("experimental-webgl",ye):ve.supportsContext?ve.supportsContext("webgl",ye)||ve.supportsContext("experimental-webgl",ye):ve.getContext("webgl",ye)||ve.getContext("experimental-webgl",ye)}(T);if(!R)return!1;var G=R.createShader(R.VERTEX_SHADER);return!(!G||R.isContextLost())&&(R.shaderSource(G,"void main() {}"),R.compileShader(G),R.getShaderParameter(G,R.COMPILE_STATUS)===!0)}(S)),h[S]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var S}i.exports?i.exports=u:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=u,window.mapboxgl.notSupportedReason=a);var h={};u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),X={create:function(i,u,a){var h=p.window.document.createElement(i);return u!==void 0&&(h.className=u),a&&a.appendChild(h),h},createNS:function(i,u){return p.window.document.createElementNS(i,u)}},W=p.window.document&&p.window.document.documentElement.style;function $(i){if(!W)return i[0];for(var u=0;u<i.length;u++)if(i[u]in W)return i[u];return i[0]}var I,k=$(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);X.disableDrag=function(){W&&k&&(I=W[k],W[k]="none")},X.enableDrag=function(){W&&k&&(W[k]=I)};var Ce=$(["transform","WebkitTransform"]);X.setTransform=function(i,u){i.style[Ce]=u};var Be=!1;try{var We=Object.defineProperty({},"passive",{get:function(){Be=!0}});p.window.addEventListener("test",We,We),p.window.removeEventListener("test",We,We)}catch(i){Be=!1}X.addEventListener=function(i,u,a,h){h===void 0&&(h={}),i.addEventListener(u,a,"passive"in h&&Be?h:h.capture)},X.removeEventListener=function(i,u,a,h){h===void 0&&(h={}),i.removeEventListener(u,a,"passive"in h&&Be?h:h.capture)};var $e=function(i){i.preventDefault(),i.stopPropagation(),p.window.removeEventListener("click",$e,!0)};function Vt(i){var u=i.userImage;return!!(u&&u.render&&u.render())&&(i.data.replace(new Uint8Array(u.data.buffer)),!0)}X.suppressClick=function(){p.window.addEventListener("click",$e,!0),p.window.setTimeout(function(){p.window.removeEventListener("click",$e,!0)},0)},X.mousePos=function(i,u){var a=i.getBoundingClientRect();return new p.Point(u.clientX-a.left-i.clientLeft,u.clientY-a.top-i.clientTop)},X.touchPos=function(i,u){for(var a=i.getBoundingClientRect(),h=[],g=0;g<u.length;g++)h.push(new p.Point(u[g].clientX-a.left-i.clientLeft,u[g].clientY-a.top-i.clientTop));return h},X.mouseButton=function(i){return p.window.InstallTrigger!==void 0&&i.button===2&&i.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:i.button},X.remove=function(i){i.parentNode&&i.parentNode.removeChild(i)};var Ht=function(i){function u(){i.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.isLoaded=function(){return this.loaded},u.prototype.setLoaded=function(a){if(this.loaded!==a&&(this.loaded=a,a)){for(var h=0,g=this.requestors;h<g.length;h+=1){var S=g[h];this._notify(S.ids,S.callback)}this.requestors=[]}},u.prototype.getImage=function(a){return this.images[a]},u.prototype.addImage=function(a,h){this._validate(a,h)&&(this.images[a]=h)},u.prototype._validate=function(a,h){var g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new p.ErrorEvent(new Error('Image "'+a+'" has invalid "stretchX" value'))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new p.ErrorEvent(new Error('Image "'+a+'" has invalid "stretchY" value'))),g=!1),this._validateContent(h.content,h)||(this.fire(new p.ErrorEvent(new Error('Image "'+a+'" has invalid "content" value'))),g=!1),g},u.prototype._validateStretch=function(a,h){if(!a)return!0;for(var g=0,S=0,T=a;S<T.length;S+=1){var R=T[S];if(R[0]<g||R[1]<R[0]||h<R[1])return!1;g=R[1]}return!0},u.prototype._validateContent=function(a,h){return!(a&&(a.length!==4||a[0]<0||h.data.width<a[0]||a[1]<0||h.data.height<a[1]||a[2]<0||h.data.width<a[2]||a[3]<0||h.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))},u.prototype.updateImage=function(a,h){h.version=this.images[a].version+1,this.images[a]=h,this.updatedImages[a]=!0},u.prototype.removeImage=function(a){var h=this.images[a];delete this.images[a],delete this.patterns[a],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()},u.prototype.listImages=function(){return Object.keys(this.images)},u.prototype.getImages=function(a,h){var g=!0;if(!this.isLoaded())for(var S=0,T=a;S<T.length;S+=1)this.images[T[S]]||(g=!1);this.isLoaded()||g?this._notify(a,h):this.requestors.push({ids:a,callback:h})},u.prototype._notify=function(a,h){for(var g={},S=0,T=a;S<T.length;S+=1){var R=T[S];this.images[R]||this.fire(new p.Event("styleimagemissing",{id:R}));var G=this.images[R];G?g[R]={data:G.data.clone(),pixelRatio:G.pixelRatio,sdf:G.sdf,version:G.version,stretchX:G.stretchX,stretchY:G.stretchY,content:G.content,hasRenderCallback:Boolean(G.userImage&&G.userImage.render)}:p.warnOnce('Image "'+R+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}h(null,g)},u.prototype.getPixelSize=function(){var a=this.atlasImage;return{width:a.width,height:a.height}},u.prototype.getPattern=function(a){var h=this.patterns[a],g=this.getImage(a);if(!g)return null;if(h&&h.position.version===g.version)return h.position;if(h)h.position.version=g.version;else{var S={w:g.data.width+2,h:g.data.height+2,x:0,y:0},T=new p.ImagePosition(S,g);this.patterns[a]={bin:S,position:T}}return this._updatePatternAtlas(),this.patterns[a].position},u.prototype.bind=function(a){var h=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(a,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)},u.prototype._updatePatternAtlas=function(){var a=[];for(var h in this.patterns)a.push(this.patterns[h].bin);var g=p.potpack(a),S=g.w,T=g.h,R=this.atlasImage;for(var G in R.resize({width:S||1,height:T||1}),this.patterns){var ee=this.patterns[G].bin,ve=ee.x+1,ye=ee.y+1,we=this.images[G].data,Ke=we.width,He=we.height;p.RGBAImage.copy(we,R,{x:0,y:0},{x:ve,y:ye},{width:Ke,height:He}),p.RGBAImage.copy(we,R,{x:0,y:He-1},{x:ve,y:ye-1},{width:Ke,height:1}),p.RGBAImage.copy(we,R,{x:0,y:0},{x:ve,y:ye+He},{width:Ke,height:1}),p.RGBAImage.copy(we,R,{x:Ke-1,y:0},{x:ve-1,y:ye},{width:1,height:He}),p.RGBAImage.copy(we,R,{x:0,y:0},{x:ve+Ke,y:ye},{width:1,height:He})}this.dirty=!0},u.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},u.prototype.dispatchRenderCallbacks=function(a){for(var h=0,g=a;h<g.length;h+=1){var S=g[h];if(!this.callbackDispatchedThisFrame[S]){this.callbackDispatchedThisFrame[S]=!0;var T=this.images[S];Vt(T)&&this.updateImage(S,T)}}},u}(p.Evented),At=dt,Ot=dt,bt=1e20;function dt(i,u,a,h,g,S){this.fontSize=i||24,this.buffer=u===void 0?3:u,this.cutoff=h||.25,this.fontFamily=g||"sans-serif",this.fontWeight=S||"normal",this.radius=a||8;var T=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=T,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.d=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Int16Array(T),this.middle=Math.round(T/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Pr(i,u,a,h,g,S,T){for(var R=0;R<u;R++){for(var G=0;G<a;G++)h[G]=i[G*u+R];for(er(h,g,S,T,a),G=0;G<a;G++)i[G*u+R]=g[G]}for(G=0;G<a;G++){for(R=0;R<u;R++)h[R]=i[G*u+R];for(er(h,g,S,T,u),R=0;R<u;R++)i[G*u+R]=Math.sqrt(g[R])}}function er(i,u,a,h,g){a[0]=0,h[0]=-bt,h[1]=+bt;for(var S=1,T=0;S<g;S++){for(var R=(i[S]+S*S-(i[a[T]]+a[T]*a[T]))/(2*S-2*a[T]);R<=h[T];)T--,R=(i[S]+S*S-(i[a[T]]+a[T]*a[T]))/(2*S-2*a[T]);a[++T]=S,h[T]=R,h[T+1]=+bt}for(S=0,T=0;S<g;S++){for(;h[T+1]<S;)T++;u[S]=(S-a[T])*(S-a[T])+i[a[T]]}}dt.prototype.draw=function(i){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(i,this.buffer,this.middle);for(var u=this.ctx.getImageData(0,0,this.size,this.size),a=new Uint8ClampedArray(this.size*this.size),h=0;h<this.size*this.size;h++){var g=u.data[4*h+3]/255;this.gridOuter[h]=g===1?0:g===0?bt:Math.pow(Math.max(0,.5-g),2),this.gridInner[h]=g===1?bt:g===0?0:Math.pow(Math.max(0,g-.5),2)}for(Pr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Pr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),h=0;h<this.size*this.size;h++)a[h]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[h]-this.gridInner[h])/this.radius+this.cutoff))));return a},At.default=Ot;var Ft=function(i,u){this.requestManager=i,this.localIdeographFontFamily=u,this.entries={}};Ft.prototype.setURL=function(i){this.url=i},Ft.prototype.getGlyphs=function(i,u){var a=this,h=[];for(var g in i)for(var S=0,T=i[g];S<T.length;S+=1)h.push({stack:g,id:T[S]});p.asyncAll(h,function(R,G){var ee=R.stack,ve=R.id,ye=a.entries[ee];ye||(ye=a.entries[ee]={glyphs:{},requests:{},ranges:{}});var we=ye.glyphs[ve];if(we===void 0){if(we=a._tinySDF(ye,ee,ve))return ye.glyphs[ve]=we,void G(null,{stack:ee,id:ve,glyph:we});var Ke=Math.floor(ve/256);if(256*Ke>65535)G(new Error("glyphs > 65535 not supported"));else if(ye.ranges[Ke])G(null,{stack:ee,id:ve,glyph:we});else{var He=ye.requests[Ke];He||(He=ye.requests[Ke]=[],Ft.loadGlyphRange(ee,Ke,a.url,a.requestManager,function(at,ze){if(ze){for(var it in ze)a._doesCharSupportLocalGlyph(+it)||(ye.glyphs[+it]=ze[+it]);ye.ranges[Ke]=!0}for(var mt=0,Ut=He;mt<Ut.length;mt+=1)(0,Ut[mt])(at,ze);delete ye.requests[Ke]})),He.push(function(at,ze){at?G(at):ze&&G(null,{stack:ee,id:ve,glyph:ze[ve]||null})})}}else G(null,{stack:ee,id:ve,glyph:we})},function(R,G){if(R)u(R);else if(G){for(var ee={},ve=0,ye=G;ve<ye.length;ve+=1){var we=ye[ve],Ke=we.stack,He=we.id,at=we.glyph;(ee[Ke]||(ee[Ke]={}))[He]=at&&{id:at.id,bitmap:at.bitmap.clone(),metrics:at.metrics}}u(null,ee)}})},Ft.prototype._doesCharSupportLocalGlyph=function(i){return!!this.localIdeographFontFamily&&(p.isChar["CJK Unified Ideographs"](i)||p.isChar["Hangul Syllables"](i)||p.isChar.Hiragana(i)||p.isChar.Katakana(i))},Ft.prototype._tinySDF=function(i,u,a){var h=this.localIdeographFontFamily;if(h&&this._doesCharSupportLocalGlyph(a)){var g=i.tinySDF;if(!g){var S="400";/bold/i.test(u)?S="900":/medium/i.test(u)?S="500":/light/i.test(u)&&(S="200"),g=i.tinySDF=new Ft.TinySDF(24,3,8,.25,h,S)}return{id:a,bitmap:new p.AlphaImage({width:30,height:30},g.draw(String.fromCharCode(a))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Ft.loadGlyphRange=function(i,u,a,h,g){var S=256*u,T=S+255,R=h.transformRequest(h.normalizeGlyphsURL(a).replace("{fontstack}",i).replace("{range}",S+"-"+T),p.ResourceType.Glyphs);p.getArrayBuffer(R,function(G,ee){if(G)g(G);else if(ee){for(var ve={},ye=0,we=p.parseGlyphPBF(ee);ye<we.length;ye+=1){var Ke=we[ye];ve[Ke.id]=Ke}g(null,ve)}})},Ft.TinySDF=At;var tt=function(){this.specification=p.styleSpec.light.position};tt.prototype.possiblyEvaluate=function(i,u){return p.sphericalToCartesian(i.expression.evaluate(u))},tt.prototype.interpolate=function(i,u,a){return{x:p.number(i.x,u.x,a),y:p.number(i.y,u.y,a),z:p.number(i.z,u.z,a)}};var Ne=new p.Properties({anchor:new p.DataConstantProperty(p.styleSpec.light.anchor),position:new tt,color:new p.DataConstantProperty(p.styleSpec.light.color),intensity:new p.DataConstantProperty(p.styleSpec.light.intensity)}),Qe=function(i){function u(a){i.call(this),this._transitionable=new p.Transitionable(Ne),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getLight=function(){return this._transitionable.serialize()},u.prototype.setLight=function(a,h){if(h===void 0&&(h={}),!this._validate(p.validateLight,a,h))for(var g in a){var S=a[g];p.endsWith(g,"-transition")?this._transitionable.setTransition(g.slice(0,-"-transition".length),S):this._transitionable.setValue(g,S)}},u.prototype.updateTransitions=function(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)},u.prototype.hasTransition=function(){return this._transitioning.hasTransition()},u.prototype.recalculate=function(a){this.properties=this._transitioning.possiblyEvaluate(a)},u.prototype._validate=function(a,h,g){return(!g||g.validate!==!1)&&p.emitValidationErrors(this,a.call(p.validateStyle,p.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:p.styleSpec})))},u}(p.Evented),Ie=function(i,u){this.width=i,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Ie.prototype.getDash=function(i,u){var a=i.join(",")+String(u);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(i,u)),this.dashEntry[a]},Ie.prototype.getDashRanges=function(i,u,a){var h=[],g=i.length%2==1?-i[i.length-1]*a:0,S=i[0]*a,T=!0;h.push({left:g,right:S,isDash:T,zeroLength:i[0]===0});for(var R=i[0],G=1;G<i.length;G++){var ee=i[G];h.push({left:g=R*a,right:S=(R+=ee)*a,isDash:T=!T,zeroLength:ee===0})}return h},Ie.prototype.addRoundDash=function(i,u,a){for(var h=u/2,g=-a;g<=a;g++)for(var S=this.width*(this.nextRow+a+g),T=0,R=i[T],G=0;G<this.width;G++){G/R.right>1&&(R=i[++T]);var ee=Math.abs(G-R.left),ve=Math.abs(G-R.right),ye=Math.min(ee,ve),we=void 0,Ke=g/a*(h+1);if(R.isDash){var He=h-Math.abs(Ke);we=Math.sqrt(ye*ye+He*He)}else we=h-Math.sqrt(ye*ye+Ke*Ke);this.data[S+G]=Math.max(0,Math.min(255,we+128))}},Ie.prototype.addRegularDash=function(i){for(var u=i.length-1;u>=0;--u){var a=i[u],h=i[u+1];a.zeroLength?i.splice(u,1):h&&h.isDash===a.isDash&&(h.left=a.left,i.splice(u,1))}var g=i[0],S=i[i.length-1];g.isDash===S.isDash&&(g.left=S.left-this.width,S.right=g.right+this.width);for(var T=this.width*this.nextRow,R=0,G=i[R],ee=0;ee<this.width;ee++){ee/G.right>1&&(G=i[++R]);var ve=Math.abs(ee-G.left),ye=Math.abs(ee-G.right),we=Math.min(ve,ye);this.data[T+ee]=Math.max(0,Math.min(255,(G.isDash?we:-we)+128))}},Ie.prototype.addDash=function(i,u){var a=u?7:0,h=2*a+1;if(this.nextRow+h>this.height)return p.warnOnce("LineAtlas out of space"),null;for(var g=0,S=0;S<i.length;S++)g+=i[S];if(g!==0){var T=this.width/g,R=this.getDashRanges(i,this.width,T);u?this.addRoundDash(R,T,a):this.addRegularDash(R)}var G={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:g};return this.nextRow+=h,this.dirty=!0,G},Ie.prototype.bind=function(i){var u=i.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))};var Ae=function i(u,a){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=p.uniqueId();for(var h=this.workerPool.acquire(this.id),g=0;g<h.length;g++){var S=new i.Actor(h[g],a,this.id);S.name="Worker "+g,this.actors.push(S)}};function Ue(i,u,a){var h=function(g,S){if(g)return a(g);if(S){var T=p.pick(p.extend(S,i),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(T.vectorLayers=S.vector_layers,T.vectorLayerIds=T.vectorLayers.map(function(R){return R.id})),T.tiles=u.canonicalizeTileset(T,i.url),a(null,T)}};return i.url?p.getJSON(u.transformRequest(u.normalizeSourceURL(i.url),p.ResourceType.Source),h):p.browser.frame(function(){return h(null,i)})}Ae.prototype.broadcast=function(i,u,a){p.asyncAll(this.actors,function(h,g){h.send(i,u,g)},a=a||function(){})},Ae.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Ae.prototype.remove=function(){this.actors.forEach(function(i){i.remove()}),this.actors=[],this.workerPool.release(this.id)},Ae.Actor=p.Actor;var St=function(i,u,a){this.bounds=p.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=u||0,this.maxzoom=a||24};St.prototype.validateBounds=function(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]},St.prototype.contains=function(i){var u=Math.pow(2,i.z),a=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*u),h=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*u),g=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*u),S=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*u);return i.x>=a&&i.x<g&&i.y>=h&&i.y<S};var ur=function(i){function u(a,h,g,S){if(i.call(this),this.id=a,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(h,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(S)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var a=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ue(this._options,this.map._requestManager,function(h,g){a._tileJSONRequest=null,a._loaded=!0,h?a.fire(new p.ErrorEvent(h)):g&&(p.extend(a,g),g.bounds&&(a.tileBounds=new St(g.bounds,a.minzoom,a.maxzoom)),p.postTurnstileEvent(g.tiles,a.map._requestManager._customAccessToken),p.postMapLoadEvent(g.tiles,a.map._getMapId(),a.map._requestManager._skuToken,a.map._requestManager._customAccessToken),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.hasTile=function(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.setSourceProperty=function(a){this._tileJSONRequest&&this._tileJSONRequest.cancel(),a(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},u.prototype.setTiles=function(a){var h=this;return this.setSourceProperty(function(){h._options.tiles=a}),this},u.prototype.setUrl=function(a){var h=this;return this.setSourceProperty(function(){h.url=a,h._options.url=a}),this},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return p.extend({},this._options)},u.prototype.loadTile=function(a,h){var g=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme)),S={request:this.map._requestManager.transformRequest(g,p.ResourceType.Tile),uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function T(R,G){return delete a.request,a.aborted?h(null):R&&R.status!==404?h(R):(G&&G.resourceTiming&&(a.resourceTiming=G.resourceTiming),this.map._refreshExpiredTiles&&G&&a.setExpiryData(G),a.loadVectorData(G,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}S.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired"?a.state==="loading"?a.reloadCallback=h:a.request=a.actor.send("reloadTile",S,T.bind(this)):(a.actor=this.dispatcher.getActor(),a.request=a.actor.send("loadTile",S,T.bind(this)))},u.prototype.abortTile=function(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id},void 0)},u.prototype.unloadTile=function(a){a.unloadVectorData(),a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id},void 0)},u.prototype.hasTransition=function(){return!1},u}(p.Evented),ae=function(i){function u(a,h,g,S){i.call(this),this.id=a,this.dispatcher=g,this.setEventedParent(S),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},h),p.extend(this,p.pick(h,["url","scheme","tileSize"]))}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var a=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ue(this._options,this.map._requestManager,function(h,g){a._tileJSONRequest=null,a._loaded=!0,h?a.fire(new p.ErrorEvent(h)):g&&(p.extend(a,g),g.bounds&&(a.tileBounds=new St(g.bounds,a.minzoom,a.maxzoom)),p.postTurnstileEvent(g.tiles),p.postMapLoadEvent(g.tiles,a.map._getMapId(),a.map._requestManager._skuToken),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),a.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return p.extend({},this._options)},u.prototype.hasTile=function(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)},u.prototype.loadTile=function(a,h){var g=this,S=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);a.request=p.getImage(this.map._requestManager.transformRequest(S,p.ResourceType.Tile),function(T,R){if(delete a.request,a.aborted)a.state="unloaded",h(null);else if(T)a.state="errored",h(T);else if(R){g.map._refreshExpiredTiles&&a.setExpiryData(R),delete R.cacheControl,delete R.expires;var G=g.map.painter.context,ee=G.gl;a.texture=g.map.painter.getTileTexture(R.width),a.texture?a.texture.update(R,{useMipmap:!0}):(a.texture=new p.Texture(G,R,ee.RGBA,{useMipmap:!0}),a.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE,ee.LINEAR_MIPMAP_NEAREST),G.extTextureFilterAnisotropic&&ee.texParameterf(ee.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax)),a.state="loaded",p.cacheEntryPossiblyAdded(g.dispatcher),h(null)}})},u.prototype.abortTile=function(a,h){a.request&&(a.request.cancel(),delete a.request),h()},u.prototype.unloadTile=function(a,h){a.texture&&this.map.painter.saveTileTexture(a.texture),h()},u.prototype.hasTransition=function(){return!1},u}(p.Evented),Te=function(i){function u(a,h,g,S){i.call(this,a,h,g,S),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},u.prototype.loadTile=function(a,h){var g=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function S(T,R){T&&(a.state="errored",h(T)),R&&(a.dem=R,a.needsHillshadePrepare=!0,a.state="loaded",h(null))}a.request=p.getImage(this.map._requestManager.transformRequest(g,p.ResourceType.Tile),function(T,R){if(delete a.request,a.aborted)a.state="unloaded",h(null);else if(T)a.state="errored",h(T);else if(R){this.map._refreshExpiredTiles&&a.setExpiryData(R),delete R.cacheControl,delete R.expires;var G=p.window.ImageBitmap&&R instanceof p.window.ImageBitmap&&p.offscreenCanvasSupported()?R:p.browser.getImageData(R,1),ee={uid:a.uid,coord:a.tileID,source:this.id,rawImageData:G,encoding:this.encoding};a.actor&&a.state!=="expired"||(a.actor=this.dispatcher.getActor(),a.actor.send("loadDEMTile",ee,S.bind(this)))}}.bind(this)),a.neighboringTiles=this._getNeighboringTiles(a.tileID)},u.prototype._getNeighboringTiles=function(a){var h=a.canonical,g=Math.pow(2,h.z),S=(h.x-1+g)%g,T=h.x===0?a.wrap-1:a.wrap,R=(h.x+1+g)%g,G=h.x+1===g?a.wrap+1:a.wrap,ee={};return ee[new p.OverscaledTileID(a.overscaledZ,T,h.z,S,h.y).key]={backfilled:!1},ee[new p.OverscaledTileID(a.overscaledZ,G,h.z,R,h.y).key]={backfilled:!1},h.y>0&&(ee[new p.OverscaledTileID(a.overscaledZ,T,h.z,S,h.y-1).key]={backfilled:!1},ee[new p.OverscaledTileID(a.overscaledZ,a.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},ee[new p.OverscaledTileID(a.overscaledZ,G,h.z,R,h.y-1).key]={backfilled:!1}),h.y+1<g&&(ee[new p.OverscaledTileID(a.overscaledZ,T,h.z,S,h.y+1).key]={backfilled:!1},ee[new p.OverscaledTileID(a.overscaledZ,a.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},ee[new p.OverscaledTileID(a.overscaledZ,G,h.z,R,h.y+1).key]={backfilled:!1}),ee},u.prototype.unloadTile=function(a){a.demTexture&&this.map.painter.saveTileTexture(a.demTexture),a.fbo&&(a.fbo.destroy(),delete a.fbo),a.dem&&delete a.dem,delete a.neighboringTiles,a.state="unloaded",a.actor&&a.actor.send("removeDEMTile",{uid:a.uid,source:this.id})},u}(ae),oe=function(i){function u(a,h,g,S){i.call(this),this.id=a,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=g.getActor(),this.setEventedParent(S),this._data=h.data,this._options=p.extend({},h),this._collectResourceTiming=h.collectResourceTiming,this._resourceTiming=[],h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;var T=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*T,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*T,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?Math.min(h.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:p.EXTENT,radius:(h.clusterRadius||50)*T,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var a=this;this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(h){if(h)a.fire(new p.ErrorEvent(h));else{var g={dataType:"source",sourceDataType:"metadata"};a._collectResourceTiming&&a._resourceTiming&&a._resourceTiming.length>0&&(g.resourceTiming=a._resourceTiming,a._resourceTiming=[]),a.fire(new p.Event("data",g))}})},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.setData=function(a){var h=this;return this._data=a,this.fire(new p.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)h.fire(new p.ErrorEvent(g));else{var S={dataType:"source",sourceDataType:"content"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(S.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new p.Event("data",S))}}),this},u.prototype.getClusterExpansionZoom=function(a,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:a,source:this.id},h),this},u.prototype.getClusterChildren=function(a,h){return this.actor.send("geojson.getClusterChildren",{clusterId:a,source:this.id},h),this},u.prototype.getClusterLeaves=function(a,h,g,S){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:a,limit:h,offset:g},S),this},u.prototype._updateWorkerData=function(a){var h=this;this._loaded=!1;var g=p.extend({},this.workerOptions),S=this._data;typeof S=="string"?(g.request=this.map._requestManager.transformRequest(p.browser.resolveURL(S),p.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(S),this.actor.send(this.type+".loadData",g,function(T,R){h._removed||R&&R.abandoned||(h._loaded=!0,R&&R.resourceTiming&&R.resourceTiming[h.id]&&(h._resourceTiming=R.resourceTiming[h.id].slice(0)),h.actor.send(h.type+".coalesce",{source:g.source},null),a(T))})},u.prototype.loaded=function(){return this._loaded},u.prototype.loadTile=function(a,h){var g=this,S=a.actor?"reloadTile":"loadTile";a.actor=this.actor,a.request=this.actor.send(S,{type:this.type,uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(T,R){return delete a.request,a.unloadVectorData(),a.aborted?h(null):T?h(T):(a.loadVectorData(R,g.map.painter,S==="reloadTile"),h(null))})},u.prototype.abortTile=function(a){a.request&&(a.request.cancel(),delete a.request),a.aborted=!0},u.prototype.unloadTile=function(a){a.unloadVectorData(),this.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id})},u.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},u.prototype.serialize=function(){return p.extend({},this._options,{type:this.type,data:this._data})},u.prototype.hasTransition=function(){return!1},u}(p.Evented),me=p.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Me=function(i){function u(a,h,g,S){i.call(this),this.id=a,this.dispatcher=g,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(S),this.options=h}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(a,h){var g=this;this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),function(S,T){g._loaded=!0,S?g.fire(new p.ErrorEvent(S)):T&&(g.image=T,a&&(g.coordinates=a),h&&h(),g._finishLoading())})},u.prototype.loaded=function(){return this._loaded},u.prototype.updateImage=function(a){var h=this;return this.image&&a.url?(this.options.url=a.url,this.load(a.coordinates,function(){h.texture=null}),this):this},u.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))},u.prototype.onAdd=function(a){this.map=a,this.load()},u.prototype.setCoordinates=function(a){var h=this;this.coordinates=a;var g=a.map(p.MercatorCoordinate.fromLngLat);this.tileID=function(T){for(var R=1/0,G=1/0,ee=-1/0,ve=-1/0,ye=0,we=T;ye<we.length;ye+=1){var Ke=we[ye];R=Math.min(R,Ke.x),G=Math.min(G,Ke.y),ee=Math.max(ee,Ke.x),ve=Math.max(ve,Ke.y)}var He=Math.max(ee-R,ve-G),at=Math.max(0,Math.floor(-Math.log(He)/Math.LN2)),ze=Math.pow(2,at);return new p.CanonicalTileID(at,Math.floor((R+ee)/2*ze),Math.floor((G+ve)/2*ze))}(g),this.minzoom=this.maxzoom=this.tileID.z;var S=g.map(function(T){return h.tileID.getTilePoint(T)._round()});return this._boundsArray=new p.StructArrayLayout4i8,this._boundsArray.emplaceBack(S[0].x,S[0].y,0,0),this._boundsArray.emplaceBack(S[1].x,S[1].y,p.EXTENT,0),this._boundsArray.emplaceBack(S[3].x,S[3].y,0,p.EXTENT),this._boundsArray.emplaceBack(S[2].x,S[2].y,p.EXTENT,p.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this},u.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var a=this.map.painter.context,h=a.gl;for(var g in this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,me.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new p.Texture(a,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var S=this.tiles[g];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture)}}},u.prototype.loadTile=function(a,h){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},h(null)):(a.state="errored",h(null))},u.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return!1},u}(p.Evented),qe=function(i){function u(a,h,g,S){i.call(this,a,h,g,S),this.roundZoom=!0,this.type="video",this.options=h}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var a=this;this._loaded=!1;var h=this.options;this.urls=[];for(var g=0,S=h.urls;g<S.length;g+=1)this.urls.push(this.map._requestManager.transformRequest(S[g],p.ResourceType.Source).url);p.getVideo(this.urls,function(T,R){a._loaded=!0,T?a.fire(new p.ErrorEvent(T)):R&&(a.video=R,a.video.loop=!0,a.video.addEventListener("playing",function(){a.map.triggerRepaint()}),a.map&&a.video.play(),a._finishLoading())})},u.prototype.pause=function(){this.video&&this.video.pause()},u.prototype.play=function(){this.video&&this.video.play()},u.prototype.seek=function(a){if(this.video){var h=this.video.seekable;a<h.start(0)||a>h.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+h.start(0)+" and "+h.end(0)+"-second mark."))):this.video.currentTime=a}},u.prototype.getVideo=function(){return this.video},u.prototype.onAdd=function(a){this.map||(this.map=a,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},u.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var a=this.map.painter.context,h=a.gl;for(var g in this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,me.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(a,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var S=this.tiles[g];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this.video&&!this.video.paused},u}(Me),yt=function(i){function u(a,h,g,S){i.call(this,a,h,g,S),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(function(T){return!Array.isArray(T)||T.length!==2||T.some(function(R){return typeof R!="number"})})||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError("sources."+a,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},u.prototype.getCanvas=function(){return this.canvas},u.prototype.onAdd=function(a){this.map=a,this.load(),this.canvas&&this.animate&&this.play()},u.prototype.onRemove=function(){this.pause()},u.prototype.prepare=function(){var a=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,a=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,a=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var h=this.map.painter.context,g=h.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,me.members)),this.boundsSegments||(this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(a||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(h,this.canvas,g.RGBA,{premultiply:!0}),this.tiles){var T=this.tiles[S];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this._playing},u.prototype._hasInvalidDimensions=function(){for(var a=0,h=[this.canvas.width,this.canvas.height];a<h.length;a+=1){var g=h[a];if(isNaN(g)||g<=0)return!0}return!1},u}(Me),Qt={vector:ur,raster:ae,"raster-dem":Te,geojson:oe,video:qe,image:Me,canvas:yt};function Or(i,u){var a=p.identity([]);return p.translate(a,a,[1,1,0]),p.scale(a,a,[.5*i.width,.5*i.height,1]),p.multiply(a,a,i.calculatePosMatrix(u.toUnwrapped()))}function Dr(i,u,a,h,g,S){var T=function(at,ze,it){if(at)for(var mt=0,Ut=at;mt<Ut.length;mt+=1){var sr=ze[Ut[mt]];if(sr&&sr.source===it&&sr.type==="fill-extrusion")return!0}else for(var nr in ze){var cr=ze[nr];if(cr.source===it&&cr.type==="fill-extrusion")return!0}return!1}(g&&g.layers,u,i.id),R=S.maxPitchScaleFactor(),G=i.tilesIn(h,R,T);G.sort(on);for(var ee=[],ve=0,ye=G;ve<ye.length;ve+=1){var we=ye[ve];ee.push({wrappedTileID:we.tileID.wrapped().key,queryResults:we.tile.queryRenderedFeatures(u,a,i._state,we.queryGeometry,we.cameraQueryGeometry,we.scale,g,S,R,Or(i.transform,we.tileID))})}var Ke=function(at){for(var ze={},it={},mt=0,Ut=at;mt<Ut.length;mt+=1){var sr=Ut[mt],nr=sr.queryResults,cr=sr.wrappedTileID,Rr=it[cr]=it[cr]||{};for(var tn in nr)for(var Xr=nr[tn],yn=Rr[tn]=Rr[tn]||{},Fn=ze[tn]=ze[tn]||[],Vn=0,jn=Xr;Vn<jn.length;Vn+=1){var Qi=jn[Vn];yn[Qi.featureIndex]||(yn[Qi.featureIndex]=!0,Fn.push(Qi))}}return ze}(ee);for(var He in Ke)Ke[He].forEach(function(at){var ze=at.feature,it=i.getFeatureState(ze.layer["source-layer"],ze.id);ze.source=ze.layer.source,ze.layer["source-layer"]&&(ze.sourceLayer=ze.layer["source-layer"]),ze.state=it});return Ke}function on(i,u){var a=i.tileID,h=u.tileID;return a.overscaledZ-h.overscaledZ||a.canonical.y-h.canonical.y||a.wrap-h.wrap||a.canonical.x-h.canonical.x}var tr=function(i,u){this.max=i,this.onRemove=u,this.reset()};tr.prototype.reset=function(){for(var i in this.data)for(var u=0,a=this.data[i];u<a.length;u+=1){var h=a[u];h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value)}return this.data={},this.order=[],this},tr.prototype.add=function(i,u,a){var h=this,g=i.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);var S={value:u,timeout:void 0};if(a!==void 0&&(S.timeout=setTimeout(function(){h.remove(i,S)},a)),this.data[g].push(S),this.order.push(g),this.order.length>this.max){var T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this},tr.prototype.has=function(i){return i.wrapped().key in this.data},tr.prototype.getAndRemove=function(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null},tr.prototype._getAndRemoveByKey=function(i){var u=this.data[i].shift();return u.timeout&&clearTimeout(u.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),u.value},tr.prototype.getByKey=function(i){var u=this.data[i];return u?u[0].value:null},tr.prototype.get=function(i){return this.has(i)?this.data[i.wrapped().key][0].value:null},tr.prototype.remove=function(i,u){if(!this.has(i))return this;var a=i.wrapped().key,h=u===void 0?0:this.data[a].indexOf(u),g=this.data[a][h];return this.data[a].splice(h,1),g.timeout&&clearTimeout(g.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(g.value),this.order.splice(this.order.indexOf(a),1),this},tr.prototype.setMaxSize=function(i){for(this.max=i;this.order.length>this.max;){var u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this},tr.prototype.filter=function(i){var u=[];for(var a in this.data)for(var h=0,g=this.data[a];h<g.length;h+=1){var S=g[h];i(S.value)||u.push(S)}for(var T=0,R=u;T<R.length;T+=1){var G=R[T];this.remove(G.value.tileID,G)}};var se=function(i,u,a){this.context=i;var h=i.gl;this.buffer=h.createBuffer(),this.dynamicDraw=Boolean(a),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};se.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},se.prototype.updateData=function(i){var u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)},se.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var be={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Fe=function(i,u,a,h){this.length=u.length,this.attributes=a,this.itemSize=u.bytesPerElement,this.dynamicDraw=h,this.context=i;var g=i.gl;this.buffer=g.createBuffer(),i.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};Fe.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Fe.prototype.updateData=function(i){var u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,i.arrayBuffer)},Fe.prototype.enableAttributes=function(i,u){for(var a=0;a<this.attributes.length;a++){var h=u.attributes[this.attributes[a].name];h!==void 0&&i.enableVertexAttribArray(h)}},Fe.prototype.setVertexAttribPointers=function(i,u,a){for(var h=0;h<this.attributes.length;h++){var g=this.attributes[h],S=u.attributes[g.name];S!==void 0&&i.vertexAttribPointer(S,g.components,i[be[g.type]],!1,this.itemSize,g.offset+this.itemSize*(a||0))}},Fe.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Ee=function(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Ee.prototype.get=function(){return this.current},Ee.prototype.set=function(i){},Ee.prototype.getDefault=function(){return this.default},Ee.prototype.setDefault=function(){this.set(this.default)};var wt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return p.Color.transparent},u.prototype.set=function(a){var h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)},u}(Ee),Bt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 1},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)},u}(Ee),w=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 0},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)},u}(Ee),N=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return[!0,!0,!0,!0]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)},u}(Ee),he=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!0},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)},u}(Ee),je=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 255},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)},u}(Ee),et=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},u.prototype.set=function(a){var h=this.current;(a.func!==h.func||a.ref!==h.ref||a.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)},u}(Ee),_t=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){var a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)},u}(Ee),Ct=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=a,this.dirty=!1}},u}(Ee),V=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return[0,1]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)},u}(Ee),Yt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=a,this.dirty=!1}},u}(Ee),kt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.LESS},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)},u}(Ee),fr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.BLEND):h.disable(h.BLEND),this.current=a,this.dirty=!1}},u}(Ee),Cr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){var a=this.gl;return[a.ONE,a.ZERO]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)},u}(Ee),Tr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return p.Color.transparent},u.prototype.set=function(a){var h=this.current;(a.r!==h.r||a.g!==h.g||a.b!==h.b||a.a!==h.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)},u}(Ee),Ar=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.FUNC_ADD},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)},u}(Ee),Je=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;a?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=a,this.dirty=!1}},u}(Ee),xt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.BACK},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)},u}(Ee),ht=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.CCW},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)},u}(Ee),lr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)},u}(Ee),Kr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.TEXTURE0},u.prototype.set=function(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)},u}(Ee),lt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){var a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]},u.prototype.set=function(a){var h=this.current;(a[0]!==h[0]||a[1]!==h[1]||a[2]!==h[2]||a[3]!==h[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)},u}(Ee),Lt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,a),this.current=a,this.dirty=!1}},u}(Ee),Jt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,a),this.current=a,this.dirty=!1}},u}(Ee),or=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindTexture(h.TEXTURE_2D,a),this.current=a,this.dirty=!1}},u}(Ee),cn=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}},u}(Ee),Pn=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){var h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1},u}(Ee),bi=function(i){function u(a){i.call(this,a),this.vao=a.extVertexArrayObject}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)},u}(Ee),Si=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 4},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}},u}(Ee),Ri=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}},u}(Ee),ia=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(a){if(a!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}},u}(Ee),pi=function(i){function u(a,h){i.call(this,a),this.context=a,this.parent=h}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u}(Ee),H=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.setDirty=function(){this.dirty=!0},u.prototype.set=function(a){if(a!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}},u}(pi),ie=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.set=function(a){if(a!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,a),this.current=a,this.dirty=!1}},u}(pi),ce=function(i,u,a,h){this.context=i,this.width=u,this.height=a;var g=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new H(i,g),h&&(this.depthAttachment=new ie(i,g))};ce.prototype.destroy=function(){var i=this.context.gl,u=this.colorAttachment.get();if(u&&i.deleteTexture(u),this.depthAttachment){var a=this.depthAttachment.get();a&&i.deleteRenderbuffer(a)}i.deleteFramebuffer(this.framebuffer)};var B=function(i,u,a){this.func=i,this.mask=u,this.range=a};B.ReadOnly=!1,B.ReadWrite=!0,B.disabled=new B(519,B.ReadOnly,[0,1]);var re=function(i,u,a,h,g,S){this.test=i,this.ref=u,this.mask=a,this.fail=h,this.depthFail=g,this.pass=S};re.disabled=new re({func:519,mask:0},0,0,7680,7680,7680);var fe=function(i,u,a){this.blendFunction=i,this.blendColor=u,this.mask=a};fe.disabled=new fe(fe.Replace=[1,0],p.Color.transparent,[!1,!1,!1,!1]),fe.unblended=new fe(fe.Replace,p.Color.transparent,[!0,!0,!0,!0]),fe.alphaBlended=new fe([1,771],p.Color.transparent,[!0,!0,!0,!0]);var Se=function(i,u,a){this.enable=i,this.mode=u,this.frontFace=a};Se.disabled=new Se(!1,1029,2305),Se.backCCW=new Se(!0,1029,2305);var te=function(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new wt(this),this.clearDepth=new Bt(this),this.clearStencil=new w(this),this.colorMask=new N(this),this.depthMask=new he(this),this.stencilMask=new je(this),this.stencilFunc=new et(this),this.stencilOp=new _t(this),this.stencilTest=new Ct(this),this.depthRange=new V(this),this.depthTest=new Yt(this),this.depthFunc=new kt(this),this.blend=new fr(this),this.blendFunc=new Cr(this),this.blendColor=new Tr(this),this.blendEquation=new Ar(this),this.cullFace=new Je(this),this.cullFaceSide=new xt(this),this.frontFace=new ht(this),this.program=new lr(this),this.activeTexture=new Kr(this),this.viewport=new lt(this),this.bindFramebuffer=new Lt(this),this.bindRenderbuffer=new Jt(this),this.bindTexture=new or(this),this.bindVertexBuffer=new cn(this),this.bindElementBuffer=new Pn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new bi(this),this.pixelStoreUnpack=new Si(this),this.pixelStoreUnpackPremultiplyAlpha=new Ri(this),this.pixelStoreUnpackFlipY=new ia(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)};te.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},te.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},te.prototype.createIndexBuffer=function(i,u){return new se(this,i,u)},te.prototype.createVertexBuffer=function(i,u,a){return new Fe(this,i,u,a)},te.prototype.createRenderbuffer=function(i,u,a){var h=this.gl,g=h.createRenderbuffer();return this.bindRenderbuffer.set(g),h.renderbufferStorage(h.RENDERBUFFER,i,u,a),this.bindRenderbuffer.set(null),g},te.prototype.createFramebuffer=function(i,u,a){return new ce(this,i,u,a)},te.prototype.clear=function(i){var u=i.color,a=i.depth,h=this.gl,g=0;u&&(g|=h.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(g|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),h.clear(g)},te.prototype.setCullFace=function(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))},te.prototype.setDepthMode=function(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)},te.prototype.setStencilMode=function(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)},te.prototype.setColorMode=function(i){p.deepEqual(i.blendFunction,fe.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)},te.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var ge=function(i){function u(a,h,g){var S=this;i.call(this),this.id=a,this.dispatcher=g,this.on("data",function(T){T.dataType==="source"&&T.sourceDataType==="metadata"&&(S._sourceLoaded=!0),S._sourceLoaded&&!S._paused&&T.dataType==="source"&&T.sourceDataType==="content"&&(S.reload(),S.transform&&S.update(S.transform))}),this.on("error",function(){S._sourceErrored=!0}),this._source=function(T,R,G,ee){var ve=new Qt[R.type](T,R,G,ee);if(ve.id!==T)throw new Error("Expected Source id to be "+T+" instead of "+ve.id);return p.bindAll(["load","abort","unload","serialize","prepare"],ve),ve}(a,h,g,this),this._tiles={},this._cache=new tr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new p.SourceFeatureState}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.onAdd=function(a){this.map=a,this._maxTileCacheSize=a?a._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(a)},u.prototype.onRemove=function(a){this._source&&this._source.onRemove&&this._source.onRemove(a)},u.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var a in this._tiles){var h=this._tiles[a];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0},u.prototype.getSource=function(){return this._source},u.prototype.pause=function(){this._paused=!0},u.prototype.resume=function(){if(this._paused){var a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform)}},u.prototype._loadTile=function(a,h){return this._source.loadTile(a,h)},u.prototype._unloadTile=function(a){if(this._source.unloadTile)return this._source.unloadTile(a,function(){})},u.prototype._abortTile=function(a){if(this._source.abortTile)return this._source.abortTile(a,function(){})},u.prototype.serialize=function(){return this._source.serialize()},u.prototype.prepare=function(a){for(var h in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var g=this._tiles[h];g.upload(a),g.prepare(this.map.style.imageManager)}},u.prototype.getIds=function(){return p.values(this._tiles).map(function(a){return a.tileID}).sort(pt).map(function(a){return a.key})},u.prototype.getRenderableIds=function(a){var h=this,g=[];for(var S in this._tiles)this._isIdRenderable(S,a)&&g.push(this._tiles[S]);return a?g.sort(function(T,R){var G=T.tileID,ee=R.tileID,ve=new p.Point(G.canonical.x,G.canonical.y)._rotate(h.transform.angle),ye=new p.Point(ee.canonical.x,ee.canonical.y)._rotate(h.transform.angle);return G.overscaledZ-ee.overscaledZ||ye.y-ve.y||ye.x-ve.x}).map(function(T){return T.tileID.key}):g.map(function(T){return T.tileID}).sort(pt).map(function(T){return T.key})},u.prototype.hasRenderableParent=function(a){var h=this.findLoadedParent(a,0);return!!h&&this._isIdRenderable(h.tileID.key)},u.prototype._isIdRenderable=function(a,h){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(h||!this._tiles[a].holdingForFade())},u.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var a in this._cache.reset(),this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")},u.prototype._reloadTile=function(a,h){var g=this._tiles[a];g&&(g.state!=="loading"&&(g.state=h),this._loadTile(g,this._tileLoaded.bind(this,g,a,h)))},u.prototype._tileLoaded=function(a,h,g,S){if(S)return a.state="errored",void(S.status!==404?this._source.fire(new p.ErrorEvent(S,{tile:a})):this.update(this.transform));a.timeAdded=p.browser.now(),g==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(h,a),this.getSource().type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),this._source.fire(new p.Event("data",{dataType:"source",tile:a,coord:a.tileID}))},u.prototype._backfillDEM=function(a){for(var h=this.getRenderableIds(),g=0;g<h.length;g++){var S=h[g];if(a.neighboringTiles&&a.neighboringTiles[S]){var T=this.getTileByID(S);R(a,T),R(T,a)}}function R(G,ee){G.needsHillshadePrepare=!0;var ve=ee.tileID.canonical.x-G.tileID.canonical.x,ye=ee.tileID.canonical.y-G.tileID.canonical.y,we=Math.pow(2,G.tileID.canonical.z),Ke=ee.tileID.key;ve===0&&ye===0||Math.abs(ye)>1||(Math.abs(ve)>1&&(Math.abs(ve+we)===1?ve+=we:Math.abs(ve-we)===1&&(ve-=we)),ee.dem&&G.dem&&(G.dem.backfillBorder(ee.dem,ve,ye),G.neighboringTiles&&G.neighboringTiles[Ke]&&(G.neighboringTiles[Ke].backfilled=!0)))}},u.prototype.getTile=function(a){return this.getTileByID(a.key)},u.prototype.getTileByID=function(a){return this._tiles[a]},u.prototype._retainLoadedChildren=function(a,h,g,S){for(var T in this._tiles){var R=this._tiles[T];if(!(S[T]||!R.hasData()||R.tileID.overscaledZ<=h||R.tileID.overscaledZ>g)){for(var G=R.tileID;R&&R.tileID.overscaledZ>h+1;){var ee=R.tileID.scaledTo(R.tileID.overscaledZ-1);(R=this._tiles[ee.key])&&R.hasData()&&(G=ee)}for(var ve=G;ve.overscaledZ>h;)if(a[(ve=ve.scaledTo(ve.overscaledZ-1)).key]){S[G.key]=G;break}}}},u.prototype.findLoadedParent=function(a,h){if(a.key in this._loadedParentTiles){var g=this._loadedParentTiles[a.key];return g&&g.tileID.overscaledZ>=h?g:null}for(var S=a.overscaledZ-1;S>=h;S--){var T=a.scaledTo(S),R=this._getLoadedTile(T);if(R)return R}},u.prototype._getLoadedTile=function(a){var h=this._tiles[a.key];return h&&h.hasData()?h:this._cache.getByKey(a.wrapped().key)},u.prototype.updateCacheSize=function(a){var h=Math.ceil(a.width/this._source.tileSize)+1,g=Math.ceil(a.height/this._source.tileSize)+1,S=Math.floor(h*g*5),T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(T)},u.prototype.handleWrapJump=function(a){var h=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,h){var g={};for(var S in this._tiles){var T=this._tiles[S];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+h),g[T.tileID.key]=T}for(var R in this._tiles=g,this._timers)clearTimeout(this._timers[R]),delete this._timers[R];for(var G in this._tiles)this._setTileReloadTimer(G,this._tiles[G])}},u.prototype.update=function(a){var h=this;if(this.transform=a,this._sourceLoaded&&!this._paused){var g;this.updateCacheSize(a),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?g=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Rr){return new p.OverscaledTileID(Rr.canonical.z,Rr.wrap,Rr.canonical.z,Rr.canonical.x,Rr.canonical.y)}):(g=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(g=g.filter(function(Rr){return h._source.hasTile(Rr)}))):g=[];var S=a.coveringZoomLevel(this._source),T=Math.max(S-u.maxOverzooming,this._source.minzoom),R=Math.max(S+u.maxUnderzooming,this._source.minzoom),G=this._updateRetainedTiles(g,S);if(yr(this._source.type)){for(var ee={},ve={},ye=0,we=Object.keys(G);ye<we.length;ye+=1){var Ke=we[ye],He=G[Ke],at=this._tiles[Ke];if(at&&!(at.fadeEndTime&&at.fadeEndTime<=p.browser.now())){var ze=this.findLoadedParent(He,T);ze&&(this._addTile(ze.tileID),ee[ze.tileID.key]=ze.tileID),ve[Ke]=He}}for(var it in this._retainLoadedChildren(ve,S,R,G),ee)G[it]||(this._coveredTiles[it]=!0,G[it]=ee[it])}for(var mt in G)this._tiles[mt].clearFadeHold();for(var Ut=0,sr=p.keysDifference(this._tiles,G);Ut<sr.length;Ut+=1){var nr=sr[Ut],cr=this._tiles[nr];cr.hasSymbolBuckets&&!cr.holdingForFade()?cr.setHoldDuration(this.map._fadeDuration):cr.hasSymbolBuckets&&!cr.symbolFadeFinished()||this._removeTile(nr)}this._updateLoadedParentTileCache()}},u.prototype.releaseSymbolFadeTiles=function(){for(var a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(a)},u.prototype._updateRetainedTiles=function(a,h){for(var g={},S={},T=Math.max(h-u.maxOverzooming,this._source.minzoom),R=Math.max(h+u.maxUnderzooming,this._source.minzoom),G={},ee=0,ve=a;ee<ve.length;ee+=1){var ye=ve[ee],we=this._addTile(ye);g[ye.key]=ye,we.hasData()||h<this._source.maxzoom&&(G[ye.key]=ye)}this._retainLoadedChildren(G,h,R,g);for(var Ke=0,He=a;Ke<He.length;Ke+=1){var at=He[Ke],ze=this._tiles[at.key];if(!ze.hasData()){if(h+1>this._source.maxzoom){var it=at.children(this._source.maxzoom)[0],mt=this.getTile(it);if(mt&&mt.hasData()){g[it.key]=it;continue}}else{var Ut=at.children(this._source.maxzoom);if(g[Ut[0].key]&&g[Ut[1].key]&&g[Ut[2].key]&&g[Ut[3].key])continue}for(var sr=ze.wasRequested(),nr=at.overscaledZ-1;nr>=T;--nr){var cr=at.scaledTo(nr);if(S[cr.key]||(S[cr.key]=!0,!(ze=this.getTile(cr))&&sr&&(ze=this._addTile(cr)),ze&&(g[cr.key]=cr,sr=ze.wasRequested(),ze.hasData())))break}}}return g},u.prototype._updateLoadedParentTileCache=function(){for(var a in this._loadedParentTiles={},this._tiles){for(var h=[],g=void 0,S=this._tiles[a].tileID;S.overscaledZ>0;){if(S.key in this._loadedParentTiles){g=this._loadedParentTiles[S.key];break}h.push(S.key);var T=S.scaledTo(S.overscaledZ-1);if(g=this._getLoadedTile(T))break;S=T}for(var R=0,G=h;R<G.length;R+=1)this._loadedParentTiles[G[R]]=g}},u.prototype._addTile=function(a){var h=this._tiles[a.key];if(h)return h;(h=this._cache.getAndRemove(a))&&(this._setTileReloadTimer(a.key,h),h.tileID=a,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,h)));var g=Boolean(h);return g||(h=new p.Tile(a,this._source.tileSize*a.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,a.key,h.state))),h?(h.uses++,this._tiles[a.key]=h,g||this._source.fire(new p.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h):null},u.prototype._setTileReloadTimer=function(a,h){var g=this;a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);var S=h.getExpiryTimeout();S&&(this._timers[a]=setTimeout(function(){g._reloadTile(a,"expired"),delete g._timers[a]},S))},u.prototype._removeTile=function(a){var h=this._tiles[a];h&&(h.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))},u.prototype.clearTiles=function(){for(var a in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(a);this._cache.reset()},u.prototype.tilesIn=function(a,h,g){var S=this,T=[],R=this.transform;if(!R)return T;for(var G=g?R.getCameraQueryGeometry(a):a,ee=a.map(function(nr){return R.pointCoordinate(nr)}),ve=G.map(function(nr){return R.pointCoordinate(nr)}),ye=this.getIds(),we=1/0,Ke=1/0,He=-1/0,at=-1/0,ze=0,it=ve;ze<it.length;ze+=1){var mt=it[ze];we=Math.min(we,mt.x),Ke=Math.min(Ke,mt.y),He=Math.max(He,mt.x),at=Math.max(at,mt.y)}for(var Ut=function(nr){var cr=S._tiles[ye[nr]];if(!cr.holdingForFade()){var Rr=cr.tileID,tn=Math.pow(2,R.zoom-cr.tileID.overscaledZ),Xr=h*cr.queryPadding*p.EXTENT/cr.tileSize/tn,yn=[Rr.getTilePoint(new p.MercatorCoordinate(we,Ke)),Rr.getTilePoint(new p.MercatorCoordinate(He,at))];if(yn[0].x-Xr<p.EXTENT&&yn[0].y-Xr<p.EXTENT&&yn[1].x+Xr>=0&&yn[1].y+Xr>=0){var Fn=ee.map(function(jn){return Rr.getTilePoint(jn)}),Vn=ve.map(function(jn){return Rr.getTilePoint(jn)});T.push({tile:cr,tileID:Rr,queryGeometry:Fn,cameraQueryGeometry:Vn,scale:tn})}}},sr=0;sr<ye.length;sr++)Ut(sr);return T},u.prototype.getVisibleCoordinates=function(a){for(var h=this,g=this.getRenderableIds(a).map(function(G){return h._tiles[G].tileID}),S=0,T=g;S<T.length;S+=1){var R=T[S];R.posMatrix=this.transform.calculatePosMatrix(R.toUnwrapped())}return g},u.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(yr(this._source.type))for(var a in this._tiles){var h=this._tiles[a];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=p.browser.now())return!0}return!1},u.prototype.setFeatureState=function(a,h,g){this._state.updateState(a=a||"_geojsonTileLayer",h,g)},u.prototype.removeFeatureState=function(a,h,g){this._state.removeFeatureState(a=a||"_geojsonTileLayer",h,g)},u.prototype.getFeatureState=function(a,h){return this._state.getState(a=a||"_geojsonTileLayer",h)},u.prototype.setDependencies=function(a,h,g){var S=this._tiles[a];S&&S.setDependencies(h,g)},u.prototype.reloadTilesForDependencies=function(a,h){for(var g in this._tiles)this._tiles[g].hasDependency(a,h)&&this._reloadTile(g,"reloading");this._cache.filter(function(S){return!S.hasDependency(a,h)})},u}(p.Evented);function pt(i,u){var a=Math.abs(2*i.wrap)-+(i.wrap<0),h=Math.abs(2*u.wrap)-+(u.wrap<0);return i.overscaledZ-u.overscaledZ||h-a||u.canonical.y-i.canonical.y||u.canonical.x-i.canonical.x}function yr(i){return i==="raster"||i==="image"||i==="video"}function Lr(){return new p.window.Worker(Sc.workerUrl)}ge.maxOverzooming=10,ge.maxUnderzooming=3;var Nt="mapboxgl_preloaded_worker_pool",Fr=function(){this.active={}};Fr.prototype.acquire=function(i){if(!this.workers)for(this.workers=[];this.workers.length<Fr.workerCount;)this.workers.push(new Lr);return this.active[i]=!0,this.workers.slice()},Fr.prototype.release=function(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(function(u){u.terminate()}),this.workers=null)},Fr.prototype.isPreloaded=function(){return!!this.active[Nt]},Fr.prototype.numActive=function(){return Object.keys(this.active).length};var bn,gn=Math.floor(p.browser.hardwareConcurrency/2);function gr(){return bn||(bn=new Fr),bn}function vn(i,u){var a={};for(var h in i)h!=="ref"&&(a[h]=i[h]);return p.refProperties.forEach(function(g){g in u&&(a[g]=u[g])}),a}function Wr(i){i=i.slice();for(var u=Object.create(null),a=0;a<i.length;a++)u[i[a].id]=i[a];for(var h=0;h<i.length;h++)"ref"in i[h]&&(i[h]=vn(i[h],u[i[h].ref]));return i}Fr.workerCount=Math.max(Math.min(gn,6),1);var ln={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ei(i,u,a){a.push({command:ln.addSource,args:[i,u[i]]})}function pn(i,u,a){u.push({command:ln.removeSource,args:[i]}),a[i]=!0}function wi(i,u,a,h){pn(i,a,h),Ei(i,u,a)}function Yi(i,u,a){var h;for(h in i[a])if(i[a].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(i[a][h],u[a][h]))return!1;for(h in u[a])if(u[a].hasOwnProperty(h)&&h!=="data"&&!p.deepEqual(i[a][h],u[a][h]))return!1;return!0}function Yn(i,u,a,h,g,S){var T;for(T in u=u||{},i=i||{})i.hasOwnProperty(T)&&(p.deepEqual(i[T],u[T])||a.push({command:S,args:[h,T,u[T],g]}));for(T in u)u.hasOwnProperty(T)&&!i.hasOwnProperty(T)&&(p.deepEqual(i[T],u[T])||a.push({command:S,args:[h,T,u[T],g]}))}function Di(i){return i.id}function ki(i,u){return i[u.id]=u,i}var za=function(i,u){this.reset(i,u)};za.prototype.reset=function(i,u){this.points=i||[],this._distances=[0];for(var a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding},za.prototype.lerp=function(i){if(this.points.length===1)return this.points[0];i=p.clamp(i,0,1);for(var u=1,a=this._distances[u],h=i*this.paddedLength+this.padding;a<h&&u<this._distances.length;)a=this._distances[++u];var g=u-1,S=this._distances[g],T=a-S,R=T>0?(h-S)/T:0;return this.points[g].mult(1-R).add(this.points[u].mult(R))};var Wn=function(i,u,a){var h=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(i/a),this.yCellCount=Math.ceil(u/a);for(var S=0;S<this.xCellCount*this.yCellCount;S++)h.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=u,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0};function ai(i,u,a,h,g){var S=p.create();return u?(p.scale(S,S,[1/g,1/g,1]),a||p.rotateZ(S,S,h.angle)):p.multiply(S,h.labelPlaneMatrix,i),S}function Ai(i,u,a,h,g){if(u){var S=p.clone(i);return p.scale(S,S,[g,g,1]),a||p.rotateZ(S,S,-h.angle),S}return h.glCoordMatrix}function Qn(i,u){var a=[i.x,i.y,0,1];$a(a,a,u);var h=a[3];return{point:new p.Point(a[0]/h,a[1]/h),signedDistanceFromCamera:h}}function Fi(i,u){return .5+i/u*.5}function ya(i,u){var a=i[0]/i[3],h=i[1]/i[3];return a>=-u[0]&&a<=u[0]&&h>=-u[1]&&h<=u[1]}function Xa(i,u,a,h,g,S,T,R){var G=h?i.textSizeData:i.iconSizeData,ee=p.evaluateSizeForZoom(G,a.transform.zoom),ve=[256/a.width*2+1,256/a.height*2+1],ye=h?i.text.dynamicLayoutVertexArray:i.icon.dynamicLayoutVertexArray;ye.clear();for(var we=i.lineVertexArray,Ke=h?i.text.placedSymbolArray:i.icon.placedSymbolArray,He=a.transform.width/a.transform.height,at=!1,ze=0;ze<Ke.length;ze++){var it=Ke.get(ze);if(it.hidden||it.writingMode===p.WritingMode.vertical&&!at)Ka(it.numGlyphs,ye);else{at=!1;var mt=[it.anchorX,it.anchorY,0,1];if(p.transformMat4(mt,mt,u),ya(mt,ve)){var Ut=Fi(a.transform.cameraToCenterDistance,mt[3]),sr=p.evaluateSizeForFeature(G,ee,it),nr=T?sr/Ut:sr*Ut,cr=new p.Point(it.anchorX,it.anchorY),Rr=Qn(cr,g).point,tn={},Xr=Vu(it,nr,!1,R,u,g,S,i.glyphOffsetArray,we,ye,Rr,cr,tn,He);at=Xr.useVertical,(Xr.notEnoughRoom||at||Xr.needsFlipping&&Vu(it,nr,!0,R,u,g,S,i.glyphOffsetArray,we,ye,Rr,cr,tn,He).notEnoughRoom)&&Ka(it.numGlyphs,ye)}else Ka(it.numGlyphs,ye)}}h?i.text.dynamicLayoutVertexBuffer.updateData(ye):i.icon.dynamicLayoutVertexBuffer.updateData(ye)}function _a(i,u,a,h,g,S,T,R,G,ee,ve){var ye=R.glyphStartIndex+R.numGlyphs,we=R.lineStartIndex,Ke=R.lineStartIndex+R.lineLength,He=u.getoffsetX(R.glyphStartIndex),at=u.getoffsetX(ye-1),ze=gi(i*He,a,h,g,S,T,R.segment,we,Ke,G,ee,ve);if(!ze)return null;var it=gi(i*at,a,h,g,S,T,R.segment,we,Ke,G,ee,ve);return it?{first:ze,last:it}:null}function da(i,u,a,h){return i===p.WritingMode.horizontal&&Math.abs(a.y-u.y)>Math.abs(a.x-u.x)*h?{useVertical:!0}:(i===p.WritingMode.vertical?u.y<a.y:u.x>a.x)?{needsFlipping:!0}:null}function Vu(i,u,a,h,g,S,T,R,G,ee,ve,ye,we,Ke){var He,at=u/24,ze=i.lineOffsetX*at,it=i.lineOffsetY*at;if(i.numGlyphs>1){var mt=i.glyphStartIndex+i.numGlyphs,Ut=i.lineStartIndex,sr=i.lineStartIndex+i.lineLength,nr=_a(at,R,ze,it,a,ve,ye,i,G,S,we);if(!nr)return{notEnoughRoom:!0};var cr=Qn(nr.first.point,T).point,Rr=Qn(nr.last.point,T).point;if(h&&!a){var tn=da(i.writingMode,cr,Rr,Ke);if(tn)return tn}He=[nr.first];for(var Xr=i.glyphStartIndex+1;Xr<mt-1;Xr++)He.push(gi(at*R.getoffsetX(Xr),ze,it,a,ve,ye,i.segment,Ut,sr,G,S,we));He.push(nr.last)}else{if(h&&!a){var yn=Qn(ye,g).point,Fn=i.lineStartIndex+i.segment+1,Vn=new p.Point(G.getx(Fn),G.gety(Fn)),jn=Qn(Vn,g),Qi=jn.signedDistanceFromCamera>0?jn.point:Ya(ye,Vn,yn,1,g),_n=da(i.writingMode,yn,Qi,Ke);if(_n)return _n}var ci=gi(at*R.getoffsetX(i.glyphStartIndex),ze,it,a,ve,ye,i.segment,i.lineStartIndex,i.lineStartIndex+i.lineLength,G,S,we);if(!ci)return{notEnoughRoom:!0};He=[ci]}for(var Ci=0,fi=He;Ci<fi.length;Ci+=1){var oi=fi[Ci];p.addDynamicAttributes(ee,oi.point,oi.angle)}return{}}function Ya(i,u,a,h,g){var S=Qn(i.add(i.sub(u)._unit()),g).point,T=a.sub(S);return a.add(T._mult(h/T.mag()))}function gi(i,u,a,h,g,S,T,R,G,ee,ve,ye){var we=h?i-u:i+u,Ke=we>0?1:-1,He=0;h&&(Ke*=-1,He=Math.PI),Ke<0&&(He+=Math.PI);for(var at=Ke>0?R+T:R+T+1,ze=g,it=g,mt=0,Ut=0,sr=Math.abs(we),nr=[];mt+Ut<=sr;){if((at+=Ke)<R||at>=G)return null;if(it=ze,nr.push(ze),(ze=ye[at])===void 0){var cr=new p.Point(ee.getx(at),ee.gety(at)),Rr=Qn(cr,ve);if(Rr.signedDistanceFromCamera>0)ze=ye[at]=Rr.point;else{var tn=at-Ke;ze=Ya(mt===0?S:new p.Point(ee.getx(tn),ee.gety(tn)),cr,it,sr-mt+1,ve)}}mt+=Ut,Ut=it.dist(ze)}var Xr=(sr-mt)/Ut,yn=ze.sub(it),Fn=yn.mult(Xr)._add(it);Fn._add(yn._unit()._perp()._mult(a*Ke));var Vn=He+Math.atan2(ze.y-it.y,ze.x-it.x);return nr.push(Fn),{point:Fn,angle:Vn,path:nr}}Wn.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Wn.prototype.insert=function(i,u,a,h,g){this._forEachCell(u,a,h,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(u),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(g)},Wn.prototype.insertCircle=function(i,u,a,h){this._forEachCell(u-h,a-h,u+h,a+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(u),this.circles.push(a),this.circles.push(h)},Wn.prototype._insertBoxCell=function(i,u,a,h,g,S){this.boxCells[g].push(S)},Wn.prototype._insertCircleCell=function(i,u,a,h,g,S){this.circleCells[g].push(S)},Wn.prototype._query=function(i,u,a,h,g,S){if(a<0||i>this.width||h<0||u>this.height)return!g&&[];var T=[];if(i<=0&&u<=0&&this.width<=a&&this.height<=h){if(g)return!0;for(var R=0;R<this.boxKeys.length;R++)T.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(var G=0;G<this.circleKeys.length;G++){var ee=this.circles[3*G],ve=this.circles[3*G+1],ye=this.circles[3*G+2];T.push({key:this.circleKeys[G],x1:ee-ye,y1:ve-ye,x2:ee+ye,y2:ve+ye})}return S?T.filter(S):T}return this._forEachCell(i,u,a,h,this._queryCell,T,{hitTest:g,seenUids:{box:{},circle:{}}},S),g?T.length>0:T},Wn.prototype._queryCircle=function(i,u,a,h,g){var S=i-a,T=i+a,R=u-a,G=u+a;if(T<0||S>this.width||G<0||R>this.height)return!h&&[];var ee=[];return this._forEachCell(S,R,T,G,this._queryCellCircle,ee,{hitTest:h,circle:{x:i,y:u,radius:a},seenUids:{box:{},circle:{}}},g),h?ee.length>0:ee},Wn.prototype.query=function(i,u,a,h,g){return this._query(i,u,a,h,!1,g)},Wn.prototype.hitTest=function(i,u,a,h,g){return this._query(i,u,a,h,!0,g)},Wn.prototype.hitTestCircle=function(i,u,a,h){return this._queryCircle(i,u,a,!0,h)},Wn.prototype._queryCell=function(i,u,a,h,g,S,T,R){var G=T.seenUids,ee=this.boxCells[g];if(ee!==null)for(var ve=this.bboxes,ye=0,we=ee;ye<we.length;ye+=1){var Ke=we[ye];if(!G.box[Ke]){G.box[Ke]=!0;var He=4*Ke;if(i<=ve[He+2]&&u<=ve[He+3]&&a>=ve[He+0]&&h>=ve[He+1]&&(!R||R(this.boxKeys[Ke]))){if(T.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[Ke],x1:ve[He],y1:ve[He+1],x2:ve[He+2],y2:ve[He+3]})}}}var at=this.circleCells[g];if(at!==null)for(var ze=this.circles,it=0,mt=at;it<mt.length;it+=1){var Ut=mt[it];if(!G.circle[Ut]){G.circle[Ut]=!0;var sr=3*Ut;if(this._circleAndRectCollide(ze[sr],ze[sr+1],ze[sr+2],i,u,a,h)&&(!R||R(this.circleKeys[Ut]))){if(T.hitTest)return S.push(!0),!0;var nr=ze[sr],cr=ze[sr+1],Rr=ze[sr+2];S.push({key:this.circleKeys[Ut],x1:nr-Rr,y1:cr-Rr,x2:nr+Rr,y2:cr+Rr})}}}},Wn.prototype._queryCellCircle=function(i,u,a,h,g,S,T,R){var G=T.circle,ee=T.seenUids,ve=this.boxCells[g];if(ve!==null)for(var ye=this.bboxes,we=0,Ke=ve;we<Ke.length;we+=1){var He=Ke[we];if(!ee.box[He]){ee.box[He]=!0;var at=4*He;if(this._circleAndRectCollide(G.x,G.y,G.radius,ye[at+0],ye[at+1],ye[at+2],ye[at+3])&&(!R||R(this.boxKeys[He])))return S.push(!0),!0}}var ze=this.circleCells[g];if(ze!==null)for(var it=this.circles,mt=0,Ut=ze;mt<Ut.length;mt+=1){var sr=Ut[mt];if(!ee.circle[sr]){ee.circle[sr]=!0;var nr=3*sr;if(this._circlesCollide(it[nr],it[nr+1],it[nr+2],G.x,G.y,G.radius)&&(!R||R(this.circleKeys[sr])))return S.push(!0),!0}}},Wn.prototype._forEachCell=function(i,u,a,h,g,S,T,R){for(var G=this._convertToXCellCoord(i),ee=this._convertToYCellCoord(u),ve=this._convertToXCellCoord(a),ye=this._convertToYCellCoord(h),we=G;we<=ve;we++)for(var Ke=ee;Ke<=ye;Ke++)if(g.call(this,i,u,a,h,this.xCellCount*Ke+we,S,T,R))return},Wn.prototype._convertToXCellCoord=function(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))},Wn.prototype._convertToYCellCoord=function(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))},Wn.prototype._circlesCollide=function(i,u,a,h,g,S){var T=h-i,R=g-u,G=a+S;return G*G>T*T+R*R},Wn.prototype._circleAndRectCollide=function(i,u,a,h,g,S,T){var R=(S-h)/2,G=Math.abs(i-(h+R));if(G>R+a)return!1;var ee=(T-g)/2,ve=Math.abs(u-(g+ee));if(ve>ee+a)return!1;if(G<=R||ve<=ee)return!0;var ye=G-R,we=ve-ee;return ye*ye+we*we<=a*a};var qa=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ka(i,u){for(var a=0;a<i;a++){var h=u.length;u.resize(h+4),u.float32.set(qa,3*h)}}function $a(i,u,a){var h=u[0],g=u[1];return i[0]=a[0]*h+a[4]*g+a[12],i[1]=a[1]*h+a[5]*g+a[13],i[3]=a[3]*h+a[7]*g+a[15],i}var Yo=function(i,u,a){u===void 0&&(u=new Wn(i.width+200,i.height+200,25)),a===void 0&&(a=new Wn(i.width+200,i.height+200,25)),this.transform=i,this.grid=u,this.ignoredGrid=a,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+100,this.screenBottomBoundary=i.height+100,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200};function Gi(i,u,a){return u*(p.EXTENT/(i.tileSize*Math.pow(2,a-i.tileID.overscaledZ)))}Yo.prototype.placeCollisionBox=function(i,u,a,h,g){var S=this.projectAndGetPerspectiveRatio(h,i.anchorPointX,i.anchorPointY),T=a*S.perspectiveRatio,R=i.x1*T+S.point.x,G=i.y1*T+S.point.y,ee=i.x2*T+S.point.x,ve=i.y2*T+S.point.y;return!this.isInsideGrid(R,G,ee,ve)||!u&&this.grid.hitTest(R,G,ee,ve,g)?{box:[],offscreen:!1}:{box:[R,G,ee,ve],offscreen:this.isOffscreen(R,G,ee,ve)}},Yo.prototype.placeCollisionCircles=function(i,u,a,h,g,S,T,R,G,ee,ve,ye,we){var Ke=[],He=new p.Point(u.anchorX,u.anchorY),at=Qn(He,S),ze=Fi(this.transform.cameraToCenterDistance,at.signedDistanceFromCamera),it=(ee?g/ze:g*ze)/p.ONE_EM,mt=Qn(He,T).point,Ut=_a(it,h,u.lineOffsetX*it,u.lineOffsetY*it,!1,mt,He,u,a,T,{}),sr=!1,nr=!1,cr=!0;if(Ut){for(var Rr=.5*ye*ze+we,tn=new p.Point(-100,-100),Xr=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),yn=new za,Fn=Ut.first,Vn=Ut.last,jn=[],Qi=Fn.path.length-1;Qi>=1;Qi--)jn.push(Fn.path[Qi]);for(var _n=1;_n<Vn.path.length;_n++)jn.push(Vn.path[_n]);var ci=2.5*Rr;if(R){var Ci=jn.map(function(Ls){return Qn(Ls,R)});jn=Ci.some(function(Ls){return Ls.signedDistanceFromCamera<=0})?[]:Ci.map(function(Ls){return Ls.point})}var fi=[];if(jn.length>0){for(var oi=jn[0].clone(),Ti=jn[0].clone(),ii=1;ii<jn.length;ii++)oi.x=Math.min(oi.x,jn[ii].x),oi.y=Math.min(oi.y,jn[ii].y),Ti.x=Math.max(Ti.x,jn[ii].x),Ti.y=Math.max(Ti.y,jn[ii].y);fi=oi.x>=tn.x&&Ti.x<=Xr.x&&oi.y>=tn.y&&Ti.y<=Xr.y?[jn]:Ti.x<tn.x||oi.x>Xr.x||Ti.y<tn.y||oi.y>Xr.y?[]:p.clipLine([jn],tn.x,tn.y,Xr.x,Xr.y)}for(var ri=0,Po=fi;ri<Po.length;ri+=1){var Ja;yn.reset(Po[ri],.25*Rr),Ja=yn.length<=.5*Rr?1:Math.ceil(yn.paddedLength/ci)+1;for(var os=0;os<Ja;os++){var Zo=os/Math.max(Ja-1,1),Ga=yn.lerp(Zo),no=Ga.x+100,ds=Ga.y+100;Ke.push(no,ds,Rr,0);var vs=no-Rr,el=ds-Rr,ms=no+Rr,eu=ds+Rr;if(cr=cr&&this.isOffscreen(vs,el,ms,eu),nr=nr||this.isInsideGrid(vs,el,ms,eu),!i&&this.grid.hitTestCircle(no,ds,Rr,ve)&&(sr=!0,!G))return{circles:[],offscreen:!1,collisionDetected:sr}}}}return{circles:!G&&sr||!nr?[]:Ke,offscreen:cr,collisionDetected:sr}},Yo.prototype.queryRenderedSymbols=function(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var u=[],a=1/0,h=1/0,g=-1/0,S=-1/0,T=0,R=i;T<R.length;T+=1){var G=R[T],ee=new p.Point(G.x+100,G.y+100);a=Math.min(a,ee.x),h=Math.min(h,ee.y),g=Math.max(g,ee.x),S=Math.max(S,ee.y),u.push(ee)}for(var ve={},ye={},we=0,Ke=this.grid.query(a,h,g,S).concat(this.ignoredGrid.query(a,h,g,S));we<Ke.length;we+=1){var He=Ke[we],at=He.key;if(ve[at.bucketInstanceId]===void 0&&(ve[at.bucketInstanceId]={}),!ve[at.bucketInstanceId][at.featureIndex]){var ze=[new p.Point(He.x1,He.y1),new p.Point(He.x2,He.y1),new p.Point(He.x2,He.y2),new p.Point(He.x1,He.y2)];p.polygonIntersectsPolygon(u,ze)&&(ve[at.bucketInstanceId][at.featureIndex]=!0,ye[at.bucketInstanceId]===void 0&&(ye[at.bucketInstanceId]=[]),ye[at.bucketInstanceId].push(at.featureIndex))}}return ye},Yo.prototype.insertCollisionBox=function(i,u,a,h,g){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:a,featureIndex:h,collisionGroupID:g},i[0],i[1],i[2],i[3])},Yo.prototype.insertCollisionCircles=function(i,u,a,h,g){for(var S=u?this.ignoredGrid:this.grid,T={bucketInstanceId:a,featureIndex:h,collisionGroupID:g},R=0;R<i.length;R+=4)S.insertCircle(T,i[R],i[R+1],i[R+2])},Yo.prototype.projectAndGetPerspectiveRatio=function(i,u,a){var h=[u,a,0,1];return $a(h,h,i),{point:new p.Point((h[0]/h[3]+1)/2*this.transform.width+100,(-h[1]/h[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/h[3]*.5}},Yo.prototype.isOffscreen=function(i,u,a,h){return a<100||i>=this.screenRightBoundary||h<100||u>this.screenBottomBoundary},Yo.prototype.isInsideGrid=function(i,u,a,h){return a>=0&&i<this.gridRightBoundary&&h>=0&&u<this.gridBottomBoundary},Yo.prototype.getViewportMatrix=function(){var i=p.identity([]);return p.translate(i,i,[-100,-100,0]),i};var Oo=function(i,u,a,h){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?u:-u))):h&&a?1:0,this.placed=a};Oo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Oa=function(i,u,a,h,g){this.text=new Oo(i?i.text:null,u,a,g),this.icon=new Oo(i?i.icon:null,u,h,g)};Oa.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Za=function(i,u,a){this.text=i,this.icon=u,this.skipFade=a},cs=function(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]},va=function(i,u,a,h,g){this.bucketInstanceId=i,this.featureIndex=u,this.sourceLayerIndex=a,this.bucketIndex=h,this.tileID=g},fs=function(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}};function Ca(i,u,a,h,g){var S=p.getAnchorAlignment(i),T=-(S.horizontalAlign-.5)*u,R=-(S.verticalAlign-.5)*a,G=p.evaluateVariableOffset(i,h);return new p.Point(T+G[0]*g,R+G[1]*g)}function fo(i,u,a,h,g,S){var T=i.x1,R=i.x2,G=i.y1,ee=i.y2,ve=i.anchorPointX,ye=i.anchorPointY,we=new p.Point(u,a);return h&&we._rotate(g?S:-S),{x1:T+we.x,y1:G+we.y,x2:R+we.x,y2:ee+we.y,anchorPointX:ve,anchorPointY:ye}}fs.prototype.get=function(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){var u=++this.maxGroupID;this.collisionGroups[i]={ID:u,predicate:function(a){return a.collisionGroupID===u}}}return this.collisionGroups[i]};var Zi=function(i,u,a,h){this.transform=i.clone(),this.collisionIndex=new Yo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new fs(a),this.collisionCircleArrays={},this.prevPlacement=h,h&&(h.prevPlacement=void 0),this.placedOrientations={}};function pe(i,u,a,h,g){i.emplaceBack(u?1:0,a?1:0,h||0,g||0),i.emplaceBack(u?1:0,a?1:0,h||0,g||0),i.emplaceBack(u?1:0,a?1:0,h||0,g||0),i.emplaceBack(u?1:0,a?1:0,h||0,g||0)}Zi.prototype.getBucketParts=function(i,u,a,h){var g=a.getBucket(u),S=a.latestFeatureIndex;if(g&&S&&u.id===g.layerIds[0]){var T=a.collisionBoxArray,R=g.layers[0].layout,G=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),ee=a.tileSize/p.EXTENT,ve=this.transform.calculatePosMatrix(a.tileID.toUnwrapped()),ye=R.get("text-pitch-alignment")==="map",we=R.get("text-rotation-alignment")==="map",Ke=Gi(a,1,this.transform.zoom),He=ai(ve,ye,we,this.transform,Ke),at=null;if(ye){var ze=Ai(ve,ye,we,this.transform,Ke);at=p.multiply([],this.transform.labelPlaneMatrix,ze)}this.retainedQueryData[g.bucketInstanceId]=new va(g.bucketInstanceId,S,g.sourceLayerIndex,g.index,a.tileID);var it={bucket:g,layout:R,posMatrix:ve,textLabelPlaneMatrix:He,labelToScreenMatrix:at,scale:G,textPixelRatio:ee,holdingForFade:a.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(h)for(var mt=0,Ut=g.sortKeyRanges;mt<Ut.length;mt+=1){var sr=Ut[mt];i.push({sortKey:sr.sortKey,symbolInstanceStart:sr.symbolInstanceStart,symbolInstanceEnd:sr.symbolInstanceEnd,parameters:it})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:it})}},Zi.prototype.attemptAnchorPlacement=function(i,u,a,h,g,S,T,R,G,ee,ve,ye,we,Ke,He){var at,ze=[ye.textOffset0,ye.textOffset1],it=Ca(i,a,h,ze,g),mt=this.collisionIndex.placeCollisionBox(fo(u,it.x,it.y,S,T,this.transform.angle),ve,R,G,ee.predicate);if(!He||this.collisionIndex.placeCollisionBox(fo(He,it.x,it.y,S,T,this.transform.angle),ve,R,G,ee.predicate).box.length!==0)return mt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[ye.crossTileID]&&this.prevPlacement.placements[ye.crossTileID]&&this.prevPlacement.placements[ye.crossTileID].text&&(at=this.prevPlacement.variableOffsets[ye.crossTileID].anchor),this.variableOffsets[ye.crossTileID]={textOffset:ze,width:a,height:h,anchor:i,textBoxScale:g,prevAnchor:at},this.markUsedJustification(we,i,ye,Ke),we.allowVerticalPlacement&&(this.markUsedOrientation(we,Ke,ye),this.placedOrientations[ye.crossTileID]=Ke),{shift:it,placedGlyphBoxes:mt}):void 0},Zi.prototype.placeLayerBucketPart=function(i,u,a){var h=this,g=i.parameters,S=g.bucket,T=g.layout,R=g.posMatrix,G=g.textLabelPlaneMatrix,ee=g.labelToScreenMatrix,ve=g.textPixelRatio,ye=g.holdingForFade,we=g.collisionBoxArray,Ke=g.partiallyEvaluatedTextSize,He=g.collisionGroup,at=T.get("text-optional"),ze=T.get("icon-optional"),it=T.get("text-allow-overlap"),mt=T.get("icon-allow-overlap"),Ut=T.get("text-rotation-alignment")==="map",sr=T.get("text-pitch-alignment")==="map",nr=T.get("icon-text-fit")!=="none",cr=T.get("symbol-z-order")==="viewport-y",Rr=it&&(mt||!S.hasIconData()||ze),tn=mt&&(it||!S.hasTextData()||at);!S.collisionArrays&&we&&S.deserializeCollisionBoxes(we);var Xr=function(_n,ci){if(!u[_n.crossTileID])if(ye)h.placements[_n.crossTileID]=new Za(!1,!1,!1);else{var Ci,fi=!1,oi=!1,Ti=!0,ii=null,ri={box:null,offscreen:null},Po={box:null,offscreen:null},Ja=null,os=null,Zo=0,Ga=0,no=0;ci.textFeatureIndex?Zo=ci.textFeatureIndex:_n.useRuntimeCollisionCircles&&(Zo=_n.featureIndex),ci.verticalTextFeatureIndex&&(Ga=ci.verticalTextFeatureIndex);var ds=ci.textBox;if(ds){var vs=function(qi){var ao=p.WritingMode.horizontal;if(S.allowVerticalPlacement&&!qi&&h.prevPlacement){var ko=h.prevPlacement.placedOrientations[_n.crossTileID];ko&&(h.placedOrientations[_n.crossTileID]=ko,h.markUsedOrientation(S,ao=ko,_n))}return ao},el=function(qi,ao){if(S.allowVerticalPlacement&&_n.numVerticalGlyphVertices>0&&ci.verticalTextBox)for(var ko=0,Rs=S.writingModes;ko<Rs.length&&(Rs[ko]===p.WritingMode.vertical?(ri=ao(),Po=ri):ri=qi(),!(ri&&ri.box&&ri.box.length));ko+=1);else ri=qi()};if(T.get("text-variable-anchor")){var ms=T.get("text-variable-anchor");if(h.prevPlacement&&h.prevPlacement.variableOffsets[_n.crossTileID]){var eu=h.prevPlacement.variableOffsets[_n.crossTileID];ms.indexOf(eu.anchor)>0&&(ms=ms.filter(function(qi){return qi!==eu.anchor})).unshift(eu.anchor)}var Ls=function(qi,ao,ko){for(var Rs=qi.x2-qi.x1,tl=qi.y2-qi.y1,vu=_n.textBoxScale,rl=nr&&!mt?ao:null,nl={box:[],offscreen:!1},Ec=it?2*ms.length:ms.length,Pu=0;Pu<Ec;++Pu){var Gl=h.attemptAnchorPlacement(ms[Pu%ms.length],qi,Rs,tl,vu,Ut,sr,ve,R,He,Pu>=ms.length,_n,S,ko,rl);if(Gl&&(nl=Gl.placedGlyphBoxes)&&nl.box&&nl.box.length){fi=!0,ii=Gl.shift;break}}return nl};el(function(){return Ls(ds,ci.iconBox,p.WritingMode.horizontal)},function(){var qi=ci.verticalTextBox;return S.allowVerticalPlacement&&!(ri&&ri.box&&ri.box.length)&&_n.numVerticalGlyphVertices>0&&qi?Ls(qi,ci.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null}}),ri&&(fi=ri.box,Ti=ri.offscreen);var xl=vs(ri&&ri.box);if(!fi&&h.prevPlacement){var bl=h.prevPlacement.variableOffsets[_n.crossTileID];bl&&(h.variableOffsets[_n.crossTileID]=bl,h.markUsedJustification(S,bl.anchor,_n,xl))}}else{var Nu=function(qi,ao){var ko=h.collisionIndex.placeCollisionBox(qi,it,ve,R,He.predicate);return ko&&ko.box&&ko.box.length&&(h.markUsedOrientation(S,ao,_n),h.placedOrientations[_n.crossTileID]=ao),ko};el(function(){return Nu(ds,p.WritingMode.horizontal)},function(){var qi=ci.verticalTextBox;return S.allowVerticalPlacement&&_n.numVerticalGlyphVertices>0&&qi?Nu(qi,p.WritingMode.vertical):{box:null,offscreen:null}}),vs(ri&&ri.box&&ri.box.length)}}if(fi=(Ci=ri)&&Ci.box&&Ci.box.length>0,Ti=Ci&&Ci.offscreen,_n.useRuntimeCollisionCircles){var tu=S.text.placedSymbolArray.get(_n.centerJustifiedTextSymbolIndex),Vl=p.evaluateSizeForFeature(S.textSizeData,Ke,tu),Tu=T.get("text-padding");Ja=h.collisionIndex.placeCollisionCircles(it,tu,S.lineVertexArray,S.glyphOffsetArray,Vl,R,G,ee,a,sr,He.predicate,_n.collisionCircleDiameter,Tu),fi=it||Ja.circles.length>0&&!Ja.collisionDetected,Ti=Ti&&Ja.offscreen}if(ci.iconFeatureIndex&&(no=ci.iconFeatureIndex),ci.iconBox){var zu=function(qi){var ao=nr&&ii?fo(qi,ii.x,ii.y,Ut,sr,h.transform.angle):qi;return h.collisionIndex.placeCollisionBox(ao,mt,ve,R,He.predicate)};oi=Po&&Po.box&&Po.box.length&&ci.verticalIconBox?(os=zu(ci.verticalIconBox)).box.length>0:(os=zu(ci.iconBox)).box.length>0,Ti=Ti&&os.offscreen}var Hs=at||_n.numHorizontalGlyphVertices===0&&_n.numVerticalGlyphVertices===0,io=ze||_n.numIconVertices===0;if(Hs||io?io?Hs||(oi=oi&&fi):fi=oi&&fi:oi=fi=oi&&fi,fi&&Ci&&Ci.box&&h.collisionIndex.insertCollisionBox(Ci.box,T.get("text-ignore-placement"),S.bucketInstanceId,Po&&Po.box&&Ga?Ga:Zo,He.ID),oi&&os&&h.collisionIndex.insertCollisionBox(os.box,T.get("icon-ignore-placement"),S.bucketInstanceId,no,He.ID),Ja&&(fi&&h.collisionIndex.insertCollisionCircles(Ja.circles,T.get("text-ignore-placement"),S.bucketInstanceId,Zo,He.ID),a)){var Au=S.bucketInstanceId,du=h.collisionCircleArrays[Au];du===void 0&&(du=h.collisionCircleArrays[Au]=new cs);for(var gs=0;gs<Ja.circles.length;gs+=4)du.circles.push(Ja.circles[gs+0]),du.circles.push(Ja.circles[gs+1]),du.circles.push(Ja.circles[gs+2]),du.circles.push(Ja.collisionDetected?1:0)}h.placements[_n.crossTileID]=new Za(fi||Rr,oi||tn,Ti||S.justReloaded),u[_n.crossTileID]=!0}};if(cr)for(var yn=S.getSortedSymbolIndexes(this.transform.angle),Fn=yn.length-1;Fn>=0;--Fn){var Vn=yn[Fn];Xr(S.symbolInstances.get(Vn),S.collisionArrays[Vn])}else for(var jn=i.symbolInstanceStart;jn<i.symbolInstanceEnd;jn++)Xr(S.symbolInstances.get(jn),S.collisionArrays[jn]);if(a&&S.bucketInstanceId in this.collisionCircleArrays){var Qi=this.collisionCircleArrays[S.bucketInstanceId];p.invert(Qi.invProjMatrix,R),Qi.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1},Zi.prototype.markUsedJustification=function(i,u,a,h){var g;g=h===p.WritingMode.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[p.getAnchorJustification(u)];for(var S=0,T=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];S<T.length;S+=1){var R=T[S];R>=0&&(i.text.placedSymbolArray.get(R).crossTileID=g>=0&&R!==g?0:a.crossTileID)}},Zi.prototype.markUsedOrientation=function(i,u,a){for(var h=u===p.WritingMode.horizontal||u===p.WritingMode.horizontalOnly?u:0,g=u===p.WritingMode.vertical?u:0,S=0,T=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];S<T.length;S+=1)i.text.placedSymbolArray.get(T[S]).placedOrientation=h;a.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=g)},Zi.prototype.commit=function(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;var u=this.prevPlacement,a=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;var h=u?u.symbolFadeChange(i):1,g=u?u.opacities:{},S=u?u.variableOffsets:{},T=u?u.placedOrientations:{};for(var R in this.placements){var G=this.placements[R],ee=g[R];ee?(this.opacities[R]=new Oa(ee,h,G.text,G.icon),a=a||G.text!==ee.text.placed||G.icon!==ee.icon.placed):(this.opacities[R]=new Oa(null,h,G.text,G.icon,G.skipFade),a=a||G.text||G.icon)}for(var ve in g){var ye=g[ve];if(!this.opacities[ve]){var we=new Oa(ye,h,!1,!1);we.isHidden()||(this.opacities[ve]=we,a=a||ye.text.placed||ye.icon.placed)}}for(var Ke in S)this.variableOffsets[Ke]||!this.opacities[Ke]||this.opacities[Ke].isHidden()||(this.variableOffsets[Ke]=S[Ke]);for(var He in T)this.placedOrientations[He]||!this.opacities[He]||this.opacities[He].isHidden()||(this.placedOrientations[He]=T[He]);a?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:i)},Zi.prototype.updateLayerOpacities=function(i,u){for(var a={},h=0,g=u;h<g.length;h+=1){var S=g[h],T=S.getBucket(i);T&&S.latestFeatureIndex&&i.id===T.layerIds[0]&&this.updateBucketOpacities(T,a,S.collisionBoxArray)}},Zi.prototype.updateBucketOpacities=function(i,u,a){var h=this;i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();var g=i.layers[0].layout,S=new Oa(null,0,!1,!1,!0),T=g.get("text-allow-overlap"),R=g.get("icon-allow-overlap"),G=g.get("text-variable-anchor"),ee=g.get("text-rotation-alignment")==="map",ve=g.get("text-pitch-alignment")==="map",ye=g.get("icon-text-fit")!=="none",we=new Oa(null,0,T&&(R||!i.hasIconData()||g.get("icon-optional")),R&&(T||!i.hasTextData()||g.get("text-optional")),!0);!i.collisionArrays&&a&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(a);for(var Ke=function(it,mt,Ut){for(var sr=0;sr<mt/4;sr++)it.opacityVertexArray.emplaceBack(Ut)},He=function(it){var mt=i.symbolInstances.get(it),Ut=mt.numHorizontalGlyphVertices,sr=mt.numVerticalGlyphVertices,nr=mt.crossTileID,cr=h.opacities[nr];u[nr]?cr=S:cr||(h.opacities[nr]=cr=we),u[nr]=!0;var Rr=mt.numIconVertices>0,tn=h.placedOrientations[mt.crossTileID],Xr=tn===p.WritingMode.vertical,yn=tn===p.WritingMode.horizontal||tn===p.WritingMode.horizontalOnly;if(Ut>0||sr>0){var Fn=La(cr.text);Ke(i.text,Ut,Xr?ja:Fn),Ke(i.text,sr,yn?ja:Fn);var Vn=cr.text.isHidden();[mt.rightJustifiedTextSymbolIndex,mt.centerJustifiedTextSymbolIndex,mt.leftJustifiedTextSymbolIndex].forEach(function(ri){ri>=0&&(i.text.placedSymbolArray.get(ri).hidden=Vn||Xr?1:0)}),mt.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(mt.verticalPlacedTextSymbolIndex).hidden=Vn||yn?1:0);var jn=h.variableOffsets[mt.crossTileID];jn&&h.markUsedJustification(i,jn.anchor,mt,tn);var Qi=h.placedOrientations[mt.crossTileID];Qi&&(h.markUsedJustification(i,"left",mt,Qi),h.markUsedOrientation(i,Qi,mt))}if(Rr){var _n=La(cr.icon),ci=!(ye&&mt.verticalPlacedIconSymbolIndex&&Xr);mt.placedIconSymbolIndex>=0&&(Ke(i.icon,mt.numIconVertices,ci?_n:ja),i.icon.placedSymbolArray.get(mt.placedIconSymbolIndex).hidden=cr.icon.isHidden()),mt.verticalPlacedIconSymbolIndex>=0&&(Ke(i.icon,mt.numVerticalIconVertices,ci?ja:_n),i.icon.placedSymbolArray.get(mt.verticalPlacedIconSymbolIndex).hidden=cr.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){var Ci=i.collisionArrays[it];if(Ci){var fi=new p.Point(0,0);if(Ci.textBox||Ci.verticalTextBox){var oi=!0;if(G){var Ti=h.variableOffsets[nr];Ti?(fi=Ca(Ti.anchor,Ti.width,Ti.height,Ti.textOffset,Ti.textBoxScale),ee&&fi._rotate(ve?h.transform.angle:-h.transform.angle)):oi=!1}Ci.textBox&&pe(i.textCollisionBox.collisionVertexArray,cr.text.placed,!oi||Xr,fi.x,fi.y),Ci.verticalTextBox&&pe(i.textCollisionBox.collisionVertexArray,cr.text.placed,!oi||yn,fi.x,fi.y)}var ii=Boolean(!yn&&Ci.verticalIconBox);Ci.iconBox&&pe(i.iconCollisionBox.collisionVertexArray,cr.icon.placed,ii,ye?fi.x:0,ye?fi.y:0),Ci.verticalIconBox&&pe(i.iconCollisionBox.collisionVertexArray,cr.icon.placed,!ii,ye?fi.x:0,ye?fi.y:0)}}},at=0;at<i.symbolInstances.length;at++)He(at);if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){var ze=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=ze.invProjMatrix,i.placementViewportMatrix=ze.viewportMatrix,i.collisionCircleArray=ze.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}},Zi.prototype.symbolFadeChange=function(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Zi.prototype.zoomAdjustment=function(i){return Math.max(0,(this.transform.zoom-i)/1.5)},Zi.prototype.hasTransitions=function(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration},Zi.prototype.stillRecent=function(i,u){var a=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*a>i},Zi.prototype.setStale=function(){this.stale=!0};var Le=Math.pow(2,25),vt=Math.pow(2,24),hr=Math.pow(2,17),Qr=Math.pow(2,16),Dn=Math.pow(2,9),Ki=Math.pow(2,8),Ua=Math.pow(2,1);function La(i){if(i.opacity===0&&!i.placed)return 0;if(i.opacity===1&&i.placed)return 4294967295;var u=i.placed?1:0,a=Math.floor(127*i.opacity);return a*Le+u*vt+a*hr+u*Qr+a*Dn+u*Ki+a*Ua+u}var ja=0,To=function(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};To.prototype.continuePlacement=function(i,u,a,h,g){for(var S=this._bucketParts;this._currentTileIndex<i.length;)if(u.getBucketParts(S,h,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort(function(T,R){return T.sortKey-R.sortKey}));this._currentPartIndex<S.length;)if(u.placeLayerBucketPart(S[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,g())return!0;return!1};var Mu=function(i,u,a,h,g,S,T){this.placement=new Zi(i,g,S,T),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=a,this._showCollisionBoxes=h,this._done=!1};Mu.prototype.isDone=function(){return this._done},Mu.prototype.continuePlacement=function(i,u,a){for(var h=this,g=p.browser.now(),S=function(){var G=p.browser.now()-g;return!h._forceFullPlacement&&G>2};this._currentPlacementIndex>=0;){var T=u[i[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=R)&&(!T.maxzoom||T.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new To(T)),this._inProgressLayer.continuePlacement(a[T.source],this.placement,this._showCollisionBoxes,T,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Mu.prototype.commit=function(i){return this.placement.commit(i),this.placement};var $l=512/p.EXTENT/2,Il=function(i,u,a){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=a;for(var h=0;h<u.length;h++){var g=u.get(h),S=g.key;this.indexedSymbolInstances[S]||(this.indexedSymbolInstances[S]=[]),this.indexedSymbolInstances[S].push({crossTileID:g.crossTileID,coord:this.getScaledCoordinates(g,i)})}};Il.prototype.getScaledCoordinates=function(i,u){var a=$l/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*p.EXTENT+i.anchorX)*a),y:Math.floor((u.canonical.y*p.EXTENT+i.anchorY)*a)}},Il.prototype.findMatches=function(i,u,a){for(var h=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),g=0;g<i.length;g++){var S=i.get(g);if(!S.crossTileID){var T=this.indexedSymbolInstances[S.key];if(T)for(var R=this.getScaledCoordinates(S,u),G=0,ee=T;G<ee.length;G+=1){var ve=ee[G];if(Math.abs(ve.coord.x-R.x)<=h&&Math.abs(ve.coord.y-R.y)<=h&&!a[ve.crossTileID]){a[ve.crossTileID]=!0,S.crossTileID=ve.crossTileID;break}}}}};var Lo=function(){this.maxCrossTileID=0};Lo.prototype.generate=function(){return++this.maxCrossTileID};var Xs=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Xs.prototype.handleWrapJump=function(i){var u=Math.round((i-this.lng)/360);if(u!==0)for(var a in this.indexes){var h=this.indexes[a],g={};for(var S in h){var T=h[S];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+u),g[T.tileID.key]=T}this.indexes[a]=g}this.lng=i},Xs.prototype.addBucket=function(i,u,a){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(var h=0;h<u.symbolInstances.length;h++)u.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});var g=this.usedCrossTileIDs[i.overscaledZ];for(var S in this.indexes){var T=this.indexes[S];if(Number(S)>i.overscaledZ)for(var R in T){var G=T[R];G.tileID.isChildOf(i)&&G.findMatches(u.symbolInstances,i,g)}else{var ee=T[i.scaledTo(Number(S)).key];ee&&ee.findMatches(u.symbolInstances,i,g)}}for(var ve=0;ve<u.symbolInstances.length;ve++){var ye=u.symbolInstances.get(ve);ye.crossTileID||(ye.crossTileID=a.generate(),g[ye.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Il(i,u.symbolInstances,u.bucketInstanceId),!0},Xs.prototype.removeBucketCrossTileIDs=function(i,u){for(var a in u.indexedSymbolInstances)for(var h=0,g=u.indexedSymbolInstances[a];h<g.length;h+=1)delete this.usedCrossTileIDs[i][g[h].crossTileID]},Xs.prototype.removeStaleBuckets=function(i){var u=!1;for(var a in this.indexes){var h=this.indexes[a];for(var g in h)i[h[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,h[g]),delete h[g],u=!0)}return u};var ua=function(){this.layerIndexes={},this.crossTileIDs=new Lo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};ua.prototype.addLayer=function(i,u,a){var h=this.layerIndexes[i.id];h===void 0&&(h=this.layerIndexes[i.id]=new Xs);var g=!1,S={};h.handleWrapJump(a);for(var T=0,R=u;T<R.length;T+=1){var G=R[T],ee=G.getBucket(i);ee&&i.id===ee.layerIds[0]&&(ee.bucketInstanceId||(ee.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(G.tileID,ee,this.crossTileIDs)&&(g=!0),S[ee.bucketInstanceId]=!0)}return h.removeStaleBuckets(S)&&(g=!0),g},ua.prototype.pruneUnusedLayers=function(i){var u={};for(var a in i.forEach(function(h){u[h]=!0}),this.layerIndexes)u[a]||delete this.layerIndexes[a]};var Ns=function(i,u){return p.emitValidationErrors(i,u&&u.filter(function(a){return a.identifier!=="source.canvas"}))},ou=p.pick(ln,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),bs=p.pick(ln,["setCenter","setZoom","setBearing","setPitch"]),Ps=function(){var i={},u=p.styleSpec.$version;for(var a in p.styleSpec.$root){var h,g=p.styleSpec.$root[a];g.required&&(h=a==="version"?u:g.type==="array"?[]:{})!=null&&(i[a]=h)}return i}(),ti=function(i){function u(a,h){var g=this;h===void 0&&(h={}),i.call(this),this.map=a,this.dispatcher=new Ae(gr(),this),this.imageManager=new Ht,this.imageManager.setEventedParent(this),this.glyphManager=new Ft(a._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Ie(256,512),this.crossTileSymbolIndex=new ua,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new p.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());var S=this;this._rtlTextPluginCallback=u.registerForPluginStateChange(function(T){S.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:T.pluginStatus,pluginURL:T.pluginURL},function(R,G){if(p.triggerPluginCompletionEvent(R),G&&G.every(function(ve){return ve}))for(var ee in S.sourceCaches)S.sourceCaches[ee].reload()})}),this.on("data",function(T){if(T.dataType==="source"&&T.sourceDataType==="metadata"){var R=g.sourceCaches[T.sourceId];if(R){var G=R.getSource();if(G&&G.vectorLayerIds)for(var ee in g._layers){var ve=g._layers[ee];ve.source===G.id&&g._validateLayer(ve)}}}})}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.loadURL=function(a,h){var g=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"}));var S=typeof h.validate=="boolean"?h.validate:!p.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,h.accessToken);var T=this.map._requestManager.transformRequest(a,p.ResourceType.Style);this._request=p.getJSON(T,function(R,G){g._request=null,R?g.fire(new p.ErrorEvent(R)):G&&g._load(G,S)})},u.prototype.loadJSON=function(a,h){var g=this;h===void 0&&(h={}),this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.browser.frame(function(){g._request=null,g._load(a,h.validate!==!1)})},u.prototype.loadEmpty=function(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(Ps,!1)},u.prototype._load=function(a,h){if(!h||!Ns(this,p.validateStyle(a))){for(var g in this._loaded=!0,this.stylesheet=a,a.sources)this.addSource(g,a.sources[g],{validate:!1});a.sprite?this._loadSprite(a.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(a.glyphs);var S=Wr(this.stylesheet.layers);this._order=S.map(function(ee){return ee.id}),this._layers={},this._serializedLayers={};for(var T=0,R=S;T<R.length;T+=1){var G=R[T];(G=p.createStyleLayer(G)).setEventedParent(this,{layer:{id:G.id}}),this._layers[G.id]=G,this._serializedLayers[G.id]=G.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Qe(this.stylesheet.light),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}},u.prototype._loadSprite=function(a){var h=this;this._spriteRequest=function(g,S,T){var R,G,ee,ve=p.browser.devicePixelRatio>1?"@2x":"",ye=p.getJSON(S.transformRequest(S.normalizeSpriteURL(g,ve,".json"),p.ResourceType.SpriteJSON),function(He,at){ye=null,ee||(ee=He,R=at,Ke())}),we=p.getImage(S.transformRequest(S.normalizeSpriteURL(g,ve,".png"),p.ResourceType.SpriteImage),function(He,at){we=null,ee||(ee=He,G=at,Ke())});function Ke(){if(ee)T(ee);else if(R&&G){var He=p.browser.getImageData(G),at={};for(var ze in R){var it=R[ze],mt=it.width,Ut=it.height,sr=it.x,nr=it.y,cr=it.sdf,Rr=it.pixelRatio,tn=it.stretchX,Xr=it.stretchY,yn=it.content,Fn=new p.RGBAImage({width:mt,height:Ut});p.RGBAImage.copy(He,Fn,{x:sr,y:nr},{x:0,y:0},{width:mt,height:Ut}),at[ze]={data:Fn,pixelRatio:Rr,sdf:cr,stretchX:tn,stretchY:Xr,content:yn}}T(null,at)}}return{cancel:function(){ye&&(ye.cancel(),ye=null),we&&(we.cancel(),we=null)}}}(a,this.map._requestManager,function(g,S){if(h._spriteRequest=null,g)h.fire(new p.ErrorEvent(g));else if(S)for(var T in S)h.imageManager.addImage(T,S[T]);h.imageManager.setLoaded(!0),h._availableImages=h.imageManager.listImages(),h.dispatcher.broadcast("setImages",h._availableImages),h.fire(new p.Event("data",{dataType:"style"}))})},u.prototype._validateLayer=function(a){var h=this.sourceCaches[a.source];if(h){var g=a.sourceLayer;if(g){var S=h.getSource();(S.type==="geojson"||S.vectorLayerIds&&S.vectorLayerIds.indexOf(g)===-1)&&this.fire(new p.ErrorEvent(new Error('Source layer "'+g+'" does not exist on source "'+S.id+'" as specified by style layer "'+a.id+'"')))}}},u.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var a in this.sourceCaches)if(!this.sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()},u.prototype._serializeLayers=function(a){for(var h=[],g=0,S=a;g<S.length;g+=1){var T=this._layers[S[g]];T.type!=="custom"&&h.push(T.serialize())}return h},u.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var a in this.sourceCaches)if(this.sourceCaches[a].hasTransition())return!0;for(var h in this._layers)if(this._layers[h].hasTransition())return!0;return!1},u.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},u.prototype.update=function(a){if(this._loaded){var h=this._changed;if(this._changed){var g=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);for(var T in(g.length||S.length)&&this._updateWorkerLayers(g,S),this._updatedSources){var R=this._updatedSources[T];R==="reload"?this._reloadSource(T):R==="clear"&&this._clearSource(T)}for(var G in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[G].updateTransitions(a);this.light.updateTransitions(a),this._resetUpdates()}var ee={};for(var ve in this.sourceCaches){var ye=this.sourceCaches[ve];ee[ve]=ye.used,ye.used=!1}for(var we=0,Ke=this._order;we<Ke.length;we+=1){var He=this._layers[Ke[we]];He.recalculate(a,this._availableImages),!He.isHidden(a.zoom)&&He.source&&(this.sourceCaches[He.source].used=!0)}for(var at in ee){var ze=this.sourceCaches[at];ee[at]!==ze.used&&ze.fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:at}))}this.light.recalculate(a),this.z=a.zoom,h&&this.fire(new p.Event("data",{dataType:"style"}))}},u.prototype._updateTilesForChangedImages=function(){var a=Object.keys(this._changedImages);if(a.length){for(var h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}},u.prototype._updateWorkerLayers=function(a,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:h})},u.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},u.prototype.setState=function(a){var h=this;if(this._checkLoaded(),Ns(this,p.validateStyle(a)))return!1;(a=p.clone$1(a)).layers=Wr(a.layers);var g=function(T,R){if(!T)return[{command:ln.setStyle,args:[R]}];var G=[];try{if(!p.deepEqual(T.version,R.version))return[{command:ln.setStyle,args:[R]}];p.deepEqual(T.center,R.center)||G.push({command:ln.setCenter,args:[R.center]}),p.deepEqual(T.zoom,R.zoom)||G.push({command:ln.setZoom,args:[R.zoom]}),p.deepEqual(T.bearing,R.bearing)||G.push({command:ln.setBearing,args:[R.bearing]}),p.deepEqual(T.pitch,R.pitch)||G.push({command:ln.setPitch,args:[R.pitch]}),p.deepEqual(T.sprite,R.sprite)||G.push({command:ln.setSprite,args:[R.sprite]}),p.deepEqual(T.glyphs,R.glyphs)||G.push({command:ln.setGlyphs,args:[R.glyphs]}),p.deepEqual(T.transition,R.transition)||G.push({command:ln.setTransition,args:[R.transition]}),p.deepEqual(T.light,R.light)||G.push({command:ln.setLight,args:[R.light]});var ee={},ve=[];(function(we,Ke,He,at){var ze;for(ze in Ke=Ke||{},we=we||{})we.hasOwnProperty(ze)&&(Ke.hasOwnProperty(ze)||pn(ze,He,at));for(ze in Ke)Ke.hasOwnProperty(ze)&&(we.hasOwnProperty(ze)?p.deepEqual(we[ze],Ke[ze])||(we[ze].type==="geojson"&&Ke[ze].type==="geojson"&&Yi(we,Ke,ze)?He.push({command:ln.setGeoJSONSourceData,args:[ze,Ke[ze].data]}):wi(ze,Ke,He,at)):Ei(ze,Ke,He))})(T.sources,R.sources,ve,ee);var ye=[];T.layers&&T.layers.forEach(function(we){ee[we.source]?G.push({command:ln.removeLayer,args:[we.id]}):ye.push(we)}),G=G.concat(ve),function(we,Ke,He){Ke=Ke||[];var at,ze,it,mt,Ut,sr,nr,cr=(we=we||[]).map(Di),Rr=Ke.map(Di),tn=we.reduce(ki,{}),Xr=Ke.reduce(ki,{}),yn=cr.slice(),Fn=Object.create(null);for(at=0,ze=0;at<cr.length;at++)Xr.hasOwnProperty(it=cr[at])?ze++:(He.push({command:ln.removeLayer,args:[it]}),yn.splice(yn.indexOf(it,ze),1));for(at=0,ze=0;at<Rr.length;at++)yn[yn.length-1-at]!==(it=Rr[Rr.length-1-at])&&(tn.hasOwnProperty(it)?(He.push({command:ln.removeLayer,args:[it]}),yn.splice(yn.lastIndexOf(it,yn.length-ze),1)):ze++,He.push({command:ln.addLayer,args:[Xr[it],sr=yn[yn.length-at]]}),yn.splice(yn.length-at,0,it),Fn[it]=!0);for(at=0;at<Rr.length;at++)if(mt=tn[it=Rr[at]],Ut=Xr[it],!Fn[it]&&!p.deepEqual(mt,Ut))if(p.deepEqual(mt.source,Ut.source)&&p.deepEqual(mt["source-layer"],Ut["source-layer"])&&p.deepEqual(mt.type,Ut.type)){for(nr in Yn(mt.layout,Ut.layout,He,it,null,ln.setLayoutProperty),Yn(mt.paint,Ut.paint,He,it,null,ln.setPaintProperty),p.deepEqual(mt.filter,Ut.filter)||He.push({command:ln.setFilter,args:[it,Ut.filter]}),p.deepEqual(mt.minzoom,Ut.minzoom)&&p.deepEqual(mt.maxzoom,Ut.maxzoom)||He.push({command:ln.setLayerZoomRange,args:[it,Ut.minzoom,Ut.maxzoom]}),mt)mt.hasOwnProperty(nr)&&nr!=="layout"&&nr!=="paint"&&nr!=="filter"&&nr!=="metadata"&&nr!=="minzoom"&&nr!=="maxzoom"&&(nr.indexOf("paint.")===0?Yn(mt[nr],Ut[nr],He,it,nr.slice(6),ln.setPaintProperty):p.deepEqual(mt[nr],Ut[nr])||He.push({command:ln.setLayerProperty,args:[it,nr,Ut[nr]]}));for(nr in Ut)Ut.hasOwnProperty(nr)&&!mt.hasOwnProperty(nr)&&nr!=="layout"&&nr!=="paint"&&nr!=="filter"&&nr!=="metadata"&&nr!=="minzoom"&&nr!=="maxzoom"&&(nr.indexOf("paint.")===0?Yn(mt[nr],Ut[nr],He,it,nr.slice(6),ln.setPaintProperty):p.deepEqual(mt[nr],Ut[nr])||He.push({command:ln.setLayerProperty,args:[it,nr,Ut[nr]]}))}else He.push({command:ln.removeLayer,args:[it]}),sr=yn[yn.lastIndexOf(it)+1],He.push({command:ln.addLayer,args:[Ut,sr]})}(ye,R.layers,G)}catch(we){console.warn("Unable to compute style diff:",we),G=[{command:ln.setStyle,args:[R]}]}return G}(this.serialize(),a).filter(function(T){return!(T.command in bs)});if(g.length===0)return!1;var S=g.filter(function(T){return!(T.command in ou)});if(S.length>0)throw new Error("Unimplemented: "+S.map(function(T){return T.command}).join(", ")+".");return g.forEach(function(T){T.command!=="setTransition"&&h[T.command].apply(h,T.args)}),this.stylesheet=a,!0},u.prototype.addImage=function(a,h){if(this.getImage(a))return this.fire(new p.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(a,h),this._afterImageUpdated(a)},u.prototype.updateImage=function(a,h){this.imageManager.updateImage(a,h)},u.prototype.getImage=function(a){return this.imageManager.getImage(a)},u.prototype.removeImage=function(a){if(!this.getImage(a))return this.fire(new p.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(a),this._afterImageUpdated(a)},u.prototype._afterImageUpdated=function(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))},u.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},u.prototype.addSource=function(a,h,g){var S=this;if(g===void 0&&(g={}),this._checkLoaded(),this.sourceCaches[a]!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(h).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(p.validateStyle.source,"sources."+a,h,null,g))){this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);var T=this.sourceCaches[a]=new ge(a,h,this.dispatcher);T.style=this,T.setEventedParent(this,function(){return{isSourceLoaded:S.loaded(),source:T.serialize(),sourceId:a}}),T.onAdd(this.map),this._changed=!0}},u.prototype.removeSource=function(a){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error("There is no source with this ID");for(var h in this._layers)if(this._layers[h].source===a)return this.fire(new p.ErrorEvent(new Error('Source "'+a+'" cannot be removed while layer "'+h+'" is using it.')));var g=this.sourceCaches[a];delete this.sourceCaches[a],delete this._updatedSources[a],g.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:a})),g.setEventedParent(null),g.clearTiles(),g.onRemove&&g.onRemove(this.map),this._changed=!0},u.prototype.setGeoJSONSourceData=function(a,h){this._checkLoaded(),this.sourceCaches[a].getSource().setData(h),this._changed=!0},u.prototype.getSource=function(a){return this.sourceCaches[a]&&this.sourceCaches[a].getSource()},u.prototype.addLayer=function(a,h,g){g===void 0&&(g={}),this._checkLoaded();var S=a.id;if(this.getLayer(S))this.fire(new p.ErrorEvent(new Error('Layer with id "'+S+'" already exists on this map')));else{var T;if(a.type==="custom"){if(Ns(this,p.validateCustomStyleLayer(a)))return;T=p.createStyleLayer(a)}else{if(typeof a.source=="object"&&(this.addSource(S,a.source),a=p.clone$1(a),a=p.extend(a,{source:S})),this._validate(p.validateStyle.layer,"layers."+S,a,{arrayIndex:-1},g))return;T=p.createStyleLayer(a),this._validateLayer(T),T.setEventedParent(this,{layer:{id:S}}),this._serializedLayers[T.id]=T.serialize()}var R=h?this._order.indexOf(h):this._order.length;if(h&&R===-1)this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.')));else{if(this._order.splice(R,0,S),this._layerOrderChanged=!0,this._layers[S]=T,this._removedLayers[S]&&T.source&&T.type!=="custom"){var G=this._removedLayers[S];delete this._removedLayers[S],G.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.sourceCaches[T.source].pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map)}}},u.prototype.moveLayer=function(a,h){if(this._checkLoaded(),this._changed=!0,this._layers[a]){if(a!==h){var g=this._order.indexOf(a);this._order.splice(g,1);var S=h?this._order.indexOf(h):this._order.length;h&&S===-1?this.fire(new p.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.'))):(this._order.splice(S,0,a),this._layerOrderChanged=!0)}}else this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be moved.")))},u.prototype.removeLayer=function(a){this._checkLoaded();var h=this._layers[a];if(h){h.setEventedParent(null);var g=this._order.indexOf(a);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=h,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],h.onRemove&&h.onRemove(this.map)}else this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be removed.")))},u.prototype.getLayer=function(a){return this._layers[a]},u.prototype.hasLayer=function(a){return a in this._layers},u.prototype.setLayerZoomRange=function(a,h,g){this._checkLoaded();var S=this.getLayer(a);S?S.minzoom===h&&S.maxzoom===g||(h!=null&&(S.minzoom=h),g!=null&&(S.maxzoom=g),this._updateLayer(S)):this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot have zoom extent.")))},u.prototype.setFilter=function(a,h,g){g===void 0&&(g={}),this._checkLoaded();var S=this.getLayer(a);if(S){if(!p.deepEqual(S.filter,h))return h==null?(S.filter=void 0,void this._updateLayer(S)):void(this._validate(p.validateStyle.filter,"layers."+S.id+".filter",h,null,g)||(S.filter=p.clone$1(h),this._updateLayer(S)))}else this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be filtered.")))},u.prototype.getFilter=function(a){return p.clone$1(this.getLayer(a).filter)},u.prototype.setLayoutProperty=function(a,h,g,S){S===void 0&&(S={}),this._checkLoaded();var T=this.getLayer(a);T?p.deepEqual(T.getLayoutProperty(h),g)||(T.setLayoutProperty(h,g,S),this._updateLayer(T)):this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getLayoutProperty=function(a,h){var g=this.getLayer(a);if(g)return g.getLayoutProperty(h);this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style.")))},u.prototype.setPaintProperty=function(a,h,g,S){S===void 0&&(S={}),this._checkLoaded();var T=this.getLayer(a);T?p.deepEqual(T.getPaintProperty(h),g)||(T.setPaintProperty(h,g,S)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new p.ErrorEvent(new Error("The layer '"+a+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getPaintProperty=function(a,h){return this.getLayer(a).getPaintProperty(h)},u.prototype.setFeatureState=function(a,h){this._checkLoaded();var g=a.source,S=a.sourceLayer,T=this.sourceCaches[g];if(T!==void 0){var R=T.getSource().type;R==="geojson"&&S?this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):R!=="vector"||S?(a.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),T.setFeatureState(S,a.id,h)):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},u.prototype.removeFeatureState=function(a,h){this._checkLoaded();var g=a.source,S=this.sourceCaches[g];if(S!==void 0){var T=S.getSource().type,R=T==="vector"?a.sourceLayer:void 0;T!=="vector"||R?h&&typeof a.id!="string"&&typeof a.id!="number"?this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):S.removeFeatureState(R,a.id,h):this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},u.prototype.getFeatureState=function(a){this._checkLoaded();var h=a.source,g=a.sourceLayer,S=this.sourceCaches[h];if(S!==void 0){if(S.getSource().type!=="vector"||g)return a.id===void 0&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),S.getFeatureState(g,a.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error("The source '"+h+"' does not exist in the map's style.")))},u.prototype.getTransition=function(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},u.prototype.serialize=function(){return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:p.mapObject(this.sourceCaches,function(a){return a.serialize()}),layers:this._serializeLayers(this._order)},function(a){return a!==void 0})},u.prototype._updateLayer=function(a){this._updatedLayers[a.id]=!0,a.source&&!this._updatedSources[a.source]&&this.sourceCaches[a.source].getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause()),this._changed=!0},u.prototype._flattenAndSortRenderedFeatures=function(a){for(var h=this,g=function(tn){return h._layers[tn].type==="fill-extrusion"},S={},T=[],R=this._order.length-1;R>=0;R--){var G=this._order[R];if(g(G)){S[G]=R;for(var ee=0,ve=a;ee<ve.length;ee+=1){var ye=ve[ee][G];if(ye)for(var we=0,Ke=ye;we<Ke.length;we+=1)T.push(Ke[we])}}}T.sort(function(tn,Xr){return Xr.intersectionZ-tn.intersectionZ});for(var He=[],at=this._order.length-1;at>=0;at--){var ze=this._order[at];if(g(ze))for(var it=T.length-1;it>=0;it--){var mt=T[it].feature;if(S[mt.layer.id]<at)break;He.push(mt),T.pop()}else for(var Ut=0,sr=a;Ut<sr.length;Ut+=1){var nr=sr[Ut][ze];if(nr)for(var cr=0,Rr=nr;cr<Rr.length;cr+=1)He.push(Rr[cr].feature)}}return He},u.prototype.queryRenderedFeatures=function(a,h,g){h&&h.filter&&this._validate(p.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);var S={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var T=0,R=h.layers;T<R.length;T+=1){var G=R[T],ee=this._layers[G];if(!ee)return this.fire(new p.ErrorEvent(new Error("The layer '"+G+"' does not exist in the map's style and cannot be queried for features."))),[];S[ee.source]=!0}}var ve=[];for(var ye in h.availableImages=this._availableImages,this.sourceCaches)h.layers&&!S[ye]||ve.push(Dr(this.sourceCaches[ye],this._layers,this._serializedLayers,a,h,g));return this.placement&&ve.push(function(we,Ke,He,at,ze,it,mt){for(var Ut={},sr=it.queryRenderedSymbols(at),nr=[],cr=0,Rr=Object.keys(sr).map(Number);cr<Rr.length;cr+=1)nr.push(mt[Rr[cr]]);nr.sort(on);for(var tn=function(){var jn=yn[Xr],Qi=jn.featureIndex.lookupSymbolFeatures(sr[jn.bucketInstanceId],Ke,jn.bucketIndex,jn.sourceLayerIndex,ze.filter,ze.layers,ze.availableImages,we);for(var _n in Qi){var ci=Ut[_n]=Ut[_n]||[],Ci=Qi[_n];Ci.sort(function(Ti,ii){var ri=jn.featureSortOrder;if(ri){var Po=ri.indexOf(Ti.featureIndex);return ri.indexOf(ii.featureIndex)-Po}return ii.featureIndex-Ti.featureIndex});for(var fi=0,oi=Ci;fi<oi.length;fi+=1)ci.push(oi[fi])}},Xr=0,yn=nr;Xr<yn.length;Xr+=1)tn();var Fn=function(jn){Ut[jn].forEach(function(Qi){var _n=Qi.feature,ci=He[we[jn].source].getFeatureState(_n.layer["source-layer"],_n.id);_n.source=_n.layer.source,_n.layer["source-layer"]&&(_n.sourceLayer=_n.layer["source-layer"]),_n.state=ci})};for(var Vn in Ut)Fn(Vn);return Ut}(this._layers,this._serializedLayers,this.sourceCaches,a,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ve)},u.prototype.querySourceFeatures=function(a,h){h&&h.filter&&this._validate(p.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);var g=this.sourceCaches[a];return g?function(S,T){for(var R=S.getRenderableIds().map(function(Ke){return S.getTileByID(Ke)}),G=[],ee={},ve=0;ve<R.length;ve++){var ye=R[ve],we=ye.tileID.canonical.key;ee[we]||(ee[we]=!0,ye.querySourceFeatures(G,T))}return G}(g,h):[]},u.prototype.addSourceType=function(a,h,g){return u.getSourceType(a)?g(new Error('A source type called "'+a+'" already exists.')):(u.setSourceType(a,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:h.workerSourceURL},g):g(null,null))},u.prototype.getLight=function(){return this.light.getLight()},u.prototype.setLight=function(a,h){h===void 0&&(h={}),this._checkLoaded();var g=this.light.getLight(),S=!1;for(var T in a)if(!p.deepEqual(a[T],g[T])){S=!0;break}if(S){var R={now:p.browser.now(),transition:p.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(a,h),this.light.updateTransitions(R)}},u.prototype._validate=function(a,h,g,S,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&Ns(this,a.call(p.validateStyle,p.extend({key:h,style:this.serialize(),value:g,styleSpec:p.styleSpec},S)))},u.prototype._remove=function(){for(var a in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[a].setEventedParent(null);for(var h in this.sourceCaches)this.sourceCaches[h].clearTiles(),this.sourceCaches[h].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},u.prototype._clearSource=function(a){this.sourceCaches[a].clearTiles()},u.prototype._reloadSource=function(a){this.sourceCaches[a].resume(),this.sourceCaches[a].reload()},u.prototype._updateSources=function(a){for(var h in this.sourceCaches)this.sourceCaches[h].update(a)},u.prototype._generateCollisionBoxes=function(){for(var a in this.sourceCaches)this._reloadSource(a)},u.prototype._updatePlacement=function(a,h,g,S,T){T===void 0&&(T=!1);for(var R=!1,G=!1,ee={},ve=0,ye=this._order;ve<ye.length;ve+=1){var we=this._layers[ye[ve]];if(we.type==="symbol"){if(!ee[we.source]){var Ke=this.sourceCaches[we.source];ee[we.source]=Ke.getRenderableIds(!0).map(function(mt){return Ke.getTileByID(mt)}).sort(function(mt,Ut){return Ut.tileID.overscaledZ-mt.tileID.overscaledZ||(mt.tileID.isLessThan(Ut.tileID)?-1:1)})}var He=this.crossTileSymbolIndex.addLayer(we,ee[we.source],a.center.lng);R=R||He}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||g===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.browser.now(),a.zoom))&&(this.pauseablePlacement=new Mu(a,this._order,T,h,g,S,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ee),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.browser.now()),G=!0),R&&this.pauseablePlacement.placement.setStale()),G||R)for(var at=0,ze=this._order;at<ze.length;at+=1){var it=this._layers[ze[at]];it.type==="symbol"&&this.placement.updateLayerOpacities(it,ee[it.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.browser.now())},u.prototype._releaseSymbolFadeTiles=function(){for(var a in this.sourceCaches)this.sourceCaches[a].releaseSymbolFadeTiles()},u.prototype.getImages=function(a,h,g){this.imageManager.getImages(h.icons,g),this._updateTilesForChangedImages();var S=this.sourceCaches[h.source];S&&S.setDependencies(h.tileID.key,h.type,h.icons)},u.prototype.getGlyphs=function(a,h,g){this.glyphManager.getGlyphs(h.stacks,g)},u.prototype.getResource=function(a,h,g){return p.makeRequest(h,g)},u}(p.Evented);ti.getSourceType=function(i){return Qt[i]},ti.setSourceType=function(i,u){Qt[i]=u},ti.registerForPluginStateChange=p.registerForPluginStateChange;var ho=p.createLayout([{name:"a_pos",type:"Int16",components:2}]),su=Ui(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Ol=Ui(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),sl=Ui(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Xe=Ui(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Pt=Ui("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),_r=Ui(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Zn=Ui(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),sa=Ui("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),xa=Ui("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),ka=Ui("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),vi=Ui(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Ta=Ui(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),eo=Ui(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),qn=Ui(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),ba=Ui(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Jl=Ui(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Ra=Ui(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Ro=Ui(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),xu=Ui(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Ys=Ui(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),zs=Ui(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),rs=Ui(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Iu=Ui(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),xo=Ui(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),rf=Ui(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),ul=Ui(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Ui(i,u){var a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=u.match(/attribute ([\w]+) ([\w]+)/g),g=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=S?S.concat(g):g,R={};return{fragmentSource:i=i.replace(a,function(G,ee,ve,ye,we){return R[we]=!0,ee==="define"?`
#ifndef HAS_UNIFORM_u_`+we+`
varying `+ve+" "+ye+" "+we+`;
#else
uniform `+ve+" "+ye+" u_"+we+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+we+`
    `+ve+" "+ye+" "+we+" = u_"+we+`;
#endif
`}),vertexSource:u=u.replace(a,function(G,ee,ve,ye,we){var Ke=ye==="float"?"vec2":"vec4",He=we.match(/color/)?"color":Ke;return R[we]?ee==="define"?`
#ifndef HAS_UNIFORM_u_`+we+`
uniform lowp float u_`+we+`_t;
attribute `+ve+" "+Ke+" a_"+we+`;
varying `+ve+" "+ye+" "+we+`;
#else
uniform `+ve+" "+ye+" u_"+we+`;
#endif
`:He==="vec4"?`
#ifndef HAS_UNIFORM_u_`+we+`
    `+we+" = a_"+we+`;
#else
    `+ve+" "+ye+" "+we+" = u_"+we+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+we+`
    `+we+" = unpack_mix_"+He+"(a_"+we+", u_"+we+`_t);
#else
    `+ve+" "+ye+" "+we+" = u_"+we+`;
#endif
`:ee==="define"?`
#ifndef HAS_UNIFORM_u_`+we+`
uniform lowp float u_`+we+`_t;
attribute `+ve+" "+Ke+" a_"+we+`;
#else
uniform `+ve+" "+ye+" u_"+we+`;
#endif
`:He==="vec4"?`
#ifndef HAS_UNIFORM_u_`+we+`
    `+ve+" "+ye+" "+we+" = a_"+we+`;
#else
    `+ve+" "+ye+" "+we+" = u_"+we+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+we+`
    `+ve+" "+ye+" "+we+" = unpack_mix_"+He+"(a_"+we+", u_"+we+`_t);
#else
    `+ve+" "+ye+" "+we+" = u_"+we+`;
#endif
`}),staticAttributes:h,staticUniforms:T}}var Hf=Object.freeze({__proto__:null,prelude:su,background:Ol,backgroundPattern:sl,circle:Xe,clippingMask:Pt,heatmap:_r,heatmapTexture:Zn,collisionBox:sa,collisionCircle:xa,debug:ka,fill:vi,fillOutline:Ta,fillOutlinePattern:eo,fillPattern:qn,fillExtrusion:ba,fillExtrusionPattern:Jl,hillshadePrepare:Ra,hillshade:Ro,line:xu,lineGradient:Ys,linePattern:zs,lineSDF:rs,raster:Iu,symbolIcon:xo,symbolSDF:rf,symbolTextAndIcon:ul}),Ql=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Sf(i){for(var u=[],a=0;a<i.length;a++)if(i[a]!==null){var h=i[a].split(" ");u.push(h.pop())}return u}Ql.prototype.bind=function(i,u,a,h,g,S,T,R){this.context=i;for(var G=this.boundPaintVertexBuffers.length!==h.length,ee=0;!G&&ee<h.length;ee++)this.boundPaintVertexBuffers[ee]!==h[ee]&&(G=!0);i.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===a&&!G&&this.boundIndexBuffer===g&&this.boundVertexOffset===S&&this.boundDynamicVertexBuffer===T&&this.boundDynamicVertexBuffer2===R?(i.bindVertexArrayOES.set(this.vao),T&&T.bind(),g&&g.dynamicDraw&&g.bind(),R&&R.bind()):this.freshBind(u,a,h,g,S,T,R)},Ql.prototype.freshBind=function(i,u,a,h,g,S,T){var R,G=i.numAttributes,ee=this.context,ve=ee.gl;if(ee.extVertexArrayObject)this.vao&&this.destroy(),this.vao=ee.extVertexArrayObject.createVertexArrayOES(),ee.bindVertexArrayOES.set(this.vao),R=0,this.boundProgram=i,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=h,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=T;else{R=ee.currentNumAttributes||0;for(var ye=G;ye<R;ye++)ve.disableVertexAttribArray(ye)}u.enableAttributes(ve,i);for(var we=0,Ke=a;we<Ke.length;we+=1)Ke[we].enableAttributes(ve,i);S&&S.enableAttributes(ve,i),T&&T.enableAttributes(ve,i),u.bind(),u.setVertexAttribPointers(ve,i,g);for(var He=0,at=a;He<at.length;He+=1){var ze=at[He];ze.bind(),ze.setVertexAttribPointers(ve,i,g)}S&&(S.bind(),S.setVertexAttribPointers(ve,i,g)),h&&h.bind(),T&&(T.bind(),T.setVertexAttribPointers(ve,i,g)),ee.currentNumAttributes=G},Ql.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Ll=function(i,u,a,h,g,S){var T=i.gl;this.program=T.createProgram();for(var R=Sf(a.staticAttributes),G=h?h.getBinderAttributes():[],ee=R.concat(G),ve=a.staticUniforms?Sf(a.staticUniforms):[],ye=h?h.getBinderUniforms():[],we=[],Ke=0,He=ve.concat(ye);Ke<He.length;Ke+=1){var at=He[Ke];we.indexOf(at)<0&&we.push(at)}var ze=h?h.defines():[];S&&ze.push("#define OVERDRAW_INSPECTOR;");var it=ze.concat(su.fragmentSource,a.fragmentSource).join(`
`),mt=ze.concat(su.vertexSource,a.vertexSource).join(`
`),Ut=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(Ut,it),T.compileShader(Ut),T.attachShader(this.program,Ut);var sr=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(sr,mt),T.compileShader(sr),T.attachShader(this.program,sr),this.attributes={};var nr={};this.numAttributes=ee.length;for(var cr=0;cr<this.numAttributes;cr++)ee[cr]&&(T.bindAttribLocation(this.program,cr,ee[cr]),this.attributes[ee[cr]]=cr);T.linkProgram(this.program),T.deleteShader(sr),T.deleteShader(Ut);for(var Rr=0;Rr<we.length;Rr++){var tn=we[Rr];if(tn&&!nr[tn]){var Xr=T.getUniformLocation(this.program,tn);Xr&&(nr[tn]=Xr)}}this.fixedUniforms=g(i,nr),this.binderUniforms=h?h.getUniforms(i,nr):[]}}};function Ko(i,u,a){var h=1/Gi(a,1,u.transform.tileZoom),g=Math.pow(2,a.tileID.overscaledZ),S=a.tileSize*Math.pow(2,u.transform.tileZoom)/g,T=S*(a.tileID.canonical.x+a.tileID.wrap*g),R=S*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[h,i.fromScale,i.toScale],u_fade:i.t,u_pixel_coord_upper:[T>>16,R>>16],u_pixel_coord_lower:[65535&T,65535&R]}}Ll.prototype.draw=function(i,u,a,h,g,S,T,R,G,ee,ve,ye,we,Ke,He,at){var ze,it=i.gl;if(!this.failedToCreate){for(var mt in i.program.set(this.program),i.setDepthMode(a),i.setStencilMode(h),i.setColorMode(g),i.setCullFace(S),this.fixedUniforms)this.fixedUniforms[mt].set(T[mt]);Ke&&Ke.setUniforms(i,this.binderUniforms,ye,{zoom:we});for(var Ut=(ze={},ze[it.LINES]=2,ze[it.TRIANGLES]=3,ze[it.LINE_STRIP]=1,ze)[u],sr=0,nr=ve.get();sr<nr.length;sr+=1){var cr=nr[sr],Rr=cr.vaos||(cr.vaos={});(Rr[R]||(Rr[R]=new Ql)).bind(i,this,G,Ke?Ke.getPaintVertexBuffers():[],ee,cr.vertexOffset,He,at),it.drawElements(u,cr.primitiveLength*Ut,it.UNSIGNED_SHORT,cr.primitiveOffset*Ut*2)}}};var Aa=function(i,u,a,h){var g=u.style.light,S=g.properties.get("position"),T=[S.x,S.y,S.z],R=p.create$1();g.properties.get("anchor")==="viewport"&&p.fromRotation(R,-u.transform.angle),p.transformMat3(T,T,R);var G=g.properties.get("color");return{u_matrix:i,u_lightpos:T,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[G.r,G.g,G.b],u_vertical_gradient:+a,u_opacity:h}},to=function(i,u,a,h,g,S,T){return p.extend(Aa(i,u,a,h),Ko(S,u,T),{u_height_factor:-Math.pow(2,g.overscaledZ)/T.tileSize/8})},Ks=function(i){return{u_matrix:i}},ns=function(i,u,a,h){return p.extend(Ks(i),Ko(a,u,h))},fc=function(i,u){return{u_matrix:i,u_world:u}},Rl=function(i,u,a,h,g){return p.extend(ns(i,u,a,h),{u_world:g})},bu=function(i,u,a,h){var g,S,T=i.transform;if(h.paint.get("circle-pitch-alignment")==="map"){var R=Gi(a,1,T.zoom);g=!0,S=[R,R]}else g=!1,S=T.pixelsToGLUnits;return{u_camera_to_center_distance:T.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:i.translatePosMatrix(u.posMatrix,a,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+g,u_device_pixel_ratio:p.browser.devicePixelRatio,u_extrude_scale:S}},Su=function(i,u,a){var h=Gi(a,1,u.zoom),g=Math.pow(2,u.zoom-a.tileID.overscaledZ),S=a.tileID.overscaleFactor();return{u_matrix:i,u_camera_to_center_distance:u.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[u.pixelsToGLUnits[0]/(h*g),u.pixelsToGLUnits[1]/(h*g)],u_overscale_factor:S}},Ou=function(i,u,a){return{u_matrix:i,u_inv_matrix:u,u_camera_to_center_distance:a.cameraToCenterDistance,u_viewport_size:[a.width,a.height]}},Zs=function(i,u,a){return a===void 0&&(a=1),{u_matrix:i,u_color:u,u_overlay:0,u_overlay_scale:a}},Eu=function(i){return{u_matrix:i}},hc=function(i,u,a,h){return{u_matrix:i,u_extrude_scale:Gi(u,1,a),u_intensity:h}},Gu=function(i,u,a){var h=i.transform;return{u_matrix:nf(i,u,a),u_ratio:1/Gi(u,1,h.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},ma=function(i,u,a,h){return p.extend(Gu(i,u,a),{u_image:0,u_image_height:h})},Pc=function(i,u,a,h){var g=i.transform,S=ll(u,g);return{u_matrix:nf(i,u,a),u_texsize:u.imageAtlasTexture.size,u_ratio:1/Gi(u,1,g.zoom),u_device_pixel_ratio:p.browser.devicePixelRatio,u_image:0,u_scale:[S,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Ef=function(i,u,a,h,g){var S=i.lineAtlas,T=ll(u,i.transform),R=a.layout.get("line-cap")==="round",G=S.getDash(h.from,R),ee=S.getDash(h.to,R),ve=G.width*g.fromScale,ye=ee.width*g.toScale;return p.extend(Gu(i,u,a),{u_patternscale_a:[T/ve,-G.height/2],u_patternscale_b:[T/ye,-ee.height/2],u_sdfgamma:S.width/(256*Math.min(ve,ye)*p.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:G.y,u_tex_y_b:ee.y,u_mix:g.t})};function ll(i,u){return 1/Gi(i,1,u.tileZoom)}function nf(i,u,a){return i.translatePosMatrix(u.tileID.posMatrix,u,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}var Mc=function(i,u,a,h,g){return{u_matrix:i,u_tl_parent:u,u_scale_parent:a,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(T=g.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(S=g.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:pc(g.paint.get("raster-hue-rotate"))};var S,T};function pc(i){i*=Math.PI/180;var u=Math.sin(i),a=Math.cos(i);return[(2*a+1)/3,(-Math.sqrt(3)*u-a+1)/3,(Math.sqrt(3)*u-a+1)/3]}var ql,cl=function(i,u,a,h,g,S,T,R,G,ee){var ve=g.transform;return{u_is_size_zoom_constant:+(i==="constant"||i==="source"),u_is_size_feature_constant:+(i==="constant"||i==="camera"),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:ve.cameraToCenterDistance,u_pitch:ve.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:ve.width/ve.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:T,u_coord_matrix:R,u_is_text:+G,u_pitch_with_map:+h,u_texsize:ee,u_texture:0}},wu=function(i,u,a,h,g,S,T,R,G,ee,ve){var ye=g.transform;return p.extend(cl(i,u,a,h,g,S,T,R,G,ee),{u_gamma_scale:h?Math.cos(ye._pitch)*ye.cameraToCenterDistance:1,u_device_pixel_ratio:p.browser.devicePixelRatio,u_is_halo:+ve})},ec=function(i,u,a,h,g,S,T,R,G,ee){return p.extend(wu(i,u,a,h,g,S,T,R,!0,G,!0),{u_texsize_icon:ee,u_texture_icon:1})},fl=function(i,u,a){return{u_matrix:i,u_opacity:u,u_color:a}},uu=function(i,u,a,h,g,S){return p.extend(function(T,R,G,ee){var ve=G.imageManager.getPattern(T.from.toString()),ye=G.imageManager.getPattern(T.to.toString()),we=G.imageManager.getPixelSize(),Ke=we.width,He=we.height,at=Math.pow(2,ee.tileID.overscaledZ),ze=ee.tileSize*Math.pow(2,G.transform.tileZoom)/at,it=ze*(ee.tileID.canonical.x+ee.tileID.wrap*at),mt=ze*ee.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ve.tl,u_pattern_br_a:ve.br,u_pattern_tl_b:ye.tl,u_pattern_br_b:ye.br,u_texsize:[Ke,He],u_mix:R.t,u_pattern_size_a:ve.displaySize,u_pattern_size_b:ye.displaySize,u_scale_a:R.fromScale,u_scale_b:R.toScale,u_tile_units_to_pixels:1/Gi(ee,1,G.transform.tileZoom),u_pixel_coord_upper:[it>>16,mt>>16],u_pixel_coord_lower:[65535&it,65535&mt]}}(h,S,a,g),{u_matrix:i,u_opacity:u})},dc={fillExtrusion:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_lightpos:new p.Uniform3f(i,u.u_lightpos),u_lightintensity:new p.Uniform1f(i,u.u_lightintensity),u_lightcolor:new p.Uniform3f(i,u.u_lightcolor),u_vertical_gradient:new p.Uniform1f(i,u.u_vertical_gradient),u_opacity:new p.Uniform1f(i,u.u_opacity)}},fillExtrusionPattern:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_lightpos:new p.Uniform3f(i,u.u_lightpos),u_lightintensity:new p.Uniform1f(i,u.u_lightintensity),u_lightcolor:new p.Uniform3f(i,u.u_lightcolor),u_vertical_gradient:new p.Uniform1f(i,u.u_vertical_gradient),u_height_factor:new p.Uniform1f(i,u.u_height_factor),u_image:new p.Uniform1i(i,u.u_image),u_texsize:new p.Uniform2f(i,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(i,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(i,u.u_scale),u_fade:new p.Uniform1f(i,u.u_fade),u_opacity:new p.Uniform1f(i,u.u_opacity)}},fill:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix)}},fillPattern:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_image:new p.Uniform1i(i,u.u_image),u_texsize:new p.Uniform2f(i,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(i,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(i,u.u_scale),u_fade:new p.Uniform1f(i,u.u_fade)}},fillOutline:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_world:new p.Uniform2f(i,u.u_world)}},fillOutlinePattern:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_world:new p.Uniform2f(i,u.u_world),u_image:new p.Uniform1i(i,u.u_image),u_texsize:new p.Uniform2f(i,u.u_texsize),u_pixel_coord_upper:new p.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(i,u.u_pixel_coord_lower),u_scale:new p.Uniform3f(i,u.u_scale),u_fade:new p.Uniform1f(i,u.u_fade)}},circle:function(i,u){return{u_camera_to_center_distance:new p.Uniform1f(i,u.u_camera_to_center_distance),u_scale_with_map:new p.Uniform1i(i,u.u_scale_with_map),u_pitch_with_map:new p.Uniform1i(i,u.u_pitch_with_map),u_extrude_scale:new p.Uniform2f(i,u.u_extrude_scale),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_matrix:new p.UniformMatrix4f(i,u.u_matrix)}},collisionBox:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_camera_to_center_distance:new p.Uniform1f(i,u.u_camera_to_center_distance),u_pixels_to_tile_units:new p.Uniform1f(i,u.u_pixels_to_tile_units),u_extrude_scale:new p.Uniform2f(i,u.u_extrude_scale),u_overscale_factor:new p.Uniform1f(i,u.u_overscale_factor)}},collisionCircle:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_inv_matrix:new p.UniformMatrix4f(i,u.u_inv_matrix),u_camera_to_center_distance:new p.Uniform1f(i,u.u_camera_to_center_distance),u_viewport_size:new p.Uniform2f(i,u.u_viewport_size)}},debug:function(i,u){return{u_color:new p.UniformColor(i,u.u_color),u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_overlay:new p.Uniform1i(i,u.u_overlay),u_overlay_scale:new p.Uniform1f(i,u.u_overlay_scale)}},clippingMask:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix)}},heatmap:function(i,u){return{u_extrude_scale:new p.Uniform1f(i,u.u_extrude_scale),u_intensity:new p.Uniform1f(i,u.u_intensity),u_matrix:new p.UniformMatrix4f(i,u.u_matrix)}},heatmapTexture:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_world:new p.Uniform2f(i,u.u_world),u_image:new p.Uniform1i(i,u.u_image),u_color_ramp:new p.Uniform1i(i,u.u_color_ramp),u_opacity:new p.Uniform1f(i,u.u_opacity)}},hillshade:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_image:new p.Uniform1i(i,u.u_image),u_latrange:new p.Uniform2f(i,u.u_latrange),u_light:new p.Uniform2f(i,u.u_light),u_shadow:new p.UniformColor(i,u.u_shadow),u_highlight:new p.UniformColor(i,u.u_highlight),u_accent:new p.UniformColor(i,u.u_accent)}},hillshadePrepare:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_image:new p.Uniform1i(i,u.u_image),u_dimension:new p.Uniform2f(i,u.u_dimension),u_zoom:new p.Uniform1f(i,u.u_zoom),u_unpack:new p.Uniform4f(i,u.u_unpack)}},line:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_ratio:new p.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(i,u.u_units_to_pixels)}},lineGradient:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_ratio:new p.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(i,u.u_units_to_pixels),u_image:new p.Uniform1i(i,u.u_image),u_image_height:new p.Uniform1f(i,u.u_image_height)}},linePattern:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_texsize:new p.Uniform2f(i,u.u_texsize),u_ratio:new p.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_image:new p.Uniform1i(i,u.u_image),u_units_to_pixels:new p.Uniform2f(i,u.u_units_to_pixels),u_scale:new p.Uniform3f(i,u.u_scale),u_fade:new p.Uniform1f(i,u.u_fade)}},lineSDF:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_ratio:new p.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_units_to_pixels:new p.Uniform2f(i,u.u_units_to_pixels),u_patternscale_a:new p.Uniform2f(i,u.u_patternscale_a),u_patternscale_b:new p.Uniform2f(i,u.u_patternscale_b),u_sdfgamma:new p.Uniform1f(i,u.u_sdfgamma),u_image:new p.Uniform1i(i,u.u_image),u_tex_y_a:new p.Uniform1f(i,u.u_tex_y_a),u_tex_y_b:new p.Uniform1f(i,u.u_tex_y_b),u_mix:new p.Uniform1f(i,u.u_mix)}},raster:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_tl_parent:new p.Uniform2f(i,u.u_tl_parent),u_scale_parent:new p.Uniform1f(i,u.u_scale_parent),u_buffer_scale:new p.Uniform1f(i,u.u_buffer_scale),u_fade_t:new p.Uniform1f(i,u.u_fade_t),u_opacity:new p.Uniform1f(i,u.u_opacity),u_image0:new p.Uniform1i(i,u.u_image0),u_image1:new p.Uniform1i(i,u.u_image1),u_brightness_low:new p.Uniform1f(i,u.u_brightness_low),u_brightness_high:new p.Uniform1f(i,u.u_brightness_high),u_saturation_factor:new p.Uniform1f(i,u.u_saturation_factor),u_contrast_factor:new p.Uniform1f(i,u.u_contrast_factor),u_spin_weights:new p.Uniform3f(i,u.u_spin_weights)}},symbolIcon:function(i,u){return{u_is_size_zoom_constant:new p.Uniform1i(i,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(i,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(i,u.u_size_t),u_size:new p.Uniform1f(i,u.u_size),u_camera_to_center_distance:new p.Uniform1f(i,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(i,u.u_pitch),u_rotate_symbol:new p.Uniform1i(i,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(i,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(i,u.u_fade_change),u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(i,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(i,u.u_coord_matrix),u_is_text:new p.Uniform1i(i,u.u_is_text),u_pitch_with_map:new p.Uniform1i(i,u.u_pitch_with_map),u_texsize:new p.Uniform2f(i,u.u_texsize),u_texture:new p.Uniform1i(i,u.u_texture)}},symbolSDF:function(i,u){return{u_is_size_zoom_constant:new p.Uniform1i(i,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(i,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(i,u.u_size_t),u_size:new p.Uniform1f(i,u.u_size),u_camera_to_center_distance:new p.Uniform1f(i,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(i,u.u_pitch),u_rotate_symbol:new p.Uniform1i(i,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(i,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(i,u.u_fade_change),u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(i,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(i,u.u_coord_matrix),u_is_text:new p.Uniform1i(i,u.u_is_text),u_pitch_with_map:new p.Uniform1i(i,u.u_pitch_with_map),u_texsize:new p.Uniform2f(i,u.u_texsize),u_texture:new p.Uniform1i(i,u.u_texture),u_gamma_scale:new p.Uniform1f(i,u.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(i,u.u_is_halo)}},symbolTextAndIcon:function(i,u){return{u_is_size_zoom_constant:new p.Uniform1i(i,u.u_is_size_zoom_constant),u_is_size_feature_constant:new p.Uniform1i(i,u.u_is_size_feature_constant),u_size_t:new p.Uniform1f(i,u.u_size_t),u_size:new p.Uniform1f(i,u.u_size),u_camera_to_center_distance:new p.Uniform1f(i,u.u_camera_to_center_distance),u_pitch:new p.Uniform1f(i,u.u_pitch),u_rotate_symbol:new p.Uniform1i(i,u.u_rotate_symbol),u_aspect_ratio:new p.Uniform1f(i,u.u_aspect_ratio),u_fade_change:new p.Uniform1f(i,u.u_fade_change),u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_label_plane_matrix:new p.UniformMatrix4f(i,u.u_label_plane_matrix),u_coord_matrix:new p.UniformMatrix4f(i,u.u_coord_matrix),u_is_text:new p.Uniform1i(i,u.u_is_text),u_pitch_with_map:new p.Uniform1i(i,u.u_pitch_with_map),u_texsize:new p.Uniform2f(i,u.u_texsize),u_texsize_icon:new p.Uniform2f(i,u.u_texsize_icon),u_texture:new p.Uniform1i(i,u.u_texture),u_texture_icon:new p.Uniform1i(i,u.u_texture_icon),u_gamma_scale:new p.Uniform1f(i,u.u_gamma_scale),u_device_pixel_ratio:new p.Uniform1f(i,u.u_device_pixel_ratio),u_is_halo:new p.Uniform1i(i,u.u_is_halo)}},background:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_opacity:new p.Uniform1f(i,u.u_opacity),u_color:new p.UniformColor(i,u.u_color)}},backgroundPattern:function(i,u){return{u_matrix:new p.UniformMatrix4f(i,u.u_matrix),u_opacity:new p.Uniform1f(i,u.u_opacity),u_image:new p.Uniform1i(i,u.u_image),u_pattern_tl_a:new p.Uniform2f(i,u.u_pattern_tl_a),u_pattern_br_a:new p.Uniform2f(i,u.u_pattern_br_a),u_pattern_tl_b:new p.Uniform2f(i,u.u_pattern_tl_b),u_pattern_br_b:new p.Uniform2f(i,u.u_pattern_br_b),u_texsize:new p.Uniform2f(i,u.u_texsize),u_mix:new p.Uniform1f(i,u.u_mix),u_pattern_size_a:new p.Uniform2f(i,u.u_pattern_size_a),u_pattern_size_b:new p.Uniform2f(i,u.u_pattern_size_b),u_scale_a:new p.Uniform1f(i,u.u_scale_a),u_scale_b:new p.Uniform1f(i,u.u_scale_b),u_pixel_coord_upper:new p.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new p.Uniform2f(i,u.u_pixel_coord_lower),u_tile_units_to_pixels:new p.Uniform1f(i,u.u_tile_units_to_pixels)}}};function hl(i,u,a,h,g,S,T){for(var R=i.context,G=R.gl,ee=i.useProgram("collisionBox"),ve=[],ye=0,we=0,Ke=0;Ke<h.length;Ke++){var He=h[Ke],at=u.getTile(He),ze=at.getBucket(a);if(ze){var it=He.posMatrix;g[0]===0&&g[1]===0||(it=i.translatePosMatrix(He.posMatrix,at,g,S));var mt=T?ze.textCollisionBox:ze.iconCollisionBox,Ut=ze.collisionCircleArray;if(Ut.length>0){var sr=p.create(),nr=it;p.mul(sr,ze.placementInvProjMatrix,i.transform.glCoordMatrix),p.mul(sr,sr,ze.placementViewportMatrix),ve.push({circleArray:Ut,circleOffset:we,transform:nr,invTransform:sr}),we=ye+=Ut.length/4}mt&&ee.draw(R,G.LINES,B.disabled,re.disabled,i.colorModeForRenderPass(),Se.disabled,Su(it,i.transform,at),a.id,mt.layoutVertexBuffer,mt.indexBuffer,mt.segments,null,i.transform.zoom,null,null,mt.collisionVertexBuffer)}}if(T&&ve.length){var cr=i.useProgram("collisionCircle"),Rr=new p.StructArrayLayout2f1f2i16;Rr.resize(4*ye),Rr._trim();for(var tn=0,Xr=0,yn=ve;Xr<yn.length;Xr+=1)for(var Fn=yn[Xr],Vn=0;Vn<Fn.circleArray.length/4;Vn++){var jn=4*Vn,Qi=Fn.circleArray[jn+0],_n=Fn.circleArray[jn+1],ci=Fn.circleArray[jn+2],Ci=Fn.circleArray[jn+3];Rr.emplace(tn++,Qi,_n,ci,Ci,0),Rr.emplace(tn++,Qi,_n,ci,Ci,1),Rr.emplace(tn++,Qi,_n,ci,Ci,2),Rr.emplace(tn++,Qi,_n,ci,Ci,3)}(!ql||ql.length<2*ye)&&(ql=function(Ja){var os=2*Ja,Zo=new p.StructArrayLayout3ui6;Zo.resize(os),Zo._trim();for(var Ga=0;Ga<os;Ga++){var no=6*Ga;Zo.uint16[no+0]=4*Ga+0,Zo.uint16[no+1]=4*Ga+1,Zo.uint16[no+2]=4*Ga+2,Zo.uint16[no+3]=4*Ga+2,Zo.uint16[no+4]=4*Ga+3,Zo.uint16[no+5]=4*Ga+0}return Zo}(ye));for(var fi=R.createIndexBuffer(ql,!0),oi=R.createVertexBuffer(Rr,p.collisionCircleLayout.members,!0),Ti=0,ii=ve;Ti<ii.length;Ti+=1){var ri=ii[Ti],Po=Ou(ri.transform,ri.invTransform,i.transform);cr.draw(R,G.TRIANGLES,B.disabled,re.disabled,i.colorModeForRenderPass(),Se.disabled,Po,a.id,oi,fi,p.SegmentVector.simpleSegment(0,2*ri.circleOffset,ri.circleArray.length,ri.circleArray.length/2),null,i.transform.zoom,null,null,null)}oi.destroy(),fi.destroy()}}var $s=p.identity(new Float32Array(16));function Ic(i,u,a,h,g,S){var T=p.getAnchorAlignment(i),R=-(T.horizontalAlign-.5)*u,G=-(T.verticalAlign-.5)*a,ee=p.evaluateVariableOffset(i,h);return new p.Point((R/g+ee[0])*S,(G/g+ee[1])*S)}function Oc(i,u,a,h,g,S,T,R,G,ee,ve){var ye=i.text.placedSymbolArray,we=i.text.dynamicLayoutVertexArray,Ke=i.icon.dynamicLayoutVertexArray,He={};we.clear();for(var at=0;at<ye.length;at++){var ze=ye.get(at),it=ze.hidden||!ze.crossTileID||i.allowVerticalPlacement&&!ze.placedOrientation?null:h[ze.crossTileID];if(it){var mt=new p.Point(ze.anchorX,ze.anchorY),Ut=Qn(mt,a?R:T),sr=Fi(S.cameraToCenterDistance,Ut.signedDistanceFromCamera),nr=g.evaluateSizeForFeature(i.textSizeData,ee,ze)*sr/p.ONE_EM;a&&(nr*=i.tilePixelRatio/G);for(var cr=Ic(it.anchor,it.width,it.height,it.textOffset,it.textBoxScale,nr),Rr=a?Qn(mt.add(cr),T).point:Ut.point.add(u?cr.rotate(-S.angle):cr),tn=i.allowVerticalPlacement&&ze.placedOrientation===p.WritingMode.vertical?Math.PI/2:0,Xr=0;Xr<ze.numGlyphs;Xr++)p.addDynamicAttributes(we,Rr,tn);ve&&ze.associatedIconIndex>=0&&(He[ze.associatedIconIndex]={shiftedAnchor:Rr,angle:tn})}else Ka(ze.numGlyphs,we)}if(ve){Ke.clear();for(var yn=i.icon.placedSymbolArray,Fn=0;Fn<yn.length;Fn++){var Vn=yn.get(Fn);if(Vn.hidden)Ka(Vn.numGlyphs,Ke);else{var jn=He[Fn];if(jn)for(var Qi=0;Qi<Vn.numGlyphs;Qi++)p.addDynamicAttributes(Ke,jn.shiftedAnchor,jn.angle);else Ka(Vn.numGlyphs,Ke)}}i.icon.dynamicLayoutVertexBuffer.updateData(Ke)}i.text.dynamicLayoutVertexBuffer.updateData(we)}function Lc(i,u,a){return a.iconsInText&&u?"symbolTextAndIcon":i?"symbolSDF":"symbolIcon"}function Hu(i,u,a,h,g,S,T,R,G,ee,ve,ye){for(var we=i.context,Ke=we.gl,He=i.transform,at=R==="map",ze=G==="map",it=at&&a.layout.get("symbol-placement")!=="point",mt=at&&!ze&&!it,Ut=a.layout.get("symbol-sort-key").constantOr(1)!==void 0,sr=!1,nr=i.depthModeForSublayer(0,B.ReadOnly),cr=a.layout.get("text-variable-anchor"),Rr=[],tn=0,Xr=h;tn<Xr.length;tn+=1){var yn=Xr[tn],Fn=u.getTile(yn),Vn=Fn.getBucket(a);if(Vn){var jn=g?Vn.text:Vn.icon;if(jn&&jn.segments.get().length){var Qi=jn.programConfigurations.get(a.id),_n=g||Vn.sdfIcons,ci=g?Vn.textSizeData:Vn.iconSizeData,Ci=ze||He.pitch!==0,fi=i.useProgram(Lc(_n,g,Vn),Qi),oi=p.evaluateSizeForZoom(ci,He.zoom),Ti=void 0,ii=[0,0],ri=void 0,Po=void 0,Ja=null,os=void 0;if(g)ri=Fn.glyphAtlasTexture,Po=Ke.LINEAR,Ti=Fn.glyphAtlasTexture.size,Vn.iconsInText&&(ii=Fn.imageAtlasTexture.size,Ja=Fn.imageAtlasTexture,os=Ci||i.options.rotating||i.options.zooming||ci.kind==="composite"||ci.kind==="camera"?Ke.LINEAR:Ke.NEAREST);else{var Zo=a.layout.get("icon-size").constantOr(0)!==1||Vn.iconsNeedLinear;ri=Fn.imageAtlasTexture,Po=_n||i.options.rotating||i.options.zooming||Zo||Ci?Ke.LINEAR:Ke.NEAREST,Ti=Fn.imageAtlasTexture.size}var Ga=Gi(Fn,1,i.transform.zoom),no=ai(yn.posMatrix,ze,at,i.transform,Ga),ds=Ai(yn.posMatrix,ze,at,i.transform,Ga),vs=cr&&Vn.hasTextData(),el=a.layout.get("icon-text-fit")!=="none"&&vs&&Vn.hasIconData();it&&Xa(Vn,yn.posMatrix,i,g,no,ds,ze,ee);var ms=i.translatePosMatrix(yn.posMatrix,Fn,S,T),eu=it||g&&cr||el?$s:no,Ls=i.translatePosMatrix(ds,Fn,S,T,!0),xl=_n&&a.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0,bl={program:fi,buffers:jn,uniformValues:_n?Vn.iconsInText?ec(ci.kind,oi,mt,ze,i,ms,eu,Ls,Ti,ii):wu(ci.kind,oi,mt,ze,i,ms,eu,Ls,g,Ti,!0):cl(ci.kind,oi,mt,ze,i,ms,eu,Ls,g,Ti),atlasTexture:ri,atlasTextureIcon:Ja,atlasInterpolation:Po,atlasInterpolationIcon:os,isSDF:_n,hasHalo:xl};if(Ut&&Vn.canOverlap){sr=!0;for(var Nu=0,tu=jn.segments.get();Nu<tu.length;Nu+=1){var Vl=tu[Nu];Rr.push({segments:new p.SegmentVector([Vl]),sortKey:Vl.sortKey,state:bl})}}else Rr.push({segments:jn.segments,sortKey:0,state:bl})}}}sr&&Rr.sort(function(du,gs){return du.sortKey-gs.sortKey});for(var Tu=0,zu=Rr;Tu<zu.length;Tu+=1){var Hs=zu[Tu],io=Hs.state;if(we.activeTexture.set(Ke.TEXTURE0),io.atlasTexture.bind(io.atlasInterpolation,Ke.CLAMP_TO_EDGE),io.atlasTextureIcon&&(we.activeTexture.set(Ke.TEXTURE1),io.atlasTextureIcon&&io.atlasTextureIcon.bind(io.atlasInterpolationIcon,Ke.CLAMP_TO_EDGE)),io.isSDF){var Au=io.uniformValues;io.hasHalo&&(Au.u_is_halo=1,Dl(io.buffers,Hs.segments,a,i,io.program,nr,ve,ye,Au)),Au.u_is_halo=0}Dl(io.buffers,Hs.segments,a,i,io.program,nr,ve,ye,io.uniformValues)}}function Dl(i,u,a,h,g,S,T,R,G){var ee=h.context;g.draw(ee,ee.gl.TRIANGLES,S,T,R,Se.disabled,G,a.id,i.layoutVertexBuffer,i.indexBuffer,u,a.paint,h.transform.zoom,i.programConfigurations.get(a.id),i.dynamicLayoutVertexBuffer,i.opacityVertexBuffer)}function tc(i,u,a,h,g,S,T){var R,G,ee,ve,ye,we=i.context.gl,Ke=a.paint.get("fill-pattern"),He=Ke&&Ke.constantOr(1),at=a.getCrossfadeParameters();T?(G=He&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=we.LINES):(G=He?"fillPattern":"fill",R=we.TRIANGLES);for(var ze=0,it=h;ze<it.length;ze+=1){var mt=it[ze],Ut=u.getTile(mt);if(!He||Ut.patternsLoaded()){var sr=Ut.getBucket(a);if(sr){var nr=sr.programConfigurations.get(a.id),cr=i.useProgram(G,nr);He&&(i.context.activeTexture.set(we.TEXTURE0),Ut.imageAtlasTexture.bind(we.LINEAR,we.CLAMP_TO_EDGE),nr.updatePaintBuffers(at));var Rr=Ke.constantOr(null);if(Rr&&Ut.imageAtlas){var tn=Ut.imageAtlas,Xr=tn.patternPositions[Rr.to.toString()],yn=tn.patternPositions[Rr.from.toString()];Xr&&yn&&nr.setConstantPatternPositions(Xr,yn)}var Fn=i.translatePosMatrix(mt.posMatrix,Ut,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(T){ve=sr.indexBuffer2,ye=sr.segments2;var Vn=[we.drawingBufferWidth,we.drawingBufferHeight];ee=G==="fillOutlinePattern"&&He?Rl(Fn,i,at,Ut,Vn):fc(Fn,Vn)}else ve=sr.indexBuffer,ye=sr.segments,ee=He?ns(Fn,i,at,Ut):Ks(Fn);cr.draw(i.context,R,g,i.stencilModeForClipping(mt),S,Se.disabled,ee,a.id,sr.layoutVertexBuffer,ve,ye,a.paint,i.transform.zoom,nr)}}}}function Wu(i,u,a,h,g,S,T){for(var R=i.context,G=R.gl,ee=a.paint.get("fill-extrusion-pattern"),ve=ee.constantOr(1),ye=a.getCrossfadeParameters(),we=a.paint.get("fill-extrusion-opacity"),Ke=0,He=h;Ke<He.length;Ke+=1){var at=He[Ke],ze=u.getTile(at),it=ze.getBucket(a);if(it){var mt=it.programConfigurations.get(a.id),Ut=i.useProgram(ve?"fillExtrusionPattern":"fillExtrusion",mt);ve&&(i.context.activeTexture.set(G.TEXTURE0),ze.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),mt.updatePaintBuffers(ye));var sr=ee.constantOr(null);if(sr&&ze.imageAtlas){var nr=ze.imageAtlas,cr=nr.patternPositions[sr.to.toString()],Rr=nr.patternPositions[sr.from.toString()];cr&&Rr&&mt.setConstantPatternPositions(cr,Rr)}var tn=i.translatePosMatrix(at.posMatrix,ze,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Xr=a.paint.get("fill-extrusion-vertical-gradient"),yn=ve?to(tn,i,Xr,we,at,ye,ze):Aa(tn,i,Xr,we);Ut.draw(R,R.gl.TRIANGLES,g,S,T,Se.backCCW,yn,a.id,it.layoutVertexBuffer,it.indexBuffer,it.segments,a.paint,i.transform.zoom,mt)}}}function kl(i,u,a,h,g,S){var T=i.context,R=T.gl,G=u.fbo;if(G){var ee=i.useProgram("hillshade");T.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,G.colorAttachment.get());var ve=function(ye,we,Ke){var He=Ke.paint.get("hillshade-shadow-color"),at=Ke.paint.get("hillshade-highlight-color"),ze=Ke.paint.get("hillshade-accent-color"),it=Ke.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ke.paint.get("hillshade-illumination-anchor")==="viewport"&&(it-=ye.transform.angle);var mt,Ut,sr,nr=!ye.options.moving;return{u_matrix:ye.transform.calculatePosMatrix(we.tileID.toUnwrapped(),nr),u_image:0,u_latrange:(mt=we.tileID,Ut=Math.pow(2,mt.canonical.z),sr=mt.canonical.y,[new p.MercatorCoordinate(0,sr/Ut).toLngLat().lat,new p.MercatorCoordinate(0,(sr+1)/Ut).toLngLat().lat]),u_light:[Ke.paint.get("hillshade-exaggeration"),it],u_shadow:He,u_highlight:at,u_accent:ze}}(i,u,a);ee.draw(T,R.TRIANGLES,h,g,S,Se.disabled,ve,a.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments)}}function Rc(i,u,a,h,g,S){var T=i.context,R=T.gl,G=u.dem;if(G&&G.data){var ee=G.dim,ve=G.stride,ye=G.getPixels();if(T.activeTexture.set(R.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),u.demTexture=u.demTexture||i.getTileTexture(ve),u.demTexture){var we=u.demTexture;we.update(ye,{premultiply:!1}),we.bind(R.NEAREST,R.CLAMP_TO_EDGE)}else u.demTexture=new p.Texture(T,ye,R.RGBA,{premultiply:!1}),u.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE);T.activeTexture.set(R.TEXTURE0);var Ke=u.fbo;if(!Ke){var He=new p.Texture(T,{width:ee,height:ee,data:null},R.RGBA);He.bind(R.LINEAR,R.CLAMP_TO_EDGE),(Ke=u.fbo=T.createFramebuffer(ee,ee,!0)).colorAttachment.set(He.texture)}T.bindFramebuffer.set(Ke.framebuffer),T.viewport.set([0,0,ee,ee]),i.useProgram("hillshadePrepare").draw(T,R.TRIANGLES,h,g,S,Se.disabled,function(at,ze){var it=ze.stride,mt=p.create();return p.ortho(mt,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(mt,mt,[0,-p.EXTENT,0]),{u_matrix:mt,u_image:1,u_dimension:[it,it],u_zoom:at.overscaledZ,u_unpack:ze.getUnpackVector()}}(u.tileID,G),a.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments),u.needsHillshadePrepare=!1}}function Xu(i,u,a,h,g){var S=h.paint.get("raster-fade-duration");if(S>0){var T=p.browser.now(),R=(T-i.timeAdded)/S,G=u?(T-u.timeAdded)/S:-1,ee=a.getSource(),ve=g.coveringZoomLevel({tileSize:ee.tileSize,roundZoom:ee.roundZoom}),ye=!u||Math.abs(u.tileID.overscaledZ-ve)>Math.abs(i.tileID.overscaledZ-ve),we=ye&&i.refreshedUponExpiration?1:p.clamp(ye?R:1-G,0,1);return i.refreshedUponExpiration&&R>=1&&(i.refreshedUponExpiration=!1),u?{opacity:1,mix:1-we}:{opacity:we,mix:0}}return{opacity:1,mix:0}}var No=new p.Color(1,0,0,1),af=new p.Color(0,1,0,1),of=new p.Color(0,0,1,1),Fl=new p.Color(1,0,1,1),Dc=new p.Color(0,1,1,1);function Fa(i,u,a,h){Yu(i,0,u+a/2,i.transform.width,a,h)}function kc(i,u,a,h){Yu(i,u-a/2,0,a,i.transform.height,h)}function Yu(i,u,a,h,g,S){var T=i.context,R=T.gl;R.enable(R.SCISSOR_TEST),R.scissor(u*p.browser.devicePixelRatio,a*p.browser.devicePixelRatio,h*p.browser.devicePixelRatio,g*p.browser.devicePixelRatio),T.clear({color:S}),R.disable(R.SCISSOR_TEST)}function Fc(i,u,a){var h=i.context,g=h.gl,S=a.posMatrix,T=i.useProgram("debug"),R=B.disabled,G=re.disabled,ee=i.colorModeForRenderPass();h.activeTexture.set(g.TEXTURE0),i.emptyTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),T.draw(h,g.LINE_STRIP,R,G,ee,Se.disabled,Zs(S,p.Color.red),"$debug",i.debugBuffer,i.tileBorderIndexBuffer,i.debugSegments);var ve=u.getTileByID(a.key).latestRawTileData,ye=Math.floor((ve&&ve.byteLength||0)/1024),we=u.getTile(a).tileSize,Ke=512/Math.min(we,512)*(a.overscaledZ/i.transform.zoom)*.5,He=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(He+=" => "+a.overscaledZ),function(at,ze){at.initDebugOverlayCanvas();var it=at.debugOverlayCanvas,mt=at.context.gl,Ut=at.debugOverlayCanvas.getContext("2d");Ut.clearRect(0,0,it.width,it.height),Ut.shadowColor="white",Ut.shadowBlur=2,Ut.lineWidth=1.5,Ut.strokeStyle="white",Ut.textBaseline="top",Ut.font="bold 36px Open Sans, sans-serif",Ut.fillText(ze,5,5),Ut.strokeText(ze,5,5),at.debugOverlayTexture.update(it),at.debugOverlayTexture.bind(mt.LINEAR,mt.CLAMP_TO_EDGE)}(i,He+" "+ye+"kb"),T.draw(h,g.TRIANGLES,R,G,fe.alphaBlended,Se.disabled,Zs(S,p.Color.transparent,Ke),"$debug",i.debugBuffer,i.quadTriangleIndexBuffer,i.debugSegments)}var Cu={symbol:function(i,u,a,h,g){if(i.renderPass==="translucent"){var S=re.disabled,T=i.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(R,G,ee,ve,ye,we,Ke){for(var He=G.transform,at=ye==="map",ze=we==="map",it=0,mt=R;it<mt.length;it+=1){var Ut=mt[it],sr=ve.getTile(Ut),nr=sr.getBucket(ee);if(nr&&nr.text&&nr.text.segments.get().length){var cr=p.evaluateSizeForZoom(nr.textSizeData,He.zoom),Rr=Gi(sr,1,G.transform.zoom),tn=ai(Ut.posMatrix,ze,at,G.transform,Rr),Xr=ee.layout.get("icon-text-fit")!=="none"&&nr.hasIconData();if(cr){var yn=Math.pow(2,He.zoom-sr.tileID.overscaledZ);Oc(nr,at,ze,Ke,p.symbolSize,He,tn,Ut.posMatrix,yn,cr,Xr)}}}}(h,i,a,u,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),g),a.paint.get("icon-opacity").constantOr(1)!==0&&Hu(i,u,a,h,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),S,T),a.paint.get("text-opacity").constantOr(1)!==0&&Hu(i,u,a,h,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),S,T),u.map.showCollisionBoxes&&(hl(i,u,a,h,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),hl(i,u,a,h,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))}},circle:function(i,u,a,h){if(i.renderPass==="translucent"){var g=a.paint.get("circle-opacity"),S=a.paint.get("circle-stroke-width"),T=a.paint.get("circle-stroke-opacity"),R=a.layout.get("circle-sort-key").constantOr(1)!==void 0;if(g.constantOr(1)!==0||S.constantOr(1)!==0&&T.constantOr(1)!==0){for(var G=i.context,ee=G.gl,ve=i.depthModeForSublayer(0,B.ReadOnly),ye=re.disabled,we=i.colorModeForRenderPass(),Ke=[],He=0;He<h.length;He++){var at=h[He],ze=u.getTile(at),it=ze.getBucket(a);if(it){var mt=it.programConfigurations.get(a.id),Ut={programConfiguration:mt,program:i.useProgram("circle",mt),layoutVertexBuffer:it.layoutVertexBuffer,indexBuffer:it.indexBuffer,uniformValues:bu(i,at,ze,a)};if(R)for(var sr=0,nr=it.segments.get();sr<nr.length;sr+=1){var cr=nr[sr];Ke.push({segments:new p.SegmentVector([cr]),sortKey:cr.sortKey,state:Ut})}else Ke.push({segments:it.segments,sortKey:0,state:Ut})}}R&&Ke.sort(function(Fn,Vn){return Fn.sortKey-Vn.sortKey});for(var Rr=0,tn=Ke;Rr<tn.length;Rr+=1){var Xr=tn[Rr],yn=Xr.state;yn.program.draw(G,ee.TRIANGLES,ve,ye,we,Se.disabled,yn.uniformValues,a.id,yn.layoutVertexBuffer,yn.indexBuffer,Xr.segments,a.paint,i.transform.zoom,yn.programConfiguration)}}}},heatmap:function(i,u,a,h){if(a.paint.get("heatmap-opacity")!==0)if(i.renderPass==="offscreen"){var g=i.context,S=g.gl,T=re.disabled,R=new fe([S.ONE,S.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(Ke,He,at){var ze=Ke.gl;Ke.activeTexture.set(ze.TEXTURE1),Ke.viewport.set([0,0,He.width/4,He.height/4]);var it=at.heatmapFbo;if(it)ze.bindTexture(ze.TEXTURE_2D,it.colorAttachment.get()),Ke.bindFramebuffer.set(it.framebuffer);else{var mt=ze.createTexture();ze.bindTexture(ze.TEXTURE_2D,mt),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_WRAP_S,ze.CLAMP_TO_EDGE),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_WRAP_T,ze.CLAMP_TO_EDGE),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_MIN_FILTER,ze.LINEAR),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_MAG_FILTER,ze.LINEAR),it=at.heatmapFbo=Ke.createFramebuffer(He.width/4,He.height/4,!1),function(Ut,sr,nr,cr){var Rr=Ut.gl;Rr.texImage2D(Rr.TEXTURE_2D,0,Rr.RGBA,sr.width/4,sr.height/4,0,Rr.RGBA,Ut.extRenderToTextureHalfFloat?Ut.extTextureHalfFloat.HALF_FLOAT_OES:Rr.UNSIGNED_BYTE,null),cr.colorAttachment.set(nr)}(Ke,He,mt,it)}})(g,i,a),g.clear({color:p.Color.transparent});for(var G=0;G<h.length;G++){var ee=h[G];if(!u.hasRenderableParent(ee)){var ve=u.getTile(ee),ye=ve.getBucket(a);if(ye){var we=ye.programConfigurations.get(a.id);i.useProgram("heatmap",we).draw(g,S.TRIANGLES,B.disabled,T,R,Se.disabled,hc(ee.posMatrix,ve,i.transform.zoom,a.paint.get("heatmap-intensity")),a.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,a.paint,i.transform.zoom,we)}}}g.viewport.set([0,0,i.width,i.height])}else i.renderPass==="translucent"&&(i.context.setColorMode(i.colorModeForRenderPass()),function(Ke,He){var at=Ke.context,ze=at.gl,it=He.heatmapFbo;if(it){at.activeTexture.set(ze.TEXTURE0),ze.bindTexture(ze.TEXTURE_2D,it.colorAttachment.get()),at.activeTexture.set(ze.TEXTURE1);var mt=He.colorRampTexture;mt||(mt=He.colorRampTexture=new p.Texture(at,He.colorRamp,ze.RGBA)),mt.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),Ke.useProgram("heatmapTexture").draw(at,ze.TRIANGLES,B.disabled,re.disabled,Ke.colorModeForRenderPass(),Se.disabled,function(Ut,sr,nr,cr){var Rr=p.create();p.ortho(Rr,0,Ut.width,Ut.height,0,0,1);var tn=Ut.context.gl;return{u_matrix:Rr,u_world:[tn.drawingBufferWidth,tn.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:sr.paint.get("heatmap-opacity")}}(Ke,He),He.id,Ke.viewportBuffer,Ke.quadTriangleIndexBuffer,Ke.viewportSegments,He.paint,Ke.transform.zoom)}}(i,a))},line:function(i,u,a,h){if(i.renderPass==="translucent"){var g=a.paint.get("line-opacity"),S=a.paint.get("line-width");if(g.constantOr(1)!==0&&S.constantOr(1)!==0)for(var T=i.depthModeForSublayer(0,B.ReadOnly),R=i.colorModeForRenderPass(),G=a.paint.get("line-dasharray"),ee=a.paint.get("line-pattern"),ve=ee.constantOr(1),ye=a.paint.get("line-gradient"),we=a.getCrossfadeParameters(),Ke=ve?"linePattern":G?"lineSDF":ye?"lineGradient":"line",He=i.context,at=He.gl,ze=!0,it=0,mt=h;it<mt.length;it+=1){var Ut=mt[it],sr=u.getTile(Ut);if(!ve||sr.patternsLoaded()){var nr=sr.getBucket(a);if(nr){var cr=nr.programConfigurations.get(a.id),Rr=i.context.program.get(),tn=i.useProgram(Ke,cr),Xr=ze||tn.program!==Rr,yn=ee.constantOr(null);if(yn&&sr.imageAtlas){var Fn=sr.imageAtlas,Vn=Fn.patternPositions[yn.to.toString()],jn=Fn.patternPositions[yn.from.toString()];Vn&&jn&&cr.setConstantPatternPositions(Vn,jn)}var Qi=ve?Pc(i,sr,a,we):G?Ef(i,sr,a,G,we):ye?ma(i,sr,a,nr.lineClipsArray.length):Gu(i,sr,a);if(ve)He.activeTexture.set(at.TEXTURE0),sr.imageAtlasTexture.bind(at.LINEAR,at.CLAMP_TO_EDGE),cr.updatePaintBuffers(we);else if(G&&(Xr||i.lineAtlas.dirty))He.activeTexture.set(at.TEXTURE0),i.lineAtlas.bind(He);else if(ye){var _n=nr.gradients[a.id],ci=_n.texture;if(a.gradientVersion!==_n.version){var Ci=256;if(a.stepInterpolant){var fi=u.getSource().maxzoom,oi=Ut.canonical.z===fi?Math.ceil(1<<i.transform.maxZoom-Ut.canonical.z):1;Ci=p.clamp(p.nextPowerOfTwo(nr.maxLineLength/p.EXTENT*1024*oi),256,He.maxTextureSize)}_n.gradient=p.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:Ci,image:_n.gradient||void 0,clips:nr.lineClipsArray}),_n.texture?_n.texture.update(_n.gradient):_n.texture=new p.Texture(He,_n.gradient,at.RGBA),_n.version=a.gradientVersion,ci=_n.texture}He.activeTexture.set(at.TEXTURE0),ci.bind(a.stepInterpolant?at.NEAREST:at.LINEAR,at.CLAMP_TO_EDGE)}tn.draw(He,at.TRIANGLES,T,i.stencilModeForClipping(Ut),R,Se.disabled,Qi,a.id,nr.layoutVertexBuffer,nr.indexBuffer,nr.segments,a.paint,i.transform.zoom,cr,nr.layoutVertexBuffer2),ze=!1}}}}},fill:function(i,u,a,h){var g=a.paint.get("fill-color"),S=a.paint.get("fill-opacity");if(S.constantOr(1)!==0){var T=i.colorModeForRenderPass(),R=a.paint.get("fill-pattern"),G=i.opaquePassEnabledForLayer()&&!R.constantOr(1)&&g.constantOr(p.Color.transparent).a===1&&S.constantOr(0)===1?"opaque":"translucent";if(i.renderPass===G){var ee=i.depthModeForSublayer(1,i.renderPass==="opaque"?B.ReadWrite:B.ReadOnly);tc(i,u,a,h,ee,T,!1)}if(i.renderPass==="translucent"&&a.paint.get("fill-antialias")){var ve=i.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,B.ReadOnly);tc(i,u,a,h,ve,T,!0)}}},"fill-extrusion":function(i,u,a,h){var g=a.paint.get("fill-extrusion-opacity");if(g!==0&&i.renderPass==="translucent"){var S=new B(i.context.gl.LEQUAL,B.ReadWrite,i.depthRangeFor3D);if(g!==1||a.paint.get("fill-extrusion-pattern").constantOr(1))Wu(i,u,a,h,S,re.disabled,fe.disabled),Wu(i,u,a,h,S,i.stencilModeFor3D(),i.colorModeForRenderPass());else{var T=i.colorModeForRenderPass();Wu(i,u,a,h,S,re.disabled,T)}}},hillshade:function(i,u,a,h){if(i.renderPass==="offscreen"||i.renderPass==="translucent"){for(var g=i.context,S=i.depthModeForSublayer(0,B.ReadOnly),T=i.colorModeForRenderPass(),R=i.renderPass==="translucent"?i.stencilConfigForOverlap(h):[{},h],G=R[0],ee=0,ve=R[1];ee<ve.length;ee+=1){var ye=ve[ee],we=u.getTile(ye);we.needsHillshadePrepare&&i.renderPass==="offscreen"?Rc(i,we,a,S,re.disabled,T):i.renderPass==="translucent"&&kl(i,we,a,S,G[ye.overscaledZ],T)}g.viewport.set([0,0,i.width,i.height])}},raster:function(i,u,a,h){if(i.renderPass==="translucent"&&a.paint.get("raster-opacity")!==0&&h.length)for(var g=i.context,S=g.gl,T=u.getSource(),R=i.useProgram("raster"),G=i.colorModeForRenderPass(),ee=T instanceof Me?[{},h]:i.stencilConfigForOverlap(h),ve=ee[0],ye=ee[1],we=ye[ye.length-1].overscaledZ,Ke=!i.options.moving,He=0,at=ye;He<at.length;He+=1){var ze=at[He],it=i.depthModeForSublayer(ze.overscaledZ-we,a.paint.get("raster-opacity")===1?B.ReadWrite:B.ReadOnly,S.LESS),mt=u.getTile(ze),Ut=i.transform.calculatePosMatrix(ze.toUnwrapped(),Ke);mt.registerFadeDuration(a.paint.get("raster-fade-duration"));var sr=u.findLoadedParent(ze,0),nr=Xu(mt,sr,u,a,i.transform),cr=void 0,Rr=void 0,tn=a.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;g.activeTexture.set(S.TEXTURE0),mt.texture.bind(tn,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),g.activeTexture.set(S.TEXTURE1),sr?(sr.texture.bind(tn,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),cr=Math.pow(2,sr.tileID.overscaledZ-mt.tileID.overscaledZ),Rr=[mt.tileID.canonical.x*cr%1,mt.tileID.canonical.y*cr%1]):mt.texture.bind(tn,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST);var Xr=Mc(Ut,Rr||[0,0],cr||1,nr,a);T instanceof Me?R.draw(g,S.TRIANGLES,it,re.disabled,G,Se.disabled,Xr,a.id,T.boundsBuffer,i.quadTriangleIndexBuffer,T.boundsSegments):R.draw(g,S.TRIANGLES,it,ve[ze.overscaledZ],G,Se.disabled,Xr,a.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments)}},background:function(i,u,a){var h=a.paint.get("background-color"),g=a.paint.get("background-opacity");if(g!==0){var S=i.context,T=S.gl,R=i.transform,G=R.tileSize,ee=a.paint.get("background-pattern");if(!i.isPatternMissing(ee)){var ve=!ee&&h.a===1&&g===1&&i.opaquePassEnabledForLayer()?"opaque":"translucent";if(i.renderPass===ve){var ye=re.disabled,we=i.depthModeForSublayer(0,ve==="opaque"?B.ReadWrite:B.ReadOnly),Ke=i.colorModeForRenderPass(),He=i.useProgram(ee?"backgroundPattern":"background"),at=R.coveringTiles({tileSize:G});ee&&(S.activeTexture.set(T.TEXTURE0),i.imageManager.bind(i.context));for(var ze=a.getCrossfadeParameters(),it=0,mt=at;it<mt.length;it+=1){var Ut=mt[it],sr=i.transform.calculatePosMatrix(Ut.toUnwrapped()),nr=ee?uu(sr,g,i,ee,{tileID:Ut,tileSize:G},ze):fl(sr,g,h);He.draw(S,T.TRIANGLES,we,ye,Ke,Se.disabled,nr,a.id,i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}}}},debug:function(i,u,a){for(var h=0;h<a.length;h++)Fc(i,u,a[h])},custom:function(i,u,a){var h=i.context,g=a.implementation;if(i.renderPass==="offscreen"){var S=g.prerender;S&&(i.setCustomLayerDefaults(),h.setColorMode(i.colorModeForRenderPass()),S.call(g,h.gl,i.transform.customLayerMatrix()),h.setDirty(),i.setBaseState())}else if(i.renderPass==="translucent"){i.setCustomLayerDefaults(),h.setColorMode(i.colorModeForRenderPass()),h.setStencilMode(re.disabled);var T=g.renderingMode==="3d"?new B(i.context.gl.LEQUAL,B.ReadWrite,i.depthRangeFor3D):i.depthModeForSublayer(0,B.ReadOnly);h.setDepthMode(T),g.render(h.gl,i.transform.customLayerMatrix()),h.setDirty(),i.setBaseState(),h.bindFramebuffer.set(null)}}},Pa=function(i,u){this.context=new te(i),this.transform=u,this._tileTextures={},this.setup(),this.numSublayers=ge.maxUnderzooming+ge.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ua,this.gpuTimers={}};Pa.prototype.resize=function(i,u){if(this.width=i*p.browser.devicePixelRatio,this.height=u*p.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var a=0,h=this.style._order;a<h.length;a+=1)this.style._layers[h[a]].resize()},Pa.prototype.setup=function(){var i=this.context,u=new p.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(p.EXTENT,0),u.emplaceBack(0,p.EXTENT),u.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(u,ho.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);var a=new p.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(p.EXTENT,0),a.emplaceBack(0,p.EXTENT),a.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=i.createVertexBuffer(a,ho.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);var h=new p.StructArrayLayout4i8;h.emplaceBack(0,0,0,0),h.emplaceBack(p.EXTENT,0,p.EXTENT,0),h.emplaceBack(0,p.EXTENT,0,p.EXTENT),h.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.rasterBoundsBuffer=i.createVertexBuffer(h,me.members),this.rasterBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);var g=new p.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(g,ho.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);var S=new p.StructArrayLayout1ui2;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(S);var T=new p.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(T),this.emptyTexture=new p.Texture(i,{width:1,height:1,data:new Uint8Array([0,0,0,0])},i.gl.RGBA);var R=this.context.gl;this.stencilClearMode=new re({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO)},Pa.prototype.clearStencil=function(){var i=this.context,u=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var a=p.create();p.ortho(a,0,this.width,this.height,0,0,1),p.scale(a,a,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(i,u.TRIANGLES,B.disabled,this.stencilClearMode,fe.disabled,Se.disabled,Eu(a),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Pa.prototype._renderTileClippingMasks=function(i,u){if(this.currentStencilSource!==i.source&&i.isTileClipped()&&u&&u.length){this.currentStencilSource=i.source;var a=this.context,h=a.gl;this.nextStencilID+u.length>256&&this.clearStencil(),a.setColorMode(fe.disabled),a.setDepthMode(B.disabled);var g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var S=0,T=u;S<T.length;S+=1){var R=T[S],G=this._tileClippingMaskIDs[R.key]=this.nextStencilID++;g.draw(a,h.TRIANGLES,B.disabled,new re({func:h.ALWAYS,mask:0},G,255,h.KEEP,h.KEEP,h.REPLACE),fe.disabled,Se.disabled,Eu(R.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Pa.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var i=this.nextStencilID++,u=this.context.gl;return new re({func:u.NOTEQUAL,mask:255},i,255,u.KEEP,u.KEEP,u.REPLACE)},Pa.prototype.stencilModeForClipping=function(i){var u=this.context.gl;return new re({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,u.KEEP,u.KEEP,u.REPLACE)},Pa.prototype.stencilConfigForOverlap=function(i){var u,a=this.context.gl,h=i.sort(function(G,ee){return ee.overscaledZ-G.overscaledZ}),g=h[h.length-1].overscaledZ,S=h[0].overscaledZ-g+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();for(var T={},R=0;R<S;R++)T[R+g]=new re({func:a.GEQUAL,mask:255},R+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=S,[T,h]}return[(u={},u[g]=re.disabled,u),h]},Pa.prototype.colorModeForRenderPass=function(){var i=this.context.gl;return this._showOverdrawInspector?new fe([i.CONSTANT_COLOR,i.ONE],new p.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?fe.unblended:fe.alphaBlended},Pa.prototype.depthModeForSublayer=function(i,u,a){if(!this.opaquePassEnabledForLayer())return B.disabled;var h=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new B(a||this.context.gl.LEQUAL,u,[h,h])},Pa.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Pa.prototype.render=function(i,u){var a=this;this.style=i,this.options=u,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(p.browser.now()),this.imageManager.beginFrame();var h=this.style._order,g=this.style.sourceCaches;for(var S in g){var T=g[S];T.used&&T.prepare(this.context)}var R,G,ee={},ve={},ye={};for(var we in g){var Ke=g[we];ee[we]=Ke.getVisibleCoordinates(),ve[we]=ee[we].slice().reverse(),ye[we]=Ke.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var He=0;He<h.length;He++)if(this.style._layers[h[He]].is3D()){this.opaquePassCutoff=He;break}this.renderPass="offscreen";for(var at=0,ze=h;at<ze.length;at+=1){var it=this.style._layers[ze[at]];if(it.hasOffscreenPass()&&!it.isHidden(this.transform.zoom)){var mt=ve[it.source];(it.type==="custom"||mt.length)&&this.renderLayer(this,g[it.source],it,mt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){var Ut=this.style._layers[h[this.currentLayer]],sr=g[Ut.source],nr=ee[Ut.source];this._renderTileClippingMasks(Ut,nr),this.renderLayer(this,sr,Ut,nr)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){var cr=this.style._layers[h[this.currentLayer]],Rr=g[cr.source],tn=(cr.type==="symbol"?ye:ve)[cr.source];this._renderTileClippingMasks(cr,ee[cr.source]),this.renderLayer(this,Rr,cr,tn)}this.options.showTileBoundaries&&(p.values(this.style._layers).forEach(function(Xr){Xr.source&&!Xr.isHidden(a.transform.zoom)&&(Xr.source!==(G&&G.id)&&(G=a.style.sourceCaches[Xr.source]),(!R||R.getSource().maxzoom<G.getSource().maxzoom)&&(R=G))}),R&&Cu.debug(this,R,R.getVisibleCoordinates())),this.options.showPadding&&function(Xr){var yn=Xr.transform.padding;Fa(Xr,Xr.transform.height-(yn.top||0),3,No),Fa(Xr,yn.bottom||0,3,af),kc(Xr,yn.left||0,3,of),kc(Xr,Xr.transform.width-(yn.right||0),3,Fl);var Fn=Xr.transform.centerPoint;(function(Vn,jn,Qi,_n){Yu(Vn,jn-1,Qi-10,2,20,_n),Yu(Vn,jn-10,Qi-1,20,2,_n)})(Xr,Fn.x,Xr.transform.height-Fn.y,Dc)}(this),this.context.setDefault()},Pa.prototype.renderLayer=function(i,u,a,h){a.isHidden(this.transform.zoom)||(a.type==="background"||a.type==="custom"||h.length)&&(this.id=a.id,this.gpuTimingStart(a),Cu[a.type](i,u,a,h,this.style.placement.variableOffsets),this.gpuTimingEnd())},Pa.prototype.gpuTimingStart=function(i){if(this.options.gpuTiming){var u=this.context.extTimerQuery,a=this.gpuTimers[i.id];a||(a=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),a.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,a.query)}},Pa.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}},Pa.prototype.collectGpuTimers=function(){var i=this.gpuTimers;return this.gpuTimers={},i},Pa.prototype.queryGpuTimers=function(i){var u={};for(var a in i){var h=i[a],g=this.context.extTimerQuery,S=g.getQueryObjectEXT(h.query,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(h.query),u[a]=S}return u},Pa.prototype.translatePosMatrix=function(i,u,a,h,g){if(!a[0]&&!a[1])return i;var S=g?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(S){var T=Math.sin(S),R=Math.cos(S);a=[a[0]*R-a[1]*T,a[0]*T+a[1]*R]}var G=[g?a[0]:Gi(u,a[0],this.transform.zoom),g?a[1]:Gi(u,a[1],this.transform.zoom),0],ee=new Float32Array(16);return p.translate(ee,i,G),ee},Pa.prototype.saveTileTexture=function(i){var u=this._tileTextures[i.size[0]];u?u.push(i):this._tileTextures[i.size[0]]=[i]},Pa.prototype.getTileTexture=function(i){var u=this._tileTextures[i];return u&&u.length>0?u.pop():null},Pa.prototype.isPatternMissing=function(i){if(!i)return!1;if(!i.from||!i.to)return!0;var u=this.imageManager.getPattern(i.from.toString()),a=this.imageManager.getPattern(i.to.toString());return!u||!a},Pa.prototype.useProgram=function(i,u){this.cache=this.cache||{};var a=""+i+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[a]||(this.cache[a]=new Ll(this.context,i,Hf[i],u,dc[i],this._showOverdrawInspector)),this.cache[a]},Pa.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Pa.prototype.setBaseState=function(){var i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)},Pa.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Pa.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var rc=function(i,u){this.points=i,this.planes=u};rc.fromInvProjectionMatrix=function(i,u,a){var h=Math.pow(2,a),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(T){return p.transformMat4([],T,i)}).map(function(T){return p.scale$1([],T,1/T[3]/u*h)}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(T){var R=p.sub([],g[T[0]],g[T[1]]),G=p.sub([],g[T[2]],g[T[1]]),ee=p.normalize([],p.cross([],R,G)),ve=-p.dot(ee,g[T[1]]);return ee.concat(ve)});return new rc(g,S)};var Lu=function(i,u){this.min=i,this.max=u,this.center=p.scale$2([],p.add([],this.min,this.max),.5)};Lu.prototype.quadrant=function(i){for(var u=[i%2==0,i<2],a=p.clone$2(this.min),h=p.clone$2(this.max),g=0;g<u.length;g++)a[g]=u[g]?this.min[g]:this.center[g],h[g]=u[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new Lu(a,h)},Lu.prototype.distanceX=function(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]},Lu.prototype.distanceY=function(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]},Lu.prototype.intersects=function(i){for(var u=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],a=!0,h=0;h<i.planes.length;h++){for(var g=i.planes[h],S=0,T=0;T<u.length;T++)S+=p.dot$1(g,u[T])>=0;if(S===0)return 0;S!==u.length&&(a=!1)}if(a)return 2;for(var R=0;R<3;R++){for(var G=Number.MAX_VALUE,ee=-Number.MAX_VALUE,ve=0;ve<i.points.length;ve++){var ye=i.points[ve][R]-this.min[R];G=Math.min(G,ye),ee=Math.max(ee,ye)}if(ee<0||G>this.max[R]-this.min[R])return 0}return 1};var Ku=function(i,u,a,h){if(i===void 0&&(i=0),u===void 0&&(u=0),a===void 0&&(a=0),h===void 0&&(h=0),isNaN(i)||i<0||isNaN(u)||u<0||isNaN(a)||a<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=u,this.left=a,this.right=h};Ku.prototype.interpolate=function(i,u,a){return u.top!=null&&i.top!=null&&(this.top=p.number(i.top,u.top,a)),u.bottom!=null&&i.bottom!=null&&(this.bottom=p.number(i.bottom,u.bottom,a)),u.left!=null&&i.left!=null&&(this.left=p.number(i.left,u.left,a)),u.right!=null&&i.right!=null&&(this.right=p.number(i.right,u.right,a)),this},Ku.prototype.getCenter=function(i,u){var a=p.clamp((this.left+i-this.right)/2,0,i),h=p.clamp((this.top+u-this.bottom)/2,0,u);return new p.Point(a,h)},Ku.prototype.equals=function(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right},Ku.prototype.clone=function(){return new Ku(this.top,this.bottom,this.left,this.right)},Ku.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Hi=function(i,u,a,h,g){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=g===void 0||g,this._minZoom=i||0,this._maxZoom=u||22,this._minPitch=a==null?0:a,this._maxPitch=h==null?60:h,this.setMaxBounds(),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ku,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ma={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Hi.prototype.clone=function(){var i=new Hi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.tileSize=this.tileSize,i.latRange=this.latRange,i.width=this.width,i.height=this.height,i._center=this._center,i.zoom=this.zoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._calcMatrices(),i},Ma.minZoom.get=function(){return this._minZoom},Ma.minZoom.set=function(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))},Ma.maxZoom.get=function(){return this._maxZoom},Ma.maxZoom.set=function(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))},Ma.minPitch.get=function(){return this._minPitch},Ma.minPitch.set=function(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))},Ma.maxPitch.get=function(){return this._maxPitch},Ma.maxPitch.set=function(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))},Ma.renderWorldCopies.get=function(){return this._renderWorldCopies},Ma.renderWorldCopies.set=function(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i},Ma.worldSize.get=function(){return this.tileSize*this.scale},Ma.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ma.size.get=function(){return new p.Point(this.width,this.height)},Ma.bearing.get=function(){return-this.angle/Math.PI*180},Ma.bearing.set=function(i){var u=-p.wrap(i,-180,180)*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=p.create$2(),p.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ma.pitch.get=function(){return this._pitch/Math.PI*180},Ma.pitch.set=function(i){var u=p.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())},Ma.fov.get=function(){return this._fov/Math.PI*180},Ma.fov.set=function(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())},Ma.zoom.get=function(){return this._zoom},Ma.zoom.set=function(i){var u=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom,this._constrain(),this._calcMatrices())},Ma.center.get=function(){return this._center},Ma.center.set=function(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())},Ma.padding.get=function(){return this._edgeInsets.toJSON()},Ma.padding.set=function(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())},Ma.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Hi.prototype.isPaddingEqual=function(i){return this._edgeInsets.equals(i)},Hi.prototype.interpolatePadding=function(i,u,a){this._unmodified=!1,this._edgeInsets.interpolate(i,u,a),this._constrain(),this._calcMatrices()},Hi.prototype.coveringZoomLevel=function(i){var u=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,u)},Hi.prototype.getVisibleUnwrappedCoordinates=function(i){var u=[new p.UnwrappedTileID(0,i)];if(this._renderWorldCopies)for(var a=this.pointCoordinate(new p.Point(0,0)),h=this.pointCoordinate(new p.Point(this.width,0)),g=this.pointCoordinate(new p.Point(this.width,this.height)),S=this.pointCoordinate(new p.Point(0,this.height)),T=Math.floor(Math.min(a.x,h.x,g.x,S.x)),R=Math.floor(Math.max(a.x,h.x,g.x,S.x)),G=T-1;G<=R+1;G++)G!==0&&u.push(new p.UnwrappedTileID(G,i));return u},Hi.prototype.coveringTiles=function(i){var u=this.coveringZoomLevel(i),a=u;if(i.minzoom!==void 0&&u<i.minzoom)return[];i.maxzoom!==void 0&&u>i.maxzoom&&(u=i.maxzoom);var h=p.MercatorCoordinate.fromLngLat(this.center),g=Math.pow(2,u),S=[g*h.x,g*h.y,0],T=rc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u),R=i.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(R=u);var G=function(Xr){return{aabb:new Lu([Xr*g,0,0],[(Xr+1)*g,g,0]),zoom:0,x:0,y:0,wrap:Xr,fullyVisible:!1}},ee=[],ve=[],ye=u,we=i.reparseOverscaled?a:u;if(this._renderWorldCopies)for(var Ke=1;Ke<=3;Ke++)ee.push(G(-Ke)),ee.push(G(Ke));for(ee.push(G(0));ee.length>0;){var He=ee.pop(),at=He.x,ze=He.y,it=He.fullyVisible;if(!it){var mt=He.aabb.intersects(T);if(mt===0)continue;it=mt===2}var Ut=He.aabb.distanceX(S),sr=He.aabb.distanceY(S),nr=Math.max(Math.abs(Ut),Math.abs(sr));if(He.zoom===ye||nr>3+(1<<ye-He.zoom)-2&&He.zoom>=R)ve.push({tileID:new p.OverscaledTileID(He.zoom===ye?we:He.zoom,He.wrap,He.zoom,at,ze),distanceSq:p.sqrLen([S[0]-.5-at,S[1]-.5-ze])});else for(var cr=0;cr<4;cr++){var Rr=(at<<1)+cr%2,tn=(ze<<1)+(cr>>1);ee.push({aabb:He.aabb.quadrant(cr),zoom:He.zoom+1,x:Rr,y:tn,wrap:He.wrap,fullyVisible:it})}}return ve.sort(function(Xr,yn){return Xr.distanceSq-yn.distanceSq}).map(function(Xr){return Xr.tileID})},Hi.prototype.resize=function(i,u){this.width=i,this.height=u,this.pixelsToGLUnits=[2/i,-2/u],this._constrain(),this._calcMatrices()},Ma.unmodified.get=function(){return this._unmodified},Hi.prototype.zoomScale=function(i){return Math.pow(2,i)},Hi.prototype.scaleZoom=function(i){return Math.log(i)/Math.LN2},Hi.prototype.project=function(i){var u=p.clamp(i.lat,-this.maxValidLatitude,this.maxValidLatitude);return new p.Point(p.mercatorXfromLng(i.lng)*this.worldSize,p.mercatorYfromLat(u)*this.worldSize)},Hi.prototype.unproject=function(i){return new p.MercatorCoordinate(i.x/this.worldSize,i.y/this.worldSize).toLngLat()},Ma.point.get=function(){return this.project(this.center)},Hi.prototype.setLocationAtPoint=function(i,u){var a=this.pointCoordinate(u),h=this.pointCoordinate(this.centerPoint),g=this.locationCoordinate(i),S=new p.MercatorCoordinate(g.x-(a.x-h.x),g.y-(a.y-h.y));this.center=this.coordinateLocation(S),this._renderWorldCopies&&(this.center=this.center.wrap())},Hi.prototype.locationPoint=function(i){return this.coordinatePoint(this.locationCoordinate(i))},Hi.prototype.pointLocation=function(i){return this.coordinateLocation(this.pointCoordinate(i))},Hi.prototype.locationCoordinate=function(i){return p.MercatorCoordinate.fromLngLat(i)},Hi.prototype.coordinateLocation=function(i){return i.toLngLat()},Hi.prototype.pointCoordinate=function(i){var u=[i.x,i.y,0,1],a=[i.x,i.y,1,1];p.transformMat4(u,u,this.pixelMatrixInverse),p.transformMat4(a,a,this.pixelMatrixInverse);var h=u[3],g=a[3],S=u[1]/h,T=a[1]/g,R=u[2]/h,G=a[2]/g,ee=R===G?0:(0-R)/(G-R);return new p.MercatorCoordinate(p.number(u[0]/h,a[0]/g,ee)/this.worldSize,p.number(S,T,ee)/this.worldSize)},Hi.prototype.coordinatePoint=function(i){var u=[i.x*this.worldSize,i.y*this.worldSize,0,1];return p.transformMat4(u,u,this.pixelMatrix),new p.Point(u[0]/u[3],u[1]/u[3])},Hi.prototype.getBounds=function(){return new p.LngLatBounds().extend(this.pointLocation(new p.Point(0,0))).extend(this.pointLocation(new p.Point(this.width,0))).extend(this.pointLocation(new p.Point(this.width,this.height))).extend(this.pointLocation(new p.Point(0,this.height)))},Hi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new p.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Hi.prototype.setMaxBounds=function(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Hi.prototype.calculatePosMatrix=function(i,u){u===void 0&&(u=!1);var a=i.key,h=u?this._alignedPosMatrixCache:this._posMatrixCache;if(h[a])return h[a];var g=i.canonical,S=this.worldSize/this.zoomScale(g.z),T=g.x+Math.pow(2,g.z)*i.wrap,R=p.identity(new Float64Array(16));return p.translate(R,R,[T*S,g.y*S,0]),p.scale(R,R,[S/p.EXTENT,S/p.EXTENT,1]),p.multiply(R,u?this.alignedProjMatrix:this.projMatrix,R),h[a]=new Float32Array(R),h[a]},Hi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Hi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var i,u,a,h,g=-90,S=90,T=-180,R=180,G=this.size,ee=this._unmodified;if(this.latRange){var ve=this.latRange;g=p.mercatorYfromLat(ve[1])*this.worldSize,i=(S=p.mercatorYfromLat(ve[0])*this.worldSize)-g<G.y?G.y/(S-g):0}if(this.lngRange){var ye=this.lngRange;T=p.mercatorXfromLng(ye[0])*this.worldSize,u=(R=p.mercatorXfromLng(ye[1])*this.worldSize)-T<G.x?G.x/(R-T):0}var we=this.point,Ke=Math.max(u||0,i||0);if(Ke)return this.center=this.unproject(new p.Point(u?(R+T)/2:we.x,i?(S+g)/2:we.y)),this.zoom+=this.scaleZoom(Ke),this._unmodified=ee,void(this._constraining=!1);if(this.latRange){var He=we.y,at=G.y/2;He-at<g&&(h=g+at),He+at>S&&(h=S-at)}if(this.lngRange){var ze=we.x,it=G.x/2;ze-it<T&&(a=T+it),ze+it>R&&(a=R-it)}a===void 0&&h===void 0||(this.center=this.unproject(new p.Point(a!==void 0?a:we.x,h!==void 0?h:we.y))),this._unmodified=ee,this._constraining=!1}},Hi.prototype._calcMatrices=function(){if(this.height){var i=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var u=Math.PI/2+this._pitch,a=this._fov*(.5+i.y/this.height),h=Math.sin(a)*this.cameraToCenterDistance/Math.sin(p.clamp(Math.PI-u-a,.01,Math.PI-.01)),g=this.point,S=g.x,T=g.y,R=1.01*(Math.cos(Math.PI/2-this._pitch)*h+this.cameraToCenterDistance),G=this.height/50,ee=new Float64Array(16);p.perspective(ee,this._fov,this.width/this.height,G,R),ee[8]=2*-i.x/this.width,ee[9]=2*i.y/this.height,p.scale(ee,ee,[1,-1,1]),p.translate(ee,ee,[0,0,-this.cameraToCenterDistance]),p.rotateX(ee,ee,this._pitch),p.rotateZ(ee,ee,this.angle),p.translate(ee,ee,[-S,-T,0]),this.mercatorMatrix=p.scale([],ee,[this.worldSize,this.worldSize,this.worldSize]),p.scale(ee,ee,[1,1,p.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=ee,this.invProjMatrix=p.invert([],this.projMatrix);var ve=this.width%2/2,ye=this.height%2/2,we=Math.cos(this.angle),Ke=Math.sin(this.angle),He=S-Math.round(S)+we*ve+Ke*ye,at=T-Math.round(T)+we*ye+Ke*ve,ze=new Float64Array(ee);if(p.translate(ze,ze,[He>.5?He-1:He,at>.5?at-1:at,0]),this.alignedProjMatrix=ze,ee=p.create(),p.scale(ee,ee,[this.width/2,-this.height/2,1]),p.translate(ee,ee,[1,-1,0]),this.labelPlaneMatrix=ee,ee=p.create(),p.scale(ee,ee,[1,-1,1]),p.translate(ee,ee,[-1,-1,0]),p.scale(ee,ee,[2/this.width,2/this.height,1]),this.glCoordMatrix=ee,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(ee=p.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=ee,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Hi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var i=this.pointCoordinate(new p.Point(0,0)),u=[i.x*this.worldSize,i.y*this.worldSize,0,1];return p.transformMat4(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance},Hi.prototype.getCameraPoint=function(){var i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,i))},Hi.prototype.getCameraQueryGeometry=function(i){var u=this.getCameraPoint();if(i.length===1)return[i[0],u];for(var a=u.x,h=u.y,g=u.x,S=u.y,T=0,R=i;T<R.length;T+=1){var G=R[T];a=Math.min(a,G.x),h=Math.min(h,G.y),g=Math.max(g,G.x),S=Math.max(S,G.y)}return[new p.Point(a,h),new p.Point(g,h),new p.Point(g,S),new p.Point(a,S),new p.Point(a,h)]},Object.defineProperties(Hi.prototype,Ma);var Us=function(i){var u,a,h,g;this._hashName=i&&encodeURIComponent(i),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(u=this._updateHashUnthrottled.bind(this),a=!1,h=null,g=function(){h=null,a&&(u(),h=setTimeout(g,300),a=!1)},function(){return a=!0,h||g(),h})};Us.prototype.addTo=function(i){return this._map=i,p.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Us.prototype.remove=function(){return p.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Us.prototype.getHashString=function(i){var u=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,h=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,h),S=Math.round(u.lng*g)/g,T=Math.round(u.lat*g)/g,R=this._map.getBearing(),G=this._map.getPitch(),ee="";if(ee+=i?"/"+S+"/"+T+"/"+a:a+"/"+T+"/"+S,(R||G)&&(ee+="/"+Math.round(10*R)/10),G&&(ee+="/"+Math.round(G)),this._hashName){var ve=this._hashName,ye=!1,we=p.window.location.hash.slice(1).split("&").map(function(Ke){var He=Ke.split("=")[0];return He===ve?(ye=!0,He+"="+ee):Ke}).filter(function(Ke){return Ke});return ye||we.push(ve+"="+ee),"#"+we.join("&")}return"#"+ee},Us.prototype._getCurrentHash=function(){var i,u=this,a=p.window.location.hash.replace("#","");return this._hashName?(a.split("&").map(function(h){return h.split("=")}).forEach(function(h){h[0]===u._hashName&&(i=h)}),(i&&i[1]||"").split("/")):a.split("/")},Us.prototype._onHashChange=function(){var i=this._getCurrentHash();if(i.length>=3&&!i.some(function(a){return isNaN(a)})){var u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:u,pitch:+(i[4]||0)}),!0}return!1},Us.prototype._updateHashUnthrottled=function(){var i=p.window.location.href.replace(/(#.+)?$/,this.getHashString());try{p.window.history.replaceState(p.window.history.state,null,i)}catch(u){}};var vc={linearity:.3,easing:p.bezier(0,0,.3,1)},nc=p.extend({deceleration:2500,maxSpeed:1400},vc),ic=p.extend({deceleration:20,maxSpeed:1400},vc),Of=p.extend({deceleration:1e3,maxSpeed:360},vc),Lf=p.extend({deceleration:1e3,maxSpeed:90},vc),ac=function(i){this._map=i,this.clear()};function $u(i,u){(!i.duration||i.duration<u.duration)&&(i.duration=u.duration,i.easing=u.easing)}function Ru(i,u,a){var h=a.maxSpeed,g=a.linearity,S=a.deceleration,T=p.clamp(i*g/(u/1e3),-h,h),R=Math.abs(T)/(S*g);return{easing:a.easing,duration:1e3*R,amount:T*(R/2)}}ac.prototype.clear=function(){this._inertiaBuffer=[]},ac.prototype.record=function(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.browser.now(),settings:i})},ac.prototype._drainInertiaBuffer=function(){for(var i=this._inertiaBuffer,u=p.browser.now();i.length>0&&u-i[0].time>160;)i.shift()},ac.prototype._onMoveEnd=function(i){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var u={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0},a=0,h=this._inertiaBuffer;a<h.length;a+=1){var g=h[a].settings;u.zoom+=g.zoomDelta||0,u.bearing+=g.bearingDelta||0,u.pitch+=g.pitchDelta||0,g.panDelta&&u.pan._add(g.panDelta),g.around&&(u.around=g.around),g.pinchAround&&(u.pinchAround=g.pinchAround)}var S=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,T={};if(u.pan.mag()){var R=Ru(u.pan.mag(),S,p.extend({},nc,i||{}));T.offset=u.pan.mult(R.amount/u.pan.mag()),T.center=this._map.transform.center,$u(T,R)}if(u.zoom){var G=Ru(u.zoom,S,ic);T.zoom=this._map.transform.zoom+G.amount,$u(T,G)}if(u.bearing){var ee=Ru(u.bearing,S,Of);T.bearing=this._map.transform.bearing+p.clamp(ee.amount,-179,179),$u(T,ee)}if(u.pitch){var ve=Ru(u.pitch,S,Lf);T.pitch=this._map.transform.pitch+ve.amount,$u(T,ve)}if(T.zoom||T.bearing){var ye=u.pinchAround===void 0?u.around:u.pinchAround;T.around=ye?this._map.unproject(ye):this._map.getCenter()}return this.clear(),p.extend(T,{noMoveStart:!0})}};var ro=function(i){function u(h,g,S,T){T===void 0&&(T={});var R=X.mousePos(g.getCanvasContainer(),S),G=g.unproject(R);i.call(this,h,p.extend({point:R,lngLat:G,originalEvent:S},T)),this._defaultPrevented=!1,this.target=g}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var a={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,a),u}(p.Event),hs=function(i){function u(h,g,S){var T=h==="touchend"?S.changedTouches:S.touches,R=X.touchPos(g.getCanvasContainer(),T),G=R.map(function(ye){return g.unproject(ye)}),ee=R.reduce(function(ye,we,Ke,He){return ye.add(we.div(He.length))},new p.Point(0,0)),ve=g.unproject(ee);i.call(this,h,{points:R,point:ee,lngLats:G,lngLat:ve,originalEvent:S}),this._defaultPrevented=!1}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var a={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,a),u}(p.Event),pl=function(i){function u(h,g,S){i.call(this,h,{originalEvent:S}),this._defaultPrevented=!1}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var a={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,a),u}(p.Event),Va=function(i,u){this._map=i,this._clickTolerance=u.clickTolerance};Va.prototype.reset=function(){delete this._mousedownPos},Va.prototype.wheel=function(i){return this._firePreventable(new pl(i.type,this._map,i))},Va.prototype.mousedown=function(i,u){return this._mousedownPos=u,this._firePreventable(new ro(i.type,this._map,i))},Va.prototype.mouseup=function(i){this._map.fire(new ro(i.type,this._map,i))},Va.prototype.click=function(i,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new ro(i.type,this._map,i))},Va.prototype.dblclick=function(i){return this._firePreventable(new ro(i.type,this._map,i))},Va.prototype.mouseover=function(i){this._map.fire(new ro(i.type,this._map,i))},Va.prototype.mouseout=function(i){this._map.fire(new ro(i.type,this._map,i))},Va.prototype.touchstart=function(i){return this._firePreventable(new hs(i.type,this._map,i))},Va.prototype.touchmove=function(i){this._map.fire(new hs(i.type,this._map,i))},Va.prototype.touchend=function(i){this._map.fire(new hs(i.type,this._map,i))},Va.prototype.touchcancel=function(i){this._map.fire(new hs(i.type,this._map,i))},Va.prototype._firePreventable=function(i){if(this._map.fire(i),i.defaultPrevented)return{}},Va.prototype.isEnabled=function(){return!0},Va.prototype.isActive=function(){return!1},Va.prototype.enable=function(){},Va.prototype.disable=function(){};var wn=function(i){this._map=i};wn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},wn.prototype.mousemove=function(i){this._map.fire(new ro(i.type,this._map,i))},wn.prototype.mousedown=function(){this._delayContextMenu=!0},wn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ro("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},wn.prototype.contextmenu=function(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new ro(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()},wn.prototype.isEnabled=function(){return!0},wn.prototype.isActive=function(){return!1},wn.prototype.enable=function(){},wn.prototype.disable=function(){};var js=function(i,u){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=u.clickTolerance||1};function mc(i,u){for(var a={},h=0;h<i.length;h++)a[i[h].identifier]=u[h];return a}js.prototype.isEnabled=function(){return!!this._enabled},js.prototype.isActive=function(){return!!this._active},js.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},js.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},js.prototype.mousedown=function(i,u){this.isEnabled()&&i.shiftKey&&i.button===0&&(X.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)},js.prototype.mousemoveWindow=function(i,u){if(this._active){var a=u;if(!(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)){var h=this._startPos;this._lastPos=a,this._box||(this._box=X.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));var g=Math.min(h.x,a.x),S=Math.max(h.x,a.x),T=Math.min(h.y,a.y),R=Math.max(h.y,a.y);X.setTransform(this._box,"translate("+g+"px,"+T+"px)"),this._box.style.width=S-g+"px",this._box.style.height=R-T+"px"}}},js.prototype.mouseupWindow=function(i,u){var a=this;if(this._active&&i.button===0){var h=this._startPos,g=u;if(this.reset(),X.suppressClick(),h.x!==g.x||h.y!==g.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:function(S){return S.fitScreenCoordinates(h,g,a._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",i)}},js.prototype.keydown=function(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))},js.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(X.remove(this._box),this._box=null),X.enableDrag(),delete this._startPos,delete this._lastPos},js.prototype._fireEvent=function(i,u){return this._map.fire(new p.Event(i,{originalEvent:u}))};var Bl=function(i){this.reset(),this.numTouches=i.numTouches};Bl.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Bl.prototype.touchstart=function(i,u,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),a.length===this.numTouches&&(this.centroid=function(h){for(var g=new p.Point(0,0),S=0,T=h;S<T.length;S+=1)g._add(T[S]);return g.div(h.length)}(u),this.touches=mc(a,u)))},Bl.prototype.touchmove=function(i,u,a){if(!this.aborted&&this.centroid){var h=mc(a,u);for(var g in this.touches){var S=h[g];(!S||S.dist(this.touches[g])>30)&&(this.aborted=!0)}}},Bl.prototype.touchend=function(i,u,a){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){var h=!this.aborted&&this.centroid;if(this.reset(),h)return h}};var lu=function(i){this.singleTap=new Bl(i),this.numTaps=i.numTaps,this.reset()};lu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},lu.prototype.touchstart=function(i,u,a){this.singleTap.touchstart(i,u,a)},lu.prototype.touchmove=function(i,u,a){this.singleTap.touchmove(i,u,a)},lu.prototype.touchend=function(i,u,a){var h=this.singleTap.touchend(i,u,a);if(h){var g=i.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(h)<30;if(g&&S||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}};var Vs=function(){this._zoomIn=new lu({numTouches:1,numTaps:2}),this._zoomOut=new lu({numTouches:2,numTaps:1}),this.reset()};Vs.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Vs.prototype.touchstart=function(i,u,a){this._zoomIn.touchstart(i,u,a),this._zoomOut.touchstart(i,u,a)},Vs.prototype.touchmove=function(i,u,a){this._zoomIn.touchmove(i,u,a),this._zoomOut.touchmove(i,u,a)},Vs.prototype.touchend=function(i,u,a){var h=this,g=this._zoomIn.touchend(i,u,a),S=this._zoomOut.touchend(i,u,a);return g?(this._active=!0,i.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(g)},{originalEvent:i})}}):S?(this._active=!0,i.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(S)},{originalEvent:i})}}):void 0},Vs.prototype.touchcancel=function(){this.reset()},Vs.prototype.enable=function(){this._enabled=!0},Vs.prototype.disable=function(){this._enabled=!1,this.reset()},Vs.prototype.isEnabled=function(){return this._enabled},Vs.prototype.isActive=function(){return this._active};var dl={0:1,2:2},$r=function(i){this.reset(),this._clickTolerance=i.clickTolerance||1};$r.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},$r.prototype._correctButton=function(i,u){return!1},$r.prototype._move=function(i,u){return{}},$r.prototype.mousedown=function(i,u){if(!this._lastPoint){var a=X.mouseButton(i);this._correctButton(i,a)&&(this._lastPoint=u,this._eventButton=a)}},$r.prototype.mousemoveWindow=function(i,u){var a=this._lastPoint;if(a){if(i.preventDefault(),function(h,g){var S=dl[g];return h.buttons===void 0||(h.buttons&S)!==S}(i,this._eventButton))this.reset();else if(this._moved||!(u.dist(a)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(a,u)}},$r.prototype.mouseupWindow=function(i){this._lastPoint&&X.mouseButton(i)===this._eventButton&&(this._moved&&X.suppressClick(),this.reset())},$r.prototype.enable=function(){this._enabled=!0},$r.prototype.disable=function(){this._enabled=!1,this.reset()},$r.prototype.isEnabled=function(){return this._enabled},$r.prototype.isActive=function(){return this._active};var Bc=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.mousedown=function(a,h){i.prototype.mousedown.call(this,a,h),this._lastPoint&&(this._active=!0)},u.prototype._correctButton=function(a,h){return h===0&&!a.ctrlKey},u.prototype._move=function(a,h){return{around:h,panDelta:h.sub(a)}},u}($r),gc=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype._correctButton=function(a,h){return h===0&&a.ctrlKey||h===2},u.prototype._move=function(a,h){var g=.8*(h.x-a.x);if(g)return this._active=!0,{bearingDelta:g}},u.prototype.contextmenu=function(a){a.preventDefault()},u}($r),Ju=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype._correctButton=function(a,h){return h===0&&a.ctrlKey||h===2},u.prototype._move=function(a,h){var g=-.5*(h.y-a.y);if(g)return this._active=!0,{pitchDelta:g}},u.prototype.contextmenu=function(a){a.preventDefault()},u}($r),Js=function(i){this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset()};Js.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)},Js.prototype.touchstart=function(i,u,a){return this._calculateTransform(i,u,a)},Js.prototype.touchmove=function(i,u,a){if(this._active&&!(a.length<this._minTouches))return i.preventDefault(),this._calculateTransform(i,u,a)},Js.prototype.touchend=function(i,u,a){this._calculateTransform(i,u,a),this._active&&a.length<this._minTouches&&this.reset()},Js.prototype.touchcancel=function(){this.reset()},Js.prototype._calculateTransform=function(i,u,a){a.length>0&&(this._active=!0);var h=mc(a,u),g=new p.Point(0,0),S=new p.Point(0,0),T=0;for(var R in h){var G=h[R],ee=this._touches[R];ee&&(g._add(G),S._add(G.sub(ee)),T++,h[R]=G)}if(this._touches=h,!(T<this._minTouches)&&S.mag()){var ve=S.div(T);if(this._sum._add(ve),!(this._sum.mag()<this._clickTolerance))return{around:g.div(T),panDelta:ve}}},Js.prototype.enable=function(){this._enabled=!0},Js.prototype.disable=function(){this._enabled=!1,this.reset()},Js.prototype.isEnabled=function(){return this._enabled},Js.prototype.isActive=function(){return this._active};var Ms=function(){this.reset()};function Nc(i,u,a){for(var h=0;h<i.length;h++)if(i[h].identifier===a)return u[h]}function zc(i,u){return Math.log(i/u)/Math.LN2}Ms.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Ms.prototype._start=function(i){},Ms.prototype._move=function(i,u,a){return{}},Ms.prototype.touchstart=function(i,u,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([u[0],u[1]]))},Ms.prototype.touchmove=function(i,u,a){if(this._firstTwoTouches){i.preventDefault();var h=this._firstTwoTouches,g=h[1],S=Nc(a,u,h[0]),T=Nc(a,u,g);if(S&&T){var R=this._aroundCenter?null:S.add(T).div(2);return this._move([S,T],R,i)}}},Ms.prototype.touchend=function(i,u,a){if(this._firstTwoTouches){var h=this._firstTwoTouches,g=h[1],S=Nc(a,u,h[0]),T=Nc(a,u,g);S&&T||(this._active&&X.suppressClick(),this.reset())}},Ms.prototype.touchcancel=function(){this.reset()},Ms.prototype.enable=function(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"},Ms.prototype.disable=function(){this._enabled=!1,this.reset()},Ms.prototype.isEnabled=function(){return this._enabled},Ms.prototype.isActive=function(){return this._active};var Gs=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.reset=function(){i.prototype.reset.call(this),delete this._distance,delete this._startDistance},u.prototype._start=function(a){this._startDistance=this._distance=a[0].dist(a[1])},u.prototype._move=function(a,h){var g=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(zc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:zc(this._distance,g),pinchAround:h}},u}(Ms);function Qu(i,u){return 180*i.angleWith(u)/Math.PI}var Nl=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.reset=function(){i.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},u.prototype._start=function(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])},u.prototype._move=function(a,h){var g=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Qu(this._vector,g),pinchAround:h}},u.prototype._isBelowThreshold=function(a){this._minDiameter=Math.min(this._minDiameter,a.mag());var h=25/(Math.PI*this._minDiameter)*360,g=Qu(a,this._startVector);return Math.abs(g)<h},u}(Ms);function Du(i){return Math.abs(i.y)>Math.abs(i.x)}var Zc=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.reset=function(){i.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},u.prototype._start=function(a){this._lastPoints=a,Du(a[0].sub(a[1]))&&(this._valid=!1)},u.prototype._move=function(a,h,g){var S=a[0].sub(this._lastPoints[0]),T=a[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(S,T,g.timeStamp),this._valid)return this._lastPoints=a,this._active=!0,{pitchDelta:(S.y+T.y)/2*-.5}},u.prototype.gestureBeginsVertically=function(a,h,g){if(this._valid!==void 0)return this._valid;var S=a.mag()>=2,T=h.mag()>=2;if(S||T){if(!S||!T)return this._firstMove===void 0&&(this._firstMove=g),g-this._firstMove<100&&void 0;var R=a.y>0==h.y>0;return Du(a)&&Du(h)&&R}},u}(Ms),yc={panStep:100,bearingStep:15,pitchStep:10},cu=function(){var i=yc;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1};function Is(i){return i*(2-i)}cu.prototype.reset=function(){this._active=!1},cu.prototype.keydown=function(i){var u=this;if(!(i.altKey||i.ctrlKey||i.metaKey)){var a=0,h=0,g=0,S=0,T=0;switch(i.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:i.shiftKey?h=-1:(i.preventDefault(),S=-1);break;case 39:i.shiftKey?h=1:(i.preventDefault(),S=1);break;case 38:i.shiftKey?g=1:(i.preventDefault(),T=-1);break;case 40:i.shiftKey?g=-1:(i.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(h=0,g=0),{cameraAnimation:function(R){var G=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:Is,zoom:a?Math.round(G)+a*(i.shiftKey?2:1):G,bearing:R.getBearing()+h*u._bearingStep,pitch:R.getPitch()+g*u._pitchStep,offset:[-S*u._panStep,-T*u._panStep],center:R.getCenter()},{originalEvent:i})}}}},cu.prototype.enable=function(){this._enabled=!0},cu.prototype.disable=function(){this._enabled=!1,this.reset()},cu.prototype.isEnabled=function(){return this._enabled},cu.prototype.isActive=function(){return this._active},cu.prototype.disableRotation=function(){this._rotationDisabled=!0},cu.prototype.enableRotation=function(){this._rotationDisabled=!1};var Bi=function(i,u){this._map=i,this._el=i.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,p.bindAll(["_onTimeout"],this)};Bi.prototype.setZoomRate=function(i){this._defaultZoomRate=i},Bi.prototype.setWheelZoomRate=function(i){this._wheelZoomRate=i},Bi.prototype.isEnabled=function(){return!!this._enabled},Bi.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Bi.prototype.isZooming=function(){return!!this._zooming},Bi.prototype.enable=function(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=i&&i.around==="center")},Bi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Bi.prototype.wheel=function(i){if(this.isEnabled()){var u=i.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY,a=p.browser.now(),h=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,u!==0&&u%4.000244140625==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(h*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),i.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=i,this._delta-=u,this._active||this._start(i)),i.preventDefault()}},Bi.prototype._onTimeout=function(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)},Bi.prototype._start=function(i){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var u=X.mousePos(this._el,i);this._around=p.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(u)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Bi.prototype.renderFrame=function(){var i=this;if(this._frameId&&(this._frameId=null,this.isActive())){var u=this._map.transform;if(this._delta!==0){var a=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,h=2/(1+Math.exp(-Math.abs(this._delta*a)));this._delta<0&&h!==0&&(h=1/h);var g=typeof this._targetZoom=="number"?u.zoomScale(this._targetZoom):u.scale;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(g*h))),this._type==="wheel"&&(this._startZoom=u.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var S,T=typeof this._targetZoom=="number"?this._targetZoom:u.zoom,R=this._startZoom,G=this._easing,ee=!1;if(this._type==="wheel"&&R&&G){var ve=Math.min((p.browser.now()-this._lastWheelEventTime)/200,1),ye=G(ve);S=p.number(R,T,ye),ve<1?this._frameId||(this._frameId=!0):ee=!0}else S=T,ee=!0;return this._active=!0,ee&&(this._active=!1,this._finishTimeout=setTimeout(function(){i._zooming=!1,i._handler._triggerRenderFrame(),delete i._targetZoom,delete i._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!ee,zoomDelta:S-u.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Bi.prototype._smoothOutEasing=function(i){var u=p.ease;if(this._prevEase){var a=this._prevEase,h=(p.browser.now()-a.start)/a.duration,g=a.easing(h+.01)-a.easing(h),S=.27/Math.sqrt(g*g+1e-4)*.01,T=Math.sqrt(.0729-S*S);u=p.bezier(S,T,.25,1)}return this._prevEase={start:p.browser.now(),duration:i,easing:u},u},Bi.prototype.reset=function(){this._active=!1};var Qs=function(i,u){this._clickZoom=i,this._tapZoom=u};Qs.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Qs.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Qs.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Qs.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var $o=function(){this.reset()};$o.prototype.reset=function(){this._active=!1},$o.prototype.dblclick=function(i,u){return i.preventDefault(),{cameraAnimation:function(a){a.easeTo({duration:300,zoom:a.getZoom()+(i.shiftKey?-1:1),around:a.unproject(u)},{originalEvent:i})}}},$o.prototype.enable=function(){this._enabled=!0},$o.prototype.disable=function(){this._enabled=!1,this.reset()},$o.prototype.isEnabled=function(){return this._enabled},$o.prototype.isActive=function(){return this._active};var Ao=function(){this._tap=new lu({numTouches:1,numTaps:1}),this.reset()};Ao.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Ao.prototype.touchstart=function(i,u,a){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?a.length>0&&(this._swipePoint=u[0],this._swipeTouch=a[0].identifier):this._tap.touchstart(i,u,a))},Ao.prototype.touchmove=function(i,u,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;var h=u[0],g=h.y-this._swipePoint.y;return this._swipePoint=h,i.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(i,u,a)},Ao.prototype.touchend=function(i,u,a){this._tapTime?this._swipePoint&&a.length===0&&this.reset():this._tap.touchend(i,u,a)&&(this._tapTime=i.timeStamp)},Ao.prototype.touchcancel=function(){this.reset()},Ao.prototype.enable=function(){this._enabled=!0},Ao.prototype.disable=function(){this._enabled=!1,this.reset()},Ao.prototype.isEnabled=function(){return this._enabled},Ao.prototype.isActive=function(){return this._active};var vl=function(i,u,a){this._el=i,this._mousePan=u,this._touchPan=a};vl.prototype.enable=function(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},vl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},vl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},vl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var qu=function(i,u,a){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=u,this._mousePitch=a};qu.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},qu.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},qu.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},qu.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var fu=function(i,u,a,h){this._el=i,this._touchZoom=u,this._touchRotate=a,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0};fu.prototype.enable=function(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},fu.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},fu.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},fu.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},fu.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},fu.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var is=function(i){return i.zoom||i.drag||i.pitch||i.rotate},zl=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u}(p.Event);function Un(i){return i.panDelta&&i.panDelta.mag()||i.zoomDelta||i.bearingDelta||i.pitchDelta}var On=function(i,u){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ac(i),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u),p.bindAll(["handleEvent","handleWindowEvent"],this);var a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[p.window,"blur",void 0]];for(var h=0,g=this._listeners;h<g.length;h+=1){var S=g[h],T=S[0];X.addEventListener(T,S[1],T===p.window.document?this.handleWindowEvent:this.handleEvent,S[2])}};On.prototype.destroy=function(){for(var i=0,u=this._listeners;i<u.length;i+=1){var a=u[i],h=a[0];X.removeEventListener(h,a[1],h===p.window.document?this.handleWindowEvent:this.handleEvent,a[2])}},On.prototype._addDefaultHandlers=function(i){var u=this._map,a=u.getCanvasContainer();this._add("mapEvent",new Va(u,i));var h=u.boxZoom=new js(u,i);this._add("boxZoom",h);var g=new Vs,S=new $o;u.doubleClickZoom=new Qs(S,g),this._add("tapZoom",g),this._add("clickZoom",S);var T=new Ao;this._add("tapDragZoom",T);var R=u.touchPitch=new Zc;this._add("touchPitch",R);var G=new gc(i),ee=new Ju(i);u.dragRotate=new qu(i,G,ee),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",ee,["mouseRotate"]);var ve=new Bc(i),ye=new Js(i);u.dragPan=new vl(a,ve,ye),this._add("mousePan",ve),this._add("touchPan",ye,["touchZoom","touchRotate"]);var we=new Nl,Ke=new Gs;u.touchZoomRotate=new fu(a,Ke,we,T),this._add("touchRotate",we,["touchPan","touchZoom"]),this._add("touchZoom",Ke,["touchPan","touchRotate"]);var He=u.scrollZoom=new Bi(u,this);this._add("scrollZoom",He,["mousePan"]);var at=u.keyboard=new cu;this._add("keyboard",at),this._add("blockableMapEvent",new wn(u));for(var ze=0,it=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];ze<it.length;ze+=1){var mt=it[ze];i.interactive&&i[mt]&&u[mt].enable(i[mt])}},On.prototype._add=function(i,u,a){this._handlers.push({handlerName:i,handler:u,allowed:a}),this._handlersById[i]=u},On.prototype.stop=function(i){if(!this._updatingCamera){for(var u=0,a=this._handlers;u<a.length;u+=1)a[u].handler.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}},On.prototype.isActive=function(){for(var i=0,u=this._handlers;i<u.length;i+=1)if(u[i].handler.isActive())return!0;return!1},On.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},On.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},On.prototype.isMoving=function(){return Boolean(is(this._eventsInProgress))||this.isZooming()},On.prototype._blockedByActive=function(i,u,a){for(var h in i)if(h!==a&&(!u||u.indexOf(h)<0))return!0;return!1},On.prototype.handleWindowEvent=function(i){this.handleEvent(i,i.type+"Window")},On.prototype._getMapTouches=function(i){for(var u=[],a=0,h=i;a<h.length;a+=1){var g=h[a];this._el.contains(g.target)&&u.push(g)}return u},On.prototype.handleEvent=function(i,u){if(i.type!=="blur"){this._updatingCamera=!0;for(var a=i.type==="renderFrame"?void 0:i,h={needsRenderFrame:!1},g={},S={},T=i.touches?this._getMapTouches(i.touches):void 0,R=T?X.touchPos(this._el,T):X.mousePos(this._el,i),G=0,ee=this._handlers;G<ee.length;G+=1){var ve=ee[G],ye=ve.handlerName,we=ve.handler,Ke=ve.allowed;if(we.isEnabled()){var He=void 0;this._blockedByActive(S,Ke,ye)?we.reset():we[u||i.type]&&(He=we[u||i.type](i,R,T),this.mergeHandlerResult(h,g,He,ye,a),He&&He.needsRenderFrame&&this._triggerRenderFrame()),(He||we.isActive())&&(S[ye]=we)}}var at={};for(var ze in this._previousActiveHandlers)S[ze]||(at[ze]=a);this._previousActiveHandlers=S,(Object.keys(at).length||Un(h))&&(this._changes.push([h,g,at]),this._triggerRenderFrame()),(Object.keys(S).length||Un(h))&&this._map._stop(!0),this._updatingCamera=!1;var it=h.cameraAnimation;it&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],it(this._map))}else this.stop(!0)},On.prototype.mergeHandlerResult=function(i,u,a,h,g){if(a){p.extend(i,a);var S={handlerName:h,originalEvent:a.originalEvent||g};a.zoomDelta!==void 0&&(u.zoom=S),a.panDelta!==void 0&&(u.drag=S),a.pitchDelta!==void 0&&(u.pitch=S),a.bearingDelta!==void 0&&(u.rotate=S)}},On.prototype._applyChanges=function(){for(var i={},u={},a={},h=0,g=this._changes;h<g.length;h+=1){var S=g[h],T=S[0],R=S[1],G=S[2];T.panDelta&&(i.panDelta=(i.panDelta||new p.Point(0,0))._add(T.panDelta)),T.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+T.zoomDelta),T.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+T.bearingDelta),T.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+T.pitchDelta),T.around!==void 0&&(i.around=T.around),T.pinchAround!==void 0&&(i.pinchAround=T.pinchAround),T.noInertia&&(i.noInertia=T.noInertia),p.extend(u,R),p.extend(a,G)}this._updateMapTransform(i,u,a),this._changes=[]},On.prototype._updateMapTransform=function(i,u,a){var h=this._map,g=h.transform;if(!Un(i))return this._fireEvents(u,a,!0);var S=i.panDelta,T=i.zoomDelta,R=i.bearingDelta,G=i.pitchDelta,ee=i.around,ve=i.pinchAround;ve!==void 0&&(ee=ve),h._stop(!0),ee=ee||h.transform.centerPoint;var ye=g.pointLocation(S?ee.sub(S):ee);R&&(g.bearing+=R),G&&(g.pitch+=G),T&&(g.zoom+=T),g.setLocationAtPoint(ye,ee),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(u,a,!0)},On.prototype._fireEvents=function(i,u,a){var h=this,g=is(this._eventsInProgress),S=is(i),T={};for(var R in i)this._eventsInProgress[R]||(T[R+"start"]=i[R].originalEvent),this._eventsInProgress[R]=i[R];for(var G in!g&&S&&this._fireEvent("movestart",S.originalEvent),T)this._fireEvent(G,T[G]);for(var ee in S&&this._fireEvent("move",S.originalEvent),i)this._fireEvent(ee,i[ee].originalEvent);var ve,ye={};for(var we in this._eventsInProgress){var Ke=this._eventsInProgress[we],He=Ke.handlerName,at=Ke.originalEvent;this._handlersById[He].isActive()||(delete this._eventsInProgress[we],ye[we+"end"]=ve=u[He]||at)}for(var ze in ye)this._fireEvent(ze,ye[ze]);var it=is(this._eventsInProgress);if(a&&(g||S)&&!it){this._updatingCamera=!0;var mt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Ut=function(sr){return sr!==0&&-h._bearingSnap<sr&&sr<h._bearingSnap};mt?(Ut(mt.bearing||this._map.getBearing())&&(mt.bearing=0),this._map.easeTo(mt,{originalEvent:ve})):(this._map.fire(new p.Event("moveend",{originalEvent:ve})),Ut(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},On.prototype._fireEvent=function(i,u){this._map.fire(new p.Event(i,u?{originalEvent:u}:{}))},On.prototype._requestFrame=function(){var i=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(u){delete i._frameId,i.handleEvent(new zl("renderFrame",{timeStamp:u})),i._applyChanges()})},On.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Zl=function(i){function u(a,h){i.call(this),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=h.bearingSnap,p.bindAll(["_renderFrameCallback"],this)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getCenter=function(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)},u.prototype.setCenter=function(a,h){return this.jumpTo({center:a},h)},u.prototype.panBy=function(a,h,g){return a=p.Point.convert(a).mult(-1),this.panTo(this.transform.center,p.extend({offset:a},h),g)},u.prototype.panTo=function(a,h,g){return this.easeTo(p.extend({center:a},h),g)},u.prototype.getZoom=function(){return this.transform.zoom},u.prototype.setZoom=function(a,h){return this.jumpTo({zoom:a},h),this},u.prototype.zoomTo=function(a,h,g){return this.easeTo(p.extend({zoom:a},h),g)},u.prototype.zoomIn=function(a,h){return this.zoomTo(this.getZoom()+1,a,h),this},u.prototype.zoomOut=function(a,h){return this.zoomTo(this.getZoom()-1,a,h),this},u.prototype.getBearing=function(){return this.transform.bearing},u.prototype.setBearing=function(a,h){return this.jumpTo({bearing:a},h),this},u.prototype.getPadding=function(){return this.transform.padding},u.prototype.setPadding=function(a,h){return this.jumpTo({padding:a},h),this},u.prototype.rotateTo=function(a,h,g){return this.easeTo(p.extend({bearing:a},h),g)},u.prototype.resetNorth=function(a,h){return this.rotateTo(0,p.extend({duration:1e3},a),h),this},u.prototype.resetNorthPitch=function(a,h){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},a),h),this},u.prototype.snapToNorth=function(a,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,h):this},u.prototype.getPitch=function(){return this.transform.pitch},u.prototype.setPitch=function(a,h){return this.jumpTo({pitch:a},h),this},u.prototype.cameraForBounds=function(a,h){a=p.LngLatBounds.convert(a);var g=h&&h.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),g,h)},u.prototype._cameraForBoxAndBearing=function(a,h,g,S){var T={top:0,bottom:0,right:0,left:0};if(typeof(S=p.extend({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},S)).padding=="number"){var R=S.padding;S.padding={top:R,bottom:R,right:R,left:R}}S.padding=p.extend(T,S.padding);var G=this.transform,ee=G.padding,ve=G.project(p.LngLat.convert(a)),ye=G.project(p.LngLat.convert(h)),we=ve.rotate(-g*Math.PI/180),Ke=ye.rotate(-g*Math.PI/180),He=new p.Point(Math.max(we.x,Ke.x),Math.max(we.y,Ke.y)),at=new p.Point(Math.min(we.x,Ke.x),Math.min(we.y,Ke.y)),ze=He.sub(at),it=(G.width-(ee.left+ee.right+S.padding.left+S.padding.right))/ze.x,mt=(G.height-(ee.top+ee.bottom+S.padding.top+S.padding.bottom))/ze.y;if(!(mt<0||it<0)){var Ut=Math.min(G.scaleZoom(G.scale*Math.min(it,mt)),S.maxZoom),sr=typeof S.offset.x=="number"?new p.Point(S.offset.x,S.offset.y):p.Point.convert(S.offset),nr=new p.Point((S.padding.left-S.padding.right)/2,(S.padding.top-S.padding.bottom)/2).rotate(g*Math.PI/180),cr=sr.add(nr).mult(G.scale/G.zoomScale(Ut));return{center:G.unproject(ve.add(ye).div(2).sub(cr)),zoom:Ut,bearing:g}}p.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},u.prototype.fitBounds=function(a,h,g){return this._fitInternal(this.cameraForBounds(a,h),h,g)},u.prototype.fitScreenCoordinates=function(a,h,g,S,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(p.Point.convert(a)),this.transform.pointLocation(p.Point.convert(h)),g,S),S,T)},u.prototype._fitInternal=function(a,h,g){return a?(delete(h=p.extend(a,h)).padding,h.linear?this.easeTo(h,g):this.flyTo(h,g)):this},u.prototype.jumpTo=function(a,h){this.stop();var g=this.transform,S=!1,T=!1,R=!1;return"zoom"in a&&g.zoom!==+a.zoom&&(S=!0,g.zoom=+a.zoom),a.center!==void 0&&(g.center=p.LngLat.convert(a.center)),"bearing"in a&&g.bearing!==+a.bearing&&(T=!0,g.bearing=+a.bearing),"pitch"in a&&g.pitch!==+a.pitch&&(R=!0,g.pitch=+a.pitch),a.padding==null||g.isPaddingEqual(a.padding)||(g.padding=a.padding),this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h)),S&&this.fire(new p.Event("zoomstart",h)).fire(new p.Event("zoom",h)).fire(new p.Event("zoomend",h)),T&&this.fire(new p.Event("rotatestart",h)).fire(new p.Event("rotate",h)).fire(new p.Event("rotateend",h)),R&&this.fire(new p.Event("pitchstart",h)).fire(new p.Event("pitch",h)).fire(new p.Event("pitchend",h)),this.fire(new p.Event("moveend",h))},u.prototype.easeTo=function(a,h){var g=this;this._stop(!1,a.easeId),((a=p.extend({offset:[0,0],duration:500,easing:p.ease},a)).animate===!1||!a.essential&&p.browser.prefersReducedMotion)&&(a.duration=0);var S=this.transform,T=this.getZoom(),R=this.getBearing(),G=this.getPitch(),ee=this.getPadding(),ve="zoom"in a?+a.zoom:T,ye="bearing"in a?this._normalizeBearing(a.bearing,R):R,we="pitch"in a?+a.pitch:G,Ke="padding"in a?a.padding:S.padding,He=p.Point.convert(a.offset),at=S.centerPoint.add(He),ze=S.pointLocation(at),it=p.LngLat.convert(a.center||ze);this._normalizeCenter(it);var mt,Ut,sr=S.project(ze),nr=S.project(it).sub(sr),cr=S.zoomScale(ve-T);a.around&&(mt=p.LngLat.convert(a.around),Ut=S.locationPoint(mt));var Rr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ve!==T,this._rotating=this._rotating||R!==ye,this._pitching=this._pitching||we!==G,this._padding=!S.isPaddingEqual(Ke),this._easeId=a.easeId,this._prepareEase(h,a.noMoveStart,Rr),this._ease(function(tn){if(g._zooming&&(S.zoom=p.number(T,ve,tn)),g._rotating&&(S.bearing=p.number(R,ye,tn)),g._pitching&&(S.pitch=p.number(G,we,tn)),g._padding&&(S.interpolatePadding(ee,Ke,tn),at=S.centerPoint.add(He)),mt)S.setLocationAtPoint(mt,Ut);else{var Xr=S.zoomScale(S.zoom-T),yn=ve>T?Math.min(2,cr):Math.max(.5,cr),Fn=Math.pow(yn,1-tn),Vn=S.unproject(sr.add(nr.mult(tn*Fn)).mult(Xr));S.setLocationAtPoint(S.renderWorldCopies?Vn.wrap():Vn,at)}g._fireMoveEvents(h)},function(tn){g._afterEase(h,tn)},a),this},u.prototype._prepareEase=function(a,h,g){g===void 0&&(g={}),this._moving=!0,h||g.moving||this.fire(new p.Event("movestart",a)),this._zooming&&!g.zooming&&this.fire(new p.Event("zoomstart",a)),this._rotating&&!g.rotating&&this.fire(new p.Event("rotatestart",a)),this._pitching&&!g.pitching&&this.fire(new p.Event("pitchstart",a))},u.prototype._fireMoveEvents=function(a){this.fire(new p.Event("move",a)),this._zooming&&this.fire(new p.Event("zoom",a)),this._rotating&&this.fire(new p.Event("rotate",a)),this._pitching&&this.fire(new p.Event("pitch",a))},u.prototype._afterEase=function(a,h){if(!this._easeId||!h||this._easeId!==h){delete this._easeId;var g=this._zooming,S=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new p.Event("zoomend",a)),S&&this.fire(new p.Event("rotateend",a)),T&&this.fire(new p.Event("pitchend",a)),this.fire(new p.Event("moveend",a))}},u.prototype.flyTo=function(a,h){var g=this;if(!a.essential&&p.browser.prefersReducedMotion){var S=p.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(S,h)}this.stop(),a=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},a);var T=this.transform,R=this.getZoom(),G=this.getBearing(),ee=this.getPitch(),ve=this.getPadding(),ye="zoom"in a?p.clamp(+a.zoom,T.minZoom,T.maxZoom):R,we="bearing"in a?this._normalizeBearing(a.bearing,G):G,Ke="pitch"in a?+a.pitch:ee,He="padding"in a?a.padding:T.padding,at=T.zoomScale(ye-R),ze=p.Point.convert(a.offset),it=T.centerPoint.add(ze),mt=T.pointLocation(it),Ut=p.LngLat.convert(a.center||mt);this._normalizeCenter(Ut);var sr=T.project(mt),nr=T.project(Ut).sub(sr),cr=a.curve,Rr=Math.max(T.width,T.height),tn=Rr/at,Xr=nr.mag();if("minZoom"in a){var yn=p.clamp(Math.min(a.minZoom,R,ye),T.minZoom,T.maxZoom),Fn=Rr/T.zoomScale(yn-R);cr=Math.sqrt(Fn/Xr*2)}var Vn=cr*cr;function jn(ii){var ri=(tn*tn-Rr*Rr+(ii?-1:1)*Vn*Vn*Xr*Xr)/(2*(ii?tn:Rr)*Vn*Xr);return Math.log(Math.sqrt(ri*ri+1)-ri)}function Qi(ii){return(Math.exp(ii)-Math.exp(-ii))/2}function _n(ii){return(Math.exp(ii)+Math.exp(-ii))/2}var ci=jn(0),Ci=function(ii){return _n(ci)/_n(ci+cr*ii)},fi=function(ii){return Rr*((_n(ci)*(Qi(ri=ci+cr*ii)/_n(ri))-Qi(ci))/Vn)/Xr;var ri},oi=(jn(1)-ci)/cr;if(Math.abs(Xr)<1e-6||!isFinite(oi)){if(Math.abs(Rr-tn)<1e-6)return this.easeTo(a,h);var Ti=tn<Rr?-1:1;oi=Math.abs(Math.log(tn/Rr))/cr,fi=function(){return 0},Ci=function(ii){return Math.exp(Ti*cr*ii)}}return a.duration="duration"in a?+a.duration:1e3*oi/("screenSpeed"in a?+a.screenSpeed/cr:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0),this._zooming=!0,this._rotating=G!==we,this._pitching=Ke!==ee,this._padding=!T.isPaddingEqual(He),this._prepareEase(h,!1),this._ease(function(ii){var ri=ii*oi,Po=1/Ci(ri);T.zoom=ii===1?ye:R+T.scaleZoom(Po),g._rotating&&(T.bearing=p.number(G,we,ii)),g._pitching&&(T.pitch=p.number(ee,Ke,ii)),g._padding&&(T.interpolatePadding(ve,He,ii),it=T.centerPoint.add(ze));var Ja=ii===1?Ut:T.unproject(sr.add(nr.mult(fi(ri))).mult(Po));T.setLocationAtPoint(T.renderWorldCopies?Ja.wrap():Ja,it),g._fireMoveEvents(h)},function(){return g._afterEase(h)},a),this},u.prototype.isEasing=function(){return!!this._easeFrameId},u.prototype.stop=function(){return this._stop()},u.prototype._stop=function(a,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,h)}if(!a){var S=this.handlers;S&&S.stop(!1)}return this},u.prototype._ease=function(a,h,g){g.animate===!1||g.duration===0?(a(1),h()):(this._easeStart=p.browser.now(),this._easeOptions=g,this._onEaseFrame=a,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},u.prototype._renderFrameCallback=function(){var a=Math.min((p.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},u.prototype._normalizeBearing=function(a,h){a=p.wrap(a,-180,180);var g=Math.abs(a-h);return Math.abs(a-360-h)<g&&(a-=360),Math.abs(a+360-h)<g&&(a+=360),a},u.prototype._normalizeCenter=function(a){var h=this.transform;if(h.renderWorldCopies&&!h.lngRange){var g=a.lng-h.center.lng;a.lng+=g>180?-360:g<-180?360:0}},u}(p.Evented),ps=function(i){i===void 0&&(i={}),this.options=i,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};ps.prototype.getDefaultPosition=function(){return"bottom-right"},ps.prototype.onAdd=function(i){var u=this.options&&this.options.compact;return this._map=i,this._container=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=X.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=X.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ps.prototype.onRemove=function(){X.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},ps.prototype._setElementTitle=function(i,u){var a=this._map._getUIString("AttributionControl."+u);i.title=a,i.setAttribute("aria-label",a)},ps.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},ps.prototype._updateEditLink=function(){var i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));var u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(i){var a=u.reduce(function(h,g,S){return g.value&&(h+=g.key+"="+g.value+(S<u.length-1?"&":"")),h},"?");i.href=p.config.FEEDBACK_URL+"/"+a+(this._map._hash?this._map._hash.getHashString(!0):""),i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}},ps.prototype._updateData=function(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},ps.prototype._updateAttributions=function(){if(this._map.style){var i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(function(R){return typeof R!="string"?"":R})):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){var u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}var a=this._map.style.sourceCaches;for(var h in a){var g=a[h];if(g.used){var S=g.getSource();S.attribution&&i.indexOf(S.attribution)<0&&i.push(S.attribution)}}i.sort(function(R,G){return R.length-G.length});var T=(i=i.filter(function(R,G){for(var ee=G+1;ee<i.length;ee++)if(i[ee].indexOf(R)>=0)return!1;return!0})).join(" | ");T!==this._attribHTML&&(this._attribHTML=T,i.length?(this._innerContainer.innerHTML=T,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},ps.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Do=function(){p.bindAll(["_updateLogo"],this),p.bindAll(["_updateCompact"],this)};Do.prototype.onAdd=function(i){this._map=i,this._container=X.create("div","mapboxgl-ctrl");var u=X.create("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Do.prototype.onRemove=function(){X.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Do.prototype.getDefaultPosition=function(){return"bottom-left"},Do.prototype._updateLogo=function(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Do.prototype._logoRequired=function(){if(this._map.style){var i=this._map.style.sourceCaches;for(var u in i)if(i[u].getSource().mapbox_logo)return!0;return!1}},Do.prototype._updateCompact=function(){var i=this._container.children;if(i.length){var u=i[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}};var zo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};zo.prototype.add=function(i){var u=++this._id;return this._queue.push({callback:i,id:u,cancelled:!1}),u},zo.prototype.remove=function(i){for(var u=this._currentlyRunning,a=0,h=u?this._queue.concat(u):this._queue;a<h.length;a+=1){var g=h[a];if(g.id===i)return void(g.cancelled=!0)}},zo.prototype.run=function(i){i===void 0&&(i=0);var u=this._currentlyRunning=this._queue;this._queue=[];for(var a=0,h=u;a<h.length;a+=1){var g=h[a];if(!g.cancelled&&(g.callback(i),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},zo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var ku={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},hu=p.window.HTMLImageElement,Ul=p.window.HTMLElement,ra=p.window.ImageBitmap,po={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Uc=function(i){function u(h){var g=this;if((h=p.extend({},po,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var S=new Hi(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies);if(i.call(this,S,h),this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new zo,this._controls=[],this._mapId=p.uniqueId(),this._locale=p.extend({},ku,h.locale),this._clickTolerance=h.clickTolerance,this._requestManager=new p.RequestManager(h.transformRequest,h.accessToken),typeof h.container=="string"){if(this._container=p.window.document.getElementById(h.container),!this._container)throw new Error("Container '"+h.container+"' not found.")}else{if(!(h.container instanceof Ul))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return g._update(!1)}),this.on("moveend",function(){return g._update(!1)}),this.on("zoom",function(){return g._update(!0)}),p.window!==void 0&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new On(this,h),this._hash=h.hash&&new Us(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,p.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new ps({customAttribution:h.customAttribution})),this.addControl(new Do,h.logoPosition),this.on("style.load",function(){g.transform.unmodified&&g.jumpTo(g.style.stylesheet)}),this.on("data",function(T){g._update(T.dataType==="style"),g.fire(new p.Event(T.dataType+"data",T))}),this.on("dataloading",function(T){g.fire(new p.Event(T.dataType+"dataloading",T))})}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var a={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return u.prototype._getMapId=function(){return this._mapId},u.prototype.addControl=function(h,g){if(g===void 0&&(g=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var S=h.onAdd(this);this._controls.push(h);var T=this._controlPositions[g];return g.indexOf("bottom")!==-1?T.insertBefore(S,T.firstChild):T.appendChild(S),this},u.prototype.removeControl=function(h){if(!h||!h.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var g=this._controls.indexOf(h);return g>-1&&this._controls.splice(g,1),h.onRemove(this),this},u.prototype.hasControl=function(h){return this._controls.indexOf(h)>-1},u.prototype.resize=function(h){var g=this._containerDimensions(),S=g[0],T=g[1];this._resizeCanvas(S,T),this.transform.resize(S,T),this.painter.resize(S,T);var R=!this._moving;return R&&(this.stop(),this.fire(new p.Event("movestart",h)).fire(new p.Event("move",h))),this.fire(new p.Event("resize",h)),R&&this.fire(new p.Event("moveend",h)),this},u.prototype.getBounds=function(){return this.transform.getBounds()},u.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},u.prototype.setMaxBounds=function(h){return this.transform.setMaxBounds(p.LngLatBounds.convert(h)),this._update()},u.prototype.setMinZoom=function(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},u.prototype.getMinZoom=function(){return this.transform.minZoom},u.prototype.setMaxZoom=function(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")},u.prototype.getMaxZoom=function(){return this.transform.maxZoom},u.prototype.setMinPitch=function(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},u.prototype.getMinPitch=function(){return this.transform.minPitch},u.prototype.setMaxPitch=function(h){if((h=h==null?60:h)>60)throw new Error("maxPitch must be less than or equal to 60");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")},u.prototype.getMaxPitch=function(){return this.transform.maxPitch},u.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},u.prototype.setRenderWorldCopies=function(h){return this.transform.renderWorldCopies=h,this._update()},u.prototype.project=function(h){return this.transform.locationPoint(p.LngLat.convert(h))},u.prototype.unproject=function(h){return this.transform.pointLocation(p.Point.convert(h))},u.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},u.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},u.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},u.prototype._createDelegatedListener=function(h,g,S){var T,R=this;if(h==="mouseenter"||h==="mouseover"){var G=!1;return{layer:g,listener:S,delegates:{mousemove:function(ve){var ye=R.getLayer(g)?R.queryRenderedFeatures(ve.point,{layers:[g]}):[];ye.length?G||(G=!0,S.call(R,new ro(h,R,ve.originalEvent,{features:ye}))):G=!1},mouseout:function(){G=!1}}}}if(h==="mouseleave"||h==="mouseout"){var ee=!1;return{layer:g,listener:S,delegates:{mousemove:function(ve){(R.getLayer(g)?R.queryRenderedFeatures(ve.point,{layers:[g]}):[]).length?ee=!0:ee&&(ee=!1,S.call(R,new ro(h,R,ve.originalEvent)))},mouseout:function(ve){ee&&(ee=!1,S.call(R,new ro(h,R,ve.originalEvent)))}}}}return{layer:g,listener:S,delegates:(T={},T[h]=function(ve){var ye=R.getLayer(g)?R.queryRenderedFeatures(ve.point,{layers:[g]}):[];ye.length&&(ve.features=ye,S.call(R,ve),delete ve.features)},T)}},u.prototype.on=function(h,g,S){if(S===void 0)return i.prototype.on.call(this,h,g);var T=this._createDelegatedListener(h,g,S);for(var R in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(T),T.delegates)this.on(R,T.delegates[R]);return this},u.prototype.once=function(h,g,S){if(S===void 0)return i.prototype.once.call(this,h,g);var T=this._createDelegatedListener(h,g,S);for(var R in T.delegates)this.once(R,T.delegates[R]);return this},u.prototype.off=function(h,g,S){var T=this;return S===void 0?i.prototype.off.call(this,h,g):(this._delegatedListeners&&this._delegatedListeners[h]&&function(R){for(var G=R[h],ee=0;ee<G.length;ee++){var ve=G[ee];if(ve.layer===g&&ve.listener===S){for(var ye in ve.delegates)T.off(ye,ve.delegates[ye]);return G.splice(ee,1),T}}}(this._delegatedListeners),this)},u.prototype.queryRenderedFeatures=function(h,g){if(!this.style)return[];var S;if(g!==void 0||h===void 0||h instanceof p.Point||Array.isArray(h)||(g=h,h=void 0),g=g||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof p.Point||typeof h[0]=="number")S=[p.Point.convert(h)];else{var T=p.Point.convert(h[0]),R=p.Point.convert(h[1]);S=[T,new p.Point(R.x,T.y),R,new p.Point(T.x,R.y),T]}return this.style.queryRenderedFeatures(S,g,this.transform)},u.prototype.querySourceFeatures=function(h,g){return this.style.querySourceFeatures(h,g)},u.prototype.setStyle=function(h,g){return(g=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},g)).diff!==!1&&g.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,g),this):(this._localIdeographFontFamily=g.localIdeographFontFamily,this._updateStyle(h,g))},u.prototype._getUIString=function(h){var g=this._locale[h];if(g==null)throw new Error("Missing UI string '"+h+"'");return g},u.prototype._updateStyle=function(h,g){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new ti(this,g||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)},u.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new ti(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},u.prototype._diffStyle=function(h,g){var S=this;if(typeof h=="string"){var T=this._requestManager.normalizeStyleURL(h),R=this._requestManager.transformRequest(T,p.ResourceType.Style);p.getJSON(R,function(G,ee){G?S.fire(new p.ErrorEvent(G)):ee&&S._updateDiff(ee,g)})}else typeof h=="object"&&this._updateDiff(h,g)},u.prototype._updateDiff=function(h,g){try{this.style.setState(h)&&this._update(!0)}catch(S){p.warnOnce("Unable to perform style diff: "+(S.message||S.error||S)+".  Rebuilding the style from scratch."),this._updateStyle(h,g)}},u.prototype.getStyle=function(){if(this.style)return this.style.serialize()},u.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():p.warnOnce("There is no style added to the map.")},u.prototype.addSource=function(h,g){return this._lazyInitEmptyStyle(),this.style.addSource(h,g),this._update(!0)},u.prototype.isSourceLoaded=function(h){var g=this.style&&this.style.sourceCaches[h];if(g!==void 0)return g.loaded();this.fire(new p.ErrorEvent(new Error("There is no source with ID '"+h+"'")))},u.prototype.areTilesLoaded=function(){var h=this.style&&this.style.sourceCaches;for(var g in h){var S=h[g]._tiles;for(var T in S){var R=S[T];if(R.state!=="loaded"&&R.state!=="errored")return!1}}return!0},u.prototype.addSourceType=function(h,g,S){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,g,S)},u.prototype.removeSource=function(h){return this.style.removeSource(h),this._update(!0)},u.prototype.getSource=function(h){return this.style.getSource(h)},u.prototype.addImage=function(h,g,S){S===void 0&&(S={});var T=S.pixelRatio;T===void 0&&(T=1);var R=S.sdf;R===void 0&&(R=!1);var G=S.stretchX,ee=S.stretchY,ve=S.content;if(this._lazyInitEmptyStyle(),g instanceof hu||ra&&g instanceof ra){var ye=p.browser.getImageData(g);this.style.addImage(h,{data:new p.RGBAImage({width:ye.width,height:ye.height},ye.data),pixelRatio:T,stretchX:G,stretchY:ee,content:ve,sdf:R,version:0})}else{if(g.width===void 0||g.height===void 0)return this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var we=g;this.style.addImage(h,{data:new p.RGBAImage({width:g.width,height:g.height},new Uint8Array(g.data)),pixelRatio:T,stretchX:G,stretchY:ee,content:ve,sdf:R,version:0,userImage:we}),we.onAdd&&we.onAdd(this,h)}},u.prototype.updateImage=function(h,g){var S=this.style.getImage(h);if(!S)return this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var T=g instanceof hu||ra&&g instanceof ra?p.browser.getImageData(g):g,R=T.width,G=T.height,ee=T.data;return R===void 0||G===void 0?this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):R!==S.data.width||G!==S.data.height?this.fire(new p.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(S.data.replace(ee,!(g instanceof hu||ra&&g instanceof ra)),void this.style.updateImage(h,S))},u.prototype.hasImage=function(h){return h?!!this.style.getImage(h):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)},u.prototype.removeImage=function(h){this.style.removeImage(h)},u.prototype.loadImage=function(h,g){p.getImage(this._requestManager.transformRequest(h,p.ResourceType.Image),g)},u.prototype.listImages=function(){return this.style.listImages()},u.prototype.addLayer=function(h,g){return this._lazyInitEmptyStyle(),this.style.addLayer(h,g),this._update(!0)},u.prototype.moveLayer=function(h,g){return this.style.moveLayer(h,g),this._update(!0)},u.prototype.removeLayer=function(h){return this.style.removeLayer(h),this._update(!0)},u.prototype.getLayer=function(h){return this.style.getLayer(h)},u.prototype.setLayerZoomRange=function(h,g,S){return this.style.setLayerZoomRange(h,g,S),this._update(!0)},u.prototype.setFilter=function(h,g,S){return S===void 0&&(S={}),this.style.setFilter(h,g,S),this._update(!0)},u.prototype.getFilter=function(h){return this.style.getFilter(h)},u.prototype.setPaintProperty=function(h,g,S,T){return T===void 0&&(T={}),this.style.setPaintProperty(h,g,S,T),this._update(!0)},u.prototype.getPaintProperty=function(h,g){return this.style.getPaintProperty(h,g)},u.prototype.setLayoutProperty=function(h,g,S,T){return T===void 0&&(T={}),this.style.setLayoutProperty(h,g,S,T),this._update(!0)},u.prototype.getLayoutProperty=function(h,g){return this.style.getLayoutProperty(h,g)},u.prototype.setLight=function(h,g){return g===void 0&&(g={}),this._lazyInitEmptyStyle(),this.style.setLight(h,g),this._update(!0)},u.prototype.getLight=function(){return this.style.getLight()},u.prototype.setFeatureState=function(h,g){return this.style.setFeatureState(h,g),this._update()},u.prototype.removeFeatureState=function(h,g){return this.style.removeFeatureState(h,g),this._update()},u.prototype.getFeatureState=function(h){return this.style.getFeatureState(h)},u.prototype.getContainer=function(){return this._container},u.prototype.getCanvasContainer=function(){return this._canvasContainer},u.prototype.getCanvas=function(){return this._canvas},u.prototype._containerDimensions=function(){var h=0,g=0;return this._container&&(h=this._container.clientWidth||400,g=this._container.clientHeight||300),[h,g]},u.prototype._detectMissingCSS=function(){p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},u.prototype._setupContainer=function(){var h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=X.create("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();var g=this._canvasContainer=X.create("div","mapboxgl-canvas-container",h);this._interactive&&g.classList.add("mapboxgl-interactive"),this._canvas=X.create("canvas","mapboxgl-canvas",g),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var S=this._containerDimensions();this._resizeCanvas(S[0],S[1]);var T=this._controlContainer=X.create("div","mapboxgl-control-container",h),R=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(G){R[G]=X.create("div","mapboxgl-ctrl-"+G,T)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},u.prototype._resizeCanvas=function(h,g){var S=p.browser.devicePixelRatio||1;this._canvas.width=S*h,this._canvas.height=S*g,this._canvas.style.width=h+"px",this._canvas.style.height=g+"px"},u.prototype._setupPainter=function(){var h=p.extend({},b.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),g=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);g?(this.painter=new Pa(g,this.transform),p.webpSupported.testSupport(g)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))},u.prototype._contextLost=function(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:h}))},u.prototype._contextRestored=function(h){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:h}))},u.prototype._onMapScroll=function(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},u.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},u.prototype._update=function(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this},u.prototype._requestRenderFrame=function(h){return this._update(),this._renderTaskQueue.add(h)},u.prototype._cancelRenderFrame=function(h){this._renderTaskQueue.remove(h)},u.prototype._render=function(h){var g,S=this,T=0,R=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(g=R.createQueryEXT(),R.beginQueryEXT(R.TIME_ELAPSED_EXT,g),T=p.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),!this._removed){var G=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var ee=this.transform.zoom,ve=p.browser.now();this.style.zoomHistory.update(ee,ve);var ye=new p.EvaluationParameters(ee,{now:ve,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),we=ye.crossFadingFactor();we===1&&we===this._crossFadingFactor||(G=!0,this._crossFadingFactor=we),this.style.update(ye)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&(this.style.hasTransitions()||G)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Ke=p.browser.now()-T;R.endQueryEXT(R.TIME_ELAPSED_EXT,g),setTimeout(function(){var ze=R.getQueryObjectEXT(g,R.QUERY_RESULT_EXT)/1e6;R.deleteQueryEXT(g),S.fire(new p.Event("gpu-timing-frame",{cpuTime:Ke,gpuTime:ze}))},50)}if(this.listens("gpu-timing-layer")){var He=this.painter.collectGpuTimers();setTimeout(function(){var ze=S.painter.queryGpuTimers(He);S.fire(new p.Event("gpu-timing-layer",{layerTimes:ze}))},50)}var at=this._sourcesDirty||this._styleDirty||this._placementDirty;return at||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new p.Event("idle")),!this._loaded||this._fullyLoaded||at||(this._fullyLoaded=!0),this}},u.prototype.remove=function(){this._hash&&this._hash.remove();for(var h=0,g=this._controls;h<g.length;h+=1)g[h].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),p.window!==void 0&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1));var S=this.painter.context.gl.getExtension("WEBGL_lose_context");S&&S.loseContext(),Fu(this._canvasContainer),Fu(this._controlContainer),Fu(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new p.Event("remove"))},u.prototype.triggerRepaint=function(){var h=this;this.style&&!this._frame&&(this._frame=p.browser.frame(function(g){h._frame=null,h._render(g)}))},u.prototype._onWindowOnline=function(){this._update()},u.prototype._onWindowResize=function(h){this._trackResize&&this.resize({originalEvent:h})._update()},a.showTileBoundaries.get=function(){return!!this._showTileBoundaries},a.showTileBoundaries.set=function(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())},a.showPadding.get=function(){return!!this._showPadding},a.showPadding.set=function(h){this._showPadding!==h&&(this._showPadding=h,this._update())},a.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},a.showCollisionBoxes.set=function(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())},a.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},a.showOverdrawInspector.set=function(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())},a.repaint.get=function(){return!!this._repaint},a.repaint.set=function(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())},a.vertices.get=function(){return!!this._vertices},a.vertices.set=function(h){this._vertices=h,this._update()},u.prototype._setCacheLimits=function(h,g){p.setCacheLimits(h,g)},a.version.get=function(){return p.version},Object.defineProperties(u.prototype,a),u}(Zl);function Fu(i){i.parentNode&&i.parentNode.removeChild(i)}var _c={showCompass:!0,showZoom:!0,visualizePitch:!1},Bu=function(i){var u=this;this.options=p.extend({},_c,i),this._container=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(a){return a.preventDefault()}),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(a){return u._map.zoomIn({},{originalEvent:a})}),X.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(a){return u._map.zoomOut({},{originalEvent:a})}),X.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(a){u.options.visualizePitch?u._map.resetNorthPitch({},{originalEvent:a}):u._map.resetNorth({},{originalEvent:a})}),this._compassIcon=X.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Bu.prototype._updateZoomButtons=function(){var i=this._map.getZoom(),u=i===this._map.getMaxZoom(),a=i===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},Bu.prototype._rotateCompassArrow=function(){var i=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=i},Bu.prototype.onAdd=function(i){return this._map=i,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Os(this._map,this._compass,this.options.visualizePitch)),this._container},Bu.prototype.onRemove=function(){X.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Bu.prototype._createButton=function(i,u){var a=X.create("button",i,this._container);return a.type="button",a.addEventListener("click",u),a},Bu.prototype._setButtonTitle=function(i,u){var a=this._map._getUIString("NavigationControl."+u);i.title=a,i.setAttribute("aria-label",a)};var Os=function(i,u,a){a===void 0&&(a=!1),this._clickTolerance=10,this.element=u,this.mouseRotate=new gc({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,a&&(this.mousePitch=new Ju({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),X.addEventListener(u,"mousedown",this.mousedown),X.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),X.addEventListener(u,"touchmove",this.touchmove),X.addEventListener(u,"touchend",this.touchend),X.addEventListener(u,"touchcancel",this.reset)};function oc(i,u,a){if(i=new p.LngLat(i.lng,i.lat),u){var h=new p.LngLat(i.lng-360,i.lat),g=new p.LngLat(i.lng+360,i.lat),S=a.locationPoint(i).distSqr(u);a.locationPoint(h).distSqr(u)<S?i=h:a.locationPoint(g).distSqr(u)<S&&(i=g)}for(;Math.abs(i.lng-a.center.lng)>180;){var T=a.locationPoint(i);if(T.x>=0&&T.y>=0&&T.x<=a.width&&T.y<=a.height)break;i.lng>a.center.lng?i.lng-=360:i.lng+=360}return i}Os.prototype.down=function(i,u){this.mouseRotate.mousedown(i,u),this.mousePitch&&this.mousePitch.mousedown(i,u),X.disableDrag()},Os.prototype.move=function(i,u){var a=this.map,h=this.mouseRotate.mousemoveWindow(i,u);if(h&&h.bearingDelta&&a.setBearing(a.getBearing()+h.bearingDelta),this.mousePitch){var g=this.mousePitch.mousemoveWindow(i,u);g&&g.pitchDelta&&a.setPitch(a.getPitch()+g.pitchDelta)}},Os.prototype.off=function(){var i=this.element;X.removeEventListener(i,"mousedown",this.mousedown),X.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),X.removeEventListener(i,"touchmove",this.touchmove),X.removeEventListener(i,"touchend",this.touchend),X.removeEventListener(i,"touchcancel",this.reset),this.offTemp()},Os.prototype.offTemp=function(){X.enableDrag(),X.removeEventListener(p.window,"mousemove",this.mousemove),X.removeEventListener(p.window,"mouseup",this.mouseup)},Os.prototype.mousedown=function(i){this.down(p.extend({},i,{ctrlKey:!0,preventDefault:function(){return i.preventDefault()}}),X.mousePos(this.element,i)),X.addEventListener(p.window,"mousemove",this.mousemove),X.addEventListener(p.window,"mouseup",this.mouseup)},Os.prototype.mousemove=function(i){this.move(i,X.mousePos(this.element,i))},Os.prototype.mouseup=function(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()},Os.prototype.touchstart=function(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=X.touchPos(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return i.preventDefault()}},this._startPos))},Os.prototype.touchmove=function(i){i.targetTouches.length!==1?this.reset():(this._lastPos=X.touchPos(this.element,i.targetTouches)[0],this.move({preventDefault:function(){return i.preventDefault()}},this._lastPos))},Os.prototype.touchend=function(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Os.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var as={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function xc(i,u,a){var h=i.classList;for(var g in as)h.remove("mapboxgl-"+a+"-anchor-"+g);h.add("mapboxgl-"+a+"-anchor-"+u)}var jl,sc=function(i){function u(a,h){if(i.call(this),(a instanceof p.window.HTMLElement||h)&&(a=p.extend({element:a},h)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment!=="auto"?a.pitchAlignment:this._rotationAlignment,a&&a.element)this._element=a.element,this._offset=p.Point.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=X.create("div"),this._element.setAttribute("aria-label","Map marker");var g=X.createNS("http://www.w3.org/2000/svg","svg");g.setAttributeNS(null,"display","block"),g.setAttributeNS(null,"height","41px"),g.setAttributeNS(null,"width","27px"),g.setAttributeNS(null,"viewBox","0 0 27 41");var S=X.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");var T=X.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");var R=X.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");for(var G=0,ee=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];G<ee.length;G+=1){var ve=ee[G],ye=X.createNS("http://www.w3.org/2000/svg","ellipse");ye.setAttributeNS(null,"opacity","0.04"),ye.setAttributeNS(null,"cx","10.5"),ye.setAttributeNS(null,"cy","5.80029008"),ye.setAttributeNS(null,"rx",ve.rx),ye.setAttributeNS(null,"ry",ve.ry),R.appendChild(ye)}var we=X.createNS("http://www.w3.org/2000/svg","g");we.setAttributeNS(null,"fill",this._color);var Ke=X.createNS("http://www.w3.org/2000/svg","path");Ke.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),we.appendChild(Ke);var He=X.createNS("http://www.w3.org/2000/svg","g");He.setAttributeNS(null,"opacity","0.25"),He.setAttributeNS(null,"fill","#000000");var at=X.createNS("http://www.w3.org/2000/svg","path");at.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),He.appendChild(at);var ze=X.createNS("http://www.w3.org/2000/svg","g");ze.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ze.setAttributeNS(null,"fill","#FFFFFF");var it=X.createNS("http://www.w3.org/2000/svg","g");it.setAttributeNS(null,"transform","translate(8.0, 8.0)");var mt=X.createNS("http://www.w3.org/2000/svg","circle");mt.setAttributeNS(null,"fill","#000000"),mt.setAttributeNS(null,"opacity","0.25"),mt.setAttributeNS(null,"cx","5.5"),mt.setAttributeNS(null,"cy","5.5"),mt.setAttributeNS(null,"r","5.4999962");var Ut=X.createNS("http://www.w3.org/2000/svg","circle");Ut.setAttributeNS(null,"fill","#FFFFFF"),Ut.setAttributeNS(null,"cx","5.5"),Ut.setAttributeNS(null,"cy","5.5"),Ut.setAttributeNS(null,"r","5.4999962"),it.appendChild(mt),it.appendChild(Ut),T.appendChild(R),T.appendChild(we),T.appendChild(He),T.appendChild(ze),T.appendChild(it),g.appendChild(T),g.setAttributeNS(null,"height",41*this._scale+"px"),g.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(g),this._offset=p.Point.convert(a&&a.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(sr){sr.preventDefault()}),this._element.addEventListener("mousedown",function(sr){sr.preventDefault()}),xc(this._element,this._anchor,"marker"),this._popup=null}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.addTo=function(a){return this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._update),a.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},u.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),X.remove(this._element),this._popup&&this._popup.remove(),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(a){return this._lngLat=p.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},u.prototype.getElement=function(){return this._element},u.prototype.setPopup=function(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){var h=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(24.6+h)],"bottom-right":[-h,-1*(24.6+h)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=a,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},u.prototype._onKeyPress=function(a){var h=a.code,g=a.charCode||a.keyCode;h!=="Space"&&h!=="Enter"&&g!==32&&g!==13||this.togglePopup()},u.prototype._onMapClick=function(a){var h=a.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()},u.prototype.getPopup=function(){return this._popup},u.prototype.togglePopup=function(){var a=this._popup;return a?(a.isOpen()?a.remove():a.addTo(this._map),this):this},u.prototype._update=function(a){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=oc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(h="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g="rotateX("+this._map.getPitch()+"deg)"),a&&a.type!=="moveend"||(this._pos=this._pos.round()),X.setTransform(this._element,as[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+g+" "+h)}},u.prototype.getOffset=function(){return this._offset},u.prototype.setOffset=function(a){return this._offset=p.Point.convert(a),this._update(),this},u.prototype._onMove=function(a){if(!this._isDragging){var h=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag")))},u.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new p.Event("dragend")),this._state="inactive"},u.prototype._addDragHandler=function(a){this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},u.prototype.setDraggable=function(a){return this._draggable=!!a,this._map&&(a?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},u.prototype.isDraggable=function(){return this._draggable},u.prototype.setRotation=function(a){return this._rotation=a||0,this._update(),this},u.prototype.getRotation=function(){return this._rotation},u.prototype.setRotationAlignment=function(a){return this._rotationAlignment=a||"auto",this._update(),this},u.prototype.getRotationAlignment=function(){return this._rotationAlignment},u.prototype.setPitchAlignment=function(a){return this._pitchAlignment=a&&a!=="auto"?a:this._rotationAlignment,this._update(),this},u.prototype.getPitchAlignment=function(){return this._pitchAlignment},u}(p.Evented),jc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},uc=0,ml=!1,Vc=function(i){function u(a){i.call(this),this.options=p.extend({},jc,a),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.onAdd=function(a){var h;return this._map=a,this._container=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),h=this._setupUI,jl!==void 0?h(jl):p.window.navigator.permissions!==void 0?p.window.navigator.permissions.query({name:"geolocation"}).then(function(g){h(jl=g.state!=="denied")}):h(jl=!!p.window.navigator.geolocation),this._container},u.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),X.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,uc=0,ml=!1},u.prototype._isOutOfMapMaxBounds=function(a){var h=this._map.getMaxBounds(),g=a.coords;return h&&(g.longitude<h.getWest()||g.longitude>h.getEast()||g.latitude<h.getSouth()||g.latitude>h.getNorth())},u.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},u.prototype._onSuccess=function(a){if(this._map){if(this._isOutOfMapMaxBounds(a))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",a)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=a,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(a),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(a),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",a)),this._finish()}},u.prototype._updateCamera=function(a){var h=new p.LngLat(a.coords.longitude,a.coords.latitude),g=a.coords.accuracy,S=this._map.getBearing(),T=p.extend({bearing:S},this.options.fitBoundsOptions);this._map.fitBounds(h.toBounds(g),T,{geolocateSource:!0})},u.prototype._updateMarker=function(a){if(a){var h=new p.LngLat(a.coords.longitude,a.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=a.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},u.prototype._updateCircleRadius=function(){var a=this._map._container.clientHeight/2,h=this._map.unproject([0,a]),g=this._map.unproject([1,a]),S=h.distanceTo(g),T=Math.ceil(2*this._accuracy/S);this._circleElement.style.width=T+"px",this._circleElement.style.height=T+"px"},u.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},u.prototype._onError=function(a){if(this._map){if(this.options.trackUserLocation)if(a.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(a.code===3&&ml)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",a)),this._finish()}},u.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},u.prototype._setupUI=function(a){var h=this;if(this._container.addEventListener("contextmenu",function(T){return T.preventDefault()}),this._geolocateButton=X.create("button","mapboxgl-ctrl-geolocate",this._container),X.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",a===!1){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g)}else{var S=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=X.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new sc(this._dotElement),this._circleElement=X.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new sc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(T){T.geolocateSource||h._watchState!=="ACTIVE_LOCK"||T.originalEvent&&T.originalEvent.type==="resize"||(h._watchState="BACKGROUND",h._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),h._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),h.fire(new p.Event("trackuserlocationend")))})},u.prototype.trigger=function(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":uc--,ml=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var a;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++uc>1?(a={maximumAge:6e5,timeout:0},ml=!0):(a=this.options.positionOptions,ml=!1),this._geolocationWatchID=p.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,a)}}else p.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},u.prototype._clearWatch=function(){p.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},u}(p.Evented),gl={maxWidth:100,unit:"metric"},yl=function(i){this.options=p.extend({},gl,i),p.bindAll(["_onMove","setUnit"],this)};function _l(i,u,a){var h=a&&a.maxWidth||100,g=i._container.clientHeight/2,S=i.unproject([0,g]),T=i.unproject([h,g]),R=S.distanceTo(T);if(a&&a.unit==="imperial"){var G=3.2808*R;G>5280?pu(u,h,G/5280,i._getUIString("ScaleControl.Miles")):pu(u,h,G,i._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?pu(u,h,R/1852,i._getUIString("ScaleControl.NauticalMiles")):R>=1e3?pu(u,h,R/1e3,i._getUIString("ScaleControl.Kilometers")):pu(u,h,R,i._getUIString("ScaleControl.Meters"))}function pu(i,u,a,h){var g,S,T,R=(g=a,(S=Math.pow(10,(""+Math.floor(g)).length-1))*(T=(T=g/S)>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(G){var ee=Math.pow(10,Math.ceil(-Math.log(G)/Math.LN10));return Math.round(G*ee)/ee}(T)));i.style.width=u*(R/a)+"px",i.innerHTML=R+"&nbsp;"+h}yl.prototype.getDefaultPosition=function(){return"bottom-left"},yl.prototype._onMove=function(){_l(this._map,this._container,this.options)},yl.prototype.onAdd=function(i){return this._map=i,this._container=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",i.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},yl.prototype.onRemove=function(){X.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},yl.prototype.setUnit=function(i){this.options.unit=i,_l(this._map,this._container,this.options)};var qs=function(i){this._fullscreen=!1,i&&i.container&&(i.container instanceof p.window.HTMLElement?this._container=i.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in p.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in p.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in p.window.document&&(this._fullscreenchange="MSFullscreenChange")};qs.prototype.onAdd=function(i){return this._map=i,this._container||(this._container=this._map.getContainer()),this._controlContainer=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},qs.prototype.onRemove=function(){X.remove(this._controlContainer),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},qs.prototype._checkFullscreenSupport=function(){return!!(p.window.document.fullscreenEnabled||p.window.document.mozFullScreenEnabled||p.window.document.msFullscreenEnabled||p.window.document.webkitFullscreenEnabled)},qs.prototype._setupUI=function(){var i=this._fullscreenButton=X.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);X.create("span","mapboxgl-ctrl-icon",i).setAttribute("aria-hidden",!0),i.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},qs.prototype._updateTitle=function(){var i=this._getTitle();this._fullscreenButton.setAttribute("aria-label",i),this._fullscreenButton.title=i},qs.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},qs.prototype._isFullscreen=function(){return this._fullscreen},qs.prototype._changeIcon=function(){(p.window.document.fullscreenElement||p.window.document.mozFullScreenElement||p.window.document.webkitFullscreenElement||p.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},qs.prototype._onClickFullscreen=function(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.mozCancelFullScreen?p.window.document.mozCancelFullScreen():p.window.document.msExitFullscreen?p.window.document.msExitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Gc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},bc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),sf=function(i){function u(a){i.call(this),this.options=p.extend(Object.create(Gc),a),p.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.addTo=function(a){return this._map&&this.remove(),this._map=a,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new p.Event("open")),this},u.prototype.isOpen=function(){return!!this._map},u.prototype.remove=function(){return this._content&&X.remove(this._content),this._container&&(X.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new p.Event("close")),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(a){return this._lngLat=p.LngLat.convert(a),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},u.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},u.prototype.getElement=function(){return this._container},u.prototype.setText=function(a){return this.setDOMContent(p.window.document.createTextNode(a))},u.prototype.setHTML=function(a){var h,g=p.window.document.createDocumentFragment(),S=p.window.document.createElement("body");for(S.innerHTML=a;h=S.firstChild;)g.appendChild(h);return this.setDOMContent(g)},u.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},u.prototype.setMaxWidth=function(a){return this.options.maxWidth=a,this._update(),this},u.prototype.setDOMContent=function(a){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=X.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(a),this._createCloseButton(),this._update(),this._focusFirstElement(),this},u.prototype.addClassName=function(a){this._container&&this._container.classList.add(a)},u.prototype.removeClassName=function(a){this._container&&this._container.classList.remove(a)},u.prototype.setOffset=function(a){return this.options.offset=a,this._update(),this},u.prototype.toggleClassName=function(a){if(this._container)return this._container.classList.toggle(a)},u.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=X.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},u.prototype._onMouseUp=function(a){this._update(a.point)},u.prototype._onMouseMove=function(a){this._update(a.point)},u.prototype._onDrag=function(a){this._update(a.point)},u.prototype._update=function(a){var h=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=X.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=X.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(ye){return h._container.classList.add(ye)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=oc(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||a)){var g=this._pos=this._trackPointer&&a?a:this._map.project(this._lngLat),S=this.options.anchor,T=function ye(we){if(we){if(typeof we=="number"){var Ke=Math.round(Math.sqrt(.5*Math.pow(we,2)));return{center:new p.Point(0,0),top:new p.Point(0,we),"top-left":new p.Point(Ke,Ke),"top-right":new p.Point(-Ke,Ke),bottom:new p.Point(0,-we),"bottom-left":new p.Point(Ke,-Ke),"bottom-right":new p.Point(-Ke,-Ke),left:new p.Point(we,0),right:new p.Point(-we,0)}}if(we instanceof p.Point||Array.isArray(we)){var He=p.Point.convert(we);return{center:He,top:He,"top-left":He,"top-right":He,bottom:He,"bottom-left":He,"bottom-right":He,left:He,right:He}}return{center:p.Point.convert(we.center||[0,0]),top:p.Point.convert(we.top||[0,0]),"top-left":p.Point.convert(we["top-left"]||[0,0]),"top-right":p.Point.convert(we["top-right"]||[0,0]),bottom:p.Point.convert(we.bottom||[0,0]),"bottom-left":p.Point.convert(we["bottom-left"]||[0,0]),"bottom-right":p.Point.convert(we["bottom-right"]||[0,0]),left:p.Point.convert(we.left||[0,0]),right:p.Point.convert(we.right||[0,0])}}return ye(new p.Point(0,0))}(this.options.offset);if(!S){var R,G=this._container.offsetWidth,ee=this._container.offsetHeight;R=g.y+T.bottom.y<ee?["top"]:g.y>this._map.transform.height-ee?["bottom"]:[],g.x<G/2?R.push("left"):g.x>this._map.transform.width-G/2&&R.push("right"),S=R.length===0?"bottom":R.join("-")}var ve=g.add(T[S]).round();X.setTransform(this._container,as[S]+" translate("+ve.x+"px,"+ve.y+"px)"),xc(this._container,S,"popup")}},u.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var a=this._container.querySelector(bc);a&&a.focus()}},u.prototype._onClose=function(){this.remove()},u}(p.Evented),Sc={version:p.version,supported:b,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:Uc,NavigationControl:Bu,GeolocateControl:Vc,AttributionControl:ps,ScaleControl:yl,FullscreenControl:qs,Popup:sf,Marker:sc,Style:ti,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,Evented:p.Evented,config:p.config,prewarm:function(){gr().acquire(Nt)},clearPrewarmedResources:function(){var i=bn;i&&(i.isPreloaded()&&i.numActive()===1?(i.release(Nt),bn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(i){p.config.ACCESS_TOKEN=i},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(i){p.config.API_URL=i},get workerCount(){return Fr.workerCount},set workerCount(i){Fr.workerCount=i},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(i){p.config.MAX_PARALLEL_IMAGE_REQUESTS=i},clearStorage:function(i){p.clearTileCache(i)},workerUrl:""};return Sc}),Q})},86387:function(ar,O,_){"use strict";Object.defineProperty(O,"__esModule",{value:!0}),O.default=function(Ht){return(0,E.default)((0,I.default)(Ht)&&Ht.length>=1,"Must merge at least 1 JSON schema."),b.default.apply(void 0,[{}].concat(Vt(Ht),[function(At,Ot,bt){if(!(0,W.default)(At)){if(bt==="required")return(0,Ce.default)(At.concat(Ot));if((0,We.default)(At)){if(!(0,We.default)(Ot))throw new Error('Failed to merge schemas because "'+bt+'" has different values.');return}E.default.deepEqual(At,Ot,'Failed to merge schemas because "'+bt+'" has different values: '+JSON.stringify(At)+" and "+JSON.stringify(Ot)+".")}}]))};var Q=_(48583),E=$e(Q),p=_(38554),b=$e(p),X=_(59722),W=$e(X),$=_(53778),I=$e($),k=_(97644),Ce=$e(k),Be=_(8146),We=$e(Be);function $e(Ht){return Ht&&Ht.__esModule?Ht:{default:Ht}}function Vt(Ht){if(Array.isArray(Ht)){for(var At=0,Ot=Array(Ht.length);At<Ht.length;At++)Ot[At]=Ht[At];return Ot}else return Array.from(Ht)}ar.exports=O.default},28660:function(ar,O,_){var Q=_(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var E;(function(p){(function(b){var X=typeof _.g=="object"?_.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),W=$(p);typeof X.Reflect=="undefined"?X.Reflect=p:W=$(X.Reflect,W),b(W);function $(I,k){return function(Ce,Be){typeof I[Ce]!="function"&&Object.defineProperty(I,Ce,{configurable:!0,writable:!0,value:Be}),k&&k(Ce,Be)}}})(function(b){var X=Object.prototype.hasOwnProperty,W=typeof Symbol=="function",$=W&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",I=W&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",k=typeof Object.create=="function",Ce={__proto__:[]}instanceof Array,Be=!k&&!Ce,We={create:k?function(){return Ar(Object.create(null))}:Ce?function(){return Ar({__proto__:null})}:function(){return Ar({})},has:Be?function(Je,xt){return X.call(Je,xt)}:function(Je,xt){return xt in Je},get:Be?function(Je,xt){return X.call(Je,xt)?Je[xt]:void 0}:function(Je,xt){return Je[xt]}},$e=Object.getPrototypeOf(Function),Vt=typeof Q=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Ht=!Vt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:fr(),At=!Vt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Cr(),Ot=!Vt&&typeof WeakMap=="function"?WeakMap:Tr(),bt=new Ot;function dt(Je,xt,ht,lr){if(Dr(ht)){if(!w(Je))throw new TypeError;if(!he(xt))throw new TypeError;return St(Je,xt)}else{if(!w(Je))throw new TypeError;if(!se(xt))throw new TypeError;if(!se(lr)&&!Dr(lr)&&!on(lr))throw new TypeError;return on(lr)&&(lr=void 0),ht=Bt(ht),ur(Je,xt,ht,lr)}}b("decorate",dt);function Pr(Je,xt){function ht(lr,Kr){if(!se(lr))throw new TypeError;if(!Dr(Kr)&&!je(Kr))throw new TypeError;qe(Je,xt,lr,Kr)}return ht}b("metadata",Pr);function er(Je,xt,ht,lr){if(!se(ht))throw new TypeError;return Dr(lr)||(lr=Bt(lr)),qe(Je,xt,ht,lr)}b("defineMetadata",er);function Ft(Je,xt,ht){if(!se(xt))throw new TypeError;return Dr(ht)||(ht=Bt(ht)),Te(Je,xt,ht)}b("hasMetadata",Ft);function tt(Je,xt,ht){if(!se(xt))throw new TypeError;return Dr(ht)||(ht=Bt(ht)),oe(Je,xt,ht)}b("hasOwnMetadata",tt);function Ne(Je,xt,ht){if(!se(xt))throw new TypeError;return Dr(ht)||(ht=Bt(ht)),me(Je,xt,ht)}b("getMetadata",Ne);function Qe(Je,xt,ht){if(!se(xt))throw new TypeError;return Dr(ht)||(ht=Bt(ht)),Me(Je,xt,ht)}b("getOwnMetadata",Qe);function Ie(Je,xt){if(!se(Je))throw new TypeError;return Dr(xt)||(xt=Bt(xt)),yt(Je,xt)}b("getMetadataKeys",Ie);function Ae(Je,xt){if(!se(Je))throw new TypeError;return Dr(xt)||(xt=Bt(xt)),Qt(Je,xt)}b("getOwnMetadataKeys",Ae);function Ue(Je,xt,ht){if(!se(xt))throw new TypeError;Dr(ht)||(ht=Bt(ht));var lr=ae(xt,ht,!1);if(Dr(lr)||!lr.delete(Je))return!1;if(lr.size>0)return!0;var Kr=bt.get(xt);return Kr.delete(ht),Kr.size>0||bt.delete(xt),!0}b("deleteMetadata",Ue);function St(Je,xt){for(var ht=Je.length-1;ht>=0;--ht){var lr=Je[ht],Kr=lr(xt);if(!Dr(Kr)&&!on(Kr)){if(!he(Kr))throw new TypeError;xt=Kr}}return xt}function ur(Je,xt,ht,lr){for(var Kr=Je.length-1;Kr>=0;--Kr){var lt=Je[Kr],Lt=lt(xt,ht,lr);if(!Dr(Lt)&&!on(Lt)){if(!se(Lt))throw new TypeError;lr=Lt}}return lr}function ae(Je,xt,ht){var lr=bt.get(Je);if(Dr(lr)){if(!ht)return;lr=new Ht,bt.set(Je,lr)}var Kr=lr.get(xt);if(Dr(Kr)){if(!ht)return;Kr=new Ht,lr.set(xt,Kr)}return Kr}function Te(Je,xt,ht){var lr=oe(Je,xt,ht);if(lr)return!0;var Kr=kt(xt);return on(Kr)?!1:Te(Je,Kr,ht)}function oe(Je,xt,ht){var lr=ae(xt,ht,!1);return Dr(lr)?!1:Ee(lr.has(Je))}function me(Je,xt,ht){var lr=oe(Je,xt,ht);if(lr)return Me(Je,xt,ht);var Kr=kt(xt);if(!on(Kr))return me(Je,Kr,ht)}function Me(Je,xt,ht){var lr=ae(xt,ht,!1);if(!Dr(lr))return lr.get(Je)}function qe(Je,xt,ht,lr){var Kr=ae(ht,lr,!0);Kr.set(Je,xt)}function yt(Je,xt){var ht=Qt(Je,xt),lr=kt(Je);if(lr===null)return ht;var Kr=yt(lr,xt);if(Kr.length<=0)return ht;if(ht.length<=0)return Kr;for(var lt=new At,Lt=[],Jt=0,or=ht;Jt<or.length;Jt++){var cn=or[Jt],Pn=lt.has(cn);Pn||(lt.add(cn),Lt.push(cn))}for(var bi=0,Si=Kr;bi<Si.length;bi++){var cn=Si[bi],Pn=lt.has(cn);Pn||(lt.add(cn),Lt.push(cn))}return Lt}function Qt(Je,xt){var ht=[],lr=ae(Je,xt,!1);if(Dr(lr))return ht;for(var Kr=lr.keys(),lt=_t(Kr),Lt=0;;){var Jt=V(lt);if(!Jt)return ht.length=Lt,ht;var or=Ct(Jt);try{ht[Lt]=or}catch(cn){try{Yt(lt)}finally{throw cn}}Lt++}}function Or(Je){if(Je===null)return 1;switch(typeof Je){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Je===null?1:6;default:return 6}}function Dr(Je){return Je===void 0}function on(Je){return Je===null}function tr(Je){return typeof Je=="symbol"}function se(Je){return typeof Je=="object"?Je!==null:typeof Je=="function"}function be(Je,xt){switch(Or(Je)){case 0:return Je;case 1:return Je;case 2:return Je;case 3:return Je;case 4:return Je;case 5:return Je}var ht=xt===3?"string":xt===5?"number":"default",lr=et(Je,$);if(lr!==void 0){var Kr=lr.call(Je,ht);if(se(Kr))throw new TypeError;return Kr}return Fe(Je,ht==="default"?"number":ht)}function Fe(Je,xt){if(xt==="string"){var ht=Je.toString;if(N(ht)){var lr=ht.call(Je);if(!se(lr))return lr}var Kr=Je.valueOf;if(N(Kr)){var lr=Kr.call(Je);if(!se(lr))return lr}}else{var Kr=Je.valueOf;if(N(Kr)){var lr=Kr.call(Je);if(!se(lr))return lr}var lt=Je.toString;if(N(lt)){var lr=lt.call(Je);if(!se(lr))return lr}}throw new TypeError}function Ee(Je){return!!Je}function wt(Je){return""+Je}function Bt(Je){var xt=be(Je,3);return tr(xt)?xt:wt(xt)}function w(Je){return Array.isArray?Array.isArray(Je):Je instanceof Object?Je instanceof Array:Object.prototype.toString.call(Je)==="[object Array]"}function N(Je){return typeof Je=="function"}function he(Je){return typeof Je=="function"}function je(Je){switch(Or(Je)){case 3:return!0;case 4:return!0;default:return!1}}function et(Je,xt){var ht=Je[xt];if(ht!=null){if(!N(ht))throw new TypeError;return ht}}function _t(Je){var xt=et(Je,I);if(!N(xt))throw new TypeError;var ht=xt.call(Je);if(!se(ht))throw new TypeError;return ht}function Ct(Je){return Je.value}function V(Je){var xt=Je.next();return xt.done?!1:xt}function Yt(Je){var xt=Je.return;xt&&xt.call(Je)}function kt(Je){var xt=Object.getPrototypeOf(Je);if(typeof Je!="function"||Je===$e||xt!==$e)return xt;var ht=Je.prototype,lr=ht&&Object.getPrototypeOf(ht);if(lr==null||lr===Object.prototype)return xt;var Kr=lr.constructor;return typeof Kr!="function"||Kr===Je?xt:Kr}function fr(){var Je={},xt=[],ht=function(){function Lt(Jt,or,cn){this._index=0,this._keys=Jt,this._values=or,this._selector=cn}return Lt.prototype["@@iterator"]=function(){return this},Lt.prototype[I]=function(){return this},Lt.prototype.next=function(){var Jt=this._index;if(Jt>=0&&Jt<this._keys.length){var or=this._selector(this._keys[Jt],this._values[Jt]);return Jt+1>=this._keys.length?(this._index=-1,this._keys=xt,this._values=xt):this._index++,{value:or,done:!1}}return{value:void 0,done:!0}},Lt.prototype.throw=function(Jt){throw this._index>=0&&(this._index=-1,this._keys=xt,this._values=xt),Jt},Lt.prototype.return=function(Jt){return this._index>=0&&(this._index=-1,this._keys=xt,this._values=xt),{value:Jt,done:!0}},Lt}();return function(){function Lt(){this._keys=[],this._values=[],this._cacheKey=Je,this._cacheIndex=-2}return Object.defineProperty(Lt.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Lt.prototype.has=function(Jt){return this._find(Jt,!1)>=0},Lt.prototype.get=function(Jt){var or=this._find(Jt,!1);return or>=0?this._values[or]:void 0},Lt.prototype.set=function(Jt,or){var cn=this._find(Jt,!0);return this._values[cn]=or,this},Lt.prototype.delete=function(Jt){var or=this._find(Jt,!1);if(or>=0){for(var cn=this._keys.length,Pn=or+1;Pn<cn;Pn++)this._keys[Pn-1]=this._keys[Pn],this._values[Pn-1]=this._values[Pn];return this._keys.length--,this._values.length--,Jt===this._cacheKey&&(this._cacheKey=Je,this._cacheIndex=-2),!0}return!1},Lt.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Je,this._cacheIndex=-2},Lt.prototype.keys=function(){return new ht(this._keys,this._values,lr)},Lt.prototype.values=function(){return new ht(this._keys,this._values,Kr)},Lt.prototype.entries=function(){return new ht(this._keys,this._values,lt)},Lt.prototype["@@iterator"]=function(){return this.entries()},Lt.prototype[I]=function(){return this.entries()},Lt.prototype._find=function(Jt,or){return this._cacheKey!==Jt&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Jt)),this._cacheIndex<0&&or&&(this._cacheIndex=this._keys.length,this._keys.push(Jt),this._values.push(void 0)),this._cacheIndex},Lt}();function lr(Lt,Jt){return Lt}function Kr(Lt,Jt){return Jt}function lt(Lt,Jt){return[Lt,Jt]}}function Cr(){return function(){function Je(){this._map=new Ht}return Object.defineProperty(Je.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Je.prototype.has=function(xt){return this._map.has(xt)},Je.prototype.add=function(xt){return this._map.set(xt,xt),this},Je.prototype.delete=function(xt){return this._map.delete(xt)},Je.prototype.clear=function(){this._map.clear()},Je.prototype.keys=function(){return this._map.keys()},Je.prototype.values=function(){return this._map.values()},Je.prototype.entries=function(){return this._map.entries()},Je.prototype["@@iterator"]=function(){return this.keys()},Je.prototype[I]=function(){return this.keys()},Je}()}function Tr(){var Je=16,xt=We.create(),ht=lr();return function(){function or(){this._key=lr()}return or.prototype.has=function(cn){var Pn=Kr(cn,!1);return Pn!==void 0?We.has(Pn,this._key):!1},or.prototype.get=function(cn){var Pn=Kr(cn,!1);return Pn!==void 0?We.get(Pn,this._key):void 0},or.prototype.set=function(cn,Pn){var bi=Kr(cn,!0);return bi[this._key]=Pn,this},or.prototype.delete=function(cn){var Pn=Kr(cn,!1);return Pn!==void 0?delete Pn[this._key]:!1},or.prototype.clear=function(){this._key=lr()},or}();function lr(){var or;do or="@@WeakMap@@"+Jt();while(We.has(xt,or));return xt[or]=!0,or}function Kr(or,cn){if(!X.call(or,ht)){if(!cn)return;Object.defineProperty(or,ht,{value:We.create()})}return or[ht]}function lt(or,cn){for(var Pn=0;Pn<cn;++Pn)or[Pn]=Math.random()*255|0;return or}function Lt(or){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(or)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(or)):lt(new Uint8Array(or),or):lt(new Array(or),or)}function Jt(){var or=Lt(Je);or[6]=or[6]&79|64,or[8]=or[8]&191|128;for(var cn="",Pn=0;Pn<Je;++Pn){var bi=or[Pn];(Pn===4||Pn===6||Pn===8)&&(cn+="-"),bi<16&&(cn+="0"),cn+=bi.toString(16).toLowerCase()}return cn}}function Ar(Je){return Je.__=void 0,delete Je.__,Je}})})(E||(E={}))},81550:function(ar){(function(O,_){ar.exports=_()})(this,function(){"use strict";var O=function(U){return U instanceof Uint8Array||U instanceof Uint16Array||U instanceof Uint32Array||U instanceof Int8Array||U instanceof Int16Array||U instanceof Int32Array||U instanceof Float32Array||U instanceof Float64Array||U instanceof Uint8ClampedArray},_=function(U,Pe){for(var Ze=Object.keys(Pe),rr=0;rr<Ze.length;++rr)U[Ze[rr]]=Pe[Ze[rr]];return U},Q=`
`;function E(U){return typeof atob!="undefined"?atob(U):"base64:"+U}function p(U){var Pe=new Error("(regl) "+U);throw console.error(Pe),Pe}function b(U,Pe){U||p(Pe)}function X(U){return U?": "+U:""}function W(U,Pe,Ze){U in Pe||p("unknown parameter ("+U+")"+X(Ze)+". possible values: "+Object.keys(Pe).join())}function $(U,Pe){O(U)||p("invalid parameter type"+X(Pe)+". must be a typed array")}function I(U,Pe){switch(Pe){case"number":return typeof U=="number";case"object":return typeof U=="object";case"string":return typeof U=="string";case"boolean":return typeof U=="boolean";case"function":return typeof U=="function";case"undefined":return typeof U=="undefined";case"symbol":return typeof U=="symbol"}}function k(U,Pe,Ze){I(U,Pe)||p("invalid parameter type"+X(Ze)+". expected "+Pe+", got "+typeof U)}function Ce(U,Pe){U>=0&&(U|0)===U||p("invalid parameter type, ("+U+")"+X(Pe)+". must be a nonnegative integer")}function Be(U,Pe,Ze){Pe.indexOf(U)<0&&p("invalid value"+X(Ze)+". must be one of: "+Pe)}var We=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function $e(U){Object.keys(U).forEach(function(Pe){We.indexOf(Pe)<0&&p('invalid regl constructor argument "'+Pe+'". must be one of '+We)})}function Vt(U,Pe){for(U=U+"";U.length<Pe;)U=" "+U;return U}function Ht(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function At(U,Pe){this.number=U,this.line=Pe,this.errors=[]}function Ot(U,Pe,Ze){this.file=U,this.line=Pe,this.message=Ze}function bt(){var U=new Error,Pe=(U.stack||U).toString(),Ze=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Pe);if(Ze)return Ze[1];var rr=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Pe);return rr?rr[1]:"unknown"}function dt(){var U=new Error,Pe=(U.stack||U).toString(),Ze=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Pe);if(Ze)return Ze[1];var rr=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Pe);return rr?rr[1]:"unknown"}function Pr(U,Pe){var Ze=U.split(`
`),rr=1,wr=0,Xt={unknown:new Ht,0:new Ht};Xt.unknown.name=Xt[0].name=Pe||bt(),Xt.unknown.lines.push(new At(0,""));for(var vr=0;vr<Ze.length;++vr){var Ur=Ze[vr],Hr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Ur);if(Hr)switch(Hr[1]){case"line":var Jr=/(\d+)(\s+\d+)?/.exec(Hr[2]);Jr&&(rr=Jr[1]|0,Jr[2]&&(wr=Jr[2]|0,wr in Xt||(Xt[wr]=new Ht)));break;case"define":var Gr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Hr[2]);Gr&&(Xt[wr].name=Gr[1]?E(Gr[2]):Gr[2]);break}Xt[wr].lines.push(new At(rr++,Ur))}return Object.keys(Xt).forEach(function(rn){var hn=Xt[rn];hn.lines.forEach(function(jr){hn.index[jr.number]=jr})}),Xt}function er(U){var Pe=[];return U.split(`
`).forEach(function(Ze){if(!(Ze.length<5)){var rr=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Ze);rr?Pe.push(new Ot(rr[1]|0,rr[2]|0,rr[3].trim())):Ze.length>0&&Pe.push(new Ot("unknown",0,Ze))}}),Pe}function Ft(U,Pe){Pe.forEach(function(Ze){var rr=U[Ze.file];if(rr){var wr=rr.index[Ze.line];if(wr){wr.errors.push(Ze),rr.hasErrors=!0;return}}U.unknown.hasErrors=!0,U.unknown.lines[0].errors.push(Ze)})}function tt(U,Pe,Ze,rr,wr){if(!U.getShaderParameter(Pe,U.COMPILE_STATUS)){var Xt=U.getShaderInfoLog(Pe),vr=rr===U.FRAGMENT_SHADER?"fragment":"vertex";ur(Ze,"string",vr+" shader source must be a string",wr);var Ur=Pr(Ze,wr),Hr=er(Xt);Ft(Ur,Hr),Object.keys(Ur).forEach(function(Jr){var Gr=Ur[Jr];if(!Gr.hasErrors)return;var rn=[""],hn=[""];function jr(an,Zt){rn.push(an),hn.push(Zt||"")}jr("file number "+Jr+": "+Gr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Gr.lines.forEach(function(an){if(an.errors.length>0){jr(Vt(an.number,4)+"|  ","background-color:yellow; font-weight:bold"),jr(an.line+Q,"color:red; background-color:yellow; font-weight:bold");var Zt=0;an.errors.forEach(function(pr){var Vr=pr.message,mn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Vr);if(mn){var Br=mn[1];switch(Vr=mn[2],Br){case"assign":Br="=";break}Zt=Math.max(an.line.indexOf(Br,Zt),0)}else Zt=0;jr(Vt("| ",6)),jr(Vt("^^^",Zt+3)+Q,"font-weight:bold"),jr(Vt("| ",6)),jr(Vr+Q,"font-weight:bold")}),jr(Vt("| ",6)+Q)}else jr(Vt(an.number,4)+"|  "),jr(an.line+Q,"color:red")}),typeof document!="undefined"&&!window.chrome?(hn[0]=rn.join("%c"),console.log.apply(console,hn)):console.log(rn.join(""))}),b.raise("Error compiling "+vr+" shader, "+Ur[0].name)}}function Ne(U,Pe,Ze,rr,wr){if(!U.getProgramParameter(Pe,U.LINK_STATUS)){var Xt=U.getProgramInfoLog(Pe),vr=Pr(Ze,wr),Ur=Pr(rr,wr),Hr='Error linking program with vertex shader, "'+Ur[0].name+'", and fragment shader "'+vr[0].name+'"';typeof document!="undefined"?console.log("%c"+Hr+Q+"%c"+Xt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Hr+Q+Xt),b.raise(Hr)}}function Qe(U){U._commandRef=bt()}function Ie(U,Pe,Ze,rr){Qe(U);function wr(Hr){return Hr?rr.id(Hr):0}U._fragId=wr(U.static.frag),U._vertId=wr(U.static.vert);function Xt(Hr,Jr){Object.keys(Jr).forEach(function(Gr){Hr[rr.id(Gr)]=!0})}var vr=U._uniformSet={};Xt(vr,Pe.static),Xt(vr,Pe.dynamic);var Ur=U._attributeSet={};Xt(Ur,Ze.static),Xt(Ur,Ze.dynamic),U._hasCount="count"in U.static||"count"in U.dynamic||"elements"in U.static||"elements"in U.dynamic}function Ae(U,Pe){var Ze=dt();p(U+" in command "+(Pe||bt())+(Ze==="unknown"?"":" called from "+Ze))}function Ue(U,Pe,Ze){U||Ae(Pe,Ze||bt())}function St(U,Pe,Ze,rr){U in Pe||Ae("unknown parameter ("+U+")"+X(Ze)+". possible values: "+Object.keys(Pe).join(),rr||bt())}function ur(U,Pe,Ze,rr){I(U,Pe)||Ae("invalid parameter type"+X(Ze)+". expected "+Pe+", got "+typeof U,rr||bt())}function ae(U){U()}function Te(U,Pe,Ze){U.texture?Be(U.texture._texture.internalformat,Pe,"unsupported texture format for attachment"):Be(U.renderbuffer._renderbuffer.format,Ze,"unsupported renderbuffer format for attachment")}var oe=33071,me=9728,Me=9984,qe=9985,yt=9986,Qt=9987,Or=5120,Dr=5121,on=5122,tr=5123,se=5124,be=5125,Fe=5126,Ee=32819,wt=32820,Bt=33635,w=34042,N=36193,he={};he[Or]=he[Dr]=1,he[on]=he[tr]=he[N]=he[Bt]=he[Ee]=he[wt]=2,he[se]=he[be]=he[Fe]=he[w]=4;function je(U,Pe){return U===wt||U===Ee||U===Bt?2:U===w?4:he[U]*Pe}function et(U){return!(U&U-1)&&!!U}function _t(U,Pe,Ze){var rr,wr=Pe.width,Xt=Pe.height,vr=Pe.channels;b(wr>0&&wr<=Ze.maxTextureSize&&Xt>0&&Xt<=Ze.maxTextureSize,"invalid texture shape"),(U.wrapS!==oe||U.wrapT!==oe)&&b(et(wr)&&et(Xt),"incompatible wrap mode for texture, both width and height must be power of 2"),Pe.mipmask===1?wr!==1&&Xt!==1&&b(U.minFilter!==Me&&U.minFilter!==yt&&U.minFilter!==qe&&U.minFilter!==Qt,"min filter requires mipmap"):(b(et(wr)&&et(Xt),"texture must be a square power of 2 to support mipmapping"),b(Pe.mipmask===(wr<<1)-1,"missing or incomplete mipmap data")),Pe.type===Fe&&(Ze.extensions.indexOf("oes_texture_float_linear")<0&&b(U.minFilter===me&&U.magFilter===me,"filter not supported, must enable oes_texture_float_linear"),b(!U.genMipmaps,"mipmap generation not supported with float textures"));var Ur=Pe.images;for(rr=0;rr<16;++rr)if(Ur[rr]){var Hr=wr>>rr,Jr=Xt>>rr;b(Pe.mipmask&1<<rr,"missing mipmap data");var Gr=Ur[rr];if(b(Gr.width===Hr&&Gr.height===Jr,"invalid shape for mip images"),b(Gr.format===Pe.format&&Gr.internalformat===Pe.internalformat&&Gr.type===Pe.type,"incompatible type for mip image"),!Gr.compressed)if(Gr.data){var rn=Math.ceil(je(Gr.type,vr)*Hr/Gr.unpackAlignment)*Gr.unpackAlignment;b(Gr.data.byteLength===rn*Jr,"invalid data for image, buffer size is inconsistent with image format")}else Gr.element||Gr.copy}else U.genMipmaps||b((Pe.mipmask&1<<rr)==0,"extra mipmap data");Pe.compressed&&b(!U.genMipmaps,"mipmap generation for compressed images not supported")}function Ct(U,Pe,Ze,rr){var wr=U.width,Xt=U.height,vr=U.channels;b(wr>0&&wr<=rr.maxTextureSize&&Xt>0&&Xt<=rr.maxTextureSize,"invalid texture shape"),b(wr===Xt,"cube map must be square"),b(Pe.wrapS===oe&&Pe.wrapT===oe,"wrap mode not supported by cube map");for(var Ur=0;Ur<Ze.length;++Ur){var Hr=Ze[Ur];b(Hr.width===wr&&Hr.height===Xt,"inconsistent cube map face shape"),Pe.genMipmaps&&(b(!Hr.compressed,"can not generate mipmap for compressed textures"),b(Hr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Jr=Hr.images,Gr=0;Gr<16;++Gr){var rn=Jr[Gr];if(rn){var hn=wr>>Gr,jr=Xt>>Gr;b(Hr.mipmask&1<<Gr,"missing mipmap data"),b(rn.width===hn&&rn.height===jr,"invalid shape for mip images"),b(rn.format===U.format&&rn.internalformat===U.internalformat&&rn.type===U.type,"incompatible type for mip image"),rn.compressed||(rn.data?b(rn.data.byteLength===hn*jr*Math.max(je(rn.type,vr),rn.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):rn.element||rn.copy)}}}}var V=_(b,{optional:ae,raise:p,commandRaise:Ae,command:Ue,parameter:W,commandParameter:St,constructor:$e,type:k,commandType:ur,isTypedArray:$,nni:Ce,oneOf:Be,shaderError:tt,linkError:Ne,callSite:dt,saveCommandRef:Qe,saveDrawInfo:Ie,framebufferFormat:Te,guessCommand:bt,texture2D:_t,textureCube:Ct}),Yt=0,kt=0,fr=5,Cr=6;function Tr(U,Pe){this.id=Yt++,this.type=U,this.data=Pe}function Ar(U){return U.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Je(U){if(U.length===0)return[];var Pe=U.charAt(0),Ze=U.charAt(U.length-1);if(U.length>1&&Pe===Ze&&(Pe==='"'||Pe==="'"))return['"'+Ar(U.substr(1,U.length-2))+'"'];var rr=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(U);if(rr)return Je(U.substr(0,rr.index)).concat(Je(rr[1])).concat(Je(U.substr(rr.index+rr[0].length)));var wr=U.split(".");if(wr.length===1)return['"'+Ar(U)+'"'];for(var Xt=[],vr=0;vr<wr.length;++vr)Xt=Xt.concat(Je(wr[vr]));return Xt}function xt(U){return"["+Je(U).join("][")+"]"}function ht(U,Pe){return new Tr(U,xt(Pe+""))}function lr(U){return typeof U=="function"&&!U._reglType||U instanceof Tr}function Kr(U,Pe){if(typeof U=="function")return new Tr(kt,U);if(typeof U=="number"||typeof U=="boolean")return new Tr(fr,U);if(Array.isArray(U))return new Tr(Cr,U.map((Ze,rr)=>Kr(Ze,Pe+"["+rr+"]")));if(U instanceof Tr)return U;V(!1,"invalid option type in uniform "+Pe)}var lt={DynamicVariable:Tr,define:ht,isDynamic:lr,unbox:Kr,accessor:xt},Lt={next:typeof requestAnimationFrame=="function"?function(U){return requestAnimationFrame(U)}:function(U){return setTimeout(U,16)},cancel:typeof cancelAnimationFrame=="function"?function(U){return cancelAnimationFrame(U)}:clearTimeout},Jt=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function or(){var U={"":0},Pe=[""];return{id:function(Ze){var rr=U[Ze];return rr||(rr=U[Ze]=Pe.length,Pe.push(Ze),rr)},str:function(Ze){return Pe[Ze]}}}function cn(U,Pe,Ze){var rr=document.createElement("canvas");_(rr.style,{border:0,margin:0,padding:0,top:0,left:0}),U.appendChild(rr),U===document.body&&(rr.style.position="absolute",_(U.style,{margin:0,padding:0}));function wr(){var Ur=window.innerWidth,Hr=window.innerHeight;if(U!==document.body){var Jr=U.getBoundingClientRect();Ur=Jr.right-Jr.left,Hr=Jr.bottom-Jr.top}rr.width=Ze*Ur,rr.height=Ze*Hr,_(rr.style,{width:Ur+"px",height:Hr+"px"})}var Xt;U!==document.body&&typeof ResizeObserver=="function"?(Xt=new ResizeObserver(function(){setTimeout(wr)}),Xt.observe(U)):window.addEventListener("resize",wr,!1);function vr(){Xt?Xt.disconnect():window.removeEventListener("resize",wr),U.removeChild(rr)}return wr(),{canvas:rr,onDestroy:vr}}function Pn(U,Pe){function Ze(rr){try{return U.getContext(rr,Pe)}catch(wr){return null}}return Ze("webgl")||Ze("experimental-webgl")||Ze("webgl-experimental")}function bi(U){return typeof U.nodeName=="string"&&typeof U.appendChild=="function"&&typeof U.getBoundingClientRect=="function"}function Si(U){return typeof U.drawArrays=="function"||typeof U.drawElements=="function"}function Ri(U){return typeof U=="string"?U.split():(V(Array.isArray(U),"invalid extension array"),U)}function ia(U){return typeof U=="string"?(V(typeof document!="undefined","not supported outside of DOM"),document.querySelector(U)):U}function pi(U){var Pe=U||{},Ze,rr,wr,Xt,vr={},Ur=[],Hr=[],Jr=typeof window=="undefined"?1:window.devicePixelRatio,Gr=!1,rn=function(an){an&&V.raise(an)},hn=function(){};if(typeof Pe=="string"?(V(typeof document!="undefined","selector queries only supported in DOM enviroments"),Ze=document.querySelector(Pe),V(Ze,"invalid query string for element")):typeof Pe=="object"?bi(Pe)?Ze=Pe:Si(Pe)?(Xt=Pe,wr=Xt.canvas):(V.constructor(Pe),"gl"in Pe?Xt=Pe.gl:"canvas"in Pe?wr=ia(Pe.canvas):"container"in Pe&&(rr=ia(Pe.container)),"attributes"in Pe&&(vr=Pe.attributes,V.type(vr,"object","invalid context attributes")),"extensions"in Pe&&(Ur=Ri(Pe.extensions)),"optionalExtensions"in Pe&&(Hr=Ri(Pe.optionalExtensions)),"onDone"in Pe&&(V.type(Pe.onDone,"function","invalid or missing onDone callback"),rn=Pe.onDone),"profile"in Pe&&(Gr=!!Pe.profile),"pixelRatio"in Pe&&(Jr=+Pe.pixelRatio,V(Jr>0,"invalid pixel ratio"))):V.raise("invalid arguments to regl"),Ze&&(Ze.nodeName.toLowerCase()==="canvas"?wr=Ze:rr=Ze),!Xt){if(!wr){V(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var jr=cn(rr||document.body,rn,Jr);if(!jr)return null;wr=jr.canvas,hn=jr.onDestroy}vr.premultipliedAlpha===void 0&&(vr.premultipliedAlpha=!0),Xt=Pn(wr,vr)}return Xt?{gl:Xt,canvas:wr,container:rr,extensions:Ur,optionalExtensions:Hr,pixelRatio:Jr,profile:Gr,onDone:rn,onDestroy:hn}:(hn(),rn("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function H(U,Pe){var Ze={};function rr(vr){V.type(vr,"string","extension name must be string");var Ur=vr.toLowerCase(),Hr;try{Hr=Ze[Ur]=U.getExtension(Ur)}catch(Jr){}return!!Hr}for(var wr=0;wr<Pe.extensions.length;++wr){var Xt=Pe.extensions[wr];if(!rr(Xt))return Pe.onDestroy(),Pe.onDone('"'+Xt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Pe.optionalExtensions.forEach(rr),{extensions:Ze,restore:function(){Object.keys(Ze).forEach(function(vr){if(Ze[vr]&&!rr(vr))throw new Error("(regl): error restoring extension "+vr)})}}}function ie(U,Pe){for(var Ze=Array(U),rr=0;rr<U;++rr)Ze[rr]=Pe(rr);return Ze}var ce=5120,B=5121,re=5122,fe=5123,Se=5124,te=5125,ge=5126;function pt(U){for(var Pe=16;Pe<=1<<28;Pe*=16)if(U<=Pe)return Pe;return 0}function yr(U){var Pe,Ze;return Pe=(U>65535)<<4,U>>>=Pe,Ze=(U>255)<<3,U>>>=Ze,Pe|=Ze,Ze=(U>15)<<2,U>>>=Ze,Pe|=Ze,Ze=(U>3)<<1,U>>>=Ze,Pe|=Ze,Pe|U>>1}function Lr(){var U=ie(8,function(){return[]});function Pe(Xt){var vr=pt(Xt),Ur=U[yr(vr)>>2];return Ur.length>0?Ur.pop():new ArrayBuffer(vr)}function Ze(Xt){U[yr(Xt.byteLength)>>2].push(Xt)}function rr(Xt,vr){var Ur=null;switch(Xt){case ce:Ur=new Int8Array(Pe(vr),0,vr);break;case B:Ur=new Uint8Array(Pe(vr),0,vr);break;case re:Ur=new Int16Array(Pe(2*vr),0,vr);break;case fe:Ur=new Uint16Array(Pe(2*vr),0,vr);break;case Se:Ur=new Int32Array(Pe(4*vr),0,vr);break;case te:Ur=new Uint32Array(Pe(4*vr),0,vr);break;case ge:Ur=new Float32Array(Pe(4*vr),0,vr);break;default:return null}return Ur.length!==vr?Ur.subarray(0,vr):Ur}function wr(Xt){Ze(Xt.buffer)}return{alloc:Pe,free:Ze,allocType:rr,freeType:wr}}var Nt=Lr();Nt.zero=Lr();var Fr=3408,bn=3410,gn=3411,gr=3412,vn=3413,Wr=3414,ln=3415,Ei=33901,pn=33902,wi=3379,Yi=3386,Yn=34921,Di=36347,ki=36348,za=35661,Wn=35660,ai=34930,Ai=36349,Qn=34076,Fi=34024,ya=7936,Xa=7937,_a=7938,da=35724,Vu=34047,Ya=36063,gi=34852,qa=3553,Ka=34067,$a=34069,Yo=33984,Gi=6408,Oo=5126,Oa=5121,Za=36160,cs=36053,va=36064,fs=16384,Ca=function(U,Pe){var Ze=1;Pe.ext_texture_filter_anisotropic&&(Ze=U.getParameter(Vu));var rr=1,wr=1;Pe.webgl_draw_buffers&&(rr=U.getParameter(gi),wr=U.getParameter(Ya));var Xt=!!Pe.oes_texture_float;if(Xt){var vr=U.createTexture();U.bindTexture(qa,vr),U.texImage2D(qa,0,Gi,1,1,0,Gi,Oo,null);var Ur=U.createFramebuffer();if(U.bindFramebuffer(Za,Ur),U.framebufferTexture2D(Za,va,qa,vr,0),U.bindTexture(qa,null),U.checkFramebufferStatus(Za)!==cs)Xt=!1;else{U.viewport(0,0,1,1),U.clearColor(1,0,0,1),U.clear(fs);var Hr=Nt.allocType(Oo,4);U.readPixels(0,0,1,1,Gi,Oo,Hr),U.getError()?Xt=!1:(U.deleteFramebuffer(Ur),U.deleteTexture(vr),Xt=Hr[0]===1),Nt.freeType(Hr)}}var Jr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Gr=!0;if(!Jr){var rn=U.createTexture(),hn=Nt.allocType(Oa,36);U.activeTexture(Yo),U.bindTexture(Ka,rn),U.texImage2D($a,0,Gi,3,3,0,Gi,Oa,hn),Nt.freeType(hn),U.bindTexture(Ka,null),U.deleteTexture(rn),Gr=!U.getError()}return{colorBits:[U.getParameter(bn),U.getParameter(gn),U.getParameter(gr),U.getParameter(vn)],depthBits:U.getParameter(Wr),stencilBits:U.getParameter(ln),subpixelBits:U.getParameter(Fr),extensions:Object.keys(Pe).filter(function(jr){return!!Pe[jr]}),maxAnisotropic:Ze,maxDrawbuffers:rr,maxColorAttachments:wr,pointSizeDims:U.getParameter(Ei),lineWidthDims:U.getParameter(pn),maxViewportDims:U.getParameter(Yi),maxCombinedTextureUnits:U.getParameter(za),maxCubeMapSize:U.getParameter(Qn),maxRenderbufferSize:U.getParameter(Fi),maxTextureUnits:U.getParameter(ai),maxTextureSize:U.getParameter(wi),maxAttributes:U.getParameter(Yn),maxVertexUniforms:U.getParameter(Di),maxVertexTextureUnits:U.getParameter(Wn),maxVaryingVectors:U.getParameter(ki),maxFragmentUniforms:U.getParameter(Ai),glsl:U.getParameter(da),renderer:U.getParameter(Xa),vendor:U.getParameter(ya),version:U.getParameter(_a),readFloat:Xt,npotTextureCube:Gr}};function fo(U){return!!U&&typeof U=="object"&&Array.isArray(U.shape)&&Array.isArray(U.stride)&&typeof U.offset=="number"&&U.shape.length===U.stride.length&&(Array.isArray(U.data)||O(U.data))}var Zi=function(U){return Object.keys(U).map(function(Pe){return U[Pe]})},pe={shape:Ki,flatten:Dn};function Le(U,Pe,Ze){for(var rr=0;rr<Pe;++rr)Ze[rr]=U[rr]}function vt(U,Pe,Ze,rr){for(var wr=0,Xt=0;Xt<Pe;++Xt)for(var vr=U[Xt],Ur=0;Ur<Ze;++Ur)rr[wr++]=vr[Ur]}function hr(U,Pe,Ze,rr,wr,Xt){for(var vr=Xt,Ur=0;Ur<Pe;++Ur)for(var Hr=U[Ur],Jr=0;Jr<Ze;++Jr)for(var Gr=Hr[Jr],rn=0;rn<rr;++rn)wr[vr++]=Gr[rn]}function Qr(U,Pe,Ze,rr,wr){for(var Xt=1,vr=Ze+1;vr<Pe.length;++vr)Xt*=Pe[vr];var Ur=Pe[Ze];if(Pe.length-Ze==4){var Hr=Pe[Ze+1],Jr=Pe[Ze+2],Gr=Pe[Ze+3];for(vr=0;vr<Ur;++vr)hr(U[vr],Hr,Jr,Gr,rr,wr),wr+=Xt}else for(vr=0;vr<Ur;++vr)Qr(U[vr],Pe,Ze+1,rr,wr),wr+=Xt}function Dn(U,Pe,Ze,rr){var wr=1;if(Pe.length)for(var Xt=0;Xt<Pe.length;++Xt)wr*=Pe[Xt];else wr=0;var vr=rr||Nt.allocType(Ze,wr);switch(Pe.length){case 0:break;case 1:Le(U,Pe[0],vr);break;case 2:vt(U,Pe[0],Pe[1],vr);break;case 3:hr(U,Pe[0],Pe[1],Pe[2],vr,0);break;default:Qr(U,Pe,0,vr,0)}return vr}function Ki(U){for(var Pe=[],Ze=U;Ze.length;Ze=Ze[0])Pe.push(Ze.length);return Pe}var Ua={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},La=5120,ja=5122,To=5124,Mu=5121,$l=5123,Il=5125,Lo=5126,Xs=5126,ua={int8:La,int16:ja,int32:To,uint8:Mu,uint16:$l,uint32:Il,float:Lo,float32:Xs},Ns=35048,ou=35040,bs={dynamic:Ns,stream:ou,static:35044},Ps=pe.flatten,ti=pe.shape,ho=35044,su=35040,Ol=5121,sl=5126,Xe=[];Xe[5120]=1,Xe[5122]=2,Xe[5124]=4,Xe[5121]=1,Xe[5123]=2,Xe[5125]=4,Xe[5126]=4;function Pt(U){return Ua[Object.prototype.toString.call(U)]|0}function _r(U,Pe){for(var Ze=0;Ze<Pe.length;++Ze)U[Ze]=Pe[Ze]}function Zn(U,Pe,Ze,rr,wr,Xt,vr){for(var Ur=0,Hr=0;Hr<Ze;++Hr)for(var Jr=0;Jr<rr;++Jr)U[Ur++]=Pe[wr*Hr+Xt*Jr+vr]}function sa(U,Pe,Ze,rr){var wr=0,Xt={};function vr(Zt){this.id=wr++,this.buffer=U.createBuffer(),this.type=Zt,this.usage=ho,this.byteLength=0,this.dimension=1,this.dtype=Ol,this.persistentData=null,Ze.profile&&(this.stats={size:0})}vr.prototype.bind=function(){U.bindBuffer(this.type,this.buffer)},vr.prototype.destroy=function(){hn(this)};var Ur=[];function Hr(Zt,pr){var Vr=Ur.pop();return Vr||(Vr=new vr(Zt)),Vr.bind(),rn(Vr,pr,su,0,1,!1),Vr}function Jr(Zt){Ur.push(Zt)}function Gr(Zt,pr,Vr){Zt.byteLength=pr.byteLength,U.bufferData(Zt.type,pr,Vr)}function rn(Zt,pr,Vr,mn,Br,Sn){var zr;if(Zt.usage=Vr,Array.isArray(pr)){if(Zt.dtype=mn||sl,pr.length>0){var un;if(Array.isArray(pr[0])){zr=ti(pr);for(var kr=1,nn=1;nn<zr.length;++nn)kr*=zr[nn];Zt.dimension=kr,un=Ps(pr,zr,Zt.dtype),Gr(Zt,un,Vr),Sn?Zt.persistentData=un:Nt.freeType(un)}else if(typeof pr[0]=="number"){Zt.dimension=Br;var Xn=Nt.allocType(Zt.dtype,pr.length);_r(Xn,pr),Gr(Zt,Xn,Vr),Sn?Zt.persistentData=Xn:Nt.freeType(Xn)}else O(pr[0])?(Zt.dimension=pr[0].length,Zt.dtype=mn||Pt(pr[0])||sl,un=Ps(pr,[pr.length,pr[0].length],Zt.dtype),Gr(Zt,un,Vr),Sn?Zt.persistentData=un:Nt.freeType(un)):V.raise("invalid buffer data")}}else if(O(pr))Zt.dtype=mn||Pt(pr),Zt.dimension=Br,Gr(Zt,pr,Vr),Sn&&(Zt.persistentData=new Uint8Array(new Uint8Array(pr.buffer)));else if(fo(pr)){zr=pr.shape;var Kn=pr.stride,sn=pr.offset,Nr=0,Ir=0,si=0,ui=0;zr.length===1?(Nr=zr[0],Ir=1,si=Kn[0],ui=0):zr.length===2?(Nr=zr[0],Ir=zr[1],si=Kn[0],ui=Kn[1]):V.raise("invalid shape"),Zt.dtype=mn||Pt(pr.data)||sl,Zt.dimension=Ir;var kn=Nt.allocType(Zt.dtype,Nr*Ir);Zn(kn,pr.data,Nr,Ir,si,ui,sn),Gr(Zt,kn,Vr),Sn?Zt.persistentData=kn:Nt.freeType(kn)}else pr instanceof ArrayBuffer?(Zt.dtype=Ol,Zt.dimension=Br,Gr(Zt,pr,Vr),Sn&&(Zt.persistentData=new Uint8Array(new Uint8Array(pr)))):V.raise("invalid buffer data")}function hn(Zt){Pe.bufferCount--,rr(Zt);var pr=Zt.buffer;V(pr,"buffer must not be deleted already"),U.deleteBuffer(pr),Zt.buffer=null,delete Xt[Zt.id]}function jr(Zt,pr,Vr,mn){Pe.bufferCount++;var Br=new vr(pr);Xt[Br.id]=Br;function Sn(kr){var nn=ho,Xn=null,Kn=0,sn=0,Nr=1;return Array.isArray(kr)||O(kr)||fo(kr)||kr instanceof ArrayBuffer?Xn=kr:typeof kr=="number"?Kn=kr|0:kr&&(V.type(kr,"object","buffer arguments must be an object, a number or an array"),"data"in kr&&(V(Xn===null||Array.isArray(Xn)||O(Xn)||fo(Xn),"invalid data for buffer"),Xn=kr.data),"usage"in kr&&(V.parameter(kr.usage,bs,"invalid buffer usage"),nn=bs[kr.usage]),"type"in kr&&(V.parameter(kr.type,ua,"invalid buffer type"),sn=ua[kr.type]),"dimension"in kr&&(V.type(kr.dimension,"number","invalid dimension"),Nr=kr.dimension|0),"length"in kr&&(V.nni(Kn,"buffer length must be a nonnegative integer"),Kn=kr.length|0)),Br.bind(),Xn?rn(Br,Xn,nn,sn,Nr,mn):(Kn&&U.bufferData(Br.type,Kn,nn),Br.dtype=sn||Ol,Br.usage=nn,Br.dimension=Nr,Br.byteLength=Kn),Ze.profile&&(Br.stats.size=Br.byteLength*Xe[Br.dtype]),Sn}function zr(kr,nn){V(nn+kr.byteLength<=Br.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+kr.byteLength+" starting from offset "+nn+" to a buffer of size "+Br.byteLength),U.bufferSubData(Br.type,nn,kr)}function un(kr,nn){var Xn=(nn||0)|0,Kn;if(Br.bind(),O(kr)||kr instanceof ArrayBuffer)zr(kr,Xn);else if(Array.isArray(kr)){if(kr.length>0)if(typeof kr[0]=="number"){var sn=Nt.allocType(Br.dtype,kr.length);_r(sn,kr),zr(sn,Xn),Nt.freeType(sn)}else if(Array.isArray(kr[0])||O(kr[0])){Kn=ti(kr);var Nr=Ps(kr,Kn,Br.dtype);zr(Nr,Xn),Nt.freeType(Nr)}else V.raise("invalid buffer data")}else if(fo(kr)){Kn=kr.shape;var Ir=kr.stride,si=0,ui=0,kn=0,ea=0;Kn.length===1?(si=Kn[0],ui=1,kn=Ir[0],ea=0):Kn.length===2?(si=Kn[0],ui=Kn[1],kn=Ir[0],ea=Ir[1]):V.raise("invalid shape");var Pi=Array.isArray(kr.data)?Br.dtype:Pt(kr.data),ji=Nt.allocType(Pi,si*ui);Zn(ji,kr.data,si,ui,kn,ea,kr.offset),zr(ji,Xn),Nt.freeType(ji)}else V.raise("invalid data for buffer subdata");return Sn}return Vr||Sn(Zt),Sn._reglType="buffer",Sn._buffer=Br,Sn.subdata=un,Ze.profile&&(Sn.stats=Br.stats),Sn.destroy=function(){hn(Br)},Sn}function an(){Zi(Xt).forEach(function(Zt){Zt.buffer=U.createBuffer(),U.bindBuffer(Zt.type,Zt.buffer),U.bufferData(Zt.type,Zt.persistentData||Zt.byteLength,Zt.usage)})}return Ze.profile&&(Pe.getTotalBufferSize=function(){var Zt=0;return Object.keys(Xt).forEach(function(pr){Zt+=Xt[pr].stats.size}),Zt}),{create:jr,createStream:Hr,destroyStream:Jr,clear:function(){Zi(Xt).forEach(hn),Ur.forEach(hn)},getBuffer:function(Zt){return Zt&&Zt._buffer instanceof vr?Zt._buffer:null},restore:an,_initBuffer:rn}}var xa=0,ka=0,vi=1,Ta=1,eo=4,qn=4,ba={points:xa,point:ka,lines:vi,line:Ta,triangles:eo,triangle:qn,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Jl=0,Ra=1,Ro=4,xu=5120,Ys=5121,zs=5122,rs=5123,Iu=5124,xo=5125,rf=34963,ul=35040,Ui=35044;function Hf(U,Pe,Ze,rr){var wr={},Xt=0,vr={uint8:Ys,uint16:rs};Pe.oes_element_index_uint&&(vr.uint32=xo);function Ur(an){this.id=Xt++,wr[this.id]=this,this.buffer=an,this.primType=Ro,this.vertCount=0,this.type=0}Ur.prototype.bind=function(){this.buffer.bind()};var Hr=[];function Jr(an){var Zt=Hr.pop();return Zt||(Zt=new Ur(Ze.create(null,rf,!0,!1)._buffer)),rn(Zt,an,ul,-1,-1,0,0),Zt}function Gr(an){Hr.push(an)}function rn(an,Zt,pr,Vr,mn,Br,Sn){an.buffer.bind();var zr;if(Zt){var un=Sn;!Sn&&(!O(Zt)||fo(Zt)&&!O(Zt.data))&&(un=Pe.oes_element_index_uint?xo:rs),Ze._initBuffer(an.buffer,Zt,pr,un,3)}else U.bufferData(rf,Br,pr),an.buffer.dtype=zr||Ys,an.buffer.usage=pr,an.buffer.dimension=3,an.buffer.byteLength=Br;if(zr=Sn,!Sn){switch(an.buffer.dtype){case Ys:case xu:zr=Ys;break;case rs:case zs:zr=rs;break;case xo:case Iu:zr=xo;break;default:V.raise("unsupported type for element array")}an.buffer.dtype=zr}an.type=zr,V(zr!==xo||!!Pe.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var kr=mn;kr<0&&(kr=an.buffer.byteLength,zr===rs?kr>>=1:zr===xo&&(kr>>=2)),an.vertCount=kr;var nn=Vr;if(Vr<0){nn=Ro;var Xn=an.buffer.dimension;Xn===1&&(nn=Jl),Xn===2&&(nn=Ra),Xn===3&&(nn=Ro)}an.primType=nn}function hn(an){rr.elementsCount--,V(an.buffer!==null,"must not double destroy elements"),delete wr[an.id],an.buffer.destroy(),an.buffer=null}function jr(an,Zt){var pr=Ze.create(null,rf,!0),Vr=new Ur(pr._buffer);rr.elementsCount++;function mn(Br){if(!Br)pr(),Vr.primType=Ro,Vr.vertCount=0,Vr.type=Ys;else if(typeof Br=="number")pr(Br),Vr.primType=Ro,Vr.vertCount=Br|0,Vr.type=Ys;else{var Sn=null,zr=Ui,un=-1,kr=-1,nn=0,Xn=0;Array.isArray(Br)||O(Br)||fo(Br)?Sn=Br:(V.type(Br,"object","invalid arguments for elements"),"data"in Br&&(Sn=Br.data,V(Array.isArray(Sn)||O(Sn)||fo(Sn),"invalid data for element buffer")),"usage"in Br&&(V.parameter(Br.usage,bs,"invalid element buffer usage"),zr=bs[Br.usage]),"primitive"in Br&&(V.parameter(Br.primitive,ba,"invalid element buffer primitive"),un=ba[Br.primitive]),"count"in Br&&(V(typeof Br.count=="number"&&Br.count>=0,"invalid vertex count for elements"),kr=Br.count|0),"type"in Br&&(V.parameter(Br.type,vr,"invalid buffer type"),Xn=vr[Br.type]),"length"in Br?nn=Br.length|0:(nn=kr,Xn===rs||Xn===zs?nn*=2:(Xn===xo||Xn===Iu)&&(nn*=4))),rn(Vr,Sn,zr,un,kr,nn,Xn)}return mn}return mn(an),mn._reglType="elements",mn._elements=Vr,mn.subdata=function(Br,Sn){return pr.subdata(Br,Sn),mn},mn.destroy=function(){hn(Vr)},mn}return{create:jr,createStream:Jr,destroyStream:Gr,getElements:function(an){return typeof an=="function"&&an._elements instanceof Ur?an._elements:null},clear:function(){Zi(wr).forEach(hn)}}}var Ql=new Float32Array(1),Sf=new Uint32Array(Ql.buffer),Ll=5123;function Ko(U){for(var Pe=Nt.allocType(Ll,U.length),Ze=0;Ze<U.length;++Ze)if(isNaN(U[Ze]))Pe[Ze]=65535;else if(U[Ze]===Infinity)Pe[Ze]=31744;else if(U[Ze]===-Infinity)Pe[Ze]=64512;else{Ql[0]=U[Ze];var rr=Sf[0],wr=rr>>>31<<15,Xt=(rr<<1>>>24)-127,vr=rr>>13&(1<<10)-1;if(Xt<-24)Pe[Ze]=wr;else if(Xt<-14){var Ur=-14-Xt;Pe[Ze]=wr+(vr+(1<<10)>>Ur)}else Xt>15?Pe[Ze]=wr+31744:Pe[Ze]=wr+(Xt+15<<10)+vr}return Pe}function Aa(U){return Array.isArray(U)||O(U)}var to=function(U){return!(U&U-1)&&!!U},Ks=34467,ns=3553,fc=34067,Rl=34069,bu=6408,Su=6406,Ou=6407,Zs=6409,Eu=6410,hc=32854,Gu=32855,ma=36194,Pc=32819,Ef=32820,ll=33635,nf=34042,Mc=6402,pc=34041,ql=35904,cl=35906,wu=36193,ec=33776,fl=33777,uu=33778,dc=33779,hl=35986,$s=35987,Ic=34798,Oc=35840,Lc=35841,Hu=35842,Dl=35843,tc=36196,Wu=5121,kl=5123,Rc=5125,Xu=5126,No=10242,af=10243,of=10497,Fl=33071,Dc=33648,Fa=10240,kc=10241,Yu=9728,Fc=9729,Cu=9984,Pa=9985,rc=9986,Lu=9987,Ku=33170,Hi=4352,Ma=4353,Us=4354,vc=34046,nc=3317,ic=37440,Of=37441,Lf=37443,ac=37444,$u=33984,Ru=[Cu,rc,Pa,Lu],ro=[0,Zs,Eu,Ou,bu],hs={};hs[Zs]=hs[Su]=hs[Mc]=1,hs[pc]=hs[Eu]=2,hs[Ou]=hs[ql]=3,hs[bu]=hs[cl]=4;function pl(U){return"[object "+U+"]"}var Va=pl("HTMLCanvasElement"),wn=pl("OffscreenCanvas"),js=pl("CanvasRenderingContext2D"),mc=pl("ImageBitmap"),Bl=pl("HTMLImageElement"),lu=pl("HTMLVideoElement"),Vs=Object.keys(Ua).concat([Va,wn,js,mc,Bl,lu]),dl=[];dl[Wu]=1,dl[Xu]=4,dl[wu]=2,dl[kl]=2,dl[Rc]=4;var $r=[];$r[hc]=2,$r[Gu]=2,$r[ma]=2,$r[pc]=4,$r[ec]=.5,$r[fl]=.5,$r[uu]=1,$r[dc]=1,$r[hl]=.5,$r[$s]=1,$r[Ic]=1,$r[Oc]=.5,$r[Lc]=.25,$r[Hu]=.5,$r[Dl]=.25,$r[tc]=.5;function Bc(U){return Array.isArray(U)&&(U.length===0||typeof U[0]=="number")}function gc(U){if(!Array.isArray(U))return!1;var Pe=U.length;return!(Pe===0||!Aa(U[0]))}function Ju(U){return Object.prototype.toString.call(U)}function Js(U){return Ju(U)===Va}function Ms(U){return Ju(U)===wn}function Nc(U){return Ju(U)===js}function zc(U){return Ju(U)===mc}function Gs(U){return Ju(U)===Bl}function Qu(U){return Ju(U)===lu}function Nl(U){if(!U)return!1;var Pe=Ju(U);return Vs.indexOf(Pe)>=0?!0:Bc(U)||gc(U)||fo(U)}function Du(U){return Ua[Object.prototype.toString.call(U)]|0}function Zc(U,Pe){var Ze=Pe.length;switch(U.type){case Wu:case kl:case Rc:case Xu:var rr=Nt.allocType(U.type,Ze);rr.set(Pe),U.data=rr;break;case wu:U.data=Ko(Pe);break;default:V.raise("unsupported texture type, must specify a typed array")}}function yc(U,Pe){return Nt.allocType(U.type===wu?Xu:U.type,Pe)}function cu(U,Pe){U.type===wu?(U.data=Ko(Pe),Nt.freeType(Pe)):U.data=Pe}function Is(U,Pe,Ze,rr,wr,Xt){for(var vr=U.width,Ur=U.height,Hr=U.channels,Jr=vr*Ur*Hr,Gr=yc(U,Jr),rn=0,hn=0;hn<Ur;++hn)for(var jr=0;jr<vr;++jr)for(var an=0;an<Hr;++an)Gr[rn++]=Pe[Ze*jr+rr*hn+wr*an+Xt];cu(U,Gr)}function Bi(U,Pe,Ze,rr,wr,Xt){var vr;if(typeof $r[U]!="undefined"?vr=$r[U]:vr=hs[U]*dl[Pe],Xt&&(vr*=6),wr){for(var Ur=0,Hr=Ze;Hr>=1;)Ur+=vr*Hr*Hr,Hr/=2;return Ur}else return vr*Ze*rr}function Qs(U,Pe,Ze,rr,wr,Xt,vr){var Ur={"don't care":Hi,"dont care":Hi,nice:Us,fast:Ma},Hr={repeat:of,clamp:Fl,mirror:Dc},Jr={nearest:Yu,linear:Fc},Gr=_({mipmap:Lu,"nearest mipmap nearest":Cu,"linear mipmap nearest":Pa,"nearest mipmap linear":rc,"linear mipmap linear":Lu},Jr),rn={none:0,browser:ac},hn={uint8:Wu,rgba4:Pc,rgb565:ll,"rgb5 a1":Ef},jr={alpha:Su,luminance:Zs,"luminance alpha":Eu,rgb:Ou,rgba:bu,rgba4:hc,"rgb5 a1":Gu,rgb565:ma},an={};Pe.ext_srgb&&(jr.srgb=ql,jr.srgba=cl),Pe.oes_texture_float&&(hn.float32=hn.float=Xu),Pe.oes_texture_half_float&&(hn.float16=hn["half float"]=wu),Pe.webgl_depth_texture&&(_(jr,{depth:Mc,"depth stencil":pc}),_(hn,{uint16:kl,uint32:Rc,"depth stencil":nf})),Pe.webgl_compressed_texture_s3tc&&_(an,{"rgb s3tc dxt1":ec,"rgba s3tc dxt1":fl,"rgba s3tc dxt3":uu,"rgba s3tc dxt5":dc}),Pe.webgl_compressed_texture_atc&&_(an,{"rgb atc":hl,"rgba atc explicit alpha":$s,"rgba atc interpolated alpha":Ic}),Pe.webgl_compressed_texture_pvrtc&&_(an,{"rgb pvrtc 4bppv1":Oc,"rgb pvrtc 2bppv1":Lc,"rgba pvrtc 4bppv1":Hu,"rgba pvrtc 2bppv1":Dl}),Pe.webgl_compressed_texture_etc1&&(an["rgb etc1"]=tc);var Zt=Array.prototype.slice.call(U.getParameter(Ks));Object.keys(an).forEach(function(Ve){var qt=an[Ve];Zt.indexOf(qt)>=0&&(jr[Ve]=qt)});var pr=Object.keys(jr);Ze.textureFormats=pr;var Vr=[];Object.keys(jr).forEach(function(Ve){var qt=jr[Ve];Vr[qt]=Ve});var mn=[];Object.keys(hn).forEach(function(Ve){var qt=hn[Ve];mn[qt]=Ve});var Br=[];Object.keys(Jr).forEach(function(Ve){var qt=Jr[Ve];Br[qt]=Ve});var Sn=[];Object.keys(Gr).forEach(function(Ve){var qt=Gr[Ve];Sn[qt]=Ve});var zr=[];Object.keys(Hr).forEach(function(Ve){var qt=Hr[Ve];zr[qt]=Ve});var un=pr.reduce(function(Ve,qt){var Kt=jr[qt];return Kt===Zs||Kt===Su||Kt===Zs||Kt===Eu||Kt===Mc||Kt===pc||Pe.ext_srgb&&(Kt===ql||Kt===cl)?Ve[Kt]=Kt:Kt===Gu||qt.indexOf("rgba")>=0?Ve[Kt]=bu:Ve[Kt]=Ou,Ve},{});function kr(){this.internalformat=bu,this.format=bu,this.type=Wu,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=ac,this.width=0,this.height=0,this.channels=0}function nn(Ve,qt){Ve.internalformat=qt.internalformat,Ve.format=qt.format,Ve.type=qt.type,Ve.compressed=qt.compressed,Ve.premultiplyAlpha=qt.premultiplyAlpha,Ve.flipY=qt.flipY,Ve.unpackAlignment=qt.unpackAlignment,Ve.colorSpace=qt.colorSpace,Ve.width=qt.width,Ve.height=qt.height,Ve.channels=qt.channels}function Xn(Ve,qt){if(!(typeof qt!="object"||!qt)){if("premultiplyAlpha"in qt&&(V.type(qt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ve.premultiplyAlpha=qt.premultiplyAlpha),"flipY"in qt&&(V.type(qt.flipY,"boolean","invalid texture flip"),Ve.flipY=qt.flipY),"alignment"in qt&&(V.oneOf(qt.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ve.unpackAlignment=qt.alignment),"colorSpace"in qt&&(V.parameter(qt.colorSpace,rn,"invalid colorSpace"),Ve.colorSpace=rn[qt.colorSpace]),"type"in qt){var Kt=qt.type;V(Pe.oes_texture_float||!(Kt==="float"||Kt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),V(Pe.oes_texture_half_float||!(Kt==="half float"||Kt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),V(Pe.webgl_depth_texture||!(Kt==="uint16"||Kt==="uint32"||Kt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),V.parameter(Kt,hn,"invalid texture type"),Ve.type=hn[Kt]}var Cn=Ve.width,Xi=Ve.height,Re=Ve.channels,xe=!1;"shape"in qt?(V(Array.isArray(qt.shape)&&qt.shape.length>=2,"shape must be an array"),Cn=qt.shape[0],Xi=qt.shape[1],qt.shape.length===3&&(Re=qt.shape[2],V(Re>0&&Re<=4,"invalid number of channels"),xe=!0),V(Cn>=0&&Cn<=Ze.maxTextureSize,"invalid width"),V(Xi>=0&&Xi<=Ze.maxTextureSize,"invalid height")):("radius"in qt&&(Cn=Xi=qt.radius,V(Cn>=0&&Cn<=Ze.maxTextureSize,"invalid radius")),"width"in qt&&(Cn=qt.width,V(Cn>=0&&Cn<=Ze.maxTextureSize,"invalid width")),"height"in qt&&(Xi=qt.height,V(Xi>=0&&Xi<=Ze.maxTextureSize,"invalid height")),"channels"in qt&&(Re=qt.channels,V(Re>0&&Re<=4,"invalid number of channels"),xe=!0)),Ve.width=Cn|0,Ve.height=Xi|0,Ve.channels=Re|0;var ot=!1;if("format"in qt){var Dt=qt.format;V(Pe.webgl_depth_texture||!(Dt==="depth"||Dt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),V.parameter(Dt,jr,"invalid texture format");var Mt=Ve.internalformat=jr[Dt];Ve.format=un[Mt],Dt in hn&&("type"in qt||(Ve.type=hn[Dt])),Dt in an&&(Ve.compressed=!0),ot=!0}!xe&&ot?Ve.channels=hs[Ve.format]:xe&&!ot?Ve.channels!==ro[Ve.format]&&(Ve.format=Ve.internalformat=ro[Ve.channels]):ot&&xe&&V(Ve.channels===hs[Ve.format],"number of channels inconsistent with specified format")}}function Kn(Ve){U.pixelStorei(ic,Ve.flipY),U.pixelStorei(Of,Ve.premultiplyAlpha),U.pixelStorei(Lf,Ve.colorSpace),U.pixelStorei(nc,Ve.unpackAlignment)}function sn(){kr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Nr(Ve,qt){var Kt=null;if(Nl(qt)?Kt=qt:qt&&(V.type(qt,"object","invalid pixel data type"),Xn(Ve,qt),"x"in qt&&(Ve.xOffset=qt.x|0),"y"in qt&&(Ve.yOffset=qt.y|0),Nl(qt.data)&&(Kt=qt.data)),V(!Ve.compressed||Kt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),qt.copy){V(!Kt,"can not specify copy and data field for the same texture");var Cn=wr.viewportWidth,Xi=wr.viewportHeight;Ve.width=Ve.width||Cn-Ve.xOffset,Ve.height=Ve.height||Xi-Ve.yOffset,Ve.needsCopy=!0,V(Ve.xOffset>=0&&Ve.xOffset<Cn&&Ve.yOffset>=0&&Ve.yOffset<Xi&&Ve.width>0&&Ve.width<=Cn&&Ve.height>0&&Ve.height<=Xi,"copy texture read out of bounds")}else if(!Kt)Ve.width=Ve.width||1,Ve.height=Ve.height||1,Ve.channels=Ve.channels||4;else if(O(Kt))Ve.channels=Ve.channels||4,Ve.data=Kt,!("type"in qt)&&Ve.type===Wu&&(Ve.type=Du(Kt));else if(Bc(Kt))Ve.channels=Ve.channels||4,Zc(Ve,Kt),Ve.alignment=1,Ve.needsFree=!0;else if(fo(Kt)){var Re=Kt.data;!Array.isArray(Re)&&Ve.type===Wu&&(Ve.type=Du(Re));var xe=Kt.shape,ot=Kt.stride,Dt,Mt,ft,st,Et,ke;xe.length===3?(ft=xe[2],ke=ot[2]):(V(xe.length===2,"invalid ndarray pixel data, must be 2 or 3D"),ft=1,ke=1),Dt=xe[0],Mt=xe[1],st=ot[0],Et=ot[1],Ve.alignment=1,Ve.width=Dt,Ve.height=Mt,Ve.channels=ft,Ve.format=Ve.internalformat=ro[ft],Ve.needsFree=!0,Is(Ve,Re,st,Et,ke,Kt.offset)}else if(Js(Kt)||Ms(Kt)||Nc(Kt))Js(Kt)||Ms(Kt)?Ve.element=Kt:Ve.element=Kt.canvas,Ve.width=Ve.element.width,Ve.height=Ve.element.height,Ve.channels=4;else if(zc(Kt))Ve.element=Kt,Ve.width=Kt.width,Ve.height=Kt.height,Ve.channels=4;else if(Gs(Kt))Ve.element=Kt,Ve.width=Kt.naturalWidth,Ve.height=Kt.naturalHeight,Ve.channels=4;else if(Qu(Kt))Ve.element=Kt,Ve.width=Kt.videoWidth,Ve.height=Kt.videoHeight,Ve.channels=4;else if(gc(Kt)){var nt=Ve.width||Kt[0].length,Oe=Ve.height||Kt.length,Tt=Ve.channels;Aa(Kt[0][0])?Tt=Tt||Kt[0][0].length:Tt=Tt||1;for(var jt=pe.shape(Kt),Er=1,$t=0;$t<jt.length;++$t)Er*=jt[$t];var xr=yc(Ve,Er);pe.flatten(Kt,jt,"",xr),cu(Ve,xr),Ve.alignment=1,Ve.width=nt,Ve.height=Oe,Ve.channels=Tt,Ve.format=Ve.internalformat=ro[Tt],Ve.needsFree=!0}Ve.type===Xu?V(Ze.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ve.type===wu&&V(Ze.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Ir(Ve,qt,Kt){var Cn=Ve.element,Xi=Ve.data,Re=Ve.internalformat,xe=Ve.format,ot=Ve.type,Dt=Ve.width,Mt=Ve.height;Kn(Ve),Cn?U.texImage2D(qt,Kt,xe,xe,ot,Cn):Ve.compressed?U.compressedTexImage2D(qt,Kt,Re,Dt,Mt,0,Xi):Ve.needsCopy?(rr(),U.copyTexImage2D(qt,Kt,xe,Ve.xOffset,Ve.yOffset,Dt,Mt,0)):U.texImage2D(qt,Kt,xe,Dt,Mt,0,xe,ot,Xi||null)}function si(Ve,qt,Kt,Cn,Xi){var Re=Ve.element,xe=Ve.data,ot=Ve.internalformat,Dt=Ve.format,Mt=Ve.type,ft=Ve.width,st=Ve.height;Kn(Ve),Re?U.texSubImage2D(qt,Xi,Kt,Cn,Dt,Mt,Re):Ve.compressed?U.compressedTexSubImage2D(qt,Xi,Kt,Cn,ot,ft,st,xe):Ve.needsCopy?(rr(),U.copyTexSubImage2D(qt,Xi,Kt,Cn,Ve.xOffset,Ve.yOffset,ft,st)):U.texSubImage2D(qt,Xi,Kt,Cn,ft,st,Dt,Mt,xe)}var ui=[];function kn(){return ui.pop()||new sn}function ea(Ve){Ve.needsFree&&Nt.freeType(Ve.data),sn.call(Ve),ui.push(Ve)}function Pi(){kr.call(this),this.genMipmaps=!1,this.mipmapHint=Hi,this.mipmask=0,this.images=Array(16)}function ji(Ve,qt,Kt){var Cn=Ve.images[0]=kn();Ve.mipmask=1,Cn.width=Ve.width=qt,Cn.height=Ve.height=Kt,Cn.channels=Ve.channels=4}function fa(Ve,qt){var Kt=null;if(Nl(qt))Kt=Ve.images[0]=kn(),nn(Kt,Ve),Nr(Kt,qt),Ve.mipmask=1;else if(Xn(Ve,qt),Array.isArray(qt.mipmap))for(var Cn=qt.mipmap,Xi=0;Xi<Cn.length;++Xi)Kt=Ve.images[Xi]=kn(),nn(Kt,Ve),Kt.width>>=Xi,Kt.height>>=Xi,Nr(Kt,Cn[Xi]),Ve.mipmask|=1<<Xi;else Kt=Ve.images[0]=kn(),nn(Kt,Ve),Nr(Kt,qt),Ve.mipmask=1;nn(Ve,Ve.images[0]),Ve.compressed&&(Ve.internalformat===ec||Ve.internalformat===fl||Ve.internalformat===uu||Ve.internalformat===dc)&&V(Ve.width%4==0&&Ve.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Jo(Ve,qt){for(var Kt=Ve.images,Cn=0;Cn<Kt.length;++Cn){if(!Kt[Cn])return;Ir(Kt[Cn],qt,Cn)}}var ss=[];function $i(){var Ve=ss.pop()||new Pi;kr.call(Ve),Ve.mipmask=0;for(var qt=0;qt<16;++qt)Ve.images[qt]=null;return Ve}function vo(Ve){for(var qt=Ve.images,Kt=0;Kt<qt.length;++Kt)qt[Kt]&&ea(qt[Kt]),qt[Kt]=null;ss.push(Ve)}function so(){this.minFilter=Yu,this.magFilter=Yu,this.wrapS=Fl,this.wrapT=Fl,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Hi}function Qo(Ve,qt){if("min"in qt){var Kt=qt.min;V.parameter(Kt,Gr),Ve.minFilter=Gr[Kt],Ru.indexOf(Ve.minFilter)>=0&&!("faces"in qt)&&(Ve.genMipmaps=!0)}if("mag"in qt){var Cn=qt.mag;V.parameter(Cn,Jr),Ve.magFilter=Jr[Cn]}var Xi=Ve.wrapS,Re=Ve.wrapT;if("wrap"in qt){var xe=qt.wrap;typeof xe=="string"?(V.parameter(xe,Hr),Xi=Re=Hr[xe]):Array.isArray(xe)&&(V.parameter(xe[0],Hr),V.parameter(xe[1],Hr),Xi=Hr[xe[0]],Re=Hr[xe[1]])}else{if("wrapS"in qt){var ot=qt.wrapS;V.parameter(ot,Hr),Xi=Hr[ot]}if("wrapT"in qt){var Dt=qt.wrapT;V.parameter(Dt,Hr),Re=Hr[Dt]}}if(Ve.wrapS=Xi,Ve.wrapT=Re,"anisotropic"in qt){var Mt=qt.anisotropic;V(typeof Mt=="number"&&Mt>=1&&Mt<=Ze.maxAnisotropic,"aniso samples must be between 1 and "),Ve.anisotropic=qt.anisotropic}if("mipmap"in qt){var ft=!1;switch(typeof qt.mipmap){case"string":V.parameter(qt.mipmap,Ur,"invalid mipmap hint"),Ve.mipmapHint=Ur[qt.mipmap],Ve.genMipmaps=!0,ft=!0;break;case"boolean":ft=Ve.genMipmaps=qt.mipmap;break;case"object":V(Array.isArray(qt.mipmap),"invalid mipmap type"),Ve.genMipmaps=!1,ft=!0;break;default:V.raise("invalid mipmap type")}ft&&!("min"in qt)&&(Ve.minFilter=Cu)}}function ys(Ve,qt){U.texParameteri(qt,kc,Ve.minFilter),U.texParameteri(qt,Fa,Ve.magFilter),U.texParameteri(qt,No,Ve.wrapS),U.texParameteri(qt,af,Ve.wrapT),Pe.ext_texture_filter_anisotropic&&U.texParameteri(qt,vc,Ve.anisotropic),Ve.genMipmaps&&(U.hint(Ku,Ve.mipmapHint),U.generateMipmap(qt))}var Es=0,ks={},_s=Ze.maxTextureUnits,Fo=Array(_s).map(function(){return null});function Ni(Ve){kr.call(this),this.mipmask=0,this.internalformat=bu,this.id=Es++,this.refCount=1,this.target=Ve,this.texture=U.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new so,vr.profile&&(this.stats={size:0})}function Fs(Ve){U.activeTexture($u),U.bindTexture(Ve.target,Ve.texture)}function Sa(){var Ve=Fo[0];Ve?U.bindTexture(Ve.target,Ve.texture):U.bindTexture(ns,null)}function li(Ve){var qt=Ve.texture;V(qt,"must not double destroy texture");var Kt=Ve.unit,Cn=Ve.target;Kt>=0&&(U.activeTexture($u+Kt),U.bindTexture(Cn,null),Fo[Kt]=null),U.deleteTexture(qt),Ve.texture=null,Ve.params=null,Ve.pixels=null,Ve.refCount=0,delete ks[Ve.id],Xt.textureCount--}_(Ni.prototype,{bind:function(){var Ve=this;Ve.bindCount+=1;var qt=Ve.unit;if(qt<0){for(var Kt=0;Kt<_s;++Kt){var Cn=Fo[Kt];if(Cn){if(Cn.bindCount>0)continue;Cn.unit=-1}Fo[Kt]=Ve,qt=Kt;break}qt>=_s&&V.raise("insufficient number of texture units"),vr.profile&&Xt.maxTextureUnits<qt+1&&(Xt.maxTextureUnits=qt+1),Ve.unit=qt,U.activeTexture($u+qt),U.bindTexture(Ve.target,Ve.texture)}return qt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&li(this)}});function Wi(Ve,qt){var Kt=new Ni(ns);ks[Kt.id]=Kt,Xt.textureCount++;function Cn(xe,ot){var Dt=Kt.texInfo;so.call(Dt);var Mt=$i();return typeof xe=="number"?typeof ot=="number"?ji(Mt,xe|0,ot|0):ji(Mt,xe|0,xe|0):xe?(V.type(xe,"object","invalid arguments to regl.texture"),Qo(Dt,xe),fa(Mt,xe)):ji(Mt,1,1),Dt.genMipmaps&&(Mt.mipmask=(Mt.width<<1)-1),Kt.mipmask=Mt.mipmask,nn(Kt,Mt),V.texture2D(Dt,Mt,Ze),Kt.internalformat=Mt.internalformat,Cn.width=Mt.width,Cn.height=Mt.height,Fs(Kt),Jo(Mt,ns),ys(Dt,ns),Sa(),vo(Mt),vr.profile&&(Kt.stats.size=Bi(Kt.internalformat,Kt.type,Mt.width,Mt.height,Dt.genMipmaps,!1)),Cn.format=Vr[Kt.internalformat],Cn.type=mn[Kt.type],Cn.mag=Br[Dt.magFilter],Cn.min=Sn[Dt.minFilter],Cn.wrapS=zr[Dt.wrapS],Cn.wrapT=zr[Dt.wrapT],Cn}function Xi(xe,ot,Dt,Mt){V(!!xe,"must specify image data");var ft=ot|0,st=Dt|0,Et=Mt|0,ke=kn();return nn(ke,Kt),ke.width=0,ke.height=0,Nr(ke,xe),ke.width=ke.width||(Kt.width>>Et)-ft,ke.height=ke.height||(Kt.height>>Et)-st,V(Kt.type===ke.type&&Kt.format===ke.format&&Kt.internalformat===ke.internalformat,"incompatible format for texture.subimage"),V(ft>=0&&st>=0&&ft+ke.width<=Kt.width&&st+ke.height<=Kt.height,"texture.subimage write out of bounds"),V(Kt.mipmask&1<<Et,"missing mipmap data"),V(ke.data||ke.element||ke.needsCopy,"missing image data"),Fs(Kt),si(ke,ns,ft,st,Et),Sa(),ea(ke),Cn}function Re(xe,ot){var Dt=xe|0,Mt=ot|0||Dt;if(Dt===Kt.width&&Mt===Kt.height)return Cn;Cn.width=Kt.width=Dt,Cn.height=Kt.height=Mt,Fs(Kt);for(var ft=0;Kt.mipmask>>ft;++ft){var st=Dt>>ft,Et=Mt>>ft;if(!st||!Et)break;U.texImage2D(ns,ft,Kt.format,st,Et,0,Kt.format,Kt.type,null)}return Sa(),vr.profile&&(Kt.stats.size=Bi(Kt.internalformat,Kt.type,Dt,Mt,!1,!1)),Cn}return Cn(Ve,qt),Cn.subimage=Xi,Cn.resize=Re,Cn._reglType="texture2d",Cn._texture=Kt,vr.profile&&(Cn.stats=Kt.stats),Cn.destroy=function(){Kt.decRef()},Cn}function oa(Ve,qt,Kt,Cn,Xi,Re){var xe=new Ni(fc);ks[xe.id]=xe,Xt.cubeCount++;var ot=new Array(6);function Dt(st,Et,ke,nt,Oe,Tt){var jt,Er=xe.texInfo;for(so.call(Er),jt=0;jt<6;++jt)ot[jt]=$i();if(typeof st=="number"||!st){var $t=st|0||1;for(jt=0;jt<6;++jt)ji(ot[jt],$t,$t)}else if(typeof st=="object")if(Et)fa(ot[0],st),fa(ot[1],Et),fa(ot[2],ke),fa(ot[3],nt),fa(ot[4],Oe),fa(ot[5],Tt);else if(Qo(Er,st),Xn(xe,st),"faces"in st){var xr=st.faces;for(V(Array.isArray(xr)&&xr.length===6,"cube faces must be a length 6 array"),jt=0;jt<6;++jt)V(typeof xr[jt]=="object"&&!!xr[jt],"invalid input for cube map face"),nn(ot[jt],xe),fa(ot[jt],xr[jt])}else for(jt=0;jt<6;++jt)fa(ot[jt],st);else V.raise("invalid arguments to cube map");for(nn(xe,ot[0]),Ze.npotTextureCube||V(to(xe.width)&&to(xe.height),"your browser does not support non power or two texture dimensions"),Er.genMipmaps?xe.mipmask=(ot[0].width<<1)-1:xe.mipmask=ot[0].mipmask,V.textureCube(xe,Er,ot,Ze),xe.internalformat=ot[0].internalformat,Dt.width=ot[0].width,Dt.height=ot[0].height,Fs(xe),jt=0;jt<6;++jt)Jo(ot[jt],Rl+jt);for(ys(Er,fc),Sa(),vr.profile&&(xe.stats.size=Bi(xe.internalformat,xe.type,Dt.width,Dt.height,Er.genMipmaps,!0)),Dt.format=Vr[xe.internalformat],Dt.type=mn[xe.type],Dt.mag=Br[Er.magFilter],Dt.min=Sn[Er.minFilter],Dt.wrapS=zr[Er.wrapS],Dt.wrapT=zr[Er.wrapT],jt=0;jt<6;++jt)vo(ot[jt]);return Dt}function Mt(st,Et,ke,nt,Oe){V(!!Et,"must specify image data"),V(typeof st=="number"&&st===(st|0)&&st>=0&&st<6,"invalid face");var Tt=ke|0,jt=nt|0,Er=Oe|0,$t=kn();return nn($t,xe),$t.width=0,$t.height=0,Nr($t,Et),$t.width=$t.width||(xe.width>>Er)-Tt,$t.height=$t.height||(xe.height>>Er)-jt,V(xe.type===$t.type&&xe.format===$t.format&&xe.internalformat===$t.internalformat,"incompatible format for texture.subimage"),V(Tt>=0&&jt>=0&&Tt+$t.width<=xe.width&&jt+$t.height<=xe.height,"texture.subimage write out of bounds"),V(xe.mipmask&1<<Er,"missing mipmap data"),V($t.data||$t.element||$t.needsCopy,"missing image data"),Fs(xe),si($t,Rl+st,Tt,jt,Er),Sa(),ea($t),Dt}function ft(st){var Et=st|0;if(Et!==xe.width){Dt.width=xe.width=Et,Dt.height=xe.height=Et,Fs(xe);for(var ke=0;ke<6;++ke)for(var nt=0;xe.mipmask>>nt;++nt)U.texImage2D(Rl+ke,nt,xe.format,Et>>nt,Et>>nt,0,xe.format,xe.type,null);return Sa(),vr.profile&&(xe.stats.size=Bi(xe.internalformat,xe.type,Dt.width,Dt.height,!1,!0)),Dt}}return Dt(Ve,qt,Kt,Cn,Xi,Re),Dt.subimage=Mt,Dt.resize=ft,Dt._reglType="textureCube",Dt._texture=xe,vr.profile&&(Dt.stats=xe.stats),Dt.destroy=function(){xe.decRef()},Dt}function qo(){for(var Ve=0;Ve<_s;++Ve)U.activeTexture($u+Ve),U.bindTexture(ns,null),Fo[Ve]=null;Zi(ks).forEach(li),Xt.cubeCount=0,Xt.textureCount=0}vr.profile&&(Xt.getTotalTextureSize=function(){var Ve=0;return Object.keys(ks).forEach(function(qt){Ve+=ks[qt].stats.size}),Ve});function El(){for(var Ve=0;Ve<_s;++Ve){var qt=Fo[Ve];qt&&(qt.bindCount=0,qt.unit=-1,Fo[Ve]=null)}Zi(ks).forEach(function(Kt){Kt.texture=U.createTexture(),U.bindTexture(Kt.target,Kt.texture);for(var Cn=0;Cn<32;++Cn)if((Kt.mipmask&1<<Cn)!=0)if(Kt.target===ns)U.texImage2D(ns,Cn,Kt.internalformat,Kt.width>>Cn,Kt.height>>Cn,0,Kt.internalformat,Kt.type,null);else for(var Xi=0;Xi<6;++Xi)U.texImage2D(Rl+Xi,Cn,Kt.internalformat,Kt.width>>Cn,Kt.height>>Cn,0,Kt.internalformat,Kt.type,null);ys(Kt.texInfo,Kt.target)})}function wl(){for(var Ve=0;Ve<_s;++Ve){var qt=Fo[Ve];qt&&(qt.bindCount=0,qt.unit=-1,Fo[Ve]=null),U.activeTexture($u+Ve),U.bindTexture(ns,null),U.bindTexture(fc,null)}}return{create2D:Wi,createCube:oa,clear:qo,getTexture:function(Ve){return null},restore:El,refresh:wl}}var $o=36161,Ao=32854,vl=32855,qu=36194,fu=33189,is=36168,zl=34041,Un=35907,On=34836,Zl=34842,ps=34843,Do=[];Do[Ao]=2,Do[vl]=2,Do[qu]=2,Do[fu]=2,Do[is]=1,Do[zl]=4,Do[Un]=4,Do[On]=16,Do[Zl]=8,Do[ps]=6;function zo(U,Pe,Ze){return Do[U]*Pe*Ze}var ku=function(U,Pe,Ze,rr,wr){var Xt={rgba4:Ao,rgb565:qu,"rgb5 a1":vl,depth:fu,stencil:is,"depth stencil":zl};Pe.ext_srgb&&(Xt.srgba=Un),Pe.ext_color_buffer_half_float&&(Xt.rgba16f=Zl,Xt.rgb16f=ps),Pe.webgl_color_buffer_float&&(Xt.rgba32f=On);var vr=[];Object.keys(Xt).forEach(function(jr){var an=Xt[jr];vr[an]=jr});var Ur=0,Hr={};function Jr(jr){this.id=Ur++,this.refCount=1,this.renderbuffer=jr,this.format=Ao,this.width=0,this.height=0,wr.profile&&(this.stats={size:0})}Jr.prototype.decRef=function(){--this.refCount<=0&&Gr(this)};function Gr(jr){var an=jr.renderbuffer;V(an,"must not double destroy renderbuffer"),U.bindRenderbuffer($o,null),U.deleteRenderbuffer(an),jr.renderbuffer=null,jr.refCount=0,delete Hr[jr.id],rr.renderbufferCount--}function rn(jr,an){var Zt=new Jr(U.createRenderbuffer());Hr[Zt.id]=Zt,rr.renderbufferCount++;function pr(mn,Br){var Sn=0,zr=0,un=Ao;if(typeof mn=="object"&&mn){var kr=mn;if("shape"in kr){var nn=kr.shape;V(Array.isArray(nn)&&nn.length>=2,"invalid renderbuffer shape"),Sn=nn[0]|0,zr=nn[1]|0}else"radius"in kr&&(Sn=zr=kr.radius|0),"width"in kr&&(Sn=kr.width|0),"height"in kr&&(zr=kr.height|0);"format"in kr&&(V.parameter(kr.format,Xt,"invalid renderbuffer format"),un=Xt[kr.format])}else typeof mn=="number"?(Sn=mn|0,typeof Br=="number"?zr=Br|0:zr=Sn):mn?V.raise("invalid arguments to renderbuffer constructor"):Sn=zr=1;if(V(Sn>0&&zr>0&&Sn<=Ze.maxRenderbufferSize&&zr<=Ze.maxRenderbufferSize,"invalid renderbuffer size"),!(Sn===Zt.width&&zr===Zt.height&&un===Zt.format))return pr.width=Zt.width=Sn,pr.height=Zt.height=zr,Zt.format=un,U.bindRenderbuffer($o,Zt.renderbuffer),U.renderbufferStorage($o,un,Sn,zr),V(U.getError()===0,"invalid render buffer format"),wr.profile&&(Zt.stats.size=zo(Zt.format,Zt.width,Zt.height)),pr.format=vr[Zt.format],pr}function Vr(mn,Br){var Sn=mn|0,zr=Br|0||Sn;return Sn===Zt.width&&zr===Zt.height||(V(Sn>0&&zr>0&&Sn<=Ze.maxRenderbufferSize&&zr<=Ze.maxRenderbufferSize,"invalid renderbuffer size"),pr.width=Zt.width=Sn,pr.height=Zt.height=zr,U.bindRenderbuffer($o,Zt.renderbuffer),U.renderbufferStorage($o,Zt.format,Sn,zr),V(U.getError()===0,"invalid render buffer format"),wr.profile&&(Zt.stats.size=zo(Zt.format,Zt.width,Zt.height))),pr}return pr(jr,an),pr.resize=Vr,pr._reglType="renderbuffer",pr._renderbuffer=Zt,wr.profile&&(pr.stats=Zt.stats),pr.destroy=function(){Zt.decRef()},pr}wr.profile&&(rr.getTotalRenderbufferSize=function(){var jr=0;return Object.keys(Hr).forEach(function(an){jr+=Hr[an].stats.size}),jr});function hn(){Zi(Hr).forEach(function(jr){jr.renderbuffer=U.createRenderbuffer(),U.bindRenderbuffer($o,jr.renderbuffer),U.renderbufferStorage($o,jr.format,jr.width,jr.height)}),U.bindRenderbuffer($o,null)}return{create:rn,clear:function(){Zi(Hr).forEach(Gr)},restore:hn}},hu=36160,Ul=36161,ra=3553,po=34069,Uc=36064,Fu=36096,_c=36128,Bu=33306,Os=36053,oc=36054,as=36055,xc=36057,jl=36061,sc=36193,jc=5121,uc=5126,ml=6407,Vc=6408,gl=6402,yl=[ml,Vc],_l=[];_l[Vc]=4,_l[ml]=3;var pu=[];pu[jc]=1,pu[uc]=4,pu[sc]=2;var qs=32854,Gc=32855,bc=36194,sf=33189,Sc=36168,i=34041,u=35907,a=34836,h=34842,g=34843,S=[qs,Gc,bc,u,h,g,a],T={};T[Os]="complete",T[oc]="incomplete attachment",T[xc]="incomplete dimensions",T[as]="incomplete, missing attachment",T[jl]="unsupported";function R(U,Pe,Ze,rr,wr,Xt){var vr={cur:null,next:null,dirty:!1,setFBO:null},Ur=["rgba"],Hr=["rgba4","rgb565","rgb5 a1"];Pe.ext_srgb&&Hr.push("srgba"),Pe.ext_color_buffer_half_float&&Hr.push("rgba16f","rgb16f"),Pe.webgl_color_buffer_float&&Hr.push("rgba32f");var Jr=["uint8"];Pe.oes_texture_half_float&&Jr.push("half float","float16"),Pe.oes_texture_float&&Jr.push("float","float32");function Gr(sn,Nr,Ir){this.target=sn,this.texture=Nr,this.renderbuffer=Ir;var si=0,ui=0;Nr?(si=Nr.width,ui=Nr.height):Ir&&(si=Ir.width,ui=Ir.height),this.width=si,this.height=ui}function rn(sn){sn&&(sn.texture&&sn.texture._texture.decRef(),sn.renderbuffer&&sn.renderbuffer._renderbuffer.decRef())}function hn(sn,Nr,Ir){if(!!sn)if(sn.texture){var si=sn.texture._texture,ui=Math.max(1,si.width),kn=Math.max(1,si.height);V(ui===Nr&&kn===Ir,"inconsistent width/height for supplied texture"),si.refCount+=1}else{var ea=sn.renderbuffer._renderbuffer;V(ea.width===Nr&&ea.height===Ir,"inconsistent width/height for renderbuffer"),ea.refCount+=1}}function jr(sn,Nr){Nr&&(Nr.texture?U.framebufferTexture2D(hu,sn,Nr.target,Nr.texture._texture.texture,0):U.framebufferRenderbuffer(hu,sn,Ul,Nr.renderbuffer._renderbuffer.renderbuffer))}function an(sn){var Nr=ra,Ir=null,si=null,ui=sn;typeof sn=="object"&&(ui=sn.data,"target"in sn&&(Nr=sn.target|0)),V.type(ui,"function","invalid attachment data");var kn=ui._reglType;return kn==="texture2d"?(Ir=ui,V(Nr===ra)):kn==="textureCube"?(Ir=ui,V(Nr>=po&&Nr<po+6,"invalid cube map target")):kn==="renderbuffer"?(si=ui,Nr=Ul):V.raise("invalid regl object for attachment"),new Gr(Nr,Ir,si)}function Zt(sn,Nr,Ir,si,ui){if(Ir){var kn=rr.create2D({width:sn,height:Nr,format:si,type:ui});return kn._texture.refCount=0,new Gr(ra,kn,null)}else{var ea=wr.create({width:sn,height:Nr,format:si});return ea._renderbuffer.refCount=0,new Gr(Ul,null,ea)}}function pr(sn){return sn&&(sn.texture||sn.renderbuffer)}function Vr(sn,Nr,Ir){sn&&(sn.texture?sn.texture.resize(Nr,Ir):sn.renderbuffer&&sn.renderbuffer.resize(Nr,Ir),sn.width=Nr,sn.height=Ir)}var mn=0,Br={};function Sn(){this.id=mn++,Br[this.id]=this,this.framebuffer=U.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function zr(sn){sn.colorAttachments.forEach(rn),rn(sn.depthAttachment),rn(sn.stencilAttachment),rn(sn.depthStencilAttachment)}function un(sn){var Nr=sn.framebuffer;V(Nr,"must not double destroy framebuffer"),U.deleteFramebuffer(Nr),sn.framebuffer=null,Xt.framebufferCount--,delete Br[sn.id]}function kr(sn){var Nr;U.bindFramebuffer(hu,sn.framebuffer);var Ir=sn.colorAttachments;for(Nr=0;Nr<Ir.length;++Nr)jr(Uc+Nr,Ir[Nr]);for(Nr=Ir.length;Nr<Ze.maxColorAttachments;++Nr)U.framebufferTexture2D(hu,Uc+Nr,ra,null,0);U.framebufferTexture2D(hu,Bu,ra,null,0),U.framebufferTexture2D(hu,Fu,ra,null,0),U.framebufferTexture2D(hu,_c,ra,null,0),jr(Fu,sn.depthAttachment),jr(_c,sn.stencilAttachment),jr(Bu,sn.depthStencilAttachment);var si=U.checkFramebufferStatus(hu);!U.isContextLost()&&si!==Os&&V.raise("framebuffer configuration not supported, status = "+T[si]),U.bindFramebuffer(hu,vr.next?vr.next.framebuffer:null),vr.cur=vr.next,U.getError()}function nn(sn,Nr){var Ir=new Sn;Xt.framebufferCount++;function si(kn,ea){var Pi;V(vr.next!==Ir,"can not update framebuffer which is currently in use");var ji=0,fa=0,Jo=!0,ss=!0,$i=null,vo=!0,so="rgba",Qo="uint8",ys=1,Es=null,ks=null,_s=null,Fo=!1;if(typeof kn=="number")ji=kn|0,fa=ea|0||ji;else if(!kn)ji=fa=1;else{V.type(kn,"object","invalid arguments for framebuffer");var Ni=kn;if("shape"in Ni){var Fs=Ni.shape;V(Array.isArray(Fs)&&Fs.length>=2,"invalid shape for framebuffer"),ji=Fs[0],fa=Fs[1]}else"radius"in Ni&&(ji=fa=Ni.radius),"width"in Ni&&(ji=Ni.width),"height"in Ni&&(fa=Ni.height);("color"in Ni||"colors"in Ni)&&($i=Ni.color||Ni.colors,Array.isArray($i)&&V($i.length===1||Pe.webgl_draw_buffers,"multiple render targets not supported")),$i||("colorCount"in Ni&&(ys=Ni.colorCount|0,V(ys>0,"invalid color buffer count")),"colorTexture"in Ni&&(vo=!!Ni.colorTexture,so="rgba4"),"colorType"in Ni&&(Qo=Ni.colorType,vo?(V(Pe.oes_texture_float||!(Qo==="float"||Qo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),V(Pe.oes_texture_half_float||!(Qo==="half float"||Qo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Qo==="half float"||Qo==="float16"?(V(Pe.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),so="rgba16f"):(Qo==="float"||Qo==="float32")&&(V(Pe.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),so="rgba32f"),V.oneOf(Qo,Jr,"invalid color type")),"colorFormat"in Ni&&(so=Ni.colorFormat,Ur.indexOf(so)>=0?vo=!0:Hr.indexOf(so)>=0?vo=!1:vo?V.oneOf(Ni.colorFormat,Ur,"invalid color format for texture"):V.oneOf(Ni.colorFormat,Hr,"invalid color format for renderbuffer"))),("depthTexture"in Ni||"depthStencilTexture"in Ni)&&(Fo=!!(Ni.depthTexture||Ni.depthStencilTexture),V(!Fo||Pe.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Ni&&(typeof Ni.depth=="boolean"?Jo=Ni.depth:(Es=Ni.depth,ss=!1)),"stencil"in Ni&&(typeof Ni.stencil=="boolean"?ss=Ni.stencil:(ks=Ni.stencil,Jo=!1)),"depthStencil"in Ni&&(typeof Ni.depthStencil=="boolean"?Jo=ss=Ni.depthStencil:(_s=Ni.depthStencil,Jo=!1,ss=!1))}var Sa=null,li=null,Wi=null,oa=null;if(Array.isArray($i))Sa=$i.map(an);else if($i)Sa=[an($i)];else for(Sa=new Array(ys),Pi=0;Pi<ys;++Pi)Sa[Pi]=Zt(ji,fa,vo,so,Qo);V(Pe.webgl_draw_buffers||Sa.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),V(Sa.length<=Ze.maxColorAttachments,"too many color attachments, not supported"),ji=ji||Sa[0].width,fa=fa||Sa[0].height,Es?li=an(Es):Jo&&!ss&&(li=Zt(ji,fa,Fo,"depth","uint32")),ks?Wi=an(ks):ss&&!Jo&&(Wi=Zt(ji,fa,!1,"stencil","uint8")),_s?oa=an(_s):!Es&&!ks&&ss&&Jo&&(oa=Zt(ji,fa,Fo,"depth stencil","depth stencil")),V(!!Es+!!ks+!!_s<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var qo=null;for(Pi=0;Pi<Sa.length;++Pi)if(hn(Sa[Pi],ji,fa),V(!Sa[Pi]||Sa[Pi].texture&&yl.indexOf(Sa[Pi].texture._texture.format)>=0||Sa[Pi].renderbuffer&&S.indexOf(Sa[Pi].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Pi+" is invalid"),Sa[Pi]&&Sa[Pi].texture){var El=_l[Sa[Pi].texture._texture.format]*pu[Sa[Pi].texture._texture.type];qo===null?qo=El:V(qo===El,"all color attachments much have the same number of bits per pixel.")}return hn(li,ji,fa),V(!li||li.texture&&li.texture._texture.format===gl||li.renderbuffer&&li.renderbuffer._renderbuffer.format===sf,"invalid depth attachment for framebuffer object"),hn(Wi,ji,fa),V(!Wi||Wi.renderbuffer&&Wi.renderbuffer._renderbuffer.format===Sc,"invalid stencil attachment for framebuffer object"),hn(oa,ji,fa),V(!oa||oa.texture&&oa.texture._texture.format===i||oa.renderbuffer&&oa.renderbuffer._renderbuffer.format===i,"invalid depth-stencil attachment for framebuffer object"),zr(Ir),Ir.width=ji,Ir.height=fa,Ir.colorAttachments=Sa,Ir.depthAttachment=li,Ir.stencilAttachment=Wi,Ir.depthStencilAttachment=oa,si.color=Sa.map(pr),si.depth=pr(li),si.stencil=pr(Wi),si.depthStencil=pr(oa),si.width=Ir.width,si.height=Ir.height,kr(Ir),si}function ui(kn,ea){V(vr.next!==Ir,"can not resize a framebuffer which is currently in use");var Pi=Math.max(kn|0,1),ji=Math.max(ea|0||Pi,1);if(Pi===Ir.width&&ji===Ir.height)return si;for(var fa=Ir.colorAttachments,Jo=0;Jo<fa.length;++Jo)Vr(fa[Jo],Pi,ji);return Vr(Ir.depthAttachment,Pi,ji),Vr(Ir.stencilAttachment,Pi,ji),Vr(Ir.depthStencilAttachment,Pi,ji),Ir.width=si.width=Pi,Ir.height=si.height=ji,kr(Ir),si}return si(sn,Nr),_(si,{resize:ui,_reglType:"framebuffer",_framebuffer:Ir,destroy:function(){un(Ir),zr(Ir)},use:function(kn){vr.setFBO({framebuffer:si},kn)}})}function Xn(sn){var Nr=Array(6);function Ir(ui){var kn;V(Nr.indexOf(vr.next)<0,"can not update framebuffer which is currently in use");var ea={color:null},Pi=0,ji=null,fa="rgba",Jo="uint8",ss=1;if(typeof ui=="number")Pi=ui|0;else if(!ui)Pi=1;else{V.type(ui,"object","invalid arguments for framebuffer");var $i=ui;if("shape"in $i){var vo=$i.shape;V(Array.isArray(vo)&&vo.length>=2,"invalid shape for framebuffer"),V(vo[0]===vo[1],"cube framebuffer must be square"),Pi=vo[0]}else"radius"in $i&&(Pi=$i.radius|0),"width"in $i?(Pi=$i.width|0,"height"in $i&&V($i.height===Pi,"must be square")):"height"in $i&&(Pi=$i.height|0);("color"in $i||"colors"in $i)&&(ji=$i.color||$i.colors,Array.isArray(ji)&&V(ji.length===1||Pe.webgl_draw_buffers,"multiple render targets not supported")),ji||("colorCount"in $i&&(ss=$i.colorCount|0,V(ss>0,"invalid color buffer count")),"colorType"in $i&&(V.oneOf($i.colorType,Jr,"invalid color type"),Jo=$i.colorType),"colorFormat"in $i&&(fa=$i.colorFormat,V.oneOf($i.colorFormat,Ur,"invalid color format for texture"))),"depth"in $i&&(ea.depth=$i.depth),"stencil"in $i&&(ea.stencil=$i.stencil),"depthStencil"in $i&&(ea.depthStencil=$i.depthStencil)}var so;if(ji)if(Array.isArray(ji))for(so=[],kn=0;kn<ji.length;++kn)so[kn]=ji[kn];else so=[ji];else{so=Array(ss);var Qo={radius:Pi,format:fa,type:Jo};for(kn=0;kn<ss;++kn)so[kn]=rr.createCube(Qo)}for(ea.color=Array(so.length),kn=0;kn<so.length;++kn){var ys=so[kn];V(typeof ys=="function"&&ys._reglType==="textureCube","invalid cube map"),Pi=Pi||ys.width,V(ys.width===Pi&&ys.height===Pi,"invalid cube map shape"),ea.color[kn]={target:po,data:so[kn]}}for(kn=0;kn<6;++kn){for(var Es=0;Es<so.length;++Es)ea.color[Es].target=po+kn;kn>0&&(ea.depth=Nr[0].depth,ea.stencil=Nr[0].stencil,ea.depthStencil=Nr[0].depthStencil),Nr[kn]?Nr[kn](ea):Nr[kn]=nn(ea)}return _(Ir,{width:Pi,height:Pi,color:so})}function si(ui){var kn,ea=ui|0;if(V(ea>0&&ea<=Ze.maxCubeMapSize,"invalid radius for cube fbo"),ea===Ir.width)return Ir;var Pi=Ir.color;for(kn=0;kn<Pi.length;++kn)Pi[kn].resize(ea);for(kn=0;kn<6;++kn)Nr[kn].resize(ea);return Ir.width=Ir.height=ea,Ir}return Ir(sn),_(Ir,{faces:Nr,resize:si,_reglType:"framebufferCube",destroy:function(){Nr.forEach(function(ui){ui.destroy()})}})}function Kn(){vr.cur=null,vr.next=null,vr.dirty=!0,Zi(Br).forEach(function(sn){sn.framebuffer=U.createFramebuffer(),kr(sn)})}return _(vr,{getFramebuffer:function(sn){if(typeof sn=="function"&&sn._reglType==="framebuffer"){var Nr=sn._framebuffer;if(Nr instanceof Sn)return Nr}return null},create:nn,createCube:Xn,clear:function(){Zi(Br).forEach(un)},restore:Kn})}var G=5126,ee=34962;function ve(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=G,this.offset=0,this.stride=0,this.divisor=0}function ye(U,Pe,Ze,rr,wr){for(var Xt=Ze.maxAttributes,vr=new Array(Xt),Ur=0;Ur<Xt;++Ur)vr[Ur]=new ve;var Hr=0,Jr={},Gr={Record:ve,scope:{},state:vr,currentVAO:null,targetVAO:null,restore:hn()?Br:function(){},createVAO:Sn,getVAO:an,destroyBuffer:rn,setVAO:hn()?Zt:pr,clear:hn()?Vr:function(){}};function rn(zr){for(var un=0;un<vr.length;++un){var kr=vr[un];kr.buffer===zr&&(U.disableVertexAttribArray(un),kr.buffer=null)}}function hn(){return Pe.oes_vertex_array_object}function jr(){return Pe.angle_instanced_arrays}function an(zr){return typeof zr=="function"&&zr._vao?zr._vao:null}function Zt(zr){if(zr!==Gr.currentVAO){var un=hn();zr?un.bindVertexArrayOES(zr.vao):un.bindVertexArrayOES(null),Gr.currentVAO=zr}}function pr(zr){if(zr!==Gr.currentVAO){if(zr)zr.bindAttrs();else for(var un=jr(),kr=0;kr<vr.length;++kr){var nn=vr[kr];nn.buffer?(U.enableVertexAttribArray(kr),U.vertexAttribPointer(kr,nn.size,nn.type,nn.normalized,nn.stride,nn.offfset),un&&nn.divisor&&un.vertexAttribDivisorANGLE(kr,nn.divisor)):(U.disableVertexAttribArray(kr),U.vertexAttrib4f(kr,nn.x,nn.y,nn.z,nn.w))}Gr.currentVAO=zr}}function Vr(){Zi(Jr).forEach(function(zr){zr.destroy()})}function mn(){this.id=++Hr,this.attributes=[];var zr=hn();zr?this.vao=zr.createVertexArrayOES():this.vao=null,Jr[this.id]=this,this.buffers=[]}mn.prototype.bindAttrs=function(){for(var zr=jr(),un=this.attributes,kr=0;kr<un.length;++kr){var nn=un[kr];nn.buffer?(U.enableVertexAttribArray(kr),U.bindBuffer(ee,nn.buffer.buffer),U.vertexAttribPointer(kr,nn.size,nn.type,nn.normalized,nn.stride,nn.offset),zr&&nn.divisor&&zr.vertexAttribDivisorANGLE(kr,nn.divisor)):(U.disableVertexAttribArray(kr),U.vertexAttrib4f(kr,nn.x,nn.y,nn.z,nn.w))}for(var Xn=un.length;Xn<Xt;++Xn)U.disableVertexAttribArray(Xn)},mn.prototype.refresh=function(){var zr=hn();zr&&(zr.bindVertexArrayOES(this.vao),this.bindAttrs(),Gr.currentVAO=this)},mn.prototype.destroy=function(){if(this.vao){var zr=hn();this===Gr.currentVAO&&(Gr.currentVAO=null,zr.bindVertexArrayOES(null)),zr.deleteVertexArrayOES(this.vao),this.vao=null}Jr[this.id]&&(delete Jr[this.id],rr.vaoCount-=1)};function Br(){var zr=hn();zr&&Zi(Jr).forEach(function(un){un.refresh()})}function Sn(zr){var un=new mn;rr.vaoCount+=1;function kr(nn){V(Array.isArray(nn),"arguments to vertex array constructor must be an array"),V(nn.length<Xt,"too many attributes"),V(nn.length>0,"must specify at least one attribute");var Xn={},Kn=un.attributes;Kn.length=nn.length;for(var sn=0;sn<nn.length;++sn){var Nr=nn[sn],Ir=Kn[sn]=new ve,si=Nr.data||Nr;if(Array.isArray(si)||O(si)||fo(si)){var ui;un.buffers[sn]&&(ui=un.buffers[sn],O(si)&&ui._buffer.byteLength>=si.byteLength?ui.subdata(si):(ui.destroy(),un.buffers[sn]=null)),un.buffers[sn]||(ui=un.buffers[sn]=wr.create(Nr,ee,!1,!0)),Ir.buffer=wr.getBuffer(ui),Ir.size=Ir.buffer.dimension|0,Ir.normalized=!1,Ir.type=Ir.buffer.dtype,Ir.offset=0,Ir.stride=0,Ir.divisor=0,Ir.state=1,Xn[sn]=1}else wr.getBuffer(Nr)?(Ir.buffer=wr.getBuffer(Nr),Ir.size=Ir.buffer.dimension|0,Ir.normalized=!1,Ir.type=Ir.buffer.dtype,Ir.offset=0,Ir.stride=0,Ir.divisor=0,Ir.state=1):wr.getBuffer(Nr.buffer)?(Ir.buffer=wr.getBuffer(Nr.buffer),Ir.size=(+Nr.size||Ir.buffer.dimension)|0,Ir.normalized=!!Nr.normalized||!1,"type"in Nr?(V.parameter(Nr.type,ua,"invalid buffer type"),Ir.type=ua[Nr.type]):Ir.type=Ir.buffer.dtype,Ir.offset=(Nr.offset||0)|0,Ir.stride=(Nr.stride||0)|0,Ir.divisor=(Nr.divisor||0)|0,Ir.state=1,V(Ir.size>=1&&Ir.size<=4,"size must be between 1 and 4"),V(Ir.offset>=0,"invalid offset"),V(Ir.stride>=0&&Ir.stride<=255,"stride must be between 0 and 255"),V(Ir.divisor>=0,"divisor must be positive"),V(!Ir.divisor||!!Pe.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Nr?(V(sn>0,"first attribute must not be a constant"),Ir.x=+Nr.x||0,Ir.y=+Nr.y||0,Ir.z=+Nr.z||0,Ir.w=+Nr.w||0,Ir.state=2):V(!1,"invalid attribute spec for location "+sn)}for(var kn=0;kn<un.buffers.length;++kn)!Xn[kn]&&un.buffers[kn]&&(un.buffers[kn].destroy(),un.buffers[kn]=null);return un.refresh(),kr}return kr.destroy=function(){for(var nn=0;nn<un.buffers.length;++nn)un.buffers[nn]&&un.buffers[nn].destroy();un.buffers.length=0,un.destroy()},kr._vao=un,kr._reglType="vao",kr(zr)}return Gr}var we=35632,Ke=35633,He=35718,at=35721;function ze(U,Pe,Ze,rr){var wr={},Xt={};function vr(Zt,pr,Vr,mn){this.name=Zt,this.id=pr,this.location=Vr,this.info=mn}function Ur(Zt,pr){for(var Vr=0;Vr<Zt.length;++Vr)if(Zt[Vr].id===pr.id){Zt[Vr].location=pr.location;return}Zt.push(pr)}function Hr(Zt,pr,Vr){var mn=Zt===we?wr:Xt,Br=mn[pr];if(!Br){var Sn=Pe.str(pr);Br=U.createShader(Zt),U.shaderSource(Br,Sn),U.compileShader(Br),V.shaderError(U,Br,Sn,Zt,Vr),mn[pr]=Br}return Br}var Jr={},Gr=[],rn=0;function hn(Zt,pr){this.id=rn++,this.fragId=Zt,this.vertId=pr,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,rr.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function jr(Zt,pr,Vr){var mn,Br,Sn=Hr(we,Zt.fragId),zr=Hr(Ke,Zt.vertId),un=Zt.program=U.createProgram();if(U.attachShader(un,Sn),U.attachShader(un,zr),Vr)for(mn=0;mn<Vr.length;++mn){var kr=Vr[mn];U.bindAttribLocation(un,kr[0],kr[1])}U.linkProgram(un),V.linkError(U,un,Pe.str(Zt.fragId),Pe.str(Zt.vertId),pr);var nn=U.getProgramParameter(un,He);rr.profile&&(Zt.stats.uniformsCount=nn);var Xn=Zt.uniforms;for(mn=0;mn<nn;++mn)if(Br=U.getActiveUniform(un,mn),Br)if(Br.size>1)for(var Kn=0;Kn<Br.size;++Kn){var sn=Br.name.replace("[0]","["+Kn+"]");Ur(Xn,new vr(sn,Pe.id(sn),U.getUniformLocation(un,sn),Br))}else Ur(Xn,new vr(Br.name,Pe.id(Br.name),U.getUniformLocation(un,Br.name),Br));var Nr=U.getProgramParameter(un,at);rr.profile&&(Zt.stats.attributesCount=Nr);var Ir=Zt.attributes;for(mn=0;mn<Nr;++mn)Br=U.getActiveAttrib(un,mn),Br&&Ur(Ir,new vr(Br.name,Pe.id(Br.name),U.getAttribLocation(un,Br.name),Br))}rr.profile&&(Ze.getMaxUniformsCount=function(){var Zt=0;return Gr.forEach(function(pr){pr.stats.uniformsCount>Zt&&(Zt=pr.stats.uniformsCount)}),Zt},Ze.getMaxAttributesCount=function(){var Zt=0;return Gr.forEach(function(pr){pr.stats.attributesCount>Zt&&(Zt=pr.stats.attributesCount)}),Zt});function an(){wr={},Xt={};for(var Zt=0;Zt<Gr.length;++Zt)jr(Gr[Zt],null,Gr[Zt].attributes.map(function(pr){return[pr.location,pr.name]}))}return{clear:function(){var Zt=U.deleteShader.bind(U);Zi(wr).forEach(Zt),wr={},Zi(Xt).forEach(Zt),Xt={},Gr.forEach(function(pr){U.deleteProgram(pr.program)}),Gr.length=0,Jr={},Ze.shaderCount=0},program:function(Zt,pr,Vr,mn){V.command(Zt>=0,"missing vertex shader",Vr),V.command(pr>=0,"missing fragment shader",Vr);var Br=Jr[pr];Br||(Br=Jr[pr]={});var Sn=Br[Zt];if(Sn&&(Sn.refCount++,!mn))return Sn;var zr=new hn(pr,Zt);return Ze.shaderCount++,jr(zr,Vr,mn),Sn||(Br[Zt]=zr),Gr.push(zr),_(zr,{destroy:function(){if(zr.refCount--,zr.refCount<=0){U.deleteProgram(zr.program);var un=Gr.indexOf(zr);Gr.splice(un,1),Ze.shaderCount--}Br[zr.vertId].refCount<=0&&(U.deleteShader(Xt[zr.vertId]),delete Xt[zr.vertId],delete Jr[zr.fragId][zr.vertId]),Object.keys(Jr[zr.fragId]).length||(U.deleteShader(wr[zr.fragId]),delete wr[zr.fragId],delete Jr[zr.fragId])}})},restore:an,shader:Hr,frag:-1,vert:-1}}var it=6408,mt=5121,Ut=3333,sr=5126;function nr(U,Pe,Ze,rr,wr,Xt,vr){function Ur(Gr){var rn;Pe.next===null?(V(wr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),rn=mt):(V(Pe.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),rn=Pe.next.colorAttachments[0].texture._texture.type,Xt.oes_texture_float?(V(rn===mt||rn===sr,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),rn===sr&&V(vr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):V(rn===mt,"Reading from a framebuffer is only allowed for the type 'uint8'"));var hn=0,jr=0,an=rr.framebufferWidth,Zt=rr.framebufferHeight,pr=null;O(Gr)?pr=Gr:Gr&&(V.type(Gr,"object","invalid arguments to regl.read()"),hn=Gr.x|0,jr=Gr.y|0,V(hn>=0&&hn<rr.framebufferWidth,"invalid x offset for regl.read"),V(jr>=0&&jr<rr.framebufferHeight,"invalid y offset for regl.read"),an=(Gr.width||rr.framebufferWidth-hn)|0,Zt=(Gr.height||rr.framebufferHeight-jr)|0,pr=Gr.data||null),pr&&(rn===mt?V(pr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):rn===sr&&V(pr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),V(an>0&&an+hn<=rr.framebufferWidth,"invalid width for read pixels"),V(Zt>0&&Zt+jr<=rr.framebufferHeight,"invalid height for read pixels"),Ze();var Vr=an*Zt*4;return pr||(rn===mt?pr=new Uint8Array(Vr):rn===sr&&(pr=pr||new Float32Array(Vr))),V.isTypedArray(pr,"data buffer for regl.read() must be a typedarray"),V(pr.byteLength>=Vr,"data buffer for regl.read() too small"),U.pixelStorei(Ut,4),U.readPixels(hn,jr,an,Zt,it,rn,pr),pr}function Hr(Gr){var rn;return Pe.setFBO({framebuffer:Gr.framebuffer},function(){rn=Ur(Gr)}),rn}function Jr(Gr){return!Gr||!("framebuffer"in Gr)?Ur(Gr):Hr(Gr)}return Jr}function cr(U){return Array.prototype.slice.call(U)}function Rr(U){return cr(U).join("")}function tn(){var U=0,Pe=[],Ze=[];function rr(rn){for(var hn=0;hn<Ze.length;++hn)if(Ze[hn]===rn)return Pe[hn];var jr="g"+U++;return Pe.push(jr),Ze.push(rn),jr}function wr(){var rn=[];function hn(){rn.push.apply(rn,cr(arguments))}var jr=[];function an(){var Zt="v"+U++;return jr.push(Zt),arguments.length>0&&(rn.push(Zt,"="),rn.push.apply(rn,cr(arguments)),rn.push(";")),Zt}return _(hn,{def:an,toString:function(){return Rr([jr.length>0?"var "+jr.join(",")+";":"",Rr(rn)])}})}function Xt(){var rn=wr(),hn=wr(),jr=rn.toString,an=hn.toString;function Zt(pr,Vr){hn(pr,Vr,"=",rn.def(pr,Vr),";")}return _(function(){rn.apply(rn,cr(arguments))},{def:rn.def,entry:rn,exit:hn,save:Zt,set:function(pr,Vr,mn){Zt(pr,Vr),rn(pr,Vr,"=",mn,";")},toString:function(){return jr()+an()}})}function vr(){var rn=Rr(arguments),hn=Xt(),jr=Xt(),an=hn.toString,Zt=jr.toString;return _(hn,{then:function(){return hn.apply(hn,cr(arguments)),this},else:function(){return jr.apply(jr,cr(arguments)),this},toString:function(){var pr=Zt();return pr&&(pr="else{"+pr+"}"),Rr(["if(",rn,"){",an(),"}",pr])}})}var Ur=wr(),Hr={};function Jr(rn,hn){var jr=[];function an(){var Br="a"+jr.length;return jr.push(Br),Br}hn=hn||0;for(var Zt=0;Zt<hn;++Zt)an();var pr=Xt(),Vr=pr.toString,mn=Hr[rn]=_(pr,{arg:an,toString:function(){return Rr(["function(",jr.join(),"){",Vr(),"}"])}});return mn}function Gr(){var rn=['"use strict";',Ur,"return {"];Object.keys(Hr).forEach(function(an){rn.push('"',an,'":',Hr[an].toString(),",")}),rn.push("}");var hn=Rr(rn).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),jr=Function.apply(null,Pe.concat(hn));return jr.apply(null,Ze)}return{global:Ur,link:rr,block:wr,proc:Jr,scope:Xt,cond:vr,compile:Gr}}var Xr="xyzw".split(""),yn=5121,Fn=1,Vn=2,jn=0,Qi=1,_n=2,ci=3,Ci=4,fi=5,oi=6,Ti="dither",ii="blend.enable",ri="blend.color",Po="blend.equation",Ja="blend.func",os="depth.enable",Zo="depth.func",Ga="depth.range",no="depth.mask",ds="colorMask",vs="cull.enable",el="cull.face",ms="frontFace",eu="lineWidth",Ls="polygonOffset.enable",xl="polygonOffset.offset",bl="sample.alpha",Nu="sample.enable",tu="sample.coverage",Vl="stencil.enable",Tu="stencil.mask",zu="stencil.func",Hs="stencil.opFront",io="stencil.opBack",Au="scissor.enable",du="scissor.box",gs="viewport",qi="profile",ao="framebuffer",ko="vert",Rs="frag",tl="elements",vu="primitive",rl="count",nl="offset",Ec="instances",Pu="vao",Gl="Width",wc="Height",Ws=ao+Gl,Uo=ao+wc,Hc=gs+Gl,Rf=gs+wc,Sl="drawingBuffer",uf=Sl+Gl,Wc=Sl+wc,Wf=[Ja,Po,zu,Hs,io,tu,gs,du,xl],Hl=34962,ih=34963,lf=35632,ru=35633,j=3553,z=34067,M=2884,D=3042,ne=3024,_e=2960,gt=2929,Gt=3089,zt=32823,Sr=32926,qr=32928,Rn=5126,Gn=35664,Mn=35665,di=35666,yi=5124,aa=35667,Mi=35668,Ha=35669,Mo=35670,bo=35671,So=35672,Qa=35673,ca=35674,Wa=35675,Eo=35676,oo=35678,wo=35680,Ds=4,mu=1028,Zu=1029,Ss=2304,Xc=2305,cf=32775,jp=32776,Xf=519,Yc=7680,ff=0,fp=1,Mh=32774,hp=513,Ih=36160,Vp=36064,Wl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Kc=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],wf={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Xl={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Cf={frag:lf,vert:ru},il={cw:Ss,ccw:Xc};function Yf(U){return Array.isArray(U)||O(U)||fo(U)}function Oh(U){return U.sort(function(Pe,Ze){return Pe===gs?-1:Ze===gs?1:Pe<Ze?-1:1})}function gu(U,Pe,Ze,rr){this.thisDep=U,this.contextDep=Pe,this.propDep=Ze,this.append=rr}function al(U){return U&&!(U.thisDep||U.contextDep||U.propDep)}function jo(U){return new gu(!1,!1,!1,U)}function Uu(U,Pe){var Ze=U.type;if(Ze===jn){var rr=U.data.length;return new gu(!0,rr>=1,rr>=2,Pe)}else if(Ze===Ci){var wr=U.data;return new gu(wr.thisDep,wr.contextDep,wr.propDep,Pe)}else{if(Ze===fi)return new gu(!1,!1,!1,Pe);if(Ze===oi){for(var Xt=!1,vr=!1,Ur=!1,Hr=0;Hr<U.data.length;++Hr){var Jr=U.data[Hr];if(Jr.type===Qi)Ur=!0;else if(Jr.type===_n)vr=!0;else if(Jr.type===ci)Xt=!0;else if(Jr.type===jn){Xt=!0;var Gr=Jr.data;Gr>=1&&(vr=!0),Gr>=2&&(Ur=!0)}else Jr.type===Ci&&(Xt=Xt||Jr.data.thisDep,vr=vr||Jr.data.contextDep,Ur=Ur||Jr.data.propDep)}return new gu(Xt,vr,Ur,Pe)}else return new gu(Ze===ci,Ze===_n,Ze===Qi,Pe)}}var Lh=new gu(!1,!1,!1,function(){});function pp(U,Pe,Ze,rr,wr,Xt,vr,Ur,Hr,Jr,Gr,rn,hn,jr,an){var Zt=Jr.Record,pr={add:32774,subtract:32778,"reverse subtract":32779};Ze.ext_blend_minmax&&(pr.min=cf,pr.max=jp);var Vr=Ze.angle_instanced_arrays,mn=Ze.webgl_draw_buffers,Br={dirty:!0,profile:an.profile},Sn={},zr=[],un={},kr={};function nn(Re){return Re.replace(".","_")}function Xn(Re,xe,ot){var Dt=nn(Re);zr.push(Re),Sn[Dt]=Br[Dt]=!!ot,un[Dt]=xe}function Kn(Re,xe,ot){var Dt=nn(Re);zr.push(Re),Array.isArray(ot)?(Br[Dt]=ot.slice(),Sn[Dt]=ot.slice()):Br[Dt]=Sn[Dt]=ot,kr[Dt]=xe}Xn(Ti,ne),Xn(ii,D),Kn(ri,"blendColor",[0,0,0,0]),Kn(Po,"blendEquationSeparate",[Mh,Mh]),Kn(Ja,"blendFuncSeparate",[fp,ff,fp,ff]),Xn(os,gt,!0),Kn(Zo,"depthFunc",hp),Kn(Ga,"depthRange",[0,1]),Kn(no,"depthMask",!0),Kn(ds,ds,[!0,!0,!0,!0]),Xn(vs,M),Kn(el,"cullFace",Zu),Kn(ms,ms,Xc),Kn(eu,eu,1),Xn(Ls,zt),Kn(xl,"polygonOffset",[0,0]),Xn(bl,Sr),Xn(Nu,qr),Kn(tu,"sampleCoverage",[1,!1]),Xn(Vl,_e),Kn(Tu,"stencilMask",-1),Kn(zu,"stencilFunc",[Xf,0,-1]),Kn(Hs,"stencilOpSeparate",[mu,Yc,Yc,Yc]),Kn(io,"stencilOpSeparate",[Zu,Yc,Yc,Yc]),Xn(Au,Gt),Kn(du,"scissor",[0,0,U.drawingBufferWidth,U.drawingBufferHeight]),Kn(gs,gs,[0,0,U.drawingBufferWidth,U.drawingBufferHeight]);var sn={gl:U,context:hn,strings:Pe,next:Sn,current:Br,draw:rn,elements:Xt,buffer:wr,shader:Gr,attributes:Jr.state,vao:Jr,uniforms:Hr,framebuffer:Ur,extensions:Ze,timer:jr,isBufferArgs:Yf},Nr={primTypes:ba,compareFuncs:wf,blendFuncs:Wl,blendEquations:pr,stencilOps:Xl,glTypes:ua,orientationType:il};V.optional(function(){sn.isArrayLike=Aa}),mn&&(Nr.backBuffer=[Zu],Nr.drawBuffer=ie(rr.maxDrawbuffers,function(Re){return Re===0?[0]:ie(Re,function(xe){return Vp+xe})}));var Ir=0;function si(){var Re=tn(),xe=Re.link,ot=Re.global;Re.id=Ir++,Re.batchId="0";var Dt=xe(sn),Mt=Re.shared={props:"a0"};Object.keys(sn).forEach(function(nt){Mt[nt]=ot.def(Dt,".",nt)}),V.optional(function(){Re.CHECK=xe(V),Re.commandStr=V.guessCommand(),Re.command=xe(Re.commandStr),Re.assert=function(nt,Oe,Tt){nt("if(!(",Oe,"))",this.CHECK,".commandRaise(",xe(Tt),",",this.command,");")},Nr.invalidBlendCombinations=Kc});var ft=Re.next={},st=Re.current={};Object.keys(kr).forEach(function(nt){Array.isArray(Br[nt])&&(ft[nt]=ot.def(Mt.next,".",nt),st[nt]=ot.def(Mt.current,".",nt))});var Et=Re.constants={};Object.keys(Nr).forEach(function(nt){Et[nt]=ot.def(JSON.stringify(Nr[nt]))}),Re.invoke=function(nt,Oe){switch(Oe.type){case jn:var Tt=["this",Mt.context,Mt.props,Re.batchId];return nt.def(xe(Oe.data),".call(",Tt.slice(0,Math.max(Oe.data.length+1,4)),")");case Qi:return nt.def(Mt.props,Oe.data);case _n:return nt.def(Mt.context,Oe.data);case ci:return nt.def("this",Oe.data);case Ci:return Oe.data.append(Re,nt),Oe.data.ref;case fi:return Oe.data.toString();case oi:return Oe.data.map(function(jt){return Re.invoke(nt,jt)})}},Re.attribCache={};var ke={};return Re.scopeAttrib=function(nt){var Oe=Pe.id(nt);if(Oe in ke)return ke[Oe];var Tt=Jr.scope[Oe];Tt||(Tt=Jr.scope[Oe]=new Zt);var jt=ke[Oe]=xe(Tt);return jt},Re}function ui(Re){var xe=Re.static,ot=Re.dynamic,Dt;if(qi in xe){var Mt=!!xe[qi];Dt=jo(function(st,Et){return Mt}),Dt.enable=Mt}else if(qi in ot){var ft=ot[qi];Dt=Uu(ft,function(st,Et){return st.invoke(Et,ft)})}return Dt}function kn(Re,xe){var ot=Re.static,Dt=Re.dynamic;if(ao in ot){var Mt=ot[ao];return Mt?(Mt=Ur.getFramebuffer(Mt),V.command(Mt,"invalid framebuffer object"),jo(function(st,Et){var ke=st.link(Mt),nt=st.shared;Et.set(nt.framebuffer,".next",ke);var Oe=nt.context;return Et.set(Oe,"."+Ws,ke+".width"),Et.set(Oe,"."+Uo,ke+".height"),ke})):jo(function(st,Et){var ke=st.shared;Et.set(ke.framebuffer,".next","null");var nt=ke.context;return Et.set(nt,"."+Ws,nt+"."+uf),Et.set(nt,"."+Uo,nt+"."+Wc),"null"})}else if(ao in Dt){var ft=Dt[ao];return Uu(ft,function(st,Et){var ke=st.invoke(Et,ft),nt=st.shared,Oe=nt.framebuffer,Tt=Et.def(Oe,".getFramebuffer(",ke,")");V.optional(function(){st.assert(Et,"!"+ke+"||"+Tt,"invalid framebuffer object")}),Et.set(Oe,".next",Tt);var jt=nt.context;return Et.set(jt,"."+Ws,Tt+"?"+Tt+".width:"+jt+"."+uf),Et.set(jt,"."+Uo,Tt+"?"+Tt+".height:"+jt+"."+Wc),Tt})}else return null}function ea(Re,xe,ot){var Dt=Re.static,Mt=Re.dynamic;function ft(ke){if(ke in Dt){var nt=Dt[ke];V.commandType(nt,"object","invalid "+ke,ot.commandStr);var Oe=!0,Tt=nt.x|0,jt=nt.y|0,Er,$t;return"width"in nt?(Er=nt.width|0,V.command(Er>=0,"invalid "+ke,ot.commandStr)):Oe=!1,"height"in nt?($t=nt.height|0,V.command($t>=0,"invalid "+ke,ot.commandStr)):Oe=!1,new gu(!Oe&&xe&&xe.thisDep,!Oe&&xe&&xe.contextDep,!Oe&&xe&&xe.propDep,function(zn,Ii){var In=zn.shared.context,$n=Er;"width"in nt||($n=Ii.def(In,".",Ws,"-",Tt));var Oi=$t;return"height"in nt||(Oi=Ii.def(In,".",Uo,"-",jt)),[Tt,jt,$n,Oi]})}else if(ke in Mt){var xr=Mt[ke],Yr=Uu(xr,function(zn,Ii){var In=zn.invoke(Ii,xr);V.optional(function(){zn.assert(Ii,In+"&&typeof "+In+'==="object"',"invalid "+ke)});var $n=zn.shared.context,Oi=Ii.def(In,".x|0"),ha=Ii.def(In,".y|0"),Co=Ii.def('"width" in ',In,"?",In,".width|0:","(",$n,".",Ws,"-",Oi,")"),yu=Ii.def('"height" in ',In,"?",In,".height|0:","(",$n,".",Uo,"-",ha,")");return V.optional(function(){zn.assert(Ii,Co+">=0&&"+yu+">=0","invalid "+ke)}),[Oi,ha,Co,yu]});return xe&&(Yr.thisDep=Yr.thisDep||xe.thisDep,Yr.contextDep=Yr.contextDep||xe.contextDep,Yr.propDep=Yr.propDep||xe.propDep),Yr}else return xe?new gu(xe.thisDep,xe.contextDep,xe.propDep,function(zn,Ii){var In=zn.shared.context;return[0,0,Ii.def(In,".",Ws),Ii.def(In,".",Uo)]}):null}var st=ft(gs);if(st){var Et=st;st=new gu(st.thisDep,st.contextDep,st.propDep,function(ke,nt){var Oe=Et.append(ke,nt),Tt=ke.shared.context;return nt.set(Tt,"."+Hc,Oe[2]),nt.set(Tt,"."+Rf,Oe[3]),Oe})}return{viewport:st,scissor_box:ft(du)}}function Pi(Re,xe){var ot=Re.static,Dt=typeof ot[Rs]=="string"&&typeof ot[ko]=="string";if(Dt){if(Object.keys(xe.dynamic).length>0)return null;var Mt=xe.static,ft=Object.keys(Mt);if(ft.length>0&&typeof Mt[ft[0]]=="number"){for(var st=[],Et=0;Et<ft.length;++Et)V(typeof Mt[ft[Et]]=="number","must specify all vertex attribute locations when using vaos"),st.push([Mt[ft[Et]]|0,ft[Et]]);return st}}return null}function ji(Re,xe,ot){var Dt=Re.static,Mt=Re.dynamic;function ft(Oe){if(Oe in Dt){var Tt=Pe.id(Dt[Oe]);V.optional(function(){Gr.shader(Cf[Oe],Tt,V.guessCommand())});var jt=jo(function(){return Tt});return jt.id=Tt,jt}else if(Oe in Mt){var Er=Mt[Oe];return Uu(Er,function($t,xr){var Yr=$t.invoke(xr,Er),zn=xr.def($t.shared.strings,".id(",Yr,")");return V.optional(function(){xr($t.shared.shader,".shader(",Cf[Oe],",",zn,",",$t.command,");")}),zn})}return null}var st=ft(Rs),Et=ft(ko),ke=null,nt;return al(st)&&al(Et)?(ke=Gr.program(Et.id,st.id,null,ot),nt=jo(function(Oe,Tt){return Oe.link(ke)})):nt=new gu(st&&st.thisDep||Et&&Et.thisDep,st&&st.contextDep||Et&&Et.contextDep,st&&st.propDep||Et&&Et.propDep,function(Oe,Tt){var jt=Oe.shared.shader,Er;st?Er=st.append(Oe,Tt):Er=Tt.def(jt,".",Rs);var $t;Et?$t=Et.append(Oe,Tt):$t=Tt.def(jt,".",ko);var xr=jt+".program("+$t+","+Er;return V.optional(function(){xr+=","+Oe.command}),Tt.def(xr+")")}),{frag:st,vert:Et,progVar:nt,program:ke}}function fa(Re,xe){var ot=Re.static,Dt=Re.dynamic;function Mt(){if(tl in ot){var Oe=ot[tl];Yf(Oe)?Oe=Xt.getElements(Xt.create(Oe,!0)):Oe&&(Oe=Xt.getElements(Oe),V.command(Oe,"invalid elements",xe.commandStr));var Tt=jo(function(Er,$t){if(Oe){var xr=Er.link(Oe);return Er.ELEMENTS=xr,xr}return Er.ELEMENTS=null,null});return Tt.value=Oe,Tt}else if(tl in Dt){var jt=Dt[tl];return Uu(jt,function(Er,$t){var xr=Er.shared,Yr=xr.isBufferArgs,zn=xr.elements,Ii=Er.invoke($t,jt),In=$t.def("null"),$n=$t.def(Yr,"(",Ii,")"),Oi=Er.cond($n).then(In,"=",zn,".createStream(",Ii,");").else(In,"=",zn,".getElements(",Ii,");");return V.optional(function(){Er.assert(Oi.else,"!"+Ii+"||"+In,"invalid elements")}),$t.entry(Oi),$t.exit(Er.cond($n).then(zn,".destroyStream(",In,");")),Er.ELEMENTS=In,In})}return null}var ft=Mt();function st(){if(vu in ot){var Oe=ot[vu];return V.commandParameter(Oe,ba,"invalid primitve",xe.commandStr),jo(function(jt,Er){return ba[Oe]})}else if(vu in Dt){var Tt=Dt[vu];return Uu(Tt,function(jt,Er){var $t=jt.constants.primTypes,xr=jt.invoke(Er,Tt);return V.optional(function(){jt.assert(Er,xr+" in "+$t,"invalid primitive, must be one of "+Object.keys(ba))}),Er.def($t,"[",xr,"]")})}else if(ft)return al(ft)?ft.value?jo(function(jt,Er){return Er.def(jt.ELEMENTS,".primType")}):jo(function(){return Ds}):new gu(ft.thisDep,ft.contextDep,ft.propDep,function(jt,Er){var $t=jt.ELEMENTS;return Er.def($t,"?",$t,".primType:",Ds)});return null}function Et(Oe,Tt){if(Oe in ot){var jt=ot[Oe]|0;return V.command(!Tt||jt>=0,"invalid "+Oe,xe.commandStr),jo(function($t,xr){return Tt&&($t.OFFSET=jt),jt})}else if(Oe in Dt){var Er=Dt[Oe];return Uu(Er,function($t,xr){var Yr=$t.invoke(xr,Er);return Tt&&($t.OFFSET=Yr,V.optional(function(){$t.assert(xr,Yr+">=0","invalid "+Oe)})),Yr})}else if(Tt&&ft)return jo(function($t,xr){return $t.OFFSET="0",0});return null}var ke=Et(nl,!0);function nt(){if(rl in ot){var Oe=ot[rl]|0;return V.command(typeof Oe=="number"&&Oe>=0,"invalid vertex count",xe.commandStr),jo(function(){return Oe})}else if(rl in Dt){var Tt=Dt[rl];return Uu(Tt,function($t,xr){var Yr=$t.invoke(xr,Tt);return V.optional(function(){$t.assert(xr,"typeof "+Yr+'==="number"&&'+Yr+">=0&&"+Yr+"===("+Yr+"|0)","invalid vertex count")}),Yr})}else if(ft)if(al(ft)){if(ft)return ke?new gu(ke.thisDep,ke.contextDep,ke.propDep,function($t,xr){var Yr=xr.def($t.ELEMENTS,".vertCount-",$t.OFFSET);return V.optional(function(){$t.assert(xr,Yr+">=0","invalid vertex offset/element buffer too small")}),Yr}):jo(function($t,xr){return xr.def($t.ELEMENTS,".vertCount")});var jt=jo(function(){return-1});return V.optional(function(){jt.MISSING=!0}),jt}else{var Er=new gu(ft.thisDep||ke.thisDep,ft.contextDep||ke.contextDep,ft.propDep||ke.propDep,function($t,xr){var Yr=$t.ELEMENTS;return $t.OFFSET?xr.def(Yr,"?",Yr,".vertCount-",$t.OFFSET,":-1"):xr.def(Yr,"?",Yr,".vertCount:-1")});return V.optional(function(){Er.DYNAMIC=!0}),Er}return null}return{elements:ft,primitive:st(),count:nt(),instances:Et(Ec,!1),offset:ke}}function Jo(Re,xe){var ot=Re.static,Dt=Re.dynamic,Mt={};return zr.forEach(function(ft){var st=nn(ft);function Et(ke,nt){if(ft in ot){var Oe=ke(ot[ft]);Mt[st]=jo(function(){return Oe})}else if(ft in Dt){var Tt=Dt[ft];Mt[st]=Uu(Tt,function(jt,Er){return nt(jt,Er,jt.invoke(Er,Tt))})}}switch(ft){case vs:case ii:case Ti:case Vl:case os:case Au:case Ls:case bl:case Nu:case no:return Et(function(ke){return V.commandType(ke,"boolean",ft,xe.commandStr),ke},function(ke,nt,Oe){return V.optional(function(){ke.assert(nt,"typeof "+Oe+'==="boolean"',"invalid flag "+ft,ke.commandStr)}),Oe});case Zo:return Et(function(ke){return V.commandParameter(ke,wf,"invalid "+ft,xe.commandStr),wf[ke]},function(ke,nt,Oe){var Tt=ke.constants.compareFuncs;return V.optional(function(){ke.assert(nt,Oe+" in "+Tt,"invalid "+ft+", must be one of "+Object.keys(wf))}),nt.def(Tt,"[",Oe,"]")});case Ga:return Et(function(ke){return V.command(Aa(ke)&&ke.length===2&&typeof ke[0]=="number"&&typeof ke[1]=="number"&&ke[0]<=ke[1],"depth range is 2d array",xe.commandStr),ke},function(ke,nt,Oe){V.optional(function(){ke.assert(nt,ke.shared.isArrayLike+"("+Oe+")&&"+Oe+".length===2&&typeof "+Oe+'[0]==="number"&&typeof '+Oe+'[1]==="number"&&'+Oe+"[0]<="+Oe+"[1]","depth range must be a 2d array")});var Tt=nt.def("+",Oe,"[0]"),jt=nt.def("+",Oe,"[1]");return[Tt,jt]});case Ja:return Et(function(ke){V.commandType(ke,"object","blend.func",xe.commandStr);var nt="srcRGB"in ke?ke.srcRGB:ke.src,Oe="srcAlpha"in ke?ke.srcAlpha:ke.src,Tt="dstRGB"in ke?ke.dstRGB:ke.dst,jt="dstAlpha"in ke?ke.dstAlpha:ke.dst;return V.commandParameter(nt,Wl,st+".srcRGB",xe.commandStr),V.commandParameter(Oe,Wl,st+".srcAlpha",xe.commandStr),V.commandParameter(Tt,Wl,st+".dstRGB",xe.commandStr),V.commandParameter(jt,Wl,st+".dstAlpha",xe.commandStr),V.command(Kc.indexOf(nt+", "+Tt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+nt+", "+Tt+")",xe.commandStr),[Wl[nt],Wl[Tt],Wl[Oe],Wl[jt]]},function(ke,nt,Oe){var Tt=ke.constants.blendFuncs;V.optional(function(){ke.assert(nt,Oe+"&&typeof "+Oe+'==="object"',"invalid blend func, must be an object")});function jt(In,$n){var Oi=nt.def('"',In,$n,'" in ',Oe,"?",Oe,".",In,$n,":",Oe,".",In);return V.optional(function(){ke.assert(nt,Oi+" in "+Tt,"invalid "+ft+"."+In+$n+", must be one of "+Object.keys(Wl))}),Oi}var Er=jt("src","RGB"),$t=jt("dst","RGB");V.optional(function(){var In=ke.constants.invalidBlendCombinations;ke.assert(nt,In+".indexOf("+Er+'+", "+'+$t+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var xr=nt.def(Tt,"[",Er,"]"),Yr=nt.def(Tt,"[",jt("src","Alpha"),"]"),zn=nt.def(Tt,"[",$t,"]"),Ii=nt.def(Tt,"[",jt("dst","Alpha"),"]");return[xr,zn,Yr,Ii]});case Po:return Et(function(ke){if(typeof ke=="string")return V.commandParameter(ke,pr,"invalid "+ft,xe.commandStr),[pr[ke],pr[ke]];if(typeof ke=="object")return V.commandParameter(ke.rgb,pr,ft+".rgb",xe.commandStr),V.commandParameter(ke.alpha,pr,ft+".alpha",xe.commandStr),[pr[ke.rgb],pr[ke.alpha]];V.commandRaise("invalid blend.equation",xe.commandStr)},function(ke,nt,Oe){var Tt=ke.constants.blendEquations,jt=nt.def(),Er=nt.def(),$t=ke.cond("typeof ",Oe,'==="string"');return V.optional(function(){function xr(Yr,zn,Ii){ke.assert(Yr,Ii+" in "+Tt,"invalid "+zn+", must be one of "+Object.keys(pr))}xr($t.then,ft,Oe),ke.assert($t.else,Oe+"&&typeof "+Oe+'==="object"',"invalid "+ft),xr($t.else,ft+".rgb",Oe+".rgb"),xr($t.else,ft+".alpha",Oe+".alpha")}),$t.then(jt,"=",Er,"=",Tt,"[",Oe,"];"),$t.else(jt,"=",Tt,"[",Oe,".rgb];",Er,"=",Tt,"[",Oe,".alpha];"),nt($t),[jt,Er]});case ri:return Et(function(ke){return V.command(Aa(ke)&&ke.length===4,"blend.color must be a 4d array",xe.commandStr),ie(4,function(nt){return+ke[nt]})},function(ke,nt,Oe){return V.optional(function(){ke.assert(nt,ke.shared.isArrayLike+"("+Oe+")&&"+Oe+".length===4","blend.color must be a 4d array")}),ie(4,function(Tt){return nt.def("+",Oe,"[",Tt,"]")})});case Tu:return Et(function(ke){return V.commandType(ke,"number",st,xe.commandStr),ke|0},function(ke,nt,Oe){return V.optional(function(){ke.assert(nt,"typeof "+Oe+'==="number"',"invalid stencil.mask")}),nt.def(Oe,"|0")});case zu:return Et(function(ke){V.commandType(ke,"object",st,xe.commandStr);var nt=ke.cmp||"keep",Oe=ke.ref||0,Tt="mask"in ke?ke.mask:-1;return V.commandParameter(nt,wf,ft+".cmp",xe.commandStr),V.commandType(Oe,"number",ft+".ref",xe.commandStr),V.commandType(Tt,"number",ft+".mask",xe.commandStr),[wf[nt],Oe,Tt]},function(ke,nt,Oe){var Tt=ke.constants.compareFuncs;V.optional(function(){function xr(){ke.assert(nt,Array.prototype.join.call(arguments,""),"invalid stencil.func")}xr(Oe+"&&typeof ",Oe,'==="object"'),xr('!("cmp" in ',Oe,")||(",Oe,".cmp in ",Tt,")")});var jt=nt.def('"cmp" in ',Oe,"?",Tt,"[",Oe,".cmp]",":",Yc),Er=nt.def(Oe,".ref|0"),$t=nt.def('"mask" in ',Oe,"?",Oe,".mask|0:-1");return[jt,Er,$t]});case Hs:case io:return Et(function(ke){V.commandType(ke,"object",st,xe.commandStr);var nt=ke.fail||"keep",Oe=ke.zfail||"keep",Tt=ke.zpass||"keep";return V.commandParameter(nt,Xl,ft+".fail",xe.commandStr),V.commandParameter(Oe,Xl,ft+".zfail",xe.commandStr),V.commandParameter(Tt,Xl,ft+".zpass",xe.commandStr),[ft===io?Zu:mu,Xl[nt],Xl[Oe],Xl[Tt]]},function(ke,nt,Oe){var Tt=ke.constants.stencilOps;V.optional(function(){ke.assert(nt,Oe+"&&typeof "+Oe+'==="object"',"invalid "+ft)});function jt(Er){return V.optional(function(){ke.assert(nt,'!("'+Er+'" in '+Oe+")||("+Oe+"."+Er+" in "+Tt+")","invalid "+ft+"."+Er+", must be one of "+Object.keys(Xl))}),nt.def('"',Er,'" in ',Oe,"?",Tt,"[",Oe,".",Er,"]:",Yc)}return[ft===io?Zu:mu,jt("fail"),jt("zfail"),jt("zpass")]});case xl:return Et(function(ke){V.commandType(ke,"object",st,xe.commandStr);var nt=ke.factor|0,Oe=ke.units|0;return V.commandType(nt,"number",st+".factor",xe.commandStr),V.commandType(Oe,"number",st+".units",xe.commandStr),[nt,Oe]},function(ke,nt,Oe){V.optional(function(){ke.assert(nt,Oe+"&&typeof "+Oe+'==="object"',"invalid "+ft)});var Tt=nt.def(Oe,".factor|0"),jt=nt.def(Oe,".units|0");return[Tt,jt]});case el:return Et(function(ke){var nt=0;return ke==="front"?nt=mu:ke==="back"&&(nt=Zu),V.command(!!nt,st,xe.commandStr),nt},function(ke,nt,Oe){return V.optional(function(){ke.assert(nt,Oe+'==="front"||'+Oe+'==="back"',"invalid cull.face")}),nt.def(Oe,'==="front"?',mu,":",Zu)});case eu:return Et(function(ke){return V.command(typeof ke=="number"&&ke>=rr.lineWidthDims[0]&&ke<=rr.lineWidthDims[1],"invalid line width, must be a positive number between "+rr.lineWidthDims[0]+" and "+rr.lineWidthDims[1],xe.commandStr),ke},function(ke,nt,Oe){return V.optional(function(){ke.assert(nt,"typeof "+Oe+'==="number"&&'+Oe+">="+rr.lineWidthDims[0]+"&&"+Oe+"<="+rr.lineWidthDims[1],"invalid line width")}),Oe});case ms:return Et(function(ke){return V.commandParameter(ke,il,st,xe.commandStr),il[ke]},function(ke,nt,Oe){return V.optional(function(){ke.assert(nt,Oe+'==="cw"||'+Oe+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),nt.def(Oe+'==="cw"?'+Ss+":"+Xc)});case ds:return Et(function(ke){return V.command(Aa(ke)&&ke.length===4,"color.mask must be length 4 array",xe.commandStr),ke.map(function(nt){return!!nt})},function(ke,nt,Oe){return V.optional(function(){ke.assert(nt,ke.shared.isArrayLike+"("+Oe+")&&"+Oe+".length===4","invalid color.mask")}),ie(4,function(Tt){return"!!"+Oe+"["+Tt+"]"})});case tu:return Et(function(ke){V.command(typeof ke=="object"&&ke,st,xe.commandStr);var nt="value"in ke?ke.value:1,Oe=!!ke.invert;return V.command(typeof nt=="number"&&nt>=0&&nt<=1,"sample.coverage.value must be a number between 0 and 1",xe.commandStr),[nt,Oe]},function(ke,nt,Oe){V.optional(function(){ke.assert(nt,Oe+"&&typeof "+Oe+'==="object"',"invalid sample.coverage")});var Tt=nt.def('"value" in ',Oe,"?+",Oe,".value:1"),jt=nt.def("!!",Oe,".invert");return[Tt,jt]})}}),Mt}function ss(Re,xe){var ot=Re.static,Dt=Re.dynamic,Mt={};return Object.keys(ot).forEach(function(ft){var st=ot[ft],Et;if(typeof st=="number"||typeof st=="boolean")Et=jo(function(){return st});else if(typeof st=="function"){var ke=st._reglType;ke==="texture2d"||ke==="textureCube"?Et=jo(function(nt){return nt.link(st)}):ke==="framebuffer"||ke==="framebufferCube"?(V.command(st.color.length>0,'missing color attachment for framebuffer sent to uniform "'+ft+'"',xe.commandStr),Et=jo(function(nt){return nt.link(st.color[0])})):V.commandRaise('invalid data for uniform "'+ft+'"',xe.commandStr)}else Aa(st)?Et=jo(function(nt){var Oe=nt.global.def("[",ie(st.length,function(Tt){return V.command(typeof st[Tt]=="number"||typeof st[Tt]=="boolean","invalid uniform "+ft,nt.commandStr),st[Tt]}),"]");return Oe}):V.commandRaise('invalid or missing data for uniform "'+ft+'"',xe.commandStr);Et.value=st,Mt[ft]=Et}),Object.keys(Dt).forEach(function(ft){var st=Dt[ft];Mt[ft]=Uu(st,function(Et,ke){return Et.invoke(ke,st)})}),Mt}function $i(Re,xe){var ot=Re.static,Dt=Re.dynamic,Mt={};return Object.keys(ot).forEach(function(ft){var st=ot[ft],Et=Pe.id(ft),ke=new Zt;if(Yf(st))ke.state=Fn,ke.buffer=wr.getBuffer(wr.create(st,Hl,!1,!0)),ke.type=0;else{var nt=wr.getBuffer(st);if(nt)ke.state=Fn,ke.buffer=nt,ke.type=0;else if(V.command(typeof st=="object"&&st,"invalid data for attribute "+ft,xe.commandStr),"constant"in st){var Oe=st.constant;ke.buffer="null",ke.state=Vn,typeof Oe=="number"?ke.x=Oe:(V.command(Aa(Oe)&&Oe.length>0&&Oe.length<=4,"invalid constant for attribute "+ft,xe.commandStr),Xr.forEach(function(zn,Ii){Ii<Oe.length&&(ke[zn]=Oe[Ii])}))}else{Yf(st.buffer)?nt=wr.getBuffer(wr.create(st.buffer,Hl,!1,!0)):nt=wr.getBuffer(st.buffer),V.command(!!nt,'missing buffer for attribute "'+ft+'"',xe.commandStr);var Tt=st.offset|0;V.command(Tt>=0,'invalid offset for attribute "'+ft+'"',xe.commandStr);var jt=st.stride|0;V.command(jt>=0&&jt<256,'invalid stride for attribute "'+ft+'", must be integer betweeen [0, 255]',xe.commandStr);var Er=st.size|0;V.command(!("size"in st)||Er>0&&Er<=4,'invalid size for attribute "'+ft+'", must be 1,2,3,4',xe.commandStr);var $t=!!st.normalized,xr=0;"type"in st&&(V.commandParameter(st.type,ua,"invalid type for attribute "+ft,xe.commandStr),xr=ua[st.type]);var Yr=st.divisor|0;"divisor"in st&&(V.command(Yr===0||Vr,'cannot specify divisor for attribute "'+ft+'", instancing not supported',xe.commandStr),V.command(Yr>=0,'invalid divisor for attribute "'+ft+'"',xe.commandStr)),V.optional(function(){var zn=xe.commandStr,Ii=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(st).forEach(function(In){V.command(Ii.indexOf(In)>=0,'unknown parameter "'+In+'" for attribute pointer "'+ft+'" (valid parameters are '+Ii+")",zn)})}),ke.buffer=nt,ke.state=Fn,ke.size=Er,ke.normalized=$t,ke.type=xr||nt.dtype,ke.offset=Tt,ke.stride=jt,ke.divisor=Yr}}Mt[ft]=jo(function(zn,Ii){var In=zn.attribCache;if(Et in In)return In[Et];var $n={isStream:!1};return Object.keys(ke).forEach(function(Oi){$n[Oi]=ke[Oi]}),ke.buffer&&($n.buffer=zn.link(ke.buffer),$n.type=$n.type||$n.buffer+".dtype"),In[Et]=$n,$n})}),Object.keys(Dt).forEach(function(ft){var st=Dt[ft];function Et(ke,nt){var Oe=ke.invoke(nt,st),Tt=ke.shared,jt=ke.constants,Er=Tt.isBufferArgs,$t=Tt.buffer;V.optional(function(){ke.assert(nt,Oe+"&&(typeof "+Oe+'==="object"||typeof '+Oe+'==="function")&&('+Er+"("+Oe+")||"+$t+".getBuffer("+Oe+")||"+$t+".getBuffer("+Oe+".buffer)||"+Er+"("+Oe+'.buffer)||("constant" in '+Oe+"&&(typeof "+Oe+'.constant==="number"||'+Tt.isArrayLike+"("+Oe+".constant))))",'invalid dynamic attribute "'+ft+'"')});var xr={isStream:nt.def(!1)},Yr=new Zt;Yr.state=Fn,Object.keys(Yr).forEach(function($n){xr[$n]=nt.def(""+Yr[$n])});var zn=xr.buffer,Ii=xr.type;nt("if(",Er,"(",Oe,")){",xr.isStream,"=true;",zn,"=",$t,".createStream(",Hl,",",Oe,");",Ii,"=",zn,".dtype;","}else{",zn,"=",$t,".getBuffer(",Oe,");","if(",zn,"){",Ii,"=",zn,".dtype;",'}else if("constant" in ',Oe,"){",xr.state,"=",Vn,";","if(typeof "+Oe+'.constant === "number"){',xr[Xr[0]],"=",Oe,".constant;",Xr.slice(1).map(function($n){return xr[$n]}).join("="),"=0;","}else{",Xr.map(function($n,Oi){return xr[$n]+"="+Oe+".constant.length>"+Oi+"?"+Oe+".constant["+Oi+"]:0;"}).join(""),"}}else{","if(",Er,"(",Oe,".buffer)){",zn,"=",$t,".createStream(",Hl,",",Oe,".buffer);","}else{",zn,"=",$t,".getBuffer(",Oe,".buffer);","}",Ii,'="type" in ',Oe,"?",jt.glTypes,"[",Oe,".type]:",zn,".dtype;",xr.normalized,"=!!",Oe,".normalized;");function In($n){nt(xr[$n],"=",Oe,".",$n,"|0;")}return In("size"),In("offset"),In("stride"),In("divisor"),nt("}}"),nt.exit("if(",xr.isStream,"){",$t,".destroyStream(",zn,");","}"),xr}Mt[ft]=Uu(st,Et)}),Mt}function vo(Re,xe){var ot=Re.static,Dt=Re.dynamic;if(Pu in ot){var Mt=ot[Pu];return Mt!==null&&Jr.getVAO(Mt)===null&&(Mt=Jr.createVAO(Mt)),jo(function(st){return st.link(Jr.getVAO(Mt))})}else if(Pu in Dt){var ft=Dt[Pu];return Uu(ft,function(st,Et){var ke=st.invoke(Et,ft);return Et.def(st.shared.vao+".getVAO("+ke+")")})}return null}function so(Re){var xe=Re.static,ot=Re.dynamic,Dt={};return Object.keys(xe).forEach(function(Mt){var ft=xe[Mt];Dt[Mt]=jo(function(st,Et){return typeof ft=="number"||typeof ft=="boolean"?""+ft:st.link(ft)})}),Object.keys(ot).forEach(function(Mt){var ft=ot[Mt];Dt[Mt]=Uu(ft,function(st,Et){return st.invoke(Et,ft)})}),Dt}function Qo(Re,xe,ot,Dt,Mt){var ft=Re.static,st=Re.dynamic;V.optional(function(){var In=[ao,ko,Rs,tl,vu,nl,rl,Ec,qi,Pu].concat(zr);function $n(Oi){Object.keys(Oi).forEach(function(ha){V.command(In.indexOf(ha)>=0,'unknown parameter "'+ha+'"',Mt.commandStr)})}$n(ft),$n(st)});var Et=Pi(Re,xe),ke=kn(Re,Mt),nt=ea(Re,ke,Mt),Oe=fa(Re,Mt),Tt=Jo(Re,Mt),jt=ji(Re,Mt,Et);function Er(In){var $n=nt[In];$n&&(Tt[In]=$n)}Er(gs),Er(nn(du));var $t=Object.keys(Tt).length>0,xr={framebuffer:ke,draw:Oe,shader:jt,state:Tt,dirty:$t,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(xr.profile=ui(Re,Mt),xr.uniforms=ss(ot,Mt),xr.drawVAO=xr.scopeVAO=vo(Re,Mt),!xr.drawVAO&&jt.program&&!Et&&Ze.angle_instanced_arrays){var Yr=!0,zn=jt.program.attributes.map(function(In){var $n=xe.static[In];return Yr=Yr&&!!$n,$n});if(Yr&&zn.length>0){var Ii=Jr.getVAO(Jr.createVAO(zn));xr.drawVAO=new gu(null,null,null,function(In,$n){return In.link(Ii)}),xr.useVAO=!0}}return Et?xr.useVAO=!0:xr.attributes=$i(xe,Mt),xr.context=so(Dt,Mt),xr}function ys(Re,xe,ot){var Dt=Re.shared,Mt=Dt.context,ft=Re.scope();Object.keys(ot).forEach(function(st){xe.save(Mt,"."+st);var Et=ot[st],ke=Et.append(Re,xe);Array.isArray(ke)?ft(Mt,".",st,"=[",ke.join(),"];"):ft(Mt,".",st,"=",ke,";")}),xe(ft)}function Es(Re,xe,ot,Dt){var Mt=Re.shared,ft=Mt.gl,st=Mt.framebuffer,Et;mn&&(Et=xe.def(Mt.extensions,".webgl_draw_buffers"));var ke=Re.constants,nt=ke.drawBuffer,Oe=ke.backBuffer,Tt;ot?Tt=ot.append(Re,xe):Tt=xe.def(st,".next"),Dt||xe("if(",Tt,"!==",st,".cur){"),xe("if(",Tt,"){",ft,".bindFramebuffer(",Ih,",",Tt,".framebuffer);"),mn&&xe(Et,".drawBuffersWEBGL(",nt,"[",Tt,".colorAttachments.length]);"),xe("}else{",ft,".bindFramebuffer(",Ih,",null);"),mn&&xe(Et,".drawBuffersWEBGL(",Oe,");"),xe("}",st,".cur=",Tt,";"),Dt||xe("}")}function ks(Re,xe,ot){var Dt=Re.shared,Mt=Dt.gl,ft=Re.current,st=Re.next,Et=Dt.current,ke=Dt.next,nt=Re.cond(Et,".dirty");zr.forEach(function(Oe){var Tt=nn(Oe);if(!(Tt in ot.state)){var jt,Er;if(Tt in st){jt=st[Tt],Er=ft[Tt];var $t=ie(Br[Tt].length,function(Yr){return nt.def(jt,"[",Yr,"]")});nt(Re.cond($t.map(function(Yr,zn){return Yr+"!=="+Er+"["+zn+"]"}).join("||")).then(Mt,".",kr[Tt],"(",$t,");",$t.map(function(Yr,zn){return Er+"["+zn+"]="+Yr}).join(";"),";"))}else{jt=nt.def(ke,".",Tt);var xr=Re.cond(jt,"!==",Et,".",Tt);nt(xr),Tt in un?xr(Re.cond(jt).then(Mt,".enable(",un[Tt],");").else(Mt,".disable(",un[Tt],");"),Et,".",Tt,"=",jt,";"):xr(Mt,".",kr[Tt],"(",jt,");",Et,".",Tt,"=",jt,";")}}}),Object.keys(ot.state).length===0&&nt(Et,".dirty=false;"),xe(nt)}function _s(Re,xe,ot,Dt){var Mt=Re.shared,ft=Re.current,st=Mt.current,Et=Mt.gl;Oh(Object.keys(ot)).forEach(function(ke){var nt=ot[ke];if(!(Dt&&!Dt(nt))){var Oe=nt.append(Re,xe);if(un[ke]){var Tt=un[ke];al(nt)?Oe?xe(Et,".enable(",Tt,");"):xe(Et,".disable(",Tt,");"):xe(Re.cond(Oe).then(Et,".enable(",Tt,");").else(Et,".disable(",Tt,");")),xe(st,".",ke,"=",Oe,";")}else if(Aa(Oe)){var jt=ft[ke];xe(Et,".",kr[ke],"(",Oe,");",Oe.map(function(Er,$t){return jt+"["+$t+"]="+Er}).join(";"),";")}else xe(Et,".",kr[ke],"(",Oe,");",st,".",ke,"=",Oe,";")}})}function Fo(Re,xe){Vr&&(Re.instancing=xe.def(Re.shared.extensions,".angle_instanced_arrays"))}function Ni(Re,xe,ot,Dt,Mt){var ft=Re.shared,st=Re.stats,Et=ft.current,ke=ft.timer,nt=ot.profile;function Oe(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var Tt,jt;function Er(In){Tt=xe.def(),In(Tt,"=",Oe(),";"),typeof Mt=="string"?In(st,".count+=",Mt,";"):In(st,".count++;"),jr&&(Dt?(jt=xe.def(),In(jt,"=",ke,".getNumPendingQueries();")):In(ke,".beginQuery(",st,");"))}function $t(In){In(st,".cpuTime+=",Oe(),"-",Tt,";"),jr&&(Dt?In(ke,".pushScopeStats(",jt,",",ke,".getNumPendingQueries(),",st,");"):In(ke,".endQuery();"))}function xr(In){var $n=xe.def(Et,".profile");xe(Et,".profile=",In,";"),xe.exit(Et,".profile=",$n,";")}var Yr;if(nt){if(al(nt)){nt.enable?(Er(xe),$t(xe.exit),xr("true")):xr("false");return}Yr=nt.append(Re,xe),xr(Yr)}else Yr=xe.def(Et,".profile");var zn=Re.block();Er(zn),xe("if(",Yr,"){",zn,"}");var Ii=Re.block();$t(Ii),xe.exit("if(",Yr,"){",Ii,"}")}function Fs(Re,xe,ot,Dt,Mt){var ft=Re.shared;function st(ke){switch(ke){case Gn:case aa:case bo:return 2;case Mn:case Mi:case So:return 3;case di:case Ha:case Qa:return 4;default:return 1}}function Et(ke,nt,Oe){var Tt=ft.gl,jt=xe.def(ke,".location"),Er=xe.def(ft.attributes,"[",jt,"]"),$t=Oe.state,xr=Oe.buffer,Yr=[Oe.x,Oe.y,Oe.z,Oe.w],zn=["buffer","normalized","offset","stride"];function Ii(){xe("if(!",Er,".buffer){",Tt,".enableVertexAttribArray(",jt,");}");var $n=Oe.type,Oi;if(Oe.size?Oi=xe.def(Oe.size,"||",nt):Oi=nt,xe("if(",Er,".type!==",$n,"||",Er,".size!==",Oi,"||",zn.map(function(Co){return Er+"."+Co+"!=="+Oe[Co]}).join("||"),"){",Tt,".bindBuffer(",Hl,",",xr,".buffer);",Tt,".vertexAttribPointer(",[jt,Oi,$n,Oe.normalized,Oe.stride,Oe.offset],");",Er,".type=",$n,";",Er,".size=",Oi,";",zn.map(function(Co){return Er+"."+Co+"="+Oe[Co]+";"}).join(""),"}"),Vr){var ha=Oe.divisor;xe("if(",Er,".divisor!==",ha,"){",Re.instancing,".vertexAttribDivisorANGLE(",[jt,ha],");",Er,".divisor=",ha,";}")}}function In(){xe("if(",Er,".buffer){",Tt,".disableVertexAttribArray(",jt,");",Er,".buffer=null;","}if(",Xr.map(function($n,Oi){return Er+"."+$n+"!=="+Yr[Oi]}).join("||"),"){",Tt,".vertexAttrib4f(",jt,",",Yr,");",Xr.map(function($n,Oi){return Er+"."+$n+"="+Yr[Oi]+";"}).join(""),"}")}$t===Fn?Ii():$t===Vn?In():(xe("if(",$t,"===",Fn,"){"),Ii(),xe("}else{"),In(),xe("}"))}Dt.forEach(function(ke){var nt=ke.name,Oe=ot.attributes[nt],Tt;if(Oe){if(!Mt(Oe))return;Tt=Oe.append(Re,xe)}else{if(!Mt(Lh))return;var jt=Re.scopeAttrib(nt);V.optional(function(){Re.assert(xe,jt+".state","missing attribute "+nt)}),Tt={},Object.keys(new Zt).forEach(function(Er){Tt[Er]=xe.def(jt,".",Er)})}Et(Re.link(ke),st(ke.info.type),Tt)})}function Sa(Re,xe,ot,Dt,Mt){for(var ft=Re.shared,st=ft.gl,Et,ke=0;ke<Dt.length;++ke){var nt=Dt[ke],Oe=nt.name,Tt=nt.info.type,jt=ot.uniforms[Oe],Er=Re.link(nt),$t=Er+".location",xr;if(jt){if(!Mt(jt))continue;if(al(jt)){var Yr=jt.value;if(V.command(Yr!==null&&typeof Yr!="undefined",'missing uniform "'+Oe+'"',Re.commandStr),Tt===oo||Tt===wo){V.command(typeof Yr=="function"&&(Tt===oo&&(Yr._reglType==="texture2d"||Yr._reglType==="framebuffer")||Tt===wo&&(Yr._reglType==="textureCube"||Yr._reglType==="framebufferCube")),"invalid texture for uniform "+Oe,Re.commandStr);var zn=Re.link(Yr._texture||Yr.color[0]._texture);xe(st,".uniform1i(",$t,",",zn+".bind());"),xe.exit(zn,".unbind();")}else if(Tt===ca||Tt===Wa||Tt===Eo){V.optional(function(){V.command(Aa(Yr),"invalid matrix for uniform "+Oe,Re.commandStr),V.command(Tt===ca&&Yr.length===4||Tt===Wa&&Yr.length===9||Tt===Eo&&Yr.length===16,"invalid length for matrix uniform "+Oe,Re.commandStr)});var Ii=Re.global.def("new Float32Array(["+Array.prototype.slice.call(Yr)+"])"),In=2;Tt===Wa?In=3:Tt===Eo&&(In=4),xe(st,".uniformMatrix",In,"fv(",$t,",false,",Ii,");")}else{switch(Tt){case Rn:V.commandType(Yr,"number","uniform "+Oe,Re.commandStr),Et="1f";break;case Gn:V.command(Aa(Yr)&&Yr.length===2,"uniform "+Oe,Re.commandStr),Et="2f";break;case Mn:V.command(Aa(Yr)&&Yr.length===3,"uniform "+Oe,Re.commandStr),Et="3f";break;case di:V.command(Aa(Yr)&&Yr.length===4,"uniform "+Oe,Re.commandStr),Et="4f";break;case Mo:V.commandType(Yr,"boolean","uniform "+Oe,Re.commandStr),Et="1i";break;case yi:V.commandType(Yr,"number","uniform "+Oe,Re.commandStr),Et="1i";break;case bo:V.command(Aa(Yr)&&Yr.length===2,"uniform "+Oe,Re.commandStr),Et="2i";break;case aa:V.command(Aa(Yr)&&Yr.length===2,"uniform "+Oe,Re.commandStr),Et="2i";break;case So:V.command(Aa(Yr)&&Yr.length===3,"uniform "+Oe,Re.commandStr),Et="3i";break;case Mi:V.command(Aa(Yr)&&Yr.length===3,"uniform "+Oe,Re.commandStr),Et="3i";break;case Qa:V.command(Aa(Yr)&&Yr.length===4,"uniform "+Oe,Re.commandStr),Et="4i";break;case Ha:V.command(Aa(Yr)&&Yr.length===4,"uniform "+Oe,Re.commandStr),Et="4i";break}xe(st,".uniform",Et,"(",$t,",",Aa(Yr)?Array.prototype.slice.call(Yr):Yr,");")}continue}else xr=jt.append(Re,xe)}else{if(!Mt(Lh))continue;xr=xe.def(ft.uniforms,"[",Pe.id(Oe),"]")}Tt===oo?(V(!Array.isArray(xr),"must specify a scalar prop for textures"),xe("if(",xr,"&&",xr,'._reglType==="framebuffer"){',xr,"=",xr,".color[0];","}")):Tt===wo&&(V(!Array.isArray(xr),"must specify a scalar prop for cube maps"),xe("if(",xr,"&&",xr,'._reglType==="framebufferCube"){',xr,"=",xr,".color[0];","}")),V.optional(function(){function yu(Tl,kf){Re.assert(xe,Tl,'bad data or missing for uniform "'+Oe+'".  '+kf)}function Df(Tl){V(!Array.isArray(xr),"must not specify an array type for uniform"),yu("typeof "+xr+'==="'+Tl+'"',"invalid type, expected "+Tl)}function Cl(Tl,kf){Array.isArray(xr)?V(xr.length===Tl,"must have length "+Tl):yu(ft.isArrayLike+"("+xr+")&&"+xr+".length==="+Tl,"invalid vector, should have length "+Tl,Re.commandStr)}function sh(Tl){V(!Array.isArray(xr),"must not specify a value type"),yu("typeof "+xr+'==="function"&&'+xr+'._reglType==="texture'+(Tl===j?"2d":"Cube")+'"',"invalid texture type",Re.commandStr)}switch(Tt){case yi:Df("number");break;case aa:Cl(2,"number");break;case Mi:Cl(3,"number");break;case Ha:Cl(4,"number");break;case Rn:Df("number");break;case Gn:Cl(2,"number");break;case Mn:Cl(3,"number");break;case di:Cl(4,"number");break;case Mo:Df("boolean");break;case bo:Cl(2,"boolean");break;case So:Cl(3,"boolean");break;case Qa:Cl(4,"boolean");break;case ca:Cl(4,"number");break;case Wa:Cl(9,"number");break;case Eo:Cl(16,"number");break;case oo:sh(j);break;case wo:sh(z);break}});var $n=1;switch(Tt){case oo:case wo:var Oi=xe.def(xr,"._texture");xe(st,".uniform1i(",$t,",",Oi,".bind());"),xe.exit(Oi,".unbind();");continue;case yi:case Mo:Et="1i";break;case aa:case bo:Et="2i",$n=2;break;case Mi:case So:Et="3i",$n=3;break;case Ha:case Qa:Et="4i",$n=4;break;case Rn:Et="1f";break;case Gn:Et="2f",$n=2;break;case Mn:Et="3f",$n=3;break;case di:Et="4f",$n=4;break;case ca:Et="Matrix2fv";break;case Wa:Et="Matrix3fv";break;case Eo:Et="Matrix4fv";break}if(xe(st,".uniform",Et,"(",$t,","),Et.charAt(0)==="M"){var ha=Math.pow(Tt-ca+2,2),Co=Re.global.def("new Float32Array(",ha,")");Array.isArray(xr)?xe("false,(",ie(ha,function(yu){return Co+"["+yu+"]="+xr[yu]}),",",Co,")"):xe("false,(Array.isArray(",xr,")||",xr," instanceof Float32Array)?",xr,":(",ie(ha,function(yu){return Co+"["+yu+"]="+xr+"["+yu+"]"}),",",Co,")")}else $n>1?xe(ie($n,function(yu){return Array.isArray(xr)?xr[yu]:xr+"["+yu+"]"})):(V(!Array.isArray(xr),"uniform value must not be an array"),xe(xr));xe(");")}}function li(Re,xe,ot,Dt){var Mt=Re.shared,ft=Mt.gl,st=Mt.draw,Et=Dt.draw;function ke(){var Oi=Et.elements,ha,Co=xe;return Oi?((Oi.contextDep&&Dt.contextDynamic||Oi.propDep)&&(Co=ot),ha=Oi.append(Re,Co)):ha=Co.def(st,".",tl),ha&&Co("if("+ha+")"+ft+".bindBuffer("+ih+","+ha+".buffer.buffer);"),ha}function nt(){var Oi=Et.count,ha,Co=xe;return Oi?((Oi.contextDep&&Dt.contextDynamic||Oi.propDep)&&(Co=ot),ha=Oi.append(Re,Co),V.optional(function(){Oi.MISSING&&Re.assert(xe,"false","missing vertex count"),Oi.DYNAMIC&&Re.assert(Co,ha+">=0","missing vertex count")})):(ha=Co.def(st,".",rl),V.optional(function(){Re.assert(Co,ha+">=0","missing vertex count")})),ha}var Oe=ke();function Tt(Oi){var ha=Et[Oi];return ha?ha.contextDep&&Dt.contextDynamic||ha.propDep?ha.append(Re,ot):ha.append(Re,xe):xe.def(st,".",Oi)}var jt=Tt(vu),Er=Tt(nl),$t=nt();if(typeof $t=="number"){if($t===0)return}else ot("if(",$t,"){"),ot.exit("}");var xr,Yr;Vr&&(xr=Tt(Ec),Yr=Re.instancing);var zn=Oe+".type",Ii=Et.elements&&al(Et.elements);function In(){function Oi(){ot(Yr,".drawElementsInstancedANGLE(",[jt,$t,zn,Er+"<<(("+zn+"-"+yn+")>>1)",xr],");")}function ha(){ot(Yr,".drawArraysInstancedANGLE(",[jt,Er,$t,xr],");")}Oe?Ii?Oi():(ot("if(",Oe,"){"),Oi(),ot("}else{"),ha(),ot("}")):ha()}function $n(){function Oi(){ot(ft+".drawElements("+[jt,$t,zn,Er+"<<(("+zn+"-"+yn+")>>1)"]+");")}function ha(){ot(ft+".drawArrays("+[jt,Er,$t]+");")}Oe?Ii?Oi():(ot("if(",Oe,"){"),Oi(),ot("}else{"),ha(),ot("}")):ha()}Vr&&(typeof xr!="number"||xr>=0)?typeof xr=="string"?(ot("if(",xr,">0){"),In(),ot("}else if(",xr,"<0){"),$n(),ot("}")):In():$n()}function Wi(Re,xe,ot,Dt,Mt){var ft=si(),st=ft.proc("body",Mt);return V.optional(function(){ft.commandStr=xe.commandStr,ft.command=ft.link(xe.commandStr)}),Vr&&(ft.instancing=st.def(ft.shared.extensions,".angle_instanced_arrays")),Re(ft,st,ot,Dt),ft.compile().body}function oa(Re,xe,ot,Dt){Fo(Re,xe),ot.useVAO?ot.drawVAO?xe(Re.shared.vao,".setVAO(",ot.drawVAO.append(Re,xe),");"):xe(Re.shared.vao,".setVAO(",Re.shared.vao,".targetVAO);"):(xe(Re.shared.vao,".setVAO(null);"),Fs(Re,xe,ot,Dt.attributes,function(){return!0})),Sa(Re,xe,ot,Dt.uniforms,function(){return!0}),li(Re,xe,xe,ot)}function qo(Re,xe){var ot=Re.proc("draw",1);Fo(Re,ot),ys(Re,ot,xe.context),Es(Re,ot,xe.framebuffer),ks(Re,ot,xe),_s(Re,ot,xe.state),Ni(Re,ot,xe,!1,!0);var Dt=xe.shader.progVar.append(Re,ot);if(ot(Re.shared.gl,".useProgram(",Dt,".program);"),xe.shader.program)oa(Re,ot,xe,xe.shader.program);else{ot(Re.shared.vao,".setVAO(null);");var Mt=Re.global.def("{}"),ft=ot.def(Dt,".id"),st=ot.def(Mt,"[",ft,"]");ot(Re.cond(st).then(st,".call(this,a0);").else(st,"=",Mt,"[",ft,"]=",Re.link(function(Et){return Wi(oa,Re,xe,Et,1)}),"(",Dt,");",st,".call(this,a0);"))}Object.keys(xe.state).length>0&&ot(Re.shared.current,".dirty=true;")}function El(Re,xe,ot,Dt){Re.batchId="a1",Fo(Re,xe);function Mt(){return!0}Fs(Re,xe,ot,Dt.attributes,Mt),Sa(Re,xe,ot,Dt.uniforms,Mt),li(Re,xe,xe,ot)}function wl(Re,xe,ot,Dt){Fo(Re,xe);var Mt=ot.contextDep,ft=xe.def(),st="a0",Et="a1",ke=xe.def();Re.shared.props=ke,Re.batchId=ft;var nt=Re.scope(),Oe=Re.scope();xe(nt.entry,"for(",ft,"=0;",ft,"<",Et,";++",ft,"){",ke,"=",st,"[",ft,"];",Oe,"}",nt.exit);function Tt(zn){return zn.contextDep&&Mt||zn.propDep}function jt(zn){return!Tt(zn)}if(ot.needsContext&&ys(Re,Oe,ot.context),ot.needsFramebuffer&&Es(Re,Oe,ot.framebuffer),_s(Re,Oe,ot.state,Tt),ot.profile&&Tt(ot.profile)&&Ni(Re,Oe,ot,!1,!0),Dt)ot.useVAO?ot.drawVAO?Tt(ot.drawVAO)?Oe(Re.shared.vao,".setVAO(",ot.drawVAO.append(Re,Oe),");"):nt(Re.shared.vao,".setVAO(",ot.drawVAO.append(Re,nt),");"):nt(Re.shared.vao,".setVAO(",Re.shared.vao,".targetVAO);"):(nt(Re.shared.vao,".setVAO(null);"),Fs(Re,nt,ot,Dt.attributes,jt),Fs(Re,Oe,ot,Dt.attributes,Tt)),Sa(Re,nt,ot,Dt.uniforms,jt),Sa(Re,Oe,ot,Dt.uniforms,Tt),li(Re,nt,Oe,ot);else{var Er=Re.global.def("{}"),$t=ot.shader.progVar.append(Re,Oe),xr=Oe.def($t,".id"),Yr=Oe.def(Er,"[",xr,"]");Oe(Re.shared.gl,".useProgram(",$t,".program);","if(!",Yr,"){",Yr,"=",Er,"[",xr,"]=",Re.link(function(zn){return Wi(El,Re,ot,zn,2)}),"(",$t,");}",Yr,".call(this,a0[",ft,"],",ft,");")}}function Ve(Re,xe){var ot=Re.proc("batch",2);Re.batchId="0",Fo(Re,ot);var Dt=!1,Mt=!0;Object.keys(xe.context).forEach(function(Er){Dt=Dt||xe.context[Er].propDep}),Dt||(ys(Re,ot,xe.context),Mt=!1);var ft=xe.framebuffer,st=!1;ft?(ft.propDep?Dt=st=!0:ft.contextDep&&Dt&&(st=!0),st||Es(Re,ot,ft)):Es(Re,ot,null),xe.state.viewport&&xe.state.viewport.propDep&&(Dt=!0);function Et(Er){return Er.contextDep&&Dt||Er.propDep}ks(Re,ot,xe),_s(Re,ot,xe.state,function(Er){return!Et(Er)}),(!xe.profile||!Et(xe.profile))&&Ni(Re,ot,xe,!1,"a1"),xe.contextDep=Dt,xe.needsContext=Mt,xe.needsFramebuffer=st;var ke=xe.shader.progVar;if(ke.contextDep&&Dt||ke.propDep)wl(Re,ot,xe,null);else{var nt=ke.append(Re,ot);if(ot(Re.shared.gl,".useProgram(",nt,".program);"),xe.shader.program)wl(Re,ot,xe,xe.shader.program);else{ot(Re.shared.vao,".setVAO(null);");var Oe=Re.global.def("{}"),Tt=ot.def(nt,".id"),jt=ot.def(Oe,"[",Tt,"]");ot(Re.cond(jt).then(jt,".call(this,a0,a1);").else(jt,"=",Oe,"[",Tt,"]=",Re.link(function(Er){return Wi(wl,Re,xe,Er,2)}),"(",nt,");",jt,".call(this,a0,a1);"))}}Object.keys(xe.state).length>0&&ot(Re.shared.current,".dirty=true;")}function qt(Re,xe){var ot=Re.proc("scope",3);Re.batchId="a2";var Dt=Re.shared,Mt=Dt.current;ys(Re,ot,xe.context),xe.framebuffer&&xe.framebuffer.append(Re,ot),Oh(Object.keys(xe.state)).forEach(function(st){var Et=xe.state[st],ke=Et.append(Re,ot);Aa(ke)?ke.forEach(function(nt,Oe){ot.set(Re.next[st],"["+Oe+"]",nt)}):ot.set(Dt.next,"."+st,ke)}),Ni(Re,ot,xe,!0,!0),[tl,nl,rl,Ec,vu].forEach(function(st){var Et=xe.draw[st];!Et||ot.set(Dt.draw,"."+st,""+Et.append(Re,ot))}),Object.keys(xe.uniforms).forEach(function(st){var Et=xe.uniforms[st].append(Re,ot);Array.isArray(Et)&&(Et="["+Et.join()+"]"),ot.set(Dt.uniforms,"["+Pe.id(st)+"]",Et)}),Object.keys(xe.attributes).forEach(function(st){var Et=xe.attributes[st].append(Re,ot),ke=Re.scopeAttrib(st);Object.keys(new Zt).forEach(function(nt){ot.set(ke,"."+nt,Et[nt])})}),xe.scopeVAO&&ot.set(Dt.vao,".targetVAO",xe.scopeVAO.append(Re,ot));function ft(st){var Et=xe.shader[st];Et&&ot.set(Dt.shader,"."+st,Et.append(Re,ot))}ft(ko),ft(Rs),Object.keys(xe.state).length>0&&(ot(Mt,".dirty=true;"),ot.exit(Mt,".dirty=true;")),ot("a1(",Re.shared.context,",a0,",Re.batchId,");")}function Kt(Re){if(!(typeof Re!="object"||Aa(Re))){for(var xe=Object.keys(Re),ot=0;ot<xe.length;++ot)if(lt.isDynamic(Re[xe[ot]]))return!0;return!1}}function Cn(Re,xe,ot){var Dt=xe.static[ot];if(!Dt||!Kt(Dt))return;var Mt=Re.global,ft=Object.keys(Dt),st=!1,Et=!1,ke=!1,nt=Re.global.def("{}");ft.forEach(function(Tt){var jt=Dt[Tt];if(lt.isDynamic(jt)){typeof jt=="function"&&(jt=Dt[Tt]=lt.unbox(jt));var Er=Uu(jt,null);st=st||Er.thisDep,ke=ke||Er.propDep,Et=Et||Er.contextDep}else{switch(Mt(nt,".",Tt,"="),typeof jt){case"number":Mt(jt);break;case"string":Mt('"',jt,'"');break;case"object":Array.isArray(jt)&&Mt("[",jt.join(),"]");break;default:Mt(Re.link(jt));break}Mt(";")}});function Oe(Tt,jt){ft.forEach(function(Er){var $t=Dt[Er];if(!!lt.isDynamic($t)){var xr=Tt.invoke(jt,$t);jt(nt,".",Er,"=",xr,";")}})}xe.dynamic[ot]=new lt.DynamicVariable(Ci,{thisDep:st,contextDep:Et,propDep:ke,ref:nt,append:Oe}),delete xe.static[ot]}function Xi(Re,xe,ot,Dt,Mt){var ft=si();ft.stats=ft.link(Mt),Object.keys(xe.static).forEach(function(Et){Cn(ft,xe,Et)}),Wf.forEach(function(Et){Cn(ft,Re,Et)});var st=Qo(Re,xe,ot,Dt,ft);return qo(ft,st),qt(ft,st),Ve(ft,st),_(ft.compile(),{destroy:function(){st.shader.program.destroy()}})}return{next:Sn,current:Br,procs:function(){var Re=si(),xe=Re.proc("poll"),ot=Re.proc("refresh"),Dt=Re.block();xe(Dt),ot(Dt);var Mt=Re.shared,ft=Mt.gl,st=Mt.next,Et=Mt.current;Dt(Et,".dirty=false;"),Es(Re,xe),Es(Re,ot,null,!0);var ke;Vr&&(ke=Re.link(Vr)),Ze.oes_vertex_array_object&&ot(Re.link(Ze.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var nt=0;nt<rr.maxAttributes;++nt){var Oe=ot.def(Mt.attributes,"[",nt,"]"),Tt=Re.cond(Oe,".buffer");Tt.then(ft,".enableVertexAttribArray(",nt,");",ft,".bindBuffer(",Hl,",",Oe,".buffer.buffer);",ft,".vertexAttribPointer(",nt,",",Oe,".size,",Oe,".type,",Oe,".normalized,",Oe,".stride,",Oe,".offset);").else(ft,".disableVertexAttribArray(",nt,");",ft,".vertexAttrib4f(",nt,",",Oe,".x,",Oe,".y,",Oe,".z,",Oe,".w);",Oe,".buffer=null;"),ot(Tt),Vr&&ot(ke,".vertexAttribDivisorANGLE(",nt,",",Oe,".divisor);")}return ot(Re.shared.vao,".currentVAO=null;",Re.shared.vao,".setVAO(",Re.shared.vao,".targetVAO);"),Object.keys(un).forEach(function(jt){var Er=un[jt],$t=Dt.def(st,".",jt),xr=Re.block();xr("if(",$t,"){",ft,".enable(",Er,")}else{",ft,".disable(",Er,")}",Et,".",jt,"=",$t,";"),ot(xr),xe("if(",$t,"!==",Et,".",jt,"){",xr,"}")}),Object.keys(kr).forEach(function(jt){var Er=kr[jt],$t=Br[jt],xr,Yr,zn=Re.block();if(zn(ft,".",Er,"("),Aa($t)){var Ii=$t.length;xr=Re.global.def(st,".",jt),Yr=Re.global.def(Et,".",jt),zn(ie(Ii,function(In){return xr+"["+In+"]"}),");",ie(Ii,function(In){return Yr+"["+In+"]="+xr+"["+In+"];"}).join("")),xe("if(",ie(Ii,function(In){return xr+"["+In+"]!=="+Yr+"["+In+"]"}).join("||"),"){",zn,"}")}else xr=Dt.def(st,".",jt),Yr=Dt.def(Et,".",jt),zn(xr,");",Et,".",jt,"=",xr,";"),xe("if(",xr,"!==",Yr,"){",zn,"}");ot(zn)}),Re.compile()}(),compile:Xi}}function Rh(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Dh=34918,nu=34919,kh=35007,ah=function(U,Pe){if(!Pe.ext_disjoint_timer_query)return null;var Ze=[];function rr(){return Ze.pop()||Pe.ext_disjoint_timer_query.createQueryEXT()}function wr(Vr){Ze.push(Vr)}var Xt=[];function vr(Vr){var mn=rr();Pe.ext_disjoint_timer_query.beginQueryEXT(kh,mn),Xt.push(mn),jr(Xt.length-1,Xt.length,Vr)}function Ur(){Pe.ext_disjoint_timer_query.endQueryEXT(kh)}function Hr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Jr=[];function Gr(){return Jr.pop()||new Hr}function rn(Vr){Jr.push(Vr)}var hn=[];function jr(Vr,mn,Br){var Sn=Gr();Sn.startQueryIndex=Vr,Sn.endQueryIndex=mn,Sn.sum=0,Sn.stats=Br,hn.push(Sn)}var an=[],Zt=[];function pr(){var Vr,mn,Br=Xt.length;if(Br!==0){Zt.length=Math.max(Zt.length,Br+1),an.length=Math.max(an.length,Br+1),an[0]=0,Zt[0]=0;var Sn=0;for(Vr=0,mn=0;mn<Xt.length;++mn){var zr=Xt[mn];Pe.ext_disjoint_timer_query.getQueryObjectEXT(zr,nu)?(Sn+=Pe.ext_disjoint_timer_query.getQueryObjectEXT(zr,Dh),wr(zr)):Xt[Vr++]=zr,an[mn+1]=Sn,Zt[mn+1]=Vr}for(Xt.length=Vr,Vr=0,mn=0;mn<hn.length;++mn){var un=hn[mn],kr=un.startQueryIndex,nn=un.endQueryIndex;un.sum+=an[nn]-an[kr];var Xn=Zt[kr],Kn=Zt[nn];Kn===Xn?(un.stats.gpuTime+=un.sum/1e6,rn(un)):(un.startQueryIndex=Xn,un.endQueryIndex=Kn,hn[Vr++]=un)}hn.length=Vr}}return{beginQuery:vr,endQuery:Ur,pushScopeStats:jr,update:pr,getNumPendingQueries:function(){return Xt.length},clear:function(){Ze.push.apply(Ze,Xt);for(var Vr=0;Vr<Ze.length;Vr++)Pe.ext_disjoint_timer_query.deleteQueryEXT(Ze[Vr]);Xt.length=0,Ze.length=0},restore:function(){Xt.length=0,Ze.length=0}}},oh=16384,dp=256,Fh=1024,vp=34962,Bh="webglcontextlost",Nh="webglcontextrestored",Kf=1,mp=2,zh=3;function $c(U,Pe){for(var Ze=0;Ze<U.length;++Ze)if(U[Ze]===Pe)return Ze;return-1}function Zh(U){var Pe=pi(U);if(!Pe)return null;var Ze=Pe.gl,rr=Ze.getContextAttributes(),wr=Ze.isContextLost(),Xt=H(Ze,Pe);if(!Xt)return null;var vr=or(),Ur=Rh(),Hr=Xt.extensions,Jr=ah(Ze,Hr),Gr=Jt(),rn=Ze.drawingBufferWidth,hn=Ze.drawingBufferHeight,jr={tick:0,time:0,viewportWidth:rn,viewportHeight:hn,framebufferWidth:rn,framebufferHeight:hn,drawingBufferWidth:rn,drawingBufferHeight:hn,pixelRatio:Pe.pixelRatio},an={},Zt={elements:null,primitive:4,count:-1,offset:0,instances:-1},pr=Ca(Ze,Hr),Vr=sa(Ze,Ur,Pe,Br),mn=ye(Ze,Hr,pr,Ur,Vr);function Br(li){return mn.destroyBuffer(li)}var Sn=Hf(Ze,Hr,Vr,Ur),zr=ze(Ze,vr,Ur,Pe),un=Qs(Ze,Hr,pr,function(){Xn.procs.poll()},jr,Ur,Pe),kr=ku(Ze,Hr,pr,Ur,Pe),nn=R(Ze,Hr,pr,un,kr,Ur),Xn=pp(Ze,vr,Hr,pr,Vr,Sn,un,nn,an,mn,zr,Zt,jr,Jr,Pe),Kn=nr(Ze,nn,Xn.procs.poll,jr,rr,Hr,pr),sn=Xn.next,Nr=Ze.canvas,Ir=[],si=[],ui=[],kn=[Pe.onDestroy],ea=null;function Pi(){if(Ir.length===0){Jr&&Jr.update(),ea=null;return}ea=Lt.next(Pi),_s();for(var li=Ir.length-1;li>=0;--li){var Wi=Ir[li];Wi&&Wi(jr,null,0)}Ze.flush(),Jr&&Jr.update()}function ji(){!ea&&Ir.length>0&&(ea=Lt.next(Pi))}function fa(){ea&&(Lt.cancel(Pi),ea=null)}function Jo(li){li.preventDefault(),wr=!0,fa(),si.forEach(function(Wi){Wi()})}function ss(li){Ze.getError(),wr=!1,Xt.restore(),zr.restore(),Vr.restore(),un.restore(),kr.restore(),nn.restore(),mn.restore(),Jr&&Jr.restore(),Xn.procs.refresh(),ji(),ui.forEach(function(Wi){Wi()})}Nr&&(Nr.addEventListener(Bh,Jo,!1),Nr.addEventListener(Nh,ss,!1));function $i(){Ir.length=0,fa(),Nr&&(Nr.removeEventListener(Bh,Jo),Nr.removeEventListener(Nh,ss)),zr.clear(),nn.clear(),kr.clear(),un.clear(),Sn.clear(),Vr.clear(),mn.clear(),Jr&&Jr.clear(),kn.forEach(function(li){li()})}function vo(li){V(!!li,"invalid args to regl({...})"),V.type(li,"object","invalid args to regl({...})");function Wi(Mt){var ft=_({},Mt);delete ft.uniforms,delete ft.attributes,delete ft.context,delete ft.vao,"stencil"in ft&&ft.stencil.op&&(ft.stencil.opBack=ft.stencil.opFront=ft.stencil.op,delete ft.stencil.op);function st(Et){if(Et in ft){var ke=ft[Et];delete ft[Et],Object.keys(ke).forEach(function(nt){ft[Et+"."+nt]=ke[nt]})}}return st("blend"),st("depth"),st("cull"),st("stencil"),st("polygonOffset"),st("scissor"),st("sample"),"vao"in Mt&&(ft.vao=Mt.vao),ft}function oa(Mt,ft){var st={},Et={};return Object.keys(Mt).forEach(function(ke){var nt=Mt[ke];if(lt.isDynamic(nt)){Et[ke]=lt.unbox(nt,ke);return}else if(ft&&Array.isArray(nt)){for(var Oe=0;Oe<nt.length;++Oe)if(lt.isDynamic(nt[Oe])){Et[ke]=lt.unbox(nt,ke);return}}st[ke]=nt}),{dynamic:Et,static:st}}var qo=oa(li.context||{},!0),El=oa(li.uniforms||{},!0),wl=oa(li.attributes||{},!1),Ve=oa(Wi(li),!1),qt={gpuTime:0,cpuTime:0,count:0},Kt=Xn.compile(Ve,wl,El,qo,qt),Cn=Kt.draw,Xi=Kt.batch,Re=Kt.scope,xe=[];function ot(Mt){for(;xe.length<Mt;)xe.push(null);return xe}function Dt(Mt,ft){var st;if(wr&&V.raise("context lost"),typeof Mt=="function")return Re.call(this,null,Mt,0);if(typeof ft=="function")if(typeof Mt=="number")for(st=0;st<Mt;++st)Re.call(this,null,ft,st);else if(Array.isArray(Mt))for(st=0;st<Mt.length;++st)Re.call(this,Mt[st],ft,st);else return Re.call(this,Mt,ft,0);else if(typeof Mt=="number"){if(Mt>0)return Xi.call(this,ot(Mt|0),Mt|0)}else if(Array.isArray(Mt)){if(Mt.length)return Xi.call(this,Mt,Mt.length)}else return Cn.call(this,Mt)}return _(Dt,{stats:qt,destroy:function(){Kt.destroy()}})}var so=nn.setFBO=vo({framebuffer:lt.define.call(null,Kf,"framebuffer")});function Qo(li,Wi){var oa=0;Xn.procs.poll();var qo=Wi.color;qo&&(Ze.clearColor(+qo[0]||0,+qo[1]||0,+qo[2]||0,+qo[3]||0),oa|=oh),"depth"in Wi&&(Ze.clearDepth(+Wi.depth),oa|=dp),"stencil"in Wi&&(Ze.clearStencil(Wi.stencil|0),oa|=Fh),V(!!oa,"called regl.clear with no buffer specified"),Ze.clear(oa)}function ys(li){if(V(typeof li=="object"&&li,"regl.clear() takes an object as input"),"framebuffer"in li)if(li.framebuffer&&li.framebuffer_reglType==="framebufferCube")for(var Wi=0;Wi<6;++Wi)so(_({framebuffer:li.framebuffer.faces[Wi]},li),Qo);else so(li,Qo);else Qo(null,li)}function Es(li){V.type(li,"function","regl.frame() callback must be a function"),Ir.push(li);function Wi(){var oa=$c(Ir,li);V(oa>=0,"cannot cancel a frame twice");function qo(){var El=$c(Ir,qo);Ir[El]=Ir[Ir.length-1],Ir.length-=1,Ir.length<=0&&fa()}Ir[oa]=qo}return ji(),{cancel:Wi}}function ks(){var li=sn.viewport,Wi=sn.scissor_box;li[0]=li[1]=Wi[0]=Wi[1]=0,jr.viewportWidth=jr.framebufferWidth=jr.drawingBufferWidth=li[2]=Wi[2]=Ze.drawingBufferWidth,jr.viewportHeight=jr.framebufferHeight=jr.drawingBufferHeight=li[3]=Wi[3]=Ze.drawingBufferHeight}function _s(){jr.tick+=1,jr.time=Ni(),ks(),Xn.procs.poll()}function Fo(){un.refresh(),ks(),Xn.procs.refresh(),Jr&&Jr.update()}function Ni(){return(Jt()-Gr)/1e3}Fo();function Fs(li,Wi){V.type(Wi,"function","listener callback must be a function");var oa;switch(li){case"frame":return Es(Wi);case"lost":oa=si;break;case"restore":oa=ui;break;case"destroy":oa=kn;break;default:V.raise("invalid event, must be one of frame,lost,restore,destroy")}return oa.push(Wi),{cancel:function(){for(var qo=0;qo<oa.length;++qo)if(oa[qo]===Wi){oa[qo]=oa[oa.length-1],oa.pop();return}}}}var Sa=_(vo,{clear:ys,prop:lt.define.bind(null,Kf),context:lt.define.bind(null,mp),this:lt.define.bind(null,zh),draw:vo({}),buffer:function(li){return Vr.create(li,vp,!1,!1)},elements:function(li){return Sn.create(li,!1)},texture:un.create2D,cube:un.createCube,renderbuffer:kr.create,framebuffer:nn.create,framebufferCube:nn.createCube,vao:mn.createVAO,attributes:rr,frame:Es,on:Fs,limits:pr,hasExtension:function(li){return pr.extensions.indexOf(li.toLowerCase())>=0},read:Kn,destroy:$i,_gl:Ze,_refresh:Fo,poll:function(){_s(),Jr&&Jr.update()},now:Ni,stats:Ur});return Pe.onDone(null,Sa),Sa}return Zh})},69848:function(ar){(function(O,_){ar.exports=_()})(this,function(){"use strict";function O(tt,Ne,Qe,Ie,Ae,Ue){if(!(Ae-Ie<=Qe)){var St=Ie+Ae>>1;_(tt,Ne,St,Ie,Ae,Ue%2),O(tt,Ne,Qe,Ie,St-1,Ue+1),O(tt,Ne,Qe,St+1,Ae,Ue+1)}}function _(tt,Ne,Qe,Ie,Ae,Ue){for(;Ae>Ie;){if(Ae-Ie>600){var St=Ae-Ie+1,ur=Qe-Ie+1,ae=Math.log(St),Te=.5*Math.exp(2*ae/3),oe=.5*Math.sqrt(ae*Te*(St-Te)/St)*(ur-St/2<0?-1:1),me=Math.max(Ie,Math.floor(Qe-ur*Te/St+oe)),Me=Math.min(Ae,Math.floor(Qe+(St-ur)*Te/St+oe));_(tt,Ne,Qe,me,Me,Ue)}var qe=Ne[2*Qe+Ue],yt=Ie,Qt=Ae;for(Q(tt,Ne,Ie,Qe),Ne[2*Ae+Ue]>qe&&Q(tt,Ne,Ie,Ae);yt<Qt;){for(Q(tt,Ne,yt,Qt),yt++,Qt--;Ne[2*yt+Ue]<qe;)yt++;for(;Ne[2*Qt+Ue]>qe;)Qt--}Ne[2*Ie+Ue]===qe?Q(tt,Ne,Ie,Qt):(Qt++,Q(tt,Ne,Qt,Ae)),Qt<=Qe&&(Ie=Qt+1),Qe<=Qt&&(Ae=Qt-1)}}function Q(tt,Ne,Qe,Ie){E(tt,Qe,Ie),E(Ne,2*Qe,2*Ie),E(Ne,2*Qe+1,2*Ie+1)}function E(tt,Ne,Qe){var Ie=tt[Ne];tt[Ne]=tt[Qe],tt[Qe]=Ie}function p(tt,Ne,Qe,Ie,Ae,Ue,St){for(var ur=[0,tt.length-1,0],ae=[],Te,oe;ur.length;){var me=ur.pop(),Me=ur.pop(),qe=ur.pop();if(Me-qe<=St){for(var yt=qe;yt<=Me;yt++)Te=Ne[2*yt],oe=Ne[2*yt+1],Te>=Qe&&Te<=Ae&&oe>=Ie&&oe<=Ue&&ae.push(tt[yt]);continue}var Qt=Math.floor((qe+Me)/2);Te=Ne[2*Qt],oe=Ne[2*Qt+1],Te>=Qe&&Te<=Ae&&oe>=Ie&&oe<=Ue&&ae.push(tt[Qt]);var Or=(me+1)%2;(me===0?Qe<=Te:Ie<=oe)&&(ur.push(qe),ur.push(Qt-1),ur.push(Or)),(me===0?Ae>=Te:Ue>=oe)&&(ur.push(Qt+1),ur.push(Me),ur.push(Or))}return ae}function b(tt,Ne,Qe,Ie,Ae,Ue){for(var St=[0,tt.length-1,0],ur=[],ae=Ae*Ae;St.length;){var Te=St.pop(),oe=St.pop(),me=St.pop();if(oe-me<=Ue){for(var Me=me;Me<=oe;Me++)X(Ne[2*Me],Ne[2*Me+1],Qe,Ie)<=ae&&ur.push(tt[Me]);continue}var qe=Math.floor((me+oe)/2),yt=Ne[2*qe],Qt=Ne[2*qe+1];X(yt,Qt,Qe,Ie)<=ae&&ur.push(tt[qe]);var Or=(Te+1)%2;(Te===0?Qe-Ae<=yt:Ie-Ae<=Qt)&&(St.push(me),St.push(qe-1),St.push(Or)),(Te===0?Qe+Ae>=yt:Ie+Ae>=Qt)&&(St.push(qe+1),St.push(oe),St.push(Or))}return ur}function X(tt,Ne,Qe,Ie){var Ae=tt-Qe,Ue=Ne-Ie;return Ae*Ae+Ue*Ue}var W=function(tt){return tt[0]},$=function(tt){return tt[1]},I=function(Ne,Qe,Ie,Ae,Ue){Qe===void 0&&(Qe=W),Ie===void 0&&(Ie=$),Ae===void 0&&(Ae=64),Ue===void 0&&(Ue=Float64Array),this.nodeSize=Ae,this.points=Ne;for(var St=Ne.length<65536?Uint16Array:Uint32Array,ur=this.ids=new St(Ne.length),ae=this.coords=new Ue(Ne.length*2),Te=0;Te<Ne.length;Te++)ur[Te]=Te,ae[2*Te]=Qe(Ne[Te]),ae[2*Te+1]=Ie(Ne[Te]);O(ur,ae,Ae,0,ur.length-1,0)};I.prototype.range=function(Ne,Qe,Ie,Ae){return p(this.ids,this.coords,Ne,Qe,Ie,Ae,this.nodeSize)},I.prototype.within=function(Ne,Qe,Ie){return b(this.ids,this.coords,Ne,Qe,Ie,this.nodeSize)};var k={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(tt){return tt}},Ce=Math.fround||function(tt){return function(Ne){return tt[0]=+Ne,tt[0]}}(new Float32Array(1)),Be=function(Ne){this.options=Pr(Object.create(k),Ne),this.trees=new Array(this.options.maxZoom+1)};Be.prototype.load=function(Ne){var Qe=this.options,Ie=Qe.log,Ae=Qe.minZoom,Ue=Qe.maxZoom,St=Qe.nodeSize;Ie&&console.time("total time");var ur="prepare "+Ne.length+" points";Ie&&console.time(ur),this.points=Ne;for(var ae=[],Te=0;Te<Ne.length;Te++)!Ne[Te].geometry||ae.push($e(Ne[Te],Te));this.trees[Ue+1]=new I(ae,er,Ft,St,Float32Array),Ie&&console.timeEnd(ur);for(var oe=Ue;oe>=Ae;oe--){var me=+Date.now();ae=this._cluster(ae,oe),this.trees[oe]=new I(ae,er,Ft,St,Float32Array),Ie&&console.log("z%d: %d clusters in %dms",oe,ae.length,+Date.now()-me)}return Ie&&console.timeEnd("total time"),this},Be.prototype.getClusters=function(Ne,Qe){var Ie=((Ne[0]+180)%360+360)%360-180,Ae=Math.max(-90,Math.min(90,Ne[1])),Ue=Ne[2]===180?180:((Ne[2]+180)%360+360)%360-180,St=Math.max(-90,Math.min(90,Ne[3]));if(Ne[2]-Ne[0]>=360)Ie=-180,Ue=180;else if(Ie>Ue){var ur=this.getClusters([Ie,Ae,180,St],Qe),ae=this.getClusters([-180,Ae,Ue,St],Qe);return ur.concat(ae)}for(var Te=this.trees[this._limitZoom(Qe)],oe=Te.range(At(Ie),Ot(St),At(Ue),Ot(Ae)),me=[],Me=0,qe=oe;Me<qe.length;Me+=1){var yt=qe[Me],Qt=Te.points[yt];me.push(Qt.numPoints?Vt(Qt):this.points[Qt.index])}return me},Be.prototype.getChildren=function(Ne){var Qe=this._getOriginId(Ne),Ie=this._getOriginZoom(Ne),Ae="No cluster with the specified id.",Ue=this.trees[Ie];if(!Ue)throw new Error(Ae);var St=Ue.points[Qe];if(!St)throw new Error(Ae);for(var ur=this.options.radius/(this.options.extent*Math.pow(2,Ie-1)),ae=Ue.within(St.x,St.y,ur),Te=[],oe=0,me=ae;oe<me.length;oe+=1){var Me=me[oe],qe=Ue.points[Me];qe.parentId===Ne&&Te.push(qe.numPoints?Vt(qe):this.points[qe.index])}if(Te.length===0)throw new Error(Ae);return Te},Be.prototype.getLeaves=function(Ne,Qe,Ie){Qe=Qe||10,Ie=Ie||0;var Ae=[];return this._appendLeaves(Ae,Ne,Qe,Ie,0),Ae},Be.prototype.getTile=function(Ne,Qe,Ie){var Ae=this.trees[this._limitZoom(Ne)],Ue=Math.pow(2,Ne),St=this.options,ur=St.extent,ae=St.radius,Te=ae/ur,oe=(Ie-Te)/Ue,me=(Ie+1+Te)/Ue,Me={features:[]};return this._addTileFeatures(Ae.range((Qe-Te)/Ue,oe,(Qe+1+Te)/Ue,me),Ae.points,Qe,Ie,Ue,Me),Qe===0&&this._addTileFeatures(Ae.range(1-Te/Ue,oe,1,me),Ae.points,Ue,Ie,Ue,Me),Qe===Ue-1&&this._addTileFeatures(Ae.range(0,oe,Te/Ue,me),Ae.points,-1,Ie,Ue,Me),Me.features.length?Me:null},Be.prototype.getClusterExpansionZoom=function(Ne){for(var Qe=this._getOriginZoom(Ne)-1;Qe<=this.options.maxZoom;){var Ie=this.getChildren(Ne);if(Qe++,Ie.length!==1)break;Ne=Ie[0].properties.cluster_id}return Qe},Be.prototype._appendLeaves=function(Ne,Qe,Ie,Ae,Ue){for(var St=this.getChildren(Qe),ur=0,ae=St;ur<ae.length;ur+=1){var Te=ae[ur],oe=Te.properties;if(oe&&oe.cluster?Ue+oe.point_count<=Ae?Ue+=oe.point_count:Ue=this._appendLeaves(Ne,oe.cluster_id,Ie,Ae,Ue):Ue<Ae?Ue++:Ne.push(Te),Ne.length===Ie)break}return Ue},Be.prototype._addTileFeatures=function(Ne,Qe,Ie,Ae,Ue,St){for(var ur=0,ae=Ne;ur<ae.length;ur+=1){var Te=ae[ur],oe=Qe[Te],me=oe.numPoints,Me=void 0,qe=void 0,yt=void 0;if(me)Me=Ht(oe),qe=oe.x,yt=oe.y;else{var Qt=this.points[oe.index];Me=Qt.properties,qe=At(Qt.geometry.coordinates[0]),yt=Ot(Qt.geometry.coordinates[1])}var Or={type:1,geometry:[[Math.round(this.options.extent*(qe*Ue-Ie)),Math.round(this.options.extent*(yt*Ue-Ae))]],tags:Me},Dr=void 0;me?Dr=oe.id:this.options.generateId?Dr=oe.index:this.points[oe.index].id&&(Dr=this.points[oe.index].id),Dr!==void 0&&(Or.id=Dr),St.features.push(Or)}},Be.prototype._limitZoom=function(Ne){return Math.max(this.options.minZoom,Math.min(+Ne,this.options.maxZoom+1))},Be.prototype._cluster=function(Ne,Qe){for(var Ie=[],Ae=this.options,Ue=Ae.radius,St=Ae.extent,ur=Ae.reduce,ae=Ae.minPoints,Te=Ue/(St*Math.pow(2,Qe)),oe=0;oe<Ne.length;oe++){var me=Ne[oe];if(!(me.zoom<=Qe)){me.zoom=Qe;for(var Me=this.trees[Qe+1],qe=Me.within(me.x,me.y,Te),yt=me.numPoints||1,Qt=yt,Or=0,Dr=qe;Or<Dr.length;Or+=1){var on=Dr[Or],tr=Me.points[on];tr.zoom>Qe&&(Qt+=tr.numPoints||1)}if(Qt>=ae){for(var se=me.x*yt,be=me.y*yt,Fe=ur&&yt>1?this._map(me,!0):null,Ee=(oe<<5)+(Qe+1)+this.points.length,wt=0,Bt=qe;wt<Bt.length;wt+=1){var w=Bt[wt],N=Me.points[w];if(!(N.zoom<=Qe)){N.zoom=Qe;var he=N.numPoints||1;se+=N.x*he,be+=N.y*he,N.parentId=Ee,ur&&(Fe||(Fe=this._map(me,!0)),ur(Fe,this._map(N)))}}me.parentId=Ee,Ie.push(We(se/Qt,be/Qt,Ee,Qt,Fe))}else if(Ie.push(me),Qt>1)for(var je=0,et=qe;je<et.length;je+=1){var _t=et[je],Ct=Me.points[_t];Ct.zoom<=Qe||(Ct.zoom=Qe,Ie.push(Ct))}}}return Ie},Be.prototype._getOriginId=function(Ne){return Ne-this.points.length>>5},Be.prototype._getOriginZoom=function(Ne){return(Ne-this.points.length)%32},Be.prototype._map=function(Ne,Qe){if(Ne.numPoints)return Qe?Pr({},Ne.properties):Ne.properties;var Ie=this.points[Ne.index].properties,Ae=this.options.map(Ie);return Qe&&Ae===Ie?Pr({},Ae):Ae};function We(tt,Ne,Qe,Ie,Ae){return{x:Ce(tt),y:Ce(Ne),zoom:Infinity,id:Qe,parentId:-1,numPoints:Ie,properties:Ae}}function $e(tt,Ne){var Qe=tt.geometry.coordinates,Ie=Qe[0],Ae=Qe[1];return{x:Ce(At(Ie)),y:Ce(Ot(Ae)),zoom:Infinity,index:Ne,parentId:-1}}function Vt(tt){return{type:"Feature",id:tt.id,properties:Ht(tt),geometry:{type:"Point",coordinates:[bt(tt.x),dt(tt.y)]}}}function Ht(tt){var Ne=tt.numPoints,Qe=Ne>=1e4?Math.round(Ne/1e3)+"k":Ne>=1e3?Math.round(Ne/100)/10+"k":Ne;return Pr(Pr({},tt.properties),{cluster:!0,cluster_id:tt.id,point_count:Ne,point_count_abbreviated:Qe})}function At(tt){return tt/360+.5}function Ot(tt){var Ne=Math.sin(tt*Math.PI/180),Qe=.5-.25*Math.log((1+Ne)/(1-Ne))/Math.PI;return Qe<0?0:Qe>1?1:Qe}function bt(tt){return(tt-.5)*360}function dt(tt){var Ne=(180-tt*360)*Math.PI/180;return 360*Math.atan(Math.exp(Ne))/Math.PI-90}function Pr(tt,Ne){for(var Qe in Ne)tt[Qe]=Ne[Qe];return tt}function er(tt){return tt.x}function Ft(tt){return tt.y}return Be})},75752:function(ar){ar.exports.RADIUS=6378137,ar.exports.FLATTENING=1/298.257223563,ar.exports.POLAR_RADIUS=63567523142e-4}}]);
