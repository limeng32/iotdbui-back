(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[8389],{64335:function(Tr,ie,ee){"use strict";var Oe=ee(67294),_e=(0,Oe.createContext)({});ie.Z=_e},21349:function(Tr,ie,ee){"use strict";var Oe=ee(84305),_e=ee(88182),g=ee(94184),Re=ee.n(g),X=ee(67294),pe=ee(64335),de=ee(53645),Ne=ee.n(de),xe=function(dt){var At=(0,X.useContext)(pe.Z),tr=dt.children,pr=dt.contentWidth,Lt=dt.className,nr=dt.style,jt=(0,X.useContext)(_e.ZP.ConfigContext),ht=jt.getPrefixCls,gt=dt.prefixCls||ht("pro"),sr=pr||At.contentWidth,q="".concat(gt,"-grid-content");return X.createElement("div",{className:Re()(q,Lt,{wide:sr==="Fixed"}),style:nr},X.createElement("div",{className:"".concat(gt,"-grid-content-children")},tr))};ie.Z=xe},75553:function(Tr,ie,ee){"use strict";ee.d(ie,{zP:function(){return Q3},JE:function(){return l3},ns:function(){return $3}});var Oe={};ee.r(Oe),ee.d(Oe,{add:function(){return zi},adjoint:function(){return Yr},clone:function(){return lr},copy:function(){return Rr},create:function(){return Pr},determinant:function(){return xr},equals:function(){return Tt},exactEquals:function(){return ot},frob:function(){return vn},fromQuat:function(){return xi},fromQuat2:function(){return qo},fromRotation:function(){return io},fromRotationTranslation:function(){return Ga},fromRotationTranslationScale:function(){return ds},fromRotationTranslationScaleOrigin:function(){return fo},fromScaling:function(){return Ni},fromTranslation:function(){return ui},fromValues:function(){return $r},fromXRotation:function(){return co},fromYRotation:function(){return ki},fromZRotation:function(){return as},frustum:function(){return Vo},getRotation:function(){return jo},getScaling:function(){return Zo},getTranslation:function(){return So},identity:function(){return $t},invert:function(){return dn},lookAt:function(){return Ae},mul:function(){return Ye},multiply:function(){return Fr},multiplyScalar:function(){return ne},multiplyScalarAndAdd:function(){return Ze},ortho:function(){return Co},orthoNO:function(){return la},orthoZO:function(){return wl},perspective:function(){return Ko},perspectiveFromFieldOfView:function(){return Di},perspectiveNO:function(){return Ki},perspectiveZO:function(){return ei},rotate:function(){return ni},rotateX:function(){return Vr},rotateY:function(){return Jr},rotateZ:function(){return Yn},scale:function(){return si},set:function(){return Bn},str:function(){return xt},sub:function(){return De},subtract:function(){return be},targetTo:function(){return Dt},translate:function(){return Hr},transpose:function(){return er}});var _e=ee(67294),g=(0,_e.createContext)({});function Re(){return(0,_e.useContext)(g)}var X={},pe={},de=function(i){return pe[i]},Ne=function(i,r){pe[i]=r},xe=function(i){return X[i]},tt=function(i,r){X[i]=r},dt={},At={},tr=34,pr=10,Lt=13;function nr(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function jt(e,i){var r=nr(e);return function(n,a){return i(r(n),a,e)}}function ht(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var a in n)a in i||r.push(i[a]=a)}),r}function gt(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function sr(e){return e<0?"-"+gt(-e,6):e>9999?"+"+gt(e,6):gt(e,4)}function q(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),a=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":sr(e.getUTCFullYear(),4)+"-"+gt(e.getUTCMonth()+1,2)+"-"+gt(e.getUTCDate(),2)+(a?"T"+gt(i,2)+":"+gt(r,2)+":"+gt(n,2)+"."+gt(a,3)+"Z":n?"T"+gt(i,2)+":"+gt(r,2)+":"+gt(n,2)+"Z":r||i?"T"+gt(i,2)+":"+gt(r,2)+"Z":"")}function Yt(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(T,O){var D,Z,W=a(T,function(Q,ye){if(D)return D(Q,ye-1);Z=Q,D=O?jt(Q,O):nr(Q)});return W.columns=Z||[],W}function a(T,O){var D=[],Z=T.length,W=0,Q=0,ye,Be=Z<=0,qe=!1;T.charCodeAt(Z-1)===pr&&--Z,T.charCodeAt(Z-1)===Lt&&--Z;function rt(){if(Be)return At;if(qe)return qe=!1,dt;var mt,Ht=W,rr;if(T.charCodeAt(Ht)===tr){for(;W++<Z&&T.charCodeAt(W)!==tr||T.charCodeAt(++W)===tr;);return(mt=W)>=Z?Be=!0:(rr=T.charCodeAt(W++))===pr?qe=!0:rr===Lt&&(qe=!0,T.charCodeAt(W)===pr&&++W),T.slice(Ht+1,mt-1).replace(/""/g,'"')}for(;W<Z;){if((rr=T.charCodeAt(mt=W++))===pr)qe=!0;else if(rr===Lt)qe=!0,T.charCodeAt(W)===pr&&++W;else if(rr!==r)continue;return T.slice(Ht,mt)}return Be=!0,T.slice(Ht,Z)}for(;(ye=rt())!==At;){for(var _t=[];ye!==dt&&ye!==At;)_t.push(ye),ye=rt();O&&(_t=O(_t,Q++))==null||D.push(_t)}return D}function s(T,O){return T.map(function(D){return O.map(function(Z){return C(D[Z])}).join(e)})}function f(T,O){return O==null&&(O=ht(T)),[O.map(C).join(e)].concat(s(T,O)).join(`
`)}function v(T,O){return O==null&&(O=ht(T)),s(T,O).join(`
`)}function m(T){return T.map(x).join(`
`)}function x(T){return T.map(C).join(e)}function C(T){return T==null?"":T instanceof Date?q(T):i.test(T+="")?'"'+T.replace(/"/g,'""')+'"':T}return{parse:n,parseRows:a,format:f,formatBody:v,formatRows:m,formatRow:x,formatValue:C}}var ct=Yt(","),Ke=ct.parse,wt=ct.parseRows,et=ct.format,qt=ct.formatBody,Ar=ct.formatRows,Wr=ct.formatRow,on=ct.formatValue,A=ee(96156),Se=ee(85061),ke=ee(38163),St=ee.n(ke);function vt(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ft(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?vt(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vt(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Wt(e,i){var r=i.x,n=i.y,a=i.x1,s=i.y1,f=i.coordinates,v=[];return Array.isArray(e)?(e.forEach(function(m,x){var C=[];if(r&&n&&(C=[parseFloat(m[r]),parseFloat(m[n])]),r&&n&&a&&s){var T=[parseFloat(m[r]),parseFloat(m[n])],O=[parseFloat(m[a]),parseFloat(m[s])];C=[T,O]}if(f){var D="Polygon";Array.isArray(f[0])||(D="Point"),Array.isArray(f[0])&&!Array.isArray(f[0][0])&&(D="LineString");var Z={type:D,coordinates:(0,Se.Z)(m[f])};St()(Z,!0),C=Z.coordinates}var W=Ft(Ft({},m),{},{_id:x,coordinates:C});v.push(W)}),{dataArray:v}):{dataArray:[]}}var Er=[{lng1:100,lat1:30,lng2:130,lat2:30}],$n={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function _n(e,i){var r=Ke(e);return Wt(r,i)}var mi=63710088e-1,Gn={centimeters:mi*100,centimetres:mi*100,degrees:mi/111325,feet:mi*3.28084,inches:mi*39.37,kilometers:mi/1e3,kilometres:mi/1e3,meters:mi,metres:mi,miles:mi/1609.344,millimeters:mi*1e3,millimetres:mi*1e3,nauticalmiles:mi/1852,radians:1,yards:mi*1.0936},ai={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/mi,yards:1.0936133},gi={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Xn(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function yi(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return va(i).geometry;case"LineString":return ma(i).geometry;case"Polygon":return Ri(i).geometry;case"MultiPoint":return Ui(i).geometry;case"MultiLineString":return xa(i).geometry;case"MultiPolygon":return aa(i).geometry;default:throw new Error(e+" is invalid")}}function va(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!wn(e[0])||!wn(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return Xn(n,i,r)}function Xi(e,i,r){return r===void 0&&(r={}),Oa(e.map(function(n){return va(n,i)}),r)}function Ri(e,i,r){r===void 0&&(r={});for(var n=0,a=e;n<a.length;n++){var s=a[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var f=0;f<s[s.length-1].length;f++)if(s[s.length-1][f]!==s[0][f])throw new Error("First and last Position are not equivalent.")}var v={type:"Polygon",coordinates:e};return Xn(v,i,r)}function Ji(e,i,r){return r===void 0&&(r={}),Oa(e.map(function(n){return Ri(n,i)}),r)}function ma(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return Xn(n,i,r)}function Do(e,i,r){return r===void 0&&(r={}),Oa(e.map(function(n){return ma(n,i)}),r)}function Oa(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function xa(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return Xn(n,i,r)}function Ui(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return Xn(n,i,r)}function aa(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return Xn(n,i,r)}function ea(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return Xn(n,i,r)}function Os(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function fe(e,i){i===void 0&&(i="kilometers");var r=Gn[i];if(!r)throw new Error(i+" units is invalid");return e*r}function oi(e,i){i===void 0&&(i="kilometers");var r=Gn[i];if(!r)throw new Error(i+" units is invalid");return e/r}function xo(e,i){return Nt(oi(e,i))}function au(e){var i=e%360;return i<0&&(i+=360),i}function Nt(e){var i=e%(2*Math.PI);return i*180/Math.PI}function Jt(e){var i=e%360;return i*Math.PI/180}function Dr(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return fe(oi(e,i),r)}function cn(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=gi[i];if(!n)throw new Error("invalid original units");var a=gi[r];if(!a)throw new Error("invalid final units");return e/n*a}function wn(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Nn(e){return!!e&&e.constructor===Object}function Ei(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!wn(i))throw new Error("bbox must only contain numbers")})}function di(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function Sn(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Pi(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Mi(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Mi(e[0]);throw new Error("coordinates must only contain numbers")}function to(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function gs(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function Ho(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,a=e.features;n<a.length;n++){var s=a[n];if(!s||s.type!=="Feature"||!s.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!s.geometry||s.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+s.geometry.type)}}function Na(e){return e.type==="Feature"?e.geometry:e}function ba(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function V(e,i,r){if(e!==null)for(var n,a,s,f,v,m,x,C=0,T=0,O,D=e.type,Z=D==="FeatureCollection",W=D==="Feature",Q=Z?e.features.length:1,ye=0;ye<Q;ye++){x=Z?e.features[ye].geometry:W?e.geometry:e,O=x?x.type==="GeometryCollection":!1,v=O?x.geometries.length:1;for(var Be=0;Be<v;Be++){var qe=0,rt=0;if(f=O?x.geometries[Be]:x,f!==null){m=f.coordinates;var _t=f.type;switch(C=r&&(_t==="Polygon"||_t==="MultiPolygon")?1:0,_t){case null:break;case"Point":if(i(m,T,ye,qe,rt)===!1)return!1;T++,qe++;break;case"LineString":case"MultiPoint":for(n=0;n<m.length;n++){if(i(m[n],T,ye,qe,rt)===!1)return!1;T++,_t==="MultiPoint"&&qe++}_t==="LineString"&&qe++;break;case"Polygon":case"MultiLineString":for(n=0;n<m.length;n++){for(a=0;a<m[n].length-C;a++){if(i(m[n][a],T,ye,qe,rt)===!1)return!1;T++}_t==="MultiLineString"&&qe++,_t==="Polygon"&&rt++}_t==="Polygon"&&qe++;break;case"MultiPolygon":for(n=0;n<m.length;n++){for(rt=0,a=0;a<m[n].length;a++){for(s=0;s<m[n][a].length-C;s++){if(i(m[n][a][s],T,ye,qe,rt)===!1)return!1;T++}rt++}qe++}break;case"GeometryCollection":for(n=0;n<f.geometries.length;n++)if(V(f.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function K(e,i,r,n){var a=r;return V(e,function(s,f,v,m,x){f===0&&r===void 0?a=s:a=i(a,s,f,v,m,x)},n),a}function te(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function he(e,i,r){var n=r;return te(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function Me(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function je(e,i,r){var n=r;return Me(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function Qe(e){var i=[];return V(e,function(r){i.push(r)}),i}function se(e,i){var r,n,a,s,f,v,m,x,C,T,O=0,D=e.type==="FeatureCollection",Z=e.type==="Feature",W=D?e.features.length:1;for(r=0;r<W;r++){for(v=D?e.features[r].geometry:Z?e.geometry:e,x=D?e.features[r].properties:Z?e.properties:{},C=D?e.features[r].bbox:Z?e.bbox:void 0,T=D?e.features[r].id:Z?e.id:void 0,m=v?v.type==="GeometryCollection":!1,f=m?v.geometries.length:1,a=0;a<f;a++){if(s=m?v.geometries[a]:v,s===null){if(i(null,O,x,C,T)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(s,O,x,C,T)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)if(i(s.geometries[n],O,x,C,T)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}O++}}function Le(e,i,r){var n=r;return se(e,function(a,s,f,v,m){s===0&&r===void 0?n=a:n=i(n,a,s,f,v,m)}),n}function ft(e,i){se(e,function(r,n,a,s,f){var v=r===null?null:r.type;switch(v){case null:case"Point":case"LineString":case"Polygon":return i(Xn(r,a,{bbox:s,id:f}),n,0)===!1?!1:void 0}var m;switch(v){case"MultiPoint":m="Point";break;case"MultiLineString":m="LineString";break;case"MultiPolygon":m="Polygon";break}for(var x=0;x<r.coordinates.length;x++){var C=r.coordinates[x],T={type:m,coordinates:C};if(i(Xn(T,a),n,x)===!1)return!1}})}function hr(e,i,r){var n=r;return ft(e,function(a,s,f){s===0&&f===0&&r===void 0?n=a:n=i(n,a,s,f)}),n}function Ot(e,i){ft(e,function(r,n,a){var s=0;if(!!r.geometry){var f=r.geometry.type;if(!(f==="Point"||f==="MultiPoint")){var v,m=0,x=0,C=0;if(V(r,function(T,O,D,Z,W){if(v===void 0||n>m||Z>x||W>C){v=T,m=n,x=Z,C=W,s=0;return}var Q=lineString([v,T],r.properties);if(i(Q,n,a,W,s)===!1)return!1;s++,v=T})===!1)return!1}}})}function kt(e,i,r){var n=r,a=!1;return Ot(e,function(s,f,v,m,x){a===!1&&r===void 0?n=s:n=i(n,s,f,v,m,x),a=!0}),n}function dr(e,i){if(!e)throw new Error("geojson is required");ft(e,function(r,n,a){if(r.geometry!==null){var s=r.geometry.type,f=r.geometry.coordinates;switch(s){case"LineString":if(i(r,n,a,0,0)===!1)return!1;break;case"Polygon":for(var v=0;v<f.length;v++)if(i(lineString(f[v],r.properties),n,a,v)===!1)return!1;break}}})}function En(e,i,r){var n=r;return dr(e,function(a,s,f,v){s===0&&r===void 0?n=a:n=i(n,a,s,f,v)}),n}function fn(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.segmentIndex||0,f=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),f=f||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":f=f||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var m=v.coordinates;switch(v.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=m.length+s-1),lineString([m[s],m[s+1]],f,i);case"Polygon":return a<0&&(a=m.length+a),s<0&&(s=m[a].length+s-1),lineString([m[a][s],m[a][s+1]],f,i);case"MultiLineString":return n<0&&(n=m.length+n),s<0&&(s=m[n].length+s-1),lineString([m[n][s],m[n][s+1]],f,i);case"MultiPolygon":return n<0&&(n=m.length+n),a<0&&(a=m[n].length+a),s<0&&(s=m[n][a].length-s-1),lineString([m[n][a][s],m[n][a][s+1]],f,i)}throw new Error("geojson is invalid")}function Mt(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.coordIndex||0,f=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),f=f||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":f=f||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var m=v.coordinates;switch(v.type){case"Point":return point(m,f,i);case"MultiPoint":return n<0&&(n=m.length+n),point(m[n],f,i);case"LineString":return s<0&&(s=m.length+s),point(m[s],f,i);case"Polygon":return a<0&&(a=m.length+a),s<0&&(s=m[a].length+s),point(m[a][s],f,i);case"MultiLineString":return n<0&&(n=m.length+n),s<0&&(s=m[n].length+s),point(m[n][s],f,i);case"MultiPolygon":return n<0&&(n=m.length+n),a<0&&(a=m[n].length+a),s<0&&(s=m[n][a].length-s),point(m[n][a][s],f,i)}throw new Error("geojson is invalid")}function tn(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ur(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?tn(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tn(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Xr(e,i){var r=[],n={};if(!e.features)return e.features=[],{dataArray:[]};if(e.features=e.features.filter(function(s){var f=s.geometry;return s!=null&&f&&f.type&&f.coordinates&&f.coordinates.length>0}),St()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:n};var a=0;return ft(e,function(s,f){var v=Pi(s),m=f,x=Ur(Ur({},s.properties),{},{coordinates:v,_id:m});r.push(x)}),{dataArray:r,featureKeys:n}}function vi(e){var i=131,r=137,n=0;e+="x";for(var a=Math.floor(9007199254740991/r),s=0;s<e.length;s++)n>a&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(s);return n}function rn(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}var nn=ee(28481),ji="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function fi(e){this.message=e}fi.prototype=new Error,fi.prototype.name="InvalidCharacterError";function Ai(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new fi("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,a,s,f=0;s=i.charAt(f++);~s&&(a=n%4?a*64+s:s,n++%4)?r+=String.fromCharCode(255&a>>(-2*n&6)):0)s=ji.indexOf(s);return r}function _i(e){e=String(e);for(var i,r,n,a,s="",f=0,v=e.length%3;f<e.length;){if((r=e.charCodeAt(f++))>255||(n=e.charCodeAt(f++))>255||(a=e.charCodeAt(f++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=r<<16|n<<8|a,s+=ji.charAt(i>>18&63)+ji.charAt(i>>12&63)+ji.charAt(i>>6&63)+ji.charAt(i&63)}return v?s.slice(0,v-3)+"===".substring(v):s}var st=ee(6610),Ct=ee(5991),Ca=function(){function e(i,r){(0,st.Z)(this,e),this.buffers=i,this.type=r}return(0,Ct.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,a){throw new Error("not implemented")}}]),e}(),Ci;typeof window=="undefined"?Ci={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Ci=window;var wi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Bi=wi?my.getSystemInfoSync().pixelRatio:Ci.devicePixelRatio,wr=ee(10379),an=ee(46070),pt=ee(77608),ta=(0,Ct.Z)(function e(i,r){(0,st.Z)(this,e),(0,A.Z)(this,"cancelBubble",void 0),(0,A.Z)(this,"cancelable",void 0),(0,A.Z)(this,"target",void 0),(0,A.Z)(this,"currentTarget",void 0),(0,A.Z)(this,"preventDefault",void 0),(0,A.Z)(this,"stopPropagation",void 0),(0,A.Z)(this,"type",void 0),(0,A.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()}),ae=ee(63349);function es(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=$i(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function $i(e,i){if(!!e){if(typeof e=="string")return Eu(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Eu(e,i)}}function Eu(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var za=new WeakMap,Aa=function(){function e(){(0,st.Z)(this,e),za.set(this,{})}return(0,Ct.Z)(e,[{key:"addEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=za.get(this);s||(s={}),s[r]||(s[r]=[]),s[r].push(n),za.set(this,s),a.capture,a.once,a.passive}},{key:"removeEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=za.get(this);if(s){var f=s[r];if(f&&f.length>0){for(var v=f.length;v--;v>0)if(f[v]===n){f.splice(v,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=za.get(this)[r.type];if(n){var a=es(n),s;try{for(a.s();!(s=a.n()).done;){var f=s.value;f(r)}}catch(v){a.e(v)}finally{a.f()}}}}]),e}();function Ya(e){var i=ra();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function ra(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Po=function(e){(0,wr.Z)(r,e);var i=Ya(r);function r(){var n;return(0,st.Z)(this,r),n=i.call(this),(0,A.Z)((0,ae.Z)(n),"childNodes",void 0),n.childNodes=[],n}return(0,Ct.Z)(r,[{key:"appendChild",value:function(a){this.childNodes.push(a)}},{key:"cloneNode",value:function(){var a=Object.create(this);return Object.assign(a,this),a}},{key:"removeChild",value:function(a){var s=this.childNodes.findIndex(function(f){return f===a});return s>-1?this.childNodes.splice(s,1):null}}]),r}(Aa);function Wo(e){var i=Bu();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Bu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ho=function(e){(0,wr.Z)(r,e);var i=Wo(r);function r(){var n;return(0,st.Z)(this,r),n=i.call(this),(0,A.Z)((0,ae.Z)(n),"className",void 0),(0,A.Z)((0,ae.Z)(n),"children",void 0),n.className="",n.children=[],n}return(0,Ct.Z)(r,[{key:"setAttribute",value:function(a,s){this[a]=s}},{key:"getAttribute",value:function(a){return this[a]}},{key:"setAttributeNS",value:function(a,s){this[a]=s}},{key:"getAttributeNS",value:function(a){return this[a]}}]),r}(Po),Fo=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,na,qa,Bo,Ka;if(Fo){var Rs=my.getSystemInfoSync();na=Rs.screenWidth,qa=Rs.screenHeight,Bo=Rs.windowWidth,Ka=Rs.windowHeight}else{var Il=Ci.innerWidth,ys=Ci.innerHeight;na=Il,qa=ys,Bo=Il,Ka=ys}var J={width:na,height:qa,availWidth:Bo,availHeight:Ka,availLeft:0,availTop:0},ge=J.availWidth,Xe=J.availHeight,Pt={style:[]};function Or(e,i){if(!("parentNode"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return Pt}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return Pt}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function Pn(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:ge+"px",height:Xe+"px",margin:"0px",padding:"0px"})}function Ti(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=ge,e.clientHeight=Xe),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function ro(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=ge,e.offsetHeight=Xe)}function Ra(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=ge,e.scrollHeight=Xe)}function Ua(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function Xo(e){var i=_s();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function _s(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function oo(){}var Io=function(e){(0,wr.Z)(r,e);var i=Xo(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=arguments.length>1?arguments[1]:void 0;return(0,st.Z)(this,r),n=i.call(this),(0,A.Z)((0,ae.Z)(n),"className",void 0),(0,A.Z)((0,ae.Z)(n),"children",void 0),(0,A.Z)((0,ae.Z)(n),"focus",void 0),(0,A.Z)((0,ae.Z)(n),"blur",void 0),(0,A.Z)((0,ae.Z)(n),"insertBefore",void 0),(0,A.Z)((0,ae.Z)(n),"appendChild",void 0),(0,A.Z)((0,ae.Z)(n),"removeChild",void 0),(0,A.Z)((0,ae.Z)(n),"remove",void 0),(0,A.Z)((0,ae.Z)(n),"innerHTML",void 0),(0,A.Z)((0,ae.Z)(n),"tagName",void 0),n.className="",n.children=[],n.focus=oo,n.blur=oo,n.insertBefore=oo,n.appendChild=oo,n.removeChild=oo,n.remove=oo,n.innerHTML="",n.tagName=a.toUpperCase(),Or((0,ae.Z)(n),s),Pn((0,ae.Z)(n)),Ua((0,ae.Z)(n)),Ti((0,ae.Z)(n)),ro((0,ae.Z)(n)),Ra((0,ae.Z)(n)),n}return(0,Ct.Z)(r)}(ho);function xs(e){var i=Ls();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Ls(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zs=function(e){(0,wr.Z)(r,e);var i=xs(r);function r(n){return(0,st.Z)(this,r),i.call(this,n)}return(0,Ct.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(Io);function ou(e){var i=bs();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function bs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ga=function(e){(0,wr.Z)(r,e);var i=ou(r);function r(){return(0,st.Z)(this,r),i.call(this,"video")}return(0,Ct.Z)(r)}(zs),ya={},us={};function tf(e,i){ya=e,ya.id=i,"tagName"in ya||(ya.tagName="CANVAS"),ya.type="canvas",Mixin.parentNode(ya),Mixin.style(ya),Mixin.classList(ya),Mixin.clientRegion(ya),Mixin.offsetRegion(ya),ya.focus=function(){},ya.blur=function(){}}function Ol(e,i){var r=1024,n=1024;us={width:r,height:n,clientWidth:r/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in us||(us.tagName="CANVAS"),Mixin.parentNode(us),Mixin.style(us),Mixin.classList(us),Mixin.clientRegion(us),Mixin.offsetRegion(us),us.getContext=function(a){if(a==="2d")return e},us.focus=function(){},us.blur=function(){}}function qs(){return ya}function ic(){return us}var Qu=(0,Ct.Z)(function e(){(0,st.Z)(this,e);var i=qs(),r=i.createImage&&i.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),Or(r),Ua(r),Object.assign(r,{addEventListener:function(a,s){r["on".concat(a)]=s.bind(r)},removeEventListener:function(a){r["on".concat(a)]=null}}),r}),Ks={href:"",protocol:"",host:""};function dl(e){var i=_();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function _(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var M=function(e){(0,wr.Z)(r,e);var i=dl(r);function r(){return(0,st.Z)(this,r),i.call(this,"body",0)}return(0,Ct.Z)(r,[{key:"addEventListener",value:function(a,s){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s,f){}},{key:"dispatchEvent",value:function(a){}}]),r}(Io),F=function(e){(0,wr.Z)(r,e);var i=dl(r);function r(){return(0,st.Z)(this,r),i.call(this,"html",0)}return(0,Ct.Z)(r,[{key:"addEventListener",value:function(a,s){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s){}},{key:"dispatchEvent",value:function(a){}}]),r}(Io),R={},Y={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Ks,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new Qu:i==="video"?new ga:new Io(i)},createElementNS:function(i,r){return this.createElement(r)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,r){return this.getElementsByTagName(r)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,r,n){R[i]||(R[i]=[]),R[i].push(r)},removeEventListener:function(i,r){var n=R[i];if(n&&n.length>0){for(var a=n.length;a--;a>0)if(n[a]===r){n.splice(a,1);break}}},dispatchEvent:function(i){var r=i.type,n=R[r];if(n)for(var a=0;a<n.length;a++)n[a](i);i.target&&typeof i.target["on"+r]=="function"&&i.target["on"+r](i)},createEvent:function(i){return new ta(i)}};Y.documentElement=new F,Y.head=new Io("head"),Y.body=new M;var me=Object,He=ee(90484),ut=function(){function e(){(0,st.Z)(this,e),(0,A.Z)(this,"_w",void 0),(0,A.Z)(this,"_h",void 0),(0,A.Z)(this,"_data",void 0);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,He.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,Ct.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),lt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ir,ur,Tn;if(lt){var ri=my.getSystemInfoSync();ir=ri.system,ur=ri.platform,Tn=ri.language}else{var Ln={versions:function(){var e=Ci.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(Ci.navigator.browserLanguage||Ci.navigator.language).toLowerCase()};Ln.versions.android?ur="android":Ln.versions.trident?ur="IE":Ln.versions.presto?ur="Opera":Ln.versions.webKit?ur="webKit":Ln.versions.gecko?ur="Firefox":Ln.versions.mobile?ur="mobile":Ln.versions.ios?ur="ios":Ln.versions.iPhone?ur="iPhone":Ln.versions.iPad?ur="ipad":Ln.versions.webApp?ur="webApp":Ln.versions.weixin?ur="weixin":Ln.versions.qq&&(ur="qq"),ir=Ci.navigator.userAgent,Tn=Ln.language}var Vi=ir.toLowerCase().indexOf("android")!==-1,pa=Vi?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Ea="Mozilla/5.0 (".concat(pa,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Tn),Zi={platform:ur,language:Tn,appVersion:"5.0 (".concat(pa,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Ea},Es={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){}},su=0,Ju=0;function rf(e){var i=Date.now(),r=Math.max(su+23,i);return Ju=setTimeout(function(){e(su=r)},r-i),Ju}function vl(e){var i=qs();return i.requestAnimationFrame?i.requestAnimationFrame(e):rf(e)}function Pc(e){var i=qs();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var Nu=function(){function e(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,st.Z)(this,e),(0,A.Z)(this,"href",void 0),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=r+i}return(0,Ct.Z)(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],a=r.type,s=zu(n),f="data:".concat(a,";base64, ");return f+s}}]),e}();function zu(e){for(var i="",r=new Uint8Array(e),n=r.byteLength,a=0;a<n;a++)i+=String.fromCharCode(r[a]);return _i(i)}var Uu={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},so={};function jf(e){var i=Vf();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Vf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ts=new Map,Ic=new Map,Zu=new Map,uu={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function nf(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function Rl(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,nf.call(this,"readystatechange",i)}var Li=function(e){(0,wr.Z)(r,e);var i=jf(r);function r(){var n;return(0,st.Z)(this,r),n=i.call(this),(0,A.Z)((0,ae.Z)(n),"onabort",void 0),(0,A.Z)((0,ae.Z)(n),"onerror",void 0),(0,A.Z)((0,ae.Z)(n),"onload",void 0),(0,A.Z)((0,ae.Z)(n),"onloadstart",void 0),(0,A.Z)((0,ae.Z)(n),"onprogress",void 0),(0,A.Z)((0,ae.Z)(n),"ontimeout",void 0),(0,A.Z)((0,ae.Z)(n),"onloadend",void 0),(0,A.Z)((0,ae.Z)(n),"onreadystatechange",void 0),(0,A.Z)((0,ae.Z)(n),"readyState",void 0),(0,A.Z)((0,ae.Z)(n),"response",void 0),(0,A.Z)((0,ae.Z)(n),"responseText",void 0),(0,A.Z)((0,ae.Z)(n),"_responseType",void 0),(0,A.Z)((0,ae.Z)(n),"responseXML",void 0),(0,A.Z)((0,ae.Z)(n),"status",void 0),(0,A.Z)((0,ae.Z)(n),"statusText",void 0),(0,A.Z)((0,ae.Z)(n),"upload",void 0),(0,A.Z)((0,ae.Z)(n),"withCredentials",void 0),(0,A.Z)((0,ae.Z)(n),"timeout",void 0),(0,A.Z)((0,ae.Z)(n),"_url",void 0),(0,A.Z)((0,ae.Z)(n),"_method",void 0),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,ts.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,Ct.Z)(r,[{key:"responseType",set:function(a){this._responseType=a}},{key:"abort",value:function(){var a=Zu.get("requestTask");a&&a.abort()}},{key:"getAllResponseHeaders",value:function(){var a=Ic.get("responseHeader");return Object.keys(a).map(function(s){return"".concat(s,": ").concat(a[s])}).join(`
`)}},{key:"getResponseHeader",value:function(a){return Ic.get("responseHeader")[a]}},{key:"open",value:function(a,s,f){this._method=a,this._url=s}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(a,s){var f=ts.get("requestHeader");f[a]=s,ts.set("requestHeader",f)}},{key:"addEventListener",value:function(a,s){var f=this;typeof s=="function"&&(this["on"+a]=function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};v.target=v.target||f,s.call(f,v)})}},{key:"removeEventListener",value:function(a,s){this["on"+a]===s&&(this["on"+a]=null)}}]),r}(Aa);(0,A.Z)(Li,"UNSEND",void 0),(0,A.Z)(Li,"OPENED",void 0),(0,A.Z)(Li,"HEADERS_RECEIVED",void 0),(0,A.Z)(Li,"LOADING",void 0),(0,A.Z)(Li,"DONE",void 0),Li.UNSEND=0,Li.OPENED=1,Li.HEADERS_RECEIVED=2,Li.LOADING=3,Li.DONE=4;function Ll(e){var i=Sp();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Sp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ml=function(e){(0,wr.Z)(r,e);var i=Ll(r);function r(n){var a;return(0,st.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ae.Z)(a),"touches",void 0),(0,A.Z)((0,ae.Z)(a),"targetTouches",void 0),(0,A.Z)((0,ae.Z)(a),"changedTouches",void 0),a.touches=[],a.targetTouches=[],a.changedTouches=[],a.target=qs(),a.currentTarget=qs(),a}return(0,Ct.Z)(r)}(ta);function Oc(e){var i=e||{},r=i.x,n=r===void 0?0:r,a=i.y,s=a===void 0?0:a,f=i.clientX,v=f===void 0?0:f,m=i.clientY,x=m===void 0?0:m;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=s):(e.x=v,e.y=x)}function Gf(e){return function(i){var r=new ml(e);r.changedTouches=i.changedTouches,r.touches=i.touches,r.targetTouches=Array.prototype.slice.call(i.touches),r.timeStamp=i.timeStamp,r.changedTouches.forEach(function(n){return Oc(n)}),r.touches.forEach(function(n){return Oc(n)}),r.targetTouches.forEach(function(n){return Oc(n)}),Y.dispatchEvent(r)}}function Cp(e){return function(i){i.type=e,Y.dispatchEvent(i)}}var Hf=Gf("touchstart"),Rc=Gf("touchmove"),ac=Gf("touchend"),oc=Cp("mapCameaParams");function kl(e){var i=gl();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function gl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Dl=function(e){(0,wr.Z)(r,e);var i=kl(r);function r(n){var a;return(0,st.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ae.Z)(a),"buttons",void 0),(0,A.Z)((0,ae.Z)(a),"which",void 0),(0,A.Z)((0,ae.Z)(a),"pointerId",void 0),(0,A.Z)((0,ae.Z)(a),"bubbles",void 0),(0,A.Z)((0,ae.Z)(a),"button",void 0),(0,A.Z)((0,ae.Z)(a),"width",void 0),(0,A.Z)((0,ae.Z)(a),"height",void 0),(0,A.Z)((0,ae.Z)(a),"pressure",void 0),(0,A.Z)((0,ae.Z)(a),"isPrimary",void 0),(0,A.Z)((0,ae.Z)(a),"pointerType",void 0),(0,A.Z)((0,ae.Z)(a),"altKey",void 0),(0,A.Z)((0,ae.Z)(a),"ctrlKey",void 0),(0,A.Z)((0,ae.Z)(a),"metaKey",void 0),(0,A.Z)((0,ae.Z)(a),"shiftKey",void 0),a.target=qs(),a.currentTarget=qs(),a}return(0,Ct.Z)(r)}(ta),el=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],$s=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],af="touch";function of(e,i,r){for(var n=new Dl(e),a=0;a<el.length;a++){var s=el[a];n[s]=i[s]||$s[a]}return n.type=e,n.target=qs(),n.currentTarget=qs(),n.buttons=Wf(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=sc(i),n.pointerType=af,n.altKey=r.altKey,n.ctrlKey=r.ctrlKey,n.metaKey=r.metaKey,n.shiftKey=r.shiftKey,r.preventDefault&&(n.preventDefault=function(){r.preventDefault()}),n}function Wf(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var lu=null;function sc(e){return lu===e.identifier}function Lc(e){lu===null&&(lu=e.identifier)}function sf(e){lu===e.identifier&&(lu=null)}function Fl(e){return function(i){for(var r=i.changedTouches,n=0;n<r.length;n++){var a=r[n];n===0&&e==="pointerdown"?Lc(a):(e==="pointerup"||e==="pointercancel")&&sf(a);var s=of(e,a,i);Y.dispatchEvent(s)}}}var rh=Fl("pointerdown"),uf=Fl("pointermove"),Bl=Fl("pointerup");function lf(e){var i=cf();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function cf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Nl=function(e){(0,wr.Z)(r,e);var i=lf(r);function r(n){return(0,st.Z)(this,r),i.call(this,n)}return(0,Ct.Z)(r)}(ta);function kc(e){return function(i){i.type=e,Y.dispatchEvent(i)}}var Ap=kc("mousedown"),wp=kc("mousemove"),uc=kc("mouseup"),Tp=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,zl=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),qi=Tp||zl,lc={atob:Ai,btoa:_i,devicePixelRatio:Bi,Blob:Ca,document:Y,Element:ho,Event:ta,EventTarget:Aa,HTMLCanvasElement:me,HTMLElement:Io,HTMLMediaElement:zs,HTMLVideoElement:ga,Image:Qu,ImageData:ut,navigator:Zi,Node:Po,requestAnimationFrame:vl,cancelAnimationFrame:Pc,screen:J,XMLHttpRequest:Li,performance:Es,URL:Nu,WebGLRenderingContext:Uu,WebGL2RenderingContext:so,addEventListener:function(i,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Y.addEventListener(i,r,n)},removeEventListener:function(i,r,n){Y.removeEventListener(i,r)},dispatchEvent:function(i){Y.dispatchEvent(i)},innerWidth:J.availWidth,innerHeight:J.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},oa=qi?lc:Ci,ju=qi?Li:Ci.XMLHttpRequest,Gi=qi?Ks:Ci.location;function wa(e){var i=e;return typeof e=="string"&&(i=oa.document.getElementById(e)),i}function Ss(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Dc(e){return Ss(e).split(/\s+/)}function tl(e){var i,r,n=oa==null||(i=oa.document)===null||i===void 0||(r=i.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var a in e)if(e[a]&&e[a]in n)return e[a];return e[0]}function Za(e,i,r){var n=oa.document.createElement(e);return n.className=i||"",r&&r.appendChild(n),n}function cc(e){var i=e.parentNode;i&&i.removeChild(e)}function Ul(e,i){if(e.classList!==void 0)for(var r=Dc(i),n=0,a=r.length;n<a;n++)e.classList.add(r[n]);else if(!Fc(e,i)){var s=vo(e);Vu(e,(s?s+" ":"")+i)}}function rl(e,i){e.classList!==void 0?e.classList.remove(i):Vu(e,Ss((" "+vo(e)+" ").replace(" "+i+" "," ")))}function Fc(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=vo(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function Vu(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function vo(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Zl(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var fc=tl(["transform","WebkitTransform"]);function mo(e,i){e.style[fc]=i}function gn(){if(typeof Event=="function")oa.dispatchEvent(new Event("resize"));else{var e=oa.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,oa,0),oa.dispatchEvent(e)}}function uo(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function nl(){var e,i=oa.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(a){var s=a.split("="),f=(0,nn.Z)(s,2),v=f[0],m=f[1];return v==="initial-scale"});return n?n.split("=")[1]*1:1}var La=nl()<1?1:oa.devicePixelRatio;function cu(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function ks(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function Bc(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function Kr(e){if(e.length===0)throw new Error("mean requires at least one data point");return Bc(e)/e.length}function ff(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,a=1,s=1;s<e.length+1;s++)e[s]!==i?(a>n&&(n=a,r=i),a=1,i=e[s]):a++;return r*1}var pc={min:ks,max:cu,mean:Kr,sum:Bc,mode:ff};function Gu(e,i){return e.map(function(r){return r[i]})}function ka(e,i){return pc[e](i)}var Cs=ee(14665);function Nc(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var Hu=ee(51814);function rs(e,i,r){return(0,Hu.Z)()?rs=Reflect.construct:rs=function(a,s,f){var v=[null];v.push.apply(v,s);var m=Function.bind.apply(a,v),x=new m;return f&&(0,Cs.Z)(x,f.prototype),x},rs.apply(null,arguments)}function fu(e){var i=typeof Map=="function"?new Map:void 0;return fu=function(n){if(n===null||!Nc(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,a)}function a(){return rs(n,arguments,(0,pt.Z)(this).constructor)}return a.prototype=Object.create(n.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),(0,Cs.Z)(a,n)},fu(e)}function Mp(e){var i=zc();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function zc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Uc=function(e){(0,wr.Z)(r,e);var i=Mp(r);function r(n,a,s){var f;return(0,st.Z)(this,r),f=i.call(this,n),(0,A.Z)((0,ae.Z)(f),"status",void 0),(0,A.Z)((0,ae.Z)(f),"url",void 0),f.status=a,f.url=s,f.name=f.constructor.name,f.message=n,f}return(0,Ct.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(fu(Error));function pf(e){var i=new ju;i.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&i.setRequestHeader(r,e.headers[r]);return i.withCredentials=e.credentials==="include",i}var pu=function(i,r){var n=pf(i);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var a;try{a=JSON.parse(n.response)}catch(s){return r(s)}r(null,a)}else n.status===401?r(new Uc("".concat(n.statusText),n.status,i.url)):r(new Uc(n.statusText,n.status,i.url))},n.send(),n},Us=function(i,r){var n=pf(i);return n.responseType="arraybuffer",n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){var a=n.response;if(a.byteLength===0&&n.status===200)return r(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?r(null,{data:a,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):r(new Uc(n.statusText,n.status,i.url))},n.send(),n};function Ii(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var Su="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Zs=function(i,r){return Us(i,function(n,a){if(n)r(n);else if(a){var s=new oa.Image;s.crossOrigin="anonymous";var f=oa.URL||oa.webkitURL;s.onload=function(){r(null,s),f.revokeObjectURL(s.src),s.onload=null},s.onerror=function(){return r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var v=new oa.Blob([new Uint8Array(a.data)],{type:"image/png"});s.src=a.data.byteLength?f.createObjectURL(v):Su}})},bo=2*Math.PI*6378137/2;function yl(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;il(i,n)}),i}function il(e,i){return Array.isArray(i[0])?i.forEach(function(r){il(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function Qs(e,i){return ls(e,i)}function ls(e,i){return Array.isArray(e[0])?e.map(function(r){return ls(r,i)}):i(e)}function js(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=cs(e,i);var n=e[0],a=e[1],s=n*bo/180,f=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);return f=f*bo/180,r.enable&&(s=Number(s.toFixed(r.decimal)),f=Number(f.toFixed(r.decimal))),e.length===3?[s,f,e[2]]:[s,f]}function Dn(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],a=r/bo*180,s=n/bo*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),i!=null&&(a=Number(a.toFixed(i)),s=Number(s.toFixed(i))),e.length===3?[a,s,e[2]]:[a,s]}function An(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Zc(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function cs(e,i){if(i===!1)return e;var r=An(e[0]),n=Zc(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function Oo(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,a=Math.PI/180,s=e[0]*a,f=r*a;f=Math.log(Math.tan(Math.PI/4+f/2));var v=.5/Math.PI,m=.5,x=-.5/Math.PI;return a=.5,s=n*(v*s+m),f=n*(x*f+a),[Math.floor(s),Math.floor(f)]}function ns(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,a=.5,s=256<<20,f=_slicedToArray(e,2),v=f[0],m=f[1];v=(v/s-r)/i,m=(m/s-a)/n,m=(Math.atan(Math.pow(Math.E,m))-Math.PI/4)*2,a=Math.PI/180;var x=m/a,C=v/a;return[C,x]}function Cu(e,i,r){var n=Jt(i[1]-e[1]),a=Jt(i[0]-e[0]),s=Jt(e[1]),f=Jt(i[1]),v=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(f);return fe(2*Math.atan2(Math.sqrt(v),Math.sqrt(1-v)),r="meters")}function Xf(e){var i=Math.PI/180,r=85.0511287798,n=6378137,a=Math.max(Math.min(r,e[1]),-r),s=Math.sin(a*i),f=n*e[0]*i,v=n*Math.log((1+s)/(1-s))/2;return[f,v]}function _l(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function sa(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function Da(e){return[[e[0],e[1]],[e[2],e[3]]]}function hf(e){var i=xl(e,[0,0]);return[e[0]/i,e[1]/i]}function xl(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function Au(e,i){return e[0]*i[0]+e[1]*i[1]}function hu(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Yo(e,i){return Math.acos(Au(e,i)/(hu(e)*hu(i)))*180/Math.PI}function al(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function Wu(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,a=[],s=0;s<e.length-1;s++){var f=e[s],v=e[s+1],m=xl(f,v);n+=m;var x=[f[0]-v[0],f[1]-v[1]],C=al(r,x);if(s>0){var T=a[s-1].rotation;T-C>360-T+C&&(C=C+360)}a.push({start:f,end:v,dis:m,rotation:C,duration:0})}return a.map(function(O){O.duration=i*(O.dis/n)}),a}}var jc=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,st.Z)(this,e),(0,A.Z)(this,"limit",void 0),(0,A.Z)(this,"cache",void 0),(0,A.Z)(this,"destroy",void 0),(0,A.Z)(this,"order",void 0),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,Ct.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(a){return a===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function du(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var Vc=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,st.Z)(this,e),(0,A.Z)(this,"duration",16),(0,A.Z)(this,"timestamp",new Date().getTime()),this.duration=i}return(0,Ct.Z)(e,[{key:"run",value:function(r){var n=new Date().getTime(),a=n-this.timestamp;this.timestamp=n,a>=this.duration&&r()}}]),e}(),hc=ee(2650);function jl(e){return typeof e=="string"?!!hc.ZP(e):!1}function Qi(e){var i=hc.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function bl(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],a=i+r*256+n*65536-1;return a}function vu(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function wu(e){var i=oa.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;for(var n=r.createLinearGradient(0,0,256,1),a=null,s=e.positions[0],f=e.positions[e.positions.length-1],v=0;v<e.colors.length;++v){var m=(e.positions[v]-s)/(f-s);n.addColorStop(m,e.colors[v])}if(r.fillStyle=n,r.fillRect(0,0,256,1),qi)return a=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),{data:a,width:256,height:1};a=r.getImageData(0,0,256,1).data;for(var x=r.createImageData(256,1),C=0;C<x.data.length;C+=4)x.data[C+0]=a[C+0],x.data[C+1]=a[C+1],x.data[C+2]=a[C+2],x.data[C+3]=a[C+3];return x}var Vl;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(Vl||(Vl={}));var Tu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Vs(e,i,r){var n=e.classList;for(var a in Tu)Tu.hasOwnProperty(a)&&n.remove("l7-".concat(r,"-anchor-").concat(a));n.add("l7-".concat(r,"-anchor-").concat(i))}function ja(e,i){return{enable:e,mask:255,func:{cmp:514,ref:i?1:0,mask:255}}}var Mu={BACK:1029,FRONT:1028};function Gl(e){switch(e){case"GAODE1.x":return Mu.BACK;case"GAODE2.x":return Mu.BACK;case"MAPBOX":return Mu.FRONT;case"SIMPLE":return Mu.FRONT;case"GLOBEL":return Mu.BACK;case"L7MAP":return Mu.FRONT;default:return Mu.FRONT}}function Gc(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function l(e,i){if(!e||!e.length)throw new Error("url is not allowed to be empty");var r=i.x,n=i.y,a=i.z;if(Array.isArray(e)){var s=Math.abs(r+n)%e.length;e=e[s]}return e.replace(/\{x\}/g,r.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,a.toString()).replace(/\{-y\}/g,(Math.pow(2,a)-n-1).toString())}var p;(function(e){e.Overlap="overlap",e.Replace="replace"})(p||(p={}));var c;(function(e){e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled"})(c||(c={}));var d=ee(92137),E=ee(87757),w=ee.n(E);function P(e,i){i===void 0&&(i={});var r=Number(e[0]),n=Number(e[1]),a=Number(e[2]),s=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var f=[r,n],v=[r,s],m=[a,s],x=[a,n];return Ri([[f,x,m,v,f]],i.properties,{bbox:e,id:i.id})}var L=0,z=1,H=2;function oe(e){e.forEach(function(i){i.properties.state=L}),e.forEach(function(i){i.isCurrent&&!le(i)&&Pe(i)}),e.forEach(function(i){i.isVisible=Boolean(i.properties.state&H)})}function ue(e){e.forEach(function(r){r.properties.state=L}),e.forEach(function(r){r.isCurrent&&le(r)});var i=e.slice().sort(function(r,n){return r.z-n.z});i.forEach(function(r){r.isVisible=Boolean(r.properties.state&H),r.children.length&&(r.isVisible||r.properties.state&z)?r.children.forEach(function(n){n.properties.state=z}):r.isCurrent&&Pe(r)})}function le(e){for(;e;){if(e.isLoaded)return e.properties.state|=H,!0;e=e.parent}return!1}function Pe(e){e.children.forEach(function(i){i.isLoaded?i.properties.state|=H:Pe(i)})}var we,Ge=256,Ce=[-Infinity,-Infinity,Infinity,Infinity],Ve=5,$e=(we={},(0,A.Z)(we,p.Overlap,oe),(0,A.Z)(we,p.Replace,ue),we),yt=function(){};function Vt(e,i,r){var n=Math.floor((e+180)/360*Math.pow(2,r)),a=Math.floor((1-Math.log(Math.tan(i*Math.PI/180)+1/Math.cos(i*Math.PI/180))/Math.PI)/2*Math.pow(2,r));return[n,a]}function Bt(e,i,r){var n=e/Math.pow(2,r)*360-180,a=Math.PI-2*Math.PI*i/Math.pow(2,r),s=180/Math.PI*Math.atan(.5*(Math.exp(a)-Math.exp(-a)));return[n,s]}var Xt=function(i,r,n){var a=Bt(i,r,n),s=(0,nn.Z)(a,2),f=s[0],v=s[1],m=Bt(i+1,r+1,n),x=(0,nn.Z)(m,2),C=x[0],T=x[1];return[f,T,C,v]};function vr(e){var i=e.zoom,r=e.latLonBounds,n=e.maxZoom,a=n===void 0?Infinity:n,s=e.minZoom,f=s===void 0?0:s,v=e.zoomOffset,m=v===void 0?0:v,x=e.extent,C=x===void 0?Ce:x,T=Math.ceil(i)+m;T<f?T=f:T>a&&(T=a);for(var O=(0,nn.Z)(r,4),D=O[0],Z=O[1],W=O[2],Q=O[3],ye=[Math.max(D,C[0]),Math.max(Z,C[1]),Math.min(W,C[2]),Math.min(Q,C[3])],Be=[],qe=Vt(ye[0],ye[1],T),rt=(0,nn.Z)(qe,2),_t=rt[0],mt=rt[1],Ht=Vt(ye[2],ye[3],T),rr=(0,nn.Z)(Ht,2),Cr=rr[0],qr=rr[1],gr=_t;gr<=Cr;gr++)for(var sn=qr;sn<=mt;sn++)Be.push({x:gr,y:sn,z:T});return Be}var Br=function(i,r,n){var a=Math.pow(2,n),s=a-1,f=a,v=i,m=r;return v<0?v=v+f:v>s&&(v=v%f),{warpX:v,warpY:m}},Lr=function(){function e(i){(0,st.Z)(this,e),(0,A.Z)(this,"x",void 0),(0,A.Z)(this,"y",void 0),(0,A.Z)(this,"z",void 0),(0,A.Z)(this,"tileSize",256),(0,A.Z)(this,"isVisible",!1),(0,A.Z)(this,"isCurrent",!1),(0,A.Z)(this,"layer",null),(0,A.Z)(this,"layers",[]),(0,A.Z)(this,"parent",null),(0,A.Z)(this,"children",[]),(0,A.Z)(this,"data",null),(0,A.Z)(this,"properties",{}),(0,A.Z)(this,"loadStatus",void 0),(0,A.Z)(this,"abortController",void 0),(0,A.Z)(this,"loadDataId",0);var r=i.x,n=i.y,a=i.z,s=i.tileSize;this.x=r,this.y=n,this.z=a,this.tileSize=s}return(0,Ct.Z)(e,[{key:"isLoading",get:function(){return this.loadStatus===c.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===c.Loaded}},{key:"isCancelled",get:function(){return this.loadStatus===c.Cancelled}},{key:"isDone",get:function(){return[c.Loaded,c.Cancelled,c.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return Xt(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var r=(0,nn.Z)(this.bounds,4),n=r[0],a=r[1],s=r[2],f=r[3],v=[(s-n)/2,(f-a)/2],m=P(this.bounds,{properties:{key:this.key,bbox:this.bounds,center:v,meta:`
      `.concat(this.key,`
      `)}});return m}},{key:"key",get:function(){var r="".concat(this.x,",").concat(this.y,",").concat(this.z);return r}},{key:"loadData",value:function(){var i=(0,d.Z)(w().mark(function n(a){var s,f,v,m,x,C,T,O,D,Z,W,Q,ye,Be,qe,rt;return w().wrap(function(mt){for(;;)switch(mt.prev=mt.next){case 0:return s=a.getData,f=a.onLoad,v=a.onError,this.loadDataId++,m=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=c.Loading,x=null,mt.prev=7,T=this.x,O=this.y,D=this.z,Z=this.bounds,W=this.tileSize,Q=Br(T,O,D),ye=Q.warpX,Be=Q.warpY,qe=this.abortController.signal,rt={x:ye,y:Be,z:D,bounds:Z,tileSize:W,signal:qe},mt.next=14,s(rt);case 14:x=mt.sent,mt.next=20;break;case 17:mt.prev=17,mt.t0=mt.catch(7),C=mt.t0;case 20:if(m===this.loadDataId){mt.next=22;break}return mt.abrupt("return");case 22:if(!(this.isCancelled&&!x)){mt.next=24;break}return mt.abrupt("return");case 24:if(!(C||!x)){mt.next=28;break}return this.loadStatus=c.Failure,v(C,this),mt.abrupt("return");case 28:this.loadStatus=c.Loaded,this.data=x,f(this);case 31:case"end":return mt.stop()}},n,this,[[7,17]])}));function r(n){return i.apply(this,arguments)}return r}()},{key:"reloadData",value:function(r){this.isLoading&&this.abortLoad(),this.loadData(r)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=c.Cancelled,this.abortController.abort())}}]),e}(),jr=ee(26729),Fn=ee.n(jr);function On(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Zn(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function Zn(e,i){if(!!e){if(typeof e=="string")return Oi(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Oi(e,i)}}function Oi(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function un(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Qn(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?un(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):un(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function li(e){var i=Jn();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Jn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Hn=function(e){(0,wr.Z)(r,e);var i=li(r);function r(n){var a;return(0,st.Z)(this,r),a=i.call(this),(0,A.Z)((0,ae.Z)(a),"currentTiles",[]),(0,A.Z)((0,ae.Z)(a),"options",void 0),(0,A.Z)((0,ae.Z)(a),"cacheTiles",new Map),(0,A.Z)((0,ae.Z)(a),"lastViewStates",void 0),(0,A.Z)((0,ae.Z)(a),"onTileLoad",function(s){a.emit("tile-loaded",s),a.updateTileVisible()}),(0,A.Z)((0,ae.Z)(a),"onTileError",function(s,f){a.emit("tile-error",{error:s,tile:f}),a.updateTileVisible()}),(0,A.Z)((0,ae.Z)(a),"onTileUnload",function(s){a.emit("tile-unload",s)}),a.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:Ce,getTileData:yt,updateStrategy:p.Overlap},a.updateOptions(n),a}return(0,Ct.Z)(r,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(a){return a.isDone})}},{key:"tiles",get:function(){var a=Array.from(this.cacheTiles.values()).sort(function(s,f){return s.z-f.z});return a}},{key:"updateOptions",value:function(a){var s=a.minZoom===void 0?this.options.minZoom:Math.ceil(a.minZoom),f=a.maxZoom===void 0?this.options.maxZoom:Math.floor(a.maxZoom);this.options=Qn(Qn(Qn({},this.options),a),{},{minZoom:s,maxZoom:f})}},{key:"update",value:function(a,s){var f=this;if(!(this.lastViewStates&&this.lastViewStates.zoom===a&&this.lastViewStates.latLonBounds.toString()===s.toString())){this.lastViewStates={zoom:a,latLonBounds:s};var v=!1,m=this.getTileIndices(a,s);this.currentTiles=m.map(function(x){var C=x.x,T=x.y,O=x.z,D=f.getTile(C,T,O);return D||(D=f.createTile(C,T,O),v=!0,D)}),v&&(this.resizeCacheTiles(),this.rebuildTileTree()),this.updateTileVisible()}}},{key:"reloadAll",value:function(){var a=On(this.cacheTiles),s;try{for(a.s();!(s=a.n()).done;){var f=(0,nn.Z)(s.value,2),v=f[0],m=f[1];this.currentTiles.includes(m)||(this.cacheTiles.delete(v),this.onTileUnload(m)),this.onTileUnload(m),m.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(x){a.e(x)}finally{a.f()}}},{key:"destroy",value:function(){var a=On(this.cacheTiles.values()),s;try{for(a.s();!(s=a.n()).done;){var f=s.value;f.isLoading&&f.abortLoad()}}catch(v){a.e(v)}finally{a.f()}this.cacheTiles.clear(),this.currentTiles=[],this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var a=this.options.updateStrategy,s=new Map,f=On(this.cacheTiles.values()),v;try{for(f.s();!(v=f.n()).done;){var m=v.value;s.set(m.key,m.isVisible),m.isCurrent=!1,m.isVisible=!1}}catch(Z){f.e(Z)}finally{f.f()}var x=On(this.currentTiles),C;try{for(x.s();!(C=x.n()).done;){var T=C.value;T.isCurrent=!0,T.isVisible=!0}}catch(Z){x.e(Z)}finally{x.f()}var O=Array.from(this.cacheTiles.values());typeof a=="function"?a(O):$e[a](O);var D=Array.from(this.cacheTiles.values()).some(function(Z){return Z.isVisible!==s.get(Z.key)});D&&this.emit("tile-update")}},{key:"getTileIndices",value:function(a,s){var f=this.options,v=f.tileSize,m=f.extent,x=f.zoomOffset,C=Math.floor(this.options.maxZoom),T=Math.ceil(this.options.minZoom),O=vr({maxZoom:C,minZoom:T,zoomOffset:x,tileSize:v,zoom:a,latLonBounds:s,extent:m});return O}},{key:"getTileId",value:function(a,s,f){var v="".concat(a,",").concat(s,",").concat(f);return v}},{key:"getTile",value:function(a,s,f){var v=this.getTileId(a,s,f),m=this.cacheTiles.get(v);return m}},{key:"createTile",value:function(a,s,f){var v=this.getTileId(a,s,f),m=new Lr({x:a,y:s,z:f,tileSize:this.options.tileSize});return this.cacheTiles.set(v,m),m.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),m}},{key:"resizeCacheTiles",value:function(){var a=Ve*this.currentTiles.length,s=this.cacheTiles.size>a;if(s){var f=On(this.cacheTiles),v;try{for(f.s();!(v=f.n()).done;){var m=(0,nn.Z)(v.value,2),x=m[0],C=m[1];if(!C.isVisible&&!this.currentTiles.includes(C)&&(this.cacheTiles.delete(x),this.onTileUnload(C)),this.cacheTiles.size<=a)break}}catch(T){f.e(T)}finally{f.f()}}}},{key:"rebuildTileTree",value:function(){var a=On(this.cacheTiles.values()),s;try{for(a.s();!(s=a.n()).done;){var f=s.value;f.parent=null,f.children.length=0}}catch(T){a.e(T)}finally{a.f()}var v=On(this.cacheTiles.values()),m;try{for(v.s();!(m=v.n()).done;){var x=m.value,C=this.getNearestAncestor(x.x,x.y,x.z);x.parent=C,C!=null&&C.children&&C.children.push(x)}}catch(T){v.e(T)}finally{v.f()}}},{key:"getNearestAncestor",value:function(a,s,f){for(;f>this.options.minZoom;){a=Math.floor(a/2),s=Math.floor(s/2),f=f-1;var v=this.getTile(a,s,f);if(v)return v}return null}}]),r}(Fn());function pi(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,a=new Promise(function(f){e instanceof HTMLImageElement?f([e]):Kn(e,function(v){f(v)})}),s={originData:e,images:a,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return s}function Kn(e,i){var r=e,n=[];if(typeof r=="string")Zs({url:r},function(f,v){n.push(v),i(n)});else{var a=r.length,s=0;r.forEach(function(f){Zs({url:f},function(v,m){s++,n.push(m),s===a&&i(n)})})}return pi}function Wn(e,i){var r=i.extent,n=i.width,a=i.height,s=i.min,f=i.max,v={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:a,min:s,max:f,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return v}function go(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Va(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?go(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):go(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var No={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},zo=function(){var e=(0,d.Z)(w().mark(function i(r,n){var a;return w().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return a=l(r,n),f.abrupt("return",new Promise(function(v,m){Zs({url:a},function(x,C){x?m(x):v(C)})}));case 2:case"end":return f.stop()}},i)}));return function(r,n){return e.apply(this,arguments)}}();function $a(e,i){var r=function(s){return zo(e,s)},n=Va(Va(Va({},No),i),{},{getTileData:r});return{data:e,dataArray:[],tilesetOptions:n}}var lo=ee(30236),Ds=ee.n(lo),fs=ee(47037),Uo=ee.n(fs),ps=ee(23560),is=ee.n(ps),Js=ee(50361),Pu=ee.n(Js),ol=ee(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Xu(e,i,r,n){function a(s){return s instanceof r?s:new r(function(f){f(s)})}return new(r||(r=Promise))(function(s,f){function v(C){try{x(n.next(C))}catch(T){f(T)}}function m(C){try{x(n.throw(C))}catch(T){f(T)}}function x(C){C.done?s(C.value):a(C.value).then(v,m)}x((n=n.apply(e,i||[])).next())})}function Hl(e,i){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,a,s,f;return f={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function v(x){return function(C){return m([x,C])}}function m(x){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(s=x[0]&2?a.return:x[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,x[1])).done)return s;switch(a=0,s&&(x=[x[0]&2,s.value]),x[0]){case 0:case 1:s=x;break;case 4:return r.label++,{value:x[1],done:!1};case 5:r.label++,a=x[1],x=[0];continue;case 7:x=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(x[0]===6||x[0]===2)){r=0;continue}if(x[0]===3&&(!s||x[1]>s[0]&&x[1]<s[3])){r.label=x[1];break}if(x[0]===6&&r.label<s[1]){r.label=s[1],s=x;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(x);break}s[2]&&r.ops.pop(),r.trys.pop();continue}x=i.call(e,r)}catch(C){x=[6,C],a=0}finally{n=s=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}function dc(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,s=[],f;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)s.push(a.value)}catch(v){f={error:v}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(f)throw f.error}}return s}function mu(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(dc(arguments[i]));return e}function Qa(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Ta(e,i){return i={exports:{}},e(i,i.exports),i.exports}var no=Ta(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default});Qa(no);var Iu=Ta(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];var s=n.pop();return r.call(this,n,s)}},e.exports=i.default});Qa(Iu);var Gs=Ta(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.fallback=a,i.wrap=s;var r=i.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,n=i.hasNextTick=typeof ol=="object"&&typeof ol.nextTick=="function";function a(v){setTimeout(v,0)}function s(v){return function(m){for(var x=[],C=arguments.length-1;C-- >0;)x[C]=arguments[C+1];return v(function(){return m.apply(void 0,x)})}}var f;r?f=setImmediate:n?f=ol.nextTick:f=a,i.default=s(f)});Qa(Gs);var El=Gs.fallback,ua=Gs.wrap,eu=Gs.hasSetImmediate,As=Gs.hasNextTick,Yu=Ta(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Iu),n=a(Gs);function a(m){return m&&m.__esModule?m:{default:m}}function s(m){return(0,Fs.isAsync)(m)?function(){for(var x=[],C=arguments.length;C--;)x[C]=arguments[C];var T=x.pop(),O=m.apply(this,x);return f(O,T)}:(0,r.default)(function(x,C){var T;try{T=m.apply(this,x)}catch(O){return C(O)}if(T&&typeof T.then=="function")return f(T,C);C(null,T)})}function f(m,x){return m.then(function(C){v(x,null,C)},function(C){v(x,C&&C.message?C:new Error(C))})}function v(m,x,C){try{m(x,C)}catch(T){(0,n.default)(function(O){throw O},T)}}e.exports=i.default});Qa(Yu);var Fs=Ta(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isAsyncIterable=i.isAsyncGenerator=i.isAsync=void 0;var r=n(Yu);function n(m){return m&&m.__esModule?m:{default:m}}function a(m){return m[Symbol.toStringTag]==="AsyncFunction"}function s(m){return m[Symbol.toStringTag]==="AsyncGenerator"}function f(m){return typeof m[Symbol.asyncIterator]=="function"}function v(m){if(typeof m!="function")throw new Error("expected a function");return a(m)?(0,r.default)(m):m}i.default=v,i.isAsync=a,i.isAsyncGenerator=s,i.isAsyncIterable=f});Qa(Fs);var df=Fs.isAsyncIterable,Yf=Fs.isAsyncGenerator,gu=Fs.isAsync,Ou=Ta(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,a){if(a===void 0&&(a=n.length),!a)throw new Error("arity is undefined");function s(){for(var f=this,v=[],m=arguments.length;m--;)v[m]=arguments[m];return typeof v[a-1]=="function"?n.apply(this,v):new Promise(function(x,C){v[a-1]=function(T){for(var O=[],D=arguments.length-1;D-- >0;)O[D]=arguments[D+1];if(T)return C(T);x(O.length>1?O:O[0])},n.apply(f,v)})}return Object.defineProperty(s,"name",{configurable:!0,value:"awaitable("+n.name+")"}),s}e.exports=i.default});Qa(Ou);var Hs=Ta(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(no),n=s(Fs),a=s(Ou);function s(f){return f&&f.__esModule?f:{default:f}}i.default=(0,a.default)(function(f,v,m){var x=(0,r.default)(v)?[]:{};f(v,function(C,T,O){(0,n.default)(C)(function(D){for(var Z,W=[],Q=arguments.length-1;Q-- >0;)W[Q]=arguments[Q+1];W.length<2&&(Z=W,W=Z[0]),x[T]=W,O(D)})},function(C){return m(C,x)})},3),e.exports=i.default});Qa(Hs);var Ru=Ta(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function a(){for(var s=[],f=arguments.length;f--;)s[f]=arguments[f];if(n!==null){var v=n;n=null,v.apply(this,s)}}return Object.assign(a,n),a}e.exports=i.default});Qa(Ru);var vc=Ta(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default});Qa(vc);var yu=Ta(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=m;var r=a(no),n=a(vc);function a(x){return x&&x.__esModule?x:{default:x}}function s(x){var C=-1,T=x.length;return function(){return++C<T?{value:x[C],key:C}:null}}function f(x){var C=-1;return function(){var O=x.next();return O.done?null:(C++,{value:O.value,key:C})}}function v(x){var C=x?Object.keys(x):[],T=-1,O=C.length;return function(){var Z=C[++T];return T<O?{value:x[Z],key:Z}:null}}function m(x){if((0,r.default)(x))return s(x);var C=(0,n.default)(x);return C?f(C):v(x)}e.exports=i.default});Qa(yu);var yo=Ta(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(n===null)throw new Error("Callback was already called.");var f=n;n=null,f.apply(this,a)}}e.exports=i.default});Qa(yo);var Sl=Ta(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default});Qa(Sl);var vf=Ta(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=a;var r=n(Sl);function n(s){return s&&s.__esModule?s:{default:s}}function a(s,f,v,m){var x=!1,C=!1,T=!1,O=0,D=0;function Z(){O>=f||T||x||(T=!0,s.next().then(function(ye){var Be=ye.value,qe=ye.done;if(!(C||x)){if(T=!1,qe){x=!0,O<=0&&m(null);return}O++,v(Be,D,W),D++,Z()}}).catch(Q))}function W(ye,Be){if(O-=1,!C){if(ye)return Q(ye);if(ye===!1){x=!0,C=!0;return}if(Be===r.default||x&&O<=0)return x=!0,m(null);Z()}}function Q(ye){C||(T=!1,x=!0,m(ye))}Z()}e.exports=i.default});Qa(vf);var qf=Ta(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=v(Ru),n=v(yu),a=v(yo),s=v(vf),f=v(Sl);function v(m){return m&&m.__esModule?m:{default:m}}i.default=function(m){return function(x,C,T){if(T=(0,r.default)(T),m<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!x)return T(null);if((0,Fs.isAsyncGenerator)(x))return(0,s.default)(x,m,C,T);if((0,Fs.isAsyncIterable)(x))return(0,s.default)(x[Symbol.asyncIterator](),m,C,T);var O=(0,n.default)(x),D=!1,Z=!1,W=0,Q=!1;function ye(qe,rt){if(!Z)if(W-=1,qe)D=!0,T(qe);else if(qe===!1)D=!0,Z=!0;else{if(rt===f.default||D&&W<=0)return D=!0,T(null);Q||Be()}}function Be(){for(Q=!0;W<m&&!D;){var qe=O();if(qe===null){D=!0,W<=0&&T(null);return}W+=1,C(qe.value,qe.key,(0,a.default)(ye))}Q=!1}Be()}},e.exports=i.default});Qa(qf);var Hc=Ta(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(qf),n=s(Fs),a=s(Ou);function s(v){return v&&v.__esModule?v:{default:v}}function f(v,m,x,C){return(0,r.default)(m)(v,(0,n.default)(x),C)}i.default=(0,a.default)(f,4),e.exports=i.default});Qa(Hc);var Pp=Ta(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=a(Hc),n=a(Ou);function a(f){return f&&f.__esModule?f:{default:f}}function s(f,v,m){return(0,r.default)(f,1,v,m)}i.default=(0,n.default)(s,3),e.exports=i.default});Qa(Pp);var nh=Ta(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Hs),n=a(Pp);function a(f){return f&&f.__esModule?f:{default:f}}function s(f,v){return(0,r.default)(n.default,f,v)}e.exports=i.default}),Wl=Qa(nh),tu=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,Wl(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(a){r.apply(void 0,mu(n.args)),a(null,i)})},e}(),Kf=Ta(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=x(no),n=x(Sl),a=x(Hc),s=x(Ru),f=x(yo),v=x(Fs),m=x(Ou);function x(D){return D&&D.__esModule?D:{default:D}}function C(D,Z,W){W=(0,s.default)(W);var Q=0,ye=0,Be=D.length,qe=!1;Be===0&&W(null);function rt(_t,mt){_t===!1&&(qe=!0),qe!==!0&&(_t?W(_t):(++ye===Be||mt===n.default)&&W(null))}for(;Q<Be;Q++)Z(D[Q],Q,(0,f.default)(rt))}function T(D,Z,W){return(0,a.default)(D,Infinity,Z,W)}function O(D,Z,W){var Q=(0,r.default)(D)?C:T;return Q(D,(0,v.default)(Z),W)}i.default=(0,m.default)(O,3),e.exports=i.default});Qa(Kf);var zh=Ta(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Kf),n=a(Hs);function a(f){return f&&f.__esModule?f:{default:f}}function s(f,v){return(0,n.default)(r.default,f,v)}e.exports=i.default}),Xl=Qa(zh),mf=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Xl(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(a){return Xu(n,void 0,void 0,function(){return Hl(this,function(s){switch(s.label){case 0:return[4,r()];case 1:return s.sent(),a(null,i),[2]}})})})},e}(),Uh=Ta(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=f(Ru),n=f(yo),a=f(Fs),s=f(Ou);function f(m){return m&&m.__esModule?m:{default:m}}function v(m,x){if(x=(0,r.default)(x),!Array.isArray(m))return x(new Error("First argument to waterfall must be an array of functions"));if(!m.length)return x();var C=0;function T(D){var Z=(0,a.default)(m[C++]);Z.apply(void 0,D.concat([(0,n.default)(O)]))}function O(D){for(var Z=[],W=arguments.length-1;W-- >0;)Z[W]=arguments[W+1];if(D!==!1){if(D||C===m.length)return x.apply(void 0,[D].concat(Z));T(Z)}}T([])}i.default=(0,s.default)(v),e.exports=i.default}),Ad=Qa(Uh),gf=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Ad(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var a=r();n(a?null:!1,a)}):this.tasks.push(function(n,a){var s=r();a(s?null:!1,i)})},e}(),$f=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Wl(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var a=r();n(a,i)})},e}(),wd=ee(69848),Zh=ee.n(wd);function ih(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ip(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ih(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ih(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function jh(e,i){var r=i.radius,n=r===void 0?40:r,a=i.maxZoom,s=a===void 0?18:a,f=i.minZoom,v=f===void 0?0:f,m=i.zoom,x=m===void 0?2:m;if(e.pointIndex){var C=e.pointIndex.getClusters(e.extent,Math.floor(x));return e.dataArray=yf(C),e}var T=new(Zh())({radius:n,minZoom:v,maxZoom:s}),O={type:"FeatureCollection",features:[]};return O.features=e.dataArray.map(function(D){return{type:"Feature",geometry:{type:"Point",coordinates:D.coordinates},properties:Ip({},D)}}),T.load(O.features),T}function yf(e){return e.map(function(i,r){return Ip({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function Td(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function Ro(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function Qf(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,a=1;a<e.length;a++)n=i+e[a]*1,Math.abs(i)>=Math.abs(e[a])?r+=i-n+e[a]:r+=e[a]-n+i,i=n;return i+r*1}function Vh(e){if(e.length===0)throw new Error("mean requires at least one data point");return Qf(e)/e.length}var Op={min:Ro,max:Td,mean:Vh,sum:Qf};function Rp(e,i){return e.map(function(r){return r[i]*1})}function _f(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function mc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?_f(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_f(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Jf(e){var i=gc();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function gc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function xf(e,i){if(Array.isArray(i))return i}var ep=function(e){(0,wr.Z)(r,e);var i=Jf(r);function r(n,a){var s;return(0,st.Z)(this,r),s=i.call(this),(0,A.Z)((0,ae.Z)(s),"data",void 0),(0,A.Z)((0,ae.Z)(s),"extent",void 0),(0,A.Z)((0,ae.Z)(s),"hooks",{init:new tu}),(0,A.Z)((0,ae.Z)(s),"parser",{type:"geojson"}),(0,A.Z)((0,ae.Z)(s),"transforms",[]),(0,A.Z)((0,ae.Z)(s),"cluster",!1),(0,A.Z)((0,ae.Z)(s),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,A.Z)((0,ae.Z)(s),"tileset",void 0),(0,A.Z)((0,ae.Z)(s),"mapService",void 0),(0,A.Z)((0,ae.Z)(s),"invalidExtent",!1),(0,A.Z)((0,ae.Z)(s),"dataArrayChanged",!1),(0,A.Z)((0,ae.Z)(s),"originData",void 0),(0,A.Z)((0,ae.Z)(s),"rawData",void 0),(0,A.Z)((0,ae.Z)(s),"cfg",{}),(0,A.Z)((0,ae.Z)(s),"clusterIndex",void 0),s.originData=n,s.initCfg(a),s.hooks.init.tap("parser",function(){s.excuteParser()}),s.hooks.init.tap("cluster",function(){s.initCluster()}),s.hooks.init.tap("transform",function(){s.executeTrans()}),s.init(),s}return(0,Ct.Z)(r,[{key:"getClusters",value:function(a){return this.clusterIndex.getClusters(this.caculClusterExtent(2),a)}},{key:"getClustersLeaves",value:function(a){return this.clusterIndex.getLeaves(a,Infinity)}},{key:"updateClusterData",value:function(a){var s=this,f=this.clusterOptions,v=f.method,m=v===void 0?"sum":v,x=f.field,C=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(a));this.clusterOptions.zoom=a,C.forEach(function(T){T.id||(T.properties.point_count=1)}),(x||is()(m))&&(C=C.map(function(T){var O=T.id;if(O){var D=s.clusterIndex.getLeaves(O,Infinity),Z=D.map(function(ye){return ye.properties}),W;if(Uo()(m)&&x){var Q=Rp(Z,x);W=Op[m](Q)}is()(m)&&(W=m(Z)),T.properties.stat=W}else T.properties.point_count=1;return T})),this.data=de("geojson")({type:"FeatureCollection",features:C}),this.executeTrans()}},{key:"getFeatureById",value:function(a){var s=this.parser.type,f=s===void 0?"geojson":s;if(f==="geojson"&&!this.cluster){var v=a<this.originData.features.length?this.originData.features[a]:"null",m=Pu()(v);if(this.transforms.length!==0||this.dataArrayChanged){var x=this.data.dataArray.find(function(C){return C._id===a});m.properties=x}return m}else return a<this.data.dataArray.length?this.data.dataArray[a]:"null"}},{key:"updateFeaturePropertiesById",value:function(a,s){this.data.dataArray=this.data.dataArray.map(function(f){return f._id===a?mc(mc({},f),s):f}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(a,s){var f=this.data.dataArray.find(function(v){return v[a]===s});return f==null?void 0:f._id}},{key:"setData",value:function(a,s){this.originData=a,this.dataArrayChanged=!1,this.initCfg(s),this.init(),this.emit("update")}},{key:"destroy",value:function(){var a;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(a=this.tileset)===null||a===void 0||a.destroy()}},{key:"initCfg",value:function(a){this.cfg=Ds()(this.cfg,a,xf);var s=this.cfg;s&&(s.parser&&(this.parser=s.parser),s.transforms&&(this.transforms=s.transforms),this.cluster=s.cluster||!1,s.clusterOptions&&(this.cluster=!0,this.clusterOptions=mc(mc({},this.clusterOptions),s.clusterOptions)))}},{key:"init",value:function(){this.hooks.init.call(this)}},{key:"excuteParser",value:function(){var a=this.parser,s=a.type||"geojson",f=de(s);this.data=f(this.originData,a),this.extent=yl(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3],this.tileset=this.initTileset()}},{key:"initTileset",value:function(){var a=this.data.tilesetOptions;if(!!a){if(this.tileset)return this.tileset.updateOptions(a),this.tileset;var s=new Hn(mc({},a));return s}}},{key:"executeTrans",value:function(){var a=this,s=this.transforms;s.forEach(function(f){var v=f.type,m=xe(v)(a.data,f);Object.assign(a.data,m)})}},{key:"initCluster",value:function(){if(!!this.cluster){var a=this.clusterOptions||{};this.clusterIndex=jh(this.data,a)}}},{key:"caculClusterExtent",value:function(a){var s=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(s=_l(Da(this.extent),a)),s[0].concat(s[1])}}]),r}(jr.EventEmitter);function Lp(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function Yl(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=kp(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function kp(e,i){if(!!e){if(typeof e=="string")return bf(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return bf(e,i)}}function bf(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Ef=6378e3;function Sf(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=a/(2*Math.PI*Ef)*(256<<20)/2,f=Cf(r,a),v=f.gridHash,m=f.gridOffset,x=np(v,m,i);return{yOffset:s,xOffset:s,radius:s,type:"grid",dataArray:x}}function Cf(e,i){var r=Infinity,n=-Infinity,a,s=Yl(e),f;try{for(s.s();!(f=s.n()).done;){var v=f.value;a=v.coordinates[1],Number.isFinite(a)&&(r=a<r?a:r,n=a>n?a:n)}}catch(qe){s.e(qe)}finally{s.f()}var m=(r+n)/2,x=ru(i,m);if(x.xOffset<=0||x.yOffset<=0)return{gridHash:{},gridOffset:x};var C={},T=Yl(e),O;try{for(T.s();!(O=T.n()).done;){var D=O.value,Z=D.coordinates[1],W=D.coordinates[0];if(Number.isFinite(Z)&&Number.isFinite(W)){var Q=Math.floor((Z+90)/x.yOffset),ye=Math.floor((W+180)/x.xOffset),Be="".concat(Q,"-").concat(ye);C[Be]=C[Be]||{count:0,points:[]},C[Be].count+=1,C[Be].points.push(D)}}}catch(qe){T.e(qe)}finally{T.f()}return{gridHash:C,gridOffset:x}}function ru(e,i){var r=tp(e),n=rp(i,e);return{yOffset:r,xOffset:n}}function tp(e){return e/Ef*(180/Math.PI)}function rp(e,i){return i/Ef*(180/Math.PI)/Math.cos(e*Math.PI/180)}function np(e,i,r){return Object.keys(e).reduce(function(n,a,s){var f=a.split("-"),v=parseInt(f[0],10),m=parseInt(f[1],10),x={};if(r.field&&r.method){var C=Gu(e[a].points,r.field);x[r.method]=pc[r.method](C)}return Object.assign(x,{_id:s,coordinates:Oo([-180+i.xOffset*(m+.5),-90+i.yOffset*(v+.5)]),rawData:e[a].points,count:e[a].count}),n.push(x),n},[])}var Cl=Math.PI/3,Dp=[0,Cl,2*Cl,3*Cl,4*Cl,5*Cl];function Al(e){return e[0]}function Wc(e){return e[1]}function Gh(){var e=0,i=0,r=1,n=1,a=Al,s=Wc,f,v,m;function x(T){var O={},D=[],Z,W=T.length;for(Z=0;Z<W;++Z)if(!(isNaN(ye=+a.call(null,Q=T[Z],Z,T))||isNaN(Be=+s.call(null,Q,Z,T)))){var Q,ye,Be,qe=Math.round(Be=Be/m),rt=Math.round(ye=ye/v-(qe&1)/2),_t=Be-qe;if(Math.abs(_t)*3>1){var mt=ye-rt,Ht=rt+(ye<rt?-1:1)/2,rr=qe+(Be<qe?-1:1),Cr=ye-Ht,qr=Be-rr;mt*mt+_t*_t>Cr*Cr+qr*qr&&(rt=Ht+(qe&1?1:-1)/2,qe=rr)}var gr=rt+"-"+qe,sn=O[gr];sn?sn.push(Q):(D.push(sn=O[gr]=[Q]),sn.x=(rt+(qe&1)/2)*v,sn.y=qe*m)}return D}function C(T){var O=0,D=0;return Dp.map(function(Z){var W=Math.sin(Z)*T,Q=-Math.cos(Z)*T,ye=W-O,Be=Q-D;return O=W,D=Q,[ye,Be]})}return x.hexagon=function(T){return"m"+C(T==null?f:+T).join("l")+"z"},x.centers=function(){for(var T=[],O=Math.round(i/m),D=Math.round(e/v),Z=O*m;Z<n+f;Z+=m,++O)for(var W=D*v+(O&1)*v/2;W<r+v/2;W+=v)T.push([W,Z]);return T},x.mesh=function(){var T=C(f).slice(0,4).join("l");return x.centers().map(function(O){return"M"+O+"m"+T}).join("")},x.x=function(T){return arguments.length?(a=T,x):a},x.y=function(T){return arguments.length?(s=T,x):s},x.radius=function(T){return arguments.length?(f=+T,v=f*2*Math.sin(Cl),m=f*1.5,x):f},x.size=function(T){return arguments.length?(e=i=0,r=+T[0],n=+T[1],x):[r-e,n-i]},x.extent=function(T){return arguments.length?(e=+T[0][0],i=+T[0][1],r=+T[1][0],n=+T[1][1],x):[[e,i],[r,n]]},x.radius(1)}function ip(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ah(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ip(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ip(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Md=6378e3;function Pd(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=i.method,f=s===void 0?"sum":s,v=a/(2*Math.PI*Md)*(256<<20)/2,m=r.map(function(O){var D=Oo(O.coordinates),Z=(0,nn.Z)(D,2),W=Z[0],Q=Z[1];return ah(ah({},O),{},{coordinates:[W,Q]})}),x=Gh().radius(v).x(function(O){return O.coordinates[0]}).y(function(O){return O.coordinates[1]}),C=x(m),T={dataArray:C.map(function(O,D){var Z;if(i.field&&f){var W=Gu(O,i.field);O[f]=pc[f](W)}return Z={},(0,A.Z)(Z,i.method,O[f]),(0,A.Z)(Z,"count",O.length),(0,A.Z)(Z,"rawData",O),(0,A.Z)(Z,"coordinates",[O.x,O.y]),(0,A.Z)(Z,"_id",D),Z}),radius:v,xOffset:v,yOffset:v,type:"hexagon"};return T}function _u(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function oh(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?_u(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_u(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Fp(e,i){var r=i.sourceField,n=i.targetField,a=i.data,s={};return a.forEach(function(f){s[f[r]]=f}),e.dataArray=e.dataArray.map(function(f){var v=f[n];return oh(oh({},f),s[v])}),e}function Af(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}Ne("rasterTile",$a),Ne("geojson",Xr),Ne("image",pi),Ne("csv",_n),Ne("json",Wt),Ne("raster",Wn),tt("cluster",jh),tt("filter",Lp),tt("join",Fp),tt("map",Af),tt("grid",Sf),tt("hexagon",Pd);var sl=Er,Hh=$n,sh=ep,ql=ee(28660),Nr=ee(86700),Xc=ee(84879),zt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Wh=ee(31745),uh=ee.n(Wh);function ap(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Bp(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ap(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ap(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ha(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=yc(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function yc(e,i){if(!!e){if(typeof e=="string")return Eo(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Eo(e,i)}}function Eo(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var hs=30;function Xh(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,a=e.buffer,s=e.maxCanvasWidth,f=e.mapping,v=f===void 0?{}:f,m=e.xOffset,x=m===void 0?0:m,C=e.yOffset,T=C===void 0?0:C,O=0,D=x;Array.from(i).forEach(function(W,Q){if(!v[W]){var ye=r(W,Q);D+hs>s&&(D=0,O++),v[W]={x:D,y:T+O*hs,width:hs,height:hs,advance:ye},D+=hs}});var Z=n+a*2;return{mapping:v,xOffset:D,yOffset:T+O*Z,canvasHeight:Kh(T+(O+1)*Z)}}function Yh(e,i,r){var n=0,a=0,s=0,f=[],v={},m=ha(e),x;try{for(m.s();!(x=m.n()).done;){var C=x.value;if(!v[C.id]){var T=C.size;n+T+i>r&&(qh(v,f,a),n=0,a=s+a+i,s=0,f=[]),f.push({icon:C,xOffset:n}),n=n+T+i,s=Math.max(s,T)}}}catch(D){m.e(D)}finally{m.f()}f.length>0&&qh(v,f,a);var O=Kh(s+a+i);return{mapping:v,canvasHeight:O}}function qh(e,i,r){var n=ha(i),a;try{for(n.s();!(a=n.n()).done;){var s=a.value,f=s.icon,v=s.xOffset;e[f.id]=Bp(Bp({},f),{},{x:v,y:r,image:f.image,width:f.width,height:f.height})}}catch(m){n.e(m)}finally{n.f()}}function Kh(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var $h,Np;function Qh(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Id(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function Id(e,i){if(!!e){if(typeof e=="string")return wf(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wf(e,i)}}function wf(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function lh(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function zp(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?lh(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var op=It(),Ma="sans-serif",ch="normal",Kl=24,Tf=3,fh=.25,Od=8,B=1024,ce=1,Fe=1,Rt=3,ar=null;function It(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function Kt(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function cr(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var mr=($h=(0,Nr.b2)(),$h(Np=function(){function e(){(0,st.Z)(this,e),(0,A.Z)(this,"fontAtlas",void 0),(0,A.Z)(this,"iconFontMap",void 0),(0,A.Z)(this,"iconFontGlyphs",{}),(0,A.Z)(this,"fontOptions",void 0),(0,A.Z)(this,"key",void 0),(0,A.Z)(this,"cache",new jc(Rt))}return(0,Ct.Z)(e,[{key:"scale",get:function(){return Fe}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Ma,fontWeight:ch,characterSet:op,fontSize:Kl,buffer:Tf,sdf:!0,cutoff:fh,radius:Od,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var n=this;r.forEach(function(a){n.iconFontGlyphs[a.name]=a.unicode})}},{key:"addIconFont",value:function(r,n){this.iconFontMap.set(r,n)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=zp(zp({},this.fontOptions),r),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),a=this.cache.get(this.key);if(!(a&&n.length===0)){var s=this.generateFontAtlas(this.key,n,a);this.fontAtlas=s,this.cache.set(this.key,s)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,n,a){var s=this.fontOptions,f=s.fontFamily,v=s.fontWeight,m=s.fontSize,x=s.buffer,C=s.sdf,T=s.radius,O=s.cutoff,D=s.iconfont,Z=a&&a.data;Z||(Z=oa.document.createElement("canvas"),Z.width=B);var W=Z.getContext("2d");Kt(W,f,m,v);var Q=Xh(zp({getFontWidth:function(Is){return W.measureText(Is).width},fontHeight:m*Fe,buffer:x,characterSet:n,maxCanvasWidth:B},a&&{mapping:a.mapping,xOffset:a.xOffset,yOffset:a.yOffset})),ye=Q.mapping,Be=Q.canvasHeight,qe=Q.xOffset,rt=Q.yOffset,_t=W.getImageData(0,0,Z.width,Z.height);if(Z.height=Be,W.putImageData(_t,0,0),Kt(W,f,m,v),C){var mt=new(uh())(m,x,T,O,f,v),Ht=W.getImageData(0,0,mt.size,mt.size),rr=Qh(n),Cr;try{for(rr.s();!(Cr=rr.n()).done;){var qr=Cr.value;if(D){var gr=String.fromCharCode(parseInt(qr.replace("&#x","").replace(";",""),16)),sn=mt.draw(gr);cr(sn,Ht)}else cr(mt.draw(qr),Ht);W.putImageData(Ht,ye[qr].x,ye[qr].y)}}catch(Mo){rr.e(Mo)}finally{rr.f()}}else{var Rn=Qh(n),Un;try{for(Rn.s();!(Un=Rn.n()).done;){var Ba=Un.value;W.fillText(Ba,ye[Ba].x,ye[Ba].y+m*ce)}}catch(Mo){Rn.e(Mo)}finally{Rn.f()}}return{xOffset:qe,yOffset:rt,mapping:ye,data:Z,width:Z.width,height:Z.height}}},{key:"getKey",value:function(){return"key";var r,n,a,s,f,v,m,x}},{key:"getNewChars",value:function(r,n){var a=this.cache.get(r);if(!a)return n;var s=[],f=a.mapping,v=new Set(Object.keys(f)),m=new Set(n);return m.forEach(function(x){v.has(x)||s.push(x)}),s}}]),e}())||Np),yr,Sr;function Mr(e){var i=Gr();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Gr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _r=3,br=1024,nt=64,Zt=(yr=(0,Nr.b2)(),yr(Sr=function(e){(0,wr.Z)(r,e);var i=Mr(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"canvasHeight",128),(0,A.Z)((0,ae.Z)(n),"texture",void 0),(0,A.Z)((0,ae.Z)(n),"canvas",void 0),(0,A.Z)((0,ae.Z)(n),"iconData",void 0),(0,A.Z)((0,ae.Z)(n),"iconMap",void 0),(0,A.Z)((0,ae.Z)(n),"ctx",void 0),(0,A.Z)((0,ae.Z)(n),"loadingImageCount",0),n}return(0,Ct.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=oa.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(a,s){var f=this,v=new Image;if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:nt}),this.updateIconMap(),this.loadImage(s).then(function(m){v=m;var x=f.iconData.find(function(C){return C.id===a});x&&(x.image=v,x.width=v.width,x.height=v.height),f.update()})}},{key:"addImageMini",value:function(a,s,f){var v=this,m=f.getSceneConfig().canvas,x=m.createImage();if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:nt}),this.updateIconMap(),this.loadImageMini(s,m).then(function(C){x=C;var T=v.iconData.find(function(O){return O.id===a});T&&(T.image=x,T.width=x.width,T.height=x.height),v.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(a){return this.iconMap.hasOwnProperty(a)}},{key:"removeImage",value:function(a){this.hasImage(a)&&(this.iconData=this.iconData.filter(function(s){return s.id!==a}),delete this.iconMap[a],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(a){return new Promise(function(s,f){if(a instanceof HTMLImageElement){s(a);return}var v=new Image;v.crossOrigin="anonymous",v.onload=function(){s(v)},v.onerror=function(){f(new Error("Could not load image at "+a))},v.src=a instanceof File?URL.createObjectURL(a):a})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var a=this;this.canvas.width=br,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(s){var f=a.iconMap[s],v=f.x,m=f.y,x=f.image,C=f.width,T=C===void 0?64:C,O=f.height,D=O===void 0?64:O,Z=Math.max(T,D),W=Z/nt,Q=D/W,ye=T/W;x&&a.ctx.drawImage(x,v+(nt-ye)/2,m+(nt-Q)/2,ye,Q)})}},{key:"updateIconMap",value:function(){var a=Yh(this.iconData,_r,br),s=a.mapping,f=a.canvasHeight;this.iconMap=s,this.canvasHeight=f}},{key:"loadImageMini",value:function(a,s){return new Promise(function(f,v){var m=s.createImage();m.crossOrigin="anonymous",m.onload=function(){f(m)},m.onerror=function(){v(new Error("Could not load image at "+a))},m.src=a})}}]),r}(jr.EventEmitter))||Sr),Qt=ee(49685);function Pr(){var e=new Qt.WT(16);return Qt.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function lr(e){var i=new Qt.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Rr(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function $r(e,i,r,n,a,s,f,v,m,x,C,T,O,D,Z,W){var Q=new Qt.WT(16);return Q[0]=e,Q[1]=i,Q[2]=r,Q[3]=n,Q[4]=a,Q[5]=s,Q[6]=f,Q[7]=v,Q[8]=m,Q[9]=x,Q[10]=C,Q[11]=T,Q[12]=O,Q[13]=D,Q[14]=Z,Q[15]=W,Q}function Bn(e,i,r,n,a,s,f,v,m,x,C,T,O,D,Z,W,Q){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=s,e[5]=f,e[6]=v,e[7]=m,e[8]=x,e[9]=C,e[10]=T,e[11]=O,e[12]=D,e[13]=Z,e[14]=W,e[15]=Q,e}function $t(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function er(e,i){if(e===i){var r=i[1],n=i[2],a=i[3],s=i[6],f=i[7],v=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=s,e[11]=i[14],e[12]=a,e[13]=f,e[14]=v}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function dn(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=i[4],v=i[5],m=i[6],x=i[7],C=i[8],T=i[9],O=i[10],D=i[11],Z=i[12],W=i[13],Q=i[14],ye=i[15],Be=r*v-n*f,qe=r*m-a*f,rt=r*x-s*f,_t=n*m-a*v,mt=n*x-s*v,Ht=a*x-s*m,rr=C*W-T*Z,Cr=C*Q-O*Z,qr=C*ye-D*Z,gr=T*Q-O*W,sn=T*ye-D*W,Rn=O*ye-D*Q,Un=Be*Rn-qe*sn+rt*gr+_t*qr-mt*Cr+Ht*rr;return Un?(Un=1/Un,e[0]=(v*Rn-m*sn+x*gr)*Un,e[1]=(a*sn-n*Rn-s*gr)*Un,e[2]=(W*Ht-Q*mt+ye*_t)*Un,e[3]=(O*mt-T*Ht-D*_t)*Un,e[4]=(m*qr-f*Rn-x*Cr)*Un,e[5]=(r*Rn-a*qr+s*Cr)*Un,e[6]=(Q*rt-Z*Ht-ye*qe)*Un,e[7]=(C*Ht-O*rt+D*qe)*Un,e[8]=(f*sn-v*qr+x*rr)*Un,e[9]=(n*qr-r*sn-s*rr)*Un,e[10]=(Z*mt-W*rt+ye*Be)*Un,e[11]=(T*rt-C*mt-D*Be)*Un,e[12]=(v*Cr-f*gr-m*rr)*Un,e[13]=(r*gr-n*Cr+a*rr)*Un,e[14]=(W*qe-Z*_t-Q*Be)*Un,e[15]=(C*_t-T*qe+O*Be)*Un,e):null}function Yr(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=i[4],v=i[5],m=i[6],x=i[7],C=i[8],T=i[9],O=i[10],D=i[11],Z=i[12],W=i[13],Q=i[14],ye=i[15];return e[0]=v*(O*ye-D*Q)-T*(m*ye-x*Q)+W*(m*D-x*O),e[1]=-(n*(O*ye-D*Q)-T*(a*ye-s*Q)+W*(a*D-s*O)),e[2]=n*(m*ye-x*Q)-v*(a*ye-s*Q)+W*(a*x-s*m),e[3]=-(n*(m*D-x*O)-v*(a*D-s*O)+T*(a*x-s*m)),e[4]=-(f*(O*ye-D*Q)-C*(m*ye-x*Q)+Z*(m*D-x*O)),e[5]=r*(O*ye-D*Q)-C*(a*ye-s*Q)+Z*(a*D-s*O),e[6]=-(r*(m*ye-x*Q)-f*(a*ye-s*Q)+Z*(a*x-s*m)),e[7]=r*(m*D-x*O)-f*(a*D-s*O)+C*(a*x-s*m),e[8]=f*(T*ye-D*W)-C*(v*ye-x*W)+Z*(v*D-x*T),e[9]=-(r*(T*ye-D*W)-C*(n*ye-s*W)+Z*(n*D-s*T)),e[10]=r*(v*ye-x*W)-f*(n*ye-s*W)+Z*(n*x-s*v),e[11]=-(r*(v*D-x*T)-f*(n*D-s*T)+C*(n*x-s*v)),e[12]=-(f*(T*Q-O*W)-C*(v*Q-m*W)+Z*(v*O-m*T)),e[13]=r*(T*Q-O*W)-C*(n*Q-a*W)+Z*(n*O-a*T),e[14]=-(r*(v*Q-m*W)-f*(n*Q-a*W)+Z*(n*m-a*v)),e[15]=r*(v*O-m*T)-f*(n*O-a*T)+C*(n*m-a*v),e}function xr(e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],f=e[5],v=e[6],m=e[7],x=e[8],C=e[9],T=e[10],O=e[11],D=e[12],Z=e[13],W=e[14],Q=e[15],ye=i*f-r*s,Be=i*v-n*s,qe=i*m-a*s,rt=r*v-n*f,_t=r*m-a*f,mt=n*m-a*v,Ht=x*Z-C*D,rr=x*W-T*D,Cr=x*Q-O*D,qr=C*W-T*Z,gr=C*Q-O*Z,sn=T*Q-O*W;return ye*sn-Be*gr+qe*qr+rt*Cr-_t*rr+mt*Ht}function Fr(e,i,r){var n=i[0],a=i[1],s=i[2],f=i[3],v=i[4],m=i[5],x=i[6],C=i[7],T=i[8],O=i[9],D=i[10],Z=i[11],W=i[12],Q=i[13],ye=i[14],Be=i[15],qe=r[0],rt=r[1],_t=r[2],mt=r[3];return e[0]=qe*n+rt*v+_t*T+mt*W,e[1]=qe*a+rt*m+_t*O+mt*Q,e[2]=qe*s+rt*x+_t*D+mt*ye,e[3]=qe*f+rt*C+_t*Z+mt*Be,qe=r[4],rt=r[5],_t=r[6],mt=r[7],e[4]=qe*n+rt*v+_t*T+mt*W,e[5]=qe*a+rt*m+_t*O+mt*Q,e[6]=qe*s+rt*x+_t*D+mt*ye,e[7]=qe*f+rt*C+_t*Z+mt*Be,qe=r[8],rt=r[9],_t=r[10],mt=r[11],e[8]=qe*n+rt*v+_t*T+mt*W,e[9]=qe*a+rt*m+_t*O+mt*Q,e[10]=qe*s+rt*x+_t*D+mt*ye,e[11]=qe*f+rt*C+_t*Z+mt*Be,qe=r[12],rt=r[13],_t=r[14],mt=r[15],e[12]=qe*n+rt*v+_t*T+mt*W,e[13]=qe*a+rt*m+_t*O+mt*Q,e[14]=qe*s+rt*x+_t*D+mt*ye,e[15]=qe*f+rt*C+_t*Z+mt*Be,e}function Hr(e,i,r){var n=r[0],a=r[1],s=r[2],f,v,m,x,C,T,O,D,Z,W,Q,ye;return i===e?(e[12]=i[0]*n+i[4]*a+i[8]*s+i[12],e[13]=i[1]*n+i[5]*a+i[9]*s+i[13],e[14]=i[2]*n+i[6]*a+i[10]*s+i[14],e[15]=i[3]*n+i[7]*a+i[11]*s+i[15]):(f=i[0],v=i[1],m=i[2],x=i[3],C=i[4],T=i[5],O=i[6],D=i[7],Z=i[8],W=i[9],Q=i[10],ye=i[11],e[0]=f,e[1]=v,e[2]=m,e[3]=x,e[4]=C,e[5]=T,e[6]=O,e[7]=D,e[8]=Z,e[9]=W,e[10]=Q,e[11]=ye,e[12]=f*n+C*a+Z*s+i[12],e[13]=v*n+T*a+W*s+i[13],e[14]=m*n+O*a+Q*s+i[14],e[15]=x*n+D*a+ye*s+i[15]),e}function si(e,i,r){var n=r[0],a=r[1],s=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*a,e[5]=i[5]*a,e[6]=i[6]*a,e[7]=i[7]*a,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=i[11]*s,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function ni(e,i,r,n){var a=n[0],s=n[1],f=n[2],v=Math.hypot(a,s,f),m,x,C,T,O,D,Z,W,Q,ye,Be,qe,rt,_t,mt,Ht,rr,Cr,qr,gr,sn,Rn,Un,Ba;return v<Qt.Ib?null:(v=1/v,a*=v,s*=v,f*=v,m=Math.sin(r),x=Math.cos(r),C=1-x,T=i[0],O=i[1],D=i[2],Z=i[3],W=i[4],Q=i[5],ye=i[6],Be=i[7],qe=i[8],rt=i[9],_t=i[10],mt=i[11],Ht=a*a*C+x,rr=s*a*C+f*m,Cr=f*a*C-s*m,qr=a*s*C-f*m,gr=s*s*C+x,sn=f*s*C+a*m,Rn=a*f*C+s*m,Un=s*f*C-a*m,Ba=f*f*C+x,e[0]=T*Ht+W*rr+qe*Cr,e[1]=O*Ht+Q*rr+rt*Cr,e[2]=D*Ht+ye*rr+_t*Cr,e[3]=Z*Ht+Be*rr+mt*Cr,e[4]=T*qr+W*gr+qe*sn,e[5]=O*qr+Q*gr+rt*sn,e[6]=D*qr+ye*gr+_t*sn,e[7]=Z*qr+Be*gr+mt*sn,e[8]=T*Rn+W*Un+qe*Ba,e[9]=O*Rn+Q*Un+rt*Ba,e[10]=D*Rn+ye*Un+_t*Ba,e[11]=Z*Rn+Be*Un+mt*Ba,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function Vr(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[4],f=i[5],v=i[6],m=i[7],x=i[8],C=i[9],T=i[10],O=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=s*a+x*n,e[5]=f*a+C*n,e[6]=v*a+T*n,e[7]=m*a+O*n,e[8]=x*a-s*n,e[9]=C*a-f*n,e[10]=T*a-v*n,e[11]=O*a-m*n,e}function Jr(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],f=i[1],v=i[2],m=i[3],x=i[8],C=i[9],T=i[10],O=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a-x*n,e[1]=f*a-C*n,e[2]=v*a-T*n,e[3]=m*a-O*n,e[8]=s*n+x*a,e[9]=f*n+C*a,e[10]=v*n+T*a,e[11]=m*n+O*a,e}function Yn(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],f=i[1],v=i[2],m=i[3],x=i[4],C=i[5],T=i[6],O=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a+x*n,e[1]=f*a+C*n,e[2]=v*a+T*n,e[3]=m*a+O*n,e[4]=x*a-s*n,e[5]=C*a-f*n,e[6]=T*a-v*n,e[7]=O*a-m*n,e}function ui(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function Ni(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function io(e,i,r){var n=r[0],a=r[1],s=r[2],f=Math.hypot(n,a,s),v,m,x;return f<Qt.Ib?null:(f=1/f,n*=f,a*=f,s*=f,v=Math.sin(i),m=Math.cos(i),x=1-m,e[0]=n*n*x+m,e[1]=a*n*x+s*v,e[2]=s*n*x-a*v,e[3]=0,e[4]=n*a*x-s*v,e[5]=a*a*x+m,e[6]=s*a*x+n*v,e[7]=0,e[8]=n*s*x+a*v,e[9]=a*s*x-n*v,e[10]=s*s*x+m,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function co(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ki(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function as(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ga(e,i,r){var n=i[0],a=i[1],s=i[2],f=i[3],v=n+n,m=a+a,x=s+s,C=n*v,T=n*m,O=n*x,D=a*m,Z=a*x,W=s*x,Q=f*v,ye=f*m,Be=f*x;return e[0]=1-(D+W),e[1]=T+Be,e[2]=O-ye,e[3]=0,e[4]=T-Be,e[5]=1-(C+W),e[6]=Z+Q,e[7]=0,e[8]=O+ye,e[9]=Z-Q,e[10]=1-(C+D),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function qo(e,i){var r=new Qt.WT(3),n=-i[0],a=-i[1],s=-i[2],f=i[3],v=i[4],m=i[5],x=i[6],C=i[7],T=n*n+a*a+s*s+f*f;return T>0?(r[0]=(v*f+C*n+m*s-x*a)*2/T,r[1]=(m*f+C*a+x*n-v*s)*2/T,r[2]=(x*f+C*s+v*a-m*n)*2/T):(r[0]=(v*f+C*n+m*s-x*a)*2,r[1]=(m*f+C*a+x*n-v*s)*2,r[2]=(x*f+C*s+v*a-m*n)*2),Ga(e,i,r),e}function So(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function Zo(e,i){var r=i[0],n=i[1],a=i[2],s=i[4],f=i[5],v=i[6],m=i[8],x=i[9],C=i[10];return e[0]=Math.hypot(r,n,a),e[1]=Math.hypot(s,f,v),e[2]=Math.hypot(m,x,C),e}function jo(e,i){var r=new Qt.WT(3);Zo(r,i);var n=1/r[0],a=1/r[1],s=1/r[2],f=i[0]*n,v=i[1]*a,m=i[2]*s,x=i[4]*n,C=i[5]*a,T=i[6]*s,O=i[8]*n,D=i[9]*a,Z=i[10]*s,W=f+C+Z,Q=0;return W>0?(Q=Math.sqrt(W+1)*2,e[3]=.25*Q,e[0]=(T-D)/Q,e[1]=(O-m)/Q,e[2]=(v-x)/Q):f>C&&f>Z?(Q=Math.sqrt(1+f-C-Z)*2,e[3]=(T-D)/Q,e[0]=.25*Q,e[1]=(v+x)/Q,e[2]=(O+m)/Q):C>Z?(Q=Math.sqrt(1+C-f-Z)*2,e[3]=(O-m)/Q,e[0]=(v+x)/Q,e[1]=.25*Q,e[2]=(T+D)/Q):(Q=Math.sqrt(1+Z-f-C)*2,e[3]=(v-x)/Q,e[0]=(O+m)/Q,e[1]=(T+D)/Q,e[2]=.25*Q),e}function ds(e,i,r,n){var a=i[0],s=i[1],f=i[2],v=i[3],m=a+a,x=s+s,C=f+f,T=a*m,O=a*x,D=a*C,Z=s*x,W=s*C,Q=f*C,ye=v*m,Be=v*x,qe=v*C,rt=n[0],_t=n[1],mt=n[2];return e[0]=(1-(Z+Q))*rt,e[1]=(O+qe)*rt,e[2]=(D-Be)*rt,e[3]=0,e[4]=(O-qe)*_t,e[5]=(1-(T+Q))*_t,e[6]=(W+ye)*_t,e[7]=0,e[8]=(D+Be)*mt,e[9]=(W-ye)*mt,e[10]=(1-(T+Z))*mt,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function fo(e,i,r,n,a){var s=i[0],f=i[1],v=i[2],m=i[3],x=s+s,C=f+f,T=v+v,O=s*x,D=s*C,Z=s*T,W=f*C,Q=f*T,ye=v*T,Be=m*x,qe=m*C,rt=m*T,_t=n[0],mt=n[1],Ht=n[2],rr=a[0],Cr=a[1],qr=a[2],gr=(1-(W+ye))*_t,sn=(D+rt)*_t,Rn=(Z-qe)*_t,Un=(D-rt)*mt,Ba=(1-(O+ye))*mt,Mo=(Q+Be)*mt,Is=(Z+qe)*Ht,iu=(Q-Be)*Ht,Ns=(1-(O+W))*Ht;return e[0]=gr,e[1]=sn,e[2]=Rn,e[3]=0,e[4]=Un,e[5]=Ba,e[6]=Mo,e[7]=0,e[8]=Is,e[9]=iu,e[10]=Ns,e[11]=0,e[12]=r[0]+rr-(gr*rr+Un*Cr+Is*qr),e[13]=r[1]+Cr-(sn*rr+Ba*Cr+iu*qr),e[14]=r[2]+qr-(Rn*rr+Mo*Cr+Ns*qr),e[15]=1,e}function xi(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=r+r,v=n+n,m=a+a,x=r*f,C=n*f,T=n*v,O=a*f,D=a*v,Z=a*m,W=s*f,Q=s*v,ye=s*m;return e[0]=1-T-Z,e[1]=C+ye,e[2]=O-Q,e[3]=0,e[4]=C-ye,e[5]=1-x-Z,e[6]=D+W,e[7]=0,e[8]=O+Q,e[9]=D-W,e[10]=1-x-T,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Vo(e,i,r,n,a,s,f){var v=1/(r-i),m=1/(a-n),x=1/(s-f);return e[0]=s*2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*m,e[6]=0,e[7]=0,e[8]=(r+i)*v,e[9]=(a+n)*m,e[10]=(f+s)*x,e[11]=-1,e[12]=0,e[13]=0,e[14]=f*s*2*x,e[15]=0,e}function Ki(e,i,r,n,a){var s=1/Math.tan(i/2),f;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(f=1/(n-a),e[10]=(a+n)*f,e[14]=2*a*n*f):(e[10]=-1,e[14]=-2*n),e}var Ko=Ki;function ei(e,i,r,n,a){var s=1/Math.tan(i/2),f;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(f=1/(n-a),e[10]=a*f,e[14]=a*n*f):(e[10]=-1,e[14]=-n),e}function Di(e,i,r,n){var a=Math.tan(i.upDegrees*Math.PI/180),s=Math.tan(i.downDegrees*Math.PI/180),f=Math.tan(i.leftDegrees*Math.PI/180),v=Math.tan(i.rightDegrees*Math.PI/180),m=2/(f+v),x=2/(a+s);return e[0]=m,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=-((f-v)*m*.5),e[9]=(a-s)*x*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function la(e,i,r,n,a,s,f){var v=1/(i-r),m=1/(n-a),x=1/(s-f);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*m,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*m,e[14]=(f+s)*x,e[15]=1,e}var Co=la;function wl(e,i,r,n,a,s,f){var v=1/(i-r),m=1/(n-a),x=1/(s-f);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*m,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*m,e[14]=s*x,e[15]=1,e}function Ae(e,i,r,n){var a,s,f,v,m,x,C,T,O,D,Z=i[0],W=i[1],Q=i[2],ye=n[0],Be=n[1],qe=n[2],rt=r[0],_t=r[1],mt=r[2];return Math.abs(Z-rt)<Qt.Ib&&Math.abs(W-_t)<Qt.Ib&&Math.abs(Q-mt)<Qt.Ib?$t(e):(C=Z-rt,T=W-_t,O=Q-mt,D=1/Math.hypot(C,T,O),C*=D,T*=D,O*=D,a=Be*O-qe*T,s=qe*C-ye*O,f=ye*T-Be*C,D=Math.hypot(a,s,f),D?(D=1/D,a*=D,s*=D,f*=D):(a=0,s=0,f=0),v=T*f-O*s,m=O*a-C*f,x=C*s-T*a,D=Math.hypot(v,m,x),D?(D=1/D,v*=D,m*=D,x*=D):(v=0,m=0,x=0),e[0]=a,e[1]=v,e[2]=C,e[3]=0,e[4]=s,e[5]=m,e[6]=T,e[7]=0,e[8]=f,e[9]=x,e[10]=O,e[11]=0,e[12]=-(a*Z+s*W+f*Q),e[13]=-(v*Z+m*W+x*Q),e[14]=-(C*Z+T*W+O*Q),e[15]=1,e)}function Dt(e,i,r,n){var a=i[0],s=i[1],f=i[2],v=n[0],m=n[1],x=n[2],C=a-r[0],T=s-r[1],O=f-r[2],D=C*C+T*T+O*O;D>0&&(D=1/Math.sqrt(D),C*=D,T*=D,O*=D);var Z=m*O-x*T,W=x*C-v*O,Q=v*T-m*C;return D=Z*Z+W*W+Q*Q,D>0&&(D=1/Math.sqrt(D),Z*=D,W*=D,Q*=D),e[0]=Z,e[1]=W,e[2]=Q,e[3]=0,e[4]=T*Q-O*W,e[5]=O*Z-C*Q,e[6]=C*W-T*Z,e[7]=0,e[8]=C,e[9]=T,e[10]=O,e[11]=0,e[12]=a,e[13]=s,e[14]=f,e[15]=1,e}function xt(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function vn(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function zi(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function be(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function ne(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function Ze(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function ot(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function Tt(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],f=e[4],v=e[5],m=e[6],x=e[7],C=e[8],T=e[9],O=e[10],D=e[11],Z=e[12],W=e[13],Q=e[14],ye=e[15],Be=i[0],qe=i[1],rt=i[2],_t=i[3],mt=i[4],Ht=i[5],rr=i[6],Cr=i[7],qr=i[8],gr=i[9],sn=i[10],Rn=i[11],Un=i[12],Ba=i[13],Mo=i[14],Is=i[15];return Math.abs(r-Be)<=Qt.Ib*Math.max(1,Math.abs(r),Math.abs(Be))&&Math.abs(n-qe)<=Qt.Ib*Math.max(1,Math.abs(n),Math.abs(qe))&&Math.abs(a-rt)<=Qt.Ib*Math.max(1,Math.abs(a),Math.abs(rt))&&Math.abs(s-_t)<=Qt.Ib*Math.max(1,Math.abs(s),Math.abs(_t))&&Math.abs(f-mt)<=Qt.Ib*Math.max(1,Math.abs(f),Math.abs(mt))&&Math.abs(v-Ht)<=Qt.Ib*Math.max(1,Math.abs(v),Math.abs(Ht))&&Math.abs(m-rr)<=Qt.Ib*Math.max(1,Math.abs(m),Math.abs(rr))&&Math.abs(x-Cr)<=Qt.Ib*Math.max(1,Math.abs(x),Math.abs(Cr))&&Math.abs(C-qr)<=Qt.Ib*Math.max(1,Math.abs(C),Math.abs(qr))&&Math.abs(T-gr)<=Qt.Ib*Math.max(1,Math.abs(T),Math.abs(gr))&&Math.abs(O-sn)<=Qt.Ib*Math.max(1,Math.abs(O),Math.abs(sn))&&Math.abs(D-Rn)<=Qt.Ib*Math.max(1,Math.abs(D),Math.abs(Rn))&&Math.abs(Z-Un)<=Qt.Ib*Math.max(1,Math.abs(Z),Math.abs(Un))&&Math.abs(W-Ba)<=Qt.Ib*Math.max(1,Math.abs(W),Math.abs(Ba))&&Math.abs(Q-Mo)<=Qt.Ib*Math.max(1,Math.abs(Q),Math.abs(Mo))&&Math.abs(ye-Is)<=Qt.Ib*Math.max(1,Math.abs(ye),Math.abs(Is))}var Ye=Fr,De=be,Je,ve,Ue=(Je=(0,Nr.b2)(),Je(ve=function(){function e(){(0,st.Z)(this,e),(0,A.Z)(this,"viewport",void 0),(0,A.Z)(this,"overridedViewProjectionMatrix",void 0),(0,A.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,A.Z)(this,"jitteredProjectionMatrix",void 0),(0,A.Z)(this,"viewMatrixInverse",void 0),(0,A.Z)(this,"cameraPosition",void 0)}return(0,Ct.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=Pr(),dn(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,nn.Z)(r,2),a=n[0],s=n[1];return[a,s]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var a=ui(Pr(),[r,n,0]);this.jitteredProjectionMatrix=Fr(Pr(),a,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Fr(Pr(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||ve),Ee,at;function bt(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=fr(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function fr(e,i){if(!!e){if(typeof e=="string")return zr(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zr(e,i)}}function zr(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Zr=(Ee=(0,Nr.b2)(),Ee(at=function(){function e(){(0,st.Z)(this,e),(0,A.Z)(this,"container",void 0),(0,A.Z)(this,"controlCorners",void 0),(0,A.Z)(this,"controlContainer",void 0),(0,A.Z)(this,"scene",void 0),(0,A.Z)(this,"mapsService",void 0),(0,A.Z)(this,"controls",[]),(0,A.Z)(this,"unAddControls",[])}return(0,Ct.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(zt.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var a=n.get(zt.IMapService);a.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=bt(this.controls),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;a.remove()}}catch(s){r.e(s)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",a=this.controlContainer=Za("div",n+"control-container",this.container);function s(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],v=f.map(function(m){return n+m}).join(" ");r[f.join("")]=Za("div",v,a)}s(["top","left"]),s(["top","right"]),s(["bottom","left"]),s(["bottom","right"]),s(["top","center"]),s(["right","center"]),s(["left","center"]),s(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&cc(this.controlCorners[r]);this.controlContainer&&cc(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||at),en,kr,Cn=(en=(0,Nr.b2)(),en(kr=function(){function e(){(0,st.Z)(this,e),(0,A.Z)(this,"container",void 0),(0,A.Z)(this,"scene",void 0),(0,A.Z)(this,"mapsService",void 0),(0,A.Z)(this,"markers",[]),(0,A.Z)(this,"markerLayers",[]),(0,A.Z)(this,"unAddMarkers",[]),(0,A.Z)(this,"unAddMarkerLayers",[])}return(0,Ct.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(zt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||kr),ln,xn,bn=(ln=(0,Nr.b2)(),ln(xn=function(){function e(){(0,st.Z)(this,e),(0,A.Z)(this,"scene",void 0),(0,A.Z)(this,"popup",void 0),(0,A.Z)(this,"mapsService",void 0),(0,A.Z)(this,"unAddPopup",void 0)}return(0,Ct.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(zt.IMapService)}}]),e}())||xn),mn=ee(82492),qn=ee.n(mn),_a={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},os=_a,Pa,ca;function ul(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function vs(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ul(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ul(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var ll={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Lu={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},ph=(Pa=(0,Nr.b2)(),Pa(ca=function(){function e(){(0,st.Z)(this,e),(0,A.Z)(this,"sceneConfigCache",{}),(0,A.Z)(this,"layerConfigCache",{})}return(0,Ct.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return os[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=vs(vs({},ll),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,a){this.layerConfigCache[n]=vs({},qn()({},this.sceneConfigCache[r],Lu,a))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||ca);function ti(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function ci(e,i,r,n,a){var s={};return Object.keys(n).forEach(function(f){s[f]=n[f]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=r.slice().reverse().reduce(function(f,v){return v(e,i,f)||f},s),a&&s.initializer!==void 0&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),s.initializer===void 0&&(Object.defineProperty(e,i,s),s=null),s}function Mf(){var e=new Qt.WT(4);return Qt.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function g0(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function $o(e,i,r,n){var a=new Qt.WT(4);return a[0]=e,a[1]=i,a[2]=r,a[3]=n,a}function Jh(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function Pf(e,i,r,n,a){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e}function Rd(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function Ld(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function yv(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function hh(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function If(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function y0(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function _0(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function gm(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function ws(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function Of(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function x0(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function t(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return Math.hypot(r,n,a,s)}function o(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return r*r+n*n+a*a+s*s}function u(e){var i=e[0],r=e[1],n=e[2],a=e[3];return Math.hypot(i,r,n,a)}function h(e){var i=e[0],r=e[1],n=e[2],a=e[3];return i*i+r*r+n*n+a*a}function y(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function b(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function S(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],f=r*r+n*n+a*a+s*s;return f>0&&(f=1/Math.sqrt(f)),e[0]=r*f,e[1]=n*f,e[2]=a*f,e[3]=s*f,e}function I(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function k(e,i,r,n){var a=r[0]*n[1]-r[1]*n[0],s=r[0]*n[2]-r[2]*n[0],f=r[0]*n[3]-r[3]*n[0],v=r[1]*n[2]-r[2]*n[1],m=r[1]*n[3]-r[3]*n[1],x=r[2]*n[3]-r[3]*n[2],C=i[0],T=i[1],O=i[2],D=i[3];return e[0]=T*x-O*m+D*v,e[1]=-(C*x)+O*f-D*s,e[2]=C*m-T*f+D*a,e[3]=-(C*v)+T*s-O*a,e}function N(e,i,r,n){var a=i[0],s=i[1],f=i[2],v=i[3];return e[0]=a+n*(r[0]-a),e[1]=s+n*(r[1]-s),e[2]=f+n*(r[2]-f),e[3]=v+n*(r[3]-v),e}function U(e,i){i=i||1;var r,n,a,s,f,v;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,f=r*r+n*n;while(f>=1);do a=glMatrix.RANDOM()*2-1,s=glMatrix.RANDOM()*2-1,v=a*a+s*s;while(v>=1);var m=Math.sqrt((1-f)/v);return e[0]=i*r,e[1]=i*n,e[2]=i*a*m,e[3]=i*s*m,e}function G(e,i,r){var n=i[0],a=i[1],s=i[2],f=i[3];return e[0]=r[0]*n+r[4]*a+r[8]*s+r[12]*f,e[1]=r[1]*n+r[5]*a+r[9]*s+r[13]*f,e[2]=r[2]*n+r[6]*a+r[10]*s+r[14]*f,e[3]=r[3]*n+r[7]*a+r[11]*s+r[15]*f,e}function $(e,i,r){var n=i[0],a=i[1],s=i[2],f=r[0],v=r[1],m=r[2],x=r[3],C=x*n+v*s-m*a,T=x*a+m*n-f*s,O=x*s+f*a-v*n,D=-f*n-v*a-m*s;return e[0]=C*x+D*-f+T*-m-O*-v,e[1]=T*x+D*-v+O*-f-C*-m,e[2]=O*x+D*-m+C*-v-T*-f,e[3]=i[3],e}function re(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Te(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Ie(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function We(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],f=i[0],v=i[1],m=i[2],x=i[3];return Math.abs(r-f)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(a-m)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(s-x)<=glMatrix.EPSILON*Math.max(1,Math.abs(s),Math.abs(x))}var ze=null,it=null,Et=null,Ut=null,Gt=null,or=null,Ir=null,Qr=function(){var e=Mf();return function(i,r,n,a,s,f){var v,m;for(r||(r=4),n||(n=0),a?m=Math.min(a*r+n,i.length):m=i.length,v=n;v<m;v+=r)e[0]=i[v],e[1]=i[v+1],e[2]=i[v+2],e[3]=i[v+3],s(e,e,f),i[v]=e[0],i[v+1]=e[1],i[v+2]=e[2],i[v+3]=e[3];return i}}(),kn=Math.PI/180,pn=512,zn=4003e4;function hn(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,a=n===void 0?0:n,s=e.scale,f=e.highPrecision,v=f===void 0?!1:f,m=e.flipY,x=m===void 0?!1:m;s=s!==void 0?s:Math.pow(2,a);var C={},T=pn*s,O=Math.cos(r*kn),D=T/360,Z=D/O,W=T/zn/O;if(C.pixelsPerMeter=[W,-W,W],C.metersPerPixel=[1/W,-1/W,1/W],C.pixelsPerDegree=[D,-Z,W],C.degreesPerPixel=[1/D,-1/Z,1/W],v){var Q=kn*Math.tan(r*kn)/O,ye=D*Q/2,Be=T/zn*Q,qe=Be/Z*W;C.pixelsPerDegree2=[0,-ye,Be],C.pixelsPerMeter2=[qe,0,qe],x&&(C.pixelsPerDegree2[1]=-C.pixelsPerDegree2[1],C.pixelsPerMeter2[1]=-C.pixelsPerMeter2[1])}return x&&(C.pixelsPerMeter[1]=-C.pixelsPerMeter[1],C.metersPerPixel[1]=-C.metersPerPixel[1],C.pixelsPerDegree[1]=-C.pixelsPerDegree[1],C.degreesPerPixel[1]=-C.degreesPerPixel[1]),C}var hi;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(hi||(hi={}));var Vn={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Mn,Fi,Si,Yi,jn,da=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],ao=(Mn=(0,Nr.b2)(),Fi=(0,Nr.f3)(zt.ICameraService),Mn(Si=(Yi=function(){function e(){(0,st.Z)(this,e),(0,A.Z)(this,"needRefresh",!0),ti(this,"cameraService",jn,this),(0,A.Z)(this,"coordinateSystem",void 0),(0,A.Z)(this,"viewportCenter",void 0),(0,A.Z)(this,"viewportCenterProjection",void 0),(0,A.Z)(this,"pixelsPerDegree",void 0),(0,A.Z)(this,"pixelsPerDegree2",void 0),(0,A.Z)(this,"pixelsPerMeter",void 0)}return(0,Ct.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),a=this.cameraService.getCenter(),s=hn({latitude:a[1],zoom:r}),f=s.pixelsPerMeter,v=s.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=f,this.pixelsPerDegree=v,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===hi.LNGLAT||this.coordinateSystem===hi.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===hi.LNGLAT_OFFSET?this.calculateLnglatOffset(a,r):this.coordinateSystem===hi.P20_OFFSET&&this.calculateLnglatOffset(a,r,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,a,s){var f=hn({latitude:r[1],zoom:n,scale:a,flipY:s,highPrecision:!0}),v=f.pixelsPerMeter,m=f.pixelsPerDegree,x=f.pixelsPerDegree2,C=this.cameraService.getViewMatrix(),T=this.cameraService.getProjectionMatrix(),O=Fr([],T,C),D=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=G([],[D[0],D[1],0,1],O),C=this.cameraService.getViewMatrixUncentered()||C,O=Fr([],T,C),O=Fr([],O,da),this.cameraService.setViewProjectionMatrix(O),this.pixelsPerMeter=v,this.pixelsPerDegree=m,this.pixelsPerDegree2=x}}]),e}(),jn=ci(Yi.prototype,"cameraService",[Fi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yi))||Si),Ao=ee(20396),Ha=ee.n(Ao),Hi;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(Hi||(Hi={}));var _o,Qo,Jo,Ts,ss;function Ws(e){var i=Lo();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Lo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ms={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},Wi=(_o=(0,Nr.b2)(),Qo=(0,Nr.f3)(zt.IMapService),_o(Jo=(Ts=function(e){(0,wr.Z)(r,e);var i=Ws(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"indragging",!1),ti((0,ae.Z)(n),"mapService",ss,(0,ae.Z)(n)),(0,A.Z)((0,ae.Z)(n),"hammertime",void 0),(0,A.Z)((0,ae.Z)(n),"lastClickTime",0),(0,A.Z)((0,ae.Z)(n),"lastClickXY",[-1,-1]),(0,A.Z)((0,ae.Z)(n),"clickTimer",void 0),(0,A.Z)((0,ae.Z)(n),"$containter",void 0),(0,A.Z)((0,ae.Z)(n),"onDrag",function(v){var m=n.interactionEvent(v);m.type=ms[m.type],m.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(Hi.Drag,m)}),(0,A.Z)((0,ae.Z)(n),"onHammer",function(v){v.srcEvent.stopPropagation();var m=n.interactionEvent(v);n.emit(Hi.Hover,m)}),(0,A.Z)((0,ae.Z)(n),"onTouch",function(v){var m=v.touches[0];n.onHover({x:m.pageX,y:m.pageY,type:"touch"})}),(0,A.Z)((0,ae.Z)(n),"onHover",function(v){var m=v.clientX,x=v.clientY,C=m,T=x,O=v.type,D=n.mapService.getMapContainer();if(D)if(qi)C=C-D.left-0,T=T-D.top-0;else{var Z=D.getBoundingClientRect(),W=Z.top,Q=Z.left;C=C-Q-D.clientLeft,T=T-W-D.clientTop}var ye=n.mapService.containerToLngLat([C,T]);if(O==="click"){if(!qi&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(C,T,ye);return}if(O==="touch"){n.isDoubleTap(C,T,ye);return}O!=="click"&&O!=="dblclick"&&n.emit(Hi.Hover,{x:C,y:T,lngLat:ye,type:O,target:v})}),n}return(0,Ct.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Hi.Hover)}},{key:"triggerHover",value:function(a){var s=a.x,f=a.y;this.emit(Hi.Hover,{x:s,y:f})}},{key:"triggerSelect",value:function(a){this.emit(Hi.Select,{featureId:a})}},{key:"triggerActive",value:function(a){this.emit(Hi.Active,{featureId:a})}},{key:"handleMiniEvent",value:function(a){this.onHover({clientX:a.touches[0].pageX,clientY:a.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var a=this.mapService.getMapContainer();if(a)if(qi)oa.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var s=new(Ha()).Manager(a);s.add(new(Ha()).Tap({event:"dblclick",taps:2})),s.add(new(Ha()).Tap({event:"click"})),s.add(new(Ha()).Pan({threshold:0,pointers:0})),s.add(new(Ha()).Press({})),s.on("dblclick click",this.onHammer),s.on("panstart panmove panend pancancel",this.onDrag),a.addEventListener("mousemove",this.onHover),a.addEventListener("mousedown",this.onHover,!0),a.addEventListener("mouseup",this.onHover),a.addEventListener("contextmenu",this.onHover),this.hammertime=s}}},{key:"removeEventListenerOnMap",value:function(){if(qi)oa.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var a=this.mapService.getMapContainer();a&&(a.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),a.removeEventListener("mousedown",this.onHover),a.removeEventListener("mouseup",this.onHover),a.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(a){var s=a.type,f=a.pointerType,v,m;f==="touch"?(m=Math.floor(a.pointers[0].clientY),v=Math.floor(a.pointers[0].clientX)):(m=Math.floor(a.srcEvent.y),v=Math.floor(a.srcEvent.x));var x=this.mapService.getMapContainer();if(x){var C=x.getBoundingClientRect(),T=C.top,O=C.left;v-=O,m-=T}var D=this.mapService.containerToLngLat([v,m]);return{x:v,y:m,lngLat:D,type:s,target:a.srcEvent}}},{key:"isDoubleTap",value:function(a,s,f){var v=this,m=new Date().getTime(),x="click";m-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-a)<10&&Math.abs(this.lastClickXY[1]-s)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),x="dblclick",this.emit(Hi.Hover,{x:a,y:s,lngLat:f,type:x})):(this.lastClickTime=m,this.lastClickXY=[a,s],this.clickTimer=setTimeout(function(){x="click",v.emit(Hi.Hover,{x:a,y:s,lngLat:f,type:x})},400))}}]),r}(Fn()),ss=ci(Ts.prototype,"mapService",[Qo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ts))||Jo),Fa=0;function Sa(e){if(qi)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(Fa++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function ia(e){var i,r,n=!0;return e==null||(i=e.target)===null||i===void 0||(r=i.path)===null||r===void 0||r.map(function(a){if(a!=null&&a.classList){var s;a==null||(s=a.classList)===null||s===void 0||s.forEach(function(f){(f==="l7-marker"||f==="l7-popup")&&(n=!1)})}}),n}var j;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(j||(j={}));var Ms,Wa,ko,Ps,fa,$l,ku,xu,wo,Ql,cl,sp,Rf;function up(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Tl(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?up(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):up(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Up=(Ms=(0,Nr.b2)(),Wa=(0,Nr.f3)(zt.IMapService),ko=(0,Nr.f3)(zt.IRendererService),Ps=(0,Nr.f3)(zt.IGlobalConfigService),fa=(0,Nr.f3)(zt.IInteractionService),$l=(0,Nr.f3)(zt.ILayerService),Ms(ku=(xu=function(){function e(){var i=this;(0,st.Z)(this,e),ti(this,"mapService",wo,this),ti(this,"rendererService",Ql,this),ti(this,"configService",cl,this),ti(this,"interactionService",sp,this),ti(this,"layerService",Rf,this),(0,A.Z)(this,"pickingFBO",void 0),(0,A.Z)(this,"width",0),(0,A.Z)(this,"height",0),(0,A.Z)(this,"alreadyInPicking",!1),(0,A.Z)(this,"pickBufferScale",1),(0,A.Z)(this,"lastPickTime",new Date().getTime()),(0,A.Z)(this,"pickedLayers",[]),(0,A.Z)(this,"pickFromPickingFBO",function(r,n){var a,s=n.x,f=n.y,v=n.lngLat,m=n.type,x=n.target,C=!1,T=i.rendererService,O=T.getViewportSize,D=T.readPixels,Z=T.getContainer,W=i.getContainerSize(Z()),Q=W.width,ye=W.height;Q*=La,ye*=La;var Be=r.getLayerConfig(),qe=Be.enableHighlight,rt=Be.enableSelect,_t=s*La,mt=f*La;if(_t>Q-1*La||_t<0||mt>ye-1*La||mt<0)return!1;var Ht;if(Ht=D({x:Math.floor(_t/i.pickBufferScale),y:Math.floor((ye-(f+1)*La)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),Ht[0]!==0||Ht[1]!==0||Ht[2]!==0){var rr=bl(Ht),Cr=r.getSource().getFeatureById(rr);rr!==r.getCurrentPickId()&&m==="mousemove"&&(m="mouseenter");var qr={x:s,y:f,type:m,lngLat:v,featureId:rr,feature:Cr,target:x};Cr&&(C=!0,r.setCurrentPickId(rr),i.pickedLayers=[r],i.triggerHoverOnLayer(r,qr))}else{var gr={x:s,y:f,lngLat:v,type:r.getCurrentPickId()!==null&&m==="mousemove"?"mouseout":"un"+m,featureId:null,target:x,feature:null};i.triggerHoverOnLayer(r,Tl(Tl({},gr),{},{type:"unpick"})),i.triggerHoverOnLayer(r,gr),r.setCurrentPickId(null),i.pickedLayers=[]}if(qe&&i.highlightPickedFeature(r,Ht),rt&&m==="click"&&((a=Ht)===null||a===void 0?void 0:a.toString())!==[0,0,0,0].toString()){var sn=bl(Ht);r.getCurrentSelectedId()===null||sn!==r.getCurrentSelectedId()?(i.selectFeature(r,Ht),r.setCurrentSelectedId(sn)):(i.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return C})}return(0,Ct.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,a=n.createTexture2D,s=n.createFramebuffer,f=n.getViewportSize,v=n.getContainer,m=this.getContainerSize(v()),x=m.width,C=m.height;x*=La,C*=La,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=s({color:a({width:Math.round(x/this.pickBufferScale),height:Math.round(C/this.pickBufferScale),wrapS:j.CLAMP_TO_EDGE,wrapT:j.CLAMP_TO_EDGE})}),this.interactionService.on(Hi.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,d.Z)(w().mark(function n(a,s,f){var v=this,m,x,C,T;return w().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:m=this.rendererService,x=m.useFramebuffer,C=m.clear,T=m.getContainer,this.resizePickingFBO(),x(this.pickingFBO,function(){C({framebuffer:v.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),a.hooks.beforePickingEncode.call(),a.renderModels(),a.hooks.afterPickingEncode.call();var Z=v.pickBox(a,s);f(Z)});case 3:case"end":return D.stop()}},n,this)}));function r(n,a,s){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var a=this,s=n.map(function(gr){var sn=gr<0?0:gr;return Math.floor(sn*La/a.pickBufferScale)}),f=(0,nn.Z)(s,4),v=f[0],m=f[1],x=f[2],C=f[3],T=this.rendererService,O=T.getViewportSize,D=T.readPixels,Z=T.getContainer,W=this.getContainerSize(Z()),Q=W.width,ye=W.height;if(Q*=La,ye*=La,v>(Q-1)*La/this.pickBufferScale||x<0||m>(ye-1)*La/this.pickBufferScale||C<0)return[];var Be,qe=Math.min(Q/this.pickBufferScale,x)-v,rt=Math.min(ye/this.pickBufferScale,C)-m;Be=D({x:v,y:Math.floor(ye/this.pickBufferScale-(C+1)),width:qe,height:rt,data:new Uint8Array(qe*rt*4),framebuffer:this.pickingFBO});for(var _t=[],mt={},Ht=0;Ht<Be.length/4;Ht=Ht+1){var rr=Be.slice(Ht*4,Ht*4+4),Cr=bl(rr);if(Cr!==-1&&!mt[Cr]){var qr=r.getSource().getFeatureById(Cr);_t.push(Tl(Tl({},qr),{},{pickedFeatureIdx:Cr})),mt[Cr]=!0}}return _t}},{key:"handleCursor",value:function(r,n){var a=r.getLayerConfig(),s=a.cursor,f=s===void 0?"":s,v=a.cursorEnabled;if(v){var m=this.mapService.version,x=m==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),C=x==null?void 0:x.style.getPropertyValue("cursor");n==="unmousemove"&&C!==""?x==null||x.style.setProperty("cursor",""):n==="mousemove"&&(x==null||x.style.setProperty("cursor",f))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/La,height:r.height/La}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,d.Z)(w().mark(function n(a){var s;return w().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())){v.next=2;break}return v.abrupt("return");case 2:if(this.alreadyInPicking=!0,s=new Date().getTime(),!(s-this.lastPickTime>10||["contextmenu","click","mouseup"].includes(a.type))){v.next=7;break}return v.next=7,this.pickingLayers(a);case 7:this.lastPickTime=s,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return v.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),a=n.width,s=n.height;a*=La,s*=La,(this.width!==a||this.height!==s)&&(this.pickingFBO.resize({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale)}),this.width=a,this.height=s)}},{key:"pickingLayers",value:function(){var i=(0,d.Z)(w().mark(function n(a){var s=this,f,v,m,x,C;return w().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:f=this.rendererService,v=f.getViewportSize,m=f.useFramebuffer,x=f.clear,C=f.getContainer,this.resizePickingFBO(),m(this.pickingFBO,function(){var D=s.layerService.getRenderList();D.filter(function(Z){return Z.needPick(a.type)}).reverse().some(function(Z){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),Z.hooks.beforePickingEncode.call(),Z.masks.length>0&&Z.masks.map(function(Q){Q.hooks.beforeRenderData.call(),Q.hooks.beforeRender.call(),Q.render(),Q.hooks.afterRender.call()}),Z.renderModels(!0),Z.hooks.afterPickingEncode.call(),s.pickedLayers.map(function(Q){s.selectFeature(Q,new Uint8Array([0,0,0,0]))});var W=s.pickFromPickingFBO(Z,a);return s.layerService.pickedLayerId=W?+Z.id:-1,W&&!Z.getLayerConfig().enablePropagation})});case 3:case"end":return O.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){ia(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}},{key:"highlightPickedFeature",value:function(r,n){var a=(0,nn.Z)(n,3),s=a[0],f=a[1],v=a[2];r.hooks.beforeHighlight.call([s,f,v])}},{key:"selectFeature",value:function(r,n){var a=(0,nn.Z)(n,3),s=a[0],f=a[1],v=a[2];r.hooks.beforeSelect.call([s,f,v])}}]),e}(),wo=ci(xu.prototype,"mapService",[Wa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ql=ci(xu.prototype,"rendererService",[ko],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cl=ci(xu.prototype,"configService",[Ps],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sp=ci(xu.prototype,"interactionService",[fa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rf=ci(xu.prototype,"layerService",[$l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xu))||ku),ed=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,st.Z)(this,e),(0,A.Z)(this,"autoStart",void 0),(0,A.Z)(this,"startTime",0),(0,A.Z)(this,"oldTime",0),(0,A.Z)(this,"running",!1),(0,A.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,Ct.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),lp,Zp,dh,vh,_c,Yc,cp,qc,fp;function td(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=rd(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function rd(e,i){if(!!e){if(typeof e=="string")return jp(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jp(e,i)}}function jp(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var mh=(lp=(0,Nr.b2)(),Zp=(0,Nr.f3)(zt.IRendererService),dh=(0,Nr.f3)(zt.IMapService),vh=(0,Nr.f3)(zt.IGlobalConfigService),lp(_c=(Yc=function(){function e(){(0,st.Z)(this,e),(0,A.Z)(this,"pickedLayerId",-1),(0,A.Z)(this,"clock",new ed),(0,A.Z)(this,"alreadyInRendering",!1),(0,A.Z)(this,"layers",[]),(0,A.Z)(this,"layerList",[]),(0,A.Z)(this,"layerRenderID",void 0),(0,A.Z)(this,"sceneInited",!1),(0,A.Z)(this,"animateInstanceCount",0),(0,A.Z)(this,"shaderPicking",!0),(0,A.Z)(this,"enableRender",!0),ti(this,"renderService",cp,this),ti(this,"mapService",qc,this),ti(this,"configService",fp,this)}return(0,Ct.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"addMask",value:function(r){this.sceneInited&&r.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(n){return n.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(n){return n.name===r})}},{key:"cleanRemove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),this.renderLayers()}},{key:"remove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){var i=(0,d.Z)(w().mark(function n(){var a,s,f;return w().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){m.next=2;break}return m.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),a=td(this.layerList),m.prev=5,a.s();case 7:if((s=a.n()).done){m.next=21;break}if(f=s.value,f.hooks.beforeRenderData.call(),f.hooks.beforeRender.call(),!f.isLayerGroup&&f.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),f.masks.map(function(x){x.hooks.beforeRenderData.call(),x.hooks.beforeRender.call(),x.render(),x.hooks.afterRender.call()})),!f.getLayerConfig().enableMultiPassRenderer){m.next=17;break}return m.next=15,f.renderMultiPass();case 15:m.next=18;break;case 17:f.render();case 18:f.hooks.afterRender.call();case 19:m.next=7;break;case 21:m.next=26;break;case 23:m.prev=23,m.t0=m.catch(5),a.e(m.t0);case 26:return m.prev=26,a.f(),m.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return m.stop()}},n,this,[[5,23,26,29]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).sort(function(n,a){return n.zIndex-a.zIndex}).forEach(function(n){n.isLayerGroup?n.layerChildren.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).sort(function(a,s){return a.zIndex-s.zIndex}).forEach(function(a){r.layerList.push(a)}):r.layerList.push(n)})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var r=Qi(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=oa.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){oa.cancelAnimationFrame(this.layerRenderID)}}]),e}(),cp=ci(Yc.prototype,"renderService",[Zp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qc=ci(Yc.prototype,"mapService",[dh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fp=ci(Yc.prototype,"configService",[vh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yc))||_c),Kc=ee(81253),gh=ee(14293),fl=ee.n(gh),yh=function(){function e(i){var r=this;(0,st.Z)(this,e),(0,A.Z)(this,"name",void 0),(0,A.Z)(this,"type",void 0),(0,A.Z)(this,"scale",void 0),(0,A.Z)(this,"descriptor",void 0),(0,A.Z)(this,"featureBufferLayout",[]),(0,A.Z)(this,"needRescale",!1),(0,A.Z)(this,"needRemapping",!1),(0,A.Z)(this,"needRegenerateVertices",!1),(0,A.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,A.Z)(this,"vertexAttribute",void 0),(0,A.Z)(this,"defaultCallback",function(n){if(n.length===0){var a;return((a=r.scale)===null||a===void 0?void 0:a.defaultValues)||[]}return n.map(function(s,f){var v,m=(v=r.scale)===null||v===void 0?void 0:v.scalers[f].func,x=m(s);return x})}),this.setProps(i)}return(0,Ct.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var a,s=(a=this.scale)===null||a===void 0?void 0:a.callback.apply(a,(0,Se.Z)(r));if(!fl()(s))return[s]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),nd=["buffer","update","name"],Vp=["buffer","update","name"],Lf,pp,Gp,kf,hp,dp;function id(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _h(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?id(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):id(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _v(e){return new Promise(function(i){return setTimeout(i,e)})}var xv=(Lf={},(0,A.Z)(Lf,j.FLOAT,4),(0,A.Z)(Lf,j.UNSIGNED_BYTE,1),(0,A.Z)(Lf,j.UNSIGNED_SHORT,2),Lf),kd=(pp=(0,Nr.b2)(),Gp=(0,Nr.f3)(zt.IRendererService),pp(kf=(hp=function(){function e(){(0,st.Z)(this,e),(0,A.Z)(this,"attributesAndIndices",void 0),ti(this,"rendererService",dp,this),(0,A.Z)(this,"attributes",[]),(0,A.Z)(this,"triangulation",void 0),(0,A.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Ct.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new yh(r),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(r,n,a){var s=this.getLayerStyleAttribute(r);s||(s=this.registerStyleAttribute(_h(_h({},n),{},{name:r})));var f=n.scale;f&&s&&(s.scale=f,s.needRescale=!0,s.needRemapping=!0,s.needRegenerateVertices=!0,a&&a.featureRange&&(s.featureRange=a.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,a=this.getLayerStyleAttribute(r),s=a==null||(n=a.scale)===null||n===void 0?void 0:n.scalers;return s&&s[0]?s[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,f=this.attributes.find(function(rt){return rt.name===r});if(f&&f.descriptor){var v=f.descriptor,m=v.update,x=v.buffer,C=v.size,T=C===void 0?0:C,O=xv[x.type||j.FLOAT];if(m){var D=this.featureLayout,Z=D.elements,W=D.sizePerElement,Q=Z.slice(a,s);if(!Q.length)return;var ye=Q[0].offset,Be=ye*T*O,qe=Q.map(function(rt,_t){for(var mt=rt.featureIdx,Ht=rt.vertices,rr=rt.normals,Cr=Ht.length/W,qr=[],gr=0;gr<Cr;gr++){var sn=rr?rr.slice(gr*3,gr*3+3):[];qr.push.apply(qr,(0,Se.Z)(m(n[mt],mt,Ht.slice(gr*W,gr*W+W),_t,sn)))}return qr}).reduce(function(rt,_t){return rt.push.apply(rt,(0,Se.Z)(_t)),rt},[]);f.vertexAttribute.updateBuffer({data:qe,offset:Be})}}}},{key:"createAttributesAndIndices",value:function(r,n,a){var s=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var f=this.attributes.map(function(Be){return Be.resetDescriptor(),Be.descriptor}),v=0,m=[],x=[],C=[],T=3;r.forEach(function(Be,qe){var rt=s.triangulation(Be,a),_t=rt.indices,mt=rt.vertices,Ht=rt.normals,rr=rt.size,Cr=rt.indexes;_t.forEach(function(Rn){x.push(Rn+v)}),T=rr;var qr=mt.length/rr;s.featureLayout.sizePerElement=T,s.featureLayout.elements.push({featureIdx:qe,vertices:mt,normals:Ht,offset:v}),v+=qr;for(var gr=function(Un){var Ba=(Ht==null?void 0:Ht.slice(Un*3,Un*3+3))||[],Mo=mt.slice(Un*rr,Un*rr+rr),Is=0;Cr&&Cr[Un]!==void 0&&(Is=Cr[Un]),f.forEach(function(iu,Ns){if(iu&&iu.update){var Mc;(Mc=iu.buffer.data).push.apply(Mc,(0,Se.Z)(iu.update(Be,qe,Mo,Un,Ba,Is)))}})},sn=0;sn<qr;sn++)gr(sn)});var O=this.rendererService,D=O.createAttribute,Z=O.createBuffer,W=O.createElements,Q={};f.forEach(function(Be,qe){if(Be){var rt=Be.buffer,_t=Be.update,mt=Be.name,Ht=(0,Kc.Z)(Be,nd),rr=D(_h({buffer:Z(rt)},Ht));Q[Be.name||""]=rr,s.attributes[qe].vertexAttribute=rr}});var ye=W({data:x,type:j.UNSIGNED_INT,count:x.length});return this.attributesAndIndices={attributes:Q,elements:ye},this.attributesAndIndices}},{key:"createAttributes",value:function(r,n){var a=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var s=this.attributes.map(function(D){return D.resetDescriptor(),D.descriptor}),f=0,v=[],m=3;r.forEach(function(D,Z){var W=a.triangulation(D),Q=W.indices,ye=W.vertices,Be=W.normals,qe=W.size,rt=W.indexes;Q.forEach(function(rr){v.push(rr+f)}),m=qe;var _t=ye.length/qe;a.featureLayout.sizePerElement=m,a.featureLayout.elements.push({featureIdx:Z,vertices:ye,normals:Be,offset:f}),f+=_t;for(var mt=function(Cr){var qr=(Be==null?void 0:Be.slice(Cr*3,Cr*3+3))||[],gr=ye.slice(Cr*qe,Cr*qe+qe),sn=0;rt&&rt[Cr]!==void 0&&(sn=rt[Cr]),s.forEach(function(Rn,Un){if(Rn&&Rn.update){var Ba;(Ba=Rn.buffer.data).push.apply(Ba,(0,Se.Z)(Rn.update(D,Z,gr,Cr,qr,sn)))}})},Ht=0;Ht<_t;Ht++)mt(Ht)});var x=this.rendererService,C=x.createAttribute,T=x.createBuffer,O={};return s.forEach(function(D,Z){if(D){var W=D.buffer,Q=D.update,ye=D.name,Be=(0,Kc.Z)(D,Vp),qe=C(_h({buffer:T(W)},Be));O[D.name||""]=qe,a.attributes[Z].vertexAttribute=qe}}),{attributes:O}}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),dp=ci(hp.prototype,"rendererService",[Gp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hp))||kf),bv=ee(67709),xh=ee.n(bv),To,Ml,Ev,$c,ad,Dd,bh,Jl,Eh,Hp,Sh,Ch,od,Fd,Wp,Bd,Nd,Xs,zd,Ud,Du,Ah,Zd,ec,Sv,jd,Df,vp,mp,gp,yp,Vd,Gd;function Cv(e){var i=Av();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Av(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Hd=(To=(0,Nr.b2)(),Ml=(0,Nr.f3)(zt.SceneID),Ev=(0,Nr.f3)(zt.IIconService),$c=(0,Nr.f3)(zt.IFontService),ad=(0,Nr.f3)(zt.IControlService),Dd=(0,Nr.f3)(zt.IGlobalConfigService),bh=(0,Nr.f3)(zt.IMapService),Jl=(0,Nr.f3)(zt.ICoordinateSystemService),Eh=(0,Nr.f3)(zt.IRendererService),Hp=(0,Nr.f3)(zt.ILayerService),Sh=(0,Nr.f3)(zt.ICameraService),Ch=(0,Nr.f3)(zt.IInteractionService),od=(0,Nr.f3)(zt.IPickingService),Fd=(0,Nr.f3)(zt.IShaderModuleService),Wp=(0,Nr.f3)(zt.IMarkerService),Bd=(0,Nr.f3)(zt.IPopupService),To(Nd=(Xs=function(e){(0,wr.Z)(r,e);var i=Cv(r);function r(){var n;return(0,st.Z)(this,r),n=i.call(this),(0,A.Z)((0,ae.Z)(n),"destroyed",!1),(0,A.Z)((0,ae.Z)(n),"loaded",!1),(0,A.Z)((0,ae.Z)(n),"loadFont",!1),(0,A.Z)((0,ae.Z)(n),"fontFamily",""),ti((0,ae.Z)(n),"id",zd,(0,ae.Z)(n)),ti((0,ae.Z)(n),"iconService",Ud,(0,ae.Z)(n)),ti((0,ae.Z)(n),"fontService",Du,(0,ae.Z)(n)),ti((0,ae.Z)(n),"controlService",Ah,(0,ae.Z)(n)),ti((0,ae.Z)(n),"configService",Zd,(0,ae.Z)(n)),ti((0,ae.Z)(n),"map",ec,(0,ae.Z)(n)),ti((0,ae.Z)(n),"coordinateSystemService",Sv,(0,ae.Z)(n)),ti((0,ae.Z)(n),"rendererService",jd,(0,ae.Z)(n)),ti((0,ae.Z)(n),"layerService",Df,(0,ae.Z)(n)),ti((0,ae.Z)(n),"cameraService",vp,(0,ae.Z)(n)),ti((0,ae.Z)(n),"interactionService",mp,(0,ae.Z)(n)),ti((0,ae.Z)(n),"pickingService",gp,(0,ae.Z)(n)),ti((0,ae.Z)(n),"shaderModuleService",yp,(0,ae.Z)(n)),ti((0,ae.Z)(n),"markerService",Vd,(0,ae.Z)(n)),ti((0,ae.Z)(n),"popupService",Gd,(0,ae.Z)(n)),(0,A.Z)((0,ae.Z)(n),"inited",!1),(0,A.Z)((0,ae.Z)(n),"initPromise",void 0),(0,A.Z)((0,ae.Z)(n),"rendering",!1),(0,A.Z)((0,ae.Z)(n),"$container",void 0),(0,A.Z)((0,ae.Z)(n),"canvas",void 0),(0,A.Z)((0,ae.Z)(n),"markerContainer",void 0),(0,A.Z)((0,ae.Z)(n),"hooks",void 0),(0,A.Z)((0,ae.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),gn(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,A.Z)((0,ae.Z)(n),"handleMapCameraChanged",function(a){n.cameraService.update(a),n.render()}),n.hooks={init:new mf},n}return(0,Ct.Z)(r,[{key:"init",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,d.Z)(w().mark(function f(){return w().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.version!=="GAODE2.x"?s.map.init():x()});case 2:if(!(s.map.version==="GAODE2.x"&&s.map.initViewPort)){m.next=6;break}return m.next=5,s.map.init();case 5:s.map.initViewPort();case 6:s.map.onCameraChanged(s.handleMapCameraChanged),s.map.addMarkerContainer(),s.markerService.addMarkers(),s.markerService.addMarkerLayers(),s.popupService.initPopup(),s.interactionService.init(),s.interactionService.on(Hi.Drag,s.addSceneEvent.bind(s));case 13:case"end":return m.stop()}},f)}))),this.hooks.init.tapPromise("initRenderer",(0,d.Z)(w().mark(function f(){var v,m;return w().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(v=Sa(s.configService.getSceneConfig(s.id).id||""),s.$container=v,!v){C.next=11;break}return s.canvas=Za("canvas","",v),s.setCanvas(),C.next=7,s.rendererService.init(s.canvas,s.configService.getSceneConfig(s.id));case 7:xh()(s.$container,s.handleWindowResized),oa.matchMedia&&((m=oa.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||m===void 0||m.addListener(s.handleWindowResized)),C.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:s.pickingService.init(s.id);case 13:case"end":return C.stop()}},f)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,d.Z)(w().mark(function f(){return w().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.initMiniMap()});case 2:s.map.onCameraChanged(s.handleMapCameraChanged),s.interactionService.init(),s.interactionService.on(Hi.Drag,s.addSceneEvent.bind(s));case 5:case"end":return m.stop()}},f)}))),this.hooks.init.tapPromise("initRenderer",(0,d.Z)(w().mark(function f(){var v;return w().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(v=a.canvas,s.$container=v||null,!s.$container){x.next=7;break}return x.next=5,s.rendererService.init(a.canvas,s.configService.getSceneConfig(s.id));case 5:x.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:s.pickingService.init(s.id);case 9:case"end":return x.stop()}},f)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(a){this.layerService.sceneService=this,this.layerService.add(a),this.render()}},{key:"addMask",value:function(a){this.layerService.sceneService=this,this.layerService.addMask(a),this.render()}},{key:"render",value:function(){var n=(0,d.Z)(w().mark(function s(){return w().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.rendering||this.destroyed)){v.next=2;break}return v.abrupt("return");case 2:if(this.rendering=!0,this.inited){v.next=23;break}return v.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){v.next=18;break}return v.prev=8,v.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:v.next=18;break;case 13:v.prev=13,v.t0=v.catch(8),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(v.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return v.stop()}},s,this,[[8,13]])}));function a(){return n.apply(this,arguments)}return a}()},{key:"addFontFace",value:function(a,s){this.fontFamily=a;var f=document.createElement("style");f.type="text/css",f.innerText=`
        @font-face{
            font-family: '`.concat(a,`';
            src: url('`).concat(s,`') format('woff2'),
            url('`).concat(s,`') format('woff'),
            url('`).concat(s,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(f),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(a){var s,f=(s=this.$container)===null||s===void 0?void 0:s.getElementsByTagName("canvas")[0];this.render();var v=a==="jpg"?f==null?void 0:f.toDataURL("image/jpeg"):f==null?void 0:f.toDataURL("image/png");return v}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var a=this.$container.parentElement;a!==null&&(this.markerContainer=Za("div","l7-marker-container",a))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var a=this,s,f;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var m;(m=a.$container)===null||m===void 0||m.removeChild(a.canvas),a.canvas=null,a.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(s=this.$container)===null||s===void 0||(f=s.parentNode)===null||f===void 0||f.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,bv.unbind)(this.$container,this.handleWindowResized),oa.matchMedia){var v;(v=oa.matchMedia("screen and (min-resolution: 2dppx)"))===null||v===void 0||v.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var a,s,f=La,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,m=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x&&(x.width=v*f,x.height=m*f),this.rendererService.viewport({x:0,y:0,width:f*v,height:f*m})}},{key:"setCanvas",value:function(){var a,s,f=La,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,m=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x.width=v*f,x.height=m*f,x.style.width="100%",x.style.height="100%"}},{key:"addSceneEvent",value:function(a){this.emit(a.type,a)}}]),r}(jr.EventEmitter),zd=ci(Xs.prototype,"id",[Ml],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ud=ci(Xs.prototype,"iconService",[Ev],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Du=ci(Xs.prototype,"fontService",[$c],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ah=ci(Xs.prototype,"controlService",[ad],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zd=ci(Xs.prototype,"configService",[Dd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ec=ci(Xs.prototype,"map",[bh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sv=ci(Xs.prototype,"coordinateSystemService",[Jl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jd=ci(Xs.prototype,"rendererService",[Eh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Df=ci(Xs.prototype,"layerService",[Hp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vp=ci(Xs.prototype,"cameraService",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mp=ci(Xs.prototype,"interactionService",[Ch],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gp=ci(Xs.prototype,"pickingService",[od],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yp=ci(Xs.prototype,"shaderModuleService",[Fd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vd=ci(Xs.prototype,"markerService",[Wp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gd=ci(Xs.prototype,"popupService",[Bd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xs))||Nd),Wd=ee(44908),xc=ee.n(Wd);function wv(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var Xd=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function sd(e){var i={};return e=e.replace(Xd,function(r,n,a){var s=a.split(":"),f=s[0].trim(),v="";switch(s.length>1&&(v=s[1].trim()),n){case"bool":v=v==="true";break;case"float":case"int":v=Number(v);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":v?v=v.replace("[","").replace("]","").split(",").reduce(function(m,x){return m.push(Number(x.trim())),m},[]):v=new Array(wv(n)).fill(0);break;default:}return i[f]=v,"uniform ".concat(n," ").concat(f,`;
`)}),{content:e,uniforms:i}}var Yd,ud;function qd(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Xp(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?qd(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qd(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var ld="#define PI 3.14159265359",Tv=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,wh=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Mv=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,cd=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,b0=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Pv=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,E0=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,S0=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,C0=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,A0=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,w0=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,T0=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,M0=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,P0=/precision\s+(high|low|medium)p\s+float/,bc=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,fd=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,Iv=(Yd=(0,Nr.b2)(),Yd(ud=function(){function e(){(0,st.Z)(this,e),(0,A.Z)(this,"moduleCache",{}),(0,A.Z)(this,"rawContentCache",{})}return(0,Ct.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:ld,fs:ld}),this.registerModule("decode",{vs:Tv,fs:""}),this.registerModule("projection",{vs:E0,fs:""}),this.registerModule("project",{vs:Pv,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:S0}),this.registerModule("lighting",{vs:Mv,fs:""}),this.registerModule("light",{vs:wh,fs:""}),this.registerModule("picking",{vs:b0,fs:cd}),this.registerModule("styleMapping",{vs:C0,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:M0,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:A0,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:w0,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:T0,fs:""})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var a=n.vs,s=n.fs,f=n.uniforms,v=sd(a),m=v.content,x=v.uniforms,C=sd(s),T=C.content,O=C.uniforms;this.rawContentCache[r]={fs:T,uniforms:Xp(Xp(Xp({},x),O),f),vs:m}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var a=this.rawContentCache[r].vs,s=this.rawContentCache[r].fs,f=this.processModule(a,[],"vs"),v=f.content,m=f.includeList,x=this.processModule(s,[],"fs"),C=x.content,T=x.includeList,O=C,D=xc()(m.concat(T).concat(r)).reduce(function(Z,W){return Xp(Xp({},Z),n.rawContentCache[W].uniforms)},{});return P0.test(C)||(O=bc+C),this.moduleCache[r]={fs:O.trim(),uniforms:D,vs:v.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,a){var s=this,f=r.replace(fd,function(v,m){var x=m.split(" "),C=x[0].replace(/"/g,"");if(n.indexOf(C)>-1)return"";var T=s.rawContentCache[C][a];n.push(C);var O=s.processModule(T,n,a),D=O.content;return D});return{content:f,includeList:n}}}]),e}())||ud),Ff=ee(66213),Qc;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Qc||(Qc={}));var ym,_m,Ov=(ym=(0,Nr.b2)(),ym(_m=function(){function e(){(0,st.Z)(this,e),(0,A.Z)(this,"shaderModuleService",void 0),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"cameraService",void 0),(0,A.Z)(this,"mapService",void 0),(0,A.Z)(this,"interactionService",void 0),(0,A.Z)(this,"layerService",void 0),(0,A.Z)(this,"config",void 0)}return(0,Ct.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Qc.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(zt.IRendererService),this.cameraService=r.getContainer().get(zt.ICameraService),this.mapService=r.getContainer().get(zt.IMapService),this.interactionService=r.getContainer().get(zt.IInteractionService),this.layerService=r.getContainer().get(zt.ILayerService),this.shaderModuleService=r.getContainer().get(zt.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||_m),xm,bm;function ab(e){var i=ob();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function ob(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sb=(xm=(0,Nr.b2)(),xm(bm=function(e){(0,wr.Z)(r,e);var i=ab(r);function r(){return(0,st.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(a,s){(0,Ff.Z)((0,pt.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(Ov))||bm),Em,Sm,Cm,I0,Am;function ub(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=lb(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function lb(e,i){if(!!e){if(typeof e=="string")return wm(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wm(e,i)}}function wm(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var cb=(Em=(0,Nr.b2)(),Sm=(0,Nr.f3)(zt.IPostProcessor),Em(Cm=(I0=function(){function e(){(0,st.Z)(this,e),(0,A.Z)(this,"passes",[]),ti(this,"postProcessor",Am,this),(0,A.Z)(this,"layer",void 0),(0,A.Z)(this,"renderFlag",void 0),(0,A.Z)(this,"width",0),(0,A.Z)(this,"height",0)}return(0,Ct.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,d.Z)(w().mark(function n(){var a,s,f;return w().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:a=ub(this.passes),m.prev=1,a.s();case 3:if((s=a.n()).done){m.next=9;break}return f=s.value,m.next=7,f.render(this.layer);case 7:m.next=3;break;case 9:m.next=14;break;case 11:m.prev=11,m.t0=m.catch(1),a.e(m.t0);case 14:return m.prev=14,a.f(),m.finish(14);case 17:return m.next=19,this.postProcessor.render(this.layer);case 19:case"end":return m.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===Qc.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,a){r.init(this.layer,n),this.passes.splice(a,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),Am=ci(I0.prototype,"postProcessor",[Sm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I0))||Cm),Tm,Mm;function Pm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Im(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Pm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function fb(e){var i=pb();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function pb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hb=(Tm=(0,Nr.b2)(),Tm(Mm=function(e){(0,wr.Z)(r,e);var i=fb(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"pickingFBO",void 0),(0,A.Z)((0,ae.Z)(n),"layer",void 0),(0,A.Z)((0,ae.Z)(n),"width",0),(0,A.Z)((0,ae.Z)(n),"height",0),(0,A.Z)((0,ae.Z)(n),"alreadyInRendering",!1),(0,A.Z)((0,ae.Z)(n),"pickFromPickingFBO",function(v){var m=v.x,x=v.y,C=v.lngLat,T=v.type;if(!(!n.layer.isVisible()||!n.layer.needPick(T))){var O=n.rendererService,D=O.getViewportSize,Z=O.readPixels,W=O.useFramebuffer,Q=D(),ye=Q.width,Be=Q.height,qe=n.layer.getLayerConfig(),rt=qe.enableHighlight,_t=qe.enableSelect,mt=m*La,Ht=x*La;if(!(mt>ye||mt<0||Ht>Be||Ht<0)){var rr;W(n.pickingFBO,function(){var Cr;if(rr=Z({x:Math.round(mt),y:Math.round(Be-(x+1)*La),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),rr[0]!==0||rr[1]!==0||rr[2]!==0){var qr=bl(rr),gr=n.layer.getSource().getFeatureById(qr),sn={x:m,y:x,type:T,lngLat:C,featureId:qr,feature:gr};gr&&(n.layer.setCurrentPickId(qr),n.triggerHoverOnLayer(sn))}else{var Rn={x:m,y:x,lngLat:C,type:n.layer.getCurrentPickId()===null?"un"+T:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(Im(Im({},Rn),{},{type:"unpick"})),n.triggerHoverOnLayer(Rn),n.layer.setCurrentPickId(null)}rt&&n.highlightPickedFeature(rr),_t&&T==="click"&&((Cr=rr)===null||Cr===void 0?void 0:Cr.toString())!==[0,0,0,0].toString()&&n.selectFeature(rr)})}}}),n}return(0,Ct.Z)(r,[{key:"getType",value:function(){return Qc.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(a,s){(0,Ff.Z)((0,pt.Z)(r.prototype),"init",this).call(this,a,s),this.layer=a;var f=this.rendererService,v=f.createTexture2D,m=f.createFramebuffer,x=f.getViewportSize,C=x(),T=C.width,O=C.height;this.pickingFBO=m({color:v({width:T,height:O,wrapS:j.CLAMP_TO_EDGE,wrapT:j.CLAMP_TO_EDGE})}),this.interactionService.on(Hi.Hover,this.pickFromPickingFBO),this.interactionService.on(Hi.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Hi.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(a){var s=this;if(!this.alreadyInRendering){var f=this.rendererService,v=f.getViewportSize,m=f.useFramebuffer,x=f.clear,C=v(),T=C.width,O=C.height;this.alreadyInRendering=!0,(this.width!==T||this.height!==O)&&(this.pickingFBO.resize({width:T,height:O}),this.width=T,this.height=O),m(this.pickingFBO,function(){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var D=s.layer.multiPassRenderer.getRenderFlag();s.layer.multiPassRenderer.setRenderFlag(!1),a.hooks.beforePickingEncode.call(),a.render(),a.hooks.afterPickingEncode.call(),s.layer.multiPassRenderer.setRenderFlag(D),s.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(a){this.layer.emit(a.type,a)}},{key:"highlightPickedFeature",value:function(a){var s=(0,nn.Z)(a,3),f=s[0],v=s[1],m=s[2];this.layer.hooks.beforeHighlight.call([f,v,m]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(a){var s=(0,nn.Z)(a,3),f=s[0],v=s[1],m=s[2];this.layer.hooks.beforeSelect.call([f,v,m]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(a){var s=a.featureId,f=vu(s);this.selectFeature(new Uint8Array(f))}},{key:"highlightFeatureHandle",value:function(a){var s=a.featureId,f=vu(s);this.highlightPickedFeature(new Uint8Array(f))}}]),r}(Ov))||Mm),db=ee(11700),vb=ee.n(db),mb=ee(68929),gb=ee.n(mb),Om,Rm,Lm,O0,km;function Dm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Kd(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Dm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Dm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var yb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,_p=(Om=(0,Nr.b2)(),Rm=(0,Nr.f3)(zt.IShaderModuleService),Om(Lm=(O0=function(){function e(){(0,st.Z)(this,e),ti(this,"shaderModuleService",km,this),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"config",void 0),(0,A.Z)(this,"quad",yb),(0,A.Z)(this,"enabled",!0),(0,A.Z)(this,"renderToScreen",!1),(0,A.Z)(this,"model",void 0),(0,A.Z)(this,"name",void 0),(0,A.Z)(this,"optionsToUpdate",{})}return(0,Ct.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return Qc.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(zt.IRendererService),this.shaderModuleService=r.getContainer().get(zt.IShaderModuleService);var a=this.rendererService,s=a.createAttribute,f=a.createBuffer,v=a.createModel,m=this.setupShaders(),x=m.vs,C=m.fs,T=m.uniforms;this.model=v({vs:x,fs:C,attributes:{a_Position:s({buffer:f({data:[-4,-4,4,-4,0,4],type:j.FLOAT}),size:2})},uniforms:Kd(Kd({u_Texture:null},T),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var a=this,s=r.multiPassRenderer.getPostProcessor(),f=this.rendererService,v=f.useFramebuffer,m=f.getViewportSize,x=f.clear,C=m(),T=C.width,O=C.height;v(this.renderToScreen?null:s.getWriteFBO(),function(){x({framebuffer:s.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var D=Kd({u_BloomFinal:0,u_Texture:s.getReadFBO(),u_ViewportSize:[T,O]},a.convertOptionsToUniforms(a.optionsToUpdate));n&&(D.u_BloomFinal=1,D.u_Texture2=n),a.model.draw({uniforms:D})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=Kd(Kd({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(a){fl()(r[a])||(n["u_".concat(vb()(gb()(a)))]=r[a])}),n}}]),e}(),km=ci(O0.prototype,"shaderModuleService",[Rm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O0))||Lm),Fm,Bm;function Nm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function zm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Nm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Nm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _b(e){var i=xb();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function xb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bb=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,Eb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Sb=(Fm=(0,Nr.b2)(),Fm(Bm=function(e){(0,wr.Z)(r,e);var i=_b(r);function r(){return(0,st.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Eb,fs:bb});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,f=a.fs,v=a.uniforms,m=this.rendererService.getViewportSize(),x=m.width,C=m.height;return{vs:s,fs:f,uniforms:zm(zm({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return fl()(a.bloomRadius)||(s.u_radius=a.bloomRadius),fl()(a.bloomIntensity)||(s.u_intensity=a.bloomIntensity),fl()(a.bloomBaseRadio)||(s.u_baseRadio=a.bloomBaseRadio),s}}]),r}(_p))||Bm),Um,Zm;function jm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Vm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?jm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Cb(e){var i=Ab();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Ab(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Tb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Mb=(Um=(0,Nr.b2)(),Um(Zm=function(e){(0,wr.Z)(r,e);var i=Cb(r);function r(){return(0,st.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Tb,fs:wb});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,f=a.fs,v=a.uniforms,m=this.rendererService.getViewportSize(),x=m.width,C=m.height;return{vs:s,fs:f,uniforms:Vm(Vm({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return fl()(a.blurRadius)||(s.u_BlurDir=[a.blurRadius,0]),s}}]),r}(_p))||Zm),Gm,Hm;function Wm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Xm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Wm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Pb(e){var i=Ib();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Ib(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ob=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Rb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Lb=(Gm=(0,Nr.b2)(),Gm(Hm=function(e){(0,wr.Z)(r,e);var i=Pb(r);function r(){return(0,st.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Rb,fs:Ob});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,f=a.fs,v=a.uniforms,m=this.rendererService.getViewportSize(),x=m.width,C=m.height;return{vs:s,fs:f,uniforms:Xm(Xm({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return fl()(a.blurRadius)||(s.u_BlurDir=[0,a.blurRadius]),s}}]),r}(_p))||Hm),Ym,qm;function Km(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function $m(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Km(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Km(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function kb(e){var i=Db();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Db(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,Bb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Nb=(Ym=(0,Nr.b2)(),Ym(qm=function(e){(0,wr.Z)(r,e);var i=kb(r);function r(){return(0,st.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:Bb,fs:Fb});var a=this.shaderModuleService.getModule("colorhalftone-pass"),s=a.vs,f=a.fs,v=a.uniforms,m=this.rendererService.getViewportSize(),x=m.width,C=m.height;return{vs:s,fs:f,uniforms:$m($m({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(_p))||qm),Qm,Jm;function zb(e){var i=Ub();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Ub(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,jb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Vb=(Qm=(0,Nr.b2)(),Qm(Jm=function(e){(0,wr.Z)(r,e);var i=zb(r);function r(){return(0,st.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:jb,fs:Zb}),this.shaderModuleService.getModule("copy-pass")}}]),r}(_p))||Jm),eg,tg;function rg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ng(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?rg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Gb(e){var i=Hb();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Hb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Wb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Xb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Yb=(eg=(0,Nr.b2)(),eg(tg=function(e){(0,wr.Z)(r,e);var i=Gb(r);function r(){return(0,st.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Xb,fs:Wb});var a=this.shaderModuleService.getModule("hexagonalpixelate-pass"),s=a.vs,f=a.fs,v=a.uniforms,m=this.rendererService.getViewportSize(),x=m.width,C=m.height;return{vs:s,fs:f,uniforms:ng(ng({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(_p))||tg),ig,ag;function og(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function sg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?og(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):og(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function qb(e){var i=Kb();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Kb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $b=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Qb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Jb=(ig=(0,Nr.b2)(),ig(ag=function(e){(0,wr.Z)(r,e);var i=qb(r);function r(){return(0,st.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:Qb,fs:$b});var a=this.shaderModuleService.getModule("ink-pass"),s=a.vs,f=a.fs,v=a.uniforms,m=this.rendererService.getViewportSize(),x=m.width,C=m.height;return{vs:s,fs:f,uniforms:sg(sg({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(_p))||ag),ug,lg;function e2(e){var i=t2();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function t2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var r2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,n2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,i2=(ug=(0,Nr.b2)(),ug(lg=function(e){(0,wr.Z)(r,e);var i=e2(r);function r(){return(0,st.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:n2,fs:r2}),this.shaderModuleService.getModule("noise-pass")}}]),r}(_p))||lg),cg,fg;function a2(e){var i=o2();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function o2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var s2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,u2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,l2=(cg=(0,Nr.b2)(),cg(fg=function(e){(0,wr.Z)(r,e);var i=a2(r);function r(){return(0,st.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:s2,fs:u2}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(_p))||fg),pg,hg,dg,vg,pd,mg,c2=(pg=(0,Nr.b2)(),hg=(0,Nr.f3)(zt.IRendererService),dg=(0,Nr.zY)(),pg(vg=(pd=function(){function e(){(0,st.Z)(this,e),ti(this,"rendererService",mg,this),(0,A.Z)(this,"passes",[]),(0,A.Z)(this,"readFBO",void 0),(0,A.Z)(this,"writeFBO",void 0)}return(0,Ct.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,a=r.createTexture2D,s=n(),f=s.width,v=s.height;return a({x:0,y:0,width:f,height:v,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(a,s){n(r.readFBO,(0,d.Z)(w().mark(function f(){return w().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:a(r.getCurrentFBOTex());case 1:case"end":return m.stop()}},f)})))})}},{key:"renderBloomPass",value:function(){var i=(0,d.Z)(w().mark(function n(a,s){var f,v;return w().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,this.getReadFBOTex();case 2:f=x.sent,v=0;case 4:if(!(v<4)){x.next=11;break}return x.next=7,s.render(a,f);case 7:this.swap(),v++,x.next=4;break;case 11:case"end":return x.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){var i=(0,d.Z)(w().mark(function n(a){var s,f;return w().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:s=0;case 1:if(!(s<this.passes.length)){m.next=15;break}if(f=this.passes[s],f.setRenderToScreen(this.isLastEnabledPass(s)),f.getName()!=="bloom"){m.next=9;break}return m.next=7,this.renderBloomPass(a,f);case 7:m.next=12;break;case 9:return m.next=11,f.render(a);case 11:s!==this.passes.length-1&&this.swap();case 12:s++,m.next=1;break;case 15:case"end":return m.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,a){r.init(n,a),this.passes.push(r)}},{key:"insert",value:function(r,n,a,s){r.init(a,s),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,a=r.createTexture2D;this.readFBO=n({color:a({width:1,height:1,wrapS:j.CLAMP_TO_EDGE,wrapT:j.CLAMP_TO_EDGE})}),this.writeFBO=n({color:a({width:1,height:1,wrapS:j.CLAMP_TO_EDGE,wrapT:j.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),mg=ci(pd.prototype,"rendererService",[hg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ci(pd.prototype,"init",[dg],Object.getOwnPropertyDescriptor(pd.prototype,"init"),pd.prototype),pd))||vg),gg,yg;function f2(e){var i=p2();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function p2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var h2=(gg=(0,Nr.b2)(),gg(yg=function(e){(0,wr.Z)(r,e);var i=f2(r);function r(){return(0,st.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getType",value:function(){return Qc.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(a,s){(0,Ff.Z)((0,pt.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(a){var s=this.rendererService,f=s.useFramebuffer,v=s.clear,m=a.multiPassRenderer.getPostProcessor().getReadFBO();f(m,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:m}),a.multiPassRenderer.setRenderFlag(!1),a.models.forEach(function(x){x.draw({uniforms:a.layerModel.getUninforms()})}),a.multiPassRenderer.setRenderFlag(!0)})}}]),r}(Ov))||yg),_g,xg,bg,R0,Eg;function Sg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Cg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Sg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Sg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function d2(e){var i=v2();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function v2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var m2=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,Ag=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,g2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function wg(e,i){for(var r=0,n=1/i,a=e;a>0;)r=r+n*(a%i),a=Math.floor(a/i),n=n/i;return r}var y2=1,_2=(_g=(0,Nr.b2)(),xg=(0,Nr.f3)(zt.IShaderModuleService),_g(bg=(R0=function(e){(0,wr.Z)(r,e);var i=d2(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),ti((0,ae.Z)(n),"shaderModuleService",Eg,(0,ae.Z)(n)),(0,A.Z)((0,ae.Z)(n),"haltonSequence",[]),(0,A.Z)((0,ae.Z)(n),"accumulatingId",0),(0,A.Z)((0,ae.Z)(n),"frame",0),(0,A.Z)((0,ae.Z)(n),"timer",void 0),(0,A.Z)((0,ae.Z)(n),"sampleRenderTarget",void 0),(0,A.Z)((0,ae.Z)(n),"prevRenderTarget",void 0),(0,A.Z)((0,ae.Z)(n),"outputRenderTarget",void 0),(0,A.Z)((0,ae.Z)(n),"copyRenderTarget",void 0),(0,A.Z)((0,ae.Z)(n),"blendModel",void 0),(0,A.Z)((0,ae.Z)(n),"outputModel",void 0),(0,A.Z)((0,ae.Z)(n),"copyModel",void 0),n}return(0,Ct.Z)(r,[{key:"getType",value:function(){return Qc.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(a,s){(0,Ff.Z)((0,pt.Z)(r.prototype),"init",this).call(this,a,s);var f=this.rendererService,v=f.createFramebuffer,m=f.createTexture2D;this.sampleRenderTarget=v({color:m({width:1,height:1,wrapS:j.CLAMP_TO_EDGE,wrapT:j.CLAMP_TO_EDGE})}),this.prevRenderTarget=v({color:m({width:1,height:1,wrapS:j.CLAMP_TO_EDGE,wrapT:j.CLAMP_TO_EDGE})}),this.outputRenderTarget=v({color:m({width:1,height:1,wrapS:j.CLAMP_TO_EDGE,wrapT:j.CLAMP_TO_EDGE})}),this.copyRenderTarget=v({color:m({width:1,height:1,wrapS:j.CLAMP_TO_EDGE,wrapT:j.CLAMP_TO_EDGE})});for(var x=0;x<30;x++)this.haltonSequence.push([wg(x,2),wg(x,3)]);this.blendModel=this.createTriangleModel("blend-pass",m2),this.outputModel=this.createTriangleModel("copy-pass",Ag,{blend:{enable:!0,func:{srcRGB:j.ONE,dstRGB:j.ONE_MINUS_SRC_ALPHA,srcAlpha:j.ONE,dstAlpha:j.ONE_MINUS_SRC_ALPHA},equation:{rgb:j.FUNC_ADD,alpha:j.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",Ag)}},{key:"render",value:function(a){var s=this,f=this.rendererService,v=f.clear,m=f.getViewportSize,x=f.useFramebuffer,C=m(),T=C.width,O=C.height;this.sampleRenderTarget.resize({width:T,height:O}),this.prevRenderTarget.resize({width:T,height:O}),this.outputRenderTarget.resize({width:T,height:O}),this.copyRenderTarget.resize({width:T,height:O}),this.resetFrame(),this.stopAccumulating();var D=a.multiPassRenderer.getPostProcessor().getReadFBO();x(D,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:D}),a.multiPassRenderer.setRenderFlag(!1),a.render(),a.multiPassRenderer.setRenderFlag(!0)});var Z=function W(Q){!s.accumulatingId||Q!==s.accumulatingId||s.isFinished()||(s.doRender(a),oa.requestAnimationFrame(function(){W(Q)}))};this.accumulatingId=y2++,this.timer=oa.setTimeout(function(){Z(s.accumulatingId)},50)}},{key:"doRender",value:function(a){var s=this,f=this.rendererService,v=f.clear,m=f.getViewportSize,x=f.useFramebuffer,C=m(),T=C.width,O=C.height,D=a.getLayerConfig(),Z=D.jitterScale,W=Z===void 0?1:Z,Q=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((Q[0]*2-1)/T*W,(Q[1]*2-1)/O*W),a.multiPassRenderer.setRenderFlag(!1),a.hooks.beforeRender.call(),x(this.sampleRenderTarget,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:s.sampleRenderTarget}),a.render()}),a.hooks.afterRender.call(),a.multiPassRenderer.setRenderFlag(!0);var ye=a.getLayerConfig();x(this.outputRenderTarget,function(){s.blendModel.draw({uniforms:{u_opacity:ye.opacity||1,u_MixRatio:s.frame===0?1:.9,u_Diffuse1:s.sampleRenderTarget,u_Diffuse2:s.frame===0?a.multiPassRenderer.getPostProcessor().getReadFBO():s.prevRenderTarget}})}),this.frame===0&&v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(x(this.copyRenderTarget,function(){s.outputModel.draw({uniforms:{u_Texture:s.outputRenderTarget}})}),x(a.multiPassRenderer.getPostProcessor().getReadFBO(),function(){s.copyModel.draw({uniforms:{u_Texture:s.copyRenderTarget}})}),a.multiPassRenderer.getPostProcessor().render(a));var Be=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Be,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,oa.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(a,s,f){this.shaderModuleService.registerModule(a,{vs:g2,fs:s});var v=this.shaderModuleService.getModule(a),m=v.vs,x=v.fs,C=v.uniforms,T=this.rendererService,O=T.createAttribute,D=T.createBuffer,Z=T.createModel;return Z(Cg({vs:m,fs:x,attributes:{a_Position:O({buffer:D({data:[-4,-4,4,-4,0,4],type:j.FLOAT}),size:2})},uniforms:Cg({},C),depth:{enable:!1},count:3},f))}}]),r}(Ov),Eg=ci(R0.prototype,"shaderModuleService",[xg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R0))||bg),$d=new Nr.W2;$d.bind(zt.IGlobalConfigService).to(ph).inSingletonScope(),(0,Nr.GW)((0,Nr.b2)(),jr.EventEmitter),$d.bind(zt.IEventEmitter).to(jr.EventEmitter);var Tg=(0,Xc.Z)($d,!1),L0=function(i){var r=Tg.lazyInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},xP=function(i){var r=Tg.lazyMultiInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},tc=$d,x2=0;function b2(){var e=new Nr.W2;return e.parent=$d,e.bind(zt.SceneID).toConstantValue("".concat(x2++)),e.bind(zt.IShaderModuleService).to(Iv).inSingletonScope(),e.bind(zt.ILayerService).to(mh).inSingletonScope(),e.bind(zt.ISceneService).to(Hd).inSingletonScope(),e.bind(zt.ICameraService).to(Ue).inSingletonScope(),e.bind(zt.ICoordinateSystemService).to(ao).inSingletonScope(),e.bind(zt.IInteractionService).to(Wi).inSingletonScope(),e.bind(zt.IPickingService).to(Up).inSingletonScope(),e.bind(zt.IControlService).to(Zr).inSingletonScope(),e.bind(zt.IMarkerService).to(Cn).inSingletonScope(),e.bind(zt.IIconService).to(Zt).inSingletonScope(),e.bind(zt.IFontService).to(mr).inSingletonScope(),e.bind(zt.IPopupService).to(bn).inSingletonScope(),e.bind(zt.INormalPass).to(sb).whenTargetNamed("clear"),e.bind(zt.INormalPass).to(hb).whenTargetNamed("pixelPicking"),e.bind(zt.INormalPass).to(h2).whenTargetNamed("render"),e.bind(zt.INormalPass).to(_2).whenTargetNamed("taa"),e.bind(zt.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(zt.INormalPass,r)}}),e.bind(zt.IPostProcessingPass).to(Vb).whenTargetNamed("copy"),e.bind(zt.IPostProcessingPass).to(Sb).whenTargetNamed("bloom"),e.bind(zt.IPostProcessingPass).to(Mb).whenTargetNamed("blurH"),e.bind(zt.IPostProcessingPass).to(Lb).whenTargetNamed("blurV"),e.bind(zt.IPostProcessingPass).to(i2).whenTargetNamed("noise"),e.bind(zt.IPostProcessingPass).to(l2).whenTargetNamed("sepia"),e.bind(zt.IPostProcessingPass).to(Nb).whenTargetNamed("colorHalftone"),e.bind(zt.IPostProcessingPass).to(Yb).whenTargetNamed("hexagonalPixelate"),e.bind(zt.IPostProcessingPass).to(Jb).whenTargetNamed("ink"),e.bind(zt.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(zt.IPostProcessingPass,r);return n.setName(r),n}}),e}function Qd(e){var i=new Nr.W2;return i.parent=e,i.bind(zt.IStyleAttributeService).to(kd).inSingletonScope(),i.bind(zt.IMultiPassRenderer).to(cb).inSingletonScope(),i.bind(zt.IPostProcessor).to(c2).inSingletonScope(),i}var bP=ee(74691),E2=null;function EP(e){return E2.indexOf(e)}var S2=2,SP=4,C2=64,CP=128,A2=256,w2=512,AP=8192,wP=16384,TP=32768,T2=null,Mg=131072,MP=262144,M2=524288,PP=1048576,P2=2097152,IP=4194304,I2=8388608,O2=16777216,R2=null;function Rv(e,i){return e=_clamp(Math.floor(e),0,255),i=_clamp(Math.floor(i),0,255),256*e+i}function OP(e){var i=e.color,r=e.radius,n=e.tileX,a=e.tileY,s=e.shape,f=e.opacity,v=e.stroke,m=e.strokeWidth,x=e.strokeOpacity,C=[],T=[],O=[],D=[Rv(i[0],i[1]),Rv(i[2],i[3])],Z=[Rv(v[0],v[1]),Rv(v[2],v[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(W){var Q=_slicedToArray(W,2),ye=Q[0],Be=Q[1];C.push([].concat(D,[(ye+1)*I2+(Be+1)*P2+getShapeIndex(s)*Mg+r,(n+512)*M2+(a+512)*C2])),T.push([].concat(Z,[m,x])),O.push([f,0,0,0])}),{packedBuffer:C,packedBuffer2:T,packedBuffer3:O}}function RP(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*R2+r*O2+n*Mg+r*T2+n*w2+r*A2+n*S2+r}var Ec;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(Ec||(Ec={}));var nu;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})(nu||(nu={}));var Yp;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(Yp||(Yp={}));var In;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(In||(In={}));var L2=["mapload","mapchange","mapAfterFrameChange"],Th={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},k0=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],qp;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(qp||(qp={}));function Pg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ig(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Pg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function k2(e){var i=D2();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function D2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var F2=0,Lv=function(e){(0,wr.Z)(r,e);var i=k2(r);function r(n){var a;return(0,st.Z)(this,r),a=i.call(this),(0,A.Z)((0,ae.Z)(a),"controlOption",void 0),(0,A.Z)((0,ae.Z)(a),"container",void 0),(0,A.Z)((0,ae.Z)(a),"sceneContainer",void 0),(0,A.Z)((0,ae.Z)(a),"mapsService",void 0),(0,A.Z)((0,ae.Z)(a),"renderService",void 0),(0,A.Z)((0,ae.Z)(a),"layerService",void 0),(0,A.Z)((0,ae.Z)(a),"controlService",void 0),(0,A.Z)((0,ae.Z)(a),"isShow",void 0),a.controlOption=Ig(Ig({},a.getDefault()),n||{}),a}return(0,Ct.Z)(r,[{key:"getDefault",value:function(){return{position:qp.TOPRIGHT,name:"".concat(F2++)}}},{key:"setPosition",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:qp.BOTTOMRIGHT,s=this.controlService;return s&&s.removeControl(this),this.controlOption.position=a,s&&s.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(a){this.mapsService=a.get(zt.IMapService),this.renderService=a.get(zt.IRendererService),this.layerService=a.get(zt.ILayerService),this.controlService=a.get(zt.IControlService),this.sceneContainer=a,this.isShow=!0,this.container=this.onAdd();var s=this.container,f=this.controlOption.position,v=this.controlService.controlCorners[f];return Ul(s,"l7-control"),f.indexOf("bottom")!==-1?v.insertBefore(s,v.firstChild):v.appendChild(s),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var a=this.container;Ul(a,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var a=this.container;rl(a,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;cc(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(a){if(this.mapsService&&a&&a.screenX>0&&a.screenY>0){var s=this.mapsService.getContainer();s!==null&&s.focus()}}}]),r}(jr.EventEmitter);function B2(e){var i=N2();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function N2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LP=function(e){(0,wr.Z)(r,e);var i=B2(r);function r(n){var a;return(0,st.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ae.Z)(a),"layerControlInputs",void 0),(0,A.Z)((0,ae.Z)(a),"layers",void 0),(0,A.Z)((0,ae.Z)(a),"lastZIndex",void 0),(0,A.Z)((0,ae.Z)(a),"handlingClick",void 0),(0,A.Z)((0,ae.Z)(a),"layersLink",void 0),(0,A.Z)((0,ae.Z)(a),"baseLayersList",void 0),(0,A.Z)((0,ae.Z)(a),"separator",void 0),(0,A.Z)((0,ae.Z)(a),"overlaysList",void 0),(0,A.Z)((0,ae.Z)(a),"form",void 0),a.layerControlInputs=[],a.layers=[],a.lastZIndex=0,a.handlingClick=!1,a.initLayers(),du(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,ae.Z)(a)),a}return(0,Ct.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:qp.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var a=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(s){s.layer.on("remove",a.onLayerChange),s.layer.on("add",a.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(a,s){return this.addLayer(a,s,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var a=this.renderService.getViewportSize(),s=a.height;Ul(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var f=s-(this.container.offsetTop+50);return f<this.form.clientHeight?(Ul(this.form,"l7-control-layers-scrollbar"),this.form.style.height=f+"px"):rl(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return rl(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var a=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(s){s.layer.off("remove",a.onLayerChange),s.layer.off("add",a.onLayerChange)}))}},{key:"initLayout",value:function(){var a="l7-control-layers",s=this.container=Za("div",a),f=this.controlOption.collapsed;s.setAttribute("aria-haspopup","true");var v=this.form=Za("form",a+"-list");f&&(this.mapsService.on("click",this.collapse),s.addEventListener("mouseenter",this.expand),s.addEventListener("mouseleave",this.collapse)),this.layersLink=Za("a",a+"-toggle",s);var m=this.layersLink;m.title="Layers",f||this.expand(),this.baseLayersList=Za("div",a+"-base",v),this.separator=Za("div",a+"-separator",v),this.overlaysList=Za("div",a+"-overlays",v),s.appendChild(v)}},{key:"initLayers",value:function(){var a=this,s=this.controlOption,f=s.baseLayers,v=f===void 0?{}:f,m=s.overlayers,x=m===void 0?{}:m;Object.keys(v).forEach(function(C,T){a.addLayer(v[C],C,!1)}),Object.keys(x).forEach(function(C,T){a.addLayer(x[C],C,!0)})}},{key:"update",value:function(){if(!this.container)return this;Zl(this.baseLayersList),Zl(this.overlaysList),this.layerControlInputs=[];var a,s,f,v,m=0;for(f=0;f<this.layers.length;f++)v=this.layers[f],this.addItem(v),s=s||v.overlay,a=a||!v.overlay,m+=v.overlay?0:1;return this.controlOption.hideSingleBase&&(a=a&&m>1,this.baseLayersList.style.display=a?"":"none"),this.separator.style.display=s&&a?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var a=this.layerControlInputs,s,f,v=this.mapsService.getZoom(),m=a.length-1;m>=0;m--)if(s=a[m],f=this.layerService.getLayer(s.layerId),f&&f.inited){var x=f.getMinZoom(),C=f.getMaxZoom();s.disabled=v<x||v>C}}},{key:"addLayer",value:function(a,s,f){this.mapsService&&(a.on("add",this.onLayerChange),a.on("remove",this.onLayerChange)),this.layers.push({layer:a,name:s,overlay:f});var v=this.controlOption,m=v.sortLayers,x=v.sortFunction,C=v.autoZIndex;m&&this.layers.sort(function(T,O){return x(T.layer,O.layer,T.name,O.name)}),C&&a.setZIndex&&(this.lastZIndex++,a.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(a){this.handlingClick||this.update();var s=this.layerService.getLayer(a.target.layerId),f=s!=null&&s.overlay?a.type==="add"?"overlayadd":"overlayremove":a.type==="add"?"baselayerchange":null;f&&this.emit(f,s)}},{key:"createRadioElement",value:function(a,s){var f='<input type="radio" class="l7-control-layers-selector" name="'+a+'"'+(s?' checked="checked"':"")+"/>",v=document.createElement("div");return v.innerHTML=f,v.firstChild}},{key:"addItem",value:function(a){var s=document.createElement("label"),f=this.layerService.getLayer(a.layer.id),v=f&&f.inited&&a.layer.isVisible(),m;a.overlay?(m=document.createElement("input"),m.type="checkbox",m.className="l7-control-layers-selector",m.defaultChecked=v):m=this.createRadioElement("l7-base-layers",v),this.layerControlInputs.push(m),m.layerId=a.layer.id,m.addEventListener("click",this.onInputClick);var x=document.createElement("span");x.innerHTML=" "+a.name;var C=document.createElement("div");s.appendChild(C),C.appendChild(m),C.appendChild(x);var T=a.overlay?this.overlaysList:this.baseLayersList;return T.appendChild(s),this.checkDisabledLayers(),s}},{key:"onInputClick",value:function(){var a=this.layerControlInputs,s,f,v=[],m=[];this.handlingClick=!0;for(var x=a.length-1;x>=0;x--)s=a[x],f=this.layerService.getLayer(s.layerId),s.checked?v.push(f):s.checked||m.push(f);m.forEach(function(C){C.hide()}),v.forEach(function(C){C.show()}),this.handlingClick=!1}}]),r}(Lv);function z2(e){var i=U2();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function U2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Z2=function(e){(0,wr.Z)(r,e);var i=z2(r);function r(){return(0,st.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getDefault",value:function(){return{position:qp.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var a="l7-control-logo",s=Za("div",a),f=Za("a","l7-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://antv.alipay.com/l7",f.setAttribute("aria-label","AntV logo"),f.setAttribute("rel","noopener nofollow"),s.appendChild(f),s}},{key:"onRemove",value:function(){return null}}]),r}(Lv);function j2(e){var i=V2();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function V2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kP=function(e){(0,wr.Z)(r,e);var i=j2(r);function r(n){var a;return(0,st.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ae.Z)(a),"mScale",void 0),(0,A.Z)((0,ae.Z)(a),"iScale",void 0),du(["update"],(0,ae.Z)(a)),a}return(0,Ct.Z)(r,[{key:"getDefault",value:function(){return{position:qp.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var a="l7-control-scale",s=Za("div",a);this.addScales(a+"-line",s);var f=this.controlOption.updateWhenIdle;return this.mapsService.on(f?"moveend":"mapmove",this.update),this.mapsService.on(f?"zoomend":"zoomchange",this.update),this.update(),s}},{key:"onRemove",value:function(){var a=this.controlOption.updateWhenIdle;this.mapsService.off(a?"zoomend":"zoomchange",this.update),this.mapsService.off(a?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var a=this.mapsService,s=this.controlOption.maxWidth,f=a.getSize()[1]/2,v=a.containerToLngLat([0,f]),m=a.containerToLngLat([s,f]),x=Cu([v.lng,v.lat],[m.lng,m.lat]);this.updateScales(x)}},{key:"updateScales",value:function(a){var s=this.controlOption,f=s.metric,v=s.imperial;f&&a&&this.updateMetric(a),v&&a&&this.updateImperial(a)}},{key:"updateMetric",value:function(a){var s=this.getRoundNum(a),f=s<1e3?s+" m":s/1e3+" km";this.updateScale(this.mScale,f,s/a)}},{key:"updateImperial",value:function(a){var s=a*3.2808399,f,v,m;s>5280?(f=s/5280,v=this.getRoundNum(f),this.updateScale(this.iScale,v+" mi",v/f)):(m=this.getRoundNum(s),this.updateScale(this.iScale,m+" ft",m/s))}},{key:"updateScale",value:function(a,s,f){var v=this.controlOption.maxWidth;a.style.width=Math.round(v*f)+"px",a.innerHTML=s}},{key:"getRoundNum",value:function(a){var s=Math.pow(10,(Math.floor(a)+"").length-1),f=a/s;return f=f>=10?10:f>=5?5:f>=3?3:f>=2?2:1,s*f}},{key:"addScales",value:function(a,s){var f=this.controlOption,v=f.metric,m=f.imperial;v&&(this.mScale=Za("div",a,s)),m&&(this.iScale=Za("div",a,s))}}]),r}(Lv);function G2(e){var i=H2();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function H2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DP=function(e){(0,wr.Z)(r,e);var i=G2(r);function r(n){var a;return(0,st.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,ae.Z)(a),"disabled",void 0),(0,A.Z)((0,ae.Z)(a),"zoomInButton",void 0),(0,A.Z)((0,ae.Z)(a),"zoomOutButton",void 0),du(["updateDisabled","zoomIn","zoomOut"],(0,ae.Z)(a)),a}return(0,Ct.Z)(r,[{key:"getDefault",value:function(){return{position:qp.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var a="l7-control-zoom",s=Za("div",a+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,a+"-in",s,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,a+"-out",s,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),s}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(a,s,f,v,m){var x=Za("a",f,v);return x.innerHTML=a,x.title=s,x.href="javascript:void(0)",x.addEventListener("click",m),x}},{key:"updateDisabled",value:function(){var a=this.mapsService,s="l7-disabled";rl(this.zoomInButton,s),rl(this.zoomOutButton,s),(this.disabled||a.getZoom()<=a.getMinZoom())&&Ul(this.zoomOutButton,s),(this.disabled||a.getZoom()>=a.getMaxZoom())&&Ul(this.zoomInButton,s)}}]),r}(Lv);function Og(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Rg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Og(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Og(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function W2(e){var i=X2();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function X2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lg=function(e){(0,wr.Z)(r,e);var i=W2(r);function r(n){var a;return(0,st.Z)(this,r),a=i.call(this),(0,A.Z)((0,ae.Z)(a),"markerOption",void 0),(0,A.Z)((0,ae.Z)(a),"defaultMarker",void 0),(0,A.Z)((0,ae.Z)(a),"popup",void 0),(0,A.Z)((0,ae.Z)(a),"mapsService",void 0),(0,A.Z)((0,ae.Z)(a),"sceneSerive",void 0),(0,A.Z)((0,ae.Z)(a),"lngLat",void 0),(0,A.Z)((0,ae.Z)(a),"scene",void 0),(0,A.Z)((0,ae.Z)(a),"added",!1),(0,A.Z)((0,ae.Z)(a),"eventHandle",function(s){a.emit(s.type,{target:s,data:a.markerOption.extData,lngLat:a.lngLat})}),a.markerOption=Rg(Rg({},a.getDefault()),n),du(["update","onMove","onUp","addDragHandler","onMapClick"],(0,ae.Z)(a)),a.init(),a}return(0,Ct.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:Vl.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(a){this.scene=a,this.mapsService=a.get(zt.IMapService),this.sceneSerive=a.get(zt.ISceneService);var s=this.markerOption,f=s.element,v=s.draggable;return this.mapsService.getMarkerContainer().appendChild(f),this.registerMarkerEvent(f),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var a=this.markerOption.element;return a&&cc(a),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(a){var s=this;if(!this.added)return this.once("added",function(){s.setElement(a)}),this;var f=this.markerOption.element;return f&&cc(f),this.markerOption.element=a,this.init(),this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.update(),this}},{key:"openPopup",value:function(){var a=this;if(!this.added)return this.once("added",function(){a.openPopup()}),this;var s=this.popup;return s?(s.isOpen()||s.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var a=this;this.added||this.once("added",function(){a.closePopup()});var s=this.popup;return s&&s.remove(),this}},{key:"setPopup",value:function(a){return this.popup=a,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var a=this.popup;if(a)a.isOpen()?a.remove():a.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(a){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(a){this.markerOption.extData=a}},{key:"update",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,f=a.anchor;this.updatePosition(),mo(s,"".concat(Tu[f]))}}},{key:"onMapClick",value:function(a){var s=this.markerOption.element;this.popup&&s&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,f=a.offsets,v=this.lngLat,m=v.lng,x=v.lat,C=this.mapsService.getBounds(),T=this.mapsService.lngLatToContainer([m,x]);if(s){s.style.display="block",s.style.whiteSpace="nowrap";var O=this.mapsService.getContainer(),D=0,Z=0;if(O&&(D=O.scrollWidth,Z=O.scrollHeight),Math.abs(C[0][0])>180||Math.abs(C[1][0])>180){if(T.x>D){var W=this.mapsService.lngLatToContainer([m-360,x]);T.x=W.x}if(T.x<0){var Q=this.mapsService.lngLatToContainer([m+360,x]);T.x=Q.x}}(T.x>D||T.x<0||T.y>Z||T.y<0)&&(s.style.display="none"),s.style.left=T.x+f[0]+"px",s.style.top=T.y-f[1]+"px"}}}},{key:"init",value:function(){var a=this,s=this.markerOption.element,f=this.markerOption,v=f.color,m=f.anchor;if(!s){this.defaultMarker=!0,s=Za("div"),this.markerOption.element=s;var x=document.createElementNS("http://www.w3.org/2000/svg","svg");x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height","48px"),x.setAttributeNS(null,"width","48px"),x.setAttributeNS(null,"viewBox","0 0 1024 1024");var C=document.createElementNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),C.setAttributeNS(null,"fill",v),x.appendChild(C),s.appendChild(x)}Ul(s,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(T){var O,D,Z=((O=a.markerOption)===null||O===void 0?void 0:O.style)&&((D=a.markerOption)===null||D===void 0?void 0:D.style[T]);s&&(s.style[T]=Z)}),s.addEventListener("click",function(T){a.onMapClick(T)}),s.addEventListener("click",this.eventHandle),Vs(s,m,"marker")}},{key:"registerMarkerEvent",value:function(a){a.addEventListener("mousemove",this.eventHandle),a.addEventListener("click",this.eventHandle),a.addEventListener("mousedown",this.eventHandle),a.addEventListener("mouseup",this.eventHandle),a.addEventListener("dblclick",this.eventHandle),a.addEventListener("contextmenu",this.eventHandle),a.addEventListener("mouseover",this.eventHandle),a.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var a=this.getElement();a.removeEventListener("mousemove",this.eventHandle),a.removeEventListener("click",this.eventHandle),a.removeEventListener("mousedown",this.eventHandle),a.removeEventListener("mouseup",this.eventHandle),a.removeEventListener("dblclick",this.eventHandle),a.removeEventListener("contextmenu",this.eventHandle),a.removeEventListener("mouseover",this.eventHandle),a.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(a){throw new Error("Method not implemented.")}},{key:"onUp",value:function(a){throw new Error("Method not implemented.")}}]),r}(jr.EventEmitter);function kg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Dg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?kg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):kg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Y2(e){var i=q2();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function q2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FP=function(e){(0,wr.Z)(r,e);var i=Y2(r);function r(n){var a,s;return(0,st.Z)(this,r),s=i.call(this),(0,A.Z)((0,ae.Z)(s),"markers",[]),(0,A.Z)((0,ae.Z)(s),"markerLayerOption",void 0),(0,A.Z)((0,ae.Z)(s),"clusterIndex",void 0),(0,A.Z)((0,ae.Z)(s),"points",[]),(0,A.Z)((0,ae.Z)(s),"clusterMarkers",[]),(0,A.Z)((0,ae.Z)(s),"mapsService",void 0),(0,A.Z)((0,ae.Z)(s),"scene",void 0),(0,A.Z)((0,ae.Z)(s),"zoom",void 0),(0,A.Z)((0,ae.Z)(s),"bbox",void 0),s.markerLayerOption=qn()(s.getDefault(),n),du(["update"],(0,ae.Z)(s)),s.zoom=((a=s.markerLayerOption.clusterOption)===null||a===void 0?void 0:a.zoom)||-99,s}return(0,Ct.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(a){return this.scene=a,this.mapsService=a.get(zt.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(a){var s=this.markerLayerOption.cluster;if(s&&(this.addPoint(a,this.markers.length),this.mapsService)){var f=this.mapsService.getZoom(),v=this.mapsService.getBounds();this.bbox=_l(v,.5),this.zoom=Math.floor(f),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(a)}},{key:"removeMarker",value:function(a){this.markers.indexOf(a);var s=this.markers.indexOf(a);s>-1&&this.markers.splice(s,1)}},{key:"hide",value:function(){this.markers.map(function(a){a.getElement().style.opacity="0"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(a){a.getElement().style.opacity="1"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var a=this.markerLayerOption.cluster;return a?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var a=this;this.getMarkers().forEach(function(s){s.addTo(a.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(a){a.remove()}),this.clusterMarkers.forEach(function(a){a.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(a,s){var f=a.getLnglat(),v=f.lng,m=f.lat,x={geometry:{type:"Point",coordinates:[v,m]},properties:Dg(Dg({},a.getExtData()),{},{marker_id:s})};this.points.push(x),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var a=this.markerLayerOption.clusterOption,s=a.radius,f=a.minZoom,v=f===void 0?0:f,m=a.maxZoom;this.clusterIndex=new(Zh())({radius:s,minZoom:v,maxZoom:m}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(a,s){var f=this,v=a[0].concat(a[1]),m=this.clusterIndex.getClusters(v,s);this.clusterMarkers.forEach(function(x){x.remove()}),this.clusterMarkers=[],m.forEach(function(x){var C,T=f.markerLayerOption.clusterOption,O=T.field,D=T.method;if(x.properties&&(C=x.properties)!==null&&C!==void 0&&C.cluster_id){var Z,W=f.getLeaves((Z=x.properties)===null||Z===void 0?void 0:Z.cluster_id);if(x.properties.clusterData=W,O&&D){var Q=W==null?void 0:W.map(function(_t){var mt=(0,A.Z)({},O,_t.properties[O]);return mt}),ye=Gu(Q,O),Be=ka(D,ye),qe="point_"+D;x.properties[qe]=Be.toFixed(2)}}var rt=f.clusterMarker(x);f.clusterMarkers.push(rt),rt.addTo(f.scene)})}},{key:"getLeaves",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return a?this.clusterIndex.getLeaves(a,s,f):null}},{key:"clusterMarker",value:function(a){var s=this.markerLayerOption.clusterOption,f=s,v=f.element,m=v===void 0?this.generateElement.bind(this):v,x=new Lg({element:m(a)}).setLnglat({lng:a.geometry.coordinates[0],lat:a.geometry.coordinates[1]});return x}},{key:"normalMarker",value:function(a){var s=a.properties.marker_id;return this.markers[s]}},{key:"update",value:function(){if(!!this.mapsService){var a=this.mapsService.getZoom(),s=this.mapsService.getBounds();(!this.bbox||Math.abs(a-this.zoom)>=1||!sa(this.bbox,s))&&(this.bbox=_l(s,.5),this.zoom=Math.floor(a),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(a){var s=Za("div","l7-marker-cluster"),f=Za("div","",s),v=Za("span","",f),m=this.markerLayerOption.clusterOption,x=m.field,C=m.method;a.properties.point_count=a.properties.point_count||1;var T=x&&C?a.properties["point_"+C]||a.properties[x]:a.properties.point_count;return v.textContent=T,s}}]),r}(jr.EventEmitter);function Fg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Bg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Fg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function K2(e){var i=$2();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function $2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ng=function(e){(0,wr.Z)(r,e);var i=K2(r);function r(n){var a;return(0,st.Z)(this,r),a=i.call(this),(0,A.Z)((0,ae.Z)(a),"popupOption",void 0),(0,A.Z)((0,ae.Z)(a),"mapsService",void 0),(0,A.Z)((0,ae.Z)(a),"sceneSerive",void 0),(0,A.Z)((0,ae.Z)(a),"lngLat",void 0),(0,A.Z)((0,ae.Z)(a),"content",void 0),(0,A.Z)((0,ae.Z)(a),"closeButton",void 0),(0,A.Z)((0,ae.Z)(a),"timeoutInstance",void 0),(0,A.Z)((0,ae.Z)(a),"container",void 0),(0,A.Z)((0,ae.Z)(a),"tip",void 0),(0,A.Z)((0,ae.Z)(a),"scene",void 0),a.popupOption=Bg(Bg({},a.getdefault()),n),du(["update","onClickClose","remove"],(0,ae.Z)(a)),a}return(0,Ct.Z)(r,[{key:"addTo",value:function(a){var s=this;return this.mapsService=a.get(zt.IMapService),this.sceneSerive=a.get(zt.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=a,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){s.mapsService.on("click",s.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(a){var s=window.document.createDocumentFragment(),f=window.document.createElement("body"),v;for(f.innerHTML=a;v=f.firstChild,!!v;)s.appendChild(v);return this.setDOMContent(s)}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(a){return this.setDOMContent(window.document.createTextNode(a))}},{key:"setMaxWidth",value:function(a){return this.popupOption.maxWidth=a,this.update(),this}},{key:"setDOMContent",value:function(a){return this.createContent(),this.content.appendChild(a),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&cc(this.content),this.content=Za("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Za("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(a,s,f){var v=window.document.createElement(a);return s!==void 0&&(v.className=s),f&&f.appendChild(v),v}},{key:"removeDom",value:function(a){a.parentNode&&a.parentNode.removeChild(a)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:Vl.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(a){a.stopPropagation&&a.stopPropagation(),this.remove()}},{key:"update",value:function(){var a=this,s=this.lngLat,f=this.popupOption,v=f.className,m=f.maxWidth,x=f.anchor;if(!(!this.mapsService||!s||!this.content)){var C=this.mapsService.getMarkerContainer();if(!this.container&&C){this.container=this.creatDom("div","l7-popup",C),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),v&&v.split(" ").forEach(function(O){return a.container.classList.add(O)});var T=this.popupOption.stopPropagation;T&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(O){a.container.addEventListener(O,function(D){D.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}m&&this.container.style.maxWidth!==m&&(this.container.style.maxWidth=m),this.updatePosition(),mo(this.container,"".concat(Tu[x])),Vs(this.container,x,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.lngLat,s=a.lng,f=a.lat,v=this.popupOption.offsets,m=this.mapsService.lngLatToContainer([s,f]);this.container.style.left=m.x+v[0]+"px",this.container.style.top=m.y-v[1]+"px"}}}]),r}(jr.EventEmitter);function Q2(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var f=i.createElement("style");return f.type="text/css",f.styleSheet?f.styleSheet.cssText=e:f.appendChild(i.createTextNode(e)),a.appendChild(f),f}}Q2(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var J2=ee(52353),eE=ee.n(J2),tE=ee(13218),qu=ee.n(tE),Kp,zg=(Kp={},(0,A.Z)(Kp,Ec.additive,{enable:!0,func:{srcRGB:j.ONE,dstRGB:j.ONE,srcAlpha:1,dstAlpha:1}}),(0,A.Z)(Kp,Ec.none,{enable:!1}),(0,A.Z)(Kp,Ec.normal,{enable:!0,func:{srcRGB:j.SRC_ALPHA,dstRGB:j.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,A.Z)(Kp,Ec.subtractive,{enable:!0,func:{srcRGB:j.ONE,dstRGB:j.ONE,srcAlpha:j.ZERO,dstAlpha:j.ONE_MINUS_SRC_COLOR},equation:{rgb:j.FUNC_SUBTRACT,alpha:j.FUNC_SUBTRACT}}),(0,A.Z)(Kp,Ec.max,{enable:!0,func:{srcRGB:j.ONE,dstRGB:j.ONE},equation:{rgb:j.MAX_EXT}}),(0,A.Z)(Kp,Ec.min,{enable:!0,func:{srcRGB:j.ONE,dstRGB:j.ONE},equation:{rgb:j.MIN_EXT}}),Kp),rE=ee(81763),Ku=ee.n(rE),BP=1024;function pl(e,i,r,n,a){i.updateStyleAttribute(e,r,n,a)}function nE(e,i){e.opacity&&kv("opacity",i,e.opacity),e.strokeWidth&&kv("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&kv("strokeOpacity",i,e.strokeOpacity),e.stroke&&iE("stroke",i,e.stroke),e.offsets&&Ug("offsets",i,e.offsets),e.textOffset&&Ug("textOffset",i,e.textOffset),e.thetaOffset&&kv("thetaOffset",i,e.thetaOffset)}function kv(e,i,r){Uo()(r)?pl(e,i,r,function(n){return n}):Ku()(r)?pl(e,i,[r],void 0):Array.isArray(r)&&r.length===2?Uo()(r[0])&&is()(r[1])||Uo()(r[0])&&Array.isArray(r[1])&&Ku()(r[1][0])&&Ku()(r[1][1])?pl(e,i,r[0],r[1]):pl(e,i,[1],void 0):pl(e,i,[1],void 0)}function Ug(e,i,r){Uo()(r)?pl(e,i,r,function(n){return n}):Array.isArray(r)&&r.length===2&&Uo()(r[0])&&is()(r[1])?pl(e,i,r[0],r[1]):Array.isArray(r)&&r.length===2&&Ku()(r[0])&&Ku()(r[1])?pl(e,i,r,void 0):pl(e,i,[0,0],void 0)}function iE(e,i,r){Uo()(r)?pl(e,i,r,void 0):Array.isArray(r)&&r.length===2&&(Uo()(r[0])&&is()(r[1])||Uo()(r[0])&&Array.isArray(r[1])&&r[1].length>0)?pl(e,i,r[0],r[1]):pl(e,i,"#fff",void 0)}var Bs;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(Bs||(Bs={}));function aE(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=hf(r),a=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return a}function oE(e,i){var r=this;e.length>0&&i.version===Bs["GAODE2.x"]&&(typeof e[0].coordinates[0]=="number"?e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=Bs["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=r.mapService.lngLatToCoord(n.coordinates)}):e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=Bs["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=r.mapService.lngLatToCoords(n.coordinates)}))}function sE(e,i){e.length>0&&i.version===Bs.SIMPLE&&e.map(function(r){r.simpleCoordinate||(r.coordinates=uE(r.coordinates,i),r.simpleCoordinate=!0)})}function uE(e,i){if(typeof e[0]=="number")return i.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var r=[];return e.map(function(a){var s=[];a.map(function(f){s.push(i.simpleMapCoord.unproject(f))}),r.push(s)}),r}else{var n=[];return e.map(function(a){n.push(i.simpleMapCoord.unproject(a))}),n}}function lE(e,i,r){var n;if(!e.scale)return[];var a=(e==null||(n=e.scale)===null||n===void 0?void 0:n.scalers)||[],s=[];a.forEach(function(v){var m,x=v.field;(i.hasOwnProperty(x)||((m=e.scale)===null||m===void 0?void 0:m.type)==="variable")&&s.push(i[x])});var f=e.mapping?e.mapping(s):[];return e.name==="color"&&!jl(f[0])?[r]:f}function cE(e,i,r,n,a,s){var f=s==null?void 0:s.getLayerConfig(),v=f.arrow,m=v===void 0?{enable:!1}:v,x=i.map(function(C){var T={id:C._id,coordinates:C.coordinates};if(e.filter(function(Z){return Z.scale!==void 0}).forEach(function(Z){var W=lE(Z,C,a);Z.needRemapping=!1,Z.name==="color"&&(W=W.map(function(Q){return Qi(Q)})),T[Z.name]=Array.isArray(W)&&W.length===1?W[0]:W,Z.name==="shape"&&(T.shape=r.getIconFontKey(T[Z.name]))}),T.shape==="line"&&m.enable){var O=T.coordinates,D=aE(O[0],O[1]);T.coordinates.splice(1,0,D,D)}return T});return oE(x,n),sE(x,n),x}function fE(e,i,r,n,a,s){var f=new sh(a,s),v=e.getBottomColor(),m=n.getLayerStyleAttributes()||[],x=f.data.dataArray,C=x,T=cE(m,C,i,r,v,e);return f.destroy(),T}function Zg(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function jg(e,i,r,n){var a=e.multiPassRenderer,s=e.getLayerConfig(),f=s.enablePicking,v=s.enableTAA;return v?a.add(n("taa")):a.add(n("render")),Zg(i).forEach(function(m){var x=(0,nn.Z)(m,2),C=x[0],T=x[1];a.add(r(C),T)}),a.add(r("copy")),a}var pE=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function hE(e,i,r){if(typeof i=="string"&&typeof r=="string"&&i!==r){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}pE.map(function(n){if(n.includes(i)&&n.includes(r)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var dE=["passes"],vE=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],Vg,D0,Gg;function mE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=gE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function gE(e,i){if(!!e){if(typeof e=="string")return Hg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Hg(e,i)}}function Hg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Wg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function $u(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Wg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yE(e){var i=_E();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function _E(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xg=0,$p=(Vg=L0(zt.IGlobalConfigService),D0=function(e){(0,wr.Z)(r,e);var i=yE(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,st.Z)(this,r),n=i.call(this),(0,A.Z)((0,ae.Z)(n),"id","".concat(Xg++)),(0,A.Z)((0,ae.Z)(n),"name","".concat(Xg)),(0,A.Z)((0,ae.Z)(n),"type",void 0),(0,A.Z)((0,ae.Z)(n),"visible",!0),(0,A.Z)((0,ae.Z)(n),"zIndex",0),(0,A.Z)((0,ae.Z)(n),"minZoom",void 0),(0,A.Z)((0,ae.Z)(n),"maxZoom",void 0),(0,A.Z)((0,ae.Z)(n),"inited",!1),(0,A.Z)((0,ae.Z)(n),"layerModelNeedUpdate",!1),(0,A.Z)((0,ae.Z)(n),"pickedFeatureID",null),(0,A.Z)((0,ae.Z)(n),"selectedFeatureID",null),(0,A.Z)((0,ae.Z)(n),"styleNeedUpdate",!1),(0,A.Z)((0,ae.Z)(n),"rendering",void 0),(0,A.Z)((0,ae.Z)(n),"clusterZoom",0),(0,A.Z)((0,ae.Z)(n),"layerType",void 0),(0,A.Z)((0,ae.Z)(n),"isLayerGroup",!1),(0,A.Z)((0,ae.Z)(n),"triangulation",void 0),(0,A.Z)((0,ae.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,A.Z)((0,ae.Z)(n),"hooks",{init:new $f,afterInit:new $f,beforeRender:new $f,beforeRenderData:new gf,afterRender:new tu,beforePickingEncode:new tu,afterPickingEncode:new tu,beforeHighlight:new tu(["pickedColor"]),afterHighlight:new tu,beforeSelect:new tu(["pickedColor"]),afterSelect:new tu,beforeDestroy:new tu,afterDestroy:new tu}),(0,A.Z)((0,ae.Z)(n),"models",[]),(0,A.Z)((0,ae.Z)(n),"multiPassRenderer",void 0),(0,A.Z)((0,ae.Z)(n),"plugins",void 0),(0,A.Z)((0,ae.Z)(n),"sourceOption",void 0),(0,A.Z)((0,ae.Z)(n),"layerModel",void 0),(0,A.Z)((0,ae.Z)(n),"shapeOption",void 0),(0,A.Z)((0,ae.Z)(n),"sceneContainer",void 0),(0,A.Z)((0,ae.Z)(n),"layerChildren",[]),(0,A.Z)((0,ae.Z)(n),"masks",[]),ti((0,ae.Z)(n),"configService",Gg,(0,ae.Z)(n)),(0,A.Z)((0,ae.Z)(n),"shaderModuleService",void 0),(0,A.Z)((0,ae.Z)(n),"cameraService",void 0),(0,A.Z)((0,ae.Z)(n),"coordinateService",void 0),(0,A.Z)((0,ae.Z)(n),"iconService",void 0),(0,A.Z)((0,ae.Z)(n),"fontService",void 0),(0,A.Z)((0,ae.Z)(n),"pickingService",void 0),(0,A.Z)((0,ae.Z)(n),"rendererService",void 0),(0,A.Z)((0,ae.Z)(n),"layerService",void 0),(0,A.Z)((0,ae.Z)(n),"interactionService",void 0),(0,A.Z)((0,ae.Z)(n),"mapService",void 0),(0,A.Z)((0,ae.Z)(n),"styleAttributeService",void 0),(0,A.Z)((0,ae.Z)(n),"layerSource",void 0),(0,A.Z)((0,ae.Z)(n),"postProcessingPassFactory",void 0),(0,A.Z)((0,ae.Z)(n),"normalPassFactory",void 0),(0,A.Z)((0,ae.Z)(n),"animateOptions",{enable:!1}),(0,A.Z)((0,ae.Z)(n),"container",void 0),(0,A.Z)((0,ae.Z)(n),"encodedData",void 0),(0,A.Z)((0,ae.Z)(n),"configSchema",void 0),(0,A.Z)((0,ae.Z)(n),"currentPickId",null),(0,A.Z)((0,ae.Z)(n),"rawConfig",void 0),(0,A.Z)((0,ae.Z)(n),"needUpdateConfig",void 0),(0,A.Z)((0,ae.Z)(n),"pendingStyleAttributes",[]),(0,A.Z)((0,ae.Z)(n),"scaleOptions",{}),(0,A.Z)((0,ae.Z)(n),"animateStartTime",void 0),(0,A.Z)((0,ae.Z)(n),"aniamateStatus",!1),(0,A.Z)((0,ae.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,A.Z)((0,ae.Z)(n),"isDestroied",!1),(0,A.Z)((0,ae.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var s=n.getLayerConfig(),f=s.autoFit,v=s.fitBoundsOptions;f&&n.fitBounds(v),n.reRender()}),n.name=a.name||n.id,n.zIndex=a.zIndex||0,n.rawConfig=a,n}return(0,Ct.Z)(r,[{key:"addMaskLayer",value:function(a){this.masks.push(a)}},{key:"removeMaskLayer",value:function(a){var s=this.masks.indexOf(a);s>-1&&this.masks.splice(s,1),a.destroy()}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(a){if(!this.inited)this.needUpdateConfig=$u($u({},this.needUpdateConfig),a);else{var s=this.container.get(zt.SceneID);nE(a,this),this.configService.setLayerConfig(s,this.id,$u($u($u({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),a)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(a,s){this.container=a,this.sceneContainer=s}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(a){this.bottomColor=a}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(a){return this.plugins.push(a),this}},{key:"init",value:function(){var a=this,s=this.container.get(zt.SceneID);this.configService.setLayerConfig(s,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(zt.IIconService),this.fontService=this.container.get(zt.IFontService),this.rendererService=this.container.get(zt.IRendererService),this.layerService=this.container.get(zt.ILayerService),this.interactionService=this.container.get(zt.IInteractionService),this.pickingService=this.container.get(zt.IPickingService),this.mapService=this.container.get(zt.IMapService);var f=this.getLayerConfig(),v=f.enableMultiPassRenderer,m=f.passes;v&&m!==null&&m!==void 0&&m.length&&m.length>0&&this.mapService.on("mapAfterFrameChange",function(){a.renderLayers()}),this.cameraService=this.container.get(zt.ICameraService),this.coordinateService=this.container.get(zt.ICoordinateSystemService),this.shaderModuleService=this.container.get(zt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(zt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(zt.IFactoryNormalPass),this.styleAttributeService=this.container.get(zt.IStyleAttributeService),this.multiPassRenderer=this.container.get(zt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(O){var D=O.attributeName,Z=O.attributeField,W=O.attributeValues,Q=O.updateOptions;a.styleAttributeService.updateStyleAttribute(D,{scale:$u({field:Z},a.splitValuesAndCallbackInAttribute(W,a.getLayerConfig()[D]))},Q)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(zt.ILayerPlugin);var x=mE(this.plugins),C;try{for(x.s();!(C=x.n()).done;){var T=C.value;T.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(O){x.e(O)}finally{x.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(a){a.attributes&&a.elements?this.models.map(function(s){s.updateAttributesAndElements(a.attributes,a.elements)}):console.warn("data error")}},{key:"createModelData",value:function(a,s){if(this.layerModel.createModelData)return this.layerModel.createModelData(s);var f=this.calculateEncodeData(a,s),v=this.triangulation;return f&&v?this.styleAttributeService.createAttributesAndIndices(f,v):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(a,s){return this.inited?fE(this,this.fontService,this.mapService,this.styleAttributeService,a,s):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig($u($u({},this.getDefaultConfig()),this.rawConfig));var a=this.getLayerConfig(),s=a.animateOption;s!=null&&s.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(a,s,f){return this.updateStyleAttribute("color",a,s,f),this}},{key:"texture",value:function(a,s,f){return this.updateStyleAttribute("texture",a,s,f),this}},{key:"rotate",value:function(a,s,f){return this.updateStyleAttribute("rotate",a,s,f),this}},{key:"size",value:function(a,s,f){return this.updateStyleAttribute("size",a,s,f),this}},{key:"filter",value:function(a,s,f){return this.updateStyleAttribute("filter",a,s,f),this}},{key:"shape",value:function(a,s,f){var v,m,x,C=(v=this.styleAttributeService)===null||v===void 0||(m=v.getLayerStyleAttribute("shape"))===null||m===void 0||(x=m.scale)===null||x===void 0?void 0:x.field,T=a;return this.shapeOption={field:a,values:s},this.updateStyleAttribute("shape",a,s,f),hE(this,C,T),this}},{key:"label",value:function(a,s,f){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:a,attributeValues:s,updateOptions:f}),this}},{key:"animate",value:function(a){var s={};return qu()(a)?(s.enable=!0,s=$u($u({},s),a)):s.enable=a,this.updateLayerConfig({animateOption:s}),this}},{key:"source",value:function(a,s){return a!=null&&a.data?(this.setSource(a),this):(this.sourceOption={data:a,options:s},this.clusterZoom=0,this)}},{key:"setData",value:function(a,s){var f=this;return this.inited?this.layerSource.setData(a,s):this.on("inited",function(){var v=f.getSource();v?f.layerSource.setData(a,s):(f.source(new sh(a,s)),f.sourceEvent())}),this}},{key:"style",value:function(a){var s=this,f=this.getLayerConfig(),v=a.passes,m=(0,Kc.Z)(a,dE);return v&&Zg(v).forEach(function(x){var C=s.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(x[0]);C&&C.updateOptions(x[1])}),this.rawConfig=$u($u({},this.rawConfig),m),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),f&&f.mask===!0&&a.mask===!1&&(this.clearModels(),this.models=this.layerModel.buildModels()),this}},{key:"scale",value:function(a,s){return qu()(a)?this.scaleOptions=$u($u({},this.scaleOptions),a):this.scaleOptions[a]=s,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"renderMultiPass",value:function(){var n=(0,d.Z)(w().mark(function s(){return w().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.getEncodedData().length===0){v.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){v.next=6;break}return v.next=4,this.multiPassRenderer.render();case 4:v.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return v.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"active",value:function(a){var s={};return s.enableHighlight=qu()(a)?!0:a,qu()(a)?(s.enableHighlight=!0,a.color&&(s.highlightColor=a.color),a.mix&&(s.activeMix=a.mix)):s.enableHighlight=!!a,this.updateLayerConfig(s),this}},{key:"setActive",value:function(a,s){var f=this;if(qu()(a)){var v=a.x,m=v===void 0?0:v,x=a.y,C=x===void 0?0:x;this.updateLayerConfig({highlightColor:qu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:qu()(s)?s.mix:this.getLayerConfig().activeMix}),this.pick({x:m,y:C})}else this.updateLayerConfig({pickedFeatureID:a,highlightColor:qu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:qu()(s)?s.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(vu(a)).then(function(){setTimeout(function(){f.reRender()},1)})}},{key:"select",value:function(a){var s={};return s.enableSelect=qu()(a)?!0:a,qu()(a)?(s.enableSelect=!0,a.color&&(s.selectColor=a.color),a.mix&&(s.selectMix=a.mix)):s.enableSelect=!!a,this.updateLayerConfig(s),this}},{key:"setSelect",value:function(a,s){var f=this;if(qu()(a)){var v=a.x,m=v===void 0?0:v,x=a.y,C=x===void 0?0:x;this.updateLayerConfig({selectColor:qu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:qu()(s)?s.mix:this.getLayerConfig().selectMix}),this.pick({x:m,y:C})}else this.updateLayerConfig({pickedFeatureID:a,selectColor:qu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:qu()(s)?s.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(vu(a)).then(function(){setTimeout(function(){f.reRender()},1)})}},{key:"setBlend",value:function(a){return this.updateLayerConfig({blend:a}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.type==="CanvasLayer"&&this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(a){return this.zIndex=a,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(a){this.currentPickId=a}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(a){this.selectedFeatureID=a}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var a=this.mapService.getZoom(),s=this.getLayerConfig(),f=s.visible,v=s.minZoom,m=v===void 0?-Infinity:v,x=s.maxZoom,C=x===void 0?Infinity:x;return!!f&&a>=m&&a<=C}},{key:"setMultiPass",value:function(a,s){if(this.updateLayerConfig({enableMultiPassRenderer:a}),s&&this.updateLayerConfig({passes:s}),a){var f=this.getLayerConfig(),v=f.passes,m=v===void 0?[]:v;this.multiPassRenderer=jg(this,m,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var x=this.rendererService.getViewportSize(),C=x.width,T=x.height;this.multiPassRenderer.resize(C,T)}return this}},{key:"setMinZoom",value:function(a){return this.updateLayerConfig({minZoom:a}),this}},{key:"getMinZoom",value:function(){var a=this.getLayerConfig(),s=a.minZoom;return s}},{key:"getMaxZoom",value:function(){var a=this.getLayerConfig(),s=a.maxZoom;return s}},{key:"get",value:function(a){var s=this.getLayerConfig();return s[a]}},{key:"setMaxZoom",value:function(a){return this.updateLayerConfig({maxZoom:a}),this}},{key:"setAutoFit",value:function(a){return this.updateLayerConfig({autoFit:a}),this}},{key:"fitBounds",value:function(a){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var s=this.getSource(),f=s.extent,v=f.some(function(m){return Math.abs(m)===Infinity});return v?this:(this.mapService.fitBounds([[f[0],f[1]],[f[2],f[3]]],a),this)}},{key:"destroy",value:function(){var a;this.isDestroied||(this.layerChildren.map(function(s){return s.destroy()}),this.layerChildren=[],this.masks.map(function(s){return s.destroy()}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(a=this.layerModel)===null||a===void 0||a.clearModels(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(a){return a.destroy()}),this.layerModel.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(a){return a.needRescale||a.needRemapping||a.needRegenerateVertices}).length}},{key:"setSource",value:function(a){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=a,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(a){this.encodedData=a}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(a){return this.styleAttributeService.getLayerAttributeScale(a)}},{key:"getLegendItems",value:function(a){var s=this.styleAttributeService.getLayerAttributeScale(a);if(!s)return[];if(s.invertExtent){var f=s.range().map(function(x){return(0,A.Z)({value:s.invertExtent(x)},a,x)});return f}else if(s.ticks){var v=s.ticks().map(function(x){return(0,A.Z)({value:x},a,s(x))});return v}else if(s!=null&&s.domain){var m=s.domain().filter(function(x){return!eE()(x)}).map(function(x){return(0,A.Z)({value:x},a,s(x))});return m}return[]}},{key:"pick",value:function(a){var s=a.x,f=a.y;this.interactionService.triggerHover({x:s,y:f})}},{key:"boxSelect",value:function(a,s){this.pickingService.boxPickLayer(this,a,s)}},{key:"buildLayerModel",value:function(a){var s=a.moduleName,f=a.vertexShader,v=a.fragmentShader,m=a.triangulation,x=a.segmentNumber,C=(0,Kc.Z)(a,vE);this.shaderModuleService.registerModule(s,{vs:f,fs:v});var T=this.shaderModuleService.getModule(s),O=T.vs,D=T.fs,Z=T.uniforms,W=this.rendererService.createModel,Q=this.styleAttributeService.createAttributesAndIndices(this.encodedData,m,x),ye=Q.attributes,Be=Q.elements;return W($u({attributes:ye,uniforms:Z,fs:D,vs:O,elements:Be,blend:zg[Ec.normal]},C))}},{key:"createAttrubutes",value:function(a){var s=a.triangulation,f=this.styleAttributeService.createAttributes(this.encodedData,s),v=f.attributes;return v}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(a){var s=this.getLayerConfig(),f=s.enableHighlight,v=f===void 0?!0:f,m=s.enableSelect,x=m===void 0?!0:m,C=this.eventNames().indexOf(a)!==-1||this.eventNames().indexOf("un"+a)!==-1;return(a==="click"||a==="dblclick")&&x&&(C=!0),a==="mousemove"&&(v||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(C=!0),this.isVisible()&&C}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=(0,d.Z)(w().mark(function s(f){return w().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,f.render();case 2:case"end":return m.stop()}},s)}));function a(s){return n.apply(this,arguments)}return a}()},{key:"renderModels",value:function(a){var s=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.layerModel.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(f){f.draw({uniforms:s.layerModel.getUninforms()},a)})),this}},{key:"updateStyleAttribute",value:function(a,s,f,v){this.inited?this.styleAttributeService.updateStyleAttribute(a,{scale:$u({field:s},this.splitValuesAndCallbackInAttribute(f,this.getLayerConfig()[s]))},v):this.pendingStyleAttributes.push({attributeName:a,attributeField:s,attributeValues:f,updateOptions:v})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(a){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(a,s){return{values:is()(a)?void 0:a||s,callback:is()(a)?a:void 0}}}]),r}(jr.EventEmitter),Gg=ci(D0.prototype,"configService",[Vg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D0),xE=ee(18446),hd=ee.n(xE),Yg,F0,qg;function bE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=EE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function EE(e,i){if(!!e){if(typeof e=="string")return Kg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Kg(e,i)}}function Kg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var po=(Yg=L0(zt.IGlobalConfigService),F0=function(){function e(i){(0,st.Z)(this,e),(0,A.Z)(this,"triangulation",void 0),(0,A.Z)(this,"createTexture2D",void 0),(0,A.Z)(this,"layer",void 0),(0,A.Z)(this,"dataTexture",void 0),(0,A.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,A.Z)(this,"rowCount",void 0),(0,A.Z)(this,"cacheStyleProperties",void 0),(0,A.Z)(this,"cellLength",void 0),(0,A.Z)(this,"cellProperties",void 0),(0,A.Z)(this,"cellTypeLayout",void 0),(0,A.Z)(this,"stylePropertyesExist",void 0),(0,A.Z)(this,"dataTextureTest",void 0),ti(this,"configService",qg,this),(0,A.Z)(this,"shaderModuleService",void 0),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"iconService",void 0),(0,A.Z)(this,"fontService",void 0),(0,A.Z)(this,"styleAttributeService",void 0),(0,A.Z)(this,"mapService",void 0),(0,A.Z)(this,"cameraService",void 0),(0,A.Z)(this,"layerService",void 0),this.layer=i,this.rendererService=i.getContainer().get(zt.IRendererService),this.shaderModuleService=i.getContainer().get(zt.IShaderModuleService),this.styleAttributeService=i.getContainer().get(zt.IStyleAttributeService),this.mapService=i.getContainer().get(zt.IMapService),this.iconService=i.getContainer().get(zt.IIconService),this.fontService=i.getContainer().get(zt.IFontService),this.cameraService=i.getContainer().get(zt.ICameraService),this.layerService=i.getContainer().get(zt.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:j.NEAREST,min:j.NEAREST,width:1,height:1}))}return(0,Ct.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return hd()(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),hd()(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),hd()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),hd()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),hd()(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),hd()(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!Ku()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!Ku()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!Ku()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!Ku()(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return Uo()(r)?!!(0,hc.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=Qi(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Array.isArray(r)&&r.length===2&&Ku()(r[0])&&Ku()(r[1]))}},{key:"patchMod",value:function(r,n){for(var a=0;a<n;a++)r.push(-1)}},{key:"patchData",value:function(r,n,a){var s=bE(a),f;try{for(s.s();!(f=s.n()).done;){var v=f.value,m=v.attr,x=v.count,C=n[m];C!==void 0?m==="stroke"?r.push.apply(r,(0,Se.Z)(Qi(C))):m==="offsets"?this.isOffsetStatic(C)?r.push(-C[0],C[1]):r.push(0,0):r.push(Ku()(C)?C:1):this.patchMod(r,x)}}catch(T){s.e(T)}finally{s.f()}}},{key:"calDataFrame",value:function(r,n,a){for(var s=n.length,f=Math.ceil(s*r/this.DATA_TEXTURE_WIDTH),v=f*this.DATA_TEXTURE_WIDTH,m=[],x=0;x<s;x++){var C=n[x];this.patchData(m,C,a)}for(var T=m.length;T<v;T++)m.push(-1);return{data:m,width:this.DATA_TEXTURE_WIDTH,height:f}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,a=n===void 0?"normal":n;return zg[Ec[a]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),qg=ci(F0.prototype,"configService",[Yg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F0),SE=ee(9187),Bf=ee.n(SE),$g=100,NP=36,zP=40;function Qg(e){return e/180*Math.acos(-1)}function Jg(e){var i=Qg(e[0])+Math.PI/2,r=Qg(e[1]),n=$g+Math.random()*.4,a=n*Math.cos(r)*Math.cos(i),s=n*Math.cos(r)*Math.sin(i),f=n*Math.sin(r);return[s,f,a]}function UP(e,i){var r=mat4.create(),n=mat4.create(),a=vec3.fromValues(0,1,0),s=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var f=typeof i.segments!="undefined"?i.segments:32,v=2+f,m=2*v,x=[],C=[],T=[],O=[],D=[],Z=[],W=0;W<=v;W++){for(var Q=W/v,ye=Q*Math.PI,Be=0;Be<=m;Be++){var qe=Be/m,rt=qe*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-ye),mat4.identity(r),mat4.rotateY(r,r,rt),vec3.transformMat4(s,a,n),vec3.transformMat4(s,s,r),vec3.scale(s,s,-e),T.push(s.slice()),O.push.apply(O,_toConsumableArray(s.slice())),vec3.normalize(s,s),D.push.apply(D,_toConsumableArray(s.slice())),Z.push([qe,1-Q]),O.push(qe,1-Q)}if(W>0)for(var _t=T.length,mt=_t-2*(m+1);mt+m+2<_t;mt++)x.push([mt,mt+1,mt+m+1]),C.push(mt,mt+1,mt+m+1),x.push([mt+m+1,mt+1,mt+m+2]),C.push(mt+m+1,mt+1,mt+m+2)}return{cells:x,positions:T,uvs:Z,positionsArr:O,indicesArr:C,normalArr:D}}var bi=ee(31437),Dv=bi.create(),ZP=bi.create(),Ys=bi.create(),Qp=bi.create(),dd=bi.create();function B0(e,i,r,n,a){bi.add(e,r,n),bi.normalize(e,e),i=bi.fromValues(-e[1],e[0]);var s=bi.fromValues(-r[1],r[0]);return[a/bi.dot(i,s),i]}function Jp(e,i){return bi.set(e,-i[1],i[0])}function vd(e,i,r){return bi.sub(e,i,r),bi.normalize(e,e),e}function N0(e,i){return e[0]===i[0]&&e[1]===i[1]}function jP(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var ey=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,st.Z)(this,e),(0,A.Z)(this,"complex",void 0),(0,A.Z)(this,"join",void 0),(0,A.Z)(this,"cap",void 0),(0,A.Z)(this,"miterLimit",void 0),(0,A.Z)(this,"thickness",void 0),(0,A.Z)(this,"normal",void 0),(0,A.Z)(this,"lastFlip",-1),(0,A.Z)(this,"miter",bi.fromValues(0,0)),(0,A.Z)(this,"started",!1),(0,A.Z)(this,"dash",!1),(0,A.Z)(this,"totalDistance",0),(0,A.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,Ct.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,f=a.startIndex,v=1;v<s;v++){var m,x,C,T=r[v-1];T.push((m=n[v-1][2])!==null&&m!==void 0?m:0);var O=n[v-1],D=r[v];D.push((x=n[v][2])!==null&&x!==void 0?x:0);var Z=n[v],W=v<r.length-1?[].concat((0,Se.Z)(r[v+1]),[(C=n[v+1][2])!==null&&C!==void 0?C:0]):null,Q=v<n.length-1?n[v+1]:null,ye=this.segment_gaode2(a,f,T,D,W,O,Z,Q);f+=ye}if(this.dash)for(var Be=0;Be<a.positions.length/6;Be++)a.positions[Be*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"simpleExtrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,f=a.startIndex,v=1;v<s;v++){var m,x,C,T=r[v-1];T.push((m=n[v-1][2])!==null&&m!==void 0?m:0);var O=n[v-1],D=r[v];D.push((x=n[v][2])!==null&&x!==void 0?x:0);var Z=n[v],W=v<r.length-1?[].concat((0,Se.Z)(r[v+1]),[(C=n[v+1][2])!==null&&C!==void 0?C:0]):null,Q=v<n.length-1?n[v+1]:null,ye=this.simpleSegment(a,f,T,D,W,O,Z,Q);f+=ye}if(this.dash)for(var Be=0;Be<a.positions.length/6;Be++)a.positions[Be*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,f=1;f<a;f++){var v=r[f-1],m=r[f],x=f<r.length-1?r[f+1]:null,C=this.segment(n,s,v,m,x);s+=C}if(this.dash)for(var T=0;T<n.positions.length/6;T++)n.positions[T*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,f=1;f<a;f++){var v=r[f-1],m=r[f],x=f<r.length-1?r[f+1]:null,C=this.simpleSegment(n,s,v,m,x);s+=C}if(this.dash)for(var T=0;T<n.positions.length/6;T++)n.positions[T*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,a,s,f,v,m,x){var C=0,T=r.indices,O=r.positions,D=r.normals,Z=this.cap==="square",W=this.join==="bevel",Q=Oo([m[0],m[1]]),ye=Oo([v[0],v[1]]);vd(Ys,s,a);var Be=0;if(this.dash&&(Be=this.lineSegmentDistance(Q,ye),this.totalDistance+=Be),this.normal||(this.normal=bi.create(),Jp(this.normal,Ys)),!this.started)if(this.started=!0,Z){var qe=bi.create(),rt=bi.create();bi.add(qe,this.normal,Ys),bi.add(rt,this.normal,Ys),D.push(rt[0],rt[1],0),D.push(qe[0],qe[1],0),O.push(a[0],a[1],a[2]|0,this.totalDistance-Be,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),O.push(a[0],a[1],a[2]|0,this.totalDistance-Be,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(O,D,a,this.normal,this.thickness,this.totalDistance-Be);if(T.push(n+0,n+1,n+2),f){N0(s,f)&&bi.add(f,s,bi.normalize(f,bi.subtract(f,s,a))),vd(Qp,f,s);var Ht=B0(dd,bi.create(),Ys,Qp,this.thickness),rr=(0,nn.Z)(Ht,2),Cr=rr[0],qr=rr[1],gr=bi.dot(dd,this.normal)<0?-1:1,sn=W;if(!sn&&this.join==="miter"){var Rn=Cr;Rn>this.miterLimit&&(sn=!0)}sn?(D.push(this.normal[0],this.normal[1],0),D.push(qr[0],qr[1],0),O.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*gr,s[2]|0),this.complex.indexes.push(this.currentIndex),O.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*gr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,T.push.apply(T,(0,Se.Z)(this.lastFlip!==-gr?[n,n+2,n+3]:[n+2,n+1,n+3])),T.push(n+2,n+3,n+4),Jp(Dv,Qp),bi.copy(this.normal,Dv),D.push(this.normal[0],this.normal[1],0),O.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*gr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,C+=3):(this.extrusions(O,D,s,qr,Cr,this.totalDistance),T.push.apply(T,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),gr=-1,bi.copy(this.normal,qr),C+=2),this.lastFlip=gr}else{if(Jp(this.normal,Ys),Z){var _t=bi.create(),mt=bi.create();bi.sub(mt,Ys,this.normal),bi.add(_t,Ys,this.normal),D.push(mt[0],mt[1],0),D.push(_t[0],_t[1],0),O.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),O.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(O,D,s,this.normal,this.thickness,this.totalDistance);T.push.apply(T,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),C+=2}return C}},{key:"simpleSegment",value:function(r,n,a,s,f){var v=0,m=r.indices,x=r.positions,C=r.normals,T=Oo([s[0],s[1]]),O=Oo([a[0],a[1]]);vd(Ys,T,O);var D=0;if(this.dash&&(D=this.lineSegmentDistance(T,O),this.totalDistance+=D),this.normal||(this.normal=bi.create(),Jp(this.normal,Ys)),this.started||(this.started=!0,this.extrusions(x,C,a,this.normal,this.thickness,this.totalDistance-D)),m.push(n+0,n+1,n+2),!f)Jp(this.normal,Ys),this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance),m.push.apply(m,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2;else{var Z=Oo([f[0],f[1]]);N0(T,Z)&&bi.add(Z,T,bi.normalize(Z,bi.subtract(Z,T,O))),vd(Qp,Z,T);var W=B0(dd,bi.create(),Ys,Qp,this.thickness),Q=(0,nn.Z)(W,2),ye=Q[0],Be=Q[1],qe=bi.dot(dd,this.normal)<0?-1:1;this.extrusions(x,C,s,Be,ye,this.totalDistance),m.push.apply(m,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),qe=-1,bi.copy(this.normal,Be),v+=2,this.lastFlip=qe}return v}},{key:"segment",value:function(r,n,a,s,f){var v=0,m=r.indices,x=r.positions,C=r.normals,T=this.cap==="square",O=this.join==="bevel",D=Oo([s[0],s[1]]),Z=Oo([a[0],a[1]]);vd(Ys,D,Z);var W=0;if(this.dash&&(W=this.lineSegmentDistance(D,Z),this.totalDistance+=W),this.normal||(this.normal=bi.create(),Jp(this.normal,Ys)),!this.started)if(this.started=!0,T){var Q=bi.create(),ye=bi.create();bi.add(Q,this.normal,Ys),bi.add(ye,this.normal,Ys),C.push(ye[0],ye[1],0),C.push(Q[0],Q[1],0),x.push(a[0],a[1],a[2]|0,this.totalDistance-W,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),x.push(a[0],a[1],a[2]|0,this.totalDistance-W,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(x,C,a,this.normal,this.thickness,this.totalDistance-W);if(m.push(n+0,n+1,n+2),f){var rt=Oo([f[0],f[1]]);N0(D,rt)&&bi.add(rt,D,bi.normalize(rt,bi.subtract(rt,D,Z))),vd(Qp,rt,D);var _t=B0(dd,bi.create(),Ys,Qp,this.thickness),mt=(0,nn.Z)(_t,2),Ht=mt[0],rr=mt[1],Cr=bi.dot(dd,this.normal)<0?-1:1,qr=O;if(!qr&&this.join==="miter"){var gr=Ht;gr>this.miterLimit&&(qr=!0)}qr?(C.push(this.normal[0],this.normal[1],0),C.push(rr[0],rr[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Cr,s[2]|0),this.complex.indexes.push(this.currentIndex),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*Cr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,m.push.apply(m,(0,Se.Z)(this.lastFlip!==-Cr?[n,n+2,n+3]:[n+2,n+1,n+3])),m.push(n+2,n+3,n+4),Jp(Dv,Qp),bi.copy(this.normal,Dv),C.push(this.normal[0],this.normal[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Cr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,v+=3):(this.extrusions(x,C,s,rr,Ht,this.totalDistance),m.push.apply(m,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Cr=-1,bi.copy(this.normal,rr),v+=2),this.lastFlip=Cr}else{if(Jp(this.normal,Ys),T){var Be=bi.create(),qe=bi.create();bi.sub(qe,Ys,this.normal),bi.add(Be,Ys,this.normal),C.push(qe[0],qe[1],0),C.push(Be[0],Be[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance);m.push.apply(m,(0,Se.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2}return v}},{key:"extrusions",value:function(r,n,a,s,f,v){n.push(s[0],s[1],0),n.push(s[0],s[1],0),r.push(a[0],a[1],a[2]|0,v,-f,a[2]|0),this.complex.indexes.push(this.currentIndex),r.push(a[0],a[1],a[2]|0,v,f,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var a=n[0]-r[0],s=n[1]-r[1];return Math.sqrt(a*a+s*s)}}]),e}();function Mh(e){if(Ku()(e[0]))return e;if(Ku()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Ku()(e[0][0][0])){var i=e,r=0,n=0,a=0;return i.forEach(function(s){s.forEach(function(f){r+=f[0],n+=f[1],a++})}),[r/a,n/a,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function CE(e){for(var i=e[0],r=e[1],n=e[0],a=e[1],s=0,f=0,v=0,m=0;m<e.length;m+=2){var x=e[m],C=e[m+1];x&&C&&(i=Math.max(x,i),r=Math.max(C,r),n=Math.min(x,n),a=Math.min(C,a),s+=x,f+=C,v++)}return{center:[s/v,f/v],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-a,2))/2}}var Xa=ee(77160);function AE(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,a=Bf().flatten(e),s=a.vertices,f=a.dimensions,v=[],m=[],x=0;x<s.length/f;x++)f===2?v.push(s[x*2],s[x*2+1],1):v.push(s[x*3],s[x*3+1],1);var C=Bf()(a.vertices,a.holes,a.dimensions);m.push.apply(m,(0,Se.Z)(C));for(var T=function(Z){var W=a.vertices.slice(Z*f,(Z+1)*f),Q=a.vertices.slice((Z+1)*f,(Z+2)*f);Q.length===0&&(Q=a.vertices.slice(0,f));var ye=v.length/3;v.push(W[0],W[1],1,Q[0],Q[1],1,W[0],W[1],0,Q[0],Q[1],0),m.push.apply(m,(0,Se.Z)([0,2,1,2,3,1].map(function(Be){return Be+ye})))},O=0;O<n;O++)T(O);return{positions:v,index:m}}function wE(e){var i=Bf().flatten(e),r=Bf()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function ty(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var a=e[0].length,s=Bf().flatten(e),f=s.vertices,v=s.dimensions,m=[],x=[],C=[],T=0;T<f.length/v;T++)v===2?m.push(f[T*2],f[T*2+1],1,-1,-1):m.push(f[T*3],f[T*3+1],1,-1,-1),C.push(0,0,1);var O=Bf()(s.vertices,s.holes,s.dimensions);x.push.apply(x,(0,Se.Z)(O));for(var D=function(Q){var ye=s.vertices.slice(Q*v,(Q+1)*v),Be=s.vertices.slice((Q+1)*v,(Q+2)*v);Be.length===0&&(Be=s.vertices.slice(0,v));var qe=m.length/5;m.push(ye[0],ye[1],1,0,0,Be[0],Be[1],1,.1,0,ye[0],ye[1],0,0,.8,Be[0],Be[1],0,.1,.8);var rt=TE([Be[0],Be[1],1],[ye[0],ye[1],0],[ye[0],ye[1],1],i);C.push.apply(C,(0,Se.Z)(rt).concat((0,Se.Z)(rt),(0,Se.Z)(rt),(0,Se.Z)(rt))),x.push.apply(x,(0,Se.Z)([1,2,0,3,2,1].map(function(_t){return _t+qe})))},Z=0;Z<a;Z++)D(Z);return{positions:m,index:x,normals:C}}function TE(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=Xa.create(),s=Xa.create(),f=Xa.create();n&&(e=js(e),i=js(i),r=js(r));var v=Xa.fromValues.apply(Xa,(0,Se.Z)(e)),m=Xa.fromValues.apply(Xa,(0,Se.Z)(i)),x=Xa.fromValues.apply(Xa,(0,Se.Z)(r));Xa.sub(a,x,m),Xa.sub(s,v,m),Xa.cross(f,a,s);var C=Xa.create();return Xa.normalize(C,f),C}var Sc,Ph;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Ph||(Ph={}));var Ih;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Ih||(Ih={}));function Jd(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],a=0;a<e;a++)n.push(r*a+i*Math.PI/12);var s=n.map(function(f){var v=Math.sin(f+Math.PI/4),m=Math.cos(f+Math.PI/4);return[v,m,0]});return s}function ry(){return Jd(30)}function ny(){return Jd(4)}function iy(){return Jd(3)}function ay(){return Jd(6,1)}function oy(){return Jd(5)}var md=(Sc={},(0,A.Z)(Sc,Ih.CIRCLE,ry),(0,A.Z)(Sc,Ih.HEXAGON,ay),(0,A.Z)(Sc,Ih.TRIANGLE,iy),(0,A.Z)(Sc,Ih.SQUARE,ny),(0,A.Z)(Sc,Ih.PENTAGON,oy),(0,A.Z)(Sc,Ph.CYLINDER,ry),(0,A.Z)(Sc,Ph.HEXAGONCOLUMN,ay),(0,A.Z)(Sc,Ph.TRIANGLECOLUMN,iy),(0,A.Z)(Sc,Ph.SQUARECOLUMN,ny),(0,A.Z)(Sc,Ph.PENTAGONCOLUMN,oy),Sc),Fv={};function Oh(e){var i=Mh(e.coordinates);return{vertices:[].concat((0,Se.Z)(i),(0,Se.Z)(i),(0,Se.Z)(i),(0,Se.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function sy(e){var i=Mh(e.coordinates),r=Jg(i);return{vertices:[].concat((0,Se.Z)(r),(0,Se.Z)(r),(0,Se.Z)(r),(0,Se.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function uy(e){var i=e.shape,r=OE(i,!1),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function ly(e){var i=Mh(e.coordinates);return{vertices:(0,Se.Z)(i),indices:[0],size:i.length}}function ev(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new ey({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var f=r;Array.isArray(f[0][0])||(f=[r]);for(var v=0;v<s.length;v++){var m=s[v],x=f[v];a.extrude_gaode2(m,x)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(O){a.extrude(O)})}var T=a.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,indexes:T.indexes,size:6}}function ME(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new ey({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var f=r;Array.isArray(f[0][0])||(f=[r]);for(var v=0;v<s.length;v++){var m=s[v],x=f[v];a.simpleExtrude_gaode2(m,x)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(O){a.simpleExtrude(O)})}var T=a.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,size:6}}function Bv(e){var i=e.coordinates,r=Bf().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Bf()(n,s,a),vertices:n,size:a}}function PE(e){var i=e.coordinates,r=Bf().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Bf()(n,s,a),vertices:IE(n),size:a+4}}function IE(e){for(var i=[],r=CE(e),n=r.center,a=r.radius,s=0;s<e.length;s+=2){var f=e[s],v=e[s+1];i.push.apply(i,[f,v,0].concat((0,Se.Z)(n),[a]))}return i}function cy(e){var i=e.coordinates,r=ty(i,!0),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function fy(e){var i=e.shape,r=LE(i),n=r.positions,a=r.index;return{vertices:n,indices:a,size:3}}function py(e){var i=e.coordinates,r=[].concat((0,Se.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,Se.Z)(i[1]),[0,1,0],(0,Se.Z)(i[0]),[0,0,1],(0,Se.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function Nv(e,i){for(var r=i||30,n=e.coordinates,a=[],s=[],f=function(x){a.push(x,1,x,n[0][0],n[0][1],n[1][0],n[1][1],x,-1,x,n[0][0],n[0][1],n[1][0],n[1][1]),x!==r-1&&s.push.apply(s,(0,Se.Z)([0,1,2,1,3,2].map(function(C){return x*2+C})))},v=0;v<r;v++)f(v);return{vertices:a,indices:s,size:7}}function hy(e){var i=e.coordinates;i.length===2&&i.push(0);var r=e.size,n=zv(-1,1),a=zv(1,1),s=zv(-1,-1),f=zv(1,-1),v=[].concat((0,Se.Z)(i),(0,Se.Z)(n),(0,Se.Z)(i),(0,Se.Z)(s),(0,Se.Z)(i),(0,Se.Z)(f),(0,Se.Z)(i),(0,Se.Z)(a)),m=[0,1,2,3,0,2];return{vertices:v,indices:m,size:5}}function OE(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Fv&&Fv[e])return Fv[e];var r=md[e]?md[e]():md.cylinder(),n=ty([r],i);return Fv[e]=n,n}function VP(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=new Float32Array(e.length/r*3),s,f,v,m=vec3.create(),x=vec3.create(),C=vec3.create(),T=0,O=i.length;T<O;T+=3){s=i[T+0]*3,f=i[T+1]*3,v=i[T+2]*3;var D=[e[s],e[s+1]],Z=[e[f],e[f+1]],W=[e[v],e[v+1]];n&&(D=lngLatToMeters(D),Z=lngLatToMeters(Z),W=lngLatToMeters(W));var Q=D,ye=_slicedToArray(Q,2),Be=ye[0],qe=ye[1],rt=vec3.fromValues(Be,qe,e[s+2]),_t=Z,mt=_slicedToArray(_t,2),Ht=mt[0],rr=mt[1],Cr=vec3.fromValues(Ht,rr,e[f+2]),qr=W,gr=_slicedToArray(qr,2),sn=gr[0],Rn=gr[1],Un=vec3.fromValues(sn,Rn,e[v+2]);vec3.sub(m,Un,Cr),vec3.sub(x,rt,Cr),vec3.cross(C,m,x),a[s]+=m[0],a[s+1]+=m[1],a[s+2]+=m[2],a[f]+=m[0],a[f+1]+=m[1],a[f+2]+=m[2],a[v]+=m[0],a[v+1]+=m[1],a[v+2]+=m[2]}return RE(a),a}function RE(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),a=vec3.create();vec3.normalize(a,n),e.set(a,i)}}function GP(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function LE(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=md[e]?md[e]():md.circle(),n=i.indexOf(e)===-1?wE([r]):AE([r]);return n}function zv(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function HP(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function WP(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function kE(e){var i=DE();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function DE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FE=`uniform float u_opacity;
varying vec4 v_Color;

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
}
`,BE=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"

void main() {

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,NE=function(e){(0,wr.Z)(r,e);var i=kE(r);function r(){return(0,st.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?0:s;return{u_opacity:Ku()(f)?f:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"mask",vertexShader:BE,fragmentShader:FE,triangulation:Bv,blend:this.getBlend(),depth:{enable:!1},stencil:{enable:!0,mask:255,func:{cmp:j.ALWAYS,ref:1,mask:255},opFront:{fail:j.REPLACE,zfail:j.REPLACE,zpass:j.REPLACE}}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(po),zE={fill:NE},UE=zE;function ZE(e){var i=jE();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function jE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VE=function(e){(0,wr.Z)(r,e);var i=ZE(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"type","MaskLayer"),n}return(0,Ct.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new UE[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"fill"}}]),r}($p),GE=ee(88307),HE=ee.n(GE),WE=function(){function e(i,r){(0,st.Z)(this,e),(0,A.Z)(this,"attribute",void 0),(0,A.Z)(this,"buffer",void 0);var n=r.buffer,a=r.offset,s=r.stride,f=r.normalized,v=r.size,m=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:a||0,stride:s||0,normalized:f||!1,divisor:m||0},v&&(this.attribute.size=v)}return(0,Ct.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),xp,tv,bp,Cc,rv,eh,nv,Uv,Nf,Rh,Fu,zf,Uf,Zv,XE=(xp={},(0,A.Z)(xp,j.POINTS,"points"),(0,A.Z)(xp,j.LINES,"lines"),(0,A.Z)(xp,j.LINE_LOOP,"line loop"),(0,A.Z)(xp,j.LINE_STRIP,"line strip"),(0,A.Z)(xp,j.TRIANGLES,"triangles"),(0,A.Z)(xp,j.TRIANGLE_FAN,"triangle fan"),(0,A.Z)(xp,j.TRIANGLE_STRIP,"triangle strip"),xp),dy=(tv={},(0,A.Z)(tv,j.STATIC_DRAW,"static"),(0,A.Z)(tv,j.DYNAMIC_DRAW,"dynamic"),(0,A.Z)(tv,j.STREAM_DRAW,"stream"),tv),z0=(bp={},(0,A.Z)(bp,j.BYTE,"int8"),(0,A.Z)(bp,j.UNSIGNED_INT,"int16"),(0,A.Z)(bp,j.INT,"int32"),(0,A.Z)(bp,j.UNSIGNED_BYTE,"uint8"),(0,A.Z)(bp,j.UNSIGNED_SHORT,"uint16"),(0,A.Z)(bp,j.UNSIGNED_INT,"uint32"),(0,A.Z)(bp,j.FLOAT,"float"),bp),YE=(Cc={},(0,A.Z)(Cc,j.ALPHA,"alpha"),(0,A.Z)(Cc,j.LUMINANCE,"luminance"),(0,A.Z)(Cc,j.LUMINANCE_ALPHA,"luminance alpha"),(0,A.Z)(Cc,j.RGB,"rgb"),(0,A.Z)(Cc,j.RGBA,"rgba"),(0,A.Z)(Cc,j.RGBA4,"rgba4"),(0,A.Z)(Cc,j.RGB5_A1,"rgb5 a1"),(0,A.Z)(Cc,j.RGB565,"rgb565"),(0,A.Z)(Cc,j.DEPTH_COMPONENT,"depth"),(0,A.Z)(Cc,j.DEPTH_STENCIL,"depth stencil"),Cc),qE=(rv={},(0,A.Z)(rv,j.DONT_CARE,"dont care"),(0,A.Z)(rv,j.NICEST,"nice"),(0,A.Z)(rv,j.FASTEST,"fast"),rv),vy=(eh={},(0,A.Z)(eh,j.NEAREST,"nearest"),(0,A.Z)(eh,j.LINEAR,"linear"),(0,A.Z)(eh,j.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,A.Z)(eh,j.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,A.Z)(eh,j.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,A.Z)(eh,j.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),eh),gy=(nv={},(0,A.Z)(nv,j.REPEAT,"repeat"),(0,A.Z)(nv,j.CLAMP_TO_EDGE,"clamp"),(0,A.Z)(nv,j.MIRRORED_REPEAT,"mirror"),nv),KE=(Uv={},(0,A.Z)(Uv,j.NONE,"none"),(0,A.Z)(Uv,j.BROWSER_DEFAULT_WEBGL,"browser"),Uv),$E=(Nf={},(0,A.Z)(Nf,j.NEVER,"never"),(0,A.Z)(Nf,j.ALWAYS,"always"),(0,A.Z)(Nf,j.LESS,"less"),(0,A.Z)(Nf,j.LEQUAL,"lequal"),(0,A.Z)(Nf,j.GREATER,"greater"),(0,A.Z)(Nf,j.GEQUAL,"gequal"),(0,A.Z)(Nf,j.EQUAL,"equal"),(0,A.Z)(Nf,j.NOTEQUAL,"notequal"),Nf),yy=(Rh={},(0,A.Z)(Rh,j.FUNC_ADD,"add"),(0,A.Z)(Rh,j.MIN_EXT,"min"),(0,A.Z)(Rh,j.MAX_EXT,"max"),(0,A.Z)(Rh,j.FUNC_SUBTRACT,"subtract"),(0,A.Z)(Rh,j.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Rh),jv=(Fu={},(0,A.Z)(Fu,j.ZERO,"zero"),(0,A.Z)(Fu,j.ONE,"one"),(0,A.Z)(Fu,j.SRC_COLOR,"src color"),(0,A.Z)(Fu,j.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,A.Z)(Fu,j.SRC_ALPHA,"src alpha"),(0,A.Z)(Fu,j.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,A.Z)(Fu,j.DST_COLOR,"dst color"),(0,A.Z)(Fu,j.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,A.Z)(Fu,j.DST_ALPHA,"dst alpha"),(0,A.Z)(Fu,j.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,A.Z)(Fu,j.CONSTANT_COLOR,"constant color"),(0,A.Z)(Fu,j.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,A.Z)(Fu,j.CONSTANT_ALPHA,"constant alpha"),(0,A.Z)(Fu,j.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,A.Z)(Fu,j.SRC_ALPHA_SATURATE,"src alpha saturate"),Fu),QE=(zf={},(0,A.Z)(zf,j.NEVER,"never"),(0,A.Z)(zf,j.ALWAYS,"always"),(0,A.Z)(zf,j.LESS,"less"),(0,A.Z)(zf,j.LEQUAL,"lequal"),(0,A.Z)(zf,j.GREATER,"greater"),(0,A.Z)(zf,j.GEQUAL,"gequal"),(0,A.Z)(zf,j.EQUAL,"equal"),(0,A.Z)(zf,j.NOTEQUAL,"notequal"),zf),gd=(Uf={},(0,A.Z)(Uf,j.ZERO,"zero"),(0,A.Z)(Uf,j.KEEP,"keep"),(0,A.Z)(Uf,j.REPLACE,"replace"),(0,A.Z)(Uf,j.INVERT,"invert"),(0,A.Z)(Uf,j.INCR,"increment"),(0,A.Z)(Uf,j.DECR,"decrement"),(0,A.Z)(Uf,j.INCR_WRAP,"increment wrap"),(0,A.Z)(Uf,j.DECR_WRAP,"decrement wrap"),Uf),JE=(Zv={},(0,A.Z)(Zv,j.FRONT,"front"),(0,A.Z)(Zv,j.BACK,"back"),Zv),eS=function(){function e(i,r){(0,st.Z)(this,e),(0,A.Z)(this,"buffer",void 0);var n=r.data,a=r.usage,s=r.type;this.buffer=i.buffer({data:n,usage:dy[a||j.STATIC_DRAW],type:z0[s||j.UNSIGNED_BYTE]})}return(0,Ct.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,a=r.offset;this.buffer.subdata(n,a)}}]),e}(),tS=function(){function e(i,r){(0,st.Z)(this,e),(0,A.Z)(this,"elements",void 0);var n=r.data,a=r.usage,s=r.type,f=r.count;this.elements=i.elements({data:n,usage:dy[a||j.STATIC_DRAW],type:z0[s||j.UNSIGNED_BYTE],count:f})}return(0,Ct.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),rS=function(){function e(i,r){(0,st.Z)(this,e),(0,A.Z)(this,"framebuffer",void 0);var n=r.width,a=r.height,s=r.color,f=r.colors,v=r.depth,m=r.stencil,x={width:n,height:a};Array.isArray(f)&&(x.colors=f.map(function(C){return C.get()})),s&&typeof s!="boolean"&&(x.color=s.get()),this.framebuffer=i.framebuffer(x)}return(0,Ct.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.framebuffer.resize(n,a)}}]),e}(),nS=ee(36719),iS=ee.n(nS),aS=ee(68630),oS=ee.n(aS);function _y(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ac(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?_y(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_y(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var sS=function(){function e(i,r){(0,st.Z)(this,e),(0,A.Z)(this,"reGl",void 0),(0,A.Z)(this,"destroyed",!1),(0,A.Z)(this,"drawCommand",void 0),(0,A.Z)(this,"drawPickCommand",void 0),(0,A.Z)(this,"drawParams",void 0),(0,A.Z)(this,"options",void 0),(0,A.Z)(this,"uniforms",{}),this.reGl=i;var n=r.vs,a=r.fs,s=r.attributes,f=r.uniforms,v=r.primitive,m=r.count,x=r.elements,C=r.depth,T=r.blend,O=r.stencil,D=r.cull,Z=r.instances,W={};this.options=r,f&&(this.uniforms=this.extractUniforms(f),Object.keys(f).forEach(function(qe){W[qe]=i.prop(qe)}));var Q={};Object.keys(s).forEach(function(qe){Q[qe]=s[qe].get()});var ye={attributes:Q,frag:a,uniforms:W,vert:n,blend:{},primitive:XE[v===void 0?j.TRIANGLES:v]};Z&&(ye.instances=Z),m&&(ye.count=m),x&&(ye.elements=x.get()),this.initDepthDrawParams({depth:C},ye),this.initBlendDrawParams({blend:T},ye),this.initStencilDrawParams({stencil:O},ye),this.initCullDrawParams({cull:D},ye),this.drawCommand=i(ye);var Be=Pu()(ye);Be.blend=Ac(Ac({},Be.blend),{},{enable:!1}),this.drawPickCommand=i(Be),this.drawParams=ye}return(0,Ct.Z)(e,[{key:"updateAttributesAndElements",value:function(r,n){var a={};Object.keys(r).forEach(function(f){a[f]=r[f].get()}),this.drawParams.attributes=a,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams);var s=Pu()(this.drawParams);s.blend=Ac(Ac({},s.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(s)}},{key:"updateAttributes",value:function(r){var n={};Object.keys(r).forEach(function(s){n[s]=r[s].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams);var a=Pu()(this.drawParams);a.blend=Ac(Ac({},a.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(a)}},{key:"addUniforms",value:function(r){this.uniforms=Ac(Ac({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var a=Ac(Ac({},this.uniforms),this.extractUniforms(r.uniforms||{})),s={};Object.keys(a).forEach(function(f){var v=(0,He.Z)(a[f]);v==="boolean"||v==="number"||Array.isArray(a[f])||a[f].BYTES_PER_ELEMENT?s[f]=a[f]:s[f]=a[f].get()}),n?this.drawPickCommand(s):this.drawCommand(s)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var a=r.depth;a&&(n.depth={enable:a.enable===void 0?!0:!!a.enable,mask:a.mask===void 0?!0:!!a.mask,func:$E[a.func||j.LESS],range:a.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var a=r.blend;if(a){var s=a.enable,f=a.func,v=a.equation,m=a.color,x=m===void 0?[0,0,0,0]:m;n.blend={enable:!!s,func:{srcRGB:jv[f&&f.srcRGB||j.SRC_ALPHA],srcAlpha:jv[f&&f.srcAlpha||j.SRC_ALPHA],dstRGB:jv[f&&f.dstRGB||j.ONE_MINUS_SRC_ALPHA],dstAlpha:jv[f&&f.dstAlpha||j.ONE_MINUS_SRC_ALPHA]},equation:{rgb:yy[v&&v.rgb||j.FUNC_ADD],alpha:yy[v&&v.alpha||j.FUNC_ADD]},color:x}}}},{key:"initStencilDrawParams",value:function(r,n){var a=r.stencil;if(a){var s=a.enable,f=a.mask,v=f===void 0?-1:f,m=a.func,x=m===void 0?{cmp:j.ALWAYS,ref:0,mask:-1}:m,C=a.opFront,T=C===void 0?{fail:j.KEEP,zfail:j.KEEP,zpass:j.KEEP}:C,O=a.opBack,D=O===void 0?{fail:j.KEEP,zfail:j.KEEP,zpass:j.KEEP}:O;n.stencil={enable:!!s,mask:v,func:Ac(Ac({},x),{},{cmp:QE[x.cmp]}),opFront:{fail:gd[T.fail],zfail:gd[T.zfail],zpass:gd[T.zpass]},opBack:{fail:gd[D.fail],zfail:gd[D.zfail],zpass:gd[D.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var a=r.cull;if(a){var s=a.enable,f=a.face,v=f===void 0?j.BACK:f;n.cull={enable:!!s,face:JE[v]}}}},{key:"extractUniforms",value:function(r){var n=this,a={};return Object.keys(r).forEach(function(s){n.extractUniformsRecursively(s,r[s],a,"")}),a}},{key:"extractUniformsRecursively",value:function(r,n,a,s){var f=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||iS()(n)||n===""||"resize"in n){a["".concat(s&&s+".").concat(r)]=n;return}oS()(n)&&Object.keys(n).forEach(function(v){f.extractUniformsRecursively(v,n[v],a,"".concat(s&&s+".").concat(r))}),Array.isArray(n)&&n.forEach(function(v,m){Object.keys(v).forEach(function(x){f.extractUniformsRecursively(x,v[x],a,"".concat(s&&s+".").concat(r,"[").concat(m,"]"))})})}}]),e}(),uS=function(){function e(i,r){(0,st.Z)(this,e),(0,A.Z)(this,"texture",void 0),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"isDistroy",!1);var n=r.data,a=r.type,s=a===void 0?j.UNSIGNED_BYTE:a,f=r.width,v=r.height,m=r.flipY,x=m===void 0?!1:m,C=r.format,T=C===void 0?j.RGBA:C,O=r.mipmap,D=O===void 0?!1:O,Z=r.wrapS,W=Z===void 0?j.CLAMP_TO_EDGE:Z,Q=r.wrapT,ye=Q===void 0?j.CLAMP_TO_EDGE:Q,Be=r.aniso,qe=Be===void 0?0:Be,rt=r.alignment,_t=rt===void 0?1:rt,mt=r.premultiplyAlpha,Ht=mt===void 0?!1:mt,rr=r.mag,Cr=rr===void 0?j.NEAREST:rr,qr=r.min,gr=qr===void 0?j.NEAREST:qr,sn=r.colorSpace,Rn=sn===void 0?j.BROWSER_DEFAULT_WEBGL:sn,Un=r.x,Ba=Un===void 0?0:Un,Mo=r.y,Is=Mo===void 0?0:Mo,iu=r.copy,Ns=iu===void 0?!1:iu;this.width=f,this.height=v;var Mc={width:f,height:v,type:z0[s],format:YE[T],wrapS:gy[W],wrapT:gy[ye],mag:vy[Cr],min:vy[gr],alignment:_t,flipY:x,colorSpace:KE[Rn],premultiplyAlpha:Ht,aniso:qe,x:Ba,y:Is,copy:Ns};n&&(Mc.data=n),typeof D=="number"?Mc.mipmap=qE[D]:typeof D=="boolean"&&(Mc.mipmap=D),this.texture=i.texture(Mc)}return(0,Ct.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.texture.resize(n,a),this.width=n,this.height=a}},{key:"destroy",value:function(){if(!this.isDistroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDistroy=!0}}]),e}(),xy,by,lS=(xy=(0,Nr.b2)(),xy(by=function(){function e(){var i=this;(0,st.Z)(this,e),(0,A.Z)(this,"extensionObject",void 0),(0,A.Z)(this,"gl",void 0),(0,A.Z)(this,"$container",void 0),(0,A.Z)(this,"canvas",void 0),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"isDirty",void 0),(0,A.Z)(this,"createModel",function(r){return new sS(i.gl,r)}),(0,A.Z)(this,"createAttribute",function(r){return new WE(i.gl,r)}),(0,A.Z)(this,"createBuffer",function(r){return new eS(i.gl,r)}),(0,A.Z)(this,"createElements",function(r){return new tS(i.gl,r)}),(0,A.Z)(this,"createTexture2D",function(r){return new uS(i.gl,r)}),(0,A.Z)(this,"createFramebuffer",function(r){return new rS(i.gl,r)}),(0,A.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,A.Z)(this,"clear",function(r){var n=r.color,a=r.depth,s=r.stencil,f=r.framebuffer,v=f===void 0?null:f,m={color:n,depth:a,stencil:s};m.framebuffer=v===null?v:v.get(),i.gl.clear(m)}),(0,A.Z)(this,"viewport",function(r){var n=r.x,a=r.y,s=r.width,f=r.height;i.gl._gl.viewport(n,a,s,f),i.width=s,i.height=f,i.gl._refresh()}),(0,A.Z)(this,"readPixels",function(r){var n=r.framebuffer,a=r.x,s=r.y,f=r.width,v=r.height,m={x:a,y:s,width:f,height:v};return n&&(m.framebuffer=n.get()),i.gl.read(m)}),(0,A.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,A.Z)(this,"getContainer",function(){if(qi)return i.canvas;var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,A.Z)(this,"getCanvas",function(){return i.canvas}),(0,A.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,A.Z)(this,"destroy",function(){i.canvas=null,i.gl.destroy(),i.gl=null})}return(0,Ct.Z)(e,[{key:"init",value:function(){var i=(0,d.Z)(w().mark(function n(a,s){var f=this;return w().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return this.canvas=a,m.next=3,new Promise(function(x,C){HE()({canvas:f.canvas,attributes:{alpha:!0,antialias:s.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:s.preserveDrawingBuffer,stencil:s.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(O,D){(O||!D)&&C(O),x(D)}})});case 3:this.gl=m.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return m.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||by);function Ey(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Sy(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ey(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ey(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var cS=function(){function e(i){(0,st.Z)(this,e),(0,A.Z)(this,"sceneService",void 0),(0,A.Z)(this,"mapService",void 0),(0,A.Z)(this,"controlService",void 0),(0,A.Z)(this,"layerService",void 0),(0,A.Z)(this,"iconService",void 0),(0,A.Z)(this,"markerService",void 0),(0,A.Z)(this,"popupService",void 0),(0,A.Z)(this,"fontService",void 0),(0,A.Z)(this,"interactionService",void 0),(0,A.Z)(this,"container",void 0);var r=i.id,n=i.map,a=i.canvas,s=i.hasBaseMap,f=b2();this.container=f,n.setContainer(f,r,a,s),f.bind(zt.IRendererService).to(lS).inSingletonScope(),this.sceneService=f.get(zt.ISceneService),this.mapService=f.get(zt.IMapService),this.iconService=f.get(zt.IIconService),this.fontService=f.get(zt.IFontService),this.controlService=f.get(zt.IControlService),this.layerService=f.get(zt.ILayerService),this.markerService=f.get(zt.IMarkerService),this.interactionService=f.get(zt.IInteractionService),this.popupService=f.get(zt.IPopupService),qi?this.sceneService.initMiniScene(i):(this.initComponent(r),this.sceneService.init(i),this.initControl())}return(0,Ct.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var a=new r(this);a.init()}else this.on("loaded",function(){var s=new r(n);s.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=Qd(this.container);r.setContainer(n,this.container),this.sceneService.addLayer(r);var a=r.getLayerConfig();if(a){var s=a.mask,f=a.maskfence,v=a.maskColor,m=v===void 0?"#000":v,x=a.maskOpacity,C=x===void 0?0:x;if(s&&f){var T=new VE().source(f).shape("fill").color(m).style({opacity:C});this.addMask(T,r.id)}}else console.warn("addLayer should run after scene loaded!")}},{key:"addMask",value:function(r,n){var a=this.getLayer(n);if(a){var s=Qd(this.container);r.setContainer(s,this.container),a.addMaskLayer(r),this.sceneService.addLayer(r)}else console.warn("parent layer not find!")}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,n){this.layerService.remove(r,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(a){var s=(0,nn.Z)(a,2),f=s[0],v=s[1];n.fontService.addIconFont(f,v)})}},{key:"addFontFace",value:function(r,n){this.sceneService.addFontFace(r,n)}},{key:"addImage",value:function(r,n){qi?this.iconService.addImageMini(r,n,this.sceneService):this.iconService.addImage(r,n)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,n){k0.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.on(r,n)}},{key:"once",value:function(r,n){k0.indexOf(r)===-1?this.mapService.once(r,n):this.sceneService.once(r,n)}},{key:"off",value:function(r,n){k0.indexOf(r)===-1?this.mapService.off(r,n):this.sceneService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var a=this.sceneService.getSceneConfig(),s=a.fitBoundsOptions,f=a.animate;this.mapService.fitBounds(r,n||Sy(Sy({},s),{},{animate:f}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(zt.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:wa(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,a=r.logoPosition;n&&this.addControl(new Z2({position:a}))}}]),e}();function fS(e){var i=pS();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function pS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hS=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,dS=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,vS=function(e){(0,wr.Z)(r,e);var i=fS(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"cityCenter",void 0),(0,A.Z)((0,ae.Z)(n),"cityMinSize",void 0),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.baseColor,m=v===void 0?"rgb(16,16,16)":v,x=a.brightColor,C=x===void 0?"rgb(255,176,38)":x,T=a.windowColor,O=T===void 0?"rgb(30,60,89)":T,D=a.time,Z=D===void 0?0:D,W=a.sweep,Q=W===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:W;return{u_cityCenter:Q.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*Q.sweepRadius,u_circleSweep:Q.enable?1:0,u_circleSweepColor:Qi(Q.sweepColor).slice(0,3),u_circleSweepSpeed:Q.sweepSpeed,u_opacity:f,u_baseColor:Qi(m),u_brightColor:Qi(C),u_windowColor:Qi(O),u_time:this.layer.getLayerAnimateTime()||Z}}},{key:"calCityGeo",value:function(){var a=(0,nn.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],m=a[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(v+s)/2,(m+f)/2]);var x=this.mapService.lngLatToCoord([v,m]),C=this.mapService.lngLatToCoord([s,f]);this.cityMinSize=Math.sqrt(Math.pow(x[0]-C[0],2)+Math.pow(x[1]-C[1],2))/4}else{var T=v-s,O=m-f;this.cityCenter=[(v+s)/2,(m+f)/2],this.cityMinSize=Math.sqrt(Math.pow(T,2)+Math.pow(O,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:dS,fragmentShader:hS,triangulation:cy,cull:{enable:!0,face:j.BACK}})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:In.Attribute,descriptor:{name:"a_Normal",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:3,update:function(s,f,v,m,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(s,f,v,m){var x=s.size,C=x===void 0?10:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_Uv",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:2,update:function(s,f,v,m){var x=s.size;return[v[3],v[4]]}}})}}]),r}(po);function mS(e){var i=gS();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function gS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yS=function(e){(0,wr.Z)(r,e);var i=mS(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"type","PolygonLayer"),n}return(0,Ct.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new vS(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(a){this.updateLayerConfig({time:a})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}($p);function _S(e){var i=xS();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function xS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bS=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,ES=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,SS=function(e){(0,wr.Z)(r,e);var i=_S(r);function r(){return(0,st.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:f||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:bS,fragmentShader:ES,triangulation:fy,depth:{enable:!1},primitive:j.TRIANGLES,blend:this.getBlend(),stencil:ja(f,m)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:In.Attribute,descriptor:{name:"a_Pos",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:3,update:function(s,f){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(po);function CS(e){var i=AS();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function AS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,TS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,MS=function(e){(0,wr.Z)(r,e);var i=CS(r);function r(){return(0,st.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:f||1,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:wS,fragmentShader:TS,triangulation:uy,depth:{enable:!0},blend:this.getBlend(),stencil:ja(f,m)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(s,f,v,m){var x=s.size;return Array.isArray(x)?[x[0]]:[x]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:In.Attribute,descriptor:{name:"a_Normal",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:3,update:function(s,f,v,m,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:In.Attribute,descriptor:{name:"a_Pos",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:3,update:function(s,f){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(po);function PS(e,i){for(var r=[],n=[],a=[],s=e+1,f=i+1,v=e/2,m=i/2,x=0;x<f;x++)for(var C=x-m,T=0;T<s;T++){var O=T-v;n.push(O/v,-C/m,0),a.push(T/e),a.push(1-x/i)}for(var D=0;D<i;D++)for(var Z=0;Z<e;Z++){var W=Z+s*D,Q=Z+s*(D+1),ye=Z+1+s*(D+1),Be=Z+1+s*D;r.push(W,Q,Be),r.push(Q,ye,Be)}return{vertices:n,indices:r,uvs:a}}var Cy,Ay;function wy(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ty(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?wy(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wy(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function IS(e){var i=OS();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function OS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RS=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,LS=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,kS=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

float getBlurIndusty() {
    float h = 2.0/512.0;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y + 1.0 * h) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y + 1.0 * h) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y + 1.0 * h) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y-1.0*h) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y-1.0*h) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y-1.0*h) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,DS=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,FS=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,BS=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,My=(Cy=(0,Nr.b2)(),Cy(Ay=function(e){(0,wr.Z)(r,e);var i=IS(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"texture",void 0),(0,A.Z)((0,ae.Z)(n),"colorTexture",void 0),(0,A.Z)((0,ae.Z)(n),"heatmapFramerBuffer",void 0),(0,A.Z)((0,ae.Z)(n),"intensityModel",void 0),(0,A.Z)((0,ae.Z)(n),"colorModel",void 0),(0,A.Z)((0,ae.Z)(n),"shapeType",void 0),n}return(0,Ct.Z)(r,[{key:"render",value:function(){var a=this,s=this.rendererService,f=s.clear,v=s.useFramebuffer;v(this.heatmapFramerBuffer,function(){f({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.heatmapFramerBuffer}),a.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var a,s=this.rendererService,f=s.createFramebuffer,v=s.clear,m=s.getViewportSize,x=s.createTexture2D,C=s.useFramebuffer,T=this.styleAttributeService.getLayerStyleAttribute("shape"),O=(T==null||(a=T.scale)===null||a===void 0?void 0:a.field)||"heatmap";this.shapeType=O,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=O==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var D=m(),Z=D.width,W=D.height;return this.heatmapFramerBuffer=f({color:x({width:Math.floor(Z/4),height:Math.floor(W/4),wrapS:j.CLAMP_TO_EDGE,wrapT:j.CLAMP_TO_EDGE,min:j.LINEAR,mag:j.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:In.Attribute,descriptor:{name:"a_Dir",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:2,update:function(s,f,v,m){return[v[3],v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(s,f,v,m){var x=s.size,C=x===void 0?1:x;return[C]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.triangulation=hy,this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:BS,fragmentShader:FS,triangulation:hy,depth:{enable:!1},cull:{enable:!0,face:Gl(this.mapService.version)},blend:{enable:!0,func:{srcRGB:j.ONE,srcAlpha:1,dstRGB:j.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;this.shaderModuleService.registerModule("heatmapColor",{vs:DS,fs:kS});var x=this.shaderModuleService.getModule("heatmapColor"),C=x.vs,T=x.fs,O=x.uniforms,D=this.rendererService,Z=D.createAttribute,W=D.createElements,Q=D.createBuffer,ye=D.createModel;return ye({vs:C,fs:T,attributes:{a_Position:Z({buffer:Q({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:j.FLOAT}),size:3}),a_Uv:Z({buffer:Q({data:[0,1,1,1,0,0,1,0],type:j.FLOAT}),size:2})},uniforms:Ty({},O),depth:{enable:!1},blend:this.getBlend(),count:6,elements:W({data:[0,2,1,2,3,1],type:j.UNSIGNED_INT,count:6}),stencil:ja(f,m)})}},{key:"drawIntensityMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.intensity,v=f===void 0?10:f,m=a.radius,x=m===void 0?5:m;this.intensityModel.draw({uniforms:{u_opacity:s||1,u_radius:x,u_intensity:v}})}},{key:"drawColorMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=Pr();dn(f,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,Se.Z)(f)}})}},{key:"build3dHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=this.rendererService.getViewportSize,C=x(),T=C.width,O=C.height,D=PS(T/4,O/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:LS,fs:RS});var Z=this.shaderModuleService.getModule("heatmap3dColor"),W=Z.vs,Q=Z.fs,ye=Z.uniforms,Be=this.rendererService,qe=Be.createAttribute,rt=Be.createElements,_t=Be.createBuffer,mt=Be.createModel;return mt({vs:W,fs:Q,attributes:{a_Position:qe({buffer:_t({data:D.vertices,type:j.FLOAT}),size:3}),a_Uv:qe({buffer:_t({data:D.uvs,type:j.FLOAT}),size:2})},primitive:j.TRIANGLES,uniforms:Ty({},ye),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:j.SRC_ALPHA,srcAlpha:1,dstRGB:j.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:rt({data:D.indices,type:j.UNSIGNED_INT,count:D.indices.length}),stencil:ja(f,m)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var a=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var s=this.layer.getLayerConfig(),f=s.rampColors,v=wu(f);this.colorTexture=a({data:new Uint8Array(v.data),width:v.width,height:v.height,wrapS:j.CLAMP_TO_EDGE,wrapT:j.CLAMP_TO_EDGE,min:j.NEAREST,mag:j.NEAREST,flipY:!1})}}]),r}(po))||Ay);function NS(e){var i=zS();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function zS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var US=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,ZS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,jS=function(e){(0,wr.Z)(r,e);var i=NS(r);function r(){return(0,st.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:f||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:ZS,fragmentShader:US,triangulation:fy,depth:{enable:!1},primitive:j.TRIANGLES,blend:this.getBlend(),stencil:ja(f,m)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:In.Attribute,descriptor:{name:"a_Pos",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:3,update:function(s,f){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(po),VS={heatmap:My,heatmap3d:My,grid:SS,grid3d:MS,hexagon:jS},GS=VS;function HS(e){var i=WS();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function WS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XS=function(e){(0,wr.Z)(r,e);var i=HS(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"type","HeatMapLayer"),n}return(0,Ct.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new GS[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var a=this,s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(f){return f.draw({uniforms:a.layerModel.getUninforms()})}),this)}},{key:"updateModelData",value:function(a){a.attributes&&a.elements?this.models[0].updateAttributesAndElements(a.attributes,a.elements):console.warn("data error")}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),f=this.getLayerConfig(),v=f.shape3d,m=this.getSource(),x=m.data.type,C=(s==null||(a=s.scale)===null||a===void 0?void 0:a.field)||"heatmap";return C==="heatmap"||C==="heatmap3d"?"heatmap":x==="hexagon"?(v==null?void 0:v.indexOf(C))===-1?"hexagon":"grid3d":x==="grid"?(v==null?void 0:v.indexOf(C))===-1?"grid":"grid3d":"heatmap"}}]),r}($p);function YS(e){var i=qS();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function qS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KS=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,$S=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,QS=function(e){(0,wr.Z)(r,e);var i=YS(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"texture",void 0),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture}}},{key:"initModels",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.mask,v=f===void 0?!1:f,m=s.maskInside,x=m===void 0?!0:m,C=this.layer.getSource(),T=this.rendererService.createTexture2D;if(this.texture=T({height:0,width:0}),qi){var O=this.layerService.sceneService.getSceneConfig().canvas,D=O.createImage();D.crossOrigin="anonymous",D.src=C.data.originData,D.onload=function(){a.texture=T({data:D,width:D.width,height:D.height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}else C.data.images.then(function(Z){a.texture=T({data:Z[0],width:Z[0].width,height:Z[0].height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:$S,fragmentShader:KS,triangulation:py,primitive:j.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:ja(v,x)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_Uv",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:2,update:function(s,f,v,m){return[v[3],v[4]]}}})}}]),r}(po),JS={image:QS},eC=JS;function tC(e){var i=rC();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function rC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Py=function(e){(0,wr.Z)(r,e);var i=tC(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"type","ImageLayer"),n}return(0,Ct.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new eC[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={image:{}};return s[a]}},{key:"getModelType",value:function(){return"image"}}]),r}($p);function nC(e){var i=iC();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function iC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aC=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,oC=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  

   styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,sC=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,uC=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,lC=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,cC=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,fC={solid:0,dash:1},pC=function(e){(0,wr.Z)(r,e);var i=nC(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"texture",void 0),(0,A.Z)((0,ae.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:j.NEAREST,min:j.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,m=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,T=a.lineType,O=T===void 0?"solid":T,D=a.dashArray,Z=D===void 0?[10,5]:D,W=a.forward,Q=W===void 0?!0:W,ye=a.lineTexture,Be=ye===void 0?!1:ye,qe=a.iconStep,rt=qe===void 0?100:qe,_t=a.segmentNumber,mt=_t===void 0?30:_t,Ht=a.thetaOffset,rr=Ht===void 0?.314:Ht;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,thetaOffset:rr})){this.judgeStyleAttributes({opacity:f,thetaOffset:rr});var Cr=this.layer.getEncodedData(),qr=this.calDataFrame(this.cellLength,Cr,this.cellProperties),gr=qr.data,sn=qr.width,Rn=qr.height;this.rowCount=Rn,this.dataTexture=this.cellLength>0&&gr.length>0?this.createTexture2D({flipY:!0,data:gr,format:j.LUMINANCE,type:j.FLOAT,width:sn,height:Rn}):this.createTexture2D({flipY:!0,data:[1],format:j.LUMINANCE,type:j.FLOAT,width:1,height:1})}Z.length===2&&Z.push(0,0);var Un=0,Ba=[0,0,0,0],Mo=[0,0,0,0];return v&&m&&(Ba=Qi(v),Mo=Qi(m),Un=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:Number(rr),u_opacity:Number(f),u_textureBlend:C==="normal"?0:1,segmentNumber:mt,u_line_type:fC[O||"solid"],u_dash_array:Z,u_blur:.9,u_lineDir:Q?1:-1,u_texture:this.texture,u_line_texture:Be?1:0,u_icon_step:rt,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Un,u_sourceColor:Ba,u_targetColor:Mo}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor,v=a.lineType;return v==="dash"?{frag:aC,vert:oC,type:"dash"}:s&&f?{frag:lC,vert:cC,type:"linear"}:{frag:sC,vert:uC,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,f=s===void 0?30:s,v=a.mask,m=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x,T=this.getShaders(),O=T.frag,D=T.vert,Z=T.type;return[this.layer.buildLayerModel({moduleName:"arc2dline"+Z,vertexShader:D,fragmentShader:O,triangulation:Nv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:f,stencil:ja(m,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(f,v,m,x){var C=f.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:In.Attribute,descriptor:{name:"a_Instance",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:4,update:function(f,v,m,x){return[m[3],m[4],m[5],m[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:2,update:function(f,v,m,x){var C=a.iconService.getIconMap(),T=f.texture,O=C[T]||{x:0,y:0},D=O.x,Z=O.y;return[D,Z]}}})}}]),r}(po);function hC(e){var i=dC();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function dC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,mC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,gC=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,yC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,_C={solid:0,dash:1},xC=function(e){(0,wr.Z)(r,e);var i=hC(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"texture",void 0),(0,A.Z)((0,ae.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:j.NEAREST,min:j.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,m=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,T=a.lineType,O=T===void 0?"solid":T,D=a.dashArray,Z=D===void 0?[10,5]:D,W=a.lineTexture,Q=W===void 0?!1:W,ye=a.iconStep,Be=ye===void 0?100:ye,qe=a.segmentNumber,rt=qe===void 0?30:qe,_t=a.globalArcHeight,mt=_t===void 0?10:_t;Z.length===2&&Z.push(0,0);var Ht=0,rr=[0,0,0,0],Cr=[0,0,0,0];if(v&&m&&(rr=Qi(v),Cr=Qi(m),Ht=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var qr=this.layer.getEncodedData(),gr=this.calDataFrame(this.cellLength,qr,this.cellProperties),sn=gr.data,Rn=gr.width,Un=gr.height;this.rowCount=Un,this.dataTexture=this.cellLength>0&&sn.length>0?this.createTexture2D({flipY:!0,data:sn,format:j.LUMINANCE,type:j.FLOAT,width:Rn,height:Un}):this.createTexture2D({flipY:!0,data:[1],format:j.LUMINANCE,type:j.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:$g,u_global_height:mt,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_textureBlend:C==="normal"?0:1,segmentNumber:rt,u_line_type:_C[O]||0,u_dash_array:Z,u_texture:this.texture,u_line_texture:Q?1:0,u_icon_step:Be,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ht,u_sourceColor:rr,u_targetColor:Cr}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor;return s&&f?{frag:gC,vert:yC,type:"linear"}:{frag:vC,vert:mC,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,f=s===void 0?30:s,v=a.mask,m=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x,T=this.getShaders(),O=T.frag,D=T.vert,Z=T.type;return[this.layer.buildLayerModel({moduleName:"arc3Dline"+Z,vertexShader:D,fragmentShader:O,triangulation:Nv,blend:this.getBlend(),segmentNumber:f,stencil:ja(m,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(f,v,m,x){var C=f.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:In.Attribute,descriptor:{name:"a_Instance",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:4,update:function(f,v,m,x){return[m[3],m[4],m[5],m[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:2,update:function(f,v,m,x){var C=a.iconService.getIconMap(),T=f.texture,O=C[T]||{x:0,y:0},D=O.x,Z=O.y;return[D,Z]}}})}}]),r}(po);function bC(e){var i=EC();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function EC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SC=`#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,CC=`#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,AC=function(e){(0,wr.Z)(r,e);var i=bC(r);function r(){return(0,st.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,m=a.targetColor,x=a.forward,C=x===void 0?!0:x,T=a.segmentNumber,O=T===void 0?30:T,D=a.thetaOffset,Z=D===void 0?.314:D,W=0,Q=[0,0,0,0],ye=[0,0,0,0];return v&&m&&(Q=Qi(v),ye=Qi(m),W=1),{u_thetaOffset:Z,u_opacity:Number(f),segmentNumber:O,u_blur:.9,u_lineDir:C?1:-1,u_linearColor:W,u_sourceColor:Q,u_targetColor:ye}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,f=s===void 0?30:s;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:CC,fragmentShader:SC,triangulation:Nv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:f})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(s,f,v,m){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:In.Attribute,descriptor:{name:"a_Instance",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:4,update:function(s,f,v,m){return[v[3],v[4],v[5],v[6]]}}})}}]),r}(po);function wC(e){var i=TC();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function TC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,PC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,IC={solid:0,dash:1},OC=function(e){(0,wr.Z)(r,e);var i=wC(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"texture",void 0),(0,A.Z)((0,ae.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:j.NEAREST,min:j.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,m=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,T=a.lineType,O=T===void 0?"solid":T,D=a.dashArray,Z=D===void 0?[10,5]:D,W=a.lineTexture,Q=W===void 0?!1:W,ye=a.iconStep,Be=ye===void 0?100:ye,qe=a.segmentNumber,rt=qe===void 0?30:qe;Z.length===2&&Z.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var _t=0,mt=[0,0,0,0],Ht=[0,0,0,0];if(v&&m&&(mt=Qi(v),Ht=Qi(m),_t=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var rr=this.layer.getEncodedData(),Cr=this.calDataFrame(this.cellLength,rr,this.cellProperties),qr=Cr.data,gr=Cr.width,sn=Cr.height;this.rowCount=sn,this.dataTexture=this.cellLength>0&&qr.length>0?this.createTexture2D({flipY:!0,data:qr,format:j.LUMINANCE,type:j.FLOAT,width:gr,height:sn}):this.createTexture2D({flipY:!0,data:[1],format:j.LUMINANCE,type:j.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_textureBlend:C==="normal"?0:1,segmentNumber:rt,u_line_type:IC[O]||0,u_dash_array:Z,u_texture:this.texture,u_line_texture:Q?1:0,u_icon_step:Be,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:_t,u_sourceColor:mt,u_targetColor:Ht}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"greatcircleline",vertexShader:PC,fragmentShader:MC,triangulation:Nv,depth:{enable:!1},blend:this.getBlend(),stencil:ja(f,m)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(f,v,m,x){var C=f.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:In.Attribute,descriptor:{name:"a_Instance",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:4,update:function(f,v,m,x){return[m[3],m[4],m[5],m[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:2,update:function(f,v,m,x){var C=a.iconService.getIconMap(),T=f.texture,O=C[T]||{x:0,y:0},D=O.x,Z=O.y;return[D,Z]}}})}}]),r}(po);function RC(e){var i=LC();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function LC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kC=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 // dash line
 
  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;

  gl_FragColor = filterColor(gl_FragColor);
}
`,DC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,FC=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Iy=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,BC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,NC={solid:0,dash:1},Oy=function(e){(0,wr.Z)(r,e);var i=RC(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"texture",void 0),(0,A.Z)((0,ae.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:j.NEAREST,min:j.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,m=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,T=a.lineType,O=T===void 0?"solid":T,D=a.dashArray,Z=D===void 0?[10,5,0,0]:D,W=a.lineTexture,Q=W===void 0?!1:W,ye=a.iconStep,Be=ye===void 0?100:ye,qe=a.vertexHeightScale,rt=qe===void 0?20:qe,_t=a.borderWidth,mt=_t===void 0?0:_t,Ht=a.borderColor,rr=Ht===void 0?"#ccc":Ht,Cr=a.raisingHeight,qr=Cr===void 0?0:Cr,gr=a.heightfixed,sn=gr===void 0?!1:gr,Rn=a.arrow,Un=Rn===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:Rn;Z.length===2&&Z.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Ba=0,Mo=[0,0,0,0],Is=[0,0,0,0];if(v&&m&&(Mo=Qi(v),Is=Qi(m),Ba=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var iu=this.layer.getEncodedData(),Ns=this.calDataFrame(this.cellLength,iu,this.cellProperties),Mc=Ns.data,mm=Ns.width,m0=Ns.height;this.rowCount=m0,this.dataTexture=this.cellLength>0&&Mc.length>0?this.createTexture2D({flipY:!0,data:Mc,format:j.LUMINANCE,type:j.FLOAT,width:mm,height:m0}):this.createTexture2D({flipY:!0,data:[1],format:j.LUMINANCE,type:j.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_textureBlend:C==="normal"?0:1,u_line_type:NC[O],u_dash_array:Z,u_texture:this.texture,u_line_texture:Q?1:0,u_icon_step:Be,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:mt,u_borderColor:Qi(rr),u_linearColor:Ba,u_sourceColor:Mo,u_targetColor:Is,u_heightfixed:Number(sn),u_vertexScale:rt,u_raisingHeight:Number(qr),u_arrow:Number(Un.enable),u_arrowHeight:Un.arrowHeight||3,u_arrowWidth:Un.arrowWidth||2,u_tailWidth:Un.tailWidth===void 0?1:Un.tailWidth}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=a.depth,C=x===void 0?!1:x,T=this.getShaders(),O=T.frag,D=T.vert,Z=T.type;return this.layer.triangulation=ev,[this.layer.buildLayerModel({moduleName:"line_"+Z,vertexShader:D,fragmentShader:O,triangulation:ev,primitive:j.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:ja(f,m)})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor,v=a.lineType;return v==="dash"?{frag:kC,vert:DC,type:"dash"}:s&&f?{frag:BC,vert:Iy,type:"linear"}:{frag:FC,vert:Iy,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:In.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:2,update:function(f,v,m,x,C,T){return T===void 0?[m[3],10]:[m[3],T]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:In.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(f,v,m,x){return[m[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:2,update:function(f,v,m,x){var C=f.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0],T[1]]:[T,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:In.Attribute,descriptor:{name:"a_Normal",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:3,update:function(f,v,m,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:In.Attribute,descriptor:{name:"a_Miter",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(f,v,m,x){return[m[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:2,update:function(f,v,m,x){var C=a.iconService.getIconMap(),T=f.texture,O=C[T]||{x:0,y:0},D=O.x,Z=O.y;return[D,Z]}}})}}]),r}(po);function zC(e){var i=UC();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function UC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZC=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = texture2D(u_texture, vec2(d_distance_ratio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,jC=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,VC=function(e){(0,wr.Z)(r,e);var i=zC(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"colorTexture",void 0),(0,A.Z)((0,ae.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var m=n.layer.getLayerConfig(),x=m.rampColors,C=wu(x);n.colorTexture=v({data:new Uint8Array(C.data),width:C.width,height:C.height,wrapS:j.CLAMP_TO_EDGE,wrapT:j.CLAMP_TO_EDGE,min:j.NEAREST,mag:j.NEAREST,flipY:!1})}),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.vertexHeightScale,m=v===void 0?20:v,x=a.raisingHeight,C=x===void 0?0:x,T=a.heightfixed,O=T===void 0?!1:T;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var D=this.layer.getEncodedData(),Z=this.calDataFrame(this.cellLength,D,this.cellProperties),W=Z.data,Q=Z.width,ye=Z.height;this.rowCount=ye,this.dataTexture=this.cellLength>0&&W.length>0?this.createTexture2D({flipY:!0,data:W,format:j.LUMINANCE,type:j.FLOAT,width:Q,height:ye}):this.createTexture2D({flipY:!0,data:[1],format:j.LUMINANCE,type:j.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_texture:this.colorTexture,u_heightfixed:Number(O),u_vertexScale:m,u_raisingHeight:Number(C)}}},{key:"initModels",value:function(){return this.updateTexture(),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.colorTexture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=a.depth,C=x===void 0?!1:x,T=this.getShaders(),O=T.frag,D=T.vert,Z=T.type;return this.layer.triangulation=ev,[this.layer.buildLayerModel({moduleName:"line_"+Z,vertexShader:D,fragmentShader:O,triangulation:ev,primitive:j.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:ja(f,m)})]}},{key:"getShaders",value:function(){return{frag:ZC,vert:jC,type:"linear_rampColors"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:In.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:2,update:function(s,f,v,m,x,C){return C===void 0?[v[3],10]:[v[3],C]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:In.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(s,f,v,m){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:2,update:function(s,f,v,m){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:In.Attribute,descriptor:{name:"a_Normal",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:3,update:function(s,f,v,m,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:In.Attribute,descriptor:{name:"a_Miter",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(s,f,v,m){return[v[4]]}}})}}]),r}(po);function GC(e){var i=HC();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function HC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WC=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,XC=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,Ry=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_color = a_Color;  

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  }
}
`,YC=function(e){(0,wr.Z)(r,e);var i=GC(r);function r(){return(0,st.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,m=a.targetColor,x=a.vertexHeightScale,C=x===void 0?20:x,T=0,O=[0,0,0,0],D=[0,0,0,0];if(v&&m&&(O=Qi(v),D=Qi(m),T=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var Z=this.layer.getEncodedData(),W=this.calDataFrame(this.cellLength,Z,this.cellProperties),Q=W.data,ye=W.width,Be=W.height;this.rowCount=Be,this.dataTexture=this.cellLength>0&&Q.length>0?this.createTexture2D({flipY:!0,data:Q,format:j.LUMINANCE,type:j.FLOAT,width:ye,height:Be}):this.createTexture2D({flipY:!0,data:[1],format:j.LUMINANCE,type:j.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_linearColor:T,u_sourceColor:O,u_targetColor:D,u_vertexScale:C}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,f=a.targetColor;return s&&f?{frag:WC,vert:Ry,type:"simple_linear"}:{frag:XC,vert:Ry,type:"simple_normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:O,vertexShader:T,fragmentShader:C,triangulation:ME,primitive:j.LINES,blend:this.getBlend(),depth:{enable:!1},stencil:ja(f,m)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:In.Attribute,descriptor:{name:"a_Distance",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(s,f,v,m){return[v[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:In.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(s,f,v,m){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:2,update:function(s,f,v,m){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:In.Attribute,descriptor:{name:"a_Normal",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:3,update:function(s,f,v,m,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:In.Attribute,descriptor:{name:"a_Miter",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(s,f,v,m){return[v[4]]}}})}}]),r}(po);function qC(e){var i=KC();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function KC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $C=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,QC=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,JC=function(e){(0,wr.Z)(r,e);var i=qC(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"texture",void 0),(0,A.Z)((0,ae.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:j.NEAREST,min:j.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.sourceColor,m=a.targetColor,x=a.textureBlend,C=x===void 0?"normal":x,T=a.heightfixed,O=T===void 0?!1:T,D=a.lineTexture,Z=D===void 0?!1:D,W=a.iconStep,Q=W===void 0?100:W,ye=a.iconStepCount,Be=ye===void 0?1:ye;this.rendererService.getDirty()&&this.texture.bind();var qe=0,rt=[0,0,0,0],_t=[0,0,0,0];if(v&&m&&(rt=Qi(v),_t=Qi(m),qe=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var mt=this.layer.getEncodedData(),Ht=this.calDataFrame(this.cellLength,mt,this.cellProperties),rr=Ht.data,Cr=Ht.width,qr=Ht.height;this.rowCount=qr,this.dataTexture=this.cellLength>0&&rr.length>0?this.createTexture2D({flipY:!0,data:rr,format:j.LUMINANCE,type:j.FLOAT,width:Cr,height:qr}):this.createTexture2D({flipY:!0,data:[1],format:j.LUMINANCE,type:j.FLOAT,width:1,height:1})}return{u_heightfixed:Number(O),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_textureBlend:C==="normal"?0:1,u_texture:this.texture,u_line_texture:Z?1:0,u_iconStepCount:Be,u_icon_step:Q,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:qe,u_sourceColor:rt,u_targetColor:_t}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:QC,fragmentShader:$C,triangulation:ev,primitive:j.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:In.Attribute,descriptor:{name:"a_Distance",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(f,v,m,x){return[m[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:In.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(f,v,m,x){return[m[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:2,update:function(f,v,m,x){var C=f.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0],T[1]]:[T,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:In.Attribute,descriptor:{name:"a_Normal",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:3,update:function(f,v,m,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:In.Attribute,descriptor:{name:"a_Miter",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(f,v,m,x){return[m[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:2,update:function(f,v,m,x){var C=a.iconService.getIconMap(),T=f.texture,O=C[T]||{x:0,y:0},D=O.x,Z=O.y;return[D,Z]}}})}}]),r}(po),eA={arc:pC,arcmini:AC,arc3d:xC,greatcircle:OC,wall:JC,line:Oy,simple:YC,linearline:VC},tA=eA;function rA(e){var i=nA();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function nA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ly=function(e){(0,wr.Z)(r,e);var i=rA(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"type","LineLayer"),n}return(0,Ct.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new tA[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return s[a]}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),f=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return f||"line"}}]),r}($p);function iA(e){var i=aA();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function aA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oA=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,sA=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,ky=function(e){(0,wr.Z)(r,e);var i=iA(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"raiseCount",0),(0,A.Z)((0,ae.Z)(n),"raiserepeat",0),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,f=s===void 0?{enable:!1,speed:.01,repeat:!1}:s,v=a.opacity,m=v===void 0?1:v,x=a.sourceColor,C=a.targetColor,T=a.pickLight,O=T===void 0?!1:T,D=a.heightfixed,Z=D===void 0?!1:D,W=a.opacityLinear,Q=W===void 0?{enable:!1,dir:"up"}:W,ye=a.lightEnable,Be=ye===void 0?!0:ye;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:m})){this.judgeStyleAttributes({opacity:m});var qe=this.layer.getEncodedData(),rt=this.calDataFrame(this.cellLength,qe,this.cellProperties),_t=rt.data,mt=rt.width,Ht=rt.height;this.rowCount=Ht,this.dataTexture=this.cellLength>0&&_t.length>0?this.createTexture2D({flipY:!0,data:_t,format:j.LUMINANCE,type:j.FLOAT,width:mt,height:Ht}):this.createTexture2D({flipY:!0,data:[1],format:j.LUMINANCE,type:j.FLOAT,width:1,height:1})}var rr=0,Cr=[0,0,0,0],qr=[0,0,0,0];if(x&&C&&(Cr=Qi(x),qr=Qi(C),rr=1),this.raiseCount<1&&this.raiserepeat>0&&f.enable){var gr=f.speed,sn=gr===void 0?.01:gr,Rn=f.repeat,Un=Rn===void 0?!1:Rn;this.raiseCount+=sn,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(O),u_heightfixed:Number(Z),u_r:f.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(m),u_linearColor:rr,u_sourceColor:Cr,u_targetColor:qr,u_opacitylinear:Number(Q.enable),u_opacitylinear_dir:Q.dir==="up"?1:0,u_lightEnable:Number(Be)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.depth,f=s===void 0?!0:s,v=a.animateOption.repeat,m=v===void 0?1:v;return this.raiserepeat=m,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:sA,fragmentShader:oA,triangulation:uy,blend:this.getBlend(),cull:{enable:!0,face:Gl(this.mapService.version)},depth:{enable:f}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:3,update:function(f,v,m,x){var C=f.size;if(C){var T=[];return Array.isArray(C)&&(T=C.length===2?[C[0],C[0],C[1]]:C),Array.isArray(C)||(T=[C,C,C]),T}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:In.Attribute,descriptor:{name:"a_Normal",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:3,update:function(f,v,m,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:In.Attribute,descriptor:{name:"a_Pos",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:3,update:function(f,v){var m=Mh(f.coordinates);return a?Jg([m[0],m[1]]):[m[0],m[1],0]}}})}}]),r}(po);function uA(e){var i=lA();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function lA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Dy=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
  
  // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,cA=`
uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,U0=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raiseHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, u_raisingHeight, 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,Fy=function(e){(0,wr.Z)(r,e);var i=uA(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"meter2coord",1),(0,A.Z)((0,ae.Z)(n),"isMeter",!1),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.strokeOpacity,m=v===void 0?1:v,x=a.strokeWidth,C=x===void 0?0:x,T=a.stroke,O=T===void 0?"rgba(0,0,0,0)":T,D=a.offsets,Z=D===void 0?[0,0]:D,W=a.blend,Q=a.blur,ye=Q===void 0?0:Q,Be=a.raisingHeight,qe=Be===void 0?0:Be;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,strokeOpacity:m,strokeWidth:C,stroke:O,offsets:Z})){this.judgeStyleAttributes({opacity:f,strokeOpacity:m,strokeWidth:C,stroke:O,offsets:Z});var rt=this.layer.getEncodedData(),_t=this.calDataFrame(this.cellLength,rt,this.cellProperties),mt=_t.data,Ht=_t.width,rr=_t.height;this.rowCount=rr,this.dataTexture=this.cellLength>0&&mt.length>0?this.createTexture2D({flipY:!0,data:mt,format:j.LUMINANCE,type:j.FLOAT,width:Ht,height:rr}):this.createTexture2D({flipY:!0,data:[1],format:j.LUMINANCE,type:j.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(qe),u_isMeter:Number(this.isMeter),u_blur:ye,u_additive:W==="additive"?1:0,u_globel:this.mapService.version===Bs.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_stroke_opacity:Number(m),u_stroke_width:Number(C),u_stroke_color:this.getStrokeColor(O),u_offsets:this.isOffsetStatic(Z)?Z:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,f=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(f),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Oh)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,f=s===void 0?"l7size":s,v=this.mapService.version;return f==="meter"&&v!==Bs.L7MAP&&v!==Bs.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,nn.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],m=a[3],x=[(s+v)/2,(f+m)/2],C=this.mapService.version;if(C===Bs.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),O=1,D=O*T.meterInMercatorCoordinateUnits(),Z=new window.mapboxgl.MercatorCoordinate(T.x-D,T.y,T.z),W=Z.toLngLat();this.meter2coord=x[0]-W.lng;return}var Q=this.mapService.meterToCoord(x,[s,f]),ye=this.mapService.meterToCoord(x,[v===s?v+.1:v,m===f?f+.1:m]);this.meter2coord=(Q+ye)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=a.animateOption,C=x===void 0?{enable:!1}:x,T=this.getShaders(C),O=T.frag,D=T.vert,Z=T.type,W=this.mapService.version==="GLOBEL";return this.layer.triangulation=W?sy:Oh,[this.layer.buildLayerModel({moduleName:"pointfill_"+Z,vertexShader:D,fragmentShader:O,triangulation:W?sy:Oh,depth:{enable:W},blend:this.getBlend(),stencil:ja(f,m),cull:{enable:!0,face:Gl(this.mapService.version)}})]}},{key:"getShaders",value:function(a){if(a.enable)switch(a.type){case"wave":return{frag:Dy,vert:U0,type:"wave"};default:return{frag:Dy,vert:U0,type:"wave"}}else return{frag:cA,vert:U0,type:"normal"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this,s=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:In.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:3,update:function(v,m,x,C){var T;if(s){var O=(0,nn.Z)(x,3),D=O[0],Z=O[1],W=O[2],Q=Xa.fromValues(0,0,1),ye=Xa.fromValues(D,0,W),Be=D>=0?Xa.angle(Q,ye):Math.PI*2-Xa.angle(Q,ye),qe=Math.PI*2-Math.asin(Z/100),rt=Pr();Jr(rt,rt,Be),Vr(rt,rt,qe);var _t=Xa.fromValues(1,1,0);Xa.transformMat4(_t,_t,rt),Xa.normalize(_t,_t);var mt=Xa.fromValues(-1,1,0);Xa.transformMat4(mt,mt,rt),Xa.normalize(mt,mt);var Ht=Xa.fromValues(-1,-1,0);Xa.transformMat4(Ht,Ht,rt),Xa.normalize(Ht,Ht);var rr=Xa.fromValues(1,-1,0);Xa.transformMat4(rr,rr,rt),Xa.normalize(rr,rr),T=[].concat((0,Se.Z)(_t),(0,Se.Z)(mt),(0,Se.Z)(Ht),(0,Se.Z)(rr))}else T=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var Cr=C%4*3;return[T[Cr],T[Cr+1],T[Cr+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(v,m,x,C){var T=v.size,O=T===void 0?5:T;return Array.isArray(O)?[O[0]*a.meter2coord]:[O*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:In.Attribute,descriptor:{name:"a_Shape",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(v,m,x,C){var T=v.shape,O=T===void 0?2:T,D=a.layer.getLayerConfig().shape2d,Z=D.indexOf(O);return[Z]}}})}}]),r}(po);function fA(e){var i=pA();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function pA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hA=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,dA=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,vA=function(e){(0,wr.Z)(r,e);var i=fA(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"meter2coord",1),(0,A.Z)((0,ae.Z)(n),"texture",void 0),(0,A.Z)((0,ae.Z)(n),"isMeter",!1),(0,A.Z)((0,ae.Z)(n),"radian",0),(0,A.Z)((0,ae.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:j.LINEAR,min:j.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,m=v===void 0?[0,0]:v,x=a.rotation;this.rendererService.getDirty()&&this.texture.bind();var C=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(C=-1),this.radian=x!==void 0?C*Math.PI*x/180:C*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:m})){this.judgeStyleAttributes({opacity:f,offsets:m});var T=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,T,this.cellProperties),D=O.data,Z=O.width,W=O.height;this.rowCount=W,this.dataTexture=this.cellLength>0&&D.length>0?this.createTexture2D({flipY:!0,data:D,format:j.LUMINANCE,type:j.FLOAT,width:Z,height:W}):this.createTexture2D({flipY:!0,data:[1],format:j.LUMINANCE,type:j.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Number(f),u_offsets:this.isOffsetStatic(m)?m:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Oh)}},{key:"initModels",value:function(){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var a=this.layer.getLayerConfig(),s=a.unit,f=s===void 0?"l7size":s,v=this.mapService.version;return f==="meter"&&v!==Bs.L7MAP&&v!==Bs.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,nn.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],m=a[3],x=[(s+v)/2,(f+m)/2],C=this.mapService.version;if(C===Bs.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),O=1,D=O*T.meterInMercatorCoordinateUnits(),Z=new window.mapboxgl.MercatorCoordinate(T.x-D,T.y,T.z),W=Z.toLngLat();this.meter2coord=x[0]-W.lng;return}var Q=this.mapService.meterToCoord(x,[s,f]),ye=this.mapService.meterToCoord(x,[v===s?v+.1:v,m===f?f+.1:m]);this.meter2coord=(Q+ye)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:O,vertexShader:T,fragmentShader:C,triangulation:Oh,depth:{enable:!1},blend:this.getBlend(),stencil:ja(f,m),cull:{enable:!0,face:Gl(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:hA,vert:dA,type:"point_fillImage"}}},{key:"clearModels",value:function(){var a,s;this.iconService.off("imageUpdate",this.updateTexture),(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:In.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(f,v,m,x){var C=f.rotate,T=C===void 0?0:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_Uv",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:2,update:function(f,v,m,x){var C=a.iconService.getIconMap(),T=f.shape,O=C[T]||{x:0,y:0},D=O.x,Z=O.y;return[D,Z]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:In.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:3,update:function(f,v,m,x){var C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],T=x%4*3;return[C[T],C[T+1],C[T+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(f,v,m,x){var C=f.size,T=C===void 0?5:C;return Array.isArray(T)?[T[0]*a.meter2coord]:[T*a.meter2coord]}}})}}]),r}(po);function mA(e){var i=gA();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function gA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yA=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,_A=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
  }
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);
}
`,xA=function(e){(0,wr.Z)(r,e);var i=mA(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"texture",void 0),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var a=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){a.updateTexture(),a.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:_A,fragmentShader:yA,triangulation:ly,primitive:j.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(f,v,m,x){var C=f.size;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_Uv",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:2,update:function(f,v,m,x){var C=a.fontService.mapping,T=f.shape,O=a.fontService.getGlyph(T),D=C[O],Z=D.x,W=D.y;return[Z,W]}}})}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.texture=a({data:s,mag:j.LINEAR,min:j.LINEAR,width:s.width,height:s.height})}},{key:"initIconFontGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.fontWeight,v=f===void 0?"normal":f,m=s.fontFamily,x=m===void 0?"sans-serif":m,C=this.layer.getEncodedData(),T=[];C.forEach(function(O){var D=O.shape,Z=D===void 0?"":D;Z=Z.toString();var W=a.fontService.getGlyph(Z);T.indexOf(W)===-1&&T.push(W)}),this.fontService.setFontOptions({characterSet:T,fontWeight:v,fontFamily:x,fontSize:48})}}]),r}(po);function bA(e){var i=EA();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function EA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SA=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,CA=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
  }
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);
}
`,By=function(e){(0,wr.Z)(r,e);var i=bA(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"texture",void 0),(0,A.Z)((0,ae.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:j.LINEAR,min:j.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,m=v===void 0?[0,0]:v;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:m})){this.judgeStyleAttributes({opacity:f,offsets:m});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),T=C.data,O=C.width,D=C.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:j.LUMINANCE,type:j.FLOAT,width:O,height:D}):this.createTexture2D({flipY:!0,data:[1],format:j.LUMINANCE,type:j.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Number(f),u_offsets:this.isOffsetStatic(m)?m:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:CA,fragmentShader:SA,triangulation:ly,primitive:j.POINTS,depth:{enable:!1},blend:this.getBlend(),stencil:ja(f,m)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(f,v,m,x){var C=f.size,T=C===void 0?5:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_Uv",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:2,update:function(f,v,m,x){var C=a.iconService.getIconMap(),T=f.shape,O=C[T]||{x:0,y:0},D=O.x,Z=O.y;return[D,Z]}}})}}]),r}(po);function AA(e){var i=wA();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function wA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TA=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,MA=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Ny(e){var i=e.coordinates;return{vertices:(0,Se.Z)(i),indices:[0],size:i.length}}var zy=function(e){(0,wr.Z)(r,e);var i=AA(r);function r(){return(0,st.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,m=v===void 0?[0,0]:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:m})){this.judgeStyleAttributes({opacity:f,offsets:m});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),T=C.data,O=C.width,D=C.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:j.LUMINANCE,type:j.FLOAT,width:O,height:D}):this.createTexture2D({flipY:!0,data:[1],format:j.LUMINANCE,type:j.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_offsets:this.isOffsetStatic(m)?m:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return this.layer.triangulation=Ny,[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:MA,fragmentShader:TA,triangulation:Ny,depth:{enable:!1},primitive:j.POINTS,blend:this.getBlend(),stencil:ja(f,m)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(s,f,v,m){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Ec.additive}}}]),r}(po);function PA(e){var i=IA();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function IA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OA=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  styleMappingMat[2].ba;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,RA=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform float u_speed: 1.0;
uniform float u_time;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - a_Extrude.x - a_Extrude.y
    0.0, 0.0, 0.0, 0.0  // 
  );

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  styleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> empty -> empty ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;


  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  vec2 offset = (extrude.xy * (newSize) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,LA=function(e){(0,wr.Z)(r,e);var i=PA(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"meter2coord",1),(0,A.Z)((0,ae.Z)(n),"isMeter",!1),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,m=v===void 0?[0,0]:v,x=a.blend,C=a.speed,T=C===void 0?1:C;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:m})){this.judgeStyleAttributes({opacity:f,offsets:m});var O=this.layer.getEncodedData(),D=this.calDataFrame(this.cellLength,O,this.cellProperties),Z=D.data,W=D.width,Q=D.height;this.rowCount=Q,this.dataTexture=this.cellLength>0&&Z.length>0?this.createTexture2D({flipY:!0,data:Z,format:j.LUMINANCE,type:j.FLOAT,width:W,height:Q}):this.createTexture2D({flipY:!0,data:[1],format:j.LUMINANCE,type:j.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:T,u_additive:x==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_offsets:this.isOffsetStatic(m)?m:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,f=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(f),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Oh)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,f=s===void 0?"l7size":s,v=this.mapService.version;return f==="meter"&&v!==Bs.L7MAP&&v!==Bs.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,nn.Z)(this.layer.getSource().extent,4),s=a[0],f=a[1],v=a[2],m=a[3],x=[(s+v)/2,(f+m)/2],C=this.mapService.version;if(C===Bs.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),O=1,D=O*T.meterInMercatorCoordinateUnits(),Z=new window.mapboxgl.MercatorCoordinate(T.x-D,T.y,T.z),W=Z.toLngLat();this.meter2coord=x[0]-W.lng;return}var Q=this.mapService.meterToCoord(x,[s,f]),ye=this.mapService.meterToCoord(x,[v===s?v+.1:v,m===f?f+.1:m]);this.meter2coord=(Q+ye)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:O,vertexShader:T,fragmentShader:C,triangulation:Oh,depth:{enable:!1},blend:this.getBlend(),stencil:ja(f,m),cull:{enable:!0,face:Gl(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:OA,vert:RA,type:"point_radar"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:In.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:3,update:function(f,v,m,x){var C;C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var T=x%4*3;return[C[T],C[T+1],C[T+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(f,v,m,x){var C=f.size,T=C===void 0?5:C;return Array.isArray(T)?[T[0]*a.meter2coord]:[T*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:In.Attribute,descriptor:{name:"a_Shape",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(f,v,m,x){var C=f.shape,T=C===void 0?2:C,O=a.layer.getLayerConfig().shape2d,D=O.indexOf(T);return[D]}}})}}]),r}(po);function kA(e){var i=DA();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function DA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FA=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,BA=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  vec2 offset = project_pixel(textrueOffsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Uy(e){var i=e.coordinates;return{vertices:(0,Se.Z)(i),indices:[0],size:i.length}}var NA=function(e){(0,wr.Z)(r,e);var i=kA(r);function r(){return(0,st.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.offsets,m=v===void 0?[0,0]:v,x=a.blend,C=a.strokeOpacity,T=C===void 0?1:C,O=a.strokeWidth,D=O===void 0?0:O,Z=a.stroke,W=Z===void 0?"#fff":Z;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,offsets:m})){this.judgeStyleAttributes({opacity:f,offsets:m});var Q=this.layer.getEncodedData(),ye=this.calDataFrame(this.cellLength,Q,this.cellProperties),Be=ye.data,qe=ye.width,rt=ye.height;this.rowCount=rt,this.dataTexture=this.cellLength>0&&Be.length>0?this.createTexture2D({flipY:!0,data:Be,format:j.LUMINANCE,type:j.FLOAT,width:qe,height:rt}):this.createTexture2D({flipY:!0,data:[1],format:j.LUMINANCE,type:j.FLOAT,width:1,height:1})}return{u_additive:x==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(f),u_offsets:this.isOffsetStatic(m)?m:[0,0],u_stroke_opacity:Number(T),u_stroke_width:Number(D),u_stroke_color:this.getStrokeColor(W)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return this.layer.triangulation=Uy,[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:BA,fragmentShader:FA,triangulation:Uy,depth:{enable:!1},primitive:j.POINTS,blend:this.getBlend(),stencil:ja(f,m)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(s,f,v,m){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Ec.additive}}}]),r}(po);function zA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=UA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function UA(e,i){if(!!e){if(typeof e=="string")return Zy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Zy(e,i)}}function Zy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var ZA=function(){function e(i,r,n){(0,st.Z)(this,e),(0,A.Z)(this,"boxCells",[]),(0,A.Z)(this,"xCellCount",void 0),(0,A.Z)(this,"yCellCount",void 0),(0,A.Z)(this,"boxKeys",void 0),(0,A.Z)(this,"bboxes",void 0),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"xScale",void 0),(0,A.Z)(this,"yScale",void 0),(0,A.Z)(this,"boxUid",void 0);var a=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var s=0;s<this.xCellCount*this.yCellCount;s++)a.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,Ct.Z)(e,[{key:"insert",value:function(r,n,a,s,f){this.forEachCell(n,a,s,f,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(f)}},{key:"query",value:function(r,n,a,s,f){return this.queryHitTest(r,n,a,s,!1,f)}},{key:"hitTest",value:function(r,n,a,s,f){return this.queryHitTest(r,n,a,s,!0,f)}},{key:"insertBoxCell",value:function(r,n,a,s,f,v){this.boxCells[f].push(v)}},{key:"queryHitTest",value:function(r,n,a,s,f,v){if(a<0||r>this.width||s<0||n>this.height)return f?!1:[];var m=[];if(r<=0&&n<=0&&this.width<=a&&this.height<=s){if(f)return!0;for(var x=0;x<this.boxKeys.length;x++)m.push({key:this.boxKeys[x],x1:this.bboxes[x*4],y1:this.bboxes[x*4+1],x2:this.bboxes[x*4+2],y2:this.bboxes[x*4+3]});return v?m.filter(v):m}var C={hitTest:f,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,a,s,this.queryCell,m,C,v),f?m.length>0:m}},{key:"queryCell",value:function(r,n,a,s,f,v,m,x){var C=m.seenUids,T=this.boxCells[f];if(T!==null){var O=this.bboxes,D=zA(T),Z;try{for(D.s();!(Z=D.n()).done;){var W=Z.value;if(!C.box[W]){C.box[W]=!0;var Q=W*4;if(r<=O[Q+2]&&n<=O[Q+3]&&a>=O[Q+0]&&s>=O[Q+1]&&(!x||x(this.boxKeys[W]))){if(m.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[W],x1:O[Q],y1:O[Q+1],x2:O[Q+2],y2:O[Q+3]})}}}}catch(ye){D.e(ye)}finally{D.f()}}return!1}},{key:"forEachCell",value:function(r,n,a,s,f,v,m,x){for(var C=this.convertToXCellCoord(r),T=this.convertToYCellCoord(n),O=this.convertToXCellCoord(a),D=this.convertToYCellCoord(s),Z=C;Z<=O;Z++)for(var W=T;W<=D;W++){var Q=this.xCellCount*W+Z;if(f.call(this,r,n,a,s,Q,v,m,x))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),jA=ZA,VA=function(){function e(i,r){(0,st.Z)(this,e),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"grid",void 0),(0,A.Z)(this,"viewportPadding",100),(0,A.Z)(this,"screenRightBoundary",void 0),(0,A.Z)(this,"screenBottomBoundary",void 0),(0,A.Z)(this,"gridRightBoundary",void 0),(0,A.Z)(this,"gridBottomBoundary",void 0),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new jA(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,Ct.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,a=r.y1+r.anchorPointY+this.viewportPadding,s=r.x2+r.anchorPointX+this.viewportPadding,f=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,a,s,f)||this.grid.hitTest(n,a,s,f)?{box:[]}:{box:[n,a,s,f]}}},{key:"insertCollisionBox",value:function(r,n){var a={featureIndex:n};this.grid.insert(a,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,a){var s=$o(n,a,0,1),f=Mf(),v=$r.apply(Oe,(0,Se.Z)(r));return G(f,s,v),{x:(f[0]/f[3]+1)/2*this.width+this.viewportPadding,y:(-f[1]/f[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,a,s){return a>=0&&r<this.gridRightBoundary&&s>=0&&n<this.gridBottomBoundary}}]),e}();function jy(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=GA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function GA(e,i){if(!!e){if(typeof e=="string")return Vy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Vy(e,i)}}function Vy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Gy(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function Hy(e,i,r,n,a){if(!!a){var s=e[n],f=s.glyph;if(f)for(var v=i[f].advance*s.scale,m=(e[n].x+v)*a,x=r;x<=n;x++)e[x].x-=m}}function Wy(e,i,r,n,a,s,f){var v=(i-r)*a,m=(-n*f+.5)*s,x=jy(e),C;try{for(x.s();!(C=x.n()).done;){var T=C.value;T.x+=v,T.y+=m}}catch(O){x.e(O)}finally{x.f()}}function HA(e,i,r,n,a,s,f){var v=-8,m=0,x=v,C=0,T=e.positionedGlyphs,O=s==="right"?1:s==="left"?0:.5,D=T.length;r.forEach(function(Be){if(Be.split("").forEach(function(rt){var _t=i[rt],mt=0;_t&&(T.push({glyph:rt,x:m,y:x+mt,vertical:!1,scale:1,metrics:_t}),m+=_t.advance+f)}),T.length!==D){var qe=m-f;C=Math.max(qe,C),Hy(T,i,D,T.length-1,O)}m=0,x-=n+5});var Z=Gy(a),W=Z.horizontalAlign,Q=Z.verticalAlign;Wy(T,O,W,Q,C,n,r.length);var ye=x-v;e.top+=-Q*ye,e.bottom=e.top-ye,e.left+=-W*C,e.right=e.left+C}function WA(e,i,r,n,a,s,f){var v=-8,m=0,x=v,C=0,T=e.positionedGlyphs,O=s==="right"?1:s==="left"?0:.5,D=T.length;r.forEach(function(Be){var qe=i[Be],rt=0;if(qe&&(T.push({glyph:Be,x:qe.advance/2,y:x+rt,vertical:!1,scale:1,metrics:qe}),m+=qe.advance+f),T.length!==D){var _t=m-f;C=Math.max(_t,C),Hy(T,i,D,T.length-1,O)}m=0,x-=n+5});var Z=Gy(a),W=Z.horizontalAlign,Q=Z.verticalAlign;Wy(T,O,W,Q,C,n,r.length);var ye=x-v;e.top+=-Q*ye,e.bottom=e.top-ye,e.left+=-W*C,e.right=e.left+C}function XA(e,i,r,n,a,s){var f=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],v=arguments.length>7?arguments[7]:void 0,m=e.split(`
`),x=[],C={positionedGlyphs:x,top:f[1],bottom:f[1],left:f[0],right:f[0],lineCount:m.length,text:e};return v?WA(C,i,m,r,n,a,s):HA(C,i,m,r,n,a,s),x.length?C:!1}function YA(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,a=n===void 0?[]:n,s=[],f=jy(a),v;try{for(f.s();!(v=f.n()).done;){var m=v.value,x=m.metrics,C=4,T=x.advance*m.scale/2,O=r?[m.x+T,m.y]:[0,0],D=r?[0,0]:[m.x+T+i[0],m.y+i[1]],Z=(0-C)*m.scale-T+D[0],W=(0-C)*m.scale+D[1],Q=Z+x.width*m.scale,ye=W+x.height*m.scale,Be={x:Z,y:W},qe={x:Q,y:W},rt={x:Z,y:ye},_t={x:Q,y:ye};s.push({tl:Be,tr:qe,bl:rt,br:_t,tex:x,glyphOffset:O})}}catch(mt){f.e(mt)}finally{f.f()}return s}function qA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=KA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function KA(e,i){if(!!e){if(typeof e=="string")return Xy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xy(e,i)}}function Xy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function $A(e){var i=QA();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function QA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Yy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,qy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function Ky(e){var i=this,r=e.id,n=[],a=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var s=i.glyphInfoMap[r].centroid,f=s.length===2?[s[0],s[1],0]:s;return i.glyphInfoMap[r].glyphQuads.forEach(function(v,m){n.push.apply(n,(0,Se.Z)(f).concat([v.tex.x,v.tex.y+v.tex.height,v.tl.x,v.tl.y],(0,Se.Z)(f),[v.tex.x+v.tex.width,v.tex.y+v.tex.height,v.tr.x,v.tr.y],(0,Se.Z)(f),[v.tex.x+v.tex.width,v.tex.y,v.br.x,v.br.y],(0,Se.Z)(f),[v.tex.x,v.tex.y,v.bl.x,v.bl.y])),a.push(0+m*4,1+m*4,2+m*4,2+m*4,3+m*4,0+m*4)}),{vertices:n,indices:a,size:7}}var $y=function(e){(0,wr.Z)(r,e);var i=$A(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"glyphInfo",void 0),(0,A.Z)((0,ae.Z)(n),"glyphInfoMap",{}),(0,A.Z)((0,ae.Z)(n),"texture",void 0),(0,A.Z)((0,ae.Z)(n),"currentZoom",-1),(0,A.Z)((0,ae.Z)(n),"extent",void 0),(0,A.Z)((0,ae.Z)(n),"textureHeight",0),(0,A.Z)((0,ae.Z)(n),"textCount",0),(0,A.Z)((0,ae.Z)(n),"preTextStyle",{}),(0,A.Z)((0,ae.Z)(n),"buildModels",function(){var v=n.layer.getLayerConfig(),m=v.mask,x=m===void 0?!1:m,C=v.maskInside,T=C===void 0?!0:C;return n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel(),[n.layer.buildLayerModel({moduleName:"pointText",vertexShader:qy,fragmentShader:Yy,triangulation:Ky.bind((0,ae.Z)(n)),depth:{enable:!1},blend:n.getBlend(),stencil:ja(x,T)})]}),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.stroke,m=v===void 0?"#fff":v,x=a.strokeWidth,C=x===void 0?0:x,T=a.textAnchor,O=T===void 0?"center":T,D=a.textAllowOverlap,Z=D===void 0?!1:D,W=a.halo,Q=W===void 0?.5:W,ye=a.gamma,Be=ye===void 0?2:ye,qe=a.raisingHeight,rt=qe===void 0?0:qe,_t=this.fontService,mt=_t.canvas,Ht=_t.mapping;if(Object.keys(Ht).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Ht).length),this.preTextStyle={textAnchor:O,textAllowOverlap:Z},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f,strokeWidth:C,stroke:m})){this.judgeStyleAttributes({opacity:f,strokeWidth:C,stroke:m});var rr=this.layer.getEncodedData(),Cr=this.calDataFrame(this.cellLength,rr,this.cellProperties),qr=Cr.data,gr=Cr.width,sn=Cr.height;this.rowCount=sn,this.dataTexture=this.cellLength>0&&qr.length>0?this.createTexture2D({flipY:!0,data:qr,format:j.LUMINANCE,type:j.FLOAT,width:gr,height:sn}):this.createTexture2D({flipY:!0,data:[1],format:j.LUMINANCE,type:j.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(rt),u_opacity:Number(f),u_stroke_width:Number(C),u_stroke_color:this.getStrokeColor(m),u_sdf_map:this.texture,u_halo_blur:Q,u_gamma_scale:Be,u_sdf_map_size:[mt.width,mt.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var a=this.layer.getLayerConfig(),s=a.textAnchor,f=s===void 0?"center":s,v=a.textAllowOverlap,m=v===void 0?!0:v;return this.preTextStyle={textAnchor:f,textAllowOverlap:m},this.buildModels()}},{key:"needUpdate",value:function(){var a=this.layer.getLayerConfig(),s=a.textAllowOverlap,f=s===void 0?!1:s,v=this.mapService.getZoom(),m=this.mapService.getBounds(),x=sa(this.extent,m);return!f&&(Math.abs(this.currentZoom-v)>1||!x)||f!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:In.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(s,f,v,m){var x=s.rotate,C=x===void 0?0:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:In.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:2,update:function(s,f,v,m){return[v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(s,f,v,m){var x=s.size,C=x===void 0?12:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:In.Attribute,descriptor:{name:"a_tex",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:2,update:function(s,f,v,m){return[v[3],v[4]]}}})}},{key:"textExtent",value:function(){var a=this.mapService.getBounds();return _l(a,.5)}},{key:"initTextFont",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,f=s===void 0?"400":s,v=a.fontFamily,m=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),C=[];x.forEach(function(T){var O=T.shape,D=O===void 0?"":O;D=D.toString();var Z=qA(D),W;try{for(Z.s();!(W=Z.n()).done;){var Q=W.value;C.indexOf(Q)===-1&&C.push(Q)}}catch(ye){Z.e(ye)}finally{Z.f()}}),this.fontService.setFontOptions({characterSet:C,fontWeight:f,fontFamily:m,iconfont:!1})}},{key:"initIconFontTex",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,f=s===void 0?"400":s,v=a.fontFamily,m=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),C=[];x.forEach(function(T){var O=T.shape,D=O===void 0?"":O;D="".concat(D),C.indexOf(D)===-1&&C.push(D)}),this.fontService.setFontOptions({characterSet:C,fontWeight:f,fontFamily:m,iconfont:!0})}},{key:"generateGlyphLayout",value:function(a){var s=this,f=this.fontService.mapping,v=this.layer.getLayerConfig(),m=v.spacing,x=m===void 0?2:m,C=v.textAnchor,T=C===void 0?"center":C,O=this.layer.getEncodedData();this.glyphInfo=O.map(function(D){var Z=D.shape,W=Z===void 0?"":Z,Q=D.id,ye=D.size,Be=ye===void 0?1:ye,qe=D.textOffset,rt=qe===void 0?[0,0]:qe,_t=XA(W.toString(),f,Be,T,"left",x,rt,a),mt=YA(_t,rt,!1);return D.shaping=_t,D.glyphQuads=mt,D.centroid=Mh(D.coordinates),D.originCentroid=D.version==="GAODE2.x"?Mh(D.originCoordinates):D.originCentroid=D.centroid,s.glyphInfoMap[Q]={shaping:_t,glyphQuads:mt,centroid:Mh(D.coordinates)},D})}},{key:"filterGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.padding,v=f===void 0?[4,4]:f,m=s.textAllowOverlap,x=m===void 0?!1:m;if(!x){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var C=this.rendererService.getViewportSize(),T=C.width,O=C.height,D=new VA(T,O),Z=this.glyphInfo.filter(function(W){var Q=W.shaping,ye=W.id,Be=ye===void 0?0:ye,qe=W.version==="GAODE2.x"?W.originCentroid:W.centroid,rt=W.size,_t=rt/24,mt=a.mapService.lngLatToContainer(qe),Ht=D.placeCollisionBox({x1:Q.left*_t-v[0],x2:Q.right*_t+v[0],y1:Q.top*_t-v[1],y2:Q.bottom*_t+v[1],anchorPointX:mt.x,anchorPointY:mt.y}),rr=Ht.box;return rr&&rr.length?(D.insertCollisionBox(rr,Be),!0):!1});Z.forEach(function(W){a.glyphInfoMap[W.id]=W})}}},{key:"initGlyph",value:function(){var a=this.layer.getLayerConfig(),s=a.iconfont,f=s===void 0?!1:s;f?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(f)}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.textureHeight=s.height,this.texture&&this.texture.destroy(),this.texture=a({data:s,mag:j.LINEAR,min:j.LINEAR,width:s.width,height:s.height})}},{key:"reBuildModel",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:qy,fragmentShader:Yy,triangulation:Ky.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:ja(f,m)})]}}]),r}(po),JA={fillImage:vA,fill:Fy,radar:LA,image:By,normal:zy,simplePoint:NA,extrude:ky,text:$y,icon:xA},ew=JA;function tw(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=rw(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,f=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){f=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(f)throw v}}}}function rw(e,i){if(!!e){if(typeof e=="string")return Qy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Qy(e,i)}}function Qy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function nw(e){var i=iw();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function iw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Jy=function(e){(0,wr.Z)(r,e);var i=nw(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"type","PointLayer"),n}return(0,Ct.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new ew[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var a=this.shapeOption,s=a.field,f=a.values,v=this.getLayerConfig(),m=v.shape2d,x=v.shape3d,C=this.iconService.getIconMap();if(s&&(m==null?void 0:m.indexOf(s))!==-1)return"fill";if(f&&f instanceof Array){var T=tw(f),O;try{for(T.s();!(O=T.n()).done;){var D=O.value;if(typeof D=="string"&&C.hasOwnProperty(D))return"image"}}catch(Z){T.e(Z)}finally{T.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return s[a]}},{key:"getModelType",value:function(){var a=["fillImage","fill","radar","image","normal","simplePoint","extrude","text","icon"];if(this.layerType&&a.includes(this.layerType))return this.layerType;var s=this.getEncodedData(),f=this.getLayerConfig(),v=f.shape2d,m=f.shape3d,x=this.iconService.getIconMap(),C=s.find(function(O){return O.hasOwnProperty("shape")});if(C){var T=C.shape;return T==="dot"?"normal":T==="simple"?"simplePoint":T==="radar"?"radar":T==="fillImage"?"fillImage":(v==null?void 0:v.indexOf(T))!==-1?"fill":(m==null?void 0:m.indexOf(T))!==-1?"extrude":x.hasOwnProperty(T)?"image":this.fontService.getGlyph(T)!==""?"icon":"text"}else return this.getModelTypeWillEmptyData()}}]),r}($p);function aw(e){var i=ow();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function ow(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sw=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,uw=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  if(styleMappingMat[0][3] < 1.0 ) {
    // side
    styleMappingMat[0][0] = 0.0;
  } else {

  }

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,lw=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,cw=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,fw=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,pw=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,hw=function(e){(0,wr.Z)(r,e);var i=aw(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"texture",void 0),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.heightfixed,m=v===void 0?!1:v,x=a.raisingHeight,C=x===void 0?0:x,T=a.topsurface,O=T===void 0?!0:T,D=a.sidesurface,Z=D===void 0?!0:D,W=a.sourceColor,Q=a.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var ye=this.layer.getEncodedData(),Be=this.calDataFrame(this.cellLength,ye,this.cellProperties),qe=Be.data,rt=Be.width,_t=Be.height;this.rowCount=_t,this.dataTexture=this.cellLength>0&&qe.length>0?this.createTexture2D({flipY:!0,data:qe,format:j.LUMINANCE,type:j.FLOAT,width:rt,height:_t}):this.createTexture2D({flipY:!0,data:[1],format:j.LUMINANCE,type:j.FLOAT,width:1,height:1})}var mt=0,Ht=[1,1,1,1],rr=[1,1,1,1];return W&&Q&&(Ht=Qi(W),rr=Qi(Q),mt=1),{u_topsurface:Number(O),u_sidesurface:Number(Z),u_heightfixed:Number(m),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(C),u_opacity:Number(f),u_linearColor:mt,u_sourceColor:Ht,u_targetColor:rr,u_texture:this.texture}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:O,vertexShader:T,fragmentShader:C,triangulation:cy,stencil:ja(f,m),cull:{enable:!0,face:j.BACK}})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.pickLight,f=a.mapTexture;return f?{frag:lw,vert:cw,type:"polygonExtrudeTexture"}:s?{frag:fw,vert:pw,type:"polygonExtrudePickLight"}:{frag:sw,vert:uw,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var a,s;(a=this.dataTexture)===null||a===void 0||a.destroy(),(s=this.texture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,nn.Z)(a,4),f=s[0],v=s[1],m=s[2],x=s[3],C=m-f,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:In.Attribute,descriptor:{name:"a_uvs",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:3,update:function(D,Z,W,Q,ye){var Be=W[0],qe=W[1];return[(Be-f)/C,(qe-v)/T,W[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:In.Attribute,descriptor:{name:"a_Normal",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:3,update:function(D,Z,W,Q,ye){return ye}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(D,Z,W,Q){var ye=D.size,Be=ye===void 0?10:ye;return Array.isArray(Be)?[Be[0]]:[Be]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.mapTexture,v=this.rendererService.createTexture2D;if(this.texture=v({height:0,width:0}),f){var m=new Image;m.crossOrigin="",m.src=f,m.onload=function(){a.texture=v({data:m,width:m.width,height:m.height,wrapS:j.CLAMP_TO_EDGE,wrapT:j.CLAMP_TO_EDGE,min:j.LINEAR,mag:j.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}}]),r}(po);function dw(e){var i=vw();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function vw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mw=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,gw=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,yw=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,_w=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,xw=function(e){(0,wr.Z)(r,e);var i=dw(r);function r(){return(0,st.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.raisingHeight,f=s===void 0?0:s,v=a.opacity,m=v===void 0?1:v,x=a.opacityLinear,C=x===void 0?{enable:!1,dir:"in"}:x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:m})){this.judgeStyleAttributes({opacity:m});var T=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,T,this.cellProperties),D=O.data,Z=O.width,W=O.height;this.rowCount=W,this.dataTexture=this.cellLength>0&&D.length>0?this.createTexture2D({flipY:!0,data:D,format:j.LUMINANCE,type:j.FLOAT,width:Z,height:W}):this.createTexture2D({flipY:!0,data:[1],format:j.LUMINANCE,type:j.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(f),u_opacity:m,u_opacitylinear:Number(C.enable),u_dir:C.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.getModelParams(),s=a.frag,f=a.vert,v=a.triangulation,m=a.type,x=this.layer.getLayerConfig(),C=x.mask,T=C===void 0?!1:C,O=x.maskInside,D=O===void 0?!0:O;return this.layer.triangulation=v,[this.layer.buildLayerModel({moduleName:m,vertexShader:f,fragmentShader:s,triangulation:v,blend:this.getBlend(),depth:{enable:!1},cull:{enable:!0,face:j.BACK},stencil:ja(T,D)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,f=s===void 0?{enable:!1,dir:"in"}:s;f.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:In.Attribute,descriptor:{name:"a_linear",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:3,update:function(m,x,C,T,O){return[C[3],C[4],C[5]]}}})}},{key:"getModelParams",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,f=s===void 0?{enable:!1}:s;return f.enable?{frag:gw,vert:yw,type:"polygon_linear",triangulation:PE}:{frag:mw,vert:_w,type:"polygon_fill",triangulation:Bv}}}]),r}(po);function bw(e){var i=Ew();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Ew(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sw=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = styleMappingMat[0][0];
  gl_FragColor = vec4(col, opacity);  
}
`,Cw=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,Aw=function(e){(0,wr.Z)(r,e);var i=bw(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"texture1",void 0),(0,A.Z)((0,ae.Z)(n),"texture2",void 0),(0,A.Z)((0,ae.Z)(n),"texture3",void 0),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.watercolor,m=v===void 0?"#6D99A8":v,x=a.watercolor2,C=x===void 0?"#0F121C":x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var T=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,T,this.cellProperties),D=O.data,Z=O.width,W=O.height;this.rowCount=W,this.dataTexture=this.cellLength>0&&D.length>0?this.createTexture2D({flipY:!0,data:D,format:j.LUMINANCE,type:j.FLOAT,width:Z,height:W}):this.createTexture2D({flipY:!0,data:[1],format:j.LUMINANCE,type:j.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:Qi(m),u_watercolor2:Qi(C),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:f}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_ocean",vertexShader:Cw,fragmentShader:Sw,triangulation:Bv,depth:{enable:!1},stencil:ja(f,m)})]}},{key:"clearModels",value:function(){var a,s,f,v;(a=this.texture1)===null||a===void 0||a.destroy(),(s=this.texture2)===null||s===void 0||s.destroy(),(f=this.texture3)===null||f===void 0||f.destroy(),(v=this.dataTexture)===null||v===void 0||v.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,nn.Z)(a,4),f=s[0],v=s[1],m=s[2],x=s[3],C=m-f,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:In.Attribute,descriptor:{name:"a_uv",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:2,update:function(D,Z,W,Q,ye){var Be=(0,nn.Z)(W,2),qe=Be[0],rt=Be[1];return[(qe-f)/C,(rt-v)/T]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.rendererService.createTexture2D,f={height:0,width:0};this.texture1=s(f),this.texture2=s(f),this.texture3=s(f),v(function(x){a.texture1=m(x[0]),a.texture2=m(x[1]),a.texture3=m(x[2]),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});function v(x){var C=0,T=[],O=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];O.map(function(D){var Z=new Image;Z.crossOrigin="",Z.src=D,T.push(Z),Z.onload=function(){C++,C===3&&x(T)}})}function m(x){return s({data:x,width:x.width,height:x.height,wrapS:j.MIRRORED_REPEAT,wrapT:j.MIRRORED_REPEAT,min:j.LINEAR,mag:j.LINEAR})}}}]),r}(po);function ww(e){var i=Tw();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Tw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Mw=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E


float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,Pw=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,Iw=function(e){(0,wr.Z)(r,e);var i=ww(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"texture",void 0),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.speed,m=v===void 0?.5:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:f})){this.judgeStyleAttributes({opacity:f});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),T=C.data,O=C.width,D=C.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:j.LUMINANCE,type:j.FLOAT,width:O,height:D}):this.createTexture2D({flipY:!0,data:[1],format:j.LUMINANCE,type:j.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:m,u_opacity:f}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_water",vertexShader:Pw,fragmentShader:Mw,triangulation:Bv,depth:{enable:!1},stencil:ja(f,m)})]}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,nn.Z)(a,4),f=s[0],v=s[1],m=s[2],x=s[3],C=m-f,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:In.Attribute,descriptor:{name:"a_uv",buffer:{usage:j.STATIC_DRAW,data:[],type:j.FLOAT},size:2,update:function(D,Z,W,Q,ye){var Be=(0,nn.Z)(W,2),qe=Be[0],rt=Be[1];return[(qe-f)/C,(rt-v)/T]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),f=s.waterTexture,v=this.rendererService.createTexture2D;this.texture=v({height:0,width:0});var m=new Image;m.crossOrigin="",f?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),m.src=f):m.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",m.onload=function(){a.texture=v({data:m,width:m.width,height:m.height,wrapS:j.MIRRORED_REPEAT,wrapT:j.MIRRORED_REPEAT,min:j.LINEAR,mag:j.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}]),r}(po),Ow={fill:xw,line:Oy,extrude:hw,text:$y,point_fill:Fy,point_image:By,point_normal:zy,point_extrude:ky,water:Iw,ocean:Aw},Rw=Ow;function Lw(e){var i=kw();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function kw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var e_=function(e){(0,wr.Z)(r,e);var i=Lw(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"type","PolygonLayer"),n}return(0,Ct.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new Rw[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),f=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return f==="fill"?"fill":f==="extrude"?"extrude":f==="water"?"water":f==="ocean"?"ocean":f==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var a=this.getEncodedData(),s=this.getLayerConfig(),f=s.shape2d,v=s.shape3d,m=this.iconService.getIconMap(),x=a.find(function(T){return T.hasOwnProperty("shape")});if(x){var C=x.shape;return C==="dot"?"point_normal":(f==null?void 0:f.indexOf(C))!==-1?"point_fill":(v==null?void 0:v.indexOf(C))!==-1?"point_extrude":m.hasOwnProperty(C)?"point_image":"text"}else return"fill"}}]),r}($p);function Dw(e){var i=Fw();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Fw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Bw=function(e){(0,wr.Z)(r,e);var i=Dw(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"isLayerGroup",!0),n}return(0,Ct.Z)(r,[{key:"addChild",value:function(a){this.layerChildren.push(a)}},{key:"removeChild",value:function(a){var s=this.layerChildren.indexOf(a);s>-1&&this.layerChildren.splice(s,1),a.destroy()}},{key:"clearChild",value:function(){this.layerChildren.forEach(function(a){a.destroy()}),this.layerChildren=[]}},{key:"hasChild",value:function(a){return this.layerChildren.includes(a)}}]),r}($p);function Nw(e){var i=zw();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function zw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Uw=function(e){(0,wr.Z)(r,e);var i=Nw(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"initedTileset",!1),(0,A.Z)((0,ae.Z)(n),"tilesetManager",void 0),(0,A.Z)((0,ae.Z)(n),"showGrid",!1),(0,A.Z)((0,ae.Z)(n),"subGridLayer",void 0),(0,A.Z)((0,ae.Z)(n),"subTextLayer",void 0),(0,A.Z)((0,ae.Z)(n),"lastViewStates",void 0),(0,A.Z)((0,ae.Z)(n),"timer",void 0),(0,A.Z)((0,ae.Z)(n),"renderSubLayers",function(){if(!!n.tilesetManager){var v=n.layer;n.tilesetManager.tiles.filter(function(m){return m.isLoaded}).map(function(m){return m.layer?m.layer.updateLayerConfig({visible:m.isVisible}):(m.layer=n.creatSubLayer(m),v.addChild(m.layer)),m.layer}),n.showGrid&&(v.hasChild(n.subGridLayer)||v.addChild(n.subGridLayer),v.hasChild(n.subTextLayer)||v.addChild(n.subTextLayer)),n.layerService.renderLayers(),n.tilesetManager.isLoaded&&v.emit("tiles-loaded",n.tilesetManager.currentTiles)}}),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){return{}}},{key:"initModels",value:function(){var a,s=this.layer.getSource();this.tilesetManager=s.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var f=this.getCurrentView(),v=f.latLonBounds,m=f.zoom;return(a=this.tilesetManager)===null||a===void 0||a.update(m,v),this.showGrid&&this.renderSubGridLayer(),this.buildModels()}},{key:"buildModels",value:function(){return[]}},{key:"clearModels",value:function(){}},{key:"renderSubGridLayer",value:function(){if(!!this.tilesetManager){var a=this.tilesetManager.currentTiles.map(function(f){return f.bboxPolygon}),s={type:"FeatureCollection",features:a};if(this.subGridLayer){this.subGridLayer.setData(s),this.subTextLayer.setData(s);return}this.subGridLayer=new Ly({autoFit:!1}).source(s).size(1).color("red").shape("simple").style({lineType:"dash",dashArray:[1,2]}),this.subTextLayer=new Jy({autoFit:!1}).source(s).size(14).color("red").shape("meta","text").style({opacity:1,strokeWidth:1,stroke:"#fff"}),this.subGridLayer.setContainer(Qd(this.layer.sceneContainer),this.layer.sceneContainer),this.subTextLayer.setContainer(Qd(this.layer.sceneContainer),this.layer.sceneContainer),this.subGridLayer.init(),this.subTextLayer.init()}}},{key:"registerBuiltinAttributes",value:function(){}},{key:"bindTilesetEvent",value:function(){var a=this;!this.tilesetManager||(this.tilesetManager.on("tile-loaded",function(s){}),this.tilesetManager.on("tile-unload",function(s){a.destroySubLayer(s)}),this.tilesetManager.on("tile-error",function(s,f){}),this.tilesetManager.on("tile-update",this.renderSubLayers),this.mapService.on("mapchange",function(s){var f=a.getCurrentView(),v=f.latLonBounds,m=f.zoom;if(a.mapService.version==="GAODE1.x"){var x=a.layer.getLayerConfig(),C=x.visible;m<3&&C?(a.layer.updateLayerConfig({visible:!1}),a.layerService.updateLayerRenderList()):m>=3&&!C&&(a.layer.updateLayerConfig({visible:!0}),a.layerService.updateLayerRenderList())}a.lastViewStates&&a.lastViewStates.zoom===m&&a.lastViewStates.latLonBounds.toString()===v.toString()||(a.lastViewStates={zoom:m,latLonBounds:v},a.timer&&(clearTimeout(a.timer),a.timer=null),a.timer=setTimeout(function(){var T;(T=a.tilesetManager)===null||T===void 0||T.update(m,v),a.showGrid&&a.renderSubGridLayer()},250))}))}},{key:"creatSubLayer",value:function(a){var s=this.layer.getLayerConfig(),f=s.opacity,v=f===void 0?1:f,m=s.zIndex,x=m===void 0?0:m,C=new Py({visible:a.isVisible,zIndex:x}).source(a.data,{parser:{type:"image",extent:a.bounds}}).style({opacity:v}),T=Qd(this.layer.sceneContainer);return C.setContainer(T,this.layer.sceneContainer),C.init(),C}},{key:"destroySubLayer",value:function(a){if(a.layer){var s=this.layer;s.removeChild(a.layer)}}},{key:"getCurrentView",value:function(){var a=this.mapService.getBounds(),s=[a[0][0],a[0][1],a[1][0],a[1][1]],f=this.mapService.getZoom();return{latLonBounds:s,zoom:f}}}]),r}(po);function Zw(e){var i=jw();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function jw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vw=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,Gw=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,t_=function(e){(0,wr.Z)(r,e);var i=Zw(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"texture",void 0),(0,A.Z)((0,ae.Z)(n),"colorTexture",void 0),n}return(0,Ct.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,f=s===void 0?1:s,v=a.clampLow,m=v===void 0?!0:v,x=a.clampHigh,C=x===void 0?!0:x,T=a.noDataValue,O=T===void 0?-9999999:T,D=a.domain,Z=D===void 0?[0,1]:D;return this.updateColorTexure(),{u_opacity:f||1,u_texture:this.texture,u_domain:Z,u_clampLow:m,u_clampHigh:typeof C!="undefined"?C:m,u_noDataValue:O,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){this.layer.isLayerGroup=!1;var a=this.layer.getLayerConfig(),s=a.mask,f=s===void 0?!1:s,v=a.maskInside,m=v===void 0?!0:v,x=this.layer.getSource(),C=this.rendererService.createTexture2D,T=x.data.dataArray[0];this.texture=C({data:T.data,width:T.width,height:T.height,format:j.LUMINANCE,type:j.FLOAT});var O=this.layer.getLayerConfig(),D=O.rampColors,Z=wu(D);return this.colorTexture=C({data:Z.data,width:Z.width,height:Z.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:Gw,fragmentShader:Vw,triangulation:py,primitive:j.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:ja(f,m)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_Uv",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:2,update:function(s,f,v,m){return[v[3],v[4]]}}})}},{key:"updateColorTexure",value:function(){var a=this.rendererService.createTexture2D,s=this.layer.getLayerConfig(),f=s.rampColors,v=wu(f);this.colorTexture=a({data:v.data,width:v.width,height:v.height,flipY:!1})}}]),r}(po),Hw={raster:t_,raster3d:t_,rasterTile:Uw},Ww=Hw;function Xw(e){var i=Yw();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function Yw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qw=function(e){(0,wr.Z)(r,e);var i=Xw(r);function r(){var n;(0,st.Z)(this,r);for(var a=arguments.length,s=new Array(a),f=0;f<a;f++)s[f]=arguments[f];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,ae.Z)(n),"type","RasterLayer"),n}return(0,Ct.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new Ww[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={raster:{},raster3d:{},rasterTile:{}};return s[a]}},{key:"getModelType",value:function(){switch(this.layerSource.parser.type){case"raster":return"raster";case"rasterTile":return"rasterTile";default:return"raster"}}}]),r}(Bw),r_,n_,i_,a_,o_,iv,s_,u_,l_;function c_(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Kw(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?c_(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c_(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var $w=(r_=(0,Nr.b2)(),n_=(0,Nr.f3)(zt.IGlobalConfigService),i_=(0,Nr.f3)(zt.IMapService),a_=(0,Nr.f3)(zt.IFontService),r_(o_=(iv=function(){function e(){(0,st.Z)(this,e),ti(this,"configService",s_,this),ti(this,"mapService",u_,this),ti(this,"fontService",l_,this)}return(0,Ct.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){a.generateMaping(r,{styleAttributeService:s})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,a.generateMaping(r,{styleAttributeService:s}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var f=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],m=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,C=v.filter(function(O){return O.needRemapping}),T=x;m!=null&&m.needRemapping&&m!==null&&m!==void 0&&m.scale&&(T=x.filter(function(O){return a.applyAttributeMapping(m,O,f)[0]})),C.length&&(m!=null&&m.needRemapping?(r.setEncodedData(a.mapping(v,T,void 0,f,r)),m.needRemapping=!1):r.setEncodedData(a.mapping(C,T,r.getEncodedData(),f,r)),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,n){var a=this,s=n.styleAttributeService,f=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],m=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,C=x;m!=null&&m.scale&&(C=x.filter(function(T){return a.applyAttributeMapping(m,T,f)[0]})),r.setEncodedData(this.mapping(v,C,void 0,f,r)),r.emit("dataUpdate",null)}},{key:"getArrowPoints",value:function(r,n){var a=[n[0]-r[0],n[1]-r[1]],s=hf(a),f=[r[0]+s[0]*1e-4,r[1]+s[1]*1e-4];return f}},{key:"mapping",value:function(r,n,a,s,f){var v=this,m=f==null?void 0:f.getLayerConfig(),x=m.arrow,C=x===void 0?{enable:!1}:x,T=n.map(function(O,D){var Z=a?a[D]:{},W=Kw({id:O._id,coordinates:O.coordinates},Z);if(r.filter(function(Be){return Be.scale!==void 0}).forEach(function(Be){var qe=v.applyAttributeMapping(Be,O,s);Be.needRemapping=!1,Be.name==="color"&&(qe=qe.map(function(rt){return Qi(rt)})),W[Be.name]=Array.isArray(qe)&&qe.length===1?qe[0]:qe,Be.name==="shape"&&(W.shape=v.fontService.getIconFontKey(W[Be.name]))}),W.shape==="line"&&C.enable){var Q=W.coordinates,ye=v.getArrowPoints(Q[0],Q[1]);W.coordinates.splice(1,0,ye,ye)}return W});return this.adjustData2Amap2Coordinates(T),this.adjustData2SimpleCoordinates(T),T}},{key:"adjustData2Amap2Coordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===Bs["GAODE2.x"]&&(typeof r[0].coordinates[0]=="number"?r.filter(function(a){return!a.originCoordinates}).map(function(a){a.version=Bs["GAODE2.x"],a.originCoordinates=Pu()(a.coordinates),a.coordinates=n.mapService.lngLatToCoord(a.coordinates)}):r.filter(function(a){return!a.originCoordinates}).map(function(a){a.version=Bs["GAODE2.x"],a.originCoordinates=Pu()(a.coordinates),a.coordinates=n.mapService.lngLatToCoords(a.coordinates)}))}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===Bs.SIMPLE&&r.map(function(a){a.simpleCoordinate||(a.coordinates=n.unProjectCoordinates(a.coordinates),a.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var a=[];return r.map(function(f){var v=[];f.map(function(m){v.push(n.mapService.simpleMapCoord.unproject(m))}),a.push(v)}),a}else{var s=[];return r.map(function(f){s.push(n.mapService.simpleMapCoord.unproject(f))}),s}}},{key:"applyAttributeMapping",value:function(r,n,a){var s;if(!r.scale)return[];var f=(r==null||(s=r.scale)===null||s===void 0?void 0:s.scalers)||[],v=[];f.forEach(function(x){var C,T=x.field;(n.hasOwnProperty(T)||((C=r.scale)===null||C===void 0?void 0:C.type)==="variable")&&v.push(n[T])});var m=r.mapping?r.mapping(v):[];return r.name==="color"&&!jl(m[0])?[a]:m}}]),e}(),s_=ci(iv.prototype,"configService",[n_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u_=ci(iv.prototype,"mapService",[i_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l_=ci(iv.prototype,"fontService",[a_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iv))||o_),f_,p_,Qw=(f_=(0,Nr.b2)(),f_(p_=function(){function e(){(0,st.Z)(this,e),(0,A.Z)(this,"mapService",void 0)}return(0,Ct.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(zt.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var a=r.getSource();if(!a){var s=r.sourceOption||{data:sl,options:Hh},f=s.data,v=s.options;r.setSource(new sh(f,v))}n.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var a=n.updateClusterData(r),s=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,a||s})}},{key:"updateClusterData",value:function(r){var n=r.getSource(),a=n.cluster,s=n.clusterOptions,f=s.zoom,v=f===void 0?0:f,m=s.maxZoom,x=m===void 0?16:m,C=this.mapService.getZoom()-1,T=r.dataState.dataSourceNeedUpdate;return a&&(T||Math.abs(r.clusterZoom-C)>=1)?(v!==Math.floor(C)&&n.updateClusterData(Math.floor(C)),r.clusterZoom=C,!0):!1}}]),e}())||p_);function Z0(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function h_(e){return e.length===1&&(e=Jw(e)),{left:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)<0?n=s+1:a=s}return n},right:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)>0?a=s:n=s+1}return n}}}function Jw(e){return function(i,r){return Z0(e(i),r)}}var d_=h_(Z0),eT=d_.right,XP=d_.left,Vv=eT;function tT(e,i){var r=e.length,n=-1,a,s,f;if(i==null){for(;++n<r;)if((a=e[n])!=null&&a>=a)for(s=f=a;++n<r;)(a=e[n])!=null&&(s>a&&(s=a),f<a&&(f=a))}else for(;++n<r;)if((a=i(e[n],n,e))!=null&&a>=a)for(s=f=a;++n<r;)(a=i(e[n],n,e))!=null&&(s>a&&(s=a),f<a&&(f=a));return[s,f]}var v_=Array.prototype,YP=v_.slice,qP=v_.map,j0=Math.sqrt(50),V0=Math.sqrt(10),G0=Math.sqrt(2);function m_(e,i,r){var n,a=-1,s,f,v;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(s=e,e=i,i=s),(v=Gv(e,i,r))===0||!isFinite(v))return[];if(v>0)for(e=Math.ceil(e/v),i=Math.floor(i/v),f=new Array(s=Math.ceil(i-e+1));++a<s;)f[a]=(e+a)*v;else for(e=Math.floor(e*v),i=Math.ceil(i*v),f=new Array(s=Math.ceil(e-i+1));++a<s;)f[a]=(e-a)/v;return n&&f.reverse(),f}function Gv(e,i,r){var n=(i-e)/Math.max(0,r),a=Math.floor(Math.log(n)/Math.LN10),s=n/Math.pow(10,a);return a>=0?(s>=j0?10:s>=V0?5:s>=G0?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(s>=j0?10:s>=V0?5:s>=G0?2:1)}function H0(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),a=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),s=n/a;return s>=j0?a*=10:s>=V0?a*=5:s>=G0&&(a*=2),i<e?-a:a}function KP(){var e=identity,i=extent,r=sturges;function n(a){var s,f=a.length,v,m=new Array(f);for(s=0;s<f;++s)m[s]=e(a[s],s,a);var x=i(m),C=x[0],T=x[1],O=r(m,C,T);Array.isArray(O)||(O=tickStep(C,T,O),O=range(Math.ceil(C/O)*O,T,O));for(var D=O.length;O[0]<=C;)O.shift(),--D;for(;O[D-1]>T;)O.pop(),--D;var Z=new Array(D+1),W;for(s=0;s<=D;++s)W=Z[s]=[],W.x0=s>0?O[s-1]:C,W.x1=s<D?O[s]:T;for(s=0;s<f;++s)v=m[s],C<=v&&v<=T&&Z[bisect(O,v,0,D)].push(a[s]);return Z}return n.value=function(a){return arguments.length?(e=typeof a=="function"?a:constant(a),n):e},n.domain=function(a){return arguments.length?(i=typeof a=="function"?a:constant([a[0],a[1]]),n):i},n.thresholds=function(a){return arguments.length?(r=typeof a=="function"?a:Array.isArray(a)?constant(slice.call(a)):constant(a),n):r},n}function $P(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function rT(e){return e===null?NaN:+e}function nT(e,i,r){if(r==null&&(r=rT),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,a=(n-1)*i,s=Math.floor(a),f=+r(e[s],s,e),v=+r(e[s+1],s+1,e);return f+(v-f)*(a-s)}}var wc="$";function Hv(){}Hv.prototype=g_.prototype={constructor:Hv,has:function(e){return wc+e in this},get:function(e){return this[wc+e]},set:function(e,i){return this[wc+e]=i,this},remove:function(e){var i=wc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===wc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===wc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===wc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===wc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===wc&&++e;return e},empty:function(){for(var e in this)if(e[0]===wc)return!1;return!0},each:function(e){for(var i in this)i[0]===wc&&e(this[i],i.slice(1),this)}};function g_(e,i){var r=new Hv;if(e instanceof Hv)e.each(function(v,m){r.set(m,v)});else if(Array.isArray(e)){var n=-1,a=e.length,s;if(i==null)for(;++n<a;)r.set(n,e[n]);else for(;++n<a;)r.set(i(s=e[n],n,e),s)}else if(e)for(var f in e)r.set(f,e[f]);return r}var W0=g_;function QP(){var e=[],i=[],r,n,a;function s(v,m,x,C){if(m>=e.length)return r!=null&&v.sort(r),n!=null?n(v):v;for(var T=-1,O=v.length,D=e[m++],Z,W,Q=map(),ye,Be=x();++T<O;)(ye=Q.get(Z=D(W=v[T])+""))?ye.push(W):Q.set(Z,[W]);return Q.each(function(qe,rt){C(Be,rt,s(qe,m,x,C))}),Be}function f(v,m){if(++m>e.length)return v;var x,C=i[m-1];return n!=null&&m>=e.length?x=v.entries():(x=[],v.each(function(T,O){x.push({key:O,values:f(T,m)})})),C!=null?x.sort(function(T,O){return C(T.key,O.key)}):x}return a={object:function(v){return s(v,0,iT,aT)},map:function(v){return s(v,0,y_,__)},entries:function(v){return f(s(v,0,y_,__),0)},key:function(v){return e.push(v),a},sortKeys:function(v){return i[e.length-1]=v,a},sortValues:function(v){return r=v,a},rollup:function(v){return n=v,a}}}function iT(){return{}}function aT(e,i,r){e[i]=r}function y_(){return map()}function __(e,i,r){e.set(i,r)}function Wv(){}var Lh=W0.prototype;Wv.prototype=oT.prototype={constructor:Wv,has:Lh.has,add:function(e){return e+="",this[wc+e]=e,this},remove:Lh.remove,clear:Lh.clear,values:Lh.keys,size:Lh.size,empty:Lh.empty,each:Lh.each};function oT(e,i){var r=new Wv;if(e instanceof Wv)e.each(function(s){r.add(s)});else if(e){var n=-1,a=e.length;if(i==null)for(;++n<a;)r.add(e[n]);else for(;++n<a;)r.add(i(e[n],n,e))}return r}var JP=null,x_=Array.prototype,Xv=x_.map,kh=x_.slice;function th(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function eI(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var b_={name:"implicit"};function Yv(){var e=W0(),i=[],r=[],n=b_;function a(s){var f=s+"",v=e.get(f);if(!v){if(n!==b_)return n;e.set(f,v=i.push(s))}return r[(v-1)%r.length]}return a.domain=function(s){if(!arguments.length)return i.slice();i=[],e=W0();for(var f=-1,v=s.length,m,x;++f<v;)e.has(x=(m=s[f])+"")||e.set(x,i.push(m));return a},a.range=function(s){return arguments.length?(r=kh.call(s),a):r.slice()},a.unknown=function(s){return arguments.length?(n=s,a):n},a.copy=function(){return Yv(i,r).unknown(n)},th.apply(a,arguments),a}function E_(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],a,s,f=!1,v=0,m=0,x=.5;delete e.unknown;function C(){var T=i().length,O=n[1]<n[0],D=n[O-0],Z=n[1-O];a=(Z-D)/Math.max(1,T-v+m*2),f&&(a=Math.floor(a)),D+=(Z-D-a*(T-v))*x,s=a*(1-v),f&&(D=Math.round(D),s=Math.round(s));var W=sequence(T).map(function(Q){return D+a*Q});return r(O?W.reverse():W)}return e.domain=function(T){return arguments.length?(i(T),C()):i()},e.range=function(T){return arguments.length?(n=[+T[0],+T[1]],C()):n.slice()},e.rangeRound=function(T){return n=[+T[0],+T[1]],f=!0,C()},e.bandwidth=function(){return s},e.step=function(){return a},e.round=function(T){return arguments.length?(f=!!T,C()):f},e.padding=function(T){return arguments.length?(v=Math.min(1,m=+T),C()):v},e.paddingInner=function(T){return arguments.length?(v=Math.min(1,T),C()):v},e.paddingOuter=function(T){return arguments.length?(m=+T,C()):m},e.align=function(T){return arguments.length?(x=Math.max(0,Math.min(1,T)),C()):x},e.copy=function(){return E_(i(),n).round(f).paddingInner(v).paddingOuter(m).align(x)},initRange.apply(C(),arguments)}function S_(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return S_(i())},e}function tI(){return S_(E_.apply(null,arguments).paddingInner(1))}var sT=ee(26257),uT=ee(73626);function lT(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function cT(e){return function(){return e}}function X0(e){return+e}var C_=[0,1];function Tc(e){return e}function Y0(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:cT(isNaN(i)?NaN:.5)}function A_(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(a){return Math.max(i,Math.min(r,a))}}function fT(e,i,r){var n=e[0],a=e[1],s=i[0],f=i[1];return a<n?(n=Y0(a,n),s=r(f,s)):(n=Y0(n,a),s=r(s,f)),function(v){return s(n(v))}}function pT(e,i,r){var n=Math.min(e.length,i.length)-1,a=new Array(n),s=new Array(n),f=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++f<n;)a[f]=Y0(e[f],e[f+1]),s[f]=r(i[f],i[f+1]);return function(v){var m=Vv(e,v,1,n)-1;return s[m](a[m](v))}}function qv(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function q0(){var e=C_,i=C_,r=sT.Z,n,a,s,f=Tc,v,m,x;function C(){return v=Math.min(e.length,i.length)>2?pT:fT,m=x=null,T}function T(O){return isNaN(O=+O)?s:(m||(m=v(e.map(n),i,r)))(n(f(O)))}return T.invert=function(O){return f(a((x||(x=v(i,e.map(n),uT.Z)))(O)))},T.domain=function(O){return arguments.length?(e=Xv.call(O,X0),f===Tc||(f=A_(e)),C()):e.slice()},T.range=function(O){return arguments.length?(i=kh.call(O),C()):i.slice()},T.rangeRound=function(O){return i=kh.call(O),r=lT,C()},T.clamp=function(O){return arguments.length?(f=O?A_(e):Tc,T):f!==Tc},T.interpolate=function(O){return arguments.length?(r=O,C()):r},T.unknown=function(O){return arguments.length?(s=O,T):s},function(O,D){return n=O,a=D,C()}}function w_(e,i){return q0()(e,i)}var hT=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Kv(e){if(!(i=hT.exec(e)))throw new Error("invalid format: "+e);var i;return new K0({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}Kv.prototype=K0.prototype;function K0(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}K0.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function dT(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function $v(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function yd(e){return e=$v(Math.abs(e)),e?e[1]:NaN}function vT(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(yd(i)/3)))*3-yd(Math.abs(e)))}function mT(e,i){return function(r,n){for(var a=r.length,s=[],f=0,v=e[0],m=0;a>0&&v>0&&(m+v+1>n&&(v=Math.max(1,n-m)),s.push(r.substring(a-=v,a+v)),!((m+=v+1)>n));)v=e[f=(f+1)%e.length];return s.reverse().join(i)}}function gT(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function yT(e){e:for(var i=e.length,r=1,n=-1,a;r<i;++r)switch(e[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(a+1):e}var T_;function _T(e,i){var r=$v(e,i);if(!r)return e+"";var n=r[0],a=r[1],s=a-(T_=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,f=n.length;return s===f?n:s>f?n+new Array(s-f+1).join("0"):s>0?n.slice(0,s)+"."+n.slice(s):"0."+new Array(1-s).join("0")+$v(e,Math.max(0,i+s-1))[0]}function M_(e,i){var r=$v(e,i);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}var P_={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:dT,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return M_(e*100,i)},r:M_,s:_T,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function I_(e){return e}var O_=Array.prototype.map,R_=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function xT(e){var i=e.grouping===void 0||e.thousands===void 0?I_:mT(O_.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?I_:gT(O_.call(e.numerals,String)),f=e.percent===void 0?"%":e.percent+"",v=e.minus===void 0?"-":e.minus+"",m=e.nan===void 0?"NaN":e.nan+"";function x(T){T=Kv(T);var O=T.fill,D=T.align,Z=T.sign,W=T.symbol,Q=T.zero,ye=T.width,Be=T.comma,qe=T.precision,rt=T.trim,_t=T.type;_t==="n"?(Be=!0,_t="g"):P_[_t]||(qe===void 0&&(qe=12),rt=!0,_t="g"),(Q||O==="0"&&D==="=")&&(Q=!0,O="0",D="=");var mt=W==="$"?r:W==="#"&&/[boxX]/.test(_t)?"0"+_t.toLowerCase():"",Ht=W==="$"?n:/[%p]/.test(_t)?f:"",rr=P_[_t],Cr=/[defgprs%]/.test(_t);qe=qe===void 0?6:/[gprs]/.test(_t)?Math.max(1,Math.min(21,qe)):Math.max(0,Math.min(20,qe));function qr(gr){var sn=mt,Rn=Ht,Un,Ba,Mo;if(_t==="c")Rn=rr(gr)+Rn,gr="";else{gr=+gr;var Is=gr<0||1/gr<0;if(gr=isNaN(gr)?m:rr(Math.abs(gr),qe),rt&&(gr=yT(gr)),Is&&+gr==0&&Z!=="+"&&(Is=!1),sn=(Is?Z==="("?Z:v:Z==="-"||Z==="("?"":Z)+sn,Rn=(_t==="s"?R_[8+T_/3]:"")+Rn+(Is&&Z==="("?")":""),Cr){for(Un=-1,Ba=gr.length;++Un<Ba;)if(Mo=gr.charCodeAt(Un),48>Mo||Mo>57){Rn=(Mo===46?a+gr.slice(Un+1):gr.slice(Un))+Rn,gr=gr.slice(0,Un);break}}}Be&&!Q&&(gr=i(gr,Infinity));var iu=sn.length+gr.length+Rn.length,Ns=iu<ye?new Array(ye-iu+1).join(O):"";switch(Be&&Q&&(gr=i(Ns+gr,Ns.length?ye-Rn.length:Infinity),Ns=""),D){case"<":gr=sn+gr+Rn+Ns;break;case"=":gr=sn+Ns+gr+Rn;break;case"^":gr=Ns.slice(0,iu=Ns.length>>1)+sn+gr+Rn+Ns.slice(iu);break;default:gr=Ns+sn+gr+Rn;break}return s(gr)}return qr.toString=function(){return T+""},qr}function C(T,O){var D=x((T=Kv(T),T.type="f",T)),Z=Math.max(-8,Math.min(8,Math.floor(yd(O)/3)))*3,W=Math.pow(10,-Z),Q=R_[8+Z/3];return function(ye){return D(W*ye)+Q}}return{format:x,formatPrefix:C}}var Qv,$0,L_;bT({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function bT(e){return Qv=xT(e),$0=Qv.format,L_=Qv.formatPrefix,Qv}function ET(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,yd(i)-yd(e))+1}function ST(e){return Math.max(0,-yd(Math.abs(e)))}function CT(e,i,r,n){var a=H0(e,i,r),s;switch(n=Kv(n==null?",f":n),n.type){case"s":{var f=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(s=vT(a,f))&&(n.precision=s),L_(n,f)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(s=ET(a,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=s-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(s=ST(a))&&(n.precision=s-(n.type==="%")*2);break}}return $0(n)}function Jv(e){var i=e.domain;return e.ticks=function(r){var n=i();return m_(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var a=i();return CT(a[0],a[a.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),a=0,s=n.length-1,f=n[a],v=n[s],m;return v<f&&(m=f,f=v,v=m,m=a,a=s,s=m),m=Gv(f,v,r),m>0?(f=Math.floor(f/m)*m,v=Math.ceil(v/m)*m,m=Gv(f,v,r)):m<0&&(f=Math.ceil(f*m)/m,v=Math.floor(v*m)/m,m=Gv(f,v,r)),m>0?(n[a]=Math.floor(f/m)*m,n[s]=Math.ceil(v/m)*m,i(n)):m<0&&(n[a]=Math.ceil(f*m)/m,n[s]=Math.floor(v*m)/m,i(n)),e},e}function k_(){var e=w_(Tc,Tc);return e.copy=function(){return qv(e,k_())},th.apply(e,arguments),Jv(e)}function D_(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Xv.call(n,X0),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return D_(e).unknown(i)},e=arguments.length?Xv.call(e,X0):[0,1],Jv(r)}function F_(e,i){e=e.slice();var r=0,n=e.length-1,a=e[r],s=e[n],f;return s<a&&(f=r,r=n,n=f,f=a,a=s,s=f),e[r]=i.floor(a),e[n]=i.ceil(s),e}function B_(e){return Math.log(e)}function N_(e){return Math.exp(e)}function AT(e){return-Math.log(-e)}function wT(e){return-Math.exp(-e)}function TT(e){return isFinite(e)?+("1e"+e):e<0?0:e}function MT(e){return e===10?TT:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function PT(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function z_(e){return function(i){return-e(-i)}}function IT(e){var i=e(B_,N_),r=i.domain,n=10,a,s;function f(){return a=PT(n),s=MT(n),r()[0]<0?(a=z_(a),s=z_(s),e(AT,wT)):e(B_,N_),i}return i.base=function(v){return arguments.length?(n=+v,f()):n},i.domain=function(v){return arguments.length?(r(v),f()):r()},i.ticks=function(v){var m=r(),x=m[0],C=m[m.length-1],T;(T=C<x)&&(O=x,x=C,C=O);var O=a(x),D=a(C),Z,W,Q,ye=v==null?10:+v,Be=[];if(!(n%1)&&D-O<ye){if(O=Math.round(O)-1,D=Math.round(D)+1,x>0){for(;O<D;++O)for(W=1,Z=s(O);W<n;++W)if(Q=Z*W,!(Q<x)){if(Q>C)break;Be.push(Q)}}else for(;O<D;++O)for(W=n-1,Z=s(O);W>=1;--W)if(Q=Z*W,!(Q<x)){if(Q>C)break;Be.push(Q)}}else Be=m_(O,D,Math.min(D-O,ye)).map(s);return T?Be.reverse():Be},i.tickFormat=function(v,m){if(m==null&&(m=n===10?".0e":","),typeof m!="function"&&(m=$0(m)),v===Infinity)return m;v==null&&(v=10);var x=Math.max(1,n*v/i.ticks().length);return function(C){var T=C/s(Math.round(a(C)));return T*n<n-.5&&(T*=n),T<=x?m(C):""}},i.nice=function(){return r(F_(r(),{floor:function(v){return s(Math.floor(a(v)))},ceil:function(v){return s(Math.ceil(a(v)))}}))},i}function U_(){var e=IT(q0()).domain([1,10]);return e.copy=function(){return qv(e,U_()).base(e.base())},th.apply(e,arguments),e}function Z_(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function j_(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function OT(e){var i=1,r=e(Z_(i),j_(i));return r.constant=function(n){return arguments.length?e(Z_(i=+n),j_(i)):i},linearish(r)}function RT(){var e=OT(transformer());return e.copy=function(){return copy(e,RT()).constant(e.constant())},initRange.apply(e,arguments)}function V_(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function LT(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function kT(e){return e<0?-e*e:e*e}function DT(e){var i=e(Tc,Tc),r=1;function n(){return r===1?e(Tc,Tc):r===.5?e(LT,kT):e(V_(r),V_(1/r))}return i.exponent=function(a){return arguments.length?(r=+a,n()):r},Jv(i)}function Q0(){var e=DT(q0());return e.copy=function(){return qv(e,Q0()).exponent(e.exponent())},th.apply(e,arguments),e}function rI(){return Q0.apply(null,arguments).exponent(.5)}function G_(){var e=[],i=[],r=[],n;function a(){var f=0,v=Math.max(1,i.length);for(r=new Array(v-1);++f<v;)r[f-1]=nT(e,f/v);return s}function s(f){return isNaN(f=+f)?n:i[Vv(r,f)]}return s.invertExtent=function(f){var v=i.indexOf(f);return v<0?[NaN,NaN]:[v>0?r[v-1]:e[0],v<r.length?r[v]:e[e.length-1]]},s.domain=function(f){if(!arguments.length)return e.slice();e=[];for(var v=0,m=f.length,x;v<m;++v)x=f[v],x!=null&&!isNaN(x=+x)&&e.push(x);return e.sort(Z0),a()},s.range=function(f){return arguments.length?(i=kh.call(f),a()):i.slice()},s.unknown=function(f){return arguments.length?(n=f,s):n},s.quantiles=function(){return r.slice()},s.copy=function(){return G_().domain(e).range(i).unknown(n)},th.apply(s,arguments)}function H_(){var e=0,i=1,r=1,n=[.5],a=[0,1],s;function f(m){return m<=m?a[Vv(n,m,0,r)]:s}function v(){var m=-1;for(n=new Array(r);++m<r;)n[m]=((m+1)*i-(m-r)*e)/(r+1);return f}return f.domain=function(m){return arguments.length?(e=+m[0],i=+m[1],v()):[e,i]},f.range=function(m){return arguments.length?(r=(a=kh.call(m)).length-1,v()):a.slice()},f.invertExtent=function(m){var x=a.indexOf(m);return x<0?[NaN,NaN]:x<1?[e,n[0]]:x>=r?[n[r-1],i]:[n[x-1],n[x]]},f.unknown=function(m){return arguments.length&&(s=m),f},f.thresholds=function(){return n.slice()},f.copy=function(){return H_().domain([e,i]).range(a).unknown(s)},th.apply(Jv(f),arguments)}function W_(){var e=[.5],i=[0,1],r,n=1;function a(s){return s<=s?i[Vv(e,s,0,n)]:r}return a.domain=function(s){return arguments.length?(e=kh.call(s),n=Math.min(e.length,i.length-1),a):e.slice()},a.range=function(s){return arguments.length?(i=kh.call(s),n=Math.min(e.length,i.length-1),a):i.slice()},a.invertExtent=function(s){var f=i.indexOf(s);return[e[f-1],e[f]]},a.unknown=function(s){return arguments.length?(r=s,a):r},a.copy=function(){return W_().domain(e).range(i).unknown(r)},th.apply(a,arguments)}var J0=new Date,em=new Date;function hl(e,i,r,n){function a(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return a.floor=function(s){return e(s=new Date(+s)),s},a.ceil=function(s){return e(s=new Date(s-1)),i(s,1),e(s),s},a.round=function(s){var f=a(s),v=a.ceil(s);return s-f<v-s?f:v},a.offset=function(s,f){return i(s=new Date(+s),f==null?1:Math.floor(f)),s},a.range=function(s,f,v){var m=[],x;if(s=a.ceil(s),v=v==null?1:Math.floor(v),!(s<f)||!(v>0))return m;do m.push(x=new Date(+s)),i(s,v),e(s);while(x<s&&s<f);return m},a.filter=function(s){return hl(function(f){if(f>=f)for(;e(f),!s(f);)f.setTime(f-1)},function(f,v){if(f>=f)if(v<0)for(;++v<=0;)for(;i(f,-1),!s(f););else for(;--v>=0;)for(;i(f,1),!s(f););})},r&&(a.count=function(s,f){return J0.setTime(+s),em.setTime(+f),e(J0),e(em),Math.floor(r(J0,em))},a.every=function(s){return s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?a.filter(n?function(f){return n(f)%s==0}:function(f){return a.count(0,f)%s==0}):a}),a}var tm=hl(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});tm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:hl(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var _d=tm,nI=tm.range,X_=hl(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),FT=X_,iI=X_.range,e0=1e3,av=6e4,Y_=36e5,q_=864e5,K_=6048e5;function Dh(e){return hl(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*av)/K_})}var rm=Dh(0),t0=Dh(1),BT=Dh(2),NT=Dh(3),xd=Dh(4),zT=Dh(5),UT=Dh(6),aI=rm.range,oI=t0.range,sI=BT.range,uI=NT.range,lI=xd.range,cI=zT.range,fI=UT.range,$_=hl(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*av)/q_},function(e){return e.getDate()-1}),nm=$_,pI=$_.range,Q_=hl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*e0-e.getMinutes()*av)},function(e,i){e.setTime(+e+i*Y_)},function(e,i){return(i-e)/Y_},function(e){return e.getHours()}),ZT=Q_,hI=Q_.range,J_=hl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*e0)},function(e,i){e.setTime(+e+i*av)},function(e,i){return(i-e)/av},function(e){return e.getMinutes()}),jT=J_,dI=J_.range,e1=hl(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*e0)},function(e,i){return(i-e)/e0},function(e){return e.getUTCSeconds()}),VT=e1,vI=e1.range,r0=hl(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});r0.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?hl(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):r0};var GT=r0,mI=r0.range;function Fh(e){return hl(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/K_})}var t1=Fh(0),n0=Fh(1),HT=Fh(2),WT=Fh(3),bd=Fh(4),XT=Fh(5),YT=Fh(6),gI=t1.range,yI=n0.range,_I=HT.range,xI=WT.range,bI=bd.range,EI=XT.range,SI=YT.range,r1=hl(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/q_},function(e){return e.getUTCDate()-1}),n1=r1,CI=r1.range,im=hl(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});im.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:hl(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var ov=im,AI=im.range;function am(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function om(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function sv(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function qT(e){var i=e.dateTime,r=e.date,n=e.time,a=e.periods,s=e.days,f=e.shortDays,v=e.months,m=e.shortMonths,x=uv(a),C=lv(a),T=uv(s),O=lv(s),D=uv(f),Z=lv(f),W=uv(v),Q=lv(v),ye=uv(m),Be=lv(m),qe={a:Is,A:iu,b:Ns,B:Mc,c:null,d:l1,e:l1,f:yM,g:MM,G:IM,H:vM,I:mM,j:gM,L:c1,m:_M,M:xM,p:mm,q:m0,Q:m1,s:g1,S:bM,u:EM,U:SM,V:CM,w:AM,W:wM,x:null,X:null,y:TM,Y:PM,Z:OM,"%":v1},rt={a:dP,A:vP,b:mP,B:gP,c:null,d:p1,e:p1,f:DM,g:HM,G:XM,H:RM,I:LM,j:kM,L:h1,m:FM,M:BM,p:yP,q:_P,Q:m1,s:g1,S:NM,u:zM,U:UM,V:ZM,w:jM,W:VM,x:null,X:null,y:GM,Y:WM,Z:YM,"%":v1},_t={a:qr,A:gr,b:sn,B:Rn,c:Un,d:s1,e:s1,f:fM,g:o1,G:a1,H:u1,I:u1,j:sM,L:cM,m:oM,M:uM,p:Cr,q:aM,Q:hM,s:dM,S:lM,u:eM,U:tM,V:rM,w:JT,W:nM,x:Ba,X:Mo,y:o1,Y:a1,Z:iM,"%":pM};qe.x=mt(r,qe),qe.X=mt(n,qe),qe.c=mt(i,qe),rt.x=mt(r,rt),rt.X=mt(n,rt),rt.c=mt(i,rt);function mt(ii,Ia){return function(eo){var yn=[],Pl=-1,Go=0,rc=ii.length,nc,Nh,ib;for(eo instanceof Date||(eo=new Date(+eo));++Pl<rc;)ii.charCodeAt(Pl)===37&&(yn.push(ii.slice(Go,Pl)),(Nh=i1[nc=ii.charAt(++Pl)])!=null?nc=ii.charAt(++Pl):Nh=nc==="e"?" ":"0",(ib=Ia[nc])&&(nc=ib(eo,Nh)),yn.push(nc),Go=Pl+1);return yn.push(ii.slice(Go,Pl)),yn.join("")}}function Ht(ii,Ia){return function(eo){var yn=sv(1900,void 0,1),Pl=rr(yn,ii,eo+="",0),Go,rc;if(Pl!=eo.length)return null;if("Q"in yn)return new Date(yn.Q);if("s"in yn)return new Date(yn.s*1e3+("L"in yn?yn.L:0));if(Ia&&!("Z"in yn)&&(yn.Z=0),"p"in yn&&(yn.H=yn.H%12+yn.p*12),yn.m===void 0&&(yn.m="q"in yn?yn.q:0),"V"in yn){if(yn.V<1||yn.V>53)return null;"w"in yn||(yn.w=1),"Z"in yn?(Go=om(sv(yn.y,0,1)),rc=Go.getUTCDay(),Go=rc>4||rc===0?n0.ceil(Go):n0(Go),Go=n1.offset(Go,(yn.V-1)*7),yn.y=Go.getUTCFullYear(),yn.m=Go.getUTCMonth(),yn.d=Go.getUTCDate()+(yn.w+6)%7):(Go=am(sv(yn.y,0,1)),rc=Go.getDay(),Go=rc>4||rc===0?t0.ceil(Go):t0(Go),Go=nm.offset(Go,(yn.V-1)*7),yn.y=Go.getFullYear(),yn.m=Go.getMonth(),yn.d=Go.getDate()+(yn.w+6)%7)}else("W"in yn||"U"in yn)&&("w"in yn||(yn.w="u"in yn?yn.u%7:"W"in yn?1:0),rc="Z"in yn?om(sv(yn.y,0,1)).getUTCDay():am(sv(yn.y,0,1)).getDay(),yn.m=0,yn.d="W"in yn?(yn.w+6)%7+yn.W*7-(rc+5)%7:yn.w+yn.U*7-(rc+6)%7);return"Z"in yn?(yn.H+=yn.Z/100|0,yn.M+=yn.Z%100,om(yn)):am(yn)}}function rr(ii,Ia,eo,yn){for(var Pl=0,Go=Ia.length,rc=eo.length,nc,Nh;Pl<Go;){if(yn>=rc)return-1;if(nc=Ia.charCodeAt(Pl++),nc===37){if(nc=Ia.charAt(Pl++),Nh=_t[nc in i1?Ia.charAt(Pl++):nc],!Nh||(yn=Nh(ii,eo,yn))<0)return-1}else if(nc!=eo.charCodeAt(yn++))return-1}return yn}function Cr(ii,Ia,eo){var yn=x.exec(Ia.slice(eo));return yn?(ii.p=C[yn[0].toLowerCase()],eo+yn[0].length):-1}function qr(ii,Ia,eo){var yn=D.exec(Ia.slice(eo));return yn?(ii.w=Z[yn[0].toLowerCase()],eo+yn[0].length):-1}function gr(ii,Ia,eo){var yn=T.exec(Ia.slice(eo));return yn?(ii.w=O[yn[0].toLowerCase()],eo+yn[0].length):-1}function sn(ii,Ia,eo){var yn=ye.exec(Ia.slice(eo));return yn?(ii.m=Be[yn[0].toLowerCase()],eo+yn[0].length):-1}function Rn(ii,Ia,eo){var yn=W.exec(Ia.slice(eo));return yn?(ii.m=Q[yn[0].toLowerCase()],eo+yn[0].length):-1}function Un(ii,Ia,eo){return rr(ii,i,Ia,eo)}function Ba(ii,Ia,eo){return rr(ii,r,Ia,eo)}function Mo(ii,Ia,eo){return rr(ii,n,Ia,eo)}function Is(ii){return f[ii.getDay()]}function iu(ii){return s[ii.getDay()]}function Ns(ii){return m[ii.getMonth()]}function Mc(ii){return v[ii.getMonth()]}function mm(ii){return a[+(ii.getHours()>=12)]}function m0(ii){return 1+~~(ii.getMonth()/3)}function dP(ii){return f[ii.getUTCDay()]}function vP(ii){return s[ii.getUTCDay()]}function mP(ii){return m[ii.getUTCMonth()]}function gP(ii){return v[ii.getUTCMonth()]}function yP(ii){return a[+(ii.getUTCHours()>=12)]}function _P(ii){return 1+~~(ii.getUTCMonth()/3)}return{format:function(ii){var Ia=mt(ii+="",qe);return Ia.toString=function(){return ii},Ia},parse:function(ii){var Ia=Ht(ii+="",!1);return Ia.toString=function(){return ii},Ia},utcFormat:function(ii){var Ia=mt(ii+="",rt);return Ia.toString=function(){return ii},Ia},utcParse:function(ii){var Ia=Ht(ii+="",!0);return Ia.toString=function(){return ii},Ia}}}var i1={"-":"",_:" ","0":"0"},bu=/^\s*\d+/,KT=/^%/,$T=/[\\^$*+?|[\]().{}]/g;function Ja(e,i,r){var n=e<0?"-":"",a=(n?-e:e)+"",s=a.length;return n+(s<r?new Array(r-s+1).join(i)+a:a)}function QT(e){return e.replace($T,"\\$&")}function uv(e){return new RegExp("^(?:"+e.map(QT).join("|")+")","i")}function lv(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function JT(e,i,r){var n=bu.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function eM(e,i,r){var n=bu.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function tM(e,i,r){var n=bu.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function rM(e,i,r){var n=bu.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function nM(e,i,r){var n=bu.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function a1(e,i,r){var n=bu.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function o1(e,i,r){var n=bu.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function iM(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function aM(e,i,r){var n=bu.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function oM(e,i,r){var n=bu.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function s1(e,i,r){var n=bu.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function sM(e,i,r){var n=bu.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function u1(e,i,r){var n=bu.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function uM(e,i,r){var n=bu.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function lM(e,i,r){var n=bu.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function cM(e,i,r){var n=bu.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function fM(e,i,r){var n=bu.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function pM(e,i,r){var n=KT.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function hM(e,i,r){var n=bu.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function dM(e,i,r){var n=bu.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function l1(e,i){return Ja(e.getDate(),i,2)}function vM(e,i){return Ja(e.getHours(),i,2)}function mM(e,i){return Ja(e.getHours()%12||12,i,2)}function gM(e,i){return Ja(1+nm.count(_d(e),e),i,3)}function c1(e,i){return Ja(e.getMilliseconds(),i,3)}function yM(e,i){return c1(e,i)+"000"}function _M(e,i){return Ja(e.getMonth()+1,i,2)}function xM(e,i){return Ja(e.getMinutes(),i,2)}function bM(e,i){return Ja(e.getSeconds(),i,2)}function EM(e){var i=e.getDay();return i===0?7:i}function SM(e,i){return Ja(rm.count(_d(e)-1,e),i,2)}function f1(e){var i=e.getDay();return i>=4||i===0?xd(e):xd.ceil(e)}function CM(e,i){return e=f1(e),Ja(xd.count(_d(e),e)+(_d(e).getDay()===4),i,2)}function AM(e){return e.getDay()}function wM(e,i){return Ja(t0.count(_d(e)-1,e),i,2)}function TM(e,i){return Ja(e.getFullYear()%100,i,2)}function MM(e,i){return e=f1(e),Ja(e.getFullYear()%100,i,2)}function PM(e,i){return Ja(e.getFullYear()%1e4,i,4)}function IM(e,i){var r=e.getDay();return e=r>=4||r===0?xd(e):xd.ceil(e),Ja(e.getFullYear()%1e4,i,4)}function OM(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+Ja(i/60|0,"0",2)+Ja(i%60,"0",2)}function p1(e,i){return Ja(e.getUTCDate(),i,2)}function RM(e,i){return Ja(e.getUTCHours(),i,2)}function LM(e,i){return Ja(e.getUTCHours()%12||12,i,2)}function kM(e,i){return Ja(1+n1.count(ov(e),e),i,3)}function h1(e,i){return Ja(e.getUTCMilliseconds(),i,3)}function DM(e,i){return h1(e,i)+"000"}function FM(e,i){return Ja(e.getUTCMonth()+1,i,2)}function BM(e,i){return Ja(e.getUTCMinutes(),i,2)}function NM(e,i){return Ja(e.getUTCSeconds(),i,2)}function zM(e){var i=e.getUTCDay();return i===0?7:i}function UM(e,i){return Ja(t1.count(ov(e)-1,e),i,2)}function d1(e){var i=e.getUTCDay();return i>=4||i===0?bd(e):bd.ceil(e)}function ZM(e,i){return e=d1(e),Ja(bd.count(ov(e),e)+(ov(e).getUTCDay()===4),i,2)}function jM(e){return e.getUTCDay()}function VM(e,i){return Ja(n0.count(ov(e)-1,e),i,2)}function GM(e,i){return Ja(e.getUTCFullYear()%100,i,2)}function HM(e,i){return e=d1(e),Ja(e.getUTCFullYear()%100,i,2)}function WM(e,i){return Ja(e.getUTCFullYear()%1e4,i,4)}function XM(e,i){var r=e.getUTCDay();return e=r>=4||r===0?bd(e):bd.ceil(e),Ja(e.getUTCFullYear()%1e4,i,4)}function YM(){return"+0000"}function v1(){return"%"}function m1(e){return+e}function g1(e){return Math.floor(+e/1e3)}var Ed,y1,qM,KM,$M;QM({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function QM(e){return Ed=qT(e),y1=Ed.format,qM=Ed.parse,KM=Ed.utcFormat,$M=Ed.utcParse,Ed}var cv=1e3,fv=cv*60,pv=fv*60,hv=pv*24,JM=hv*7,_1=hv*30,sm=hv*365;function e5(e){return new Date(e)}function t5(e){return e instanceof Date?+e:+new Date(+e)}function x1(e,i,r,n,a,s,f,v,m){var x=w_(Tc,Tc),C=x.invert,T=x.domain,O=m(".%L"),D=m(":%S"),Z=m("%I:%M"),W=m("%I %p"),Q=m("%a %d"),ye=m("%b %d"),Be=m("%B"),qe=m("%Y"),rt=[[f,1,cv],[f,5,5*cv],[f,15,15*cv],[f,30,30*cv],[s,1,fv],[s,5,5*fv],[s,15,15*fv],[s,30,30*fv],[a,1,pv],[a,3,3*pv],[a,6,6*pv],[a,12,12*pv],[n,1,hv],[n,2,2*hv],[r,1,JM],[i,1,_1],[i,3,3*_1],[e,1,sm]];function _t(Ht){return(f(Ht)<Ht?O:s(Ht)<Ht?D:a(Ht)<Ht?Z:n(Ht)<Ht?W:i(Ht)<Ht?r(Ht)<Ht?Q:ye:e(Ht)<Ht?Be:qe)(Ht)}function mt(Ht,rr,Cr,qr){if(Ht==null&&(Ht=10),typeof Ht=="number"){var gr=Math.abs(Cr-rr)/Ht,sn=h_(function(Rn){return Rn[2]}).right(rt,gr);sn===rt.length?(qr=H0(rr/sm,Cr/sm,Ht),Ht=e):sn?(sn=rt[gr/rt[sn-1][2]<rt[sn][2]/gr?sn-1:sn],qr=sn[1],Ht=sn[0]):(qr=Math.max(H0(rr,Cr,Ht),1),Ht=v)}return qr==null?Ht:Ht.every(qr)}return x.invert=function(Ht){return new Date(C(Ht))},x.domain=function(Ht){return arguments.length?T(Xv.call(Ht,t5)):T().map(e5)},x.ticks=function(Ht,rr){var Cr=T(),qr=Cr[0],gr=Cr[Cr.length-1],sn=gr<qr,Rn;return sn&&(Rn=qr,qr=gr,gr=Rn),Rn=mt(Ht,qr,gr,rr),Rn=Rn?Rn.range(qr,gr+1):[],sn?Rn.reverse():Rn},x.tickFormat=function(Ht,rr){return rr==null?_t:m(rr)},x.nice=function(Ht,rr){var Cr=T();return(Ht=mt(Ht,Cr[0],Cr[Cr.length-1],rr))?T(F_(Cr,Ht)):x},x.copy=function(){return qv(x,x1(e,i,r,n,a,s,f,v,m))},x}function r5(){return th.apply(x1(_d,FT,rm,nm,ZT,jT,VT,GT,y1).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function wI(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function i0(){var e=0,i=1,r,n,a,s,f=identity,v=!1,m;function x(C){return isNaN(C=+C)?m:f(a===0?.5:(C=(s(C)-r)*a,v?Math.max(0,Math.min(1,C)):C))}return x.domain=function(C){return arguments.length?(r=s(e=+C[0]),n=s(i=+C[1]),a=r===n?0:1/(n-r),x):[e,i]},x.clamp=function(C){return arguments.length?(v=!!C,x):v},x.interpolator=function(C){return arguments.length?(f=C,x):f},x.unknown=function(C){return arguments.length?(m=C,x):m},function(C){return s=C,r=C(e),n=C(i),a=r===n?0:1/(n-r),x}}function a0(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function n5(){var e=linearish(i0()(identity));return e.copy=function(){return a0(e,n5())},initInterpolator.apply(e,arguments)}function i5(){var e=loggish(i0()).domain([1,10]);return e.copy=function(){return a0(e,i5()).base(e.base())},initInterpolator.apply(e,arguments)}function a5(){var e=symlogish(i0());return e.copy=function(){return a0(e,a5()).constant(e.constant())},initInterpolator.apply(e,arguments)}function b1(){var e=powish(i0());return e.copy=function(){return a0(e,b1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function TI(){return b1.apply(null,arguments).exponent(.5)}function o5(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var a=0,s=n.length,f;a<s;++a)f=n[a],f!=null&&!isNaN(f=+f)&&e.push(f);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return o5(i).domain(e)},initInterpolator.apply(r,arguments)}function o0(){var e=0,i=.5,r=1,n,a,s,f,v,m=identity,x,C=!1,T;function O(D){return isNaN(D=+D)?T:(D=.5+((D=+x(D))-a)*(D<a?f:v),m(C?Math.max(0,Math.min(1,D)):D))}return O.domain=function(D){return arguments.length?(n=x(e=+D[0]),a=x(i=+D[1]),s=x(r=+D[2]),f=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),O):[e,i,r]},O.clamp=function(D){return arguments.length?(C=!!D,O):C},O.interpolator=function(D){return arguments.length?(m=D,O):m},O.unknown=function(D){return arguments.length?(T=D,O):T},function(D){return x=D,n=D(e),a=D(i),s=D(r),f=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),O}}function s5(){var e=linearish(o0()(identity));return e.copy=function(){return copy(e,s5())},initInterpolator.apply(e,arguments)}function u5(){var e=loggish(o0()).domain([.1,1,10]);return e.copy=function(){return copy(e,u5()).base(e.base())},initInterpolator.apply(e,arguments)}function l5(){var e=symlogish(o0());return e.copy=function(){return copy(e,l5()).constant(e.constant())},initInterpolator.apply(e,arguments)}function E1(){var e=powish(o0());return e.copy=function(){return copy(e,E1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function MI(){return E1.apply(null,arguments).exponent(.5)}var Jc,S1,C1,A1,um,w1,c5=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,f5=(Jc={},(0,A.Z)(Jc,nu.LINEAR,k_),(0,A.Z)(Jc,nu.POWER,Q0),(0,A.Z)(Jc,nu.LOG,U_),(0,A.Z)(Jc,nu.IDENTITY,D_),(0,A.Z)(Jc,nu.TIME,r5),(0,A.Z)(Jc,nu.QUANTILE,G_),(0,A.Z)(Jc,nu.QUANTIZE,H_),(0,A.Z)(Jc,nu.THRESHOLD,W_),(0,A.Z)(Jc,nu.CAT,Yv),Jc),p5=(S1=(0,Nr.b2)(),C1=(0,Nr.f3)(zt.IGlobalConfigService),S1(A1=(um=function(){function e(){(0,st.Z)(this,e),ti(this,"configService",w1,this),(0,A.Z)(this,"scaleCache",{}),(0,A.Z)(this,"scaleOptions",{})}return(0,Ct.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var f=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;v.length!==0&&a.caculateScalesForAttributes(f||[],v)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var f=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;return a.caculateScalesForAttributes(f||[],v),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){a.scaleOptions=r.getScaleOptions();var f=s.getLayerStyleAttributes();if(f){var v=r.getSource().data.dataArray;if(v.length===0)return;var m=f.filter(function(x){return x.needRescale});m.length&&a.caculateScalesForAttributes(m,v)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var a=this;this.scaleCache={},r.forEach(function(s){if(s.scale){var f=s.scale,v=s.name;f.names=a.parseFields(s.scale.field||[]);var m=[];f.names.forEach(function(x){m.push(a.getOrCreateScale(x,s,n))}),m.some(function(x){return x.type===Yp.VARIABLE})?(f.type=Yp.VARIABLE,m.forEach(function(x){if(!f.callback){var C;if(f.values&&f.values!=="text"){var T;if(((T=x.option)===null||T===void 0?void 0:T.type)==="linear"&&f.values.length>2){var O=x.scale.ticks(f.values.length);v==="color"&&x.scale.domain(O)}x.scale.range(f.values)}else((C=x.option)===null||C===void 0?void 0:C.type)==="cat"&&x.scale.range(x.option.domain)}})):(f.type=Yp.CONSTANT,f.defaultValues=m.map(function(x,C){return x.scale(f.names[C])})),f.scalers=m.map(function(x){return{field:x.field,func:x.scale,option:x.option}}),s.needRescale=!1}})}},{key:"getOrCreateScale",value:function(r,n,a){var s,f=[r,n.name].join("_"),v=(s=n.scale)===null||s===void 0?void 0:s.values,m=this.createScale(r,n.name,v,a);return m}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:Uo()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,a,s){var f,v,m=this.scaleOptions[n]&&((f=this.scaleOptions[n])===null||f===void 0?void 0:f.field)===r?this.scaleOptions[n]:this.scaleOptions[r],x={field:r,scale:void 0,type:Yp.VARIABLE,option:m};if(!s||!s.length)return m&&m.type?x.scale=this.createDefaultScale(m):(x.scale=Yv([r]),x.type=Yp.CONSTANT),x;var C=(v=s.find(function(D){return!fl()(D[r])}))===null||v===void 0?void 0:v[r];if(this.isNumber(r)||fl()(C)&&!m)x.scale=Yv([r]),x.type=Yp.CONSTANT;else{var T=m&&m.type||this.getDefaultType(C);a==="text"&&(T=nu.CAT);var O=this.createDefaultScaleConfig(T,r,s);Object.assign(O,m),x.scale=this.createDefaultScale(O),x.option=O}return x}},{key:"getDefaultType",value:function(r){var n=nu.LINEAR;return typeof r=="string"&&(n=c5.test(r)?nu.TIME:nu.CAT),n}},{key:"createDefaultScaleConfig",value:function(r,n,a){var s={type:r},f=(a==null?void 0:a.map(function(v){return v[n]}))||[];return r!==nu.CAT&&r!==nu.QUANTILE?s.domain=tT(f):r===nu.CAT?s.domain=xc()(f):r===nu.QUANTILE&&(s.domain=f),s}},{key:"createDefaultScale",value:function(r){var n=r.type,a=r.domain,s=f5[n]();return a&&s.domain(a),s}}]),e}(),w1=ci(um.prototype,"configService",[C1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),um))||A1),T1,M1,P1,I1,s0,O1,R1;function L1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function h5(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?L1(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var d5=(T1=(0,Nr.b2)(),M1=(0,Nr.f3)(zt.ICameraService),P1=(0,Nr.f3)(zt.IRendererService),T1(I1=(s0=function(){function e(){(0,st.Z)(this,e),ti(this,"cameraService",O1,this),ti(this,"rendererService",R1,this)}return(0,Ct.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(n){n.addUniforms(h5({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),O1=ci(s0.prototype,"cameraService",[M1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R1=ci(s0.prototype,"rendererService",[P1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s0))||I1),k1,D1,v5=(k1=(0,Nr.b2)(),k1(D1=function(){function e(){(0,st.Z)(this,e)}return(0,Ct.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||D1),F1,B1,m5=(F1=(0,Nr.b2)(),F1(B1=function(){function e(){(0,st.Z)(this,e)}return(0,Ct.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var n=r.getLayerConfig(),a=n.autoFit,s=n.fitBoundsOptions;a&&setTimeout(function(){r.fitBounds(s)},100)})}}]),e}())||B1),N1,z1,g5=["type"];function U1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function dv(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?U1(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Z1={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},y5={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},_5={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},x5={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},PI=null;function b5(e){var i={u_DirectionalLights:new Array(3).fill(dv({},_5)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(dv({},x5)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[y5]),e.forEach(function(r,n){var a=r.type,s=a===void 0?"directional":a,f=(0,Kc.Z)(r,g5),v=Z1[s].lights,m=Z1[s].num,x=i[m];i[v][x]=dv(dv({},i[v][x]),f),i[m]++}),i}var E5=(N1=(0,Nr.b2)(),N1(z1=function(){function e(){(0,st.Z)(this,e)}return(0,Ct.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),a=n.enableLighting;a&&r.models.forEach(function(s){return s.addUniforms(dv({},b5()))})})}}]),e}())||z1),j1,V1,G1,lm,H1,S5=(j1=(0,Nr.b2)(),V1=(0,Nr.f3)(zt.IGlobalConfigService),j1(G1=(lm=function(){function e(){(0,st.Z)(this,e),ti(this,"configService",H1,this),(0,A.Z)(this,"enabled",void 0)}return(0,Ct.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.rendererService,f=n.postProcessingPassFactory,v=n.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var m=r.getLayerConfig(),x=m.enableMultiPassRenderer,C=m.passes,T=C===void 0?[]:C;a.enabled=!!x&&r.getLayerConfig().enableMultiPassRenderer!==!1,a.enabled&&(r.multiPassRenderer=jg(r,T,f,v),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(a.enabled){var m=s.getViewportSize(),x=m.width,C=m.height;r.multiPassRenderer.resize(x,C)}})}}]),e}(),H1=ci(lm.prototype,"configService",[V1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lm))||G1),W1,X1,u0={NONE:0,ENCODE:1,HIGHLIGHT:2},C5=(W1=(0,Nr.b2)(),W1(X1=function(){function e(){(0,st.Z)(this,e)}return(0,Ct.Z)(e,[{key:"apply",value:function(r,n){var a=n.rendererService,s=n.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var f=!0;s.registerStyleAttribute({name:"pickingColor",type:In.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:j.FLOAT},size:3,update:function(m,x){var C=m.id;return f?vu(C):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var f=r.getLayerConfig(),v=f.enablePicking;v&&r.isVisible()&&r.models.forEach(function(m){return m.addUniforms({u_PickingStage:u0.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var f=r.getLayerConfig(),v=f.enablePicking;v&&r.isVisible()&&r.models.forEach(function(m){return m.addUniforms({u_PickingStage:u0.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(f){var v=r.getLayerConfig(),m=v.highlightColor,x=v.activeMix,C=x===void 0?0:x,T=typeof m=="string"?Qi(m):m||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:bl(new Uint8Array(f))}),r.models.forEach(function(O){return O.addUniforms({u_PickingStage:u0.HIGHLIGHT,u_PickingColor:f,u_HighlightColor:T.map(function(D){return D*255}),u_activeMix:C})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(f){var v=r.getLayerConfig(),m=v.selectColor,x=v.selectMix,C=x===void 0?0:x,T=typeof m=="string"?Qi(m):m||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:bl(new Uint8Array(f))}),r.models.forEach(function(O){return O.addUniforms({u_PickingStage:u0.HIGHLIGHT,u_PickingColor:f,u_HighlightColor:T.map(function(D){return D*255}),u_activeMix:C,u_CurrentSelectedId:f,u_SelectColor:T.map(function(D){return D*255}),u_EnableSelect:1})})})}}]),e}())||X1),Y1,q1,A5=(Y1=(0,Nr.b2)(),Y1(q1=function(){function e(){(0,st.Z)(this,e)}return(0,Ct.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){a.registerBuiltinAttributes(s)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:In.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:j.FLOAT},size:3,update:function(a,s,f){return f.length===2?[f[0],f[1],0]:[f[0],f[1],f[2]]}}}),r.registerStyleAttribute({name:"filter",type:In.Attribute,descriptor:{name:"filter",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(a,s){var f=a.filter;return f?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:In.Attribute,descriptor:{name:"a_Color",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:4,update:function(a,s){var f=a.color;return!f||!f.length?[1,1,1,1]:f}}}),r.registerStyleAttribute({name:"vertexId",type:In.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:j.DYNAMIC_DRAW,data:[],type:j.FLOAT},size:1,update:function(a,s,f,v){return[s]}}})}}]),e}())||q1),K1,$1,Q1,J1,ex,tx,Sd,rx,nx,ix,ax,w5=(K1=(0,Nr.b2)(),$1=(0,Nr.f3)(zt.ICameraService),Q1=(0,Nr.f3)(zt.ICoordinateSystemService),J1=(0,Nr.f3)(zt.IRendererService),ex=(0,Nr.f3)(zt.IMapService),K1(tx=(Sd=function(){function e(){(0,st.Z)(this,e),ti(this,"cameraService",rx,this),ti(this,"coordinateSystemService",nx,this),ti(this,"rendererService",ix,this),ti(this,"mapService",ax,this)}return(0,Ct.Z)(e,[{key:"apply",value:function(r){var n=this,a=this.mapService.version,s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],f=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){n.coordinateSystemService.refresh(),a==="GAODE2.x"&&(s=n.mapService.map.customCoords.getMVPMatrix(),f=n.mapService.getCustomCoordCenter());var v=n.rendererService.getViewportSize(),m=v.width,x=v.height;r.models.forEach(function(C){var T;C.addUniforms((T={},(0,A.Z)(T,Th.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,A.Z)(T,Th.ViewMatrix,n.cameraService.getViewMatrix()),(0,A.Z)(T,Th.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,A.Z)(T,Th.Zoom,n.cameraService.getZoom()),(0,A.Z)(T,Th.ZoomScale,n.cameraService.getZoomScale()),(0,A.Z)(T,Th.FocalDistance,n.cameraService.getFocalDistance()),(0,A.Z)(T,Th.CameraPosition,n.cameraService.getCameraPosition()),(0,A.Z)(T,Vn.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,A.Z)(T,Vn.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,A.Z)(T,Vn.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,A.Z)(T,Vn.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,A.Z)(T,Vn.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,A.Z)(T,Vn.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,A.Z)(T,Vn.Mvp,s),(0,A.Z)(T,"u_SceneCenterMKT",f),(0,A.Z)(T,"u_ViewportSize",[m,x]),(0,A.Z)(T,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,A.Z)(T,"u_DevicePixelRatio",oa.devicePixelRatio),(0,A.Z)(T,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,A.Z)(T,"u_shaderPick",Number(r.getShaderPickStat())),T))})})}}]),e}(),rx=ci(Sd.prototype,"cameraService",[$1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nx=ci(Sd.prototype,"coordinateSystemService",[Q1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ix=ci(Sd.prototype,"rendererService",[J1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ax=ci(Sd.prototype,"mapService",[ex],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sd))||tx),ox,sx,T5=(ox=(0,Nr.b2)(),ox(sx=function(){function e(){(0,st.Z)(this,e)}return(0,Ct.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||sx),ux,lx,M5=(ux=(0,Nr.b2)(),ux(lx=function(){function e(){(0,st.Z)(this,e)}return(0,Ct.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){a.initStyleAttribute(r,{styleAttributeService:s})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||a.updateStyleAtrribute(r,{styleAttributeService:s})})}},{key:"updateStyleAtrribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[],f=a.getLayerStyleAttribute("filter"),v=a.getLayerStyleAttribute("shape");if(f&&f.needRegenerateVertices){r.layerModelNeedUpdate=!0,s.forEach(function(m){return m.needRegenerateVertices=!1});return}s.filter(function(m){return m.needRegenerateVertices}).forEach(function(m){a.updateAttributeByFeatureRange(m.name,r.getEncodedData(),m.featureRange.startIndex,m.featureRange.endIndex),m.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[];s.filter(function(f){return f.needRegenerateVertices}).forEach(function(f){a.updateAttributeByFeatureRange(f.name,r.getEncodedData(),f.featureRange.startIndex,f.featureRange.endIndex),f.needRegenerateVertices=!1})}}]),e}())||lx);tc.bind(zt.ILayerPlugin).to(Qw).inRequestScope(),tc.bind(zt.ILayerPlugin).to(A5).inRequestScope(),tc.bind(zt.ILayerPlugin).to(p5).inRequestScope(),tc.bind(zt.ILayerPlugin).to($w).inRequestScope(),tc.bind(zt.ILayerPlugin).to(m5).inRequestScope(),tc.bind(zt.ILayerPlugin).to(M5).inRequestScope(),tc.bind(zt.ILayerPlugin).to(T5).inRequestScope(),tc.bind(zt.ILayerPlugin).to(S5).inRequestScope(),tc.bind(zt.ILayerPlugin).to(w5).inRequestScope(),tc.bind(zt.ILayerPlugin).to(d5).inRequestScope(),tc.bind(zt.ILayerPlugin).to(E5).inRequestScope(),tc.bind(zt.ILayerPlugin).to(C5).inRequestScope(),tc.bind(zt.ILayerPlugin).to(v5).inRequestScope();var II="2.8.36";function cx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function OI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?cx(Object(r),!0).forEach(function(n){P5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function P5(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function RI(e,i){return L5(e)||R5(e,i)||O5(e,i)||I5()}function I5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function O5(e,i){if(!!e){if(typeof e=="string")return fx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return fx(e,i)}}function fx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function R5(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function L5(e){if(Array.isArray(e))return e}var LI=null,kI=null,px,cm,hx;function dx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function vx(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?dx(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var k5=(px=L0(zt.IGlobalConfigService),cm=function(){function e(i){(0,st.Z)(this,e),ti(this,"configService",hx,this),(0,A.Z)(this,"config",void 0),this.config=i}return(0,Ct.Z)(e,[{key:"setContainer",value:function(r,n,a,s){r.bind(zt.MapConfig).toConstantValue(vx(vx({},this.config),{},{id:n,canvas:a,hasBaseMap:s})),r.bind(zt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),hx=ci(cm.prototype,"configService",[px],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cm),D5=ee(6158),vv=ee.n(D5);function mv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function l0(e,i){var r=G([],i,e);return Of(r,r,1/r[3]),r}function DI(e,i){var r=e%i;return r<0?i+r:r}function FI(e,i,r){return r*i+(1-r)*e}function Bh(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var ef=Math.PI,mx=ef/4,Ep=ef/180,gx=180/ef,fm=512,pm=4003e4,F5=1.5;function yx(e){return Math.pow(2,e)}function B5(e){return Math.log2(e)}function c0(e,i){var r=(0,nn.Z)(e,2),n=r[0],a=r[1];Bh(Number.isFinite(n)&&Number.isFinite(i)),Bh(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude"),i*=fm;var s=n*Ep,f=a*Ep,v=i*(s+ef)/(2*ef),m=i*(ef-Math.log(Math.tan(mx+f*.5)))/(2*ef);return[v,m]}function hm(e,i){var r=(0,nn.Z)(e,2),n=r[0],a=r[1];i*=fm;var s=n/i*(2*ef)-ef,f=2*(Math.atan(Math.exp(ef-a/i*(2*ef)))-mx);return[s*gx,f*gx]}function BI(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*Ep);return B5(pm*r)-9}function _x(e){var i=e.latitude,r=e.longitude,n=e.zoom,a=e.scale,s=e.highPrecision,f=s===void 0?!1:s;a=a!==void 0?a:yx(n),Bh(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(a));var v={},m=fm*a,x=Math.cos(i*Ep),C=m/360,T=C/x,O=m/pm/x;if(v.pixelsPerMeter=[O,-O,O],v.metersPerPixel=[1/O,-1/O,1/O],v.pixelsPerDegree=[C,-T,O],v.degreesPerPixel=[1/C,-1/T,1/O],f){var D=Ep*Math.tan(i*Ep)/x,Z=C*D/2,W=m/pm*D,Q=W/T*O;v.pixelsPerDegree2=[0,-Z,W],v.pixelsPerMeter2=[Q,0,Q]}return v}function NI(e,i){var r=_slicedToArray(e,3),n=r[0],a=r[1],s=r[2],f=_slicedToArray(i,3),v=f[0],m=f[1],x=f[2],C=1,T=_x({longitude:n,latitude:a,scale:C,highPrecision:!0}),O=T.pixelsPerMeter,D=T.pixelsPerMeter2,Z=c0(e,C);Z[0]+=v*(O[0]+D[0]*m),Z[1]+=m*(O[1]+D[1]*m);var W=hm(Z,C),Q=(s||0)+(x||0);return Number.isFinite(s)||Number.isFinite(x)?[W[0],W[1],Q]:W}function N5(e){var i=e.height,r=e.pitch,n=e.bearing,a=e.altitude,s=e.center,f=s===void 0?null:s,v=e.flipY,m=v===void 0?!1:v,x=mv();return Hr(x,x,[0,0,-a]),si(x,x,[1,1,1/i]),Vr(x,x,-r*Ep),Yn(x,x,n*Ep),m&&si(x,x,[1,-1,1]),f&&Hr(x,x,Xa.negate([],f)),x}function z5(e){var i=e.width,r=e.height,n=e.altitude,a=n===void 0?F5:n,s=e.pitch,f=s===void 0?0:s,v=e.nearZMultiplier,m=v===void 0?1:v,x=e.farZMultiplier,C=x===void 0?1:x,T=f*Ep,O=Math.atan(.5/a),D=Math.sin(O)*a/Math.sin(Math.PI/2-T-O),Z=Math.cos(Math.PI/2-T)*D+a;return{fov:2*Math.atan(r/2/a),aspect:i/r,focalDistance:a,near:m,far:Z*C}}function U5(e){var i=e.width,r=e.height,n=e.pitch,a=e.altitude,s=e.nearZMultiplier,f=e.farZMultiplier,v=z5({width:i,height:r,altitude:a,pitch:n,nearZMultiplier:s,farZMultiplier:f}),m=v.fov,x=v.aspect,C=v.near,T=v.far,O=Ko([],m,x,C,T);return O}function Z5(e,i){var r=(0,nn.Z)(e,3),n=r[0],a=r[1],s=r[2],f=s===void 0?0:s;return Bh(Number.isFinite(n)&&Number.isFinite(a)&&Number.isFinite(f)),l0(i,[n,a,f,1])}function xx(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,nn.Z)(e,3),a=n[0],s=n[1],f=n[2];if(Bh(Number.isFinite(a)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(f)){var v=l0(i,[a,s,f,1]);return v}var m=l0(i,[a,s,0,1]),x=l0(i,[a,s,1,1]),C=m[2],T=x[2],O=C===T?0:((r||0)-C)/(T-C);return bi.lerp([],m,x,O)}var bx=mv(),j5=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,a=i.viewMatrix,s=a===void 0?bx:a,f=i.projectionMatrix,v=f===void 0?bx:f;(0,st.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=s,this.projectionMatrix=v;var m=mv();Fr(m,m,this.projectionMatrix),Fr(m,m,this.viewMatrix),this.viewProjectionMatrix=m;var x=mv();si(x,x,[this.width/2,-this.height/2,1]),Hr(x,x,[1,-1,0]),Fr(x,x,this.viewProjectionMatrix);var C=dn(mv(),x);if(!C)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=x,this.pixelUnprojectionMatrix=C,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Ct.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&Tt(r.projectionMatrix,this.projectionMatrix)&&Tt(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,f=this.projectPosition(r),v=Z5(f,this.pixelProjectionMatrix),m=(0,nn.Z)(v,2),x=m[0],C=m[1],T=s?C:this.height-C;return r.length===2?[x,T]:[x,T,v[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,f=n.targetZ,v=(0,nn.Z)(r,3),m=v[0],x=v[1],C=v[2],T=s?x:this.height-x,O=f&&f*this.pixelsPerMeter,D=xx([m,T,C],this.pixelUnprojectionMatrix,O),Z=this.unprojectPosition(D),W=(0,nn.Z)(Z,3),Q=W[0],ye=W[1],Be=W[2];return Number.isFinite(C)?[Q,ye,Be]:Number.isFinite(f)?[Q,ye,f]:[Q,ye]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),a=(0,nn.Z)(n,2),s=a[0],f=a[1],v=(r[2]||0)*this.pixelsPerMeter;return[s,f,v]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),a=(0,nn.Z)(n,2),s=a[0],f=a[1],v=(r[2]||0)/this.pixelsPerMeter;return[s,f,v]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function V5(e){var i=e.width,r=e.height,n=e.bounds,a=e.minExtent,s=a===void 0?0:a,f=e.maxZoom,v=f===void 0?24:f,m=e.padding,x=m===void 0?0:m,C=e.offset,T=C===void 0?[0,0]:C,O=(0,nn.Z)(n,2),D=(0,nn.Z)(O[0],2),Z=D[0],W=D[1],Q=(0,nn.Z)(O[1],2),ye=Q[0],Be=Q[1];if(Number.isFinite(x)){var qe=x;x={top:qe,bottom:qe,left:qe,right:qe}}else Bh(Number.isFinite(x.top)&&Number.isFinite(x.bottom)&&Number.isFinite(x.left)&&Number.isFinite(x.right));var rt=new Ex({width:i,height:r,longitude:0,latitude:0,zoom:0}),_t=rt.project([Z,Be]),mt=rt.project([ye,W]),Ht=[Math.max(Math.abs(mt[0]-_t[0]),s),Math.max(Math.abs(mt[1]-_t[1]),s)],rr=[i-x.left-x.right-Math.abs(T[0])*2,r-x.top-x.bottom-Math.abs(T[1])*2];Bh(rr[0]>0&&rr[1]>0);var Cr=rr[0]/Ht[0],qr=rr[1]/Ht[1],gr=(x.right-x.left)/2/Cr,sn=(x.bottom-x.top)/2/qr,Rn=[(mt[0]+_t[0])/2+gr,(mt[1]+_t[1])/2+sn],Un=rt.unproject(Rn),Ba=rt.zoom+Math.log2(Math.abs(Math.min(Cr,qr)));return{longitude:Un[0],latitude:Un[1],zoom:Math.min(Ba,v)}}var Ex=function(e){(0,wr.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=n.width,s=n.height,f=n.latitude,v=f===void 0?0:f,m=n.longitude,x=m===void 0?0:m,C=n.zoom,T=C===void 0?0:C,O=n.pitch,D=O===void 0?0:O,Z=n.bearing,W=Z===void 0?0:Z,Q=n.altitude,ye=Q===void 0?1.5:Q,Be=n.nearZMultiplier,qe=n.farZMultiplier;(0,st.Z)(this,i),a=a||1,s=s||1;var rt=yx(T);ye=Math.max(.75,ye);var _t=c0([x,v],rt);_t[2]=0;var mt=U5({width:a,height:s,pitch:D,bearing:W,altitude:ye,nearZMultiplier:Be||1/s,farZMultiplier:qe||1.01}),Ht=N5({height:s,center:_t,pitch:D,bearing:W,altitude:ye,flipY:!0});return r=(0,an.Z)(this,(0,pt.Z)(i).call(this,{width:a,height:s,viewMatrix:Ht,projectionMatrix:mt})),r.latitude=v,r.longitude=x,r.zoom=T,r.pitch=D,r.bearing=W,r.altitude=ye,r.scale=rt,r.center=_t,r.pixelsPerMeter=_x((0,ae.Z)((0,ae.Z)(r))).pixelsPerMeter[2],Object.freeze((0,ae.Z)((0,ae.Z)(r))),r}return(0,Ct.Z)(i,[{key:"projectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return c0(n,a)}},{key:"unprojectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return hm(n,a)}},{key:"getMapCenterByLngLatPosition",value:function(n){var a=n.lngLat,s=n.pos,f=xx(s,this.pixelUnprojectionMatrix),v=c0(a,this.scale),m=bi.add([],v,bi.negate([],f)),x=bi.add([],this.center,m);return hm(x,this.scale)}},{key:"getLocationAtPoint",value:function(n){var a=n.lngLat,s=n.pos;return this.getMapCenterByLngLatPosition({lngLat:a,pos:s})}},{key:"fitBounds",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.width,f=this.height,v=V5(Object.assign({width:s,height:f,bounds:n},a)),m=v.longitude,x=v.latitude,C=v.zoom;return new i({width:s,height:f,longitude:m,latitude:x,zoom:C})}}]),i}(j5),G5=function(){function e(){(0,st.Z)(this,e),(0,A.Z)(this,"viewport",void 0)}return(0,Ct.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,a=r.zoom,s=r.pitch,f=r.bearing,v=r.viewportHeight,m=r.viewportWidth;this.viewport=new Ex({width:m,height:v,longitude:n&&n[0],latitude:n&&n[1],zoom:a,pitch:s,bearing:f})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),H5=function(){function e(i){(0,st.Z)(this,e),(0,A.Z)(this,"size",1e4),this.size=i||1e4}return(0,Ct.Z)(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),a=this.mercatorYfromLat(r[1]);return[n,a]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),a=this.latFromMercatorY(r[1]);return[n,a]}}]),e}(),Sx={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},W5=["id","attributionControl","style","token","rotation","mapInstance"],Cx,Ax,Tx,Mx,Px,Ix,Cd,Ox,Rx,Lx,kx;function Dx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function X5(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Dx(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Dx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Y5(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var f=i.createElement("style");return f.type="text/css",f.styleSheet?f.styleSheet.cssText=e:f.appendChild(i.createTextNode(e)),a.appendChild(f),f}}Y5(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=vv();var Fx={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},q5=0,K5=12,Bx="pk.eyJ1IjoiMTg5Njk5NDg2MTkiLCJhIjoiY2s5OXVzdHlzMDVneDNscDVjdzVmeXl0dyJ9.81SQ5qaJS0xExYLbDZAGpQ",$5=(Cx=(0,Nr.b2)(),Ax=(0,Nr.f3)(zt.MapConfig),Tx=(0,Nr.f3)(zt.IGlobalConfigService),Mx=(0,Nr.f3)(zt.ICoordinateSystemService),Px=(0,Nr.f3)(zt.IEventEmitter),Cx(Ix=(Cd=function(){function e(){var i=this;(0,st.Z)(this,e),(0,A.Z)(this,"version",Bs.MAPBOX),(0,A.Z)(this,"map",void 0),(0,A.Z)(this,"simpleMapCoord",new H5),(0,A.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),ti(this,"config",Ox,this),ti(this,"configService",Rx,this),ti(this,"coordinateSystemService",Lx,this),ti(this,"eventEmitter",kx,this),(0,A.Z)(this,"viewport",void 0),(0,A.Z)(this,"markerContainer",void 0),(0,A.Z)(this,"cameraChangedCallback",void 0),(0,A.Z)(this,"$mapContainer",void 0),(0,A.Z)(this,"handleCameraChanged",function(){var r=i.map.getCenter().wrap(),n=r.lat,a=r.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[a,n],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0});var s=i.config.offsetZoom,f=s===void 0?K5:s;i.viewport.getZoom()>f?i.coordinateSystemService.setCoordinateSystem(hi.LNGLAT_OFFSET):i.coordinateSystemService.setCoordinateSystem(hi.LNGLAT),i.cameraChangedCallback(i.viewport)})}return(0,Ct.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=Za("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,n){L2.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(Fx[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(Fx[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r,n){this.panTo([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToCoord",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},a=this.lngLatToMercator(r,0),s=a.x,f=a.y;return[s-n.x,f-n.y]}},{key:"lngLatToMercator",value:function(r,n){var a=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),s=a.x,f=s===void 0?0:s,v=a.y,m=v===void 0?0:v,x=a.z,C=x===void 0?0:x;return{x:f,y:m,z:C}}},{key:"getModelMatrix",value:function(r,n,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],f=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),m=v.meterInMercatorCoordinateUnits(),x=Pr();return Hr(x,x,Xa.fromValues(v.x-f.x,v.y-f.y,v.z||0-f.z)),si(x,x,Xa.fromValues(m*s[0],-m*s[1],m*s[2])),Vr(x,x,a[0]),Jr(x,x,a[1]),Yn(x,x,a[2]),x}},{key:"init",value:function(){var i=(0,d.Z)(w().mark(function n(){var a,s,f,v,m,x,C,T,O,D,Z,W,Q;return w().wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:a=this.config,s=a.id,f=s===void 0?"map":s,v=a.attributionControl,m=v===void 0?!1:v,x=a.style,C=x===void 0?"light":x,T=a.token,O=T===void 0?Bx:T,D=a.rotation,Z=D===void 0?0:D,W=a.mapInstance,Q=(0,Kc.Z)(a,W5),this.viewport=new G5,!W&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),O===Bx&&C!=="blank"&&!window.mapboxgl.accessToken&&!W&&console.warn(this.configService.getSceneWarninfo("MapToken")),!W&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=O),W?(this.map=W,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(f),this.map=new window.mapboxgl.Map(X5({container:this.$mapContainer,style:this.getMapStyle(C),attributionControl:m,bearing:Z},Q))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Be.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,n;(r=this.$mapContainer)===null||r===void 0||(n=r.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),f=1;f<a;f++)s[f-1]=arguments[f];(n=this.eventEmitter).emit.apply(n,[r].concat(s))}},{key:"once",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),f=1;f<a;f++)s[f-1]=arguments[f];(n=this.eventEmitter).once.apply(n,[r].concat(s))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(r,n){var a=new(vv()).LngLat(r[0],r[1]),s=new(vv()).LngLat(n[0],n[1]),f=a.distanceTo(s),v=vv().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),m=vv().MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),x=v.x,C=v.y,T=m.x,O=m.y,D=Math.sqrt(Math.pow(x-T,2)+Math.pow(C-O,2))*4194304*2;return D/f}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),a=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return a}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var n=r;typeof r=="string"&&(n=document.getElementById(r));var a=document.createElement("div");return a.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,a.id="l7_mapbox_div"+q5++,n.appendChild(a),a}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:Sx[r]?Sx[r]:r}}]),e}(),Ox=ci(Cd.prototype,"config",[Ax],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rx=ci(Cd.prototype,"configService",[Tx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lx=ci(Cd.prototype,"coordinateSystemService",[Mx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kx=ci(Cd.prototype,"eventEmitter",[Px],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cd))||Ix);function Q5(e){var i=J5();return function(){var n=(0,pt.Z)(e),a;if(i){var s=(0,pt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,an.Z)(this,a)}}function J5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function e3(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var f=i.createElement("style");return f.type="text/css",f.styleSheet?f.styleSheet.cssText=e:f.appendChild(i.createTextNode(e)),a.appendChild(f),f}}e3(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var t3=function(e){(0,wr.Z)(r,e);var i=Q5(r);function r(){return(0,st.Z)(this,r),i.apply(this,arguments)}return(0,Ct.Z)(r,[{key:"getServiceConstructor",value:function(){return $5}}]),r}(k5);function Nx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function zx(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Nx(Object(r),!0).forEach(function(n){r3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Nx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function r3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function n3(e,i){return s3(e)||o3(e,i)||a3(e,i)||i3()}function i3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function a3(e,i){if(!!e){if(typeof e=="string")return Ux(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ux(e,i)}}function Ux(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function o3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function s3(e){if(Array.isArray(e))return e}var u3=_e.memo(function(e){var i=e.style,r=e.className,n=e.map,a=e.option,s=e.onSceneLoaded,f=(0,_e.createRef)(),v=(0,_e.useState)(),m=n3(v,2),x=m[0],C=m[1];return(0,_e.useEffect)(function(){var T=new cS(zx(zx({id:f.current},a),{},{map:new t3(n)}));return T.on("loaded",function(){C(T),s&&s(T)}),function(){T.destroy()}},[]),(0,_e.useEffect)(function(){x&&n.style&&x.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,_e.useEffect)(function(){x&&n.zoom&&x.setZoom(n.zoom)},[n.zoom]),(0,_e.useEffect)(function(){x&&n.center&&x.setCenter(n.center)},[JSON.stringify(n.center)]),(0,_e.useEffect)(function(){x&&n.pitch!==void 0&&x.setPitch(n.pitch||0)},[n.pitch]),(0,_e.useEffect)(function(){x&&n.rotation&&x.setRotation(n.rotation)},[n.rotation]),_e.createElement(g.Provider,{value:x},(0,_e.createElement)("div",{ref:f,style:i,className:r},x&&e.children))}),l3=u3;function Zx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function zI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Zx(Object(r),!0).forEach(function(n){c3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function c3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function UI(e,i){return d3(e)||h3(e,i)||p3(e,i)||f3()}function f3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function p3(e,i){if(!!e){if(typeof e=="string")return jx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jx(e,i)}}function jx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function h3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function d3(e){if(Array.isArray(e))return e}var ZI=null,jI=null;function Vx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function VI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Vx(Object(r),!0).forEach(function(n){v3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Vx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function v3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function GI(e,i){return _3(e)||y3(e,i)||g3(e,i)||m3()}function m3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function g3(e,i){if(!!e){if(typeof e=="string")return Gx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Gx(e,i)}}function Gx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function y3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function _3(e){if(Array.isArray(e))return e}var HI=null,WI=null;function XI(e,i){return S3(e)||E3(e,i)||b3(e,i)||x3()}function x3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function b3(e,i){if(!!e){if(typeof e=="string")return Hx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Hx(e,i)}}function Hx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function E3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function S3(e){if(Array.isArray(e))return e}var YI=null,qI=null;function Wx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function KI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Wx(Object(r),!0).forEach(function(n){C3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function C3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function $I(e,i){if(e==null)return{};var r=A3(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function A3(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var QI=null,Xx=ee(73935);function Yx(e,i){return P3(e)||M3(e,i)||T3(e,i)||w3()}function w3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function T3(e,i){if(!!e){if(typeof e=="string")return qx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return qx(e,i)}}function qx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function M3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function P3(e){if(Array.isArray(e))return e}var Kx=_e.useEffect,$x=_e.useState,I3=/\B([A-Z])/g,O3=function(i){return i.replace(I3,"-$1").toLowerCase()};function JI(e){var i=e.className,r=e.style,n=e.children,a=e.position,s=$x(),f=Yx(s,2),v=f[0],m=f[1],x=useSceneValue(),C=$x(function(){return document.createElement("div")}),T=Yx(C,1),O=T[0];return Kx(function(){var D=new Control({position:a});return D.onAdd=function(){if(i&&(O.className=i),r){var Z=Object.keys(r).map(function(W){return"".concat(O3(W),":").concat(r[W])}).join(";");O.style.cssText=Z}return O},D.onRemove=function(){},m(D),x.addControl(D),function(){x.removeControl(D)}},[]),Kx(function(){v&&v.setPosition(a||"bottomleft")},[a]),createPortal(n,O)}var Qx=(0,_e.createContext)({});function eO(){return useContext(Qx)}var Zf=ee(96486),tO=_e.useEffect,R3=_e.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},Zf.isEqual),rO=_e.useEffect,L3=_e.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},Zf.isEqual),nO=_e.useEffect,k3=_e.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},Zf.isEqual),D3=_e.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},Zf.isEqual),F3=_e.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},Zf.isEqual),iO=_e.useEffect,B3=_e.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},Zf.isEqual),N3=_e.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},Zf.isEqual),z3=_e.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},Zf.isEqual),U3=["data"];function Z3(e,i){if(e==null)return{};var r=j3(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function j3(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var V3=_e.memo(function(i){var r=i.layer,n=i.source,a=n.data,s=Z3(n,U3);return r.inited?r.setData(a,s):r.source(a,s),s.autoFit&&r.fitBounds(s&&s.fitBoundsOptions),null},Zf.isEqual),aO=_e.useEffect,G3=_e.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},Zf.isEqual);function H3(e,i){return q3(e)||Y3(e,i)||X3(e,i)||W3()}function W3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function X3(e,i){if(!!e){if(typeof e=="string")return Jx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Jx(e,i)}}function Jx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Y3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,f,v;try{for(r=r.call(e);!(a=(f=r.next()).done)&&(n.push(f.value),!(i&&n.length===i));a=!0);}catch(m){s=!0,v=m}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function q3(e){if(Array.isArray(e))return e}var gv=_e.useEffect,K3=_e.useState;function eb(e,i){var r=i.source,n=i.color,a=i.shape,s=i.style,f=i.size,v=i.scale,m=i.active,x=i.select,C=i.filter,T=i.animate,O=i.options,D=i.onLayerLoaded,Z=Re(),W=K3(function(){var Be;switch(e){case"polygonLayer":Be=new e_(O);break;case"lineLayer":Be=new Ly(O);break;case"pointLayer":Be=new Jy(O);break;case"heatmapLayer":Be=new XS(O);break;case"rasterLayer":Be=new qw(O);break;case"imageLayer":Be=new Py(O);break;case"citybuildingLayer":Be=new yS(O);break;default:Be=new e_(O)}return Be.on("inited",function(){D&&D(Be,Z)}),Be}),Q=H3(W,1),ye=Q[0];return gv(function(){return Z.addLayer(ye),function(){Z.removeLayer(ye)}},[]),gv(function(){ye.inited&&O&&ye.updateLayerConfig(O)},[O==null?void 0:O.minZoom,O==null?void 0:O.maxZoom,O==null?void 0:O.visible]),gv(function(){ye.inited&&(O==null?void 0:O.zIndex)&&ye.setIndex(O.zIndex)},[O==null?void 0:O.zIndex]),gv(function(){ye.inited&&(O==null?void 0:O.blend)&&ye.setBlend(O.blend)},[O==null?void 0:O.blend]),gv(function(){Z.render()}),_e.createElement(Qx.Provider,{value:ye},_e.createElement(V3,{layer:ye,source:r}),v&&_e.createElement(F3,{layer:ye,scale:v}),n&&_e.createElement(k3,{layer:ye,color:n}),f&&_e.createElement(z3,{layer:ye,size:f}),a&&_e.createElement(N3,{layer:ye,shape:a}),s&&_e.createElement(G3,{layer:ye,style:s}),m&&_e.createElement(R3,{layer:ye,active:m}),x&&_e.createElement(B3,{layer:ye,select:x}),C&&_e.createElement(D3,{layer:ye,filter:C}),T&&_e.createElement(L3,{layer:ye,animate:T}),i.children)}var oO=null,sO=null,$3=_e.memo(function(i){return eb("pointLayer",i)}),Q3=_e.memo(function(i){return eb("heatmapLayer",i)}),uO=null,lO=null,cO=null,fO=_e.useEffect,pO=null,hO=null;function f0(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?f0=function(r){return typeof r}:f0=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},f0(e)}function tb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function p0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?tb(Object(r),!0).forEach(function(n){J3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function J3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function eP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function rb(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function tP(e,i,r){return i&&rb(e.prototype,i),r&&rb(e,r),e}function rP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&dm(e,i)}function dm(e,i){return dm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},dm(e,i)}function nP(e){var i=oP();return function(){var n=h0(e),a;if(i){var s=h0(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return iP(this,a)}}function iP(e,i){if(i&&(f0(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return aP(e)}function aP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function h0(e){return h0=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},h0(e)}var dO=function(e){rP(r,e);var i=nP(r);function r(n){var a;return eP(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.popup=void 0,a.el=document.createElement("div"),a}return tP(r,[{key:"componentDidMount",value:function(){var a,s=this.props,f=s.lnglat,v=s.children,m=s.option,x=s.lngLat,C=new Ng(p0(p0({},m),{},{stopPropagation:(a=this.props.option)===null||a===void 0?void 0:a.stopPropagation}));f&&C.setLnglat(f),x&&C.setLnglat(x),v&&C.setDOMContent(this.el),this.popup=C,this.scene.addPopup(C)}},{key:"componentDidUpdate",value:function(a){var s,f,v,m,x,C,T=Array.isArray(a.lnglat)?a.lnglat:[a==null||(s=a.lnglat)===null||s===void 0?void 0:s.lng,a==null||(f=a.lnglat)===null||f===void 0?void 0:f.lat],O=Array.isArray(this.props.lnglat)?this.props.lnglat:[(v=this.props)===null||v===void 0||(m=v.lnglat)===null||m===void 0?void 0:m.lng,(x=this.props)===null||x===void 0||(C=x.lnglat)===null||C===void 0?void 0:C.lat],D=T.toString()!==O.toString();if(D){var Z;this.popup.remove(),this.popup=new Ng(p0(p0({},this.props.option),{},{stopPropagation:(Z=this.props.option)===null||Z===void 0?void 0:Z.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var a=this;return _e.createElement(g.Consumer,{},function(s){return s&&(a.scene=s),(0,Xx.createPortal)(a.props.children,a.el)})}}]),r}(_e.PureComponent);function d0(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?d0=function(r){return typeof r}:d0=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},d0(e)}function sP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function nb(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function uP(e,i,r){return i&&nb(e.prototype,i),r&&nb(e,r),e}function lP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&vm(e,i)}function vm(e,i){return vm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},vm(e,i)}function cP(e){var i=hP();return function(){var n=v0(e),a;if(i){var s=v0(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return fP(this,a)}}function fP(e,i){if(i&&(d0(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return pP(e)}function pP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function v0(e){return v0=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},v0(e)}var vO=function(e){lP(r,e);var i=cP(r);function r(n){var a;return sP(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.marker=void 0,a.el=document.createElement("div"),a}return uP(r,[{key:"componentDidMount",value:function(){var a=this.props,s=a.lnglat,f=a.children,v=a.option,m=a.onMarkerLoaded,x=new Lg(v);s&&x.setLnglat(s),f&&x.setElement(this.el),this.marker=x,m&&m(x),this.scene.addMarker(x)}},{key:"componentDidUpdate",value:function(a){var s,f=(a==null?void 0:a.lnglat.toString())!==((s=this.props)===null||s===void 0?void 0:s.lnglat.toString());f&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var a=this;return _e.createElement(g.Consumer,{},function(s){return s&&(a.scene=s),(0,Xx.createPortal)(a.props.children,a.el)})}}]),r}(_e.PureComponent),mO=_e.useEffect,gO=null,yO=null,_O=_e.useEffect,xO=null},66213:function(Tr,ie,ee){"use strict";ee.d(ie,{Z:function(){return g}});var Oe=ee(77608);function _e(Re,X){for(;!Object.prototype.hasOwnProperty.call(Re,X)&&(Re=(0,Oe.Z)(Re),Re!==null););return Re}function g(){return typeof Reflect!="undefined"&&Reflect.get?g=Reflect.get:g=function(X,pe,de){var Ne=_e(X,pe);if(!!Ne){var xe=Object.getOwnPropertyDescriptor(Ne,pe);return xe.get?xe.get.call(arguments.length<3?X:de):xe.value}},g.apply(this,arguments)}},31795:function(Tr,ie,ee){var Oe=ee(75752);Tr.exports.geometry=_e,Tr.exports.ring=Re;function _e(pe){var de=0,Ne;switch(pe.type){case"Polygon":return g(pe.coordinates);case"MultiPolygon":for(Ne=0;Ne<pe.coordinates.length;Ne++)de+=g(pe.coordinates[Ne]);return de;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Ne=0;Ne<pe.geometries.length;Ne++)de+=_e(pe.geometries[Ne]);return de}}function g(pe){var de=0;if(pe&&pe.length>0){de+=Math.abs(Re(pe[0]));for(var Ne=1;Ne<pe.length;Ne++)de-=Math.abs(Re(pe[Ne]))}return de}function Re(pe){var de,Ne,xe,tt,dt,At,tr,pr=0,Lt=pe.length;if(Lt>2){for(tr=0;tr<Lt;tr++)tr===Lt-2?(tt=Lt-2,dt=Lt-1,At=0):tr===Lt-1?(tt=Lt-1,dt=0,At=1):(tt=tr,dt=tr+1,At=tr+2),de=pe[tt],Ne=pe[dt],xe=pe[At],pr+=(X(xe[0])-X(de[0]))*Math.sin(X(Ne[1]));pr=pr*Oe.RADIUS*Oe.RADIUS/2}return pr}function X(pe){return pe*Math.PI/180}},38163:function(Tr,ie,ee){var Oe=ee(31795);Tr.exports=_e;function _e(Ne,xe){switch(Ne&&Ne.type||null){case"FeatureCollection":return Ne.features=Ne.features.map(g(_e,xe)),Ne;case"GeometryCollection":return Ne.geometries=Ne.geometries.map(g(_e,xe)),Ne;case"Feature":return Ne.geometry=_e(Ne.geometry,xe),Ne;case"Polygon":case"MultiPolygon":return Re(Ne,xe);default:return Ne}}function g(Ne,xe){return function(tt){return Ne(tt,xe)}}function Re(Ne,xe){return Ne.type==="Polygon"?Ne.coordinates=X(Ne.coordinates,xe):Ne.type==="MultiPolygon"&&(Ne.coordinates=Ne.coordinates.map(g(X,xe))),Ne}function X(Ne,xe){xe=!!xe,Ne[0]=pe(Ne[0],xe);for(var tt=1;tt<Ne.length;tt++)Ne[tt]=pe(Ne[tt],!xe);return Ne}function pe(Ne,xe){return de(Ne)===xe?Ne:Ne.reverse()}function de(Ne){return Oe.ring(Ne)>=0}},53645:function(){},9187:function(Tr){"use strict";Tr.exports=ie,Tr.exports.default=ie;function ie(A,Se,ke){ke=ke||2;var St=Se&&Se.length,vt=St?Se[0]*ke:A.length,Ft=ee(A,0,vt,ke,!0),Wt=[];if(!Ft||Ft.next===Ft.prev)return Wt;var Er,$n,_n,mi,Gn,ai,gi;if(St&&(Ft=de(A,Se,Ft,ke)),A.length>80*ke){Er=_n=A[0],$n=mi=A[1];for(var Xn=ke;Xn<vt;Xn+=ke)Gn=A[Xn],ai=A[Xn+1],Gn<Er&&(Er=Gn),ai<$n&&($n=ai),Gn>_n&&(_n=Gn),ai>mi&&(mi=ai);gi=Math.max(_n-Er,mi-$n),gi=gi!==0?1/gi:0}return _e(Ft,Wt,ke,Er,$n,gi),Wt}function ee(A,Se,ke,St,vt){var Ft,Wt;if(vt===on(A,Se,ke,St)>0)for(Ft=Se;Ft<ke;Ft+=St)Wt=qt(Ft,A[Ft],A[Ft+1],Wt);else for(Ft=ke-St;Ft>=Se;Ft-=St)Wt=qt(Ft,A[Ft],A[Ft+1],Wt);return Wt&&gt(Wt,Wt.next)&&(Ar(Wt),Wt=Wt.next),Wt}function Oe(A,Se){if(!A)return A;Se||(Se=A);var ke=A,St;do if(St=!1,!ke.steiner&&(gt(ke,ke.next)||ht(ke.prev,ke,ke.next)===0)){if(Ar(ke),ke=Se=ke.prev,ke===ke.next)break;St=!0}else ke=ke.next;while(St||ke!==Se);return Se}function _e(A,Se,ke,St,vt,Ft,Wt){if(!!A){!Wt&&Ft&&At(A,St,vt,Ft);for(var Er=A,$n,_n;A.prev!==A.next;){if($n=A.prev,_n=A.next,Ft?Re(A,St,vt,Ft):g(A)){Se.push($n.i/ke),Se.push(A.i/ke),Se.push(_n.i/ke),Ar(A),A=_n.next,Er=_n.next;continue}if(A=_n,A===Er){Wt?Wt===1?(A=X(Oe(A),Se,ke),_e(A,Se,ke,St,vt,Ft,2)):Wt===2&&pe(A,Se,ke,St,vt,Ft):_e(Oe(A),Se,ke,St,vt,Ft,1);break}}}}function g(A){var Se=A.prev,ke=A,St=A.next;if(ht(Se,ke,St)>=0)return!1;for(var vt=A.next.next;vt!==A.prev;){if(nr(Se.x,Se.y,ke.x,ke.y,St.x,St.y,vt.x,vt.y)&&ht(vt.prev,vt,vt.next)>=0)return!1;vt=vt.next}return!0}function Re(A,Se,ke,St){var vt=A.prev,Ft=A,Wt=A.next;if(ht(vt,Ft,Wt)>=0)return!1;for(var Er=vt.x<Ft.x?vt.x<Wt.x?vt.x:Wt.x:Ft.x<Wt.x?Ft.x:Wt.x,$n=vt.y<Ft.y?vt.y<Wt.y?vt.y:Wt.y:Ft.y<Wt.y?Ft.y:Wt.y,_n=vt.x>Ft.x?vt.x>Wt.x?vt.x:Wt.x:Ft.x>Wt.x?Ft.x:Wt.x,mi=vt.y>Ft.y?vt.y>Wt.y?vt.y:Wt.y:Ft.y>Wt.y?Ft.y:Wt.y,Gn=pr(Er,$n,Se,ke,St),ai=pr(_n,mi,Se,ke,St),gi=A.prevZ,Xn=A.nextZ;gi&&gi.z>=Gn&&Xn&&Xn.z<=ai;){if(gi!==A.prev&&gi!==A.next&&nr(vt.x,vt.y,Ft.x,Ft.y,Wt.x,Wt.y,gi.x,gi.y)&&ht(gi.prev,gi,gi.next)>=0||(gi=gi.prevZ,Xn!==A.prev&&Xn!==A.next&&nr(vt.x,vt.y,Ft.x,Ft.y,Wt.x,Wt.y,Xn.x,Xn.y)&&ht(Xn.prev,Xn,Xn.next)>=0))return!1;Xn=Xn.nextZ}for(;gi&&gi.z>=Gn;){if(gi!==A.prev&&gi!==A.next&&nr(vt.x,vt.y,Ft.x,Ft.y,Wt.x,Wt.y,gi.x,gi.y)&&ht(gi.prev,gi,gi.next)>=0)return!1;gi=gi.prevZ}for(;Xn&&Xn.z<=ai;){if(Xn!==A.prev&&Xn!==A.next&&nr(vt.x,vt.y,Ft.x,Ft.y,Wt.x,Wt.y,Xn.x,Xn.y)&&ht(Xn.prev,Xn,Xn.next)>=0)return!1;Xn=Xn.nextZ}return!0}function X(A,Se,ke){var St=A;do{var vt=St.prev,Ft=St.next.next;!gt(vt,Ft)&&sr(vt,St,St.next,Ft)&&Ke(vt,Ft)&&Ke(Ft,vt)&&(Se.push(vt.i/ke),Se.push(St.i/ke),Se.push(Ft.i/ke),Ar(St),Ar(St.next),St=A=Ft),St=St.next}while(St!==A);return Oe(St)}function pe(A,Se,ke,St,vt,Ft){var Wt=A;do{for(var Er=Wt.next.next;Er!==Wt.prev;){if(Wt.i!==Er.i&&jt(Wt,Er)){var $n=et(Wt,Er);Wt=Oe(Wt,Wt.next),$n=Oe($n,$n.next),_e(Wt,Se,ke,St,vt,Ft),_e($n,Se,ke,St,vt,Ft);return}Er=Er.next}Wt=Wt.next}while(Wt!==A)}function de(A,Se,ke,St){var vt=[],Ft,Wt,Er,$n,_n;for(Ft=0,Wt=Se.length;Ft<Wt;Ft++)Er=Se[Ft]*St,$n=Ft<Wt-1?Se[Ft+1]*St:A.length,_n=ee(A,Er,$n,St,!1),_n===_n.next&&(_n.steiner=!0),vt.push(Lt(_n));for(vt.sort(Ne),Ft=0;Ft<vt.length;Ft++)ke=xe(vt[Ft],ke),ke=Oe(ke,ke.next);return ke}function Ne(A,Se){return A.x-Se.x}function xe(A,Se){var ke=tt(A,Se);if(!ke)return Se;var St=et(ke,A),vt=Oe(ke,ke.next);return Oe(St,St.next),Se===ke?vt:Se}function tt(A,Se){var ke=Se,St=A.x,vt=A.y,Ft=-Infinity,Wt;do{if(vt<=ke.y&&vt>=ke.next.y&&ke.next.y!==ke.y){var Er=ke.x+(vt-ke.y)*(ke.next.x-ke.x)/(ke.next.y-ke.y);if(Er<=St&&Er>Ft){if(Ft=Er,Er===St){if(vt===ke.y)return ke;if(vt===ke.next.y)return ke.next}Wt=ke.x<ke.next.x?ke:ke.next}}ke=ke.next}while(ke!==Se);if(!Wt)return null;if(St===Ft)return Wt;var $n=Wt,_n=Wt.x,mi=Wt.y,Gn=Infinity,ai;ke=Wt;do St>=ke.x&&ke.x>=_n&&St!==ke.x&&nr(vt<mi?St:Ft,vt,_n,mi,vt<mi?Ft:St,vt,ke.x,ke.y)&&(ai=Math.abs(vt-ke.y)/(St-ke.x),Ke(ke,A)&&(ai<Gn||ai===Gn&&(ke.x>Wt.x||ke.x===Wt.x&&dt(Wt,ke)))&&(Wt=ke,Gn=ai)),ke=ke.next;while(ke!==$n);return Wt}function dt(A,Se){return ht(A.prev,A,Se.prev)<0&&ht(Se.next,A,A.next)<0}function At(A,Se,ke,St){var vt=A;do vt.z===null&&(vt.z=pr(vt.x,vt.y,Se,ke,St)),vt.prevZ=vt.prev,vt.nextZ=vt.next,vt=vt.next;while(vt!==A);vt.prevZ.nextZ=null,vt.prevZ=null,tr(vt)}function tr(A){var Se,ke,St,vt,Ft,Wt,Er,$n,_n=1;do{for(ke=A,A=null,Ft=null,Wt=0;ke;){for(Wt++,St=ke,Er=0,Se=0;Se<_n&&(Er++,St=St.nextZ,!!St);Se++);for($n=_n;Er>0||$n>0&&St;)Er!==0&&($n===0||!St||ke.z<=St.z)?(vt=ke,ke=ke.nextZ,Er--):(vt=St,St=St.nextZ,$n--),Ft?Ft.nextZ=vt:A=vt,vt.prevZ=Ft,Ft=vt;ke=St}Ft.nextZ=null,_n*=2}while(Wt>1);return A}function pr(A,Se,ke,St,vt){return A=32767*(A-ke)*vt,Se=32767*(Se-St)*vt,A=(A|A<<8)&16711935,A=(A|A<<4)&252645135,A=(A|A<<2)&858993459,A=(A|A<<1)&1431655765,Se=(Se|Se<<8)&16711935,Se=(Se|Se<<4)&252645135,Se=(Se|Se<<2)&858993459,Se=(Se|Se<<1)&1431655765,A|Se<<1}function Lt(A){var Se=A,ke=A;do(Se.x<ke.x||Se.x===ke.x&&Se.y<ke.y)&&(ke=Se),Se=Se.next;while(Se!==A);return ke}function nr(A,Se,ke,St,vt,Ft,Wt,Er){return(vt-Wt)*(Se-Er)-(A-Wt)*(Ft-Er)>=0&&(A-Wt)*(St-Er)-(ke-Wt)*(Se-Er)>=0&&(ke-Wt)*(Ft-Er)-(vt-Wt)*(St-Er)>=0}function jt(A,Se){return A.next.i!==Se.i&&A.prev.i!==Se.i&&!ct(A,Se)&&(Ke(A,Se)&&Ke(Se,A)&&wt(A,Se)&&(ht(A.prev,A,Se.prev)||ht(A,Se.prev,Se))||gt(A,Se)&&ht(A.prev,A,A.next)>0&&ht(Se.prev,Se,Se.next)>0)}function ht(A,Se,ke){return(Se.y-A.y)*(ke.x-Se.x)-(Se.x-A.x)*(ke.y-Se.y)}function gt(A,Se){return A.x===Se.x&&A.y===Se.y}function sr(A,Se,ke,St){var vt=Yt(ht(A,Se,ke)),Ft=Yt(ht(A,Se,St)),Wt=Yt(ht(ke,St,A)),Er=Yt(ht(ke,St,Se));return!!(vt!==Ft&&Wt!==Er||vt===0&&q(A,ke,Se)||Ft===0&&q(A,St,Se)||Wt===0&&q(ke,A,St)||Er===0&&q(ke,Se,St))}function q(A,Se,ke){return Se.x<=Math.max(A.x,ke.x)&&Se.x>=Math.min(A.x,ke.x)&&Se.y<=Math.max(A.y,ke.y)&&Se.y>=Math.min(A.y,ke.y)}function Yt(A){return A>0?1:A<0?-1:0}function ct(A,Se){var ke=A;do{if(ke.i!==A.i&&ke.next.i!==A.i&&ke.i!==Se.i&&ke.next.i!==Se.i&&sr(ke,ke.next,A,Se))return!0;ke=ke.next}while(ke!==A);return!1}function Ke(A,Se){return ht(A.prev,A,A.next)<0?ht(A,Se,A.next)>=0&&ht(A,A.prev,Se)>=0:ht(A,Se,A.prev)<0||ht(A,A.next,Se)<0}function wt(A,Se){var ke=A,St=!1,vt=(A.x+Se.x)/2,Ft=(A.y+Se.y)/2;do ke.y>Ft!=ke.next.y>Ft&&ke.next.y!==ke.y&&vt<(ke.next.x-ke.x)*(Ft-ke.y)/(ke.next.y-ke.y)+ke.x&&(St=!St),ke=ke.next;while(ke!==A);return St}function et(A,Se){var ke=new Wr(A.i,A.x,A.y),St=new Wr(Se.i,Se.x,Se.y),vt=A.next,Ft=Se.prev;return A.next=Se,Se.prev=A,ke.next=vt,vt.prev=ke,St.next=ke,ke.prev=St,Ft.next=St,St.prev=Ft,St}function qt(A,Se,ke,St){var vt=new Wr(A,Se,ke);return St?(vt.next=St.next,vt.prev=St,St.next.prev=vt,St.next=vt):(vt.prev=vt,vt.next=vt),vt}function Ar(A){A.next.prev=A.prev,A.prev.next=A.next,A.prevZ&&(A.prevZ.nextZ=A.nextZ),A.nextZ&&(A.nextZ.prevZ=A.prevZ)}function Wr(A,Se,ke){this.i=A,this.x=Se,this.y=ke,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}ie.deviation=function(A,Se,ke,St){var vt=Se&&Se.length,Ft=vt?Se[0]*ke:A.length,Wt=Math.abs(on(A,0,Ft,ke));if(vt)for(var Er=0,$n=Se.length;Er<$n;Er++){var _n=Se[Er]*ke,mi=Er<$n-1?Se[Er+1]*ke:A.length;Wt-=Math.abs(on(A,_n,mi,ke))}var Gn=0;for(Er=0;Er<St.length;Er+=3){var ai=St[Er]*ke,gi=St[Er+1]*ke,Xn=St[Er+2]*ke;Gn+=Math.abs((A[ai]-A[Xn])*(A[gi+1]-A[ai+1])-(A[ai]-A[gi])*(A[Xn+1]-A[ai+1]))}return Wt===0&&Gn===0?0:Math.abs((Gn-Wt)/Wt)};function on(A,Se,ke,St){for(var vt=0,Ft=Se,Wt=ke-St;Ft<ke;Ft+=St)vt+=(A[Wt]-A[Ft])*(A[Ft+1]+A[Wt+1]),Wt=Ft;return vt}ie.flatten=function(A){for(var Se=A[0][0].length,ke={vertices:[],holes:[],dimensions:Se},St=0,vt=0;vt<A.length;vt++){for(var Ft=0;Ft<A[vt].length;Ft++)for(var Wt=0;Wt<Se;Wt++)ke.vertices.push(A[vt][Ft][Wt]);vt>0&&(St+=A[vt-1].length,ke.holes.push(St))}return ke}},67709:function(Tr){function ie(Oe){var _e=Oe.target||Oe.srcElement;_e.__resizeRAF__&&cancelAnimationFrame(_e.__resizeRAF__),_e.__resizeRAF__=requestAnimationFrame(function(){var g=_e.__resizeTrigger__,Re=g&&g.__resizeListeners__;Re&&Re.forEach(function(X){X.call(g,Oe)})})}var ee=function(_e,g){var Re=this,X=Re.document,pe,de=X.attachEvent;typeof navigator!="undefined"&&(pe=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Ne(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",ie)}if(!_e.__resizeListeners__)if(_e.__resizeListeners__=[],de)_e.__resizeTrigger__=_e,_e.attachEvent("onresize",ie);else{getComputedStyle(_e).position==="static"&&(_e.style.position="relative");var xe=_e.__resizeTrigger__=X.createElement("object");xe.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),xe.setAttribute("class","resize-sensor"),xe.setAttribute("tabindex","-1"),xe.setAttribute("title",""),xe.__resizeElement__=_e,xe.onload=Ne,xe.type="text/html",pe&&_e.appendChild(xe),xe.data="about:blank",pe||_e.appendChild(xe)}_e.__resizeListeners__.push(g)};Tr.exports=typeof window=="undefined"?ee:ee.bind(window),Tr.exports.unbind=function(Oe,_e){var g=document.attachEvent,Re=Oe.__resizeListeners__||[];if(_e){var X=Re.indexOf(_e);X!==-1&&Re.splice(X,1)}else Re=Oe.__resizeListeners__=[];if(!Re.length){if(g)Oe.detachEvent("onresize",ie);else if(Oe.__resizeTrigger__){var pe=Oe.__resizeTrigger__.contentDocument,de=pe&&pe.defaultView;de&&(de.removeEventListener("resize",ie),delete de.__resizeTrigger__),Oe.__resizeTrigger__=!Oe.removeChild(Oe.__resizeTrigger__)}delete Oe.__resizeListeners__}}},26729:function(Tr){"use strict";var ie=Object.prototype.hasOwnProperty,ee="~";function Oe(){}Object.create&&(Oe.prototype=Object.create(null),new Oe().__proto__||(ee=!1));function _e(pe,de,Ne){this.fn=pe,this.context=de,this.once=Ne||!1}function g(pe,de,Ne,xe,tt){if(typeof Ne!="function")throw new TypeError("The listener must be a function");var dt=new _e(Ne,xe||pe,tt),At=ee?ee+de:de;return pe._events[At]?pe._events[At].fn?pe._events[At]=[pe._events[At],dt]:pe._events[At].push(dt):(pe._events[At]=dt,pe._eventsCount++),pe}function Re(pe,de){--pe._eventsCount==0?pe._events=new Oe:delete pe._events[de]}function X(){this._events=new Oe,this._eventsCount=0}X.prototype.eventNames=function(){var de=[],Ne,xe;if(this._eventsCount===0)return de;for(xe in Ne=this._events)ie.call(Ne,xe)&&de.push(ee?xe.slice(1):xe);return Object.getOwnPropertySymbols?de.concat(Object.getOwnPropertySymbols(Ne)):de},X.prototype.listeners=function(de){var Ne=ee?ee+de:de,xe=this._events[Ne];if(!xe)return[];if(xe.fn)return[xe.fn];for(var tt=0,dt=xe.length,At=new Array(dt);tt<dt;tt++)At[tt]=xe[tt].fn;return At},X.prototype.listenerCount=function(de){var Ne=ee?ee+de:de,xe=this._events[Ne];return xe?xe.fn?1:xe.length:0},X.prototype.emit=function(de,Ne,xe,tt,dt,At){var tr=ee?ee+de:de;if(!this._events[tr])return!1;var pr=this._events[tr],Lt=arguments.length,nr,jt;if(pr.fn){switch(pr.once&&this.removeListener(de,pr.fn,void 0,!0),Lt){case 1:return pr.fn.call(pr.context),!0;case 2:return pr.fn.call(pr.context,Ne),!0;case 3:return pr.fn.call(pr.context,Ne,xe),!0;case 4:return pr.fn.call(pr.context,Ne,xe,tt),!0;case 5:return pr.fn.call(pr.context,Ne,xe,tt,dt),!0;case 6:return pr.fn.call(pr.context,Ne,xe,tt,dt,At),!0}for(jt=1,nr=new Array(Lt-1);jt<Lt;jt++)nr[jt-1]=arguments[jt];pr.fn.apply(pr.context,nr)}else{var ht=pr.length,gt;for(jt=0;jt<ht;jt++)switch(pr[jt].once&&this.removeListener(de,pr[jt].fn,void 0,!0),Lt){case 1:pr[jt].fn.call(pr[jt].context);break;case 2:pr[jt].fn.call(pr[jt].context,Ne);break;case 3:pr[jt].fn.call(pr[jt].context,Ne,xe);break;case 4:pr[jt].fn.call(pr[jt].context,Ne,xe,tt);break;default:if(!nr)for(gt=1,nr=new Array(Lt-1);gt<Lt;gt++)nr[gt-1]=arguments[gt];pr[jt].fn.apply(pr[jt].context,nr)}}return!0},X.prototype.on=function(de,Ne,xe){return g(this,de,Ne,xe,!1)},X.prototype.once=function(de,Ne,xe){return g(this,de,Ne,xe,!0)},X.prototype.removeListener=function(de,Ne,xe,tt){var dt=ee?ee+de:de;if(!this._events[dt])return this;if(!Ne)return Re(this,dt),this;var At=this._events[dt];if(At.fn)At.fn===Ne&&(!tt||At.once)&&(!xe||At.context===xe)&&Re(this,dt);else{for(var tr=0,pr=[],Lt=At.length;tr<Lt;tr++)(At[tr].fn!==Ne||tt&&!At[tr].once||xe&&At[tr].context!==xe)&&pr.push(At[tr]);pr.length?this._events[dt]=pr.length===1?pr[0]:pr:Re(this,dt)}return this},X.prototype.removeAllListeners=function(de){var Ne;return de?(Ne=ee?ee+de:de,this._events[Ne]&&Re(this,Ne)):(this._events=new Oe,this._eventsCount=0),this},X.prototype.off=X.prototype.removeListener,X.prototype.addListener=X.prototype.on,X.prefixed=ee,X.EventEmitter=X,Tr.exports=X},7375:function(Tr,ie){"use strict";Object.defineProperty(ie,"__esModule",{value:!0});var ee=Symbol.for("INJECTION");function Oe(pe,de,Ne,xe){function tt(){return xe&&!Reflect.hasMetadata(ee,this,de)&&Reflect.defineMetadata(ee,Ne(),this,de),Reflect.hasMetadata(ee,this,de)?Reflect.getMetadata(ee,this,de):Ne()}function dt(At){Reflect.defineMetadata(ee,At,this,de)}Object.defineProperty(pe,de,{configurable:!0,enumerable:!0,get:tt,set:dt})}function _e(pe,de){return function(Ne){return function(xe,tt){var dt=function(){return pe.get(Ne)};Oe(xe,tt,dt,de)}}}ie.makePropertyInjectDecorator=_e;function g(pe,de){return function(Ne,xe){return function(tt,dt){var At=function(){return pe.getNamed(Ne,xe)};Oe(tt,dt,At,de)}}}ie.makePropertyInjectNamedDecorator=g;function Re(pe,de){return function(Ne,xe,tt){return function(dt,At){var tr=function(){return pe.getTagged(Ne,xe,tt)};Oe(dt,At,tr,de)}}}ie.makePropertyInjectTaggedDecorator=Re;function X(pe,de){return function(Ne){return function(xe,tt){var dt=function(){return pe.getAll(Ne)};Oe(xe,tt,dt,de)}}}ie.makePropertyMultiInjectDecorator=X},84879:function(Tr,ie,ee){"use strict";var Oe;Oe={value:!0};var _e=ee(7375);function g(Re,X){X===void 0&&(X=!0);var pe=_e.makePropertyInjectDecorator(Re,X),de=_e.makePropertyInjectNamedDecorator(Re,X),Ne=_e.makePropertyInjectTaggedDecorator(Re,X),xe=_e.makePropertyMultiInjectDecorator(Re,X);return{lazyInject:pe,lazyInjectNamed:de,lazyInjectTagged:Ne,lazyMultiInject:xe}}ie.Z=g},99934:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.tagProperty=ie.tagParameter=ie.decorate=void 0;var Oe=ee(16674),_e=ee(6867);function g(xe,tt,dt,At){var tr=_e.TAGGED;X(tr,xe,tt,At,dt)}ie.tagParameter=g;function Re(xe,tt,dt){var At=_e.TAGGED_PROP;X(At,xe.constructor,tt,dt)}ie.tagProperty=Re;function X(xe,tt,dt,At,tr){var pr={},Lt=typeof tr=="number",nr=tr!==void 0&&Lt?tr.toString():dt;if(Lt&&dt!==void 0)throw new Error(Oe.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(xe,tt)&&(pr=Reflect.getMetadata(xe,tt));var jt=pr[nr];if(!Array.isArray(jt))jt=[];else for(var ht=0,gt=jt;ht<gt.length;ht++){var sr=gt[ht];if(sr.key===At.key)throw new Error(Oe.DUPLICATED_METADATA+" "+sr.key.toString())}jt.push(At),pr[nr]=jt,Reflect.defineMetadata(xe,pr,tt)}function pe(xe,tt){Reflect.decorate(xe,tt)}function de(xe,tt){return function(dt,At){tt(dt,At,xe)}}function Ne(xe,tt,dt){typeof dt=="number"?pe([de(dt,xe)],tt):typeof dt=="string"?Reflect.decorate([xe],tt,dt):pe([xe],tt)}ie.decorate=Ne},5744:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.inject=ie.LazyServiceIdentifer=void 0;var Oe=ee(16674),_e=ee(6867),g=ee(47738),Re=ee(99934),X=function(){function de(Ne){this._cb=Ne}return de.prototype.unwrap=function(){return this._cb()},de}();ie.LazyServiceIdentifer=X;function pe(de){return function(Ne,xe,tt){if(de===void 0)throw new Error(Oe.UNDEFINED_INJECT_ANNOTATION(Ne.name));var dt=new g.Metadata(_e.INJECT_TAG,de);typeof tt=="number"?Re.tagParameter(Ne,xe,tt,dt):Re.tagProperty(Ne,xe,dt)}}ie.inject=pe},64315:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.injectable=void 0;var Oe=ee(16674),_e=ee(6867);function g(){return function(Re){if(Reflect.hasOwnMetadata(_e.PARAM_TYPES,Re))throw new Error(Oe.DUPLICATED_INJECTABLE_DECORATOR);var X=Reflect.getMetadata(_e.DESIGN_PARAM_TYPES,Re)||[];return Reflect.defineMetadata(_e.PARAM_TYPES,X,Re),Re}}ie.injectable=g},71693:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.multiInject=void 0;var Oe=ee(6867),_e=ee(47738),g=ee(99934);function Re(X){return function(pe,de,Ne){var xe=new _e.Metadata(Oe.MULTI_INJECT_TAG,X);typeof Ne=="number"?g.tagParameter(pe,de,Ne,xe):g.tagProperty(pe,de,xe)}}ie.multiInject=Re},38085:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.named=void 0;var Oe=ee(6867),_e=ee(47738),g=ee(99934);function Re(X){return function(pe,de,Ne){var xe=new _e.Metadata(Oe.NAMED_TAG,X);typeof Ne=="number"?g.tagParameter(pe,de,Ne,xe):g.tagProperty(pe,de,xe)}}ie.named=Re},6515:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.optional=void 0;var Oe=ee(6867),_e=ee(47738),g=ee(99934);function Re(){return function(X,pe,de){var Ne=new _e.Metadata(Oe.OPTIONAL_TAG,!0);typeof de=="number"?g.tagParameter(X,pe,de,Ne):g.tagProperty(X,pe,Ne)}}ie.optional=Re},7014:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.postConstruct=void 0;var Oe=ee(16674),_e=ee(6867),g=ee(47738);function Re(){return function(X,pe,de){var Ne=new g.Metadata(_e.POST_CONSTRUCT,pe);if(Reflect.hasOwnMetadata(_e.POST_CONSTRUCT,X.constructor))throw new Error(Oe.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(_e.POST_CONSTRUCT,Ne,X.constructor)}}ie.postConstruct=Re},32052:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.tagged=void 0;var Oe=ee(47738),_e=ee(99934);function g(Re,X){return function(pe,de,Ne){var xe=new Oe.Metadata(Re,X);typeof Ne=="number"?_e.tagParameter(pe,de,Ne,xe):_e.tagProperty(pe,de,xe)}}ie.tagged=g},55638:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.targetName=void 0;var Oe=ee(6867),_e=ee(47738),g=ee(99934);function Re(X){return function(pe,de,Ne){var xe=new _e.Metadata(Oe.NAME_TAG,X);g.tagParameter(pe,de,Ne,xe)}}ie.targetName=Re},86757:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.unmanaged=void 0;var Oe=ee(6867),_e=ee(47738),g=ee(99934);function Re(){return function(X,pe,de){var Ne=new _e.Metadata(Oe.UNMANAGED_TAG,!0);g.tagParameter(X,pe,de,Ne)}}ie.unmanaged=Re},44290:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.Binding=void 0;var Oe=ee(28421),_e=ee(37791),g=function(){function Re(X,pe){this.id=_e.id(),this.activated=!1,this.serviceIdentifier=X,this.scope=pe,this.type=Oe.BindingTypeEnum.Invalid,this.constraint=function(de){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return Re.prototype.clone=function(){var X=new Re(this.serviceIdentifier,this.scope);return X.activated=X.scope===Oe.BindingScopeEnum.Singleton?this.activated:!1,X.implementationType=this.implementationType,X.dynamicValue=this.dynamicValue,X.scope=this.scope,X.type=this.type,X.factory=this.factory,X.provider=this.provider,X.constraint=this.constraint,X.onActivation=this.onActivation,X.cache=this.cache,X},Re}();ie.Binding=g},23184:function(Tr,ie){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.BindingCount=void 0;var ee={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};ie.BindingCount=ee},16674:function(Tr,ie){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.STACK_OVERFLOW=ie.CIRCULAR_DEPENDENCY_IN_FACTORY=ie.POST_CONSTRUCT_ERROR=ie.MULTIPLE_POST_CONSTRUCT_METHODS=ie.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=ie.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=ie.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=ie.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=ie.ARGUMENTS_LENGTH_MISMATCH=ie.INVALID_DECORATOR_OPERATION=ie.INVALID_TO_SELF_VALUE=ie.INVALID_FUNCTION_BINDING=ie.INVALID_MIDDLEWARE_RETURN=ie.NO_MORE_SNAPSHOTS_AVAILABLE=ie.INVALID_BINDING_TYPE=ie.NOT_IMPLEMENTED=ie.CIRCULAR_DEPENDENCY=ie.UNDEFINED_INJECT_ANNOTATION=ie.MISSING_INJECT_ANNOTATION=ie.MISSING_INJECTABLE_ANNOTATION=ie.NOT_REGISTERED=ie.CANNOT_UNBIND=ie.AMBIGUOUS_MATCH=ie.KEY_NOT_FOUND=ie.NULL_ARGUMENT=ie.DUPLICATED_METADATA=ie.DUPLICATED_INJECTABLE_DECORATOR=void 0,ie.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",ie.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",ie.NULL_ARGUMENT="NULL argument",ie.KEY_NOT_FOUND="Key Not Found",ie.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",ie.CANNOT_UNBIND="Could not unbind serviceIdentifier:",ie.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",ie.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",ie.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var ee=function(Re){return"@inject called with undefined this could mean that the class "+Re+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};ie.UNDEFINED_INJECT_ANNOTATION=ee,ie.CIRCULAR_DEPENDENCY="Circular dependency found:",ie.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",ie.INVALID_BINDING_TYPE="Invalid binding type:",ie.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",ie.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",ie.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",ie.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",ie.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var Oe=function(){for(var Re=[],X=0;X<arguments.length;X++)Re[X]=arguments[X];return"The number of constructor arguments in the derived class "+(Re[0]+" must be >= than the number of constructor arguments of its base class.")};ie.ARGUMENTS_LENGTH_MISMATCH=Oe,ie.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",ie.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",ie.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",ie.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",ie.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var _e=function(){for(var Re=[],X=0;X<arguments.length;X++)Re[X]=arguments[X];return"@postConstruct error in class "+Re[0]+": "+Re[1]};ie.POST_CONSTRUCT_ERROR=_e;var g=function(){for(var Re=[],X=0;X<arguments.length;X++)Re[X]=arguments[X];return"It looks like there is a circular dependency "+("in one of the '"+Re[0]+"' bindings. Please investigate bindings with")+("service identifier '"+Re[1]+"'.")};ie.CIRCULAR_DEPENDENCY_IN_FACTORY=g,ie.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Tr,ie){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.TargetTypeEnum=ie.BindingTypeEnum=ie.BindingScopeEnum=void 0;var ee={Request:"Request",Singleton:"Singleton",Transient:"Transient"};ie.BindingScopeEnum=ee;var Oe={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};ie.BindingTypeEnum=Oe;var _e={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};ie.TargetTypeEnum=_e},6867:function(Tr,ie){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.NON_CUSTOM_TAG_KEYS=ie.POST_CONSTRUCT=ie.DESIGN_PARAM_TYPES=ie.PARAM_TYPES=ie.TAGGED_PROP=ie.TAGGED=ie.MULTI_INJECT_TAG=ie.INJECT_TAG=ie.OPTIONAL_TAG=ie.UNMANAGED_TAG=ie.NAME_TAG=ie.NAMED_TAG=void 0,ie.NAMED_TAG="named",ie.NAME_TAG="name",ie.UNMANAGED_TAG="unmanaged",ie.OPTIONAL_TAG="optional",ie.INJECT_TAG="inject",ie.MULTI_INJECT_TAG="multi_inject",ie.TAGGED="inversify:tagged",ie.TAGGED_PROP="inversify:tagged_props",ie.PARAM_TYPES="inversify:paramtypes",ie.DESIGN_PARAM_TYPES="design:paramtypes",ie.POST_CONSTRUCT="post_construct";function ee(){return[ie.INJECT_TAG,ie.MULTI_INJECT_TAG,ie.NAME_TAG,ie.UNMANAGED_TAG,ie.NAMED_TAG,ie.OPTIONAL_TAG]}ie.NON_CUSTOM_TAG_KEYS=ee()},51389:function(Tr,ie,ee){"use strict";var Oe=this&&this.__awaiter||function(jt,ht,gt,sr){function q(Yt){return Yt instanceof gt?Yt:new gt(function(ct){ct(Yt)})}return new(gt||(gt=Promise))(function(Yt,ct){function Ke(qt){try{et(sr.next(qt))}catch(Ar){ct(Ar)}}function wt(qt){try{et(sr.throw(qt))}catch(Ar){ct(Ar)}}function et(qt){qt.done?Yt(qt.value):q(qt.value).then(Ke,wt)}et((sr=sr.apply(jt,ht||[])).next())})},_e=this&&this.__generator||function(jt,ht){var gt={label:0,sent:function(){if(Yt[0]&1)throw Yt[1];return Yt[1]},trys:[],ops:[]},sr,q,Yt,ct;return ct={next:Ke(0),throw:Ke(1),return:Ke(2)},typeof Symbol=="function"&&(ct[Symbol.iterator]=function(){return this}),ct;function Ke(et){return function(qt){return wt([et,qt])}}function wt(et){if(sr)throw new TypeError("Generator is already executing.");for(;gt;)try{if(sr=1,q&&(Yt=et[0]&2?q.return:et[0]?q.throw||((Yt=q.return)&&Yt.call(q),0):q.next)&&!(Yt=Yt.call(q,et[1])).done)return Yt;switch(q=0,Yt&&(et=[et[0]&2,Yt.value]),et[0]){case 0:case 1:Yt=et;break;case 4:return gt.label++,{value:et[1],done:!1};case 5:gt.label++,q=et[1],et=[0];continue;case 7:et=gt.ops.pop(),gt.trys.pop();continue;default:if(Yt=gt.trys,!(Yt=Yt.length>0&&Yt[Yt.length-1])&&(et[0]===6||et[0]===2)){gt=0;continue}if(et[0]===3&&(!Yt||et[1]>Yt[0]&&et[1]<Yt[3])){gt.label=et[1];break}if(et[0]===6&&gt.label<Yt[1]){gt.label=Yt[1],Yt=et;break}if(Yt&&gt.label<Yt[2]){gt.label=Yt[2],gt.ops.push(et);break}Yt[2]&&gt.ops.pop(),gt.trys.pop();continue}et=ht.call(jt,gt)}catch(qt){et=[6,qt],q=0}finally{sr=Yt=0}if(et[0]&5)throw et[1];return{value:et[0]?et[1]:void 0,done:!0}}},g=this&&this.__spreadArray||function(jt,ht){for(var gt=0,sr=ht.length,q=jt.length;gt<sr;gt++,q++)jt[q]=ht[gt];return jt};Object.defineProperty(ie,"__esModule",{value:!0}),ie.Container=void 0;var Re=ee(44290),X=ee(16674),pe=ee(28421),de=ee(6867),Ne=ee(51377),xe=ee(86311),tt=ee(31927),dt=ee(15451),At=ee(37791),tr=ee(55800),pr=ee(85700),Lt=ee(80175),nr=function(){function jt(ht){this._appliedMiddleware=[];var gt=ht||{};if(typeof gt!="object")throw new Error(""+X.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(gt.defaultScope===void 0)gt.defaultScope=pe.BindingScopeEnum.Transient;else if(gt.defaultScope!==pe.BindingScopeEnum.Singleton&&gt.defaultScope!==pe.BindingScopeEnum.Transient&&gt.defaultScope!==pe.BindingScopeEnum.Request)throw new Error(""+X.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(gt.autoBindInjectable===void 0)gt.autoBindInjectable=!1;else if(typeof gt.autoBindInjectable!="boolean")throw new Error(""+X.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(gt.skipBaseClassChecks===void 0)gt.skipBaseClassChecks=!1;else if(typeof gt.skipBaseClassChecks!="boolean")throw new Error(""+X.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:gt.autoBindInjectable,defaultScope:gt.defaultScope,skipBaseClassChecks:gt.skipBaseClassChecks},this.id=At.id(),this._bindingDictionary=new Lt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Ne.MetadataReader}return jt.merge=function(ht,gt){for(var sr=[],q=2;q<arguments.length;q++)sr[q-2]=arguments[q];var Yt=new jt,ct=g([ht,gt],sr).map(function(et){return xe.getBindingDictionary(et)}),Ke=xe.getBindingDictionary(Yt);function wt(et,qt){et.traverse(function(Ar,Wr){Wr.forEach(function(on){qt.add(on.serviceIdentifier,on.clone())})})}return ct.forEach(function(et){wt(et,Ke)}),Yt},jt.prototype.load=function(){for(var ht=[],gt=0;gt<arguments.length;gt++)ht[gt]=arguments[gt];for(var sr=this._getContainerModuleHelpersFactory(),q=0,Yt=ht;q<Yt.length;q++){var ct=Yt[q],Ke=sr(ct.id);ct.registry(Ke.bindFunction,Ke.unbindFunction,Ke.isboundFunction,Ke.rebindFunction)}},jt.prototype.loadAsync=function(){for(var ht=[],gt=0;gt<arguments.length;gt++)ht[gt]=arguments[gt];return Oe(this,void 0,void 0,function(){var sr,q,Yt,ct,Ke;return _e(this,function(wt){switch(wt.label){case 0:sr=this._getContainerModuleHelpersFactory(),q=0,Yt=ht,wt.label=1;case 1:return q<Yt.length?(ct=Yt[q],Ke=sr(ct.id),[4,ct.registry(Ke.bindFunction,Ke.unbindFunction,Ke.isboundFunction,Ke.rebindFunction)]):[3,4];case 2:wt.sent(),wt.label=3;case 3:return q++,[3,1];case 4:return[2]}})})},jt.prototype.unload=function(){for(var ht=this,gt=[],sr=0;sr<arguments.length;sr++)gt[sr]=arguments[sr];var q=function(Yt){return function(ct){return ct.moduleId===Yt}};gt.forEach(function(Yt){var ct=q(Yt.id);ht._bindingDictionary.removeByCondition(ct)})},jt.prototype.bind=function(ht){var gt=this.options.defaultScope||pe.BindingScopeEnum.Transient,sr=new Re.Binding(ht,gt);return this._bindingDictionary.add(ht,sr),new dt.BindingToSyntax(sr)},jt.prototype.rebind=function(ht){return this.unbind(ht),this.bind(ht)},jt.prototype.unbind=function(ht){try{this._bindingDictionary.remove(ht)}catch(gt){throw new Error(X.CANNOT_UNBIND+" "+tr.getServiceIdentifierAsString(ht))}},jt.prototype.unbindAll=function(){this._bindingDictionary=new Lt.Lookup},jt.prototype.isBound=function(ht){var gt=this._bindingDictionary.hasKey(ht);return!gt&&this.parent&&(gt=this.parent.isBound(ht)),gt},jt.prototype.isBoundNamed=function(ht,gt){return this.isBoundTagged(ht,de.NAMED_TAG,gt)},jt.prototype.isBoundTagged=function(ht,gt,sr){var q=!1;if(this._bindingDictionary.hasKey(ht)){var Yt=this._bindingDictionary.get(ht),ct=xe.createMockRequest(this,ht,gt,sr);q=Yt.some(function(Ke){return Ke.constraint(ct)})}return!q&&this.parent&&(q=this.parent.isBoundTagged(ht,gt,sr)),q},jt.prototype.snapshot=function(){this._snapshots.push(pr.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},jt.prototype.restore=function(){var ht=this._snapshots.pop();if(ht===void 0)throw new Error(X.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=ht.bindings,this._middleware=ht.middleware},jt.prototype.createChild=function(ht){var gt=new jt(ht||this.options);return gt.parent=this,gt},jt.prototype.applyMiddleware=function(){for(var ht=[],gt=0;gt<arguments.length;gt++)ht[gt]=arguments[gt];this._appliedMiddleware=this._appliedMiddleware.concat(ht);var sr=this._middleware?this._middleware:this._planAndResolve();this._middleware=ht.reduce(function(q,Yt){return Yt(q)},sr)},jt.prototype.applyCustomMetadataReader=function(ht){this._metadataReader=ht},jt.prototype.get=function(ht){return this._get(!1,!1,pe.TargetTypeEnum.Variable,ht)},jt.prototype.getTagged=function(ht,gt,sr){return this._get(!1,!1,pe.TargetTypeEnum.Variable,ht,gt,sr)},jt.prototype.getNamed=function(ht,gt){return this.getTagged(ht,de.NAMED_TAG,gt)},jt.prototype.getAll=function(ht){return this._get(!0,!0,pe.TargetTypeEnum.Variable,ht)},jt.prototype.getAllTagged=function(ht,gt,sr){return this._get(!1,!0,pe.TargetTypeEnum.Variable,ht,gt,sr)},jt.prototype.getAllNamed=function(ht,gt){return this.getAllTagged(ht,de.NAMED_TAG,gt)},jt.prototype.resolve=function(ht){var gt=this.createChild();return gt.bind(ht).toSelf(),this._appliedMiddleware.forEach(function(sr){gt.applyMiddleware(sr)}),gt.get(ht)},jt.prototype._getContainerModuleHelpersFactory=function(){var ht=this,gt=function(Ke,wt){Ke._binding.moduleId=wt},sr=function(Ke){return function(wt){var et=ht.bind.bind(ht),qt=et(wt);return gt(qt,Ke),qt}},q=function(Ke){return function(wt){var et=ht.unbind.bind(ht);et(wt)}},Yt=function(Ke){return function(wt){var et=ht.isBound.bind(ht);return et(wt)}},ct=function(Ke){return function(wt){var et=ht.rebind.bind(ht),qt=et(wt);return gt(qt,Ke),qt}};return function(Ke){return{bindFunction:sr(Ke),isboundFunction:Yt(Ke),rebindFunction:ct(Ke),unbindFunction:q(Ke)}}},jt.prototype._get=function(ht,gt,sr,q,Yt,ct){var Ke=null,wt={avoidConstraints:ht,contextInterceptor:function(et){return et},isMultiInject:gt,key:Yt,serviceIdentifier:q,targetType:sr,value:ct};if(this._middleware){if(Ke=this._middleware(wt),Ke==null)throw new Error(X.INVALID_MIDDLEWARE_RETURN)}else Ke=this._planAndResolve()(wt);return Ke},jt.prototype._planAndResolve=function(){var ht=this;return function(gt){var sr=xe.plan(ht._metadataReader,ht,gt.isMultiInject,gt.targetType,gt.serviceIdentifier,gt.key,gt.value,gt.avoidConstraints);sr=gt.contextInterceptor(sr);var q=tt.resolve(sr);return q}},jt}();ie.Container=nr},33244:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.AsyncContainerModule=ie.ContainerModule=void 0;var Oe=ee(37791),_e=function(){function Re(X){this.id=Oe.id(),this.registry=X}return Re}();ie.ContainerModule=_e;var g=function(){function Re(X){this.id=Oe.id(),this.registry=X}return Re}();ie.AsyncContainerModule=g},85700:function(Tr,ie){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.ContainerSnapshot=void 0;var ee=function(){function Oe(){}return Oe.of=function(_e,g){var Re=new Oe;return Re.bindings=_e,Re.middleware=g,Re},Oe}();ie.ContainerSnapshot=ee},80175:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.Lookup=void 0;var Oe=ee(16674),_e=function(){function g(){this._map=new Map}return g.prototype.getMap=function(){return this._map},g.prototype.add=function(Re,X){if(Re==null)throw new Error(Oe.NULL_ARGUMENT);if(X==null)throw new Error(Oe.NULL_ARGUMENT);var pe=this._map.get(Re);pe!==void 0?(pe.push(X),this._map.set(Re,pe)):this._map.set(Re,[X])},g.prototype.get=function(Re){if(Re==null)throw new Error(Oe.NULL_ARGUMENT);var X=this._map.get(Re);if(X!==void 0)return X;throw new Error(Oe.KEY_NOT_FOUND)},g.prototype.remove=function(Re){if(Re==null)throw new Error(Oe.NULL_ARGUMENT);if(!this._map.delete(Re))throw new Error(Oe.KEY_NOT_FOUND)},g.prototype.removeByCondition=function(Re){var X=this;this._map.forEach(function(pe,de){var Ne=pe.filter(function(xe){return!Re(xe)});Ne.length>0?X._map.set(de,Ne):X._map.delete(de)})},g.prototype.hasKey=function(Re){if(Re==null)throw new Error(Oe.NULL_ARGUMENT);return this._map.has(Re)},g.prototype.clone=function(){var Re=new g;return this._map.forEach(function(X,pe){X.forEach(function(de){return Re.add(pe,de.clone())})}),Re},g.prototype.traverse=function(Re){this._map.forEach(function(X,pe){Re(pe,X)})},g}();ie.Lookup=_e},86700:function(Tr,ie,ee){"use strict";var Oe;Oe={value:!0},Oe=Oe=Oe=Oe=Oe=Oe=ie.GW=Oe=Oe=ie.zY=Oe=Oe=Oe=Oe=Oe=ie.f3=Oe=Oe=ie.b2=Oe=Oe=Oe=Oe=Oe=ie.W2=Oe=void 0;var _e=ee(6867);Oe=_e;var g=ee(51389);Object.defineProperty(ie,"W2",{enumerable:!0,get:function(){return g.Container}});var Re=ee(28421);Oe={enumerable:!0,get:function(){return Re.BindingScopeEnum}},Oe={enumerable:!0,get:function(){return Re.BindingTypeEnum}},Oe={enumerable:!0,get:function(){return Re.TargetTypeEnum}};var X=ee(33244);Oe={enumerable:!0,get:function(){return X.AsyncContainerModule}},Oe={enumerable:!0,get:function(){return X.ContainerModule}};var pe=ee(64315);Object.defineProperty(ie,"b2",{enumerable:!0,get:function(){return pe.injectable}});var de=ee(32052);Oe={enumerable:!0,get:function(){return de.tagged}};var Ne=ee(38085);Oe={enumerable:!0,get:function(){return Ne.named}};var xe=ee(5744);Object.defineProperty(ie,"f3",{enumerable:!0,get:function(){return xe.inject}}),Oe={enumerable:!0,get:function(){return xe.LazyServiceIdentifer}};var tt=ee(6515);Oe={enumerable:!0,get:function(){return tt.optional}};var dt=ee(86757);Oe={enumerable:!0,get:function(){return dt.unmanaged}};var At=ee(71693);Oe={enumerable:!0,get:function(){return At.multiInject}};var tr=ee(55638);Oe={enumerable:!0,get:function(){return tr.targetName}};var pr=ee(7014);Object.defineProperty(ie,"zY",{enumerable:!0,get:function(){return pr.postConstruct}});var Lt=ee(51377);Oe={enumerable:!0,get:function(){return Lt.MetadataReader}};var nr=ee(37791);Oe={enumerable:!0,get:function(){return nr.id}};var jt=ee(99934);Object.defineProperty(ie,"GW",{enumerable:!0,get:function(){return jt.decorate}});var ht=ee(80758);Oe={enumerable:!0,get:function(){return ht.traverseAncerstors}},Oe={enumerable:!0,get:function(){return ht.taggedConstraint}},Oe={enumerable:!0,get:function(){return ht.namedConstraint}},Oe={enumerable:!0,get:function(){return ht.typeConstraint}};var gt=ee(55800);Oe={enumerable:!0,get:function(){return gt.getServiceIdentifierAsString}};var sr=ee(70600);Oe={enumerable:!0,get:function(){return sr.multiBindToService}}},95228:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.Context=void 0;var Oe=ee(37791),_e=function(){function g(Re){this.id=Oe.id(),this.container=Re}return g.prototype.addPlan=function(Re){this.plan=Re},g.prototype.setCurrentRequest=function(Re){this.currentRequest=Re},g}();ie.Context=_e},47738:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.Metadata=void 0;var Oe=ee(6867),_e=function(){function g(Re,X){this.key=Re,this.value=X}return g.prototype.toString=function(){return this.key===Oe.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},g}();ie.Metadata=_e},51377:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.MetadataReader=void 0;var Oe=ee(6867),_e=function(){function g(){}return g.prototype.getConstructorMetadata=function(Re){var X=Reflect.getMetadata(Oe.PARAM_TYPES,Re),pe=Reflect.getMetadata(Oe.TAGGED,Re);return{compilerGeneratedMetadata:X,userGeneratedMetadata:pe||{}}},g.prototype.getPropertiesMetadata=function(Re){var X=Reflect.getMetadata(Oe.TAGGED_PROP,Re)||[];return X},g}();ie.MetadataReader=_e},55314:function(Tr,ie){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.Plan=void 0;var ee=function(){function Oe(_e,g){this.parentContext=_e,this.rootRequest=g}return Oe}();ie.Plan=ee},86311:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.getBindingDictionary=ie.createMockRequest=ie.plan=void 0;var Oe=ee(23184),_e=ee(16674),g=ee(28421),Re=ee(6867),X=ee(85265),pe=ee(55800),de=ee(95228),Ne=ee(47738),xe=ee(55314),tt=ee(6e3),dt=ee(6748),At=ee(18924);function tr(q){return q._bindingDictionary}ie.getBindingDictionary=tr;function pr(q,Yt,ct,Ke,wt,et){var qt=q?Re.MULTI_INJECT_TAG:Re.INJECT_TAG,Ar=new Ne.Metadata(qt,ct),Wr=new At.Target(Yt,Ke,ct,Ar);if(wt!==void 0){var on=new Ne.Metadata(wt,et);Wr.metadata.push(on)}return Wr}function Lt(q,Yt,ct,Ke,wt){var et=ht(ct.container,wt.serviceIdentifier),qt=[];return et.length===Oe.BindingCount.NoBindingsAvailable&&ct.container.options.autoBindInjectable&&typeof wt.serviceIdentifier=="function"&&q.getConstructorMetadata(wt.serviceIdentifier).compilerGeneratedMetadata&&(ct.container.bind(wt.serviceIdentifier).toSelf(),et=ht(ct.container,wt.serviceIdentifier)),Yt?qt=et:qt=et.filter(function(Ar){var Wr=new dt.Request(Ar.serviceIdentifier,ct,Ke,Ar,wt);return Ar.constraint(Wr)}),nr(wt.serviceIdentifier,qt,wt,ct.container),qt}function nr(q,Yt,ct,Ke){switch(Yt.length){case Oe.BindingCount.NoBindingsAvailable:if(ct.isOptional())return Yt;var wt=pe.getServiceIdentifierAsString(q),et=_e.NOT_REGISTERED;throw et+=pe.listMetadataForTarget(wt,ct),et+=pe.listRegisteredBindingsForServiceIdentifier(Ke,wt,ht),new Error(et);case Oe.BindingCount.OnlyOneBindingAvailable:if(!ct.isArray())return Yt;case Oe.BindingCount.MultipleBindingsAvailable:default:if(ct.isArray())return Yt;var wt=pe.getServiceIdentifierAsString(q),et=_e.AMBIGUOUS_MATCH+" "+wt;throw et+=pe.listRegisteredBindingsForServiceIdentifier(Ke,wt,ht),new Error(et)}}function jt(q,Yt,ct,Ke,wt,et){var qt,Ar;if(wt===null){qt=Lt(q,Yt,Ke,null,et),Ar=new dt.Request(ct,Ke,null,qt,et);var Wr=new xe.Plan(Ke,Ar);Ke.addPlan(Wr)}else qt=Lt(q,Yt,Ke,wt,et),Ar=wt.addChildRequest(et.serviceIdentifier,qt,et);qt.forEach(function(on){var A=null;if(et.isArray())A=Ar.addChildRequest(on.serviceIdentifier,on,et);else{if(on.cache)return;A=Ar}if(on.type===g.BindingTypeEnum.Instance&&on.implementationType!==null){var Se=tt.getDependencies(q,on.implementationType);if(!Ke.container.options.skipBaseClassChecks){var ke=tt.getBaseClassDependencyCount(q,on.implementationType);if(Se.length<ke){var St=_e.ARGUMENTS_LENGTH_MISMATCH(tt.getFunctionName(on.implementationType));throw new Error(St)}}Se.forEach(function(vt){jt(q,!1,vt.serviceIdentifier,Ke,A,vt)})}})}function ht(q,Yt){var ct=[],Ke=tr(q);return Ke.hasKey(Yt)?ct=Ke.get(Yt):q.parent!==null&&(ct=ht(q.parent,Yt)),ct}function gt(q,Yt,ct,Ke,wt,et,qt,Ar){Ar===void 0&&(Ar=!1);var Wr=new de.Context(Yt),on=pr(ct,Ke,wt,"",et,qt);try{return jt(q,Ar,wt,Wr,null,on),Wr}catch(A){throw X.isStackOverflowExeption(A)&&Wr.plan&&pe.circularDependencyToException(Wr.plan.rootRequest),A}}ie.plan=gt;function sr(q,Yt,ct,Ke){var wt=new At.Target(g.TargetTypeEnum.Variable,"",Yt,new Ne.Metadata(ct,Ke)),et=new de.Context(q),qt=new dt.Request(Yt,et,null,[],wt);return qt}ie.createMockRequest=sr},88460:function(Tr,ie){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.QueryableString=void 0;var ee=function(){function Oe(_e){this.str=_e}return Oe.prototype.startsWith=function(_e){return this.str.indexOf(_e)===0},Oe.prototype.endsWith=function(_e){var g="",Re=_e.split("").reverse().join("");return g=this.str.split("").reverse().join(""),this.startsWith.call({str:g},Re)},Oe.prototype.contains=function(_e){return this.str.indexOf(_e)!==-1},Oe.prototype.equals=function(_e){return this.str===_e},Oe.prototype.value=function(){return this.str},Oe}();ie.QueryableString=ee},6e3:function(Tr,ie,ee){"use strict";var Oe=this&&this.__spreadArray||function(Lt,nr){for(var jt=0,ht=nr.length,gt=Lt.length;jt<ht;jt++,gt++)Lt[gt]=nr[jt];return Lt};Object.defineProperty(ie,"__esModule",{value:!0}),ie.getFunctionName=ie.getBaseClassDependencyCount=ie.getDependencies=void 0;var _e=ee(5744),g=ee(16674),Re=ee(28421),X=ee(6867),pe=ee(55800);Object.defineProperty(ie,"getFunctionName",{enumerable:!0,get:function(){return pe.getFunctionName}});var de=ee(18924);function Ne(Lt,nr){var jt=pe.getFunctionName(nr),ht=xe(Lt,jt,nr,!1);return ht}ie.getDependencies=Ne;function xe(Lt,nr,jt,ht){var gt=Lt.getConstructorMetadata(jt),sr=gt.compilerGeneratedMetadata;if(sr===void 0){var q=g.MISSING_INJECTABLE_ANNOTATION+" "+nr+".";throw new Error(q)}var Yt=gt.userGeneratedMetadata,ct=Object.keys(Yt),Ke=jt.length===0&&ct.length>0,wt=ct.length>jt.length,et=Ke||wt?ct.length:jt.length,qt=dt(ht,nr,sr,Yt,et),Ar=At(Lt,jt),Wr=Oe(Oe([],qt),Ar);return Wr}function tt(Lt,nr,jt,ht,gt){var sr=gt[Lt.toString()]||[],q=pr(sr),Yt=q.unmanaged!==!0,ct=ht[Lt],Ke=q.inject||q.multiInject;if(ct=Ke||ct,ct instanceof _e.LazyServiceIdentifer&&(ct=ct.unwrap()),Yt){var wt=ct===Object,et=ct===Function,qt=ct===void 0,Ar=wt||et||qt;if(!nr&&Ar){var Wr=g.MISSING_INJECT_ANNOTATION+" argument "+Lt+" in class "+jt+".";throw new Error(Wr)}var on=new de.Target(Re.TargetTypeEnum.ConstructorArgument,q.targetName,ct);return on.metadata=sr,on}return null}function dt(Lt,nr,jt,ht,gt){for(var sr=[],q=0;q<gt;q++){var Yt=q,ct=tt(Yt,Lt,nr,jt,ht);ct!==null&&sr.push(ct)}return sr}function At(Lt,nr){for(var jt=Lt.getPropertiesMetadata(nr),ht=[],gt=Object.keys(jt),sr=0,q=gt;sr<q.length;sr++){var Yt=q[sr],ct=jt[Yt],Ke=pr(jt[Yt]),wt=Ke.targetName||Yt,et=Ke.inject||Ke.multiInject,qt=new de.Target(Re.TargetTypeEnum.ClassProperty,wt,et);qt.metadata=ct,ht.push(qt)}var Ar=Object.getPrototypeOf(nr.prototype).constructor;if(Ar!==Object){var Wr=At(Lt,Ar);ht=Oe(Oe([],ht),Wr)}return ht}function tr(Lt,nr){var jt=Object.getPrototypeOf(nr.prototype).constructor;if(jt!==Object){var ht=pe.getFunctionName(jt),gt=xe(Lt,ht,jt,!0),sr=gt.map(function(ct){return ct.metadata.filter(function(Ke){return Ke.key===X.UNMANAGED_TAG})}),q=[].concat.apply([],sr).length,Yt=gt.length-q;return Yt>0?Yt:tr(Lt,jt)}else return 0}ie.getBaseClassDependencyCount=tr;function pr(Lt){var nr={};return Lt.forEach(function(jt){nr[jt.key.toString()]=jt.value}),{inject:nr[X.INJECT_TAG],multiInject:nr[X.MULTI_INJECT_TAG],targetName:nr[X.NAME_TAG],unmanaged:nr[X.UNMANAGED_TAG]}}},6748:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.Request=void 0;var Oe=ee(37791),_e=function(){function g(Re,X,pe,de,Ne){this.id=Oe.id(),this.serviceIdentifier=Re,this.parentContext=X,this.parentRequest=pe,this.target=Ne,this.childRequests=[],this.bindings=Array.isArray(de)?de:[de],this.requestScope=pe===null?new Map:null}return g.prototype.addChildRequest=function(Re,X,pe){var de=new g(Re,this.parentContext,this,X,pe);return this.childRequests.push(de),de},g}();ie.Request=_e},18924:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.Target=void 0;var Oe=ee(6867),_e=ee(37791),g=ee(47738),Re=ee(88460),X=function(){function pe(de,Ne,xe,tt){this.id=_e.id(),this.type=de,this.serviceIdentifier=xe,this.name=new Re.QueryableString(Ne||""),this.metadata=new Array;var dt=null;typeof tt=="string"?dt=new g.Metadata(Oe.NAMED_TAG,tt):tt instanceof g.Metadata&&(dt=tt),dt!==null&&this.metadata.push(dt)}return pe.prototype.hasTag=function(de){for(var Ne=0,xe=this.metadata;Ne<xe.length;Ne++){var tt=xe[Ne];if(tt.key===de)return!0}return!1},pe.prototype.isArray=function(){return this.hasTag(Oe.MULTI_INJECT_TAG)},pe.prototype.matchesArray=function(de){return this.matchesTag(Oe.MULTI_INJECT_TAG)(de)},pe.prototype.isNamed=function(){return this.hasTag(Oe.NAMED_TAG)},pe.prototype.isTagged=function(){return this.metadata.some(function(de){return Oe.NON_CUSTOM_TAG_KEYS.every(function(Ne){return de.key!==Ne})})},pe.prototype.isOptional=function(){return this.matchesTag(Oe.OPTIONAL_TAG)(!0)},pe.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(de){return de.key===Oe.NAMED_TAG})[0]:null},pe.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(de){return Oe.NON_CUSTOM_TAG_KEYS.every(function(Ne){return de.key!==Ne})}):null},pe.prototype.matchesNamedTag=function(de){return this.matchesTag(Oe.NAMED_TAG)(de)},pe.prototype.matchesTag=function(de){var Ne=this;return function(xe){for(var tt=0,dt=Ne.metadata;tt<dt.length;tt++){var At=dt[tt];if(At.key===de&&At.value===xe)return!0}return!1}},pe}();ie.Target=X},52279:function(Tr,ie,ee){"use strict";var Oe=this&&this.__spreadArray||function(xe,tt){for(var dt=0,At=tt.length,tr=xe.length;dt<At;dt++,tr++)xe[tr]=tt[dt];return xe};Object.defineProperty(ie,"__esModule",{value:!0}),ie.resolveInstance=void 0;var _e=ee(16674),g=ee(28421),Re=ee(6867);function X(xe,tt,dt){var At=tt.filter(function(pr){return pr.target!==null&&pr.target.type===g.TargetTypeEnum.ClassProperty}),tr=At.map(dt);return At.forEach(function(pr,Lt){var nr="";nr=pr.target.name.value();var jt=tr[Lt];xe[nr]=jt}),xe}function pe(xe,tt){return new(xe.bind.apply(xe,Oe([void 0],tt)))}function de(xe,tt){if(Reflect.hasMetadata(Re.POST_CONSTRUCT,xe)){var dt=Reflect.getMetadata(Re.POST_CONSTRUCT,xe);try{tt[dt.value]()}catch(At){throw new Error(_e.POST_CONSTRUCT_ERROR(xe.name,At.message))}}}function Ne(xe,tt,dt){var At=null;if(tt.length>0){var tr=tt.filter(function(Lt){return Lt.target!==null&&Lt.target.type===g.TargetTypeEnum.ConstructorArgument}),pr=tr.map(dt);At=pe(xe,pr),At=X(At,tt,dt)}else At=new xe;return de(xe,At),At}ie.resolveInstance=Ne},31927:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.resolve=void 0;var Oe=ee(16674),_e=ee(28421),g=ee(85265),Re=ee(55800),X=ee(52279),pe=function(xe,tt,dt){try{return dt()}catch(At){throw g.isStackOverflowExeption(At)?new Error(Oe.CIRCULAR_DEPENDENCY_IN_FACTORY(xe,tt.toString())):At}},de=function(xe){return function(tt){tt.parentContext.setCurrentRequest(tt);var dt=tt.bindings,At=tt.childRequests,tr=tt.target&&tt.target.isArray(),pr=!tt.parentRequest||!tt.parentRequest.target||!tt.target||!tt.parentRequest.target.matchesArray(tt.target.serviceIdentifier);if(tr&&pr)return At.map(function(sr){var q=de(xe);return q(sr)});var Lt=null;if(tt.target.isOptional()&&dt.length===0)return;var nr=dt[0],jt=nr.scope===_e.BindingScopeEnum.Singleton,ht=nr.scope===_e.BindingScopeEnum.Request;if(jt&&nr.activated)return nr.cache;if(ht&&xe!==null&&xe.has(nr.id))return xe.get(nr.id);if(nr.type===_e.BindingTypeEnum.ConstantValue)Lt=nr.cache,nr.activated=!0;else if(nr.type===_e.BindingTypeEnum.Function)Lt=nr.cache,nr.activated=!0;else if(nr.type===_e.BindingTypeEnum.Constructor)Lt=nr.implementationType;else if(nr.type===_e.BindingTypeEnum.DynamicValue&&nr.dynamicValue!==null)Lt=pe("toDynamicValue",nr.serviceIdentifier,function(){return nr.dynamicValue(tt.parentContext)});else if(nr.type===_e.BindingTypeEnum.Factory&&nr.factory!==null)Lt=pe("toFactory",nr.serviceIdentifier,function(){return nr.factory(tt.parentContext)});else if(nr.type===_e.BindingTypeEnum.Provider&&nr.provider!==null)Lt=pe("toProvider",nr.serviceIdentifier,function(){return nr.provider(tt.parentContext)});else if(nr.type===_e.BindingTypeEnum.Instance&&nr.implementationType!==null)Lt=X.resolveInstance(nr.implementationType,At,de(xe));else{var gt=Re.getServiceIdentifierAsString(tt.serviceIdentifier);throw new Error(Oe.INVALID_BINDING_TYPE+" "+gt)}return typeof nr.onActivation=="function"&&(Lt=nr.onActivation(tt.parentContext,Lt)),jt&&(nr.cache=Lt,nr.activated=!0),ht&&xe!==null&&!xe.has(nr.id)&&xe.set(nr.id,Lt),Lt}};function Ne(xe){var tt=de(xe.plan.rootRequest.requestScope);return tt(xe.plan.rootRequest)}ie.resolve=Ne},83366:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.BindingInSyntax=void 0;var Oe=ee(28421),_e=ee(71325),g=function(){function Re(X){this._binding=X}return Re.prototype.inRequestScope=function(){return this._binding.scope=Oe.BindingScopeEnum.Request,new _e.BindingWhenOnSyntax(this._binding)},Re.prototype.inSingletonScope=function(){return this._binding.scope=Oe.BindingScopeEnum.Singleton,new _e.BindingWhenOnSyntax(this._binding)},Re.prototype.inTransientScope=function(){return this._binding.scope=Oe.BindingScopeEnum.Transient,new _e.BindingWhenOnSyntax(this._binding)},Re}();ie.BindingInSyntax=g},74889:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.BindingInWhenOnSyntax=void 0;var Oe=ee(83366),_e=ee(51811),g=ee(98370),Re=function(){function X(pe){this._binding=pe,this._bindingWhenSyntax=new g.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new _e.BindingOnSyntax(this._binding),this._bindingInSyntax=new Oe.BindingInSyntax(pe)}return X.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},X.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},X.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},X.prototype.when=function(pe){return this._bindingWhenSyntax.when(pe)},X.prototype.whenTargetNamed=function(pe){return this._bindingWhenSyntax.whenTargetNamed(pe)},X.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},X.prototype.whenTargetTagged=function(pe,de){return this._bindingWhenSyntax.whenTargetTagged(pe,de)},X.prototype.whenInjectedInto=function(pe){return this._bindingWhenSyntax.whenInjectedInto(pe)},X.prototype.whenParentNamed=function(pe){return this._bindingWhenSyntax.whenParentNamed(pe)},X.prototype.whenParentTagged=function(pe,de){return this._bindingWhenSyntax.whenParentTagged(pe,de)},X.prototype.whenAnyAncestorIs=function(pe){return this._bindingWhenSyntax.whenAnyAncestorIs(pe)},X.prototype.whenNoAncestorIs=function(pe){return this._bindingWhenSyntax.whenNoAncestorIs(pe)},X.prototype.whenAnyAncestorNamed=function(pe){return this._bindingWhenSyntax.whenAnyAncestorNamed(pe)},X.prototype.whenAnyAncestorTagged=function(pe,de){return this._bindingWhenSyntax.whenAnyAncestorTagged(pe,de)},X.prototype.whenNoAncestorNamed=function(pe){return this._bindingWhenSyntax.whenNoAncestorNamed(pe)},X.prototype.whenNoAncestorTagged=function(pe,de){return this._bindingWhenSyntax.whenNoAncestorTagged(pe,de)},X.prototype.whenAnyAncestorMatches=function(pe){return this._bindingWhenSyntax.whenAnyAncestorMatches(pe)},X.prototype.whenNoAncestorMatches=function(pe){return this._bindingWhenSyntax.whenNoAncestorMatches(pe)},X.prototype.onActivation=function(pe){return this._bindingOnSyntax.onActivation(pe)},X}();ie.BindingInWhenOnSyntax=Re},51811:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.BindingOnSyntax=void 0;var Oe=ee(98370),_e=function(){function g(Re){this._binding=Re}return g.prototype.onActivation=function(Re){return this._binding.onActivation=Re,new Oe.BindingWhenSyntax(this._binding)},g}();ie.BindingOnSyntax=_e},15451:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.BindingToSyntax=void 0;var Oe=ee(16674),_e=ee(28421),g=ee(74889),Re=ee(71325),X=function(){function pe(de){this._binding=de}return pe.prototype.to=function(de){return this._binding.type=_e.BindingTypeEnum.Instance,this._binding.implementationType=de,new g.BindingInWhenOnSyntax(this._binding)},pe.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Oe.INVALID_TO_SELF_VALUE);var de=this._binding.serviceIdentifier;return this.to(de)},pe.prototype.toConstantValue=function(de){return this._binding.type=_e.BindingTypeEnum.ConstantValue,this._binding.cache=de,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=_e.BindingScopeEnum.Singleton,new Re.BindingWhenOnSyntax(this._binding)},pe.prototype.toDynamicValue=function(de){return this._binding.type=_e.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=de,this._binding.implementationType=null,new g.BindingInWhenOnSyntax(this._binding)},pe.prototype.toConstructor=function(de){return this._binding.type=_e.BindingTypeEnum.Constructor,this._binding.implementationType=de,this._binding.scope=_e.BindingScopeEnum.Singleton,new Re.BindingWhenOnSyntax(this._binding)},pe.prototype.toFactory=function(de){return this._binding.type=_e.BindingTypeEnum.Factory,this._binding.factory=de,this._binding.scope=_e.BindingScopeEnum.Singleton,new Re.BindingWhenOnSyntax(this._binding)},pe.prototype.toFunction=function(de){if(typeof de!="function")throw new Error(Oe.INVALID_FUNCTION_BINDING);var Ne=this.toConstantValue(de);return this._binding.type=_e.BindingTypeEnum.Function,this._binding.scope=_e.BindingScopeEnum.Singleton,Ne},pe.prototype.toAutoFactory=function(de){return this._binding.type=_e.BindingTypeEnum.Factory,this._binding.factory=function(Ne){var xe=function(){return Ne.container.get(de)};return xe},this._binding.scope=_e.BindingScopeEnum.Singleton,new Re.BindingWhenOnSyntax(this._binding)},pe.prototype.toProvider=function(de){return this._binding.type=_e.BindingTypeEnum.Provider,this._binding.provider=de,this._binding.scope=_e.BindingScopeEnum.Singleton,new Re.BindingWhenOnSyntax(this._binding)},pe.prototype.toService=function(de){this.toDynamicValue(function(Ne){return Ne.container.get(de)})},pe}();ie.BindingToSyntax=X},71325:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.BindingWhenOnSyntax=void 0;var Oe=ee(51811),_e=ee(98370),g=function(){function Re(X){this._binding=X,this._bindingWhenSyntax=new _e.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Oe.BindingOnSyntax(this._binding)}return Re.prototype.when=function(X){return this._bindingWhenSyntax.when(X)},Re.prototype.whenTargetNamed=function(X){return this._bindingWhenSyntax.whenTargetNamed(X)},Re.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Re.prototype.whenTargetTagged=function(X,pe){return this._bindingWhenSyntax.whenTargetTagged(X,pe)},Re.prototype.whenInjectedInto=function(X){return this._bindingWhenSyntax.whenInjectedInto(X)},Re.prototype.whenParentNamed=function(X){return this._bindingWhenSyntax.whenParentNamed(X)},Re.prototype.whenParentTagged=function(X,pe){return this._bindingWhenSyntax.whenParentTagged(X,pe)},Re.prototype.whenAnyAncestorIs=function(X){return this._bindingWhenSyntax.whenAnyAncestorIs(X)},Re.prototype.whenNoAncestorIs=function(X){return this._bindingWhenSyntax.whenNoAncestorIs(X)},Re.prototype.whenAnyAncestorNamed=function(X){return this._bindingWhenSyntax.whenAnyAncestorNamed(X)},Re.prototype.whenAnyAncestorTagged=function(X,pe){return this._bindingWhenSyntax.whenAnyAncestorTagged(X,pe)},Re.prototype.whenNoAncestorNamed=function(X){return this._bindingWhenSyntax.whenNoAncestorNamed(X)},Re.prototype.whenNoAncestorTagged=function(X,pe){return this._bindingWhenSyntax.whenNoAncestorTagged(X,pe)},Re.prototype.whenAnyAncestorMatches=function(X){return this._bindingWhenSyntax.whenAnyAncestorMatches(X)},Re.prototype.whenNoAncestorMatches=function(X){return this._bindingWhenSyntax.whenNoAncestorMatches(X)},Re.prototype.onActivation=function(X){return this._bindingOnSyntax.onActivation(X)},Re}();ie.BindingWhenOnSyntax=g},98370:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.BindingWhenSyntax=void 0;var Oe=ee(51811),_e=ee(80758),g=function(){function Re(X){this._binding=X}return Re.prototype.when=function(X){return this._binding.constraint=X,new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenTargetNamed=function(X){return this._binding.constraint=_e.namedConstraint(X),new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(X){var pe=X.target!==null&&!X.target.isNamed()&&!X.target.isTagged();return pe},new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenTargetTagged=function(X,pe){return this._binding.constraint=_e.taggedConstraint(X)(pe),new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenInjectedInto=function(X){return this._binding.constraint=function(pe){return _e.typeConstraint(X)(pe.parentRequest)},new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenParentNamed=function(X){return this._binding.constraint=function(pe){return _e.namedConstraint(X)(pe.parentRequest)},new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenParentTagged=function(X,pe){return this._binding.constraint=function(de){return _e.taggedConstraint(X)(pe)(de.parentRequest)},new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenAnyAncestorIs=function(X){return this._binding.constraint=function(pe){return _e.traverseAncerstors(pe,_e.typeConstraint(X))},new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenNoAncestorIs=function(X){return this._binding.constraint=function(pe){return!_e.traverseAncerstors(pe,_e.typeConstraint(X))},new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenAnyAncestorNamed=function(X){return this._binding.constraint=function(pe){return _e.traverseAncerstors(pe,_e.namedConstraint(X))},new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenNoAncestorNamed=function(X){return this._binding.constraint=function(pe){return!_e.traverseAncerstors(pe,_e.namedConstraint(X))},new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenAnyAncestorTagged=function(X,pe){return this._binding.constraint=function(de){return _e.traverseAncerstors(de,_e.taggedConstraint(X)(pe))},new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenNoAncestorTagged=function(X,pe){return this._binding.constraint=function(de){return!_e.traverseAncerstors(de,_e.taggedConstraint(X)(pe))},new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenAnyAncestorMatches=function(X){return this._binding.constraint=function(pe){return _e.traverseAncerstors(pe,X)},new Oe.BindingOnSyntax(this._binding)},Re.prototype.whenNoAncestorMatches=function(X){return this._binding.constraint=function(pe){return!_e.traverseAncerstors(pe,X)},new Oe.BindingOnSyntax(this._binding)},Re}();ie.BindingWhenSyntax=g},80758:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.typeConstraint=ie.namedConstraint=ie.taggedConstraint=ie.traverseAncerstors=void 0;var Oe=ee(6867),_e=ee(47738),g=function(de,Ne){var xe=de.parentRequest;return xe!==null?Ne(xe)?!0:g(xe,Ne):!1};ie.traverseAncerstors=g;var Re=function(de){return function(Ne){var xe=function(tt){return tt!==null&&tt.target!==null&&tt.target.matchesTag(de)(Ne)};return xe.metaData=new _e.Metadata(de,Ne),xe}};ie.taggedConstraint=Re;var X=Re(Oe.NAMED_TAG);ie.namedConstraint=X;var pe=function(de){return function(Ne){var xe=null;if(Ne!==null)if(xe=Ne.bindings[0],typeof de=="string"){var tt=xe.serviceIdentifier;return tt===de}else{var dt=Ne.bindings[0].implementationType;return de===dt}return!1}};ie.typeConstraint=pe},70600:function(Tr,ie){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.multiBindToService=void 0;var ee=function(Oe){return function(_e){return function(){for(var g=[],Re=0;Re<arguments.length;Re++)g[Re]=arguments[Re];return g.forEach(function(X){return Oe.bind(X).toService(_e)})}}};ie.multiBindToService=ee},85265:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.isStackOverflowExeption=void 0;var Oe=ee(16674);function _e(g){return g instanceof RangeError||g.message===Oe.STACK_OVERFLOW}ie.isStackOverflowExeption=_e},37791:function(Tr,ie){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.id=void 0;var ee=0;function Oe(){return ee++}ie.id=Oe},55800:function(Tr,ie,ee){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.circularDependencyToException=ie.listMetadataForTarget=ie.listRegisteredBindingsForServiceIdentifier=ie.getServiceIdentifierAsString=ie.getFunctionName=void 0;var Oe=ee(16674);function _e(xe){if(typeof xe=="function"){var tt=xe;return tt.name}else{if(typeof xe=="symbol")return xe.toString();var tt=xe;return tt}}ie.getServiceIdentifierAsString=_e;function g(xe,tt,dt){var At="",tr=dt(xe,tt);return tr.length!==0&&(At=`
Registered bindings:`,tr.forEach(function(pr){var Lt="Object";pr.implementationType!==null&&(Lt=Ne(pr.implementationType)),At=At+`
 `+Lt,pr.constraint.metaData&&(At=At+" - "+pr.constraint.metaData)})),At}ie.listRegisteredBindingsForServiceIdentifier=g;function Re(xe,tt){return xe.parentRequest===null?!1:xe.parentRequest.serviceIdentifier===tt?!0:Re(xe.parentRequest,tt)}function X(xe){function tt(At,tr){tr===void 0&&(tr=[]);var pr=_e(At.serviceIdentifier);return tr.push(pr),At.parentRequest!==null?tt(At.parentRequest,tr):tr}var dt=tt(xe);return dt.reverse().join(" --> ")}function pe(xe){xe.childRequests.forEach(function(tt){if(Re(tt,tt.serviceIdentifier)){var dt=X(tt);throw new Error(Oe.CIRCULAR_DEPENDENCY+" "+dt)}else pe(tt)})}ie.circularDependencyToException=pe;function de(xe,tt){if(tt.isTagged()||tt.isNamed()){var dt="",At=tt.getNamedTag(),tr=tt.getCustomTags();return At!==null&&(dt+=At.toString()+`
`),tr!==null&&tr.forEach(function(pr){dt+=pr.toString()+`
`})," "+xe+`
 `+xe+" - "+dt}else return" "+xe}ie.listMetadataForTarget=de;function Ne(xe){if(xe.name)return xe.name;var tt=xe.toString(),dt=tt.match(/^function\s*([^\s(]+)/);return dt?dt[1]:"Anonymous function: "+tt}ie.getFunctionName=Ne},31745:function(Tr){"use strict";Tr.exports=ee,Tr.exports.default=ee;var ie=1e20;function ee(X,pe,de,Ne,xe,tt){this.fontSize=X||24,this.buffer=pe===void 0?3:pe,this.cutoff=Ne||.25,this.fontFamily=xe||"sans-serif",this.fontWeight=tt||"normal",this.radius=de||8;var dt=this.size=this.fontSize+this.buffer*2,At=dt+this.buffer*2,tr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;tr?this.canvas=my.createOffscreenCanvas(dt,dt,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=dt),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(At*At),this.gridInner=new Float64Array(At*At),this.f=new Float64Array(At),this.z=new Float64Array(At+1),this.v=new Uint16Array(At),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,tr?this.middle=Math.round(dt/2*1):this.middle=Math.round(dt/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Oe(X,pe,de,Ne,xe,tt,dt){tt.fill(ie,0,pe*de),dt.fill(0,0,pe*de);for(var At=(pe-Ne)/2,tr=0;tr<xe;tr++)for(var pr=0;pr<Ne;pr++){var Lt=(tr+At)*pe+pr+At,nr=X.data[4*(tr*Ne+pr)+3]/255;if(nr===1)tt[Lt]=0,dt[Lt]=ie;else if(nr===0)tt[Lt]=ie,dt[Lt]=0;else{var jt=Math.max(0,.5-nr),ht=Math.max(0,nr-.5);tt[Lt]=jt*jt,dt[Lt]=ht*ht}}}function _e(X,pe,de,Ne,xe,tt,dt){for(var At=0;At<pe*de;At++){var tr=Math.sqrt(Ne[At])-Math.sqrt(xe[At]);X[At]=Math.round(255-255*(tr/tt+dt))}}ee.prototype._draw=function(X,pe){var de=this.ctx.measureText(X),Ne=de.width,xe=2*this.buffer,tt,dt,At,tr,pr,Lt,nr,jt;pe&&this.useMetrics?(pr=Math.floor(de.actualBoundingBoxAscent),jt=this.buffer+Math.ceil(de.actualBoundingBoxAscent),Lt=this.buffer,nr=this.buffer,dt=Math.min(this.size,Math.ceil(de.actualBoundingBoxRight-de.actualBoundingBoxLeft)),tr=Math.min(this.size-Lt,Math.ceil(de.actualBoundingBoxAscent+de.actualBoundingBoxDescent)),tt=dt+xe,At=tr+xe,this.ctx.textBaseline="alphabetic"):(tt=dt=this.size,At=tr=this.size,pr=19*this.fontSize/24,Lt=nr=0,jt=this.middle,this.ctx.textBaseline="middle");var ht;dt&&tr&&(this.ctx.clearRect(nr,Lt,dt,tr),this.ctx.fillText(X,this.buffer,jt),ht=this.ctx.getImageData(nr,Lt,dt,tr));var gt=new Uint8ClampedArray(tt*At);return Oe(ht,tt,At,dt,tr,this.gridOuter,this.gridInner),g(this.gridOuter,tt,At,this.f,this.v,this.z),g(this.gridInner,tt,At,this.f,this.v,this.z),_e(gt,tt,At,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:gt,metrics:{width:dt,height:tr,sdfWidth:tt,sdfHeight:At,top:pr,left:0,advance:Ne}}},ee.prototype.draw=function(X){return this._draw(X,!1).data},ee.prototype.drawWithMetrics=function(X){return this._draw(X,!0)};function g(X,pe,de,Ne,xe,tt){for(var dt=0;dt<pe;dt++)Re(X,dt,pe,de,Ne,xe,tt);for(var At=0;At<de;At++)Re(X,At*pe,1,pe,Ne,xe,tt)}function Re(X,pe,de,Ne,xe,tt,dt){var At,tr,pr,Lt;for(tt[0]=0,dt[0]=-ie,dt[1]=ie,At=0;At<Ne;At++)xe[At]=X[pe+At*de];for(At=1,tr=0,pr=0;At<Ne;At++){do Lt=tt[tr],pr=(xe[At]-xe[Lt]+At*At-Lt*Lt)/(At-Lt)/2;while(pr<=dt[tr]&&--tr>-1);tr++,tt[tr]=At,dt[tr]=pr,dt[tr+1]=ie}for(At=0,tr=0;At<Ne;At++){for(;dt[tr+1]<At;)tr++;Lt=tt[tr],X[pe+At*de]=xe[Lt]+(At-Lt)*(At-Lt)}}},18857:function(Tr,ie,ee){"use strict";ee.r(ie),ee.d(ie,{Function:function(){return Ks},Interpreter:function(){return ya},default:function(){return dl},evaluate:function(){return Qu},vm:function(){return Oe}});var Oe={};ee.r(Oe),ee.d(Oe,{Script:function(){return ic},compileFunction:function(){return tf},createContext:function(){return us},runInContext:function(){return Ol},runInNewContext:function(){return qs}});var _e={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},g="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",Re={5:g,"5module":g+" export import",6:g+" const class extends export import super"},X=/^in(stanceof)?$/,pe="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",de="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Ne=new RegExp("["+pe+"]"),xe=new RegExp("["+pe+de+"]");pe=de=null;var tt=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],dt=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function At(_,M){for(var F=65536,R=0;R<M.length;R+=2){if(F+=M[R],F>_)return!1;if(F+=M[R+1],F>=_)return!0}}function tr(_,M){return _<65?_===36:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&Ne.test(String.fromCharCode(_)):M===!1?!1:At(_,tt)}function pr(_,M){return _<48?_===36:_<58?!0:_<65?!1:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&xe.test(String.fromCharCode(_)):M===!1?!1:At(_,tt)||At(_,dt)}var Lt=function(M,F){F===void 0&&(F={}),this.label=M,this.keyword=F.keyword,this.beforeExpr=!!F.beforeExpr,this.startsExpr=!!F.startsExpr,this.isLoop=!!F.isLoop,this.isAssign=!!F.isAssign,this.prefix=!!F.prefix,this.postfix=!!F.postfix,this.binop=F.binop||null,this.updateContext=null};function nr(_,M){return new Lt(_,{beforeExpr:!0,binop:M})}var jt={beforeExpr:!0},ht={startsExpr:!0},gt={};function sr(_,M){return M===void 0&&(M={}),M.keyword=_,gt[_]=new Lt(_,M)}var q={num:new Lt("num",ht),regexp:new Lt("regexp",ht),string:new Lt("string",ht),name:new Lt("name",ht),eof:new Lt("eof"),bracketL:new Lt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Lt("]"),braceL:new Lt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Lt("}"),parenL:new Lt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Lt(")"),comma:new Lt(",",jt),semi:new Lt(";",jt),colon:new Lt(":",jt),dot:new Lt("."),question:new Lt("?",jt),questionDot:new Lt("?."),arrow:new Lt("=>",jt),template:new Lt("template"),invalidTemplate:new Lt("invalidTemplate"),ellipsis:new Lt("...",jt),backQuote:new Lt("`",ht),dollarBraceL:new Lt("${",{beforeExpr:!0,startsExpr:!0}),eq:new Lt("=",{beforeExpr:!0,isAssign:!0}),assign:new Lt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Lt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Lt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:nr("||",1),logicalAND:nr("&&",2),bitwiseOR:nr("|",3),bitwiseXOR:nr("^",4),bitwiseAND:nr("&",5),equality:nr("==/!=/===/!==",6),relational:nr("</>/<=/>=",7),bitShift:nr("<</>>/>>>",8),plusMin:new Lt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:nr("%",10),star:nr("*",10),slash:nr("/",10),starstar:new Lt("**",{beforeExpr:!0}),coalesce:nr("??",1),_break:sr("break"),_case:sr("case",jt),_catch:sr("catch"),_continue:sr("continue"),_debugger:sr("debugger"),_default:sr("default",jt),_do:sr("do",{isLoop:!0,beforeExpr:!0}),_else:sr("else",jt),_finally:sr("finally"),_for:sr("for",{isLoop:!0}),_function:sr("function",ht),_if:sr("if"),_return:sr("return",jt),_switch:sr("switch"),_throw:sr("throw",jt),_try:sr("try"),_var:sr("var"),_const:sr("const"),_while:sr("while",{isLoop:!0}),_with:sr("with"),_new:sr("new",{beforeExpr:!0,startsExpr:!0}),_this:sr("this",ht),_super:sr("super",ht),_class:sr("class",ht),_extends:sr("extends",jt),_export:sr("export"),_import:sr("import",ht),_null:sr("null",ht),_true:sr("true",ht),_false:sr("false",ht),_in:sr("in",{beforeExpr:!0,binop:7}),_instanceof:sr("instanceof",{beforeExpr:!0,binop:7}),_typeof:sr("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:sr("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:sr("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Yt=/\r\n?|\n|\u2028|\u2029/,ct=new RegExp(Yt.source,"g");function Ke(_,M){return _===10||_===13||!M&&(_===8232||_===8233)}var wt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,et=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,qt=Object.prototype,Ar=qt.hasOwnProperty,Wr=qt.toString;function on(_,M){return Ar.call(_,M)}var A=Array.isArray||function(_){return Wr.call(_)==="[object Array]"};function Se(_){return new RegExp("^(?:"+_.replace(/ /g,"|")+")$")}var ke=function(M,F){this.line=M,this.column=F};ke.prototype.offset=function(M){return new ke(this.line,this.column+M)};var St=function(M,F,R){this.start=F,this.end=R,M.sourceFile!==null&&(this.source=M.sourceFile)};function vt(_,M){for(var F=1,R=0;;){ct.lastIndex=R;var Y=ct.exec(_);if(Y&&Y.index<M)++F,R=Y.index+Y[0].length;else return new ke(F,M-R)}}var Ft={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Wt(_){var M={};for(var F in Ft)M[F]=_&&on(_,F)?_[F]:Ft[F];if(M.ecmaVersion>=2015&&(M.ecmaVersion-=2009),M.allowReserved==null&&(M.allowReserved=M.ecmaVersion<5),A(M.onToken)){var R=M.onToken;M.onToken=function(Y){return R.push(Y)}}return A(M.onComment)&&(M.onComment=Er(M,M.onComment)),M}function Er(_,M){return function(F,R,Y,me,He,ut){var lt={type:F?"Block":"Line",value:R,start:Y,end:me};_.locations&&(lt.loc=new St(this,He,ut)),_.ranges&&(lt.range=[Y,me]),M.push(lt)}}var $n=1,_n=2,mi=$n|_n,Gn=4,ai=8,gi=16,Xn=32,yi=64,va=128;function Xi(_,M){return _n|(_?Gn:0)|(M?ai:0)}var Ri=0,Ji=1,ma=2,Do=3,Oa=4,xa=5,Ui=function(M,F,R){this.options=M=Wt(M),this.sourceFile=M.sourceFile,this.keywords=Se(Re[M.ecmaVersion>=6?6:M.sourceType==="module"?"5module":5]);var Y="";if(M.allowReserved!==!0){for(var me=M.ecmaVersion;!(Y=_e[me]);me--);M.sourceType==="module"&&(Y+=" await")}this.reservedWords=Se(Y);var He=(Y?Y+" ":"")+_e.strict;this.reservedWordsStrict=Se(He),this.reservedWordsStrictBind=Se(He+" "+_e.strictBind),this.input=String(F),this.containsEsc=!1,R?(this.pos=R,this.lineStart=this.input.lastIndexOf(`
`,R-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Yt).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=q.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=M.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&M.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope($n),this.regexpState=null},aa={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Ui.prototype.parse=function(){var M=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(M)},aa.inFunction.get=function(){return(this.currentVarScope().flags&_n)>0},aa.inGenerator.get=function(){return(this.currentVarScope().flags&ai)>0},aa.inAsync.get=function(){return(this.currentVarScope().flags&Gn)>0},aa.allowSuper.get=function(){return(this.currentThisScope().flags&yi)>0},aa.allowDirectSuper.get=function(){return(this.currentThisScope().flags&va)>0},aa.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Ui.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&_n)>0},Ui.extend=function(){for(var M=[],F=arguments.length;F--;)M[F]=arguments[F];for(var R=this,Y=0;Y<M.length;Y++)R=M[Y](R);return R},Ui.parse=function(M,F){return new this(F,M).parse()},Ui.parseExpressionAt=function(M,F,R){var Y=new this(R,M,F);return Y.nextToken(),Y.parseExpression()},Ui.tokenizer=function(M,F){return new this(F,M)},Object.defineProperties(Ui.prototype,aa);var ea=Ui.prototype,Os=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;ea.strictDirective=function(_){for(;;){et.lastIndex=_,_+=et.exec(this.input)[0].length;var M=Os.exec(this.input.slice(_));if(!M)return!1;if((M[1]||M[2])==="use strict"){et.lastIndex=_+M[0].length;var F=et.exec(this.input),R=F.index+F[0].length,Y=this.input.charAt(R);return Y===";"||Y==="}"||Yt.test(F[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(Y)||Y==="!"&&this.input.charAt(R+1)==="=")}_+=M[0].length,et.lastIndex=_,_+=et.exec(this.input)[0].length,this.input[_]===";"&&_++}},ea.eat=function(_){return this.type===_?(this.next(),!0):!1},ea.isContextual=function(_){return this.type===q.name&&this.value===_&&!this.containsEsc},ea.eatContextual=function(_){return this.isContextual(_)?(this.next(),!0):!1},ea.expectContextual=function(_){this.eatContextual(_)||this.unexpected()},ea.canInsertSemicolon=function(){return this.type===q.eof||this.type===q.braceR||Yt.test(this.input.slice(this.lastTokEnd,this.start))},ea.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},ea.semicolon=function(){!this.eat(q.semi)&&!this.insertSemicolon()&&this.unexpected()},ea.afterTrailingComma=function(_,M){if(this.type===_)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),M||this.next(),!0},ea.expect=function(_){this.eat(_)||this.unexpected()},ea.unexpected=function(_){this.raise(_!=null?_:this.start,"Unexpected token")};function fe(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}ea.checkPatternErrors=function(_,M){if(!!_){_.trailingComma>-1&&this.raiseRecoverable(_.trailingComma,"Comma is not permitted after the rest element");var F=M?_.parenthesizedAssign:_.parenthesizedBind;F>-1&&this.raiseRecoverable(F,"Parenthesized pattern")}},ea.checkExpressionErrors=function(_,M){if(!_)return!1;var F=_.shorthandAssign,R=_.doubleProto;if(!M)return F>=0||R>=0;F>=0&&this.raise(F,"Shorthand property assignments are valid only in destructuring patterns"),R>=0&&this.raiseRecoverable(R,"Redefinition of __proto__ property")},ea.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},ea.isSimpleAssignTarget=function(_){return _.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(_.expression):_.type==="Identifier"||_.type==="MemberExpression"};var oi=Ui.prototype;oi.parseTopLevel=function(_){var M={};for(_.body||(_.body=[]);this.type!==q.eof;){var F=this.parseStatement(null,!0,M);_.body.push(F)}if(this.inModule)for(var R=0,Y=Object.keys(this.undefinedExports);R<Y.length;R+=1){var me=Y[R];this.raiseRecoverable(this.undefinedExports[me].start,"Export '"+me+"' is not defined")}return this.adaptDirectivePrologue(_.body),this.next(),_.sourceType=this.options.sourceType,this.finishNode(_,"Program")};var xo={kind:"loop"},au={kind:"switch"};oi.isLet=function(_){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;et.lastIndex=this.pos;var M=et.exec(this.input),F=this.pos+M[0].length,R=this.input.charCodeAt(F);if(R===91)return!0;if(_)return!1;if(R===123)return!0;if(tr(R,!0)){for(var Y=F+1;pr(this.input.charCodeAt(Y),!0);)++Y;var me=this.input.slice(F,Y);if(!X.test(me))return!0}return!1},oi.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;et.lastIndex=this.pos;var _=et.exec(this.input),M=this.pos+_[0].length;return!Yt.test(this.input.slice(this.pos,M))&&this.input.slice(M,M+8)==="function"&&(M+8===this.input.length||!pr(this.input.charAt(M+8)))},oi.parseStatement=function(_,M,F){var R=this.type,Y=this.startNode(),me;switch(this.isLet(_)&&(R=q._var,me="let"),R){case q._break:case q._continue:return this.parseBreakContinueStatement(Y,R.keyword);case q._debugger:return this.parseDebuggerStatement(Y);case q._do:return this.parseDoStatement(Y);case q._for:return this.parseForStatement(Y);case q._function:return _&&(this.strict||_!=="if"&&_!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(Y,!1,!_);case q._class:return _&&this.unexpected(),this.parseClass(Y,!0);case q._if:return this.parseIfStatement(Y);case q._return:return this.parseReturnStatement(Y);case q._switch:return this.parseSwitchStatement(Y);case q._throw:return this.parseThrowStatement(Y);case q._try:return this.parseTryStatement(Y);case q._const:case q._var:return me=me||this.value,_&&me!=="var"&&this.unexpected(),this.parseVarStatement(Y,me);case q._while:return this.parseWhileStatement(Y);case q._with:return this.parseWithStatement(Y);case q.braceL:return this.parseBlock(!0,Y);case q.semi:return this.parseEmptyStatement(Y);case q._export:case q._import:if(this.options.ecmaVersion>10&&R===q._import){et.lastIndex=this.pos;var He=et.exec(this.input),ut=this.pos+He[0].length,lt=this.input.charCodeAt(ut);if(lt===40||lt===46)return this.parseExpressionStatement(Y,this.parseExpression())}return this.options.allowImportExportEverywhere||(M||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),R===q._import?this.parseImport(Y):this.parseExport(Y,F);default:if(this.isAsyncFunction())return _&&this.unexpected(),this.next(),this.parseFunctionStatement(Y,!0,!_);var ir=this.value,ur=this.parseExpression();return R===q.name&&ur.type==="Identifier"&&this.eat(q.colon)?this.parseLabeledStatement(Y,ir,ur,_):this.parseExpressionStatement(Y,ur)}},oi.parseBreakContinueStatement=function(_,M){var F=M==="break";this.next(),this.eat(q.semi)||this.insertSemicolon()?_.label=null:this.type!==q.name?this.unexpected():(_.label=this.parseIdent(),this.semicolon());for(var R=0;R<this.labels.length;++R){var Y=this.labels[R];if((_.label==null||Y.name===_.label.name)&&(Y.kind!=null&&(F||Y.kind==="loop")||_.label&&F))break}return R===this.labels.length&&this.raise(_.start,"Unsyntactic "+M),this.finishNode(_,F?"BreakStatement":"ContinueStatement")},oi.parseDebuggerStatement=function(_){return this.next(),this.semicolon(),this.finishNode(_,"DebuggerStatement")},oi.parseDoStatement=function(_){return this.next(),this.labels.push(xo),_.body=this.parseStatement("do"),this.labels.pop(),this.expect(q._while),_.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(q.semi):this.semicolon(),this.finishNode(_,"DoWhileStatement")},oi.parseForStatement=function(_){this.next();var M=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(xo),this.enterScope(0),this.expect(q.parenL),this.type===q.semi)return M>-1&&this.unexpected(M),this.parseFor(_,null);var F=this.isLet();if(this.type===q._var||this.type===q._const||F){var R=this.startNode(),Y=F?"let":this.value;return this.next(),this.parseVar(R,!0,Y),this.finishNode(R,"VariableDeclaration"),(this.type===q._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&R.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===q._in?M>-1&&this.unexpected(M):_.await=M>-1),this.parseForIn(_,R)):(M>-1&&this.unexpected(M),this.parseFor(_,R))}var me=new fe,He=this.parseExpression(!0,me);return this.type===q._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===q._in?M>-1&&this.unexpected(M):_.await=M>-1),this.toAssignable(He,!1,me),this.checkLVal(He),this.parseForIn(_,He)):(this.checkExpressionErrors(me,!0),M>-1&&this.unexpected(M),this.parseFor(_,He))},oi.parseFunctionStatement=function(_,M,F){return this.next(),this.parseFunction(_,Jt|(F?0:Dr),!1,M)},oi.parseIfStatement=function(_){return this.next(),_.test=this.parseParenExpression(),_.consequent=this.parseStatement("if"),_.alternate=this.eat(q._else)?this.parseStatement("if"):null,this.finishNode(_,"IfStatement")},oi.parseReturnStatement=function(_){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(q.semi)||this.insertSemicolon()?_.argument=null:(_.argument=this.parseExpression(),this.semicolon()),this.finishNode(_,"ReturnStatement")},oi.parseSwitchStatement=function(_){this.next(),_.discriminant=this.parseParenExpression(),_.cases=[],this.expect(q.braceL),this.labels.push(au),this.enterScope(0);for(var M,F=!1;this.type!==q.braceR;)if(this.type===q._case||this.type===q._default){var R=this.type===q._case;M&&this.finishNode(M,"SwitchCase"),_.cases.push(M=this.startNode()),M.consequent=[],this.next(),R?M.test=this.parseExpression():(F&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),F=!0,M.test=null),this.expect(q.colon)}else M||this.unexpected(),M.consequent.push(this.parseStatement(null));return this.exitScope(),M&&this.finishNode(M,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(_,"SwitchStatement")},oi.parseThrowStatement=function(_){return this.next(),Yt.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),_.argument=this.parseExpression(),this.semicolon(),this.finishNode(_,"ThrowStatement")};var Nt=[];oi.parseTryStatement=function(_){if(this.next(),_.block=this.parseBlock(),_.handler=null,this.type===q._catch){var M=this.startNode();if(this.next(),this.eat(q.parenL)){M.param=this.parseBindingAtom();var F=M.param.type==="Identifier";this.enterScope(F?Xn:0),this.checkLVal(M.param,F?Oa:ma),this.expect(q.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),M.param=null,this.enterScope(0);M.body=this.parseBlock(!1),this.exitScope(),_.handler=this.finishNode(M,"CatchClause")}return _.finalizer=this.eat(q._finally)?this.parseBlock():null,!_.handler&&!_.finalizer&&this.raise(_.start,"Missing catch or finally clause"),this.finishNode(_,"TryStatement")},oi.parseVarStatement=function(_,M){return this.next(),this.parseVar(_,!1,M),this.semicolon(),this.finishNode(_,"VariableDeclaration")},oi.parseWhileStatement=function(_){return this.next(),_.test=this.parseParenExpression(),this.labels.push(xo),_.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(_,"WhileStatement")},oi.parseWithStatement=function(_){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),_.object=this.parseParenExpression(),_.body=this.parseStatement("with"),this.finishNode(_,"WithStatement")},oi.parseEmptyStatement=function(_){return this.next(),this.finishNode(_,"EmptyStatement")},oi.parseLabeledStatement=function(_,M,F,R){for(var Y=0,me=this.labels;Y<me.length;Y+=1){var He=me[Y];He.name===M&&this.raise(F.start,"Label '"+M+"' is already declared")}for(var ut=this.type.isLoop?"loop":this.type===q._switch?"switch":null,lt=this.labels.length-1;lt>=0;lt--){var ir=this.labels[lt];if(ir.statementStart===_.start)ir.statementStart=this.start,ir.kind=ut;else break}return this.labels.push({name:M,kind:ut,statementStart:this.start}),_.body=this.parseStatement(R?R.indexOf("label")===-1?R+"label":R:"label"),this.labels.pop(),_.label=F,this.finishNode(_,"LabeledStatement")},oi.parseExpressionStatement=function(_,M){return _.expression=M,this.semicolon(),this.finishNode(_,"ExpressionStatement")},oi.parseBlock=function(_,M,F){for(_===void 0&&(_=!0),M===void 0&&(M=this.startNode()),M.body=[],this.expect(q.braceL),_&&this.enterScope(0);this.type!==q.braceR;){var R=this.parseStatement(null);M.body.push(R)}return F&&(this.strict=!1),this.next(),_&&this.exitScope(),this.finishNode(M,"BlockStatement")},oi.parseFor=function(_,M){return _.init=M,this.expect(q.semi),_.test=this.type===q.semi?null:this.parseExpression(),this.expect(q.semi),_.update=this.type===q.parenR?null:this.parseExpression(),this.expect(q.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,"ForStatement")},oi.parseForIn=function(_,M){var F=this.type===q._in;return this.next(),M.type==="VariableDeclaration"&&M.declarations[0].init!=null&&(!F||this.options.ecmaVersion<8||this.strict||M.kind!=="var"||M.declarations[0].id.type!=="Identifier")?this.raise(M.start,(F?"for-in":"for-of")+" loop variable declaration may not have an initializer"):M.type==="AssignmentPattern"&&this.raise(M.start,"Invalid left-hand side in for-loop"),_.left=M,_.right=F?this.parseExpression():this.parseMaybeAssign(),this.expect(q.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,F?"ForInStatement":"ForOfStatement")},oi.parseVar=function(_,M,F){for(_.declarations=[],_.kind=F;;){var R=this.startNode();if(this.parseVarId(R,F),this.eat(q.eq)?R.init=this.parseMaybeAssign(M):F==="const"&&!(this.type===q._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():R.id.type!=="Identifier"&&!(M&&(this.type===q._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):R.init=null,_.declarations.push(this.finishNode(R,"VariableDeclarator")),!this.eat(q.comma))break}return _},oi.parseVarId=function(_,M){_.id=this.parseBindingAtom(),this.checkLVal(_.id,M==="var"?Ji:ma,!1)};var Jt=1,Dr=2,cn=4;oi.parseFunction=function(_,M,F,R){this.initFunction(_),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!R)&&(this.type===q.star&&M&Dr&&this.unexpected(),_.generator=this.eat(q.star)),this.options.ecmaVersion>=8&&(_.async=!!R),M&Jt&&(_.id=M&cn&&this.type!==q.name?null:this.parseIdent(),_.id&&!(M&Dr)&&this.checkLVal(_.id,this.strict||_.generator||_.async?this.treatFunctionsAsVar?Ji:ma:Do));var Y=this.yieldPos,me=this.awaitPos,He=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Xi(_.async,_.generator)),M&Jt||(_.id=this.type===q.name?this.parseIdent():null),this.parseFunctionParams(_),this.parseFunctionBody(_,F,!1),this.yieldPos=Y,this.awaitPos=me,this.awaitIdentPos=He,this.finishNode(_,M&Jt?"FunctionDeclaration":"FunctionExpression")},oi.parseFunctionParams=function(_){this.expect(q.parenL),_.params=this.parseBindingList(q.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},oi.parseClass=function(_,M){this.next();var F=this.strict;this.strict=!0,this.parseClassId(_,M),this.parseClassSuper(_);var R=this.startNode(),Y=!1;for(R.body=[],this.expect(q.braceL);this.type!==q.braceR;){var me=this.parseClassElement(_.superClass!==null);me&&(R.body.push(me),me.type==="MethodDefinition"&&me.kind==="constructor"&&(Y&&this.raise(me.start,"Duplicate constructor in the same class"),Y=!0))}return this.strict=F,this.next(),_.body=this.finishNode(R,"ClassBody"),this.finishNode(_,M?"ClassDeclaration":"ClassExpression")},oi.parseClassElement=function(_){var M=this;if(this.eat(q.semi))return null;var F=this.startNode(),R=function(lt,ir){ir===void 0&&(ir=!1);var ur=M.start,Tn=M.startLoc;return M.eatContextual(lt)?M.type!==q.parenL&&(!ir||!M.canInsertSemicolon())?!0:(F.key&&M.unexpected(),F.computed=!1,F.key=M.startNodeAt(ur,Tn),F.key.name=lt,M.finishNode(F.key,"Identifier"),!1):!1};F.kind="method",F.static=R("static");var Y=this.eat(q.star),me=!1;Y||(this.options.ecmaVersion>=8&&R("async",!0)?(me=!0,Y=this.options.ecmaVersion>=9&&this.eat(q.star)):R("get")?F.kind="get":R("set")&&(F.kind="set")),F.key||this.parsePropertyName(F);var He=F.key,ut=!1;return!F.computed&&!F.static&&(He.type==="Identifier"&&He.name==="constructor"||He.type==="Literal"&&He.value==="constructor")?(F.kind!=="method"&&this.raise(He.start,"Constructor can't have get/set modifier"),Y&&this.raise(He.start,"Constructor can't be a generator"),me&&this.raise(He.start,"Constructor can't be an async method"),F.kind="constructor",ut=_):F.static&&He.type==="Identifier"&&He.name==="prototype"&&this.raise(He.start,"Classes may not have a static property named prototype"),this.parseClassMethod(F,Y,me,ut),F.kind==="get"&&F.value.params.length!==0&&this.raiseRecoverable(F.value.start,"getter should have no params"),F.kind==="set"&&F.value.params.length!==1&&this.raiseRecoverable(F.value.start,"setter should have exactly one param"),F.kind==="set"&&F.value.params[0].type==="RestElement"&&this.raiseRecoverable(F.value.params[0].start,"Setter cannot use rest params"),F},oi.parseClassMethod=function(_,M,F,R){return _.value=this.parseMethod(M,F,R),this.finishNode(_,"MethodDefinition")},oi.parseClassId=function(_,M){this.type===q.name?(_.id=this.parseIdent(),M&&this.checkLVal(_.id,ma,!1)):(M===!0&&this.unexpected(),_.id=null)},oi.parseClassSuper=function(_){_.superClass=this.eat(q._extends)?this.parseExprSubscripts():null},oi.parseExport=function(_,M){if(this.next(),this.eat(q.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(_.exported=this.parseIdent(!0),this.checkExport(M,_.exported.name,this.lastTokStart)):_.exported=null),this.expectContextual("from"),this.type!==q.string&&this.unexpected(),_.source=this.parseExprAtom(),this.semicolon(),this.finishNode(_,"ExportAllDeclaration");if(this.eat(q._default)){this.checkExport(M,"default",this.lastTokStart);var F;if(this.type===q._function||(F=this.isAsyncFunction())){var R=this.startNode();this.next(),F&&this.next(),_.declaration=this.parseFunction(R,Jt|cn,!1,F)}else if(this.type===q._class){var Y=this.startNode();_.declaration=this.parseClass(Y,"nullableID")}else _.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(_,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())_.declaration=this.parseStatement(null),_.declaration.type==="VariableDeclaration"?this.checkVariableExport(M,_.declaration.declarations):this.checkExport(M,_.declaration.id.name,_.declaration.id.start),_.specifiers=[],_.source=null;else{if(_.declaration=null,_.specifiers=this.parseExportSpecifiers(M),this.eatContextual("from"))this.type!==q.string&&this.unexpected(),_.source=this.parseExprAtom();else{for(var me=0,He=_.specifiers;me<He.length;me+=1){var ut=He[me];this.checkUnreserved(ut.local),this.checkLocalExport(ut.local)}_.source=null}this.semicolon()}return this.finishNode(_,"ExportNamedDeclaration")},oi.checkExport=function(_,M,F){!_||(on(_,M)&&this.raiseRecoverable(F,"Duplicate export '"+M+"'"),_[M]=!0)},oi.checkPatternExport=function(_,M){var F=M.type;if(F==="Identifier")this.checkExport(_,M.name,M.start);else if(F==="ObjectPattern")for(var R=0,Y=M.properties;R<Y.length;R+=1){var me=Y[R];this.checkPatternExport(_,me)}else if(F==="ArrayPattern")for(var He=0,ut=M.elements;He<ut.length;He+=1){var lt=ut[He];lt&&this.checkPatternExport(_,lt)}else F==="Property"?this.checkPatternExport(_,M.value):F==="AssignmentPattern"?this.checkPatternExport(_,M.left):F==="RestElement"?this.checkPatternExport(_,M.argument):F==="ParenthesizedExpression"&&this.checkPatternExport(_,M.expression)},oi.checkVariableExport=function(_,M){if(!!_)for(var F=0,R=M;F<R.length;F+=1){var Y=R[F];this.checkPatternExport(_,Y.id)}},oi.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},oi.parseExportSpecifiers=function(_){var M=[],F=!0;for(this.expect(q.braceL);!this.eat(q.braceR);){if(F)F=!1;else if(this.expect(q.comma),this.afterTrailingComma(q.braceR))break;var R=this.startNode();R.local=this.parseIdent(!0),R.exported=this.eatContextual("as")?this.parseIdent(!0):R.local,this.checkExport(_,R.exported.name,R.exported.start),M.push(this.finishNode(R,"ExportSpecifier"))}return M},oi.parseImport=function(_){return this.next(),this.type===q.string?(_.specifiers=Nt,_.source=this.parseExprAtom()):(_.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),_.source=this.type===q.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(_,"ImportDeclaration")},oi.parseImportSpecifiers=function(){var _=[],M=!0;if(this.type===q.name){var F=this.startNode();if(F.local=this.parseIdent(),this.checkLVal(F.local,ma),_.push(this.finishNode(F,"ImportDefaultSpecifier")),!this.eat(q.comma))return _}if(this.type===q.star){var R=this.startNode();return this.next(),this.expectContextual("as"),R.local=this.parseIdent(),this.checkLVal(R.local,ma),_.push(this.finishNode(R,"ImportNamespaceSpecifier")),_}for(this.expect(q.braceL);!this.eat(q.braceR);){if(M)M=!1;else if(this.expect(q.comma),this.afterTrailingComma(q.braceR))break;var Y=this.startNode();Y.imported=this.parseIdent(!0),this.eatContextual("as")?Y.local=this.parseIdent():(this.checkUnreserved(Y.imported),Y.local=Y.imported),this.checkLVal(Y.local,ma),_.push(this.finishNode(Y,"ImportSpecifier"))}return _},oi.adaptDirectivePrologue=function(_){for(var M=0;M<_.length&&this.isDirectiveCandidate(_[M]);++M)_[M].directive=_[M].expression.raw.slice(1,-1)},oi.isDirectiveCandidate=function(_){return _.type==="ExpressionStatement"&&_.expression.type==="Literal"&&typeof _.expression.value=="string"&&(this.input[_.start]==='"'||this.input[_.start]==="'")};var wn=Ui.prototype;wn.toAssignable=function(_,M,F){if(this.options.ecmaVersion>=6&&_)switch(_.type){case"Identifier":this.inAsync&&_.name==="await"&&this.raise(_.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":_.type="ObjectPattern",F&&this.checkPatternErrors(F,!0);for(var R=0,Y=_.properties;R<Y.length;R+=1){var me=Y[R];this.toAssignable(me,M),me.type==="RestElement"&&(me.argument.type==="ArrayPattern"||me.argument.type==="ObjectPattern")&&this.raise(me.argument.start,"Unexpected token")}break;case"Property":_.kind!=="init"&&this.raise(_.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(_.value,M);break;case"ArrayExpression":_.type="ArrayPattern",F&&this.checkPatternErrors(F,!0),this.toAssignableList(_.elements,M);break;case"SpreadElement":_.type="RestElement",this.toAssignable(_.argument,M),_.argument.type==="AssignmentPattern"&&this.raise(_.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":_.operator!=="="&&this.raise(_.left.end,"Only '=' operator can be used for specifying default value."),_.type="AssignmentPattern",delete _.operator,this.toAssignable(_.left,M);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(_.expression,M,F);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!M)break;default:this.raise(_.start,"Assigning to rvalue")}else F&&this.checkPatternErrors(F,!0);return _},wn.toAssignableList=function(_,M){for(var F=_.length,R=0;R<F;R++){var Y=_[R];Y&&this.toAssignable(Y,M)}if(F){var me=_[F-1];this.options.ecmaVersion===6&&M&&me&&me.type==="RestElement"&&me.argument.type!=="Identifier"&&this.unexpected(me.argument.start)}return _},wn.parseSpread=function(_){var M=this.startNode();return this.next(),M.argument=this.parseMaybeAssign(!1,_),this.finishNode(M,"SpreadElement")},wn.parseRestBinding=function(){var _=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==q.name&&this.unexpected(),_.argument=this.parseBindingAtom(),this.finishNode(_,"RestElement")},wn.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case q.bracketL:var _=this.startNode();return this.next(),_.elements=this.parseBindingList(q.bracketR,!0,!0),this.finishNode(_,"ArrayPattern");case q.braceL:return this.parseObj(!0)}return this.parseIdent()},wn.parseBindingList=function(_,M,F){for(var R=[],Y=!0;!this.eat(_);)if(Y?Y=!1:this.expect(q.comma),M&&this.type===q.comma)R.push(null);else{if(F&&this.afterTrailingComma(_))break;if(this.type===q.ellipsis){var me=this.parseRestBinding();this.parseBindingListItem(me),R.push(me),this.type===q.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(_);break}else{var He=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(He),R.push(He)}}return R},wn.parseBindingListItem=function(_){return _},wn.parseMaybeDefault=function(_,M,F){if(F=F||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(q.eq))return F;var R=this.startNodeAt(_,M);return R.left=F,R.right=this.parseMaybeAssign(),this.finishNode(R,"AssignmentPattern")},wn.checkLVal=function(_,M,F){switch(M===void 0&&(M=Ri),_.type){case"Identifier":M===ma&&_.name==="let"&&this.raiseRecoverable(_.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(_.name)&&this.raiseRecoverable(_.start,(M?"Binding ":"Assigning to ")+_.name+" in strict mode"),F&&(on(F,_.name)&&this.raiseRecoverable(_.start,"Argument name clash"),F[_.name]=!0),M!==Ri&&M!==xa&&this.declareName(_.name,M,_.start);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":M&&this.raiseRecoverable(_.start,"Binding member expression");break;case"ObjectPattern":for(var R=0,Y=_.properties;R<Y.length;R+=1){var me=Y[R];this.checkLVal(me,M,F)}break;case"Property":this.checkLVal(_.value,M,F);break;case"ArrayPattern":for(var He=0,ut=_.elements;He<ut.length;He+=1){var lt=ut[He];lt&&this.checkLVal(lt,M,F)}break;case"AssignmentPattern":this.checkLVal(_.left,M,F);break;case"RestElement":this.checkLVal(_.argument,M,F);break;case"ParenthesizedExpression":this.checkLVal(_.expression,M,F);break;default:this.raise(_.start,(M?"Binding":"Assigning to")+" rvalue")}};var Nn=Ui.prototype;Nn.checkPropClash=function(_,M,F){if(!(this.options.ecmaVersion>=9&&_.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(_.computed||_.method||_.shorthand))){var R=_.key,Y;switch(R.type){case"Identifier":Y=R.name;break;case"Literal":Y=String(R.value);break;default:return}var me=_.kind;if(this.options.ecmaVersion>=6){Y==="__proto__"&&me==="init"&&(M.proto&&(F?F.doubleProto<0&&(F.doubleProto=R.start):this.raiseRecoverable(R.start,"Redefinition of __proto__ property")),M.proto=!0);return}Y="$"+Y;var He=M[Y];if(He){var ut;me==="init"?ut=this.strict&&He.init||He.get||He.set:ut=He.init||He[me],ut&&this.raiseRecoverable(R.start,"Redefinition of property")}else He=M[Y]={init:!1,get:!1,set:!1};He[me]=!0}},Nn.parseExpression=function(_,M){var F=this.start,R=this.startLoc,Y=this.parseMaybeAssign(_,M);if(this.type===q.comma){var me=this.startNodeAt(F,R);for(me.expressions=[Y];this.eat(q.comma);)me.expressions.push(this.parseMaybeAssign(_,M));return this.finishNode(me,"SequenceExpression")}return Y},Nn.parseMaybeAssign=function(_,M,F){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(_);this.exprAllowed=!1}var R=!1,Y=-1,me=-1;M?(Y=M.parenthesizedAssign,me=M.trailingComma,M.parenthesizedAssign=M.trailingComma=-1):(M=new fe,R=!0);var He=this.start,ut=this.startLoc;(this.type===q.parenL||this.type===q.name)&&(this.potentialArrowAt=this.start);var lt=this.parseMaybeConditional(_,M);if(F&&(lt=F.call(this,lt,He,ut)),this.type.isAssign){var ir=this.startNodeAt(He,ut);return ir.operator=this.value,ir.left=this.type===q.eq?this.toAssignable(lt,!1,M):lt,R||(M.parenthesizedAssign=M.trailingComma=M.doubleProto=-1),M.shorthandAssign>=ir.left.start&&(M.shorthandAssign=-1),this.checkLVal(lt),this.next(),ir.right=this.parseMaybeAssign(_),this.finishNode(ir,"AssignmentExpression")}else R&&this.checkExpressionErrors(M,!0);return Y>-1&&(M.parenthesizedAssign=Y),me>-1&&(M.trailingComma=me),lt},Nn.parseMaybeConditional=function(_,M){var F=this.start,R=this.startLoc,Y=this.parseExprOps(_,M);if(this.checkExpressionErrors(M))return Y;if(this.eat(q.question)){var me=this.startNodeAt(F,R);return me.test=Y,me.consequent=this.parseMaybeAssign(),this.expect(q.colon),me.alternate=this.parseMaybeAssign(_),this.finishNode(me,"ConditionalExpression")}return Y},Nn.parseExprOps=function(_,M){var F=this.start,R=this.startLoc,Y=this.parseMaybeUnary(M,!1);return this.checkExpressionErrors(M)||Y.start===F&&Y.type==="ArrowFunctionExpression"?Y:this.parseExprOp(Y,F,R,-1,_)},Nn.parseExprOp=function(_,M,F,R,Y){var me=this.type.binop;if(me!=null&&(!Y||this.type!==q._in)&&me>R){var He=this.type===q.logicalOR||this.type===q.logicalAND,ut=this.type===q.coalesce;ut&&(me=q.logicalAND.binop);var lt=this.value;this.next();var ir=this.start,ur=this.startLoc,Tn=this.parseExprOp(this.parseMaybeUnary(null,!1),ir,ur,me,Y),ri=this.buildBinary(M,F,_,Tn,lt,He||ut);return(He&&this.type===q.coalesce||ut&&(this.type===q.logicalOR||this.type===q.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(ri,M,F,R,Y)}return _},Nn.buildBinary=function(_,M,F,R,Y,me){var He=this.startNodeAt(_,M);return He.left=F,He.operator=Y,He.right=R,this.finishNode(He,me?"LogicalExpression":"BinaryExpression")},Nn.parseMaybeUnary=function(_,M){var F=this.start,R=this.startLoc,Y;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))Y=this.parseAwait(),M=!0;else if(this.type.prefix){var me=this.startNode(),He=this.type===q.incDec;me.operator=this.value,me.prefix=!0,this.next(),me.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(_,!0),He?this.checkLVal(me.argument):this.strict&&me.operator==="delete"&&me.argument.type==="Identifier"?this.raiseRecoverable(me.start,"Deleting local variable in strict mode"):M=!0,Y=this.finishNode(me,He?"UpdateExpression":"UnaryExpression")}else{if(Y=this.parseExprSubscripts(_),this.checkExpressionErrors(_))return Y;for(;this.type.postfix&&!this.canInsertSemicolon();){var ut=this.startNodeAt(F,R);ut.operator=this.value,ut.prefix=!1,ut.argument=Y,this.checkLVal(Y),this.next(),Y=this.finishNode(ut,"UpdateExpression")}}return!M&&this.eat(q.starstar)?this.buildBinary(F,R,Y,this.parseMaybeUnary(null,!1),"**",!1):Y},Nn.parseExprSubscripts=function(_){var M=this.start,F=this.startLoc,R=this.parseExprAtom(_);if(R.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return R;var Y=this.parseSubscripts(R,M,F);return _&&Y.type==="MemberExpression"&&(_.parenthesizedAssign>=Y.start&&(_.parenthesizedAssign=-1),_.parenthesizedBind>=Y.start&&(_.parenthesizedBind=-1)),Y},Nn.parseSubscripts=function(_,M,F,R){for(var Y=this.options.ecmaVersion>=8&&_.type==="Identifier"&&_.name==="async"&&this.lastTokEnd===_.end&&!this.canInsertSemicolon()&&_.end-_.start==5&&this.potentialArrowAt===_.start,me=!1;;){var He=this.parseSubscript(_,M,F,R,Y,me);if(He.optional&&(me=!0),He===_||He.type==="ArrowFunctionExpression"){if(me){var ut=this.startNodeAt(M,F);ut.expression=He,He=this.finishNode(ut,"ChainExpression")}return He}_=He}},Nn.parseSubscript=function(_,M,F,R,Y,me){var He=this.options.ecmaVersion>=11,ut=He&&this.eat(q.questionDot);R&&ut&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var lt=this.eat(q.bracketL);if(lt||ut&&this.type!==q.parenL&&this.type!==q.backQuote||this.eat(q.dot)){var ir=this.startNodeAt(M,F);ir.object=_,ir.property=lt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),ir.computed=!!lt,lt&&this.expect(q.bracketR),He&&(ir.optional=ut),_=this.finishNode(ir,"MemberExpression")}else if(!R&&this.eat(q.parenL)){var ur=new fe,Tn=this.yieldPos,ri=this.awaitPos,Ln=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Vi=this.parseExprList(q.parenR,this.options.ecmaVersion>=8,!1,ur);if(Y&&!ut&&!this.canInsertSemicolon()&&this.eat(q.arrow))return this.checkPatternErrors(ur,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Tn,this.awaitPos=ri,this.awaitIdentPos=Ln,this.parseArrowExpression(this.startNodeAt(M,F),Vi,!0);this.checkExpressionErrors(ur,!0),this.yieldPos=Tn||this.yieldPos,this.awaitPos=ri||this.awaitPos,this.awaitIdentPos=Ln||this.awaitIdentPos;var pa=this.startNodeAt(M,F);pa.callee=_,pa.arguments=Vi,He&&(pa.optional=ut),_=this.finishNode(pa,"CallExpression")}else if(this.type===q.backQuote){(ut||me)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Ea=this.startNodeAt(M,F);Ea.tag=_,Ea.quasi=this.parseTemplate({isTagged:!0}),_=this.finishNode(Ea,"TaggedTemplateExpression")}return _},Nn.parseExprAtom=function(_){this.type===q.slash&&this.readRegexp();var M,F=this.potentialArrowAt===this.start;switch(this.type){case q._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),M=this.startNode(),this.next(),this.type===q.parenL&&!this.allowDirectSuper&&this.raise(M.start,"super() call outside constructor of a subclass"),this.type!==q.dot&&this.type!==q.bracketL&&this.type!==q.parenL&&this.unexpected(),this.finishNode(M,"Super");case q._this:return M=this.startNode(),this.next(),this.finishNode(M,"ThisExpression");case q.name:var R=this.start,Y=this.startLoc,me=this.containsEsc,He=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!me&&He.name==="async"&&!this.canInsertSemicolon()&&this.eat(q._function))return this.parseFunction(this.startNodeAt(R,Y),0,!1,!0);if(F&&!this.canInsertSemicolon()){if(this.eat(q.arrow))return this.parseArrowExpression(this.startNodeAt(R,Y),[He],!1);if(this.options.ecmaVersion>=8&&He.name==="async"&&this.type===q.name&&!me)return He=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(q.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(R,Y),[He],!0)}return He;case q.regexp:var ut=this.value;return M=this.parseLiteral(ut.value),M.regex={pattern:ut.pattern,flags:ut.flags},M;case q.num:case q.string:return this.parseLiteral(this.value);case q._null:case q._true:case q._false:return M=this.startNode(),M.value=this.type===q._null?null:this.type===q._true,M.raw=this.type.keyword,this.next(),this.finishNode(M,"Literal");case q.parenL:var lt=this.start,ir=this.parseParenAndDistinguishExpression(F);return _&&(_.parenthesizedAssign<0&&!this.isSimpleAssignTarget(ir)&&(_.parenthesizedAssign=lt),_.parenthesizedBind<0&&(_.parenthesizedBind=lt)),ir;case q.bracketL:return M=this.startNode(),this.next(),M.elements=this.parseExprList(q.bracketR,!0,!0,_),this.finishNode(M,"ArrayExpression");case q.braceL:return this.parseObj(!1,_);case q._function:return M=this.startNode(),this.next(),this.parseFunction(M,0);case q._class:return this.parseClass(this.startNode(),!1);case q._new:return this.parseNew();case q.backQuote:return this.parseTemplate();case q._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Nn.parseExprImport=function(){var _=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var M=this.parseIdent(!0);switch(this.type){case q.parenL:return this.parseDynamicImport(_);case q.dot:return _.meta=M,this.parseImportMeta(_);default:this.unexpected()}},Nn.parseDynamicImport=function(_){if(this.next(),_.source=this.parseMaybeAssign(),!this.eat(q.parenR)){var M=this.start;this.eat(q.comma)&&this.eat(q.parenR)?this.raiseRecoverable(M,"Trailing comma is not allowed in import()"):this.unexpected(M)}return this.finishNode(_,"ImportExpression")},Nn.parseImportMeta=function(_){this.next();var M=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="meta"&&this.raiseRecoverable(_.property.start,"The only valid meta property for import is 'import.meta'"),M&&this.raiseRecoverable(_.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(_.start,"Cannot use 'import.meta' outside a module"),this.finishNode(_,"MetaProperty")},Nn.parseLiteral=function(_){var M=this.startNode();return M.value=_,M.raw=this.input.slice(this.start,this.end),M.raw.charCodeAt(M.raw.length-1)===110&&(M.bigint=M.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(M,"Literal")},Nn.parseParenExpression=function(){this.expect(q.parenL);var _=this.parseExpression();return this.expect(q.parenR),_},Nn.parseParenAndDistinguishExpression=function(_){var M=this.start,F=this.startLoc,R,Y=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var me=this.start,He=this.startLoc,ut=[],lt=!0,ir=!1,ur=new fe,Tn=this.yieldPos,ri=this.awaitPos,Ln;for(this.yieldPos=0,this.awaitPos=0;this.type!==q.parenR;)if(lt?lt=!1:this.expect(q.comma),Y&&this.afterTrailingComma(q.parenR,!0)){ir=!0;break}else if(this.type===q.ellipsis){Ln=this.start,ut.push(this.parseParenItem(this.parseRestBinding())),this.type===q.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else ut.push(this.parseMaybeAssign(!1,ur,this.parseParenItem));var Vi=this.start,pa=this.startLoc;if(this.expect(q.parenR),_&&!this.canInsertSemicolon()&&this.eat(q.arrow))return this.checkPatternErrors(ur,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Tn,this.awaitPos=ri,this.parseParenArrowList(M,F,ut);(!ut.length||ir)&&this.unexpected(this.lastTokStart),Ln&&this.unexpected(Ln),this.checkExpressionErrors(ur,!0),this.yieldPos=Tn||this.yieldPos,this.awaitPos=ri||this.awaitPos,ut.length>1?(R=this.startNodeAt(me,He),R.expressions=ut,this.finishNodeAt(R,"SequenceExpression",Vi,pa)):R=ut[0]}else R=this.parseParenExpression();if(this.options.preserveParens){var Ea=this.startNodeAt(M,F);return Ea.expression=R,this.finishNode(Ea,"ParenthesizedExpression")}else return R},Nn.parseParenItem=function(_){return _},Nn.parseParenArrowList=function(_,M,F){return this.parseArrowExpression(this.startNodeAt(_,M),F)};var Ei=[];Nn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var _=this.startNode(),M=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(q.dot)){_.meta=M;var F=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="target"&&this.raiseRecoverable(_.property.start,"The only valid meta property for new is 'new.target'"),F&&this.raiseRecoverable(_.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(_.start,"'new.target' can only be used in functions"),this.finishNode(_,"MetaProperty")}var R=this.start,Y=this.startLoc,me=this.type===q._import;return _.callee=this.parseSubscripts(this.parseExprAtom(),R,Y,!0),me&&_.callee.type==="ImportExpression"&&this.raise(R,"Cannot use new with import()"),this.eat(q.parenL)?_.arguments=this.parseExprList(q.parenR,this.options.ecmaVersion>=8,!1):_.arguments=Ei,this.finishNode(_,"NewExpression")},Nn.parseTemplateElement=function(_){var M=_.isTagged,F=this.startNode();return this.type===q.invalidTemplate?(M||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),F.value={raw:this.value,cooked:null}):F.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),F.tail=this.type===q.backQuote,this.finishNode(F,"TemplateElement")},Nn.parseTemplate=function(_){_===void 0&&(_={});var M=_.isTagged;M===void 0&&(M=!1);var F=this.startNode();this.next(),F.expressions=[];var R=this.parseTemplateElement({isTagged:M});for(F.quasis=[R];!R.tail;)this.type===q.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(q.dollarBraceL),F.expressions.push(this.parseExpression()),this.expect(q.braceR),F.quasis.push(R=this.parseTemplateElement({isTagged:M}));return this.next(),this.finishNode(F,"TemplateLiteral")},Nn.isAsyncProp=function(_){return!_.computed&&_.key.type==="Identifier"&&_.key.name==="async"&&(this.type===q.name||this.type===q.num||this.type===q.string||this.type===q.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===q.star)&&!Yt.test(this.input.slice(this.lastTokEnd,this.start))},Nn.parseObj=function(_,M){var F=this.startNode(),R=!0,Y={};for(F.properties=[],this.next();!this.eat(q.braceR);){if(R)R=!1;else if(this.expect(q.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(q.braceR))break;var me=this.parseProperty(_,M);_||this.checkPropClash(me,Y,M),F.properties.push(me)}return this.finishNode(F,_?"ObjectPattern":"ObjectExpression")},Nn.parseProperty=function(_,M){var F=this.startNode(),R,Y,me,He;if(this.options.ecmaVersion>=9&&this.eat(q.ellipsis))return _?(F.argument=this.parseIdent(!1),this.type===q.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(F,"RestElement")):(this.type===q.parenL&&M&&(M.parenthesizedAssign<0&&(M.parenthesizedAssign=this.start),M.parenthesizedBind<0&&(M.parenthesizedBind=this.start)),F.argument=this.parseMaybeAssign(!1,M),this.type===q.comma&&M&&M.trailingComma<0&&(M.trailingComma=this.start),this.finishNode(F,"SpreadElement"));this.options.ecmaVersion>=6&&(F.method=!1,F.shorthand=!1,(_||M)&&(me=this.start,He=this.startLoc),_||(R=this.eat(q.star)));var ut=this.containsEsc;return this.parsePropertyName(F),!_&&!ut&&this.options.ecmaVersion>=8&&!R&&this.isAsyncProp(F)?(Y=!0,R=this.options.ecmaVersion>=9&&this.eat(q.star),this.parsePropertyName(F,M)):Y=!1,this.parsePropertyValue(F,_,R,Y,me,He,M,ut),this.finishNode(F,"Property")},Nn.parsePropertyValue=function(_,M,F,R,Y,me,He,ut){if((F||R)&&this.type===q.colon&&this.unexpected(),this.eat(q.colon))_.value=M?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,He),_.kind="init";else if(this.options.ecmaVersion>=6&&this.type===q.parenL)M&&this.unexpected(),_.kind="init",_.method=!0,_.value=this.parseMethod(F,R);else if(!M&&!ut&&this.options.ecmaVersion>=5&&!_.computed&&_.key.type==="Identifier"&&(_.key.name==="get"||_.key.name==="set")&&this.type!==q.comma&&this.type!==q.braceR&&this.type!==q.eq){(F||R)&&this.unexpected(),_.kind=_.key.name,this.parsePropertyName(_),_.value=this.parseMethod(!1);var lt=_.kind==="get"?0:1;if(_.value.params.length!==lt){var ir=_.value.start;_.kind==="get"?this.raiseRecoverable(ir,"getter should have no params"):this.raiseRecoverable(ir,"setter should have exactly one param")}else _.kind==="set"&&_.value.params[0].type==="RestElement"&&this.raiseRecoverable(_.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!_.computed&&_.key.type==="Identifier"?((F||R)&&this.unexpected(),this.checkUnreserved(_.key),_.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=Y),_.kind="init",M?_.value=this.parseMaybeDefault(Y,me,_.key):this.type===q.eq&&He?(He.shorthandAssign<0&&(He.shorthandAssign=this.start),_.value=this.parseMaybeDefault(Y,me,_.key)):_.value=_.key,_.shorthand=!0):this.unexpected()},Nn.parsePropertyName=function(_){if(this.options.ecmaVersion>=6){if(this.eat(q.bracketL))return _.computed=!0,_.key=this.parseMaybeAssign(),this.expect(q.bracketR),_.key;_.computed=!1}return _.key=this.type===q.num||this.type===q.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Nn.initFunction=function(_){_.id=null,this.options.ecmaVersion>=6&&(_.generator=_.expression=!1),this.options.ecmaVersion>=8&&(_.async=!1)},Nn.parseMethod=function(_,M,F){var R=this.startNode(),Y=this.yieldPos,me=this.awaitPos,He=this.awaitIdentPos;return this.initFunction(R),this.options.ecmaVersion>=6&&(R.generator=_),this.options.ecmaVersion>=8&&(R.async=!!M),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Xi(M,R.generator)|yi|(F?va:0)),this.expect(q.parenL),R.params=this.parseBindingList(q.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(R,!1,!0),this.yieldPos=Y,this.awaitPos=me,this.awaitIdentPos=He,this.finishNode(R,"FunctionExpression")},Nn.parseArrowExpression=function(_,M,F){var R=this.yieldPos,Y=this.awaitPos,me=this.awaitIdentPos;return this.enterScope(Xi(F,!1)|gi),this.initFunction(_),this.options.ecmaVersion>=8&&(_.async=!!F),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,_.params=this.toAssignableList(M,!0),this.parseFunctionBody(_,!0,!1),this.yieldPos=R,this.awaitPos=Y,this.awaitIdentPos=me,this.finishNode(_,"ArrowFunctionExpression")},Nn.parseFunctionBody=function(_,M,F){var R=M&&this.type!==q.braceL,Y=this.strict,me=!1;if(R)_.body=this.parseMaybeAssign(),_.expression=!0,this.checkParams(_,!1);else{var He=this.options.ecmaVersion>=7&&!this.isSimpleParamList(_.params);(!Y||He)&&(me=this.strictDirective(this.end),me&&He&&this.raiseRecoverable(_.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var ut=this.labels;this.labels=[],me&&(this.strict=!0),this.checkParams(_,!Y&&!me&&!M&&!F&&this.isSimpleParamList(_.params)),this.strict&&_.id&&this.checkLVal(_.id,xa),_.body=this.parseBlock(!1,void 0,me&&!Y),_.expression=!1,this.adaptDirectivePrologue(_.body.body),this.labels=ut}this.exitScope()},Nn.isSimpleParamList=function(_){for(var M=0,F=_;M<F.length;M+=1){var R=F[M];if(R.type!=="Identifier")return!1}return!0},Nn.checkParams=function(_,M){for(var F={},R=0,Y=_.params;R<Y.length;R+=1){var me=Y[R];this.checkLVal(me,Ji,M?null:F)}},Nn.parseExprList=function(_,M,F,R){for(var Y=[],me=!0;!this.eat(_);){if(me)me=!1;else if(this.expect(q.comma),M&&this.afterTrailingComma(_))break;var He=void 0;F&&this.type===q.comma?He=null:this.type===q.ellipsis?(He=this.parseSpread(R),R&&this.type===q.comma&&R.trailingComma<0&&(R.trailingComma=this.start)):He=this.parseMaybeAssign(!1,R),Y.push(He)}return Y},Nn.checkUnreserved=function(_){var M=_.start,F=_.end,R=_.name;if(this.inGenerator&&R==="yield"&&this.raiseRecoverable(M,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&R==="await"&&this.raiseRecoverable(M,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(R)&&this.raise(M,"Unexpected keyword '"+R+"'"),!(this.options.ecmaVersion<6&&this.input.slice(M,F).indexOf("\\")!==-1)){var Y=this.strict?this.reservedWordsStrict:this.reservedWords;Y.test(R)&&(!this.inAsync&&R==="await"&&this.raiseRecoverable(M,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(M,"The keyword '"+R+"' is reserved"))}},Nn.parseIdent=function(_,M){var F=this.startNode();return this.type===q.name?F.name=this.value:this.type.keyword?(F.name=this.type.keyword,(F.name==="class"||F.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!_),this.finishNode(F,"Identifier"),_||(this.checkUnreserved(F),F.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=F.start)),F},Nn.parseYield=function(_){this.yieldPos||(this.yieldPos=this.start);var M=this.startNode();return this.next(),this.type===q.semi||this.canInsertSemicolon()||this.type!==q.star&&!this.type.startsExpr?(M.delegate=!1,M.argument=null):(M.delegate=this.eat(q.star),M.argument=this.parseMaybeAssign(_)),this.finishNode(M,"YieldExpression")},Nn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var _=this.startNode();return this.next(),_.argument=this.parseMaybeUnary(null,!1),this.finishNode(_,"AwaitExpression")};var di=Ui.prototype;di.raise=function(_,M){var F=vt(this.input,_);M+=" ("+F.line+":"+F.column+")";var R=new SyntaxError(M);throw R.pos=_,R.loc=F,R.raisedAt=this.pos,R},di.raiseRecoverable=di.raise,di.curPosition=function(){if(this.options.locations)return new ke(this.curLine,this.pos-this.lineStart)};var Sn=Ui.prototype,Pi=function(M){this.flags=M,this.var=[],this.lexical=[],this.functions=[]};Sn.enterScope=function(_){this.scopeStack.push(new Pi(_))},Sn.exitScope=function(){this.scopeStack.pop()},Sn.treatFunctionsAsVarInScope=function(_){return _.flags&_n||!this.inModule&&_.flags&$n},Sn.declareName=function(_,M,F){var R=!1;if(M===ma){var Y=this.currentScope();R=Y.lexical.indexOf(_)>-1||Y.functions.indexOf(_)>-1||Y.var.indexOf(_)>-1,Y.lexical.push(_),this.inModule&&Y.flags&$n&&delete this.undefinedExports[_]}else if(M===Oa){var me=this.currentScope();me.lexical.push(_)}else if(M===Do){var He=this.currentScope();this.treatFunctionsAsVar?R=He.lexical.indexOf(_)>-1:R=He.lexical.indexOf(_)>-1||He.var.indexOf(_)>-1,He.functions.push(_)}else for(var ut=this.scopeStack.length-1;ut>=0;--ut){var lt=this.scopeStack[ut];if(lt.lexical.indexOf(_)>-1&&!(lt.flags&Xn&&lt.lexical[0]===_)||!this.treatFunctionsAsVarInScope(lt)&&lt.functions.indexOf(_)>-1){R=!0;break}if(lt.var.push(_),this.inModule&&lt.flags&$n&&delete this.undefinedExports[_],lt.flags&mi)break}R&&this.raiseRecoverable(F,"Identifier '"+_+"' has already been declared")},Sn.checkLocalExport=function(_){this.scopeStack[0].lexical.indexOf(_.name)===-1&&this.scopeStack[0].var.indexOf(_.name)===-1&&(this.undefinedExports[_.name]=_)},Sn.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},Sn.currentVarScope=function(){for(var _=this.scopeStack.length-1;;_--){var M=this.scopeStack[_];if(M.flags&mi)return M}},Sn.currentThisScope=function(){for(var _=this.scopeStack.length-1;;_--){var M=this.scopeStack[_];if(M.flags&mi&&!(M.flags&gi))return M}};var Mi=function(M,F,R){this.type="",this.start=F,this.end=0,M.options.locations&&(this.loc=new St(M,R)),M.options.directSourceFile&&(this.sourceFile=M.options.directSourceFile),M.options.ranges&&(this.range=[F,0])},to=Ui.prototype;to.startNode=function(){return new Mi(this,this.start,this.startLoc)},to.startNodeAt=function(_,M){return new Mi(this,_,M)};function gs(_,M,F,R){return _.type=M,_.end=F,this.options.locations&&(_.loc.end=R),this.options.ranges&&(_.range[1]=F),_}to.finishNode=function(_,M){return gs.call(this,_,M,this.lastTokEnd,this.lastTokEndLoc)},to.finishNodeAt=function(_,M,F,R){return gs.call(this,_,M,F,R)};var Ho=function(M,F,R,Y,me){this.token=M,this.isExpr=!!F,this.preserveSpace=!!R,this.override=Y,this.generator=!!me},Na={b_stat:new Ho("{",!1),b_expr:new Ho("{",!0),b_tmpl:new Ho("${",!1),p_stat:new Ho("(",!1),p_expr:new Ho("(",!0),q_tmpl:new Ho("`",!0,!0,function(_){return _.tryReadTemplateToken()}),f_stat:new Ho("function",!1),f_expr:new Ho("function",!0),f_expr_gen:new Ho("function",!0,!1,null,!0),f_gen:new Ho("function",!1,!1,null,!0)},ba=Ui.prototype;ba.initialContext=function(){return[Na.b_stat]},ba.braceIsBlock=function(_){var M=this.curContext();return M===Na.f_expr||M===Na.f_stat?!0:_===q.colon&&(M===Na.b_stat||M===Na.b_expr)?!M.isExpr:_===q._return||_===q.name&&this.exprAllowed?Yt.test(this.input.slice(this.lastTokEnd,this.start)):_===q._else||_===q.semi||_===q.eof||_===q.parenR||_===q.arrow?!0:_===q.braceL?M===Na.b_stat:_===q._var||_===q._const||_===q.name?!1:!this.exprAllowed},ba.inGeneratorContext=function(){for(var _=this.context.length-1;_>=1;_--){var M=this.context[_];if(M.token==="function")return M.generator}return!1},ba.updateContext=function(_){var M,F=this.type;F.keyword&&_===q.dot?this.exprAllowed=!1:(M=F.updateContext)?M.call(this,_):this.exprAllowed=F.beforeExpr},q.parenR.updateContext=q.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var _=this.context.pop();_===Na.b_stat&&this.curContext().token==="function"&&(_=this.context.pop()),this.exprAllowed=!_.isExpr},q.braceL.updateContext=function(_){this.context.push(this.braceIsBlock(_)?Na.b_stat:Na.b_expr),this.exprAllowed=!0},q.dollarBraceL.updateContext=function(){this.context.push(Na.b_tmpl),this.exprAllowed=!0},q.parenL.updateContext=function(_){var M=_===q._if||_===q._for||_===q._with||_===q._while;this.context.push(M?Na.p_stat:Na.p_expr),this.exprAllowed=!0},q.incDec.updateContext=function(){},q._function.updateContext=q._class.updateContext=function(_){_.beforeExpr&&_!==q.semi&&_!==q._else&&!(_===q._return&&Yt.test(this.input.slice(this.lastTokEnd,this.start)))&&!((_===q.colon||_===q.braceL)&&this.curContext()===Na.b_stat)?this.context.push(Na.f_expr):this.context.push(Na.f_stat),this.exprAllowed=!1},q.backQuote.updateContext=function(){this.curContext()===Na.q_tmpl?this.context.pop():this.context.push(Na.q_tmpl),this.exprAllowed=!1},q.star.updateContext=function(_){if(_===q._function){var M=this.context.length-1;this.context[M]===Na.f_expr?this.context[M]=Na.f_expr_gen:this.context[M]=Na.f_gen}this.exprAllowed=!0},q.name.updateContext=function(_){var M=!1;this.options.ecmaVersion>=6&&_!==q.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(M=!0),this.exprAllowed=M};var V="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",K=V+" Extended_Pictographic",te=K,he={9:V,10:K,11:te},Me="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",je="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Qe=je+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",se=Qe+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Le={9:je,10:Qe,11:se},ft={};function hr(_){var M=ft[_]={binary:Se(he[_]+" "+Me),nonBinary:{General_Category:Se(Me),Script:Se(Le[_])}};M.nonBinary.Script_Extensions=M.nonBinary.Script,M.nonBinary.gc=M.nonBinary.General_Category,M.nonBinary.sc=M.nonBinary.Script,M.nonBinary.scx=M.nonBinary.Script_Extensions}hr(9),hr(10),hr(11);var Ot=Ui.prototype,kt=function(M){this.parser=M,this.validFlags="gim"+(M.options.ecmaVersion>=6?"uy":"")+(M.options.ecmaVersion>=9?"s":""),this.unicodeProperties=ft[M.options.ecmaVersion>=11?11:M.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};kt.prototype.reset=function(M,F,R){var Y=R.indexOf("u")!==-1;this.start=M|0,this.source=F+"",this.flags=R,this.switchU=Y&&this.parser.options.ecmaVersion>=6,this.switchN=Y&&this.parser.options.ecmaVersion>=9},kt.prototype.raise=function(M){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+M)},kt.prototype.at=function(M,F){F===void 0&&(F=!1);var R=this.source,Y=R.length;if(M>=Y)return-1;var me=R.charCodeAt(M);if(!(F||this.switchU)||me<=55295||me>=57344||M+1>=Y)return me;var He=R.charCodeAt(M+1);return He>=56320&&He<=57343?(me<<10)+He-56613888:me},kt.prototype.nextIndex=function(M,F){F===void 0&&(F=!1);var R=this.source,Y=R.length;if(M>=Y)return Y;var me=R.charCodeAt(M),He;return!(F||this.switchU)||me<=55295||me>=57344||M+1>=Y||(He=R.charCodeAt(M+1))<56320||He>57343?M+1:M+2},kt.prototype.current=function(M){return M===void 0&&(M=!1),this.at(this.pos,M)},kt.prototype.lookahead=function(M){return M===void 0&&(M=!1),this.at(this.nextIndex(this.pos,M),M)},kt.prototype.advance=function(M){M===void 0&&(M=!1),this.pos=this.nextIndex(this.pos,M)},kt.prototype.eat=function(M,F){return F===void 0&&(F=!1),this.current(F)===M?(this.advance(F),!0):!1};function dr(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}Ot.validateRegExpFlags=function(_){for(var M=_.validFlags,F=_.flags,R=0;R<F.length;R++){var Y=F.charAt(R);M.indexOf(Y)===-1&&this.raise(_.start,"Invalid regular expression flag"),F.indexOf(Y,R+1)>-1&&this.raise(_.start,"Duplicate regular expression flag")}},Ot.validateRegExpPattern=function(_){this.regexp_pattern(_),!_.switchN&&this.options.ecmaVersion>=9&&_.groupNames.length>0&&(_.switchN=!0,this.regexp_pattern(_))},Ot.regexp_pattern=function(_){_.pos=0,_.lastIntValue=0,_.lastStringValue="",_.lastAssertionIsQuantifiable=!1,_.numCapturingParens=0,_.maxBackReference=0,_.groupNames.length=0,_.backReferenceNames.length=0,this.regexp_disjunction(_),_.pos!==_.source.length&&(_.eat(41)&&_.raise("Unmatched ')'"),(_.eat(93)||_.eat(125))&&_.raise("Lone quantifier brackets")),_.maxBackReference>_.numCapturingParens&&_.raise("Invalid escape");for(var M=0,F=_.backReferenceNames;M<F.length;M+=1){var R=F[M];_.groupNames.indexOf(R)===-1&&_.raise("Invalid named capture referenced")}},Ot.regexp_disjunction=function(_){for(this.regexp_alternative(_);_.eat(124);)this.regexp_alternative(_);this.regexp_eatQuantifier(_,!0)&&_.raise("Nothing to repeat"),_.eat(123)&&_.raise("Lone quantifier brackets")},Ot.regexp_alternative=function(_){for(;_.pos<_.source.length&&this.regexp_eatTerm(_););},Ot.regexp_eatTerm=function(_){return this.regexp_eatAssertion(_)?(_.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(_)&&_.switchU&&_.raise("Invalid quantifier"),!0):(_.switchU?this.regexp_eatAtom(_):this.regexp_eatExtendedAtom(_))?(this.regexp_eatQuantifier(_),!0):!1},Ot.regexp_eatAssertion=function(_){var M=_.pos;if(_.lastAssertionIsQuantifiable=!1,_.eat(94)||_.eat(36))return!0;if(_.eat(92)){if(_.eat(66)||_.eat(98))return!0;_.pos=M}if(_.eat(40)&&_.eat(63)){var F=!1;if(this.options.ecmaVersion>=9&&(F=_.eat(60)),_.eat(61)||_.eat(33))return this.regexp_disjunction(_),_.eat(41)||_.raise("Unterminated group"),_.lastAssertionIsQuantifiable=!F,!0}return _.pos=M,!1},Ot.regexp_eatQuantifier=function(_,M){return M===void 0&&(M=!1),this.regexp_eatQuantifierPrefix(_,M)?(_.eat(63),!0):!1},Ot.regexp_eatQuantifierPrefix=function(_,M){return _.eat(42)||_.eat(43)||_.eat(63)||this.regexp_eatBracedQuantifier(_,M)},Ot.regexp_eatBracedQuantifier=function(_,M){var F=_.pos;if(_.eat(123)){var R=0,Y=-1;if(this.regexp_eatDecimalDigits(_)&&(R=_.lastIntValue,_.eat(44)&&this.regexp_eatDecimalDigits(_)&&(Y=_.lastIntValue),_.eat(125)))return Y!==-1&&Y<R&&!M&&_.raise("numbers out of order in {} quantifier"),!0;_.switchU&&!M&&_.raise("Incomplete quantifier"),_.pos=F}return!1},Ot.regexp_eatAtom=function(_){return this.regexp_eatPatternCharacters(_)||_.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)},Ot.regexp_eatReverseSolidusAtomEscape=function(_){var M=_.pos;if(_.eat(92)){if(this.regexp_eatAtomEscape(_))return!0;_.pos=M}return!1},Ot.regexp_eatUncapturingGroup=function(_){var M=_.pos;if(_.eat(40)){if(_.eat(63)&&_.eat(58)){if(this.regexp_disjunction(_),_.eat(41))return!0;_.raise("Unterminated group")}_.pos=M}return!1},Ot.regexp_eatCapturingGroup=function(_){if(_.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(_):_.current()===63&&_.raise("Invalid group"),this.regexp_disjunction(_),_.eat(41))return _.numCapturingParens+=1,!0;_.raise("Unterminated group")}return!1},Ot.regexp_eatExtendedAtom=function(_){return _.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)||this.regexp_eatInvalidBracedQuantifier(_)||this.regexp_eatExtendedPatternCharacter(_)},Ot.regexp_eatInvalidBracedQuantifier=function(_){return this.regexp_eatBracedQuantifier(_,!0)&&_.raise("Nothing to repeat"),!1},Ot.regexp_eatSyntaxCharacter=function(_){var M=_.current();return En(M)?(_.lastIntValue=M,_.advance(),!0):!1};function En(_){return _===36||_>=40&&_<=43||_===46||_===63||_>=91&&_<=94||_>=123&&_<=125}Ot.regexp_eatPatternCharacters=function(_){for(var M=_.pos,F=0;(F=_.current())!==-1&&!En(F);)_.advance();return _.pos!==M},Ot.regexp_eatExtendedPatternCharacter=function(_){var M=_.current();return M!==-1&&M!==36&&!(M>=40&&M<=43)&&M!==46&&M!==63&&M!==91&&M!==94&&M!==124?(_.advance(),!0):!1},Ot.regexp_groupSpecifier=function(_){if(_.eat(63)){if(this.regexp_eatGroupName(_)){_.groupNames.indexOf(_.lastStringValue)!==-1&&_.raise("Duplicate capture group name"),_.groupNames.push(_.lastStringValue);return}_.raise("Invalid group")}},Ot.regexp_eatGroupName=function(_){if(_.lastStringValue="",_.eat(60)){if(this.regexp_eatRegExpIdentifierName(_)&&_.eat(62))return!0;_.raise("Invalid capture group name")}return!1},Ot.regexp_eatRegExpIdentifierName=function(_){if(_.lastStringValue="",this.regexp_eatRegExpIdentifierStart(_)){for(_.lastStringValue+=dr(_.lastIntValue);this.regexp_eatRegExpIdentifierPart(_);)_.lastStringValue+=dr(_.lastIntValue);return!0}return!1},Ot.regexp_eatRegExpIdentifierStart=function(_){var M=_.pos,F=this.options.ecmaVersion>=11,R=_.current(F);return _.advance(F),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,F)&&(R=_.lastIntValue),fn(R)?(_.lastIntValue=R,!0):(_.pos=M,!1)};function fn(_){return tr(_,!0)||_===36||_===95}Ot.regexp_eatRegExpIdentifierPart=function(_){var M=_.pos,F=this.options.ecmaVersion>=11,R=_.current(F);return _.advance(F),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,F)&&(R=_.lastIntValue),Mt(R)?(_.lastIntValue=R,!0):(_.pos=M,!1)};function Mt(_){return pr(_,!0)||_===36||_===95||_===8204||_===8205}Ot.regexp_eatAtomEscape=function(_){return this.regexp_eatBackReference(_)||this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)||_.switchN&&this.regexp_eatKGroupName(_)?!0:(_.switchU&&(_.current()===99&&_.raise("Invalid unicode escape"),_.raise("Invalid escape")),!1)},Ot.regexp_eatBackReference=function(_){var M=_.pos;if(this.regexp_eatDecimalEscape(_)){var F=_.lastIntValue;if(_.switchU)return F>_.maxBackReference&&(_.maxBackReference=F),!0;if(F<=_.numCapturingParens)return!0;_.pos=M}return!1},Ot.regexp_eatKGroupName=function(_){if(_.eat(107)){if(this.regexp_eatGroupName(_))return _.backReferenceNames.push(_.lastStringValue),!0;_.raise("Invalid named reference")}return!1},Ot.regexp_eatCharacterEscape=function(_){return this.regexp_eatControlEscape(_)||this.regexp_eatCControlLetter(_)||this.regexp_eatZero(_)||this.regexp_eatHexEscapeSequence(_)||this.regexp_eatRegExpUnicodeEscapeSequence(_,!1)||!_.switchU&&this.regexp_eatLegacyOctalEscapeSequence(_)||this.regexp_eatIdentityEscape(_)},Ot.regexp_eatCControlLetter=function(_){var M=_.pos;if(_.eat(99)){if(this.regexp_eatControlLetter(_))return!0;_.pos=M}return!1},Ot.regexp_eatZero=function(_){return _.current()===48&&!nn(_.lookahead())?(_.lastIntValue=0,_.advance(),!0):!1},Ot.regexp_eatControlEscape=function(_){var M=_.current();return M===116?(_.lastIntValue=9,_.advance(),!0):M===110?(_.lastIntValue=10,_.advance(),!0):M===118?(_.lastIntValue=11,_.advance(),!0):M===102?(_.lastIntValue=12,_.advance(),!0):M===114?(_.lastIntValue=13,_.advance(),!0):!1},Ot.regexp_eatControlLetter=function(_){var M=_.current();return tn(M)?(_.lastIntValue=M%32,_.advance(),!0):!1};function tn(_){return _>=65&&_<=90||_>=97&&_<=122}Ot.regexp_eatRegExpUnicodeEscapeSequence=function(_,M){M===void 0&&(M=!1);var F=_.pos,R=M||_.switchU;if(_.eat(117)){if(this.regexp_eatFixedHexDigits(_,4)){var Y=_.lastIntValue;if(R&&Y>=55296&&Y<=56319){var me=_.pos;if(_.eat(92)&&_.eat(117)&&this.regexp_eatFixedHexDigits(_,4)){var He=_.lastIntValue;if(He>=56320&&He<=57343)return _.lastIntValue=(Y-55296)*1024+(He-56320)+65536,!0}_.pos=me,_.lastIntValue=Y}return!0}if(R&&_.eat(123)&&this.regexp_eatHexDigits(_)&&_.eat(125)&&Ur(_.lastIntValue))return!0;R&&_.raise("Invalid unicode escape"),_.pos=F}return!1};function Ur(_){return _>=0&&_<=1114111}Ot.regexp_eatIdentityEscape=function(_){if(_.switchU)return this.regexp_eatSyntaxCharacter(_)?!0:_.eat(47)?(_.lastIntValue=47,!0):!1;var M=_.current();return M!==99&&(!_.switchN||M!==107)?(_.lastIntValue=M,_.advance(),!0):!1},Ot.regexp_eatDecimalEscape=function(_){_.lastIntValue=0;var M=_.current();if(M>=49&&M<=57){do _.lastIntValue=10*_.lastIntValue+(M-48),_.advance();while((M=_.current())>=48&&M<=57);return!0}return!1},Ot.regexp_eatCharacterClassEscape=function(_){var M=_.current();if(Xr(M))return _.lastIntValue=-1,_.advance(),!0;if(_.switchU&&this.options.ecmaVersion>=9&&(M===80||M===112)){if(_.lastIntValue=-1,_.advance(),_.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(_)&&_.eat(125))return!0;_.raise("Invalid property name")}return!1};function Xr(_){return _===100||_===68||_===115||_===83||_===119||_===87}Ot.regexp_eatUnicodePropertyValueExpression=function(_){var M=_.pos;if(this.regexp_eatUnicodePropertyName(_)&&_.eat(61)){var F=_.lastStringValue;if(this.regexp_eatUnicodePropertyValue(_)){var R=_.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(_,F,R),!0}}if(_.pos=M,this.regexp_eatLoneUnicodePropertyNameOrValue(_)){var Y=_.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(_,Y),!0}return!1},Ot.regexp_validateUnicodePropertyNameAndValue=function(_,M,F){on(_.unicodeProperties.nonBinary,M)||_.raise("Invalid property name"),_.unicodeProperties.nonBinary[M].test(F)||_.raise("Invalid property value")},Ot.regexp_validateUnicodePropertyNameOrValue=function(_,M){_.unicodeProperties.binary.test(M)||_.raise("Invalid property name")},Ot.regexp_eatUnicodePropertyName=function(_){var M=0;for(_.lastStringValue="";vi(M=_.current());)_.lastStringValue+=dr(M),_.advance();return _.lastStringValue!==""};function vi(_){return tn(_)||_===95}Ot.regexp_eatUnicodePropertyValue=function(_){var M=0;for(_.lastStringValue="";rn(M=_.current());)_.lastStringValue+=dr(M),_.advance();return _.lastStringValue!==""};function rn(_){return vi(_)||nn(_)}Ot.regexp_eatLoneUnicodePropertyNameOrValue=function(_){return this.regexp_eatUnicodePropertyValue(_)},Ot.regexp_eatCharacterClass=function(_){if(_.eat(91)){if(_.eat(94),this.regexp_classRanges(_),_.eat(93))return!0;_.raise("Unterminated character class")}return!1},Ot.regexp_classRanges=function(_){for(;this.regexp_eatClassAtom(_);){var M=_.lastIntValue;if(_.eat(45)&&this.regexp_eatClassAtom(_)){var F=_.lastIntValue;_.switchU&&(M===-1||F===-1)&&_.raise("Invalid character class"),M!==-1&&F!==-1&&M>F&&_.raise("Range out of order in character class")}}},Ot.regexp_eatClassAtom=function(_){var M=_.pos;if(_.eat(92)){if(this.regexp_eatClassEscape(_))return!0;if(_.switchU){var F=_.current();(F===99||Ai(F))&&_.raise("Invalid class escape"),_.raise("Invalid escape")}_.pos=M}var R=_.current();return R!==93?(_.lastIntValue=R,_.advance(),!0):!1},Ot.regexp_eatClassEscape=function(_){var M=_.pos;if(_.eat(98))return _.lastIntValue=8,!0;if(_.switchU&&_.eat(45))return _.lastIntValue=45,!0;if(!_.switchU&&_.eat(99)){if(this.regexp_eatClassControlLetter(_))return!0;_.pos=M}return this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)},Ot.regexp_eatClassControlLetter=function(_){var M=_.current();return nn(M)||M===95?(_.lastIntValue=M%32,_.advance(),!0):!1},Ot.regexp_eatHexEscapeSequence=function(_){var M=_.pos;if(_.eat(120)){if(this.regexp_eatFixedHexDigits(_,2))return!0;_.switchU&&_.raise("Invalid escape"),_.pos=M}return!1},Ot.regexp_eatDecimalDigits=function(_){var M=_.pos,F=0;for(_.lastIntValue=0;nn(F=_.current());)_.lastIntValue=10*_.lastIntValue+(F-48),_.advance();return _.pos!==M};function nn(_){return _>=48&&_<=57}Ot.regexp_eatHexDigits=function(_){var M=_.pos,F=0;for(_.lastIntValue=0;ji(F=_.current());)_.lastIntValue=16*_.lastIntValue+fi(F),_.advance();return _.pos!==M};function ji(_){return _>=48&&_<=57||_>=65&&_<=70||_>=97&&_<=102}function fi(_){return _>=65&&_<=70?10+(_-65):_>=97&&_<=102?10+(_-97):_-48}Ot.regexp_eatLegacyOctalEscapeSequence=function(_){if(this.regexp_eatOctalDigit(_)){var M=_.lastIntValue;if(this.regexp_eatOctalDigit(_)){var F=_.lastIntValue;M<=3&&this.regexp_eatOctalDigit(_)?_.lastIntValue=M*64+F*8+_.lastIntValue:_.lastIntValue=M*8+F}else _.lastIntValue=M;return!0}return!1},Ot.regexp_eatOctalDigit=function(_){var M=_.current();return Ai(M)?(_.lastIntValue=M-48,_.advance(),!0):(_.lastIntValue=0,!1)};function Ai(_){return _>=48&&_<=55}Ot.regexp_eatFixedHexDigits=function(_,M){var F=_.pos;_.lastIntValue=0;for(var R=0;R<M;++R){var Y=_.current();if(!ji(Y))return _.pos=F,!1;_.lastIntValue=16*_.lastIntValue+fi(Y),_.advance()}return!0};var _i=function(M){this.type=M.type,this.value=M.value,this.start=M.start,this.end=M.end,M.options.locations&&(this.loc=new St(M,M.startLoc,M.endLoc)),M.options.ranges&&(this.range=[M.start,M.end])},st=Ui.prototype;st.next=function(_){!_&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new _i(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},st.getToken=function(){return this.next(),new _i(this)},typeof Symbol!="undefined"&&(st[Symbol.iterator]=function(){var _=this;return{next:function(){var M=_.getToken();return{done:M.type===q.eof,value:M}}}}),st.curContext=function(){return this.context[this.context.length-1]},st.nextToken=function(){var _=this.curContext();if((!_||!_.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(q.eof);if(_.override)return _.override(this);this.readToken(this.fullCharCodeAtPos())},st.readToken=function(_){return tr(_,this.options.ecmaVersion>=6)||_===92?this.readWord():this.getTokenFromCode(_)},st.fullCharCodeAtPos=function(){var _=this.input.charCodeAt(this.pos);if(_<=55295||_>=57344)return _;var M=this.input.charCodeAt(this.pos+1);return(_<<10)+M-56613888},st.skipBlockComment=function(){var _=this.options.onComment&&this.curPosition(),M=this.pos,F=this.input.indexOf("*/",this.pos+=2);if(F===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=F+2,this.options.locations){ct.lastIndex=M;for(var R;(R=ct.exec(this.input))&&R.index<this.pos;)++this.curLine,this.lineStart=R.index+R[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(M+2,F),M,this.pos,_,this.curPosition())},st.skipLineComment=function(_){for(var M=this.pos,F=this.options.onComment&&this.curPosition(),R=this.input.charCodeAt(this.pos+=_);this.pos<this.input.length&&!Ke(R);)R=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(M+_,this.pos),M,this.pos,F,this.curPosition())},st.skipSpace=function(){e:for(;this.pos<this.input.length;){var _=this.input.charCodeAt(this.pos);switch(_){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(_>8&&_<14||_>=5760&&wt.test(String.fromCharCode(_)))++this.pos;else break e}}},st.finishToken=function(_,M){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var F=this.type;this.type=_,this.value=M,this.updateContext(F)},st.readToken_dot=function(){var _=this.input.charCodeAt(this.pos+1);if(_>=48&&_<=57)return this.readNumber(!0);var M=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&_===46&&M===46?(this.pos+=3,this.finishToken(q.ellipsis)):(++this.pos,this.finishToken(q.dot))},st.readToken_slash=function(){var _=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):_===61?this.finishOp(q.assign,2):this.finishOp(q.slash,1)},st.readToken_mult_modulo_exp=function(_){var M=this.input.charCodeAt(this.pos+1),F=1,R=_===42?q.star:q.modulo;return this.options.ecmaVersion>=7&&_===42&&M===42&&(++F,R=q.starstar,M=this.input.charCodeAt(this.pos+2)),M===61?this.finishOp(q.assign,F+1):this.finishOp(R,F)},st.readToken_pipe_amp=function(_){var M=this.input.charCodeAt(this.pos+1);if(M===_){if(this.options.ecmaVersion>=12){var F=this.input.charCodeAt(this.pos+2);if(F===61)return this.finishOp(q.assign,3)}return this.finishOp(_===124?q.logicalOR:q.logicalAND,2)}return M===61?this.finishOp(q.assign,2):this.finishOp(_===124?q.bitwiseOR:q.bitwiseAND,1)},st.readToken_caret=function(){var _=this.input.charCodeAt(this.pos+1);return _===61?this.finishOp(q.assign,2):this.finishOp(q.bitwiseXOR,1)},st.readToken_plus_min=function(_){var M=this.input.charCodeAt(this.pos+1);return M===_?M===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Yt.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(q.incDec,2):M===61?this.finishOp(q.assign,2):this.finishOp(q.plusMin,1)},st.readToken_lt_gt=function(_){var M=this.input.charCodeAt(this.pos+1),F=1;return M===_?(F=_===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+F)===61?this.finishOp(q.assign,F+1):this.finishOp(q.bitShift,F)):M===33&&_===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(M===61&&(F=2),this.finishOp(q.relational,F))},st.readToken_eq_excl=function(_){var M=this.input.charCodeAt(this.pos+1);return M===61?this.finishOp(q.equality,this.input.charCodeAt(this.pos+2)===61?3:2):_===61&&M===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(q.arrow)):this.finishOp(_===61?q.eq:q.prefix,1)},st.readToken_question=function(){var _=this.options.ecmaVersion;if(_>=11){var M=this.input.charCodeAt(this.pos+1);if(M===46){var F=this.input.charCodeAt(this.pos+2);if(F<48||F>57)return this.finishOp(q.questionDot,2)}if(M===63){if(_>=12){var R=this.input.charCodeAt(this.pos+2);if(R===61)return this.finishOp(q.assign,3)}return this.finishOp(q.coalesce,2)}}return this.finishOp(q.question,1)},st.getTokenFromCode=function(_){switch(_){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(q.parenL);case 41:return++this.pos,this.finishToken(q.parenR);case 59:return++this.pos,this.finishToken(q.semi);case 44:return++this.pos,this.finishToken(q.comma);case 91:return++this.pos,this.finishToken(q.bracketL);case 93:return++this.pos,this.finishToken(q.bracketR);case 123:return++this.pos,this.finishToken(q.braceL);case 125:return++this.pos,this.finishToken(q.braceR);case 58:return++this.pos,this.finishToken(q.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(q.backQuote);case 48:var M=this.input.charCodeAt(this.pos+1);if(M===120||M===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(M===111||M===79)return this.readRadixNumber(8);if(M===98||M===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(_);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(_);case 124:case 38:return this.readToken_pipe_amp(_);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(_);case 60:case 62:return this.readToken_lt_gt(_);case 61:case 33:return this.readToken_eq_excl(_);case 63:return this.readToken_question();case 126:return this.finishOp(q.prefix,1)}this.raise(this.pos,"Unexpected character '"+Ci(_)+"'")},st.finishOp=function(_,M){var F=this.input.slice(this.pos,this.pos+M);return this.pos+=M,this.finishToken(_,F)},st.readRegexp=function(){for(var _,M,F=this.pos;;){this.pos>=this.input.length&&this.raise(F,"Unterminated regular expression");var R=this.input.charAt(this.pos);if(Yt.test(R)&&this.raise(F,"Unterminated regular expression"),_)_=!1;else{if(R==="[")M=!0;else if(R==="]"&&M)M=!1;else if(R==="/"&&!M)break;_=R==="\\"}++this.pos}var Y=this.input.slice(F,this.pos);++this.pos;var me=this.pos,He=this.readWord1();this.containsEsc&&this.unexpected(me);var ut=this.regexpState||(this.regexpState=new kt(this));ut.reset(F,Y,He),this.validateRegExpFlags(ut),this.validateRegExpPattern(ut);var lt=null;try{lt=new RegExp(Y,He)}catch(ir){}return this.finishToken(q.regexp,{pattern:Y,flags:He,value:lt})},st.readInt=function(_,M,F){for(var R=this.options.ecmaVersion>=12&&M===void 0,Y=F&&this.input.charCodeAt(this.pos)===48,me=this.pos,He=0,ut=0,lt=0,ir=M==null?Infinity:M;lt<ir;++lt,++this.pos){var ur=this.input.charCodeAt(this.pos),Tn=void 0;if(R&&ur===95){Y&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),ut===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),lt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),ut=ur;continue}if(ur>=97?Tn=ur-97+10:ur>=65?Tn=ur-65+10:ur>=48&&ur<=57?Tn=ur-48:Tn=Infinity,Tn>=_)break;ut=ur,He=He*_+Tn}return R&&ut===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===me||M!=null&&this.pos-me!==M?null:He};function Ct(_,M){return M?parseInt(_,8):parseFloat(_.replace(/_/g,""))}function Ca(_){return typeof BigInt!="function"?null:BigInt(_.replace(/_/g,""))}st.readRadixNumber=function(_){var M=this.pos;this.pos+=2;var F=this.readInt(_);return F==null&&this.raise(this.start+2,"Expected number in radix "+_),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(F=Ca(this.input.slice(M,this.pos)),++this.pos):tr(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(q.num,F)},st.readNumber=function(_){var M=this.pos;!_&&this.readInt(10,void 0,!0)===null&&this.raise(M,"Invalid number");var F=this.pos-M>=2&&this.input.charCodeAt(M)===48;F&&this.strict&&this.raise(M,"Invalid number");var R=this.input.charCodeAt(this.pos);if(!F&&!_&&this.options.ecmaVersion>=11&&R===110){var Y=Ca(this.input.slice(M,this.pos));return++this.pos,tr(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(q.num,Y)}F&&/[89]/.test(this.input.slice(M,this.pos))&&(F=!1),R===46&&!F&&(++this.pos,this.readInt(10),R=this.input.charCodeAt(this.pos)),(R===69||R===101)&&!F&&(R=this.input.charCodeAt(++this.pos),(R===43||R===45)&&++this.pos,this.readInt(10)===null&&this.raise(M,"Invalid number")),tr(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var me=Ct(this.input.slice(M,this.pos),F);return this.finishToken(q.num,me)},st.readCodePoint=function(){var _=this.input.charCodeAt(this.pos),M;if(_===123){this.options.ecmaVersion<6&&this.unexpected();var F=++this.pos;M=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,M>1114111&&this.invalidStringToken(F,"Code point out of bounds")}else M=this.readHexChar(4);return M};function Ci(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}st.readString=function(_){for(var M="",F=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var R=this.input.charCodeAt(this.pos);if(R===_)break;R===92?(M+=this.input.slice(F,this.pos),M+=this.readEscapedChar(!1),F=this.pos):(Ke(R,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return M+=this.input.slice(F,this.pos++),this.finishToken(q.string,M)};var wi={};st.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(_){if(_===wi)this.readInvalidTemplateToken();else throw _}this.inTemplateElement=!1},st.invalidStringToken=function(_,M){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw wi;this.raise(_,M)},st.readTmplToken=function(){for(var _="",M=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var F=this.input.charCodeAt(this.pos);if(F===96||F===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===q.template||this.type===q.invalidTemplate)?F===36?(this.pos+=2,this.finishToken(q.dollarBraceL)):(++this.pos,this.finishToken(q.backQuote)):(_+=this.input.slice(M,this.pos),this.finishToken(q.template,_));if(F===92)_+=this.input.slice(M,this.pos),_+=this.readEscapedChar(!0),M=this.pos;else if(Ke(F)){switch(_+=this.input.slice(M,this.pos),++this.pos,F){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:_+=`
`;break;default:_+=String.fromCharCode(F);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),M=this.pos}else++this.pos}},st.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(q.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},st.readEscapedChar=function(_){var M=this.input.charCodeAt(++this.pos);switch(++this.pos,M){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Ci(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(_){var F=this.pos-1;return this.invalidStringToken(F,"Invalid escape sequence in template string"),null}default:if(M>=48&&M<=55){var R=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],Y=parseInt(R,8);return Y>255&&(R=R.slice(0,-1),Y=parseInt(R,8)),this.pos+=R.length-1,M=this.input.charCodeAt(this.pos),(R!=="0"||M===56||M===57)&&(this.strict||_)&&this.invalidStringToken(this.pos-1-R.length,_?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(Y)}return Ke(M)?"":String.fromCharCode(M)}},st.readHexChar=function(_){var M=this.pos,F=this.readInt(16,_);return F===null&&this.invalidStringToken(M,"Bad character escape sequence"),F},st.readWord1=function(){this.containsEsc=!1;for(var _="",M=!0,F=this.pos,R=this.options.ecmaVersion>=6;this.pos<this.input.length;){var Y=this.fullCharCodeAtPos();if(pr(Y,R))this.pos+=Y<=65535?1:2;else if(Y===92){this.containsEsc=!0,_+=this.input.slice(F,this.pos);var me=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var He=this.readCodePoint();(M?tr:pr)(He,R)||this.invalidStringToken(me,"Invalid Unicode escape"),_+=Ci(He),F=this.pos}else break;M=!1}return _+this.input.slice(F,this.pos)},st.readWord=function(){var _=this.readWord1(),M=q.name;return this.keywords.test(_)&&(M=gt[_]),this.finishToken(M,_)};var Bi="7.4.1";Ui.acorn={Parser:Ui,version:Bi,defaultOptions:Ft,Position:ke,SourceLocation:St,getLineInfo:vt,Node:Mi,TokenType:Lt,tokTypes:q,keywordTypes:gt,TokContext:Ho,tokContexts:Na,isIdentifierChar:pr,isIdentifierStart:tr,Token:_i,isNewLine:Ke,lineBreak:Yt,lineBreakG:ct,nonASCIIwhitespace:wt};function wr(_,M){return Ui.parse(_,M)}function an(_,M,F){return Ui.parseExpressionAt(_,M,F)}function pt(_,M){return Ui.tokenizer(_,M)}function ta(_,M){_.prototype=Object.create(M.prototype),_.prototype.constructor=_,_.__proto__=M}function ae(_){var M=typeof Map=="function"?new Map:void 0;return ae=function(R){if(R===null||!Eu(R))return R;if(typeof R!="function")throw new TypeError("Super expression must either be null or a function");if(typeof M!="undefined"){if(M.has(R))return M.get(R);M.set(R,Y)}function Y(){return $i(R,arguments,Aa(this).constructor)}return Y.prototype=Object.create(R.prototype,{constructor:{value:Y,enumerable:!1,writable:!0,configurable:!0}}),za(Y,R)},ae(_)}function es(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function $i(_,M,F){return es()?$i=Reflect.construct:$i=function(Y,me,He){var ut=[null];ut.push.apply(ut,me);var lt=Function.bind.apply(Y,ut),ir=new lt;return He&&za(ir,He.prototype),ir},$i.apply(null,arguments)}function Eu(_){return Function.toString.call(_).indexOf("[native code]")!==-1}function za(_,M){return za=Object.setPrototypeOf||function(R,Y){return R.__proto__=Y,R},za(_,M)}function Aa(_){return Aa=Object.setPrototypeOf?Object.getPrototypeOf:function(F){return F.__proto__||Object.getPrototypeOf(F)},Aa(_)}var Ya=function(_){ta(M,_);function M(){return _.apply(this,arguments)||this}return M}(ae(Error)),ra=function(_){ta(M,_);function M(){return _.apply(this,arguments)||this}return M}(ae(SyntaxError)),Po=function(_){ta(M,_);function M(){return _.apply(this,arguments)||this}return M}(ae(ReferenceError)),Wo=function(_){ta(M,_);function M(){return _.apply(this,arguments)||this}return M}(ae(TypeError)),Bu=function(_){ta(M,_);function M(){return _.apply(this,arguments)||this}return M}(Ya),ho=function(_){ta(M,_);function M(){return _.apply(this,arguments)||this}return M}(ra),Fo=function(_){ta(M,_);function M(){return _.apply(this,arguments)||this}return M}(Po),na={UnknownError:[3001,"%0",Bu],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Bu],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Fo],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Fo],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Fo],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Fo],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Fo],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Fo],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Fo],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Fo],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Fo],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Fo],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Po],VariableUndefinedReferenceError:[2002,"%0 is not defined",Po],IsNotConstructor:[2003,"%0 is not a constructor",Wo]};function qa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function Bo(_,M,F){return qa()?Bo=Reflect.construct:Bo=function(Y,me,He){var ut=[null];ut.push.apply(ut,me);var lt=Function.bind.apply(Y,ut),ir=new lt;return He&&Ka(ir,He.prototype),ir},Bo.apply(null,arguments)}function Ka(_,M){return Ka=Object.setPrototypeOf||function(R,Y){return R.__proto__=Y,R},Ka(_,M)}var Rs="0.0.3";function Il(_,M){Object.defineProperty(_,"name",{value:M,writable:!1,enumerable:!1,configurable:!0})}var ys=Object.prototype.hasOwnProperty,J=Symbol("Break"),ge=Symbol("Continue"),Xe=Symbol("DefaultCase"),Pt=Symbol("EmptyStatementReturn"),Or=Symbol("WithScopeName"),Pn=Symbol("SuperScopeName"),Ti=Symbol("RootScopeName"),ro=Symbol("GlobalScopeName");function Ra(_){return typeof _=="function"}var Ua=function(){function _(F){this.interpreter=F}var M=_.prototype;return M.generator=function(){var R=this.interpreter;function Y(){return this.getCurrentScope()}function me(){return this.getGlobalScope()}function He(){return this.getCurrentContext()}return{getOptions:R.getOptions.bind(R),getCurrentScope:Y.bind(R),getGlobalScope:me.bind(R),getCurrentContext:He.bind(R),getExecStartTime:R.getExecStartTime.bind(R)}},_}();function Xo(_,M,F){if(F===void 0&&(F=!0),!(_ instanceof Ua))throw new Error("Illegal call");if(typeof M!="string")return M;if(!!M){var R=_.generator(),Y=R.getOptions(),me={timeout:Y.timeout,_initEnv:function(){F||this.setCurrentContext(R.getCurrentContext()),this.execStartTime=R.getExecStartTime(),this.execEndTime=this.execStartTime}},He=F?R.getGlobalScope():R.getCurrentScope(),ut=new ya(He,me);return ut.evaluate(M)}}Object.defineProperty(Xo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function _s(_){if(!(_ instanceof Ua))throw new Error("Illegal call");for(var M=_.generator(),F=arguments.length,R=new Array(F>1?F-1:0),Y=1;Y<F;Y++)R[Y-1]=arguments[Y];var me=R.pop(),He=new ya(M.getGlobalScope(),M.getOptions()),ut=`
		    (function anonymous(`+R.join(",")+`){
		        `+me+`
		    });
		    `;return He.evaluate(ut)}Object.defineProperty(_s,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var oo=function(M){this.value=M},Io=function(M){this.value=M},xs=function(M){this.value=M},Ls=function(M,F,R){F===void 0&&(F=null),this.name=R,this.parent=F,this.data=M,this.labelStack=[]};function zs(){}function ou(_,M){return _===void 0&&(_=null),new Ls(Object.create(null),_,M)}function bs(_){return Object.create(_)}var ga={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Xo,Function:_s};typeof JSON!="undefined"&&(ga.JSON=JSON),typeof Promise!="undefined"&&(ga.Promise=Promise),typeof Set!="undefined"&&(ga.Set=Set),typeof Map!="undefined"&&(ga.Map=Map),typeof Symbol!="undefined"&&(ga.Symbol=Symbol),typeof Proxy!="undefined"&&(ga.Proxy=Proxy),typeof WeakMap!="undefined"&&(ga.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(ga.WeakSet=WeakSet),typeof Reflect!="undefined"&&(ga.Reflect=Reflect);var ya=function(){function _(F,R){F===void 0&&(F=_.global),R===void 0&&(R={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:R.ecmaVersion||_.ecmaVersion,timeout:R.timeout||0,rootContext:R.rootContext,globalContextInFunction:R.globalContextInFunction===void 0?_.globalContextInFunction:R.globalContextInFunction,_initEnv:R._initEnv},this.context=F||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var M=_.prototype;return M.initEnvironment=function(R){var Y;if(R instanceof Ls)Y=R;else{var me=null,He=this.createSuperScope(R);this.options.rootContext&&(me=new Ls(bs(this.options.rootContext),He,Ti)),Y=new Ls(R,me||He,ro)}this.globalScope=Y,this.currentScope=this.globalScope,this.globalContext=Y.data,this.currentContext=Y.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var ut=this.options._initEnv;ut&&ut.call(this)},M.getExecStartTime=function(){return this.execStartTime},M.getExecutionTime=function(){return this.execEndTime-this.execStartTime},M.setExecTimeout=function(R){R===void 0&&(R=0),this.options.timeout=R},M.getOptions=function(){return this.options},M.getGlobalScope=function(){return this.globalScope},M.getCurrentScope=function(){return this.currentScope},M.getCurrentContext=function(){return this.currentContext},M.isInterruptThrow=function(R){return R instanceof Bu||R instanceof Fo||R instanceof ho},M.createSuperScope=function(R){var Y=Object.assign({},ga),me=Object.keys(Y);return me.forEach(function(He){He in R&&delete Y[He]}),new Ls(Y,null,Pn)},M.setCurrentContext=function(R){this.currentContext=R},M.setCurrentScope=function(R){this.currentScope=R},M.evaluate=function(R){R===void 0&&(R="");var Y;if(!!R)return Y=wr(R,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||_.ecmaVersion}),this.evaluateNode(Y,R)},M.appendCode=function(R){return this.evaluate(R)},M.evaluateNode=function(R,Y){var me=this;Y===void 0&&(Y=""),this.value=void 0,this.source=Y,this.sourceList.push(Y),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var He=this.getCurrentScope(),ut=this.getCurrentContext(),lt=He.labelStack.concat([]),ir=this.callStack.concat([]),ur=function(){me.setCurrentScope(He),me.setCurrentContext(ut),He.labelStack=lt,me.callStack=ir};try{var Tn=this.createClosure(R);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Tn()}catch(ri){throw ri}finally{ur(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},M.createErrorMessage=function(R,Y,me){var He=R[1].replace("%0",String(Y));return me!==null&&(He+=this.getNodePosition(me||this.lastExecNode)),He},M.createError=function(R,Y){return new Y(R)},M.createThrowError=function(R,Y){return this.createError(R,Y)},M.createInternalThrowError=function(R,Y,me){return this.createError(this.createErrorMessage(R,Y,me),R[2])},M.checkTimeout=function(){if(!this.isRunning)return!1;var R=this.options.timeout||0,Y=Date.now();return Y-this.execStartTime>R},M.getNodePosition=function(R){if(R){var Y="";return R.loc?" ["+R.loc.start.line+":"+R.loc.start.column+"]"+Y:""}return""},M.createClosure=function(R){var Y=this,me;switch(R.type){case"BinaryExpression":me=this.binaryExpressionHandler(R);break;case"LogicalExpression":me=this.logicalExpressionHandler(R);break;case"UnaryExpression":me=this.unaryExpressionHandler(R);break;case"UpdateExpression":me=this.updateExpressionHandler(R);break;case"ObjectExpression":me=this.objectExpressionHandler(R);break;case"ArrayExpression":me=this.arrayExpressionHandler(R);break;case"CallExpression":me=this.callExpressionHandler(R);break;case"NewExpression":me=this.newExpressionHandler(R);break;case"MemberExpression":me=this.memberExpressionHandler(R);break;case"ThisExpression":me=this.thisExpressionHandler(R);break;case"SequenceExpression":me=this.sequenceExpressionHandler(R);break;case"Literal":me=this.literalHandler(R);break;case"Identifier":me=this.identifierHandler(R);break;case"AssignmentExpression":me=this.assignmentExpressionHandler(R);break;case"FunctionDeclaration":me=this.functionDeclarationHandler(R);break;case"VariableDeclaration":me=this.variableDeclarationHandler(R);break;case"BlockStatement":case"Program":me=this.programHandler(R);break;case"ExpressionStatement":me=this.expressionStatementHandler(R);break;case"EmptyStatement":me=this.emptyStatementHandler(R);break;case"ReturnStatement":me=this.returnStatementHandler(R);break;case"FunctionExpression":me=this.functionExpressionHandler(R);break;case"IfStatement":me=this.ifStatementHandler(R);break;case"ConditionalExpression":me=this.conditionalExpressionHandler(R);break;case"ForStatement":me=this.forStatementHandler(R);break;case"WhileStatement":me=this.whileStatementHandler(R);break;case"DoWhileStatement":me=this.doWhileStatementHandler(R);break;case"ForInStatement":me=this.forInStatementHandler(R);break;case"WithStatement":me=this.withStatementHandler(R);break;case"ThrowStatement":me=this.throwStatementHandler(R);break;case"TryStatement":me=this.tryStatementHandler(R);break;case"ContinueStatement":me=this.continueStatementHandler(R);break;case"BreakStatement":me=this.breakStatementHandler(R);break;case"SwitchStatement":me=this.switchStatementHandler(R);break;case"LabeledStatement":me=this.labeledStatementHandler(R);break;case"DebuggerStatement":me=this.debuggerStatementHandler(R);break;default:throw this.createInternalThrowError(na.NodeTypeSyntaxError,R.type,R)}return function(){var He=Y.options.timeout;if(He&&He>0&&Y.checkTimeout())throw Y.createInternalThrowError(na.ExecutionTimeOutError,He,null);return Y.lastExecNode=R,me.apply(void 0,arguments)}},M.binaryExpressionHandler=function(R){var Y=this,me=this.createClosure(R.left),He=this.createClosure(R.right);return function(){var ut=me(),lt=He();switch(R.operator){case"==":return ut==lt;case"!=":return ut!=lt;case"===":return ut===lt;case"!==":return ut!==lt;case"<":return ut<lt;case"<=":return ut<=lt;case">":return ut>lt;case">=":return ut>=lt;case"<<":return ut<<lt;case">>":return ut>>lt;case">>>":return ut>>>lt;case"+":return ut+lt;case"-":return ut-lt;case"*":return ut*lt;case"**":return Math.pow(ut,lt);case"/":return ut/lt;case"%":return ut%lt;case"|":return ut|lt;case"^":return ut^lt;case"&":return ut&lt;case"in":return ut in lt;case"instanceof":return ut instanceof lt;default:throw Y.createInternalThrowError(na.BinaryOperatorSyntaxError,R.operator,R)}}},M.logicalExpressionHandler=function(R){var Y=this,me=this.createClosure(R.left),He=this.createClosure(R.right);return function(){switch(R.operator){case"||":return me()||He();case"&&":return me()&&He();default:throw Y.createInternalThrowError(na.LogicalOperatorSyntaxError,R.operator,R)}}},M.unaryExpressionHandler=function(R){var Y=this;switch(R.operator){case"delete":var me=this.createObjectGetter(R.argument),He=this.createNameGetter(R.argument);return function(){var ur=me(),Tn=He();return delete ur[Tn]};default:var ut;if(R.operator==="typeof"&&R.argument.type==="Identifier"){var lt=this.createObjectGetter(R.argument),ir=this.createNameGetter(R.argument);ut=function(){return lt()[ir()]}}else ut=this.createClosure(R.argument);return function(){var ur=ut();switch(R.operator){case"-":return-ur;case"+":return+ur;case"!":return!ur;case"~":return~ur;case"void":return;case"typeof":return typeof ur;default:throw Y.createInternalThrowError(na.UnaryOperatorSyntaxError,R.operator,R)}}}},M.updateExpressionHandler=function(R){var Y=this,me=this.createObjectGetter(R.argument),He=this.createNameGetter(R.argument);return function(){var ut=me(),lt=He();switch(Y.assertVariable(ut,lt,R),R.operator){case"++":return R.prefix?++ut[lt]:ut[lt]++;case"--":return R.prefix?--ut[lt]:ut[lt]--;default:throw Y.createInternalThrowError(na.UpdateOperatorSyntaxError,R.operator,R)}}},M.objectExpressionHandler=function(R){var Y=this,me=[];function He(lt){return lt.type==="Identifier"?lt.name:lt.type==="Literal"?lt.value:this.throwError(na.ObjectStructureSyntaxError,lt.type,lt)}var ut=Object.create(null);return R.properties.forEach(function(lt){var ir=lt.kind,ur=He(lt.key);(!ut[ur]||ir==="init")&&(ut[ur]={}),ut[ur][ir]=Y.createClosure(lt.value),me.push({key:ur,property:lt})}),function(){for(var lt={},ir=me.length,ur=0;ur<ir;ur++){var Tn=me[ur],ri=Tn.key,Ln=ut[ri],Vi=Ln.init?Ln.init():void 0,pa=Ln.get?Ln.get():function(){},Ea=Ln.set?Ln.set():function(Ju){};if("set"in Ln||"get"in Ln){var Zi={configurable:!0,enumerable:!0,get:pa,set:Ea};Object.defineProperty(lt,ri,Zi)}else{var Es=Tn.property,su=Es.kind;Es.key.type==="Identifier"&&Es.value.type==="FunctionExpression"&&su==="init"&&!Es.value.id&&Il(Vi,Es.key.name),lt[ri]=Vi}}return lt}},M.arrayExpressionHandler=function(R){var Y=this,me=R.elements.map(function(He){return He&&Y.createClosure(He)});return function(){for(var He=me.length,ut=Array(He),lt=0;lt<He;lt++){var ir=me[lt];ir&&(ut[lt]=ir())}return ut}},M.safeObjectGet=function(R,Y,me){return R[Y]},M.createCallFunctionGetter=function(R){var Y=this;switch(R.type){case"MemberExpression":var me=this.createClosure(R.object),He=this.createMemberKeyGetter(R),ut=this.source;return function(){var ir=me(),ur=He(),Tn=Y.safeObjectGet(ir,ur,R);if(!Tn||!Ra(Tn)){var ri=ut.slice(R.start,R.end);throw Y.createInternalThrowError(na.FunctionUndefinedReferenceError,ri,R)}return Tn.__IS_EVAL_FUNC?function(Ln){return Tn(new Ua(Y),Ln,!0)}:Tn.__IS_FUNCTION_FUNC?function(){for(var Ln=arguments.length,Vi=new Array(Ln),pa=0;pa<Ln;pa++)Vi[pa]=arguments[pa];return Tn.apply(void 0,[new Ua(Y)].concat(Vi))}:Tn.bind(ir)};default:var lt=this.createClosure(R);return function(){var ir="";R.type==="Identifier"&&(ir=R.name);var ur=lt();if(!ur||!Ra(ur))throw Y.createInternalThrowError(na.FunctionUndefinedReferenceError,ir,R);if(R.type==="Identifier"&&ur.__IS_EVAL_FUNC&&ir==="eval")return function(Ln){var Vi=Y.getScopeFromName(ir,Y.getCurrentScope()),pa=Vi.name===Pn||Vi.name===ro||Vi.name===Ti;return ur(new Ua(Y),Ln,!pa)};if(ur.__IS_EVAL_FUNC)return function(Ln){return ur(new Ua(Y),Ln,!0)};if(ur.__IS_FUNCTION_FUNC)return function(){for(var Ln=arguments.length,Vi=new Array(Ln),pa=0;pa<Ln;pa++)Vi[pa]=arguments[pa];return ur.apply(void 0,[new Ua(Y)].concat(Vi))};var Tn=Y.options.globalContextInFunction;if(R.type==="Identifier"){var ri=Y.getIdentifierScope(R);ri.name===Or&&(Tn=ri.data)}return ur.bind(Tn)}}},M.callExpressionHandler=function(R){var Y=this,me=this.createCallFunctionGetter(R.callee),He=R.arguments.map(function(ut){return Y.createClosure(ut)});return function(){return me().apply(void 0,He.map(function(ut){return ut()}))}},M.functionExpressionHandler=function(R){var Y=this,me=this,He=this.source,ut=this.collectDeclVars,lt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var ir=R.id?R.id.name:"",ur=R.params.length,Tn=R.params.map(function(pa){return Y.createParamNameGetter(pa)}),ri=this.createClosure(R.body),Ln=this.collectDeclVars,Vi=this.collectDeclFuncs;return this.collectDeclVars=ut,this.collectDeclFuncs=lt,function(){var pa=me.getCurrentScope(),Ea=function Zi(){for(var Es=arguments.length,su=new Array(Es),Ju=0;Ju<Es;Ju++)su[Ju]=arguments[Ju];me.callStack.push(""+ir);var rf=me.getCurrentScope(),vl=ou(pa,"FunctionScope("+ir+")");me.setCurrentScope(vl),me.addDeclarationsToScope(Ln,Vi,vl),ir&&(vl.data[ir]=Zi),vl.data.arguments=arguments,Tn.forEach(function(zu,Uu){vl.data[zu()]=su[Uu]});var Pc=me.getCurrentContext();me.setCurrentContext(this);var Nu=ri();if(me.setCurrentContext(Pc),me.setCurrentScope(rf),me.callStack.pop(),Nu instanceof oo)return Nu.value};return Il(Ea,ir),Object.defineProperty(Ea,"length",{value:ur,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(Ea,"toString",{value:function(){return He.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Ea,"valueOf",{value:function(){return He.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Ea}},M.newExpressionHandler=function(R){var Y=this,me=this.source,He=this.createClosure(R.callee),ut=R.arguments.map(function(lt){return Y.createClosure(lt)});return function(){var lt=He();if(!Ra(lt)||lt.__IS_EVAL_FUNC){var ir=R.callee,ur=me.slice(ir.start,ir.end);throw Y.createInternalThrowError(na.IsNotConstructor,ur,R)}return lt.__IS_FUNCTION_FUNC?lt.apply(void 0,[new Ua(Y)].concat(ut.map(function(Tn){return Tn()}))):Bo(lt,ut.map(function(Tn){return Tn()}))}},M.memberExpressionHandler=function(R){var Y=this.createClosure(R.object),me=this.createMemberKeyGetter(R);return function(){var He=Y(),ut=me();return He[ut]}},M.thisExpressionHandler=function(R){var Y=this;return function(){return Y.getCurrentContext()}},M.sequenceExpressionHandler=function(R){var Y=this,me=R.expressions.map(function(He){return Y.createClosure(He)});return function(){for(var He,ut=me.length,lt=0;lt<ut;lt++){var ir=me[lt];He=ir()}return He}},M.literalHandler=function(R){return function(){return R.regex?new RegExp(R.regex.pattern,R.regex.flags):R.value}},M.identifierHandler=function(R){var Y=this;return function(){var me=Y.getCurrentScope(),He=Y.getScopeDataFromName(R.name,me);return Y.assertVariable(He,R.name,R),He[R.name]}},M.getIdentifierScope=function(R){var Y=this.getCurrentScope(),me=this.getScopeFromName(R.name,Y);return me},M.assignmentExpressionHandler=function(R){var Y=this;R.left.type==="Identifier"&&R.right.type==="FunctionExpression"&&!R.right.id&&(R.right.id={type:"Identifier",name:R.left.name});var me=this.createObjectGetter(R.left),He=this.createNameGetter(R.left),ut=this.createClosure(R.right);return function(){var lt=me(),ir=He(),ur=ut();switch(R.operator!=="="&&Y.assertVariable(lt,ir,R),R.operator){case"=":return lt[ir]=ur;case"+=":return lt[ir]+=ur;case"-=":return lt[ir]-=ur;case"*=":return lt[ir]*=ur;case"**=":return lt[ir]=Math.pow(lt[ir],ur);case"/=":return lt[ir]/=ur;case"%=":return lt[ir]%=ur;case"<<=":return lt[ir]<<=ur;case">>=":return lt[ir]>>=ur;case">>>=":return lt[ir]>>>=ur;case"&=":return lt[ir]&=ur;case"^=":return lt[ir]^=ur;case"|=":return lt[ir]|=ur;default:throw Y.createInternalThrowError(na.AssignmentExpressionSyntaxError,R.type,R)}}},M.functionDeclarationHandler=function(R){if(R.id){var Y=this.functionExpressionHandler(R);Object.defineProperty(Y,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(R.id.name,Y)}return function(){return Pt}},M.getVariableName=function(R){if(R.type==="Identifier")return R.name;throw this.createInternalThrowError(na.VariableTypeSyntaxError,R.type,R)},M.variableDeclarationHandler=function(R){for(var Y=this,me,He=[],ut=0;ut<R.declarations.length;ut++){var lt=R.declarations[ut];this.varDeclaration(this.getVariableName(lt.id)),lt.init&&He.push({type:"AssignmentExpression",operator:"=",left:lt.id,right:lt.init})}return He.length&&(me=this.createClosure({type:"BlockStatement",body:He})),function(){if(me){var ir=Y.isVarDeclMode;Y.isVarDeclMode=!0,me(),Y.isVarDeclMode=ir}return Pt}},M.assertVariable=function(R,Y,me){if(R===this.globalScope.data&&!(Y in R))throw this.createInternalThrowError(na.VariableUndefinedReferenceError,Y,me)},M.programHandler=function(R){var Y=this,me=R.body.map(function(He){return Y.createClosure(He)});return function(){for(var He=Pt,ut=0;ut<me.length;ut++){var lt=me[ut],ir=Y.setValue(lt());if(ir!==Pt&&(He=ir,He instanceof oo||He instanceof Io||He instanceof xs||He===J||He===ge))break}return He}},M.expressionStatementHandler=function(R){return this.createClosure(R.expression)},M.emptyStatementHandler=function(R){return function(){return Pt}},M.returnStatementHandler=function(R){var Y=R.argument?this.createClosure(R.argument):zs;return function(){return new oo(Y())}},M.ifStatementHandler=function(R){var Y=this.createClosure(R.test),me=this.createClosure(R.consequent),He=R.alternate?this.createClosure(R.alternate):function(){return Pt};return function(){return Y()?me():He()}},M.conditionalExpressionHandler=function(R){return this.ifStatementHandler(R)},M.forStatementHandler=function(R){var Y=this,me=zs,He=R.test?this.createClosure(R.test):function(){return!0},ut=zs,lt=this.createClosure(R.body);return R.type==="ForStatement"&&(me=R.init?this.createClosure(R.init):me,ut=R.update?this.createClosure(R.update):zs),function(ir){var ur,Tn=Pt,ri=R.type==="DoWhileStatement";for(ir&&ir.type==="LabeledStatement"&&(ur=ir.label.name),me();ri||He();ut()){ri=!1;var Ln=Y.setValue(lt());if(!(Ln===Pt||Ln===ge)){if(Ln===J)break;if(Tn=Ln,Tn instanceof xs&&Tn.value===ur){Tn=Pt;continue}if(Tn instanceof oo||Tn instanceof Io||Tn instanceof xs)break}}return Tn}},M.whileStatementHandler=function(R){return this.forStatementHandler(R)},M.doWhileStatementHandler=function(R){return this.forStatementHandler(R)},M.forInStatementHandler=function(R){var Y=this,me=R.left,He=this.createClosure(R.right),ut=this.createClosure(R.body);return R.left.type==="VariableDeclaration"&&(this.createClosure(R.left)(),me=R.left.declarations[0].id),function(lt){var ir,ur=Pt,Tn;lt&&lt.type==="LabeledStatement"&&(ir=lt.label.name);var ri=He();for(Tn in ri){Y.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:me,right:{type:"Literal",value:Tn}})();var Ln=Y.setValue(ut());if(!(Ln===Pt||Ln===ge)){if(Ln===J)break;if(ur=Ln,ur instanceof xs&&ur.value===ir){ur=Pt;continue}if(ur instanceof oo||ur instanceof Io||ur instanceof xs)break}}return ur}},M.withStatementHandler=function(R){var Y=this,me=this.createClosure(R.object),He=this.createClosure(R.body);return function(){var ut=me(),lt=Y.getCurrentScope(),ir=new Ls(ut,lt,Or);Y.setCurrentScope(ir);var ur=Y.setValue(He());return Y.setCurrentScope(lt),ur}},M.throwStatementHandler=function(R){var Y=this,me=this.createClosure(R.argument);return function(){throw Y.setValue(void 0),me()}},M.tryStatementHandler=function(R){var Y=this,me=this.createClosure(R.block),He=R.handler?this.catchClauseHandler(R.handler):null,ut=R.finalizer?this.createClosure(R.finalizer):null;return function(){var lt=Y.getCurrentScope(),ir=Y.getCurrentContext(),ur=lt.labelStack.concat([]),Tn=Y.callStack.concat([]),ri=Pt,Ln,Vi,pa=function(){Y.setCurrentScope(lt),Y.setCurrentContext(ir),lt.labelStack=ur,Y.callStack=Tn};try{ri=Y.setValue(me()),ri instanceof oo&&(Ln=ri)}catch(Ea){if(pa(),Y.isInterruptThrow(Ea))throw Ea;if(He)try{ri=Y.setValue(He(Ea)),ri instanceof oo&&(Ln=ri)}catch(Zi){if(pa(),Y.isInterruptThrow(Zi))throw Zi;Vi=Zi}}if(ut)try{ri=ut(),ri instanceof oo&&(Ln=ri)}catch(Ea){if(pa(),Y.isInterruptThrow(Ea))throw Ea;Vi=Ea}if(Vi)throw Vi;return Ln||ri}},M.catchClauseHandler=function(R){var Y=this,me=this.createParamNameGetter(R.param),He=this.createClosure(R.body);return function(ut){var lt,ir=Y.getCurrentScope(),ur=ir.data,Tn=me(),ri=ys.call(ur,Tn),Ln=ur[Tn];return ur[Tn]=ut,lt=He(),ri?ur[Tn]=Ln:delete ur[Tn],lt}},M.continueStatementHandler=function(R){return function(){return R.label?new xs(R.label.name):ge}},M.breakStatementHandler=function(R){return function(){return R.label?new Io(R.label.name):J}},M.switchStatementHandler=function(R){var Y=this,me=this.createClosure(R.discriminant),He=R.cases.map(function(ut){return Y.switchCaseHandler(ut)});return function(){for(var ut=me(),lt=!1,ir,ur,Tn,ri=0;ri<He.length;ri++){var Ln=He[ri](),Vi=Ln.testClosure();if(Vi===Xe){Tn=Ln;continue}if(lt||Vi===ut){if(lt=!0,ur=Y.setValue(Ln.bodyClosure()),ur===Pt)continue;if(ur===J||(ir=ur,ir instanceof oo||ir instanceof Io||ir instanceof xs||ir===ge))break}}if(!lt&&Tn){ur=Y.setValue(Tn.bodyClosure());var pa=ur===Pt||ur===J||ur===ge;pa||(ir=ur)}return ir}},M.switchCaseHandler=function(R){var Y=R.test?this.createClosure(R.test):function(){return Xe},me=this.createClosure({type:"BlockStatement",body:R.consequent});return function(){return{testClosure:Y,bodyClosure:me}}},M.labeledStatementHandler=function(R){var Y=this,me=R.label.name,He=this.createClosure(R.body);return function(){var ut,lt=Y.getCurrentScope();return lt.labelStack.push(me),ut=He(R),ut instanceof Io&&ut.value===me&&(ut=Pt),lt.labelStack.pop(),ut}},M.debuggerStatementHandler=function(R){return function(){debugger;return Pt}},M.createParamNameGetter=function(R){if(R.type==="Identifier")return function(){return R.name};throw this.createInternalThrowError(na.ParamTypeSyntaxError,R.type,R)},M.createObjectKeyGetter=function(R){var Y;return R.type==="Identifier"?Y=function(){return R.name}:Y=this.createClosure(R),function(){return Y()}},M.createMemberKeyGetter=function(R){return R.computed?this.createClosure(R.property):this.createObjectKeyGetter(R.property)},M.createObjectGetter=function(R){var Y=this;switch(R.type){case"Identifier":return function(){return Y.getScopeDataFromName(R.name,Y.getCurrentScope())};case"MemberExpression":return this.createClosure(R.object);default:throw this.createInternalThrowError(na.AssignmentTypeSyntaxError,R.type,R)}},M.createNameGetter=function(R){switch(R.type){case"Identifier":return function(){return R.name};case"MemberExpression":return this.createMemberKeyGetter(R);default:throw this.createInternalThrowError(na.AssignmentTypeSyntaxError,R.type,R)}},M.varDeclaration=function(R){var Y=this.collectDeclVars;Y[R]=void 0},M.funcDeclaration=function(R,Y){var me=this.collectDeclFuncs;me[R]=Y},M.addDeclarationsToScope=function(R,Y,me){var He=me.data;for(var ut in Y){var lt=Y[ut];He[ut]=lt&&lt()}for(var ir in R)ir in He||(He[ir]=void 0)},M.getScopeValue=function(R,Y){var me=this.getScopeFromName(R,Y);return me.data[R]},M.getScopeDataFromName=function(R,Y){return this.getScopeFromName(R,Y).data},M.getScopeFromName=function(R,Y){var me=Y;do if(R in me.data)return me;while(me=me.parent);return this.globalScope},M.setValue=function(R){var Y=this.callStack.length;return this.isVarDeclMode||Y||R===Pt||R===J||R===ge||R instanceof Io||R instanceof xs||(this.value=R instanceof oo?R.value:R),R},M.getValue=function(){return this.value},_}();ya.version=Rs,ya.eval=Xo,ya.Function=_s,ya.ecmaVersion=5,ya.globalContextInFunction=void 0,ya.global=Object.create(null);function us(_){return _===void 0&&(_=Object.create(null)),_}function tf(_,M,F){M===void 0&&(M=[]),F===void 0&&(F={});var R=F.parsingContext,Y=F.timeout===void 0?0:F.timeout,me=`
    (function anonymous(`+M.join(",")+`){
         `+_+`
    });
    `,He=new ya(R,{ecmaVersion:F.ecmaVersion,timeout:Y,rootContext:F.rootContext,globalContextInFunction:F.globalContextInFunction});return He.evaluate(me)}function Ol(_,M,F){var R=new ya(M,F);return R.evaluate(_)}var qs=Ol,ic=function(){function _(F){this._code=F}var M=_.prototype;return M.runInContext=function(R){return Ol(this._code,R)},M.runInNewContext=function(R){return Ol(this._code,R)},_}(),Qu=function(_,M,F){return Ol(_,M,F)};function Ks(){for(var _=arguments.length,M=new Array(_),F=0;F<_;F++)M[F]=arguments[F];var R=M.pop();return tf(R||"",M)}var dl=Qu},20396:function(Tr,ie,ee){var Oe;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(_e,g,Re,X){"use strict";var pe=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,de=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Ne=pe||de,xe=["","webkit","Moz","MS","ms","o"],tt=Ne?"":g.createElement("div"),dt="function",At=Math.round,tr=Math.abs,pr=Date.now;function Lt(J,ge,Xe){return setTimeout(ct(J,Xe),ge)}function nr(J,ge,Xe){return Array.isArray(J)?(jt(J,Xe[ge],Xe),!0):!1}function jt(J,ge,Xe){var Pt;if(!!J)if(J.forEach)J.forEach(ge,Xe);else if(J.length!==X)for(Pt=0;Pt<J.length;)ge.call(Xe,J[Pt],Pt,J),Pt++;else for(Pt in J)J.hasOwnProperty(Pt)&&ge.call(Xe,J[Pt],Pt,J)}function ht(J,ge,Xe){var Pt="DEPRECATED METHOD: "+ge+`
`+Xe+` AT 
`;return function(){var Or=new Error("get-stack-trace"),Pn=Or&&Or.stack?Or.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ti=_e.console&&(_e.console.warn||_e.console.log);return Ti&&Ti.call(_e.console,Pt,Pn),J.apply(this,arguments)}}var gt;typeof Object.assign!="function"?gt=function(ge){if(ge===X||ge===null)throw new TypeError("Cannot convert undefined or null to object");for(var Xe=Object(ge),Pt=1;Pt<arguments.length;Pt++){var Or=arguments[Pt];if(Or!==X&&Or!==null)for(var Pn in Or)Or.hasOwnProperty(Pn)&&(Xe[Pn]=Or[Pn])}return Xe}:gt=Object.assign;var sr=ht(function(ge,Xe,Pt){for(var Or=Object.keys(Xe),Pn=0;Pn<Or.length;)(!Pt||Pt&&ge[Or[Pn]]===X)&&(ge[Or[Pn]]=Xe[Or[Pn]]),Pn++;return ge},"extend","Use `assign`."),q=ht(function(ge,Xe){return sr(ge,Xe,!0)},"merge","Use `assign`.");function Yt(J,ge,Xe){var Pt=ge.prototype,Or;Or=J.prototype=Object.create(Pt),Or.constructor=J,Or._super=Pt,Xe&&gt(Or,Xe)}function ct(J,ge){return function(){return J.apply(ge,arguments)}}function Ke(J,ge){return typeof J==dt?J.apply(ge&&ge[0]||X,ge):J}function wt(J,ge){return J===X?ge:J}function et(J,ge,Xe){jt(on(ge),function(Pt){J.addEventListener(Pt,Xe,!1)})}function qt(J,ge,Xe){jt(on(ge),function(Pt){J.removeEventListener(Pt,Xe,!1)})}function Ar(J,ge){for(;J;){if(J==ge)return!0;J=J.parentNode}return!1}function Wr(J,ge){return J.indexOf(ge)>-1}function on(J){return J.trim().split(/\s+/g)}function A(J,ge,Xe){if(J.indexOf&&!Xe)return J.indexOf(ge);for(var Pt=0;Pt<J.length;){if(Xe&&J[Pt][Xe]==ge||!Xe&&J[Pt]===ge)return Pt;Pt++}return-1}function Se(J){return Array.prototype.slice.call(J,0)}function ke(J,ge,Xe){for(var Pt=[],Or=[],Pn=0;Pn<J.length;){var Ti=ge?J[Pn][ge]:J[Pn];A(Or,Ti)<0&&Pt.push(J[Pn]),Or[Pn]=Ti,Pn++}return Xe&&(ge?Pt=Pt.sort(function(Ra,Ua){return Ra[ge]>Ua[ge]}):Pt=Pt.sort()),Pt}function St(J,ge){for(var Xe,Pt,Or=ge[0].toUpperCase()+ge.slice(1),Pn=0;Pn<xe.length;){if(Xe=xe[Pn],Pt=Xe?Xe+Or:ge,Pt in J)return Pt;Pn++}return X}var vt=1;function Ft(){return vt++}function Wt(J){var ge=J.ownerDocument||J;return ge.defaultView||ge.parentWindow||_e}var Er=/mobile|tablet|ip(ad|hone|od)|android/i,$n="ontouchstart"in _e,_n=St(_e,"PointerEvent")!==X,mi=$n&&Er.test(navigator.userAgent),Gn="touch",ai="pen",gi="mouse",Xn="kinect",yi=25,va=1,Xi=2,Ri=4,Ji=8,ma=1,Do=2,Oa=4,xa=8,Ui=16,aa=Do|Oa,ea=xa|Ui,Os=aa|ea,fe=["x","y"],oi=["clientX","clientY"];function xo(J,ge){var Xe=this;this.manager=J,this.callback=ge,this.element=J.element,this.target=J.options.inputTarget,this.domHandler=function(Pt){Ke(J.options.enable,[J])&&Xe.handler(Pt)},this.init()}xo.prototype={handler:function(){},init:function(){this.evEl&&et(this.element,this.evEl,this.domHandler),this.evTarget&&et(this.target,this.evTarget,this.domHandler),this.evWin&&et(Wt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&qt(this.element,this.evEl,this.domHandler),this.evTarget&&qt(this.target,this.evTarget,this.domHandler),this.evWin&&qt(Wt(this.element),this.evWin,this.domHandler)}};function au(J){var ge,Xe=J.options.inputClass;return Xe?ge=Xe:_n?ge=Me:mi?ge=kt:$n?ge=Mt:ge=ba,new ge(J,Nt)}function Nt(J,ge,Xe){var Pt=Xe.pointers.length,Or=Xe.changedPointers.length,Pn=ge&va&&Pt-Or==0,Ti=ge&(Ri|Ji)&&Pt-Or==0;Xe.isFirst=!!Pn,Xe.isFinal=!!Ti,Pn&&(J.session={}),Xe.eventType=ge,Jt(J,Xe),J.emit("hammer.input",Xe),J.recognize(Xe),J.session.prevInput=Xe}function Jt(J,ge){var Xe=J.session,Pt=ge.pointers,Or=Pt.length;Xe.firstInput||(Xe.firstInput=wn(ge)),Or>1&&!Xe.firstMultiple?Xe.firstMultiple=wn(ge):Or===1&&(Xe.firstMultiple=!1);var Pn=Xe.firstInput,Ti=Xe.firstMultiple,ro=Ti?Ti.center:Pn.center,Ra=ge.center=Nn(Pt);ge.timeStamp=pr(),ge.deltaTime=ge.timeStamp-Pn.timeStamp,ge.angle=Pi(ro,Ra),ge.distance=Sn(ro,Ra),Dr(Xe,ge),ge.offsetDirection=di(ge.deltaX,ge.deltaY);var Ua=Ei(ge.deltaTime,ge.deltaX,ge.deltaY);ge.overallVelocityX=Ua.x,ge.overallVelocityY=Ua.y,ge.overallVelocity=tr(Ua.x)>tr(Ua.y)?Ua.x:Ua.y,ge.scale=Ti?to(Ti.pointers,Pt):1,ge.rotation=Ti?Mi(Ti.pointers,Pt):0,ge.maxPointers=Xe.prevInput?ge.pointers.length>Xe.prevInput.maxPointers?ge.pointers.length:Xe.prevInput.maxPointers:ge.pointers.length,cn(Xe,ge);var Xo=J.element;Ar(ge.srcEvent.target,Xo)&&(Xo=ge.srcEvent.target),ge.target=Xo}function Dr(J,ge){var Xe=ge.center,Pt=J.offsetDelta||{},Or=J.prevDelta||{},Pn=J.prevInput||{};(ge.eventType===va||Pn.eventType===Ri)&&(Or=J.prevDelta={x:Pn.deltaX||0,y:Pn.deltaY||0},Pt=J.offsetDelta={x:Xe.x,y:Xe.y}),ge.deltaX=Or.x+(Xe.x-Pt.x),ge.deltaY=Or.y+(Xe.y-Pt.y)}function cn(J,ge){var Xe=J.lastInterval||ge,Pt=ge.timeStamp-Xe.timeStamp,Or,Pn,Ti,ro;if(ge.eventType!=Ji&&(Pt>yi||Xe.velocity===X)){var Ra=ge.deltaX-Xe.deltaX,Ua=ge.deltaY-Xe.deltaY,Xo=Ei(Pt,Ra,Ua);Pn=Xo.x,Ti=Xo.y,Or=tr(Xo.x)>tr(Xo.y)?Xo.x:Xo.y,ro=di(Ra,Ua),J.lastInterval=ge}else Or=Xe.velocity,Pn=Xe.velocityX,Ti=Xe.velocityY,ro=Xe.direction;ge.velocity=Or,ge.velocityX=Pn,ge.velocityY=Ti,ge.direction=ro}function wn(J){for(var ge=[],Xe=0;Xe<J.pointers.length;)ge[Xe]={clientX:At(J.pointers[Xe].clientX),clientY:At(J.pointers[Xe].clientY)},Xe++;return{timeStamp:pr(),pointers:ge,center:Nn(ge),deltaX:J.deltaX,deltaY:J.deltaY}}function Nn(J){var ge=J.length;if(ge===1)return{x:At(J[0].clientX),y:At(J[0].clientY)};for(var Xe=0,Pt=0,Or=0;Or<ge;)Xe+=J[Or].clientX,Pt+=J[Or].clientY,Or++;return{x:At(Xe/ge),y:At(Pt/ge)}}function Ei(J,ge,Xe){return{x:ge/J||0,y:Xe/J||0}}function di(J,ge){return J===ge?ma:tr(J)>=tr(ge)?J<0?Do:Oa:ge<0?xa:Ui}function Sn(J,ge,Xe){Xe||(Xe=fe);var Pt=ge[Xe[0]]-J[Xe[0]],Or=ge[Xe[1]]-J[Xe[1]];return Math.sqrt(Pt*Pt+Or*Or)}function Pi(J,ge,Xe){Xe||(Xe=fe);var Pt=ge[Xe[0]]-J[Xe[0]],Or=ge[Xe[1]]-J[Xe[1]];return Math.atan2(Or,Pt)*180/Math.PI}function Mi(J,ge){return Pi(ge[1],ge[0],oi)+Pi(J[1],J[0],oi)}function to(J,ge){return Sn(ge[0],ge[1],oi)/Sn(J[0],J[1],oi)}var gs={mousedown:va,mousemove:Xi,mouseup:Ri},Ho="mousedown",Na="mousemove mouseup";function ba(){this.evEl=Ho,this.evWin=Na,this.pressed=!1,xo.apply(this,arguments)}Yt(ba,xo,{handler:function(ge){var Xe=gs[ge.type];Xe&va&&ge.button===0&&(this.pressed=!0),Xe&Xi&&ge.which!==1&&(Xe=Ri),!!this.pressed&&(Xe&Ri&&(this.pressed=!1),this.callback(this.manager,Xe,{pointers:[ge],changedPointers:[ge],pointerType:gi,srcEvent:ge}))}});var V={pointerdown:va,pointermove:Xi,pointerup:Ri,pointercancel:Ji,pointerout:Ji},K={2:Gn,3:ai,4:gi,5:Xn},te="pointerdown",he="pointermove pointerup pointercancel";!Ne&&_e.MSPointerEvent&&!_e.PointerEvent&&(te="MSPointerDown",he="MSPointerMove MSPointerUp MSPointerCancel");function Me(){this.evEl=te,this.evWin=he,xo.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Yt(Me,xo,{handler:function(ge){var Xe=this.store,Pt=!1,Or=ge.type.toLowerCase().replace("ms",""),Pn=V[Or],Ti=K[ge.pointerType]||ge.pointerType,ro=Ti==Gn,Ra=A(Xe,ge.pointerId,"pointerId");Pn&va&&(ge.button===0||ro)?Ra<0&&(Xe.push(ge),Ra=Xe.length-1):Pn&(Ri|Ji)&&(Pt=!0),!(Ra<0)&&(Xe[Ra]=ge,this.callback(this.manager,Pn,{pointers:Xe,changedPointers:[ge],pointerType:Ti,srcEvent:ge}),Pt&&Xe.splice(Ra,1))}});var je={touchstart:va,touchmove:Xi,touchend:Ri,touchcancel:Ji},Qe="touchstart",se="touchstart touchmove touchend touchcancel";function Le(){this.evTarget=Qe,this.evWin=se,this.started=!1,xo.apply(this,arguments)}Yt(Le,xo,{handler:function(ge){var Xe=je[ge.type];if(Xe===va&&(this.started=!0),!!this.started){var Pt=ft.call(this,ge,Xe);Xe&(Ri|Ji)&&Pt[0].length-Pt[1].length==0&&(this.started=!1),this.callback(this.manager,Xe,{pointers:Pt[0],changedPointers:Pt[1],pointerType:Gn,srcEvent:ge})}}});function ft(J,ge){var Xe=Se(J.touches),Pt=Se(J.changedTouches);return ge&(Ri|Ji)&&(Xe=ke(Xe.concat(Pt),"identifier",!0)),[Xe,Pt]}var hr={touchstart:va,touchmove:Xi,touchend:Ri,touchcancel:Ji},Ot="touchstart touchmove touchend touchcancel";function kt(){this.evTarget=Ot,this.targetIds={},xo.apply(this,arguments)}Yt(kt,xo,{handler:function(ge){var Xe=hr[ge.type],Pt=dr.call(this,ge,Xe);!Pt||this.callback(this.manager,Xe,{pointers:Pt[0],changedPointers:Pt[1],pointerType:Gn,srcEvent:ge})}});function dr(J,ge){var Xe=Se(J.touches),Pt=this.targetIds;if(ge&(va|Xi)&&Xe.length===1)return Pt[Xe[0].identifier]=!0,[Xe,Xe];var Or,Pn,Ti=Se(J.changedTouches),ro=[],Ra=this.target;if(Pn=Xe.filter(function(Ua){return Ar(Ua.target,Ra)}),ge===va)for(Or=0;Or<Pn.length;)Pt[Pn[Or].identifier]=!0,Or++;for(Or=0;Or<Ti.length;)Pt[Ti[Or].identifier]&&ro.push(Ti[Or]),ge&(Ri|Ji)&&delete Pt[Ti[Or].identifier],Or++;if(!!ro.length)return[ke(Pn.concat(ro),"identifier",!0),ro]}var En=2500,fn=25;function Mt(){xo.apply(this,arguments);var J=ct(this.handler,this);this.touch=new kt(this.manager,J),this.mouse=new ba(this.manager,J),this.primaryTouch=null,this.lastTouches=[]}Yt(Mt,xo,{handler:function(ge,Xe,Pt){var Or=Pt.pointerType==Gn,Pn=Pt.pointerType==gi;if(!(Pn&&Pt.sourceCapabilities&&Pt.sourceCapabilities.firesTouchEvents)){if(Or)tn.call(this,Xe,Pt);else if(Pn&&Xr.call(this,Pt))return;this.callback(ge,Xe,Pt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function tn(J,ge){J&va?(this.primaryTouch=ge.changedPointers[0].identifier,Ur.call(this,ge)):J&(Ri|Ji)&&Ur.call(this,ge)}function Ur(J){var ge=J.changedPointers[0];if(ge.identifier===this.primaryTouch){var Xe={x:ge.clientX,y:ge.clientY};this.lastTouches.push(Xe);var Pt=this.lastTouches,Or=function(){var Pn=Pt.indexOf(Xe);Pn>-1&&Pt.splice(Pn,1)};setTimeout(Or,En)}}function Xr(J){for(var ge=J.srcEvent.clientX,Xe=J.srcEvent.clientY,Pt=0;Pt<this.lastTouches.length;Pt++){var Or=this.lastTouches[Pt],Pn=Math.abs(ge-Or.x),Ti=Math.abs(Xe-Or.y);if(Pn<=fn&&Ti<=fn)return!0}return!1}var vi=Ne?X:St(tt.style,"touchAction"),rn=vi!==X,nn="compute",ji="auto",fi="manipulation",Ai="none",_i="pan-x",st="pan-y",Ct=wi();function Ca(J,ge){this.manager=J,this.set(ge)}Ca.prototype={set:function(J){J==nn&&(J=this.compute()),rn&&this.manager.element.style&&Ct[J]&&(this.manager.element.style[vi]=J),this.actions=J.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var J=[];return jt(this.manager.recognizers,function(ge){Ke(ge.options.enable,[ge])&&(J=J.concat(ge.getTouchAction()))}),Ci(J.join(" "))},preventDefaults:function(J){var ge=J.srcEvent,Xe=J.offsetDirection;if(this.manager.session.prevented){ge.preventDefault();return}var Pt=this.actions,Or=Wr(Pt,Ai)&&!Ct[Ai],Pn=Wr(Pt,st)&&!Ct[st],Ti=Wr(Pt,_i)&&!Ct[_i];if(Or){var ro=J.pointers.length===1,Ra=J.distance<2,Ua=J.deltaTime<250;if(ro&&Ra&&Ua)return}if(!(Ti&&Pn)&&(Or||Pn&&Xe&aa||Ti&&Xe&ea))return this.preventSrc(ge)},preventSrc:function(J){this.manager.session.prevented=!0,J.preventDefault()}};function Ci(J){if(Wr(J,Ai))return Ai;var ge=Wr(J,_i),Xe=Wr(J,st);return ge&&Xe?Ai:ge||Xe?ge?_i:st:Wr(J,fi)?fi:ji}function wi(){if(!rn)return!1;var J={};if(Ne)return J;var ge=_e.CSS&&_e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Xe){J[Xe]=ge?_e.CSS.supports("touch-action",Xe):!0}),J}var Bi=1,wr=2,an=4,pt=8,ta=pt,ae=16,es=32;function $i(J){this.options=gt({},this.defaults,J||{}),this.id=Ft(),this.manager=null,this.options.enable=wt(this.options.enable,!0),this.state=Bi,this.simultaneous={},this.requireFail=[]}$i.prototype={defaults:{},set:function(J){return gt(this.options,J),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(J){if(nr(J,"recognizeWith",this))return this;var ge=this.simultaneous;return J=Aa(J,this),ge[J.id]||(ge[J.id]=J,J.recognizeWith(this)),this},dropRecognizeWith:function(J){return nr(J,"dropRecognizeWith",this)?this:(J=Aa(J,this),delete this.simultaneous[J.id],this)},requireFailure:function(J){if(nr(J,"requireFailure",this))return this;var ge=this.requireFail;return J=Aa(J,this),A(ge,J)===-1&&(ge.push(J),J.requireFailure(this)),this},dropRequireFailure:function(J){if(nr(J,"dropRequireFailure",this))return this;J=Aa(J,this);var ge=A(this.requireFail,J);return ge>-1&&this.requireFail.splice(ge,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(J){return!!this.simultaneous[J.id]},emit:function(J){var ge=this,Xe=this.state;function Pt(Or){ge.manager.emit(Or,J)}Xe<pt&&Pt(ge.options.event+Eu(Xe)),Pt(ge.options.event),J.additionalEvent&&Pt(J.additionalEvent),Xe>=pt&&Pt(ge.options.event+Eu(Xe))},tryEmit:function(J){if(this.canEmit())return this.emit(J);this.state=es},canEmit:function(){for(var J=0;J<this.requireFail.length;){if(!(this.requireFail[J].state&(es|Bi)))return!1;J++}return!0},recognize:function(J){var ge=gt({},J);if(!Ke(this.options.enable,[this,ge])){this.reset(),this.state=es;return}this.state&(ta|ae|es)&&(this.state=Bi),this.state=this.process(ge),this.state&(wr|an|pt|ae)&&this.tryEmit(ge)},process:function(J){},getTouchAction:function(){},reset:function(){}};function Eu(J){return J&ae?"cancel":J&pt?"end":J&an?"move":J&wr?"start":""}function za(J){return J==Ui?"down":J==xa?"up":J==Do?"left":J==Oa?"right":""}function Aa(J,ge){var Xe=ge.manager;return Xe?Xe.get(J):J}function Ya(){$i.apply(this,arguments)}Yt(Ya,$i,{defaults:{pointers:1},attrTest:function(J){var ge=this.options.pointers;return ge===0||J.pointers.length===ge},process:function(J){var ge=this.state,Xe=J.eventType,Pt=ge&(wr|an),Or=this.attrTest(J);return Pt&&(Xe&Ji||!Or)?ge|ae:Pt||Or?Xe&Ri?ge|pt:ge&wr?ge|an:wr:es}});function ra(){Ya.apply(this,arguments),this.pX=null,this.pY=null}Yt(ra,Ya,{defaults:{event:"pan",threshold:10,pointers:1,direction:Os},getTouchAction:function(){var J=this.options.direction,ge=[];return J&aa&&ge.push(st),J&ea&&ge.push(_i),ge},directionTest:function(J){var ge=this.options,Xe=!0,Pt=J.distance,Or=J.direction,Pn=J.deltaX,Ti=J.deltaY;return Or&ge.direction||(ge.direction&aa?(Or=Pn===0?ma:Pn<0?Do:Oa,Xe=Pn!=this.pX,Pt=Math.abs(J.deltaX)):(Or=Ti===0?ma:Ti<0?xa:Ui,Xe=Ti!=this.pY,Pt=Math.abs(J.deltaY))),J.direction=Or,Xe&&Pt>ge.threshold&&Or&ge.direction},attrTest:function(J){return Ya.prototype.attrTest.call(this,J)&&(this.state&wr||!(this.state&wr)&&this.directionTest(J))},emit:function(J){this.pX=J.deltaX,this.pY=J.deltaY;var ge=za(J.direction);ge&&(J.additionalEvent=this.options.event+ge),this._super.emit.call(this,J)}});function Po(){Ya.apply(this,arguments)}Yt(Po,Ya,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ai]},attrTest:function(J){return this._super.attrTest.call(this,J)&&(Math.abs(J.scale-1)>this.options.threshold||this.state&wr)},emit:function(J){if(J.scale!==1){var ge=J.scale<1?"in":"out";J.additionalEvent=this.options.event+ge}this._super.emit.call(this,J)}});function Wo(){$i.apply(this,arguments),this._timer=null,this._input=null}Yt(Wo,$i,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ji]},process:function(J){var ge=this.options,Xe=J.pointers.length===ge.pointers,Pt=J.distance<ge.threshold,Or=J.deltaTime>ge.time;if(this._input=J,!Pt||!Xe||J.eventType&(Ri|Ji)&&!Or)this.reset();else if(J.eventType&va)this.reset(),this._timer=Lt(function(){this.state=ta,this.tryEmit()},ge.time,this);else if(J.eventType&Ri)return ta;return es},reset:function(){clearTimeout(this._timer)},emit:function(J){this.state===ta&&(J&&J.eventType&Ri?this.manager.emit(this.options.event+"up",J):(this._input.timeStamp=pr(),this.manager.emit(this.options.event,this._input)))}});function Bu(){Ya.apply(this,arguments)}Yt(Bu,Ya,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ai]},attrTest:function(J){return this._super.attrTest.call(this,J)&&(Math.abs(J.rotation)>this.options.threshold||this.state&wr)}});function ho(){Ya.apply(this,arguments)}Yt(ho,Ya,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:aa|ea,pointers:1},getTouchAction:function(){return ra.prototype.getTouchAction.call(this)},attrTest:function(J){var ge=this.options.direction,Xe;return ge&(aa|ea)?Xe=J.overallVelocity:ge&aa?Xe=J.overallVelocityX:ge&ea&&(Xe=J.overallVelocityY),this._super.attrTest.call(this,J)&&ge&J.offsetDirection&&J.distance>this.options.threshold&&J.maxPointers==this.options.pointers&&tr(Xe)>this.options.velocity&&J.eventType&Ri},emit:function(J){var ge=za(J.offsetDirection);ge&&this.manager.emit(this.options.event+ge,J),this.manager.emit(this.options.event,J)}});function Fo(){$i.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Yt(Fo,$i,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[fi]},process:function(J){var ge=this.options,Xe=J.pointers.length===ge.pointers,Pt=J.distance<ge.threshold,Or=J.deltaTime<ge.time;if(this.reset(),J.eventType&va&&this.count===0)return this.failTimeout();if(Pt&&Or&&Xe){if(J.eventType!=Ri)return this.failTimeout();var Pn=this.pTime?J.timeStamp-this.pTime<ge.interval:!0,Ti=!this.pCenter||Sn(this.pCenter,J.center)<ge.posThreshold;this.pTime=J.timeStamp,this.pCenter=J.center,!Ti||!Pn?this.count=1:this.count+=1,this._input=J;var ro=this.count%ge.taps;if(ro===0)return this.hasRequireFailures()?(this._timer=Lt(function(){this.state=ta,this.tryEmit()},ge.interval,this),wr):ta}return es},failTimeout:function(){return this._timer=Lt(function(){this.state=es},this.options.interval,this),es},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ta&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function na(J,ge){return ge=ge||{},ge.recognizers=wt(ge.recognizers,na.defaults.preset),new Ka(J,ge)}na.VERSION="2.0.7",na.defaults={domEvents:!1,touchAction:nn,enable:!0,inputTarget:null,inputClass:null,preset:[[Bu,{enable:!1}],[Po,{enable:!1},["rotate"]],[ho,{direction:aa}],[ra,{direction:aa},["swipe"]],[Fo],[Fo,{event:"doubletap",taps:2},["tap"]],[Wo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var qa=1,Bo=2;function Ka(J,ge){this.options=gt({},na.defaults,ge||{}),this.options.inputTarget=this.options.inputTarget||J,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=J,this.input=au(this),this.touchAction=new Ca(this,this.options.touchAction),Rs(this,!0),jt(this.options.recognizers,function(Xe){var Pt=this.add(new Xe[0](Xe[1]));Xe[2]&&Pt.recognizeWith(Xe[2]),Xe[3]&&Pt.requireFailure(Xe[3])},this)}Ka.prototype={set:function(J){return gt(this.options,J),J.touchAction&&this.touchAction.update(),J.inputTarget&&(this.input.destroy(),this.input.target=J.inputTarget,this.input.init()),this},stop:function(J){this.session.stopped=J?Bo:qa},recognize:function(J){var ge=this.session;if(!ge.stopped){this.touchAction.preventDefaults(J);var Xe,Pt=this.recognizers,Or=ge.curRecognizer;(!Or||Or&&Or.state&ta)&&(Or=ge.curRecognizer=null);for(var Pn=0;Pn<Pt.length;)Xe=Pt[Pn],ge.stopped!==Bo&&(!Or||Xe==Or||Xe.canRecognizeWith(Or))?Xe.recognize(J):Xe.reset(),!Or&&Xe.state&(wr|an|pt)&&(Or=ge.curRecognizer=Xe),Pn++}},get:function(J){if(J instanceof $i)return J;for(var ge=this.recognizers,Xe=0;Xe<ge.length;Xe++)if(ge[Xe].options.event==J)return ge[Xe];return null},add:function(J){if(nr(J,"add",this))return this;var ge=this.get(J.options.event);return ge&&this.remove(ge),this.recognizers.push(J),J.manager=this,this.touchAction.update(),J},remove:function(J){if(nr(J,"remove",this))return this;if(J=this.get(J),J){var ge=this.recognizers,Xe=A(ge,J);Xe!==-1&&(ge.splice(Xe,1),this.touchAction.update())}return this},on:function(J,ge){if(J!==X&&ge!==X){var Xe=this.handlers;return jt(on(J),function(Pt){Xe[Pt]=Xe[Pt]||[],Xe[Pt].push(ge)}),this}},off:function(J,ge){if(J!==X){var Xe=this.handlers;return jt(on(J),function(Pt){ge?Xe[Pt]&&Xe[Pt].splice(A(Xe[Pt],ge),1):delete Xe[Pt]}),this}},emit:function(J,ge){this.options.domEvents&&Il(J,ge);var Xe=this.handlers[J]&&this.handlers[J].slice();if(!(!Xe||!Xe.length)){ge.type=J,ge.preventDefault=function(){ge.srcEvent.preventDefault()};for(var Pt=0;Pt<Xe.length;)Xe[Pt](ge),Pt++}},destroy:function(){this.element&&Rs(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Rs(J,ge){var Xe=J.element;if(!!Xe.style){var Pt;jt(J.options.cssProps,function(Or,Pn){Pt=St(Xe.style,Pn),ge?(J.oldCssProps[Pt]=Xe.style[Pt],Xe.style[Pt]=Or):Xe.style[Pt]=J.oldCssProps[Pt]||""}),ge||(J.oldCssProps={})}}function Il(J,ge){if(!Ne){var Xe=g.createEvent("Event");Xe.initEvent(J,!0,!0),Xe.gesture=ge,ge.target.dispatchEvent(Xe)}}if(!Ne){gt(na,{INPUT_START:va,INPUT_MOVE:Xi,INPUT_END:Ri,INPUT_CANCEL:Ji,STATE_POSSIBLE:Bi,STATE_BEGAN:wr,STATE_CHANGED:an,STATE_ENDED:pt,STATE_RECOGNIZED:ta,STATE_CANCELLED:ae,STATE_FAILED:es,DIRECTION_NONE:ma,DIRECTION_LEFT:Do,DIRECTION_RIGHT:Oa,DIRECTION_UP:xa,DIRECTION_DOWN:Ui,DIRECTION_HORIZONTAL:aa,DIRECTION_VERTICAL:ea,DIRECTION_ALL:Os,Manager:Ka,Input:xo,TouchAction:Ca,TouchInput:kt,MouseInput:ba,PointerEventInput:Me,TouchMouseInput:Mt,SingleTouchInput:Le,Recognizer:$i,AttrRecognizer:Ya,Tap:Fo,Pan:ra,Swipe:ho,Pinch:Po,Rotate:Bu,Press:Wo,on:et,off:qt,each:jt,merge:q,extend:sr,assign:gt,inherit:Yt,bindFn:ct,prefixed:St});var ys=typeof window!="undefined"?window:typeof self!="undefined"?self:{};ys.Hammer=na,Oe=function(){return na}.call(ie,ee,ie,Tr),Oe!==X&&(Tr.exports=Oe)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(Tr,ie,ee){(function(Oe,_e){Tr.exports=_e(ee(18857))})(this,function(Oe){"use strict";var _e=function(B){return B instanceof Uint8Array||B instanceof Uint16Array||B instanceof Uint32Array||B instanceof Int8Array||B instanceof Int16Array||B instanceof Int32Array||B instanceof Float32Array||B instanceof Float64Array||B instanceof Uint8ClampedArray},g=function(B,ce){for(var Fe=Object.keys(ce),Rt=0;Rt<Fe.length;++Rt)B[Fe[Rt]]=ce[Fe[Rt]];return B},Re=`
`;function X(B){return typeof atob!="undefined"?atob(B):"base64:"+B}function pe(B){var ce=new Error("(regl) "+B);throw console.error(ce),ce}function de(B,ce){B||pe(ce)}function Ne(B){return B?": "+B:""}function xe(B,ce,Fe){B in ce||pe("unknown parameter ("+B+")"+Ne(Fe)+". possible values: "+Object.keys(ce).join())}function tt(B,ce){_e(B)||pe("invalid parameter type"+Ne(ce)+". must be a typed array")}function dt(B,ce){switch(ce){case"number":return typeof B=="number";case"object":return typeof B=="object";case"string":return typeof B=="string";case"boolean":return typeof B=="boolean";case"function":return typeof B=="function";case"undefined":return typeof B=="undefined";case"symbol":return typeof B=="symbol"}}function At(B,ce,Fe){dt(B,ce)||pe("invalid parameter type"+Ne(Fe)+". expected "+ce+", got "+typeof B)}function tr(B,ce){B>=0&&(B|0)===B||pe("invalid parameter type, ("+B+")"+Ne(ce)+". must be a nonnegative integer")}function pr(B,ce,Fe){ce.indexOf(B)<0&&pe("invalid value"+Ne(Fe)+". must be one of: "+ce)}var Lt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function nr(B){Object.keys(B).forEach(function(ce){Lt.indexOf(ce)<0&&pe('invalid regl constructor argument "'+ce+'". must be one of '+Lt)})}function jt(B,ce){for(B=B+"";B.length<ce;)B=" "+B;return B}function ht(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function gt(B,ce){this.number=B,this.line=ce,this.errors=[]}function sr(B,ce,Fe){this.file=B,this.line=ce,this.message=Fe}function q(){var B=new Error,ce=(B.stack||B).toString(),Fe=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(ce);if(Fe)return Fe[1];var Rt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(ce);return Rt?Rt[1]:"unknown"}function Yt(){var B=new Error,ce=(B.stack||B).toString(),Fe=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(ce);if(Fe)return Fe[1];var Rt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(ce);return Rt?Rt[1]:"unknown"}function ct(B,ce){var Fe=B.split(`
`),Rt=1,ar=0,It={unknown:new ht,0:new ht};It.unknown.name=It[0].name=ce||q(),It.unknown.lines.push(new gt(0,""));for(var Kt=0;Kt<Fe.length;++Kt){var cr=Fe[Kt],mr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(cr);if(mr)switch(mr[1]){case"line":var yr=/(\d+)(\s+\d+)?/.exec(mr[2]);yr&&(Rt=yr[1]|0,yr[2]&&(ar=yr[2]|0,ar in It||(It[ar]=new ht)));break;case"define":var Sr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(mr[2]);Sr&&(It[ar].name=Sr[1]?X(Sr[2]):Sr[2]);break}It[ar].lines.push(new gt(Rt++,cr))}return Object.keys(It).forEach(function(Mr){var Gr=It[Mr];Gr.lines.forEach(function(_r){Gr.index[_r.number]=_r})}),It}function Ke(B){var ce=[];return B.split(`
`).forEach(function(Fe){if(!(Fe.length<5)){var Rt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Fe);Rt?ce.push(new sr(Rt[1]|0,Rt[2]|0,Rt[3].trim())):Fe.length>0&&ce.push(new sr("unknown",0,Fe))}}),ce}function wt(B,ce){ce.forEach(function(Fe){var Rt=B[Fe.file];if(Rt){var ar=Rt.index[Fe.line];if(ar){ar.errors.push(Fe),Rt.hasErrors=!0;return}}B.unknown.hasErrors=!0,B.unknown.lines[0].errors.push(Fe)})}function et(B,ce,Fe,Rt,ar){if(!B.getShaderParameter(ce,B.COMPILE_STATUS)){var It=B.getShaderInfoLog(ce),Kt=Rt===B.FRAGMENT_SHADER?"fragment":"vertex";ke(Fe,"string",Kt+" shader source must be a string",ar);var cr=ct(Fe,ar),mr=Ke(It);wt(cr,mr),Object.keys(cr).forEach(function(yr){var Sr=cr[yr];if(!Sr.hasErrors)return;var Mr=[""],Gr=[""];function _r(br,nt){Mr.push(br),Gr.push(nt||"")}_r("file number "+yr+": "+Sr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Sr.lines.forEach(function(br){if(br.errors.length>0){_r(jt(br.number,4)+"|  ","background-color:yellow; font-weight:bold"),_r(br.line+Re,"color:red; background-color:yellow; font-weight:bold");var nt=0;br.errors.forEach(function(Zt){var Qt=Zt.message,Pr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Qt);if(Pr){var lr=Pr[1];switch(Qt=Pr[2],lr){case"assign":lr="=";break}nt=Math.max(br.line.indexOf(lr,nt),0)}else nt=0;_r(jt("| ",6)),_r(jt("^^^",nt+3)+Re,"font-weight:bold"),_r(jt("| ",6)),_r(Qt+Re,"font-weight:bold")}),_r(jt("| ",6)+Re)}else _r(jt(br.number,4)+"|  "),_r(br.line+Re,"color:red")}),typeof document!="undefined"&&!window.chrome?(Gr[0]=Mr.join("%c"),console.log.apply(console,Gr)):console.log(Mr.join(""))}),de.raise("Error compiling "+Kt+" shader, "+cr[0].name)}}function qt(B,ce,Fe,Rt,ar){if(!B.getProgramParameter(ce,B.LINK_STATUS)){var It=B.getProgramInfoLog(ce),Kt=ct(Fe,ar),cr=ct(Rt,ar),mr='Error linking program with vertex shader, "'+cr[0].name+'", and fragment shader "'+Kt[0].name+'"';typeof document!="undefined"?console.log("%c"+mr+Re+"%c"+It,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(mr+Re+It),de.raise(mr)}}function Ar(B){B._commandRef=q()}function Wr(B,ce,Fe,Rt){Ar(B);function ar(mr){return mr?Rt.id(mr):0}B._fragId=ar(B.static.frag),B._vertId=ar(B.static.vert);function It(mr,yr){Object.keys(yr).forEach(function(Sr){mr[Rt.id(Sr)]=!0})}var Kt=B._uniformSet={};It(Kt,ce.static),It(Kt,ce.dynamic);var cr=B._attributeSet={};It(cr,Fe.static),It(cr,Fe.dynamic),B._hasCount="count"in B.static||"count"in B.dynamic||"elements"in B.static||"elements"in B.dynamic}function on(B,ce){var Fe=Yt();pe(B+" in command "+(ce||q())+(Fe==="unknown"?"":" called from "+Fe))}function A(B,ce,Fe){B||on(ce,Fe||q())}function Se(B,ce,Fe,Rt){B in ce||on("unknown parameter ("+B+")"+Ne(Fe)+". possible values: "+Object.keys(ce).join(),Rt||q())}function ke(B,ce,Fe,Rt){dt(B,ce)||on("invalid parameter type"+Ne(Fe)+". expected "+ce+", got "+typeof B,Rt||q())}function St(B){B()}function vt(B,ce,Fe){B.texture?pr(B.texture._texture.internalformat,ce,"unsupported texture format for attachment"):pr(B.renderbuffer._renderbuffer.format,Fe,"unsupported renderbuffer format for attachment")}var Ft=33071,Wt=9728,Er=9984,$n=9985,_n=9986,mi=9987,Gn=5120,ai=5121,gi=5122,Xn=5123,yi=5124,va=5125,Xi=5126,Ri=32819,Ji=32820,ma=33635,Do=34042,Oa=36193,xa={};xa[Gn]=xa[ai]=1,xa[gi]=xa[Xn]=xa[Oa]=xa[ma]=xa[Ri]=xa[Ji]=2,xa[yi]=xa[va]=xa[Xi]=xa[Do]=4;function Ui(B,ce){return B===Ji||B===Ri||B===ma?2:B===Do?4:xa[B]*ce}function aa(B){return!(B&B-1)&&!!B}function ea(B,ce,Fe){var Rt,ar=ce.width,It=ce.height,Kt=ce.channels;de(ar>0&&ar<=Fe.maxTextureSize&&It>0&&It<=Fe.maxTextureSize,"invalid texture shape"),(B.wrapS!==Ft||B.wrapT!==Ft)&&de(aa(ar)&&aa(It),"incompatible wrap mode for texture, both width and height must be power of 2"),ce.mipmask===1?ar!==1&&It!==1&&de(B.minFilter!==Er&&B.minFilter!==_n&&B.minFilter!==$n&&B.minFilter!==mi,"min filter requires mipmap"):(de(aa(ar)&&aa(It),"texture must be a square power of 2 to support mipmapping"),de(ce.mipmask===(ar<<1)-1,"missing or incomplete mipmap data")),ce.type===Xi&&(Fe.extensions.indexOf("oes_texture_float_linear")<0&&de(B.minFilter===Wt&&B.magFilter===Wt,"filter not supported, must enable oes_texture_float_linear"),de(!B.genMipmaps,"mipmap generation not supported with float textures"));var cr=ce.images;for(Rt=0;Rt<16;++Rt)if(cr[Rt]){var mr=ar>>Rt,yr=It>>Rt;de(ce.mipmask&1<<Rt,"missing mipmap data");var Sr=cr[Rt];if(de(Sr.width===mr&&Sr.height===yr,"invalid shape for mip images"),de(Sr.format===ce.format&&Sr.internalformat===ce.internalformat&&Sr.type===ce.type,"incompatible type for mip image"),!Sr.compressed)if(Sr.data){var Mr=Math.ceil(Ui(Sr.type,Kt)*mr/Sr.unpackAlignment)*Sr.unpackAlignment;de(Sr.data.byteLength===Mr*yr,"invalid data for image, buffer size is inconsistent with image format")}else Sr.element||Sr.copy}else B.genMipmaps||de((ce.mipmask&1<<Rt)==0,"extra mipmap data");ce.compressed&&de(!B.genMipmaps,"mipmap generation for compressed images not supported")}function Os(B,ce,Fe,Rt){var ar=B.width,It=B.height,Kt=B.channels;de(ar>0&&ar<=Rt.maxTextureSize&&It>0&&It<=Rt.maxTextureSize,"invalid texture shape"),de(ar===It,"cube map must be square"),de(ce.wrapS===Ft&&ce.wrapT===Ft,"wrap mode not supported by cube map");for(var cr=0;cr<Fe.length;++cr){var mr=Fe[cr];de(mr.width===ar&&mr.height===It,"inconsistent cube map face shape"),ce.genMipmaps&&(de(!mr.compressed,"can not generate mipmap for compressed textures"),de(mr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var yr=mr.images,Sr=0;Sr<16;++Sr){var Mr=yr[Sr];if(Mr){var Gr=ar>>Sr,_r=It>>Sr;de(mr.mipmask&1<<Sr,"missing mipmap data"),de(Mr.width===Gr&&Mr.height===_r,"invalid shape for mip images"),de(Mr.format===B.format&&Mr.internalformat===B.internalformat&&Mr.type===B.type,"incompatible type for mip image"),Mr.compressed||(Mr.data?de(Mr.data.byteLength===Gr*_r*Math.max(Ui(Mr.type,Kt),Mr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Mr.element||Mr.copy)}}}}var fe=g(de,{optional:St,raise:pe,commandRaise:on,command:A,parameter:xe,commandParameter:Se,constructor:nr,type:At,commandType:ke,isTypedArray:tt,nni:tr,oneOf:pr,shaderError:et,linkError:qt,callSite:Yt,saveCommandRef:Ar,saveDrawInfo:Wr,framebufferFormat:vt,guessCommand:q,texture2D:ea,textureCube:Os}),oi=0,xo=0,au=5,Nt=6;function Jt(B,ce){this.id=oi++,this.type=B,this.data=ce}function Dr(B){return B.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function cn(B){if(B.length===0)return[];var ce=B.charAt(0),Fe=B.charAt(B.length-1);if(B.length>1&&ce===Fe&&(ce==='"'||ce==="'"))return['"'+Dr(B.substr(1,B.length-2))+'"'];var Rt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(B);if(Rt)return cn(B.substr(0,Rt.index)).concat(cn(Rt[1])).concat(cn(B.substr(Rt.index+Rt[0].length)));var ar=B.split(".");if(ar.length===1)return['"'+Dr(B)+'"'];for(var It=[],Kt=0;Kt<ar.length;++Kt)It=It.concat(cn(ar[Kt]));return It}function wn(B){return"["+cn(B).join("][")+"]"}function Nn(B,ce){return new Jt(B,wn(ce+""))}function Ei(B){return typeof B=="function"&&!B._reglType||B instanceof Jt}function di(B,ce){if(typeof B=="function")return new Jt(xo,B);if(typeof B=="number"||typeof B=="boolean")return new Jt(au,B);if(Array.isArray(B))return new Jt(Nt,B.map(function(Fe,Rt){return di(Fe,ce+"["+Rt+"]")}));if(B instanceof Jt)return B;fe(!1,"invalid option type in uniform "+ce)}var Sn={DynamicVariable:Jt,define:Nn,isDynamic:Ei,unbox:di,accessor:wn},Pi={next:typeof requestAnimationFrame=="function"?function(B){return requestAnimationFrame(B)}:function(B){return setTimeout(B,16)},cancel:typeof cancelAnimationFrame=="function"?function(B){return cancelAnimationFrame(B)}:clearTimeout},Mi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,to=Mi?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function gs(){var B={"":0},ce=[""];return{id:function(Fe){var Rt=B[Fe];return Rt||(Rt=B[Fe]=ce.length,ce.push(Fe),Rt)},str:function(Fe){return ce[Fe]}}}function Ho(B,ce,Fe){var Rt=document.createElement("canvas");g(Rt.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),B.appendChild(Rt),B===document.body&&(Rt.style.position="absolute",g(B.style,{margin:0,padding:0}));function ar(){var cr=window.innerWidth,mr=window.innerHeight;if(B!==document.body){var yr=Rt.getBoundingClientRect();cr=yr.right-yr.left,mr=yr.bottom-yr.top}Rt.width=Fe*cr,Rt.height=Fe*mr}var It;B!==document.body&&typeof ResizeObserver=="function"?(It=new ResizeObserver(function(){setTimeout(ar)}),It.observe(B)):window.addEventListener("resize",ar,!1);function Kt(){It?It.disconnect():window.removeEventListener("resize",ar),B.removeChild(Rt)}return ar(),{canvas:Rt,onDestroy:Kt}}function Na(B,ce){function Fe(Rt){try{return B.getContext(Rt,ce)}catch(ar){return null}}return Fe("webgl")||Fe("experimental-webgl")||Fe("webgl-experimental")}function ba(B){return typeof B.nodeName=="string"&&typeof B.appendChild=="function"&&typeof B.getBoundingClientRect=="function"}function V(B){return typeof B.drawArrays=="function"||typeof B.drawElements=="function"}function K(B){return typeof B=="string"?B.split():(fe(Array.isArray(B),"invalid extension array"),B)}function te(B){return typeof B=="string"?(fe(typeof document!="undefined","not supported outside of DOM"),document.querySelector(B)):B}function he(B){var ce=B||{},Fe,Rt,ar,It,Kt={},cr=[],mr=[],yr=typeof window=="undefined"?1:window.devicePixelRatio,Sr=!1,Mr=function(br){br&&fe.raise(br)},Gr=function(){};if(typeof ce=="string"?(fe(typeof document!="undefined","selector queries only supported in DOM environments"),Fe=document.querySelector(ce),fe(Fe,"invalid query string for element")):typeof ce=="object"?ba(ce)?Fe=ce:V(ce)?(It=ce,ar=It.canvas):(fe.constructor(ce),"gl"in ce?It=ce.gl:"canvas"in ce?ar=te(ce.canvas):"container"in ce&&(Rt=te(ce.container)),"attributes"in ce&&(Kt=ce.attributes,fe.type(Kt,"object","invalid context attributes")),"extensions"in ce&&(cr=K(ce.extensions)),"optionalExtensions"in ce&&(mr=K(ce.optionalExtensions)),"onDone"in ce&&(fe.type(ce.onDone,"function","invalid or missing onDone callback"),Mr=ce.onDone),"profile"in ce&&(Sr=!!ce.profile),"pixelRatio"in ce&&(yr=+ce.pixelRatio,fe(yr>0,"invalid pixel ratio"))):fe.raise("invalid arguments to regl"),Fe&&(Fe.nodeName.toLowerCase()==="canvas"?ar=Fe:Rt=Fe),!It){if(!ar){fe(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var _r=Ho(Rt||document.body,Mr,yr);if(!_r)return null;ar=_r.canvas,Gr=_r.onDestroy}Kt.premultipliedAlpha===void 0&&(Kt.premultipliedAlpha=!0),It=Na(ar,Kt)}return It?{gl:It,canvas:ar,container:Rt,extensions:cr,optionalExtensions:mr,pixelRatio:yr,profile:Sr,onDone:Mr,onDestroy:Gr}:(Gr(),Mr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Me(B,ce){var Fe={};function Rt(cr){fe.type(cr,"string","extension name must be string");var mr=cr.toLowerCase(),yr;try{yr=Fe[mr]=ar(cr)}catch(Sr){}return!!yr}function ar(cr){return B.getExtension(cr)?B.getExtension(cr):B.getExtension(cr.toLowerCase())?B.getExtension(cr.toLowerCase()):null}for(var It=0;It<ce.extensions.length;++It){var Kt=ce.extensions[It];if(!Rt(Kt))return ce.onDestroy(),ce.onDone('"'+Kt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return ce.optionalExtensions.forEach(Rt),{extensions:Fe,restore:function(){Object.keys(Fe).forEach(function(cr){if(Fe[cr]&&!Rt(cr))throw new Error("(regl): error restoring extension "+cr)})}}}function je(B,ce){for(var Fe=Array(B),Rt=0;Rt<B;++Rt)Fe[Rt]=ce(Rt);return Fe}var Qe=5120,se=5121,Le=5122,ft=5123,hr=5124,Ot=5125,kt=5126;function dr(B){for(var ce=16;ce<=1<<28;ce*=16)if(B<=ce)return ce;return 0}function En(B){var ce,Fe;return ce=(B>65535)<<4,B>>>=ce,Fe=(B>255)<<3,B>>>=Fe,ce|=Fe,Fe=(B>15)<<2,B>>>=Fe,ce|=Fe,Fe=(B>3)<<1,B>>>=Fe,ce|=Fe,ce|B>>1}function fn(){var B=je(8,function(){return[]});function ce(It){var Kt=dr(It),cr=B[En(Kt)>>2];return cr.length>0?cr.pop():new ArrayBuffer(Kt)}function Fe(It){B[En(It.byteLength)>>2].push(It)}function Rt(It,Kt){var cr=null;switch(It){case Qe:cr=new Int8Array(ce(Kt),0,Kt);break;case se:cr=new Uint8Array(ce(Kt),0,Kt);break;case Le:cr=new Int16Array(ce(2*Kt),0,Kt);break;case ft:cr=new Uint16Array(ce(2*Kt),0,Kt);break;case hr:cr=new Int32Array(ce(4*Kt),0,Kt);break;case Ot:cr=new Uint32Array(ce(4*Kt),0,Kt);break;case kt:cr=new Float32Array(ce(4*Kt),0,Kt);break;default:return null}return cr.length!==Kt?cr.subarray(0,Kt):cr}function ar(It){Fe(It.buffer)}return{alloc:ce,free:Fe,allocType:Rt,freeType:ar}}var Mt=fn();Mt.zero=fn();var tn=3408,Ur=3410,Xr=3411,vi=3412,rn=3413,nn=3414,ji=3415,fi=33901,Ai=33902,_i=3379,st=3386,Ct=34921,Ca=36347,Ci=36348,wi=35661,Bi=35660,wr=34930,an=36349,pt=34076,ta=34024,ae=7936,es=7937,$i=7938,Eu=35724,za=34047,Aa=36063,Ya=34852,ra=3553,Po=34067,Wo=34069,Bu=33984,ho=6408,Fo=5126,na=5121,qa=36160,Bo=36053,Ka=36064,Rs=16384,Il=function(B,ce){var Fe=1;ce.ext_texture_filter_anisotropic&&(Fe=B.getParameter(za));var Rt=1,ar=1;ce.webgl_draw_buffers&&(Rt=B.getParameter(Ya),ar=B.getParameter(Aa));var It=!!ce.oes_texture_float;if(It){var Kt=B.createTexture();B.bindTexture(ra,Kt),B.texImage2D(ra,0,ho,1,1,0,ho,Fo,null);var cr=B.createFramebuffer();if(B.bindFramebuffer(qa,cr),B.framebufferTexture2D(qa,Ka,ra,Kt,0),B.bindTexture(ra,null),B.checkFramebufferStatus(qa)!==Bo)It=!1;else{B.viewport(0,0,1,1),B.clearColor(1,0,0,1),B.clear(Rs);var mr=Mt.allocType(Fo,4);B.readPixels(0,0,1,1,ho,Fo,mr),B.getError()?It=!1:(B.deleteFramebuffer(cr),B.deleteTexture(Kt),It=mr[0]===1),Mt.freeType(mr)}}var yr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Sr=!0;if(!yr){var Mr=B.createTexture(),Gr=Mt.allocType(na,36);B.activeTexture(Bu),B.bindTexture(Po,Mr),B.texImage2D(Wo,0,ho,3,3,0,ho,na,Gr),Mt.freeType(Gr),B.bindTexture(Po,null),B.deleteTexture(Mr),Sr=!B.getError()}return{colorBits:[B.getParameter(Ur),B.getParameter(Xr),B.getParameter(vi),B.getParameter(rn)],depthBits:B.getParameter(nn),stencilBits:B.getParameter(ji),subpixelBits:B.getParameter(tn),extensions:Object.keys(ce).filter(function(_r){return!!ce[_r]}),maxAnisotropic:Fe,maxDrawbuffers:Rt,maxColorAttachments:ar,pointSizeDims:B.getParameter(fi),lineWidthDims:B.getParameter(Ai),maxViewportDims:B.getParameter(st),maxCombinedTextureUnits:B.getParameter(wi),maxCubeMapSize:B.getParameter(pt),maxRenderbufferSize:B.getParameter(ta),maxTextureUnits:B.getParameter(wr),maxTextureSize:B.getParameter(_i),maxAttributes:B.getParameter(Ct),maxVertexUniforms:B.getParameter(Ca),maxVertexTextureUnits:B.getParameter(Bi),maxVaryingVectors:B.getParameter(Ci),maxFragmentUniforms:B.getParameter(an),glsl:B.getParameter(Eu),renderer:B.getParameter(es),vendor:B.getParameter(ae),version:B.getParameter($i),readFloat:It,npotTextureCube:Sr}};function ys(B){return!!B&&typeof B=="object"&&Array.isArray(B.shape)&&Array.isArray(B.stride)&&typeof B.offset=="number"&&B.shape.length===B.stride.length&&(Array.isArray(B.data)||_e(B.data))}var J=function(B){return Object.keys(B).map(function(ce){return B[ce]})},ge={shape:ro,flatten:Ti};function Xe(B,ce,Fe){for(var Rt=0;Rt<ce;++Rt)Fe[Rt]=B[Rt]}function Pt(B,ce,Fe,Rt){for(var ar=0,It=0;It<ce;++It)for(var Kt=B[It],cr=0;cr<Fe;++cr)Rt[ar++]=Kt[cr]}function Or(B,ce,Fe,Rt,ar,It){for(var Kt=It,cr=0;cr<ce;++cr)for(var mr=B[cr],yr=0;yr<Fe;++yr)for(var Sr=mr[yr],Mr=0;Mr<Rt;++Mr)ar[Kt++]=Sr[Mr]}function Pn(B,ce,Fe,Rt,ar){for(var It=1,Kt=Fe+1;Kt<ce.length;++Kt)It*=ce[Kt];var cr=ce[Fe];if(ce.length-Fe==4){var mr=ce[Fe+1],yr=ce[Fe+2],Sr=ce[Fe+3];for(Kt=0;Kt<cr;++Kt)Or(B[Kt],mr,yr,Sr,Rt,ar),ar+=It}else for(Kt=0;Kt<cr;++Kt)Pn(B[Kt],ce,Fe+1,Rt,ar),ar+=It}function Ti(B,ce,Fe,Rt){var ar=1;if(ce.length)for(var It=0;It<ce.length;++It)ar*=ce[It];else ar=0;var Kt=Rt||Mt.allocType(Fe,ar);switch(ce.length){case 0:break;case 1:Xe(B,ce[0],Kt);break;case 2:Pt(B,ce[0],ce[1],Kt);break;case 3:Or(B,ce[0],ce[1],ce[2],Kt,0);break;default:Pn(B,ce,0,Kt,0)}return Kt}function ro(B){for(var ce=[],Fe=B;Fe.length;Fe=Fe[0])ce.push(Fe.length);return ce}var Ra={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ua=5120,Xo=5122,_s=5124,oo=5121,Io=5123,xs=5125,Ls=5126,zs=5126,ou={int8:Ua,int16:Xo,int32:_s,uint8:oo,uint16:Io,uint32:xs,float:Ls,float32:zs},bs=35048,ga=35040,ya={dynamic:bs,stream:ga,static:35044},us=ge.flatten,tf=ge.shape,Ol=35044,qs=35040,ic=5121,Qu=5126,Ks=[];Ks[5120]=1,Ks[5122]=2,Ks[5124]=4,Ks[5121]=1,Ks[5123]=2,Ks[5125]=4,Ks[5126]=4;function dl(B){return Ra[Object.prototype.toString.call(B)]|0}function _(B,ce){for(var Fe=0;Fe<ce.length;++Fe)B[Fe]=ce[Fe]}function M(B,ce,Fe,Rt,ar,It,Kt){for(var cr=0,mr=0;mr<Fe;++mr)for(var yr=0;yr<Rt;++yr)B[cr++]=ce[ar*mr+It*yr+Kt]}function F(B,ce,Fe,Rt){var ar=0,It={};function Kt(nt){this.id=ar++,this.buffer=B.createBuffer(),this.type=nt,this.usage=Ol,this.byteLength=0,this.dimension=1,this.dtype=ic,this.persistentData=null,Fe.profile&&(this.stats={size:0})}Kt.prototype.bind=function(){B.bindBuffer(this.type,this.buffer)},Kt.prototype.destroy=function(){Gr(this)};var cr=[];function mr(nt,Zt){var Qt=cr.pop();return Qt||(Qt=new Kt(nt)),Qt.bind(),Mr(Qt,Zt,qs,0,1,!1),Qt}function yr(nt){cr.push(nt)}function Sr(nt,Zt,Qt){nt.byteLength=Zt.byteLength,B.bufferData(nt.type,Zt,Qt)}function Mr(nt,Zt,Qt,Pr,lr,Rr){var $r;if(nt.usage=Qt,Array.isArray(Zt)){if(nt.dtype=Pr||Qu,Zt.length>0){var Bn;if(Array.isArray(Zt[0])){$r=tf(Zt);for(var $t=1,er=1;er<$r.length;++er)$t*=$r[er];nt.dimension=$t,Bn=us(Zt,$r,nt.dtype),Sr(nt,Bn,Qt),Rr?nt.persistentData=Bn:Mt.freeType(Bn)}else if(typeof Zt[0]=="number"){nt.dimension=lr;var dn=Mt.allocType(nt.dtype,Zt.length);_(dn,Zt),Sr(nt,dn,Qt),Rr?nt.persistentData=dn:Mt.freeType(dn)}else _e(Zt[0])?(nt.dimension=Zt[0].length,nt.dtype=Pr||dl(Zt[0])||Qu,Bn=us(Zt,[Zt.length,Zt[0].length],nt.dtype),Sr(nt,Bn,Qt),Rr?nt.persistentData=Bn:Mt.freeType(Bn)):fe.raise("invalid buffer data")}}else if(_e(Zt))nt.dtype=Pr||dl(Zt),nt.dimension=lr,Sr(nt,Zt,Qt),Rr&&(nt.persistentData=new Uint8Array(new Uint8Array(Zt.buffer)));else if(ys(Zt)){$r=Zt.shape;var Yr=Zt.stride,xr=Zt.offset,Fr=0,Hr=0,si=0,ni=0;$r.length===1?(Fr=$r[0],Hr=1,si=Yr[0],ni=0):$r.length===2?(Fr=$r[0],Hr=$r[1],si=Yr[0],ni=Yr[1]):fe.raise("invalid shape"),nt.dtype=Pr||dl(Zt.data)||Qu,nt.dimension=Hr;var Vr=Mt.allocType(nt.dtype,Fr*Hr);M(Vr,Zt.data,Fr,Hr,si,ni,xr),Sr(nt,Vr,Qt),Rr?nt.persistentData=Vr:Mt.freeType(Vr)}else Zt instanceof ArrayBuffer?(nt.dtype=ic,nt.dimension=lr,Sr(nt,Zt,Qt),Rr&&(nt.persistentData=new Uint8Array(new Uint8Array(Zt)))):fe.raise("invalid buffer data")}function Gr(nt){ce.bufferCount--,Rt(nt);var Zt=nt.buffer;fe(Zt,"buffer must not be deleted already"),B.deleteBuffer(Zt),nt.buffer=null,delete It[nt.id]}function _r(nt,Zt,Qt,Pr){ce.bufferCount++;var lr=new Kt(Zt);It[lr.id]=lr;function Rr($t){var er=Ol,dn=null,Yr=0,xr=0,Fr=1;return Array.isArray($t)||_e($t)||ys($t)||$t instanceof ArrayBuffer?dn=$t:typeof $t=="number"?Yr=$t|0:$t&&(fe.type($t,"object","buffer arguments must be an object, a number or an array"),"data"in $t&&(fe(dn===null||Array.isArray(dn)||_e(dn)||ys(dn),"invalid data for buffer"),dn=$t.data),"usage"in $t&&(fe.parameter($t.usage,ya,"invalid buffer usage"),er=ya[$t.usage]),"type"in $t&&(fe.parameter($t.type,ou,"invalid buffer type"),xr=ou[$t.type]),"dimension"in $t&&(fe.type($t.dimension,"number","invalid dimension"),Fr=$t.dimension|0),"length"in $t&&(fe.nni(Yr,"buffer length must be a nonnegative integer"),Yr=$t.length|0)),lr.bind(),dn?Mr(lr,dn,er,xr,Fr,Pr):(Yr&&B.bufferData(lr.type,Yr,er),lr.dtype=xr||ic,lr.usage=er,lr.dimension=Fr,lr.byteLength=Yr),Fe.profile&&(lr.stats.size=lr.byteLength*Ks[lr.dtype]),Rr}function $r($t,er){fe(er+$t.byteLength<=lr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+$t.byteLength+" starting from offset "+er+" to a buffer of size "+lr.byteLength),B.bufferSubData(lr.type,er,$t)}function Bn($t,er){var dn=(er||0)|0,Yr;if(lr.bind(),_e($t)||$t instanceof ArrayBuffer)$r($t,dn);else if(Array.isArray($t)){if($t.length>0)if(typeof $t[0]=="number"){var xr=Mt.allocType(lr.dtype,$t.length);_(xr,$t),$r(xr,dn),Mt.freeType(xr)}else if(Array.isArray($t[0])||_e($t[0])){Yr=tf($t);var Fr=us($t,Yr,lr.dtype);$r(Fr,dn),Mt.freeType(Fr)}else fe.raise("invalid buffer data")}else if(ys($t)){Yr=$t.shape;var Hr=$t.stride,si=0,ni=0,Vr=0,Jr=0;Yr.length===1?(si=Yr[0],ni=1,Vr=Hr[0],Jr=0):Yr.length===2?(si=Yr[0],ni=Yr[1],Vr=Hr[0],Jr=Hr[1]):fe.raise("invalid shape");var Yn=Array.isArray($t.data)?lr.dtype:dl($t.data),ui=Mt.allocType(Yn,si*ni);M(ui,$t.data,si,ni,Vr,Jr,$t.offset),$r(ui,dn),Mt.freeType(ui)}else fe.raise("invalid data for buffer subdata");return Rr}return Qt||Rr(nt),Rr._reglType="buffer",Rr._buffer=lr,Rr.subdata=Bn,Fe.profile&&(Rr.stats=lr.stats),Rr.destroy=function(){Gr(lr)},Rr}function br(){J(It).forEach(function(nt){nt.buffer=B.createBuffer(),B.bindBuffer(nt.type,nt.buffer),B.bufferData(nt.type,nt.persistentData||nt.byteLength,nt.usage)})}return Fe.profile&&(ce.getTotalBufferSize=function(){var nt=0;return Object.keys(It).forEach(function(Zt){nt+=It[Zt].stats.size}),nt}),{create:_r,createStream:mr,destroyStream:yr,clear:function(){J(It).forEach(Gr),cr.forEach(Gr)},getBuffer:function(nt){return nt&&nt._buffer instanceof Kt?nt._buffer:null},restore:br,_initBuffer:Mr}}var R=0,Y=0,me=1,He=1,ut=4,lt=4,ir={points:R,point:Y,lines:me,line:He,triangles:ut,triangle:lt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ur=0,Tn=1,ri=4,Ln=5120,Vi=5121,pa=5122,Ea=5123,Zi=5124,Es=5125,su=34963,Ju=35040,rf=35044;function vl(B,ce,Fe,Rt){var ar={},It=0,Kt={uint8:Vi,uint16:Ea};ce.oes_element_index_uint&&(Kt.uint32=Es);function cr(br){this.id=It++,ar[this.id]=this,this.buffer=br,this.primType=ri,this.vertCount=0,this.type=0}cr.prototype.bind=function(){this.buffer.bind()};var mr=[];function yr(br){var nt=mr.pop();return nt||(nt=new cr(Fe.create(null,su,!0,!1)._buffer)),Mr(nt,br,Ju,-1,-1,0,0),nt}function Sr(br){mr.push(br)}function Mr(br,nt,Zt,Qt,Pr,lr,Rr){br.buffer.bind();var $r;if(nt){var Bn=Rr;!Rr&&(!_e(nt)||ys(nt)&&!_e(nt.data))&&(Bn=ce.oes_element_index_uint?Es:Ea),Fe._initBuffer(br.buffer,nt,Zt,Bn,3)}else B.bufferData(su,lr,Zt),br.buffer.dtype=$r||Vi,br.buffer.usage=Zt,br.buffer.dimension=3,br.buffer.byteLength=lr;if($r=Rr,!Rr){switch(br.buffer.dtype){case Vi:case Ln:$r=Vi;break;case Ea:case pa:$r=Ea;break;case Es:case Zi:$r=Es;break;default:fe.raise("unsupported type for element array")}br.buffer.dtype=$r}br.type=$r,fe($r!==Es||!!ce.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var $t=Pr;$t<0&&($t=br.buffer.byteLength,$r===Ea?$t>>=1:$r===Es&&($t>>=2)),br.vertCount=$t;var er=Qt;if(Qt<0){er=ri;var dn=br.buffer.dimension;dn===1&&(er=ur),dn===2&&(er=Tn),dn===3&&(er=ri)}br.primType=er}function Gr(br){Rt.elementsCount--,fe(br.buffer!==null,"must not double destroy elements"),delete ar[br.id],br.buffer.destroy(),br.buffer=null}function _r(br,nt){var Zt=Fe.create(null,su,!0),Qt=new cr(Zt._buffer);Rt.elementsCount++;function Pr(lr){if(!lr)Zt(),Qt.primType=ri,Qt.vertCount=0,Qt.type=Vi;else if(typeof lr=="number")Zt(lr),Qt.primType=ri,Qt.vertCount=lr|0,Qt.type=Vi;else{var Rr=null,$r=rf,Bn=-1,$t=-1,er=0,dn=0;Array.isArray(lr)||_e(lr)||ys(lr)?Rr=lr:(fe.type(lr,"object","invalid arguments for elements"),"data"in lr&&(Rr=lr.data,fe(Array.isArray(Rr)||_e(Rr)||ys(Rr),"invalid data for element buffer")),"usage"in lr&&(fe.parameter(lr.usage,ya,"invalid element buffer usage"),$r=ya[lr.usage]),"primitive"in lr&&(fe.parameter(lr.primitive,ir,"invalid element buffer primitive"),Bn=ir[lr.primitive]),"count"in lr&&(fe(typeof lr.count=="number"&&lr.count>=0,"invalid vertex count for elements"),$t=lr.count|0),"type"in lr&&(fe.parameter(lr.type,Kt,"invalid buffer type"),dn=Kt[lr.type]),"length"in lr?er=lr.length|0:(er=$t,dn===Ea||dn===pa?er*=2:(dn===Es||dn===Zi)&&(er*=4))),Mr(Qt,Rr,$r,Bn,$t,er,dn)}return Pr}return Pr(br),Pr._reglType="elements",Pr._elements=Qt,Pr.subdata=function(lr,Rr){return Zt.subdata(lr,Rr),Pr},Pr.destroy=function(){Gr(Qt)},Pr}return{create:_r,createStream:yr,destroyStream:Sr,getElements:function(br){return typeof br=="function"&&br._elements instanceof cr?br._elements:null},clear:function(){J(ar).forEach(Gr)}}}var Pc=new Float32Array(1),Nu=new Uint32Array(Pc.buffer),zu=5123;function Uu(B){for(var ce=Mt.allocType(zu,B.length),Fe=0;Fe<B.length;++Fe)if(isNaN(B[Fe]))ce[Fe]=65535;else if(B[Fe]===Infinity)ce[Fe]=31744;else if(B[Fe]===-Infinity)ce[Fe]=64512;else{Pc[0]=B[Fe];var Rt=Nu[0],ar=Rt>>>31<<15,It=(Rt<<1>>>24)-127,Kt=Rt>>13&(1<<10)-1;if(It<-24)ce[Fe]=ar;else if(It<-14){var cr=-14-It;ce[Fe]=ar+(Kt+(1<<10)>>cr)}else It>15?ce[Fe]=ar+31744:ce[Fe]=ar+(It+15<<10)+Kt}return ce}function so(B){return Array.isArray(B)||_e(B)}var jf=function(B){return!(B&B-1)&&!!B},Vf=34467,ts=3553,Ic=34067,Zu=34069,uu=6408,nf=6406,Rl=6407,Li=6409,Ll=6410,Sp=32854,ml=32855,Oc=36194,Gf=32819,Cp=32820,Hf=33635,Rc=34042,ac=6402,oc=34041,kl=35904,gl=35906,Dl=36193,el=33776,$s=33777,af=33778,of=33779,Wf=35986,lu=35987,sc=34798,Lc=35840,sf=35841,Fl=35842,rh=35843,uf=36196,Bl=5121,lf=5123,cf=5125,Nl=5126,kc=10242,Ap=10243,wp=10497,uc=33071,Tp=33648,zl=10240,qi=10241,lc=9728,oa=9729,ju=9984,Gi=9985,wa=9986,Ss=9987,Dc=33170,tl=4352,Za=4353,cc=4354,Ul=34046,rl=3317,Fc=37440,Vu=37441,vo=37443,Zl=37444,fc=33984,mo=[ju,wa,Gi,Ss],gn=[0,Li,Ll,Rl,uu],uo={};uo[Li]=uo[nf]=uo[ac]=1,uo[oc]=uo[Ll]=2,uo[Rl]=uo[kl]=3,uo[uu]=uo[gl]=4;function nl(B){return"[object "+B+"]"}var La=nl("HTMLCanvasElement"),cu=nl("OffscreenCanvas"),ks=nl("CanvasRenderingContext2D"),Bc=nl("ImageBitmap"),Kr=nl("HTMLImageElement"),ff=nl("HTMLVideoElement"),pc=Object.keys(Ra).concat([La,cu,ks,Bc,Kr,ff]),Gu=[];Gu[Bl]=1,Gu[Nl]=4,Gu[Dl]=2,Gu[lf]=2,Gu[cf]=4;var ka=[];ka[Sp]=2,ka[ml]=2,ka[Oc]=2,ka[oc]=4,ka[el]=.5,ka[$s]=.5,ka[af]=1,ka[of]=1,ka[Wf]=.5,ka[lu]=1,ka[sc]=1,ka[Lc]=.5,ka[sf]=.25,ka[Fl]=.5,ka[rh]=.25,ka[uf]=.5;function Cs(B){return Array.isArray(B)&&(B.length===0||typeof B[0]=="number")}function Nc(B){if(!Array.isArray(B))return!1;var ce=B.length;return!(ce===0||!so(B[0]))}function Hu(B){return Object.prototype.toString.call(B)}function rs(B){return Hu(B)===La}function fu(B){return Hu(B)===cu}function Mp(B){return Hu(B)===ks}function zc(B){return Hu(B)===Bc}function Uc(B){return Hu(B)===Kr}function pf(B){return Hu(B)===ff}function pu(B){var ce=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(ce&&B&&B.getContext)}function Us(B){var ce=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(ce&&B&&"src"in B&&"crossOrigin"in B)}function Ii(B){if(!B)return!1;if(pu(B)||Us(B))return!0;var ce=Hu(B);return pc.indexOf(ce)>=0?!0:Cs(B)||Nc(B)||ys(B)}function Su(B){return Ra[Object.prototype.toString.call(B)]|0}function Zs(B,ce){var Fe=ce.length;switch(B.type){case Bl:case lf:case cf:case Nl:var Rt=Mt.allocType(B.type,Fe);Rt.set(ce),B.data=Rt;break;case Dl:B.data=Uu(ce);break;default:fe.raise("unsupported texture type, must specify a typed array")}}function bo(B,ce){return Mt.allocType(B.type===Dl?Nl:B.type,ce)}function yl(B,ce){B.type===Dl?(B.data=Uu(ce),Mt.freeType(ce)):B.data=ce}function il(B,ce,Fe,Rt,ar,It){for(var Kt=B.width,cr=B.height,mr=B.channels,yr=Kt*cr*mr,Sr=bo(B,yr),Mr=0,Gr=0;Gr<cr;++Gr)for(var _r=0;_r<Kt;++_r)for(var br=0;br<mr;++br)Sr[Mr++]=ce[Fe*_r+Rt*Gr+ar*br+It];yl(B,Sr)}function Qs(B,ce,Fe,Rt,ar,It){var Kt;if(typeof ka[B]!="undefined"?Kt=ka[B]:Kt=uo[B]*Gu[ce],It&&(Kt*=6),ar){for(var cr=0,mr=Fe;mr>=1;)cr+=Kt*mr*mr,mr/=2;return cr}else return Kt*Fe*Rt}function ls(B,ce,Fe,Rt,ar,It,Kt){var cr={"don't care":tl,"dont care":tl,nice:cc,fast:Za},mr={repeat:wp,clamp:uc,mirror:Tp},yr={nearest:lc,linear:oa},Sr=g({mipmap:Ss,"nearest mipmap nearest":ju,"linear mipmap nearest":Gi,"nearest mipmap linear":wa,"linear mipmap linear":Ss},yr),Mr={none:0,browser:Zl},Gr={uint8:Bl,rgba4:Gf,rgb565:Hf,"rgb5 a1":Cp},_r={alpha:nf,luminance:Li,"luminance alpha":Ll,rgb:Rl,rgba:uu,rgba4:Sp,"rgb5 a1":ml,rgb565:Oc},br={};ce.ext_srgb&&(_r.srgb=kl,_r.srgba=gl),ce.oes_texture_float&&(Gr.float32=Gr.float=Nl),ce.oes_texture_half_float&&(Gr.float16=Gr["half float"]=Dl),ce.webgl_depth_texture&&(g(_r,{depth:ac,"depth stencil":oc}),g(Gr,{uint16:lf,uint32:cf,"depth stencil":Rc})),ce.webgl_compressed_texture_s3tc&&g(br,{"rgb s3tc dxt1":el,"rgba s3tc dxt1":$s,"rgba s3tc dxt3":af,"rgba s3tc dxt5":of}),ce.webgl_compressed_texture_atc&&g(br,{"rgb atc":Wf,"rgba atc explicit alpha":lu,"rgba atc interpolated alpha":sc}),ce.webgl_compressed_texture_pvrtc&&g(br,{"rgb pvrtc 4bppv1":Lc,"rgb pvrtc 2bppv1":sf,"rgba pvrtc 4bppv1":Fl,"rgba pvrtc 2bppv1":rh}),ce.webgl_compressed_texture_etc1&&(br["rgb etc1"]=uf);var nt=Array.prototype.slice.call(B.getParameter(Vf)||new Uint32Array(0));Object.keys(br).forEach(function(Ae){var Dt=br[Ae];nt.indexOf(Dt)>=0&&(_r[Ae]=Dt)});var Zt=Object.keys(_r);Fe.textureFormats=Zt;var Qt=[];Object.keys(_r).forEach(function(Ae){var Dt=_r[Ae];Qt[Dt]=Ae});var Pr=[];Object.keys(Gr).forEach(function(Ae){var Dt=Gr[Ae];Pr[Dt]=Ae});var lr=[];Object.keys(yr).forEach(function(Ae){var Dt=yr[Ae];lr[Dt]=Ae});var Rr=[];Object.keys(Sr).forEach(function(Ae){var Dt=Sr[Ae];Rr[Dt]=Ae});var $r=[];Object.keys(mr).forEach(function(Ae){var Dt=mr[Ae];$r[Dt]=Ae});var Bn=Zt.reduce(function(Ae,Dt){var xt=_r[Dt];return xt===Li||xt===nf||xt===Li||xt===Ll||xt===ac||xt===oc||ce.ext_srgb&&(xt===kl||xt===gl)?Ae[xt]=xt:xt===ml||Dt.indexOf("rgba")>=0?Ae[xt]=uu:Ae[xt]=Rl,Ae},{});function $t(){this.internalformat=uu,this.format=uu,this.type=Bl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Zl,this.width=0,this.height=0,this.channels=0}function er(Ae,Dt){Ae.internalformat=Dt.internalformat,Ae.format=Dt.format,Ae.type=Dt.type,Ae.compressed=Dt.compressed,Ae.premultiplyAlpha=Dt.premultiplyAlpha,Ae.flipY=Dt.flipY,Ae.unpackAlignment=Dt.unpackAlignment,Ae.colorSpace=Dt.colorSpace,Ae.width=Dt.width,Ae.height=Dt.height,Ae.channels=Dt.channels}function dn(Ae,Dt){if(!(typeof Dt!="object"||!Dt)){if("premultiplyAlpha"in Dt&&(fe.type(Dt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ae.premultiplyAlpha=Dt.premultiplyAlpha),"flipY"in Dt&&(fe.type(Dt.flipY,"boolean","invalid texture flip"),Ae.flipY=Dt.flipY),"alignment"in Dt&&(fe.oneOf(Dt.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ae.unpackAlignment=Dt.alignment),"colorSpace"in Dt&&(fe.parameter(Dt.colorSpace,Mr,"invalid colorSpace"),Ae.colorSpace=Mr[Dt.colorSpace]),"type"in Dt){var xt=Dt.type;fe(ce.oes_texture_float||!(xt==="float"||xt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),fe(ce.oes_texture_half_float||!(xt==="half float"||xt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),fe(ce.webgl_depth_texture||!(xt==="uint16"||xt==="uint32"||xt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),fe.parameter(xt,Gr,"invalid texture type"),Ae.type=Gr[xt]}var vn=Ae.width,zi=Ae.height,be=Ae.channels,ne=!1;"shape"in Dt?(fe(Array.isArray(Dt.shape)&&Dt.shape.length>=2,"shape must be an array"),vn=Dt.shape[0],zi=Dt.shape[1],Dt.shape.length===3&&(be=Dt.shape[2],fe(be>0&&be<=4,"invalid number of channels"),ne=!0),fe(vn>=0&&vn<=Fe.maxTextureSize,"invalid width"),fe(zi>=0&&zi<=Fe.maxTextureSize,"invalid height")):("radius"in Dt&&(vn=zi=Dt.radius,fe(vn>=0&&vn<=Fe.maxTextureSize,"invalid radius")),"width"in Dt&&(vn=Dt.width,fe(vn>=0&&vn<=Fe.maxTextureSize,"invalid width")),"height"in Dt&&(zi=Dt.height,fe(zi>=0&&zi<=Fe.maxTextureSize,"invalid height")),"channels"in Dt&&(be=Dt.channels,fe(be>0&&be<=4,"invalid number of channels"),ne=!0)),Ae.width=vn|0,Ae.height=zi|0,Ae.channels=be|0;var Ze=!1;if("format"in Dt){var ot=Dt.format;fe(ce.webgl_depth_texture||!(ot==="depth"||ot==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),fe.parameter(ot,_r,"invalid texture format");var Tt=Ae.internalformat=_r[ot];Ae.format=Bn[Tt],ot in Gr&&("type"in Dt||(Ae.type=Gr[ot])),ot in br&&(Ae.compressed=!0),Ze=!0}!ne&&Ze?Ae.channels=uo[Ae.format]:ne&&!Ze?Ae.channels!==gn[Ae.format]&&(Ae.format=Ae.internalformat=gn[Ae.channels]):Ze&&ne&&fe(Ae.channels===uo[Ae.format],"number of channels inconsistent with specified format")}}function Yr(Ae){B.pixelStorei(Fc,Ae.flipY),B.pixelStorei(Vu,Ae.premultiplyAlpha),B.pixelStorei(vo,Ae.colorSpace),B.pixelStorei(rl,Ae.unpackAlignment)}function xr(){$t.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Fr(Ae,Dt){var xt=null;if(Ii(Dt)?xt=Dt:Dt&&(fe.type(Dt,"object","invalid pixel data type"),dn(Ae,Dt),"x"in Dt&&(Ae.xOffset=Dt.x|0),"y"in Dt&&(Ae.yOffset=Dt.y|0),Ii(Dt.data)&&(xt=Dt.data)),fe(!Ae.compressed||xt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Dt.copy){fe(!xt,"can not specify copy and data field for the same texture");var vn=ar.viewportWidth,zi=ar.viewportHeight;Ae.width=Ae.width||vn-Ae.xOffset,Ae.height=Ae.height||zi-Ae.yOffset,Ae.needsCopy=!0,fe(Ae.xOffset>=0&&Ae.xOffset<vn&&Ae.yOffset>=0&&Ae.yOffset<zi&&Ae.width>0&&Ae.width<=vn&&Ae.height>0&&Ae.height<=zi,"copy texture read out of bounds")}else if(!xt)Ae.width=Ae.width||1,Ae.height=Ae.height||1,Ae.channels=Ae.channels||4;else if(_e(xt))Ae.channels=Ae.channels||4,Ae.data=xt,!("type"in Dt)&&Ae.type===Bl&&(Ae.type=Su(xt));else if(Cs(xt))Ae.channels=Ae.channels||4,Zs(Ae,xt),Ae.alignment=1,Ae.needsFree=!0;else if(ys(xt)){var be=xt.data;!Array.isArray(be)&&Ae.type===Bl&&(Ae.type=Su(be));var ne=xt.shape,Ze=xt.stride,ot,Tt,Ye,De,Je,ve;ne.length===3?(Ye=ne[2],ve=Ze[2]):(fe(ne.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Ye=1,ve=1),ot=ne[0],Tt=ne[1],De=Ze[0],Je=Ze[1],Ae.alignment=1,Ae.width=ot,Ae.height=Tt,Ae.channels=Ye,Ae.format=Ae.internalformat=gn[Ye],Ae.needsFree=!0,il(Ae,be,De,Je,ve,xt.offset)}else if(pu(xt)||rs(xt)||fu(xt)||Mp(xt))pu(xt)||rs(xt)||fu(xt)?Ae.element=xt:Ae.element=xt.canvas,Ae.width=Ae.element.width,Ae.height=Ae.element.height,Ae.channels=4;else if(zc(xt))Ae.element=xt,Ae.width=xt.width,Ae.height=xt.height,Ae.channels=4;else if(Uc(xt))Ae.element=xt,Ae.width=xt.naturalWidth,Ae.height=xt.naturalHeight,Ae.channels=4;else if(Us(xt))Ae.element=xt,Ae.width=xt.width,Ae.height=xt.height,Ae.channels=4;else if(pf(xt))Ae.element=xt,Ae.width=xt.videoWidth,Ae.height=xt.videoHeight,Ae.channels=4;else if(Nc(xt)){var Ue=Ae.width||xt[0].length,Ee=Ae.height||xt.length,at=Ae.channels;so(xt[0][0])?at=at||xt[0][0].length:at=at||1;for(var bt=ge.shape(xt),fr=1,zr=0;zr<bt.length;++zr)fr*=bt[zr];var Zr=bo(Ae,fr);ge.flatten(xt,bt,"",Zr),yl(Ae,Zr),Ae.alignment=1,Ae.width=Ue,Ae.height=Ee,Ae.channels=at,Ae.format=Ae.internalformat=gn[at],Ae.needsFree=!0}Ae.type===Nl?fe(Fe.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ae.type===Dl&&fe(Fe.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Hr(Ae,Dt,xt){var vn=Ae.element,zi=Ae.data,be=Ae.internalformat,ne=Ae.format,Ze=Ae.type,ot=Ae.width,Tt=Ae.height;Yr(Ae),vn?B.texImage2D(Dt,xt,ne,ne,Ze,vn):Ae.compressed?B.compressedTexImage2D(Dt,xt,be,ot,Tt,0,zi):Ae.needsCopy?(Rt(),B.copyTexImage2D(Dt,xt,ne,Ae.xOffset,Ae.yOffset,ot,Tt,0)):B.texImage2D(Dt,xt,ne,ot,Tt,0,ne,Ze,zi||null)}function si(Ae,Dt,xt,vn,zi){var be=Ae.element,ne=Ae.data,Ze=Ae.internalformat,ot=Ae.format,Tt=Ae.type,Ye=Ae.width,De=Ae.height;Yr(Ae),be?B.texSubImage2D(Dt,zi,xt,vn,ot,Tt,be):Ae.compressed?B.compressedTexSubImage2D(Dt,zi,xt,vn,Ze,Ye,De,ne):Ae.needsCopy?(Rt(),B.copyTexSubImage2D(Dt,zi,xt,vn,Ae.xOffset,Ae.yOffset,Ye,De)):B.texSubImage2D(Dt,zi,xt,vn,Ye,De,ot,Tt,ne)}var ni=[];function Vr(){return ni.pop()||new xr}function Jr(Ae){Ae.needsFree&&Mt.freeType(Ae.data),xr.call(Ae),ni.push(Ae)}function Yn(){$t.call(this),this.genMipmaps=!1,this.mipmapHint=tl,this.mipmask=0,this.images=Array(16)}function ui(Ae,Dt,xt){var vn=Ae.images[0]=Vr();Ae.mipmask=1,vn.width=Ae.width=Dt,vn.height=Ae.height=xt,vn.channels=Ae.channels=4}function Ni(Ae,Dt){var xt=null;if(Ii(Dt))xt=Ae.images[0]=Vr(),er(xt,Ae),Fr(xt,Dt),Ae.mipmask=1;else if(dn(Ae,Dt),Array.isArray(Dt.mipmap))for(var vn=Dt.mipmap,zi=0;zi<vn.length;++zi)xt=Ae.images[zi]=Vr(),er(xt,Ae),xt.width>>=zi,xt.height>>=zi,Fr(xt,vn[zi]),Ae.mipmask|=1<<zi;else xt=Ae.images[0]=Vr(),er(xt,Ae),Fr(xt,Dt),Ae.mipmask=1;er(Ae,Ae.images[0]),Ae.compressed&&(Ae.internalformat===el||Ae.internalformat===$s||Ae.internalformat===af||Ae.internalformat===of)&&fe(Ae.width%4==0&&Ae.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function io(Ae,Dt){for(var xt=Ae.images,vn=0;vn<xt.length;++vn){if(!xt[vn])return;Hr(xt[vn],Dt,vn)}}var co=[];function ki(){var Ae=co.pop()||new Yn;$t.call(Ae),Ae.mipmask=0;for(var Dt=0;Dt<16;++Dt)Ae.images[Dt]=null;return Ae}function as(Ae){for(var Dt=Ae.images,xt=0;xt<Dt.length;++xt)Dt[xt]&&Jr(Dt[xt]),Dt[xt]=null;co.push(Ae)}function Ga(){this.minFilter=lc,this.magFilter=lc,this.wrapS=uc,this.wrapT=uc,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=tl}function qo(Ae,Dt){if("min"in Dt){var xt=Dt.min;fe.parameter(xt,Sr),Ae.minFilter=Sr[xt],mo.indexOf(Ae.minFilter)>=0&&!("faces"in Dt)&&(Ae.genMipmaps=!0)}if("mag"in Dt){var vn=Dt.mag;fe.parameter(vn,yr),Ae.magFilter=yr[vn]}var zi=Ae.wrapS,be=Ae.wrapT;if("wrap"in Dt){var ne=Dt.wrap;typeof ne=="string"?(fe.parameter(ne,mr),zi=be=mr[ne]):Array.isArray(ne)&&(fe.parameter(ne[0],mr),fe.parameter(ne[1],mr),zi=mr[ne[0]],be=mr[ne[1]])}else{if("wrapS"in Dt){var Ze=Dt.wrapS;fe.parameter(Ze,mr),zi=mr[Ze]}if("wrapT"in Dt){var ot=Dt.wrapT;fe.parameter(ot,mr),be=mr[ot]}}if(Ae.wrapS=zi,Ae.wrapT=be,"anisotropic"in Dt){var Tt=Dt.anisotropic;fe(typeof Tt=="number"&&Tt>=1&&Tt<=Fe.maxAnisotropic,"aniso samples must be between 1 and "),Ae.anisotropic=Dt.anisotropic}if("mipmap"in Dt){var Ye=!1;switch(typeof Dt.mipmap){case"string":fe.parameter(Dt.mipmap,cr,"invalid mipmap hint"),Ae.mipmapHint=cr[Dt.mipmap],Ae.genMipmaps=!0,Ye=!0;break;case"boolean":Ye=Ae.genMipmaps=Dt.mipmap;break;case"object":fe(Array.isArray(Dt.mipmap),"invalid mipmap type"),Ae.genMipmaps=!1,Ye=!0;break;default:fe.raise("invalid mipmap type")}Ye&&!("min"in Dt)&&(Ae.minFilter=ju)}}function So(Ae,Dt){B.texParameteri(Dt,qi,Ae.minFilter),B.texParameteri(Dt,zl,Ae.magFilter),B.texParameteri(Dt,kc,Ae.wrapS),B.texParameteri(Dt,Ap,Ae.wrapT),ce.ext_texture_filter_anisotropic&&B.texParameteri(Dt,Ul,Ae.anisotropic),Ae.genMipmaps&&(B.hint(Dc,Ae.mipmapHint),B.generateMipmap(Dt))}var Zo=0,jo={},ds=Fe.maxTextureUnits,fo=Array(ds).map(function(){return null});function xi(Ae){$t.call(this),this.mipmask=0,this.internalformat=uu,this.id=Zo++,this.refCount=1,this.target=Ae,this.texture=B.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Ga,Kt.profile&&(this.stats={size:0})}function Vo(Ae){B.activeTexture(fc),B.bindTexture(Ae.target,Ae.texture)}function Ki(){var Ae=fo[0];Ae?B.bindTexture(Ae.target,Ae.texture):B.bindTexture(ts,null)}function Ko(Ae){var Dt=Ae.texture;fe(Dt,"must not double destroy texture");var xt=Ae.unit,vn=Ae.target;xt>=0&&(B.activeTexture(fc+xt),B.bindTexture(vn,null),fo[xt]=null),B.deleteTexture(Dt),Ae.texture=null,Ae.params=null,Ae.pixels=null,Ae.refCount=0,delete jo[Ae.id],It.textureCount--}g(xi.prototype,{bind:function(){var Ae=this;Ae.bindCount+=1;var Dt=Ae.unit;if(Dt<0){for(var xt=0;xt<ds;++xt){var vn=fo[xt];if(vn){if(vn.bindCount>0)continue;vn.unit=-1}fo[xt]=Ae,Dt=xt;break}Dt>=ds&&fe.raise("insufficient number of texture units"),Kt.profile&&It.maxTextureUnits<Dt+1&&(It.maxTextureUnits=Dt+1),Ae.unit=Dt,B.activeTexture(fc+Dt),B.bindTexture(Ae.target,Ae.texture)}return Dt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Ko(this)}});function ei(Ae,Dt){var xt=new xi(ts);jo[xt.id]=xt,It.textureCount++;function vn(ne,Ze){var ot=xt.texInfo;Ga.call(ot);var Tt=ki();return typeof ne=="number"?typeof Ze=="number"?ui(Tt,ne|0,Ze|0):ui(Tt,ne|0,ne|0):ne?(fe.type(ne,"object","invalid arguments to regl.texture"),qo(ot,ne),Ni(Tt,ne)):ui(Tt,1,1),ot.genMipmaps&&(Tt.mipmask=(Tt.width<<1)-1),xt.mipmask=Tt.mipmask,er(xt,Tt),fe.texture2D(ot,Tt,Fe),xt.internalformat=Tt.internalformat,vn.width=Tt.width,vn.height=Tt.height,Vo(xt),io(Tt,ts),So(ot,ts),Ki(),as(Tt),Kt.profile&&(xt.stats.size=Qs(xt.internalformat,xt.type,Tt.width,Tt.height,ot.genMipmaps,!1)),vn.format=Qt[xt.internalformat],vn.type=Pr[xt.type],vn.mag=lr[ot.magFilter],vn.min=Rr[ot.minFilter],vn.wrapS=$r[ot.wrapS],vn.wrapT=$r[ot.wrapT],vn}function zi(ne,Ze,ot,Tt){fe(!!ne,"must specify image data");var Ye=Ze|0,De=ot|0,Je=Tt|0,ve=Vr();return er(ve,xt),ve.width=0,ve.height=0,Fr(ve,ne),ve.width=ve.width||(xt.width>>Je)-Ye,ve.height=ve.height||(xt.height>>Je)-De,fe(xt.type===ve.type&&xt.format===ve.format&&xt.internalformat===ve.internalformat,"incompatible format for texture.subimage"),fe(Ye>=0&&De>=0&&Ye+ve.width<=xt.width&&De+ve.height<=xt.height,"texture.subimage write out of bounds"),fe(xt.mipmask&1<<Je,"missing mipmap data"),fe(ve.data||ve.element||ve.needsCopy,"missing image data"),Vo(xt),si(ve,ts,Ye,De,Je),Ki(),Jr(ve),vn}function be(ne,Ze){var ot=ne|0,Tt=Ze|0||ot;if(ot===xt.width&&Tt===xt.height)return vn;vn.width=xt.width=ot,vn.height=xt.height=Tt,Vo(xt);for(var Ye=0;xt.mipmask>>Ye;++Ye){var De=ot>>Ye,Je=Tt>>Ye;if(!De||!Je)break;B.texImage2D(ts,Ye,xt.format,De,Je,0,xt.format,xt.type,null)}return Ki(),Kt.profile&&(xt.stats.size=Qs(xt.internalformat,xt.type,ot,Tt,!1,!1)),vn}return vn(Ae,Dt),vn.subimage=zi,vn.resize=be,vn._reglType="texture2d",vn._texture=xt,Kt.profile&&(vn.stats=xt.stats),vn.destroy=function(){xt.decRef()},vn}function Di(Ae,Dt,xt,vn,zi,be){var ne=new xi(Ic);jo[ne.id]=ne,It.cubeCount++;var Ze=new Array(6);function ot(De,Je,ve,Ue,Ee,at){var bt,fr=ne.texInfo;for(Ga.call(fr),bt=0;bt<6;++bt)Ze[bt]=ki();if(typeof De=="number"||!De){var zr=De|0||1;for(bt=0;bt<6;++bt)ui(Ze[bt],zr,zr)}else if(typeof De=="object")if(Je)Ni(Ze[0],De),Ni(Ze[1],Je),Ni(Ze[2],ve),Ni(Ze[3],Ue),Ni(Ze[4],Ee),Ni(Ze[5],at);else if(qo(fr,De),dn(ne,De),"faces"in De){var Zr=De.faces;for(fe(Array.isArray(Zr)&&Zr.length===6,"cube faces must be a length 6 array"),bt=0;bt<6;++bt)fe(typeof Zr[bt]=="object"&&!!Zr[bt],"invalid input for cube map face"),er(Ze[bt],ne),Ni(Ze[bt],Zr[bt])}else for(bt=0;bt<6;++bt)Ni(Ze[bt],De);else fe.raise("invalid arguments to cube map");for(er(ne,Ze[0]),fe.optional(function(){Fe.npotTextureCube||fe(jf(ne.width)&&jf(ne.height),"your browser does not support non power or two texture dimensions")}),fr.genMipmaps?ne.mipmask=(Ze[0].width<<1)-1:ne.mipmask=Ze[0].mipmask,fe.textureCube(ne,fr,Ze,Fe),ne.internalformat=Ze[0].internalformat,ot.width=Ze[0].width,ot.height=Ze[0].height,Vo(ne),bt=0;bt<6;++bt)io(Ze[bt],Zu+bt);for(So(fr,Ic),Ki(),Kt.profile&&(ne.stats.size=Qs(ne.internalformat,ne.type,ot.width,ot.height,fr.genMipmaps,!0)),ot.format=Qt[ne.internalformat],ot.type=Pr[ne.type],ot.mag=lr[fr.magFilter],ot.min=Rr[fr.minFilter],ot.wrapS=$r[fr.wrapS],ot.wrapT=$r[fr.wrapT],bt=0;bt<6;++bt)as(Ze[bt]);return ot}function Tt(De,Je,ve,Ue,Ee){fe(!!Je,"must specify image data"),fe(typeof De=="number"&&De===(De|0)&&De>=0&&De<6,"invalid face");var at=ve|0,bt=Ue|0,fr=Ee|0,zr=Vr();return er(zr,ne),zr.width=0,zr.height=0,Fr(zr,Je),zr.width=zr.width||(ne.width>>fr)-at,zr.height=zr.height||(ne.height>>fr)-bt,fe(ne.type===zr.type&&ne.format===zr.format&&ne.internalformat===zr.internalformat,"incompatible format for texture.subimage"),fe(at>=0&&bt>=0&&at+zr.width<=ne.width&&bt+zr.height<=ne.height,"texture.subimage write out of bounds"),fe(ne.mipmask&1<<fr,"missing mipmap data"),fe(zr.data||zr.element||zr.needsCopy,"missing image data"),Vo(ne),si(zr,Zu+De,at,bt,fr),Ki(),Jr(zr),ot}function Ye(De){var Je=De|0;if(Je!==ne.width){ot.width=ne.width=Je,ot.height=ne.height=Je,Vo(ne);for(var ve=0;ve<6;++ve)for(var Ue=0;ne.mipmask>>Ue;++Ue)B.texImage2D(Zu+ve,Ue,ne.format,Je>>Ue,Je>>Ue,0,ne.format,ne.type,null);return Ki(),Kt.profile&&(ne.stats.size=Qs(ne.internalformat,ne.type,ot.width,ot.height,!1,!0)),ot}}return ot(Ae,Dt,xt,vn,zi,be),ot.subimage=Tt,ot.resize=Ye,ot._reglType="textureCube",ot._texture=ne,Kt.profile&&(ot.stats=ne.stats),ot.destroy=function(){ne.decRef()},ot}function la(){for(var Ae=0;Ae<ds;++Ae)B.activeTexture(fc+Ae),B.bindTexture(ts,null),fo[Ae]=null;J(jo).forEach(Ko),It.cubeCount=0,It.textureCount=0}Kt.profile&&(It.getTotalTextureSize=function(){var Ae=0;return Object.keys(jo).forEach(function(Dt){Ae+=jo[Dt].stats.size}),Ae});function Co(){for(var Ae=0;Ae<ds;++Ae){var Dt=fo[Ae];Dt&&(Dt.bindCount=0,Dt.unit=-1,fo[Ae]=null)}J(jo).forEach(function(xt){xt.texture=B.createTexture(),B.bindTexture(xt.target,xt.texture);for(var vn=0;vn<32;++vn)if((xt.mipmask&1<<vn)!=0)if(xt.target===ts)B.texImage2D(ts,vn,xt.internalformat,xt.width>>vn,xt.height>>vn,0,xt.internalformat,xt.type,null);else for(var zi=0;zi<6;++zi)B.texImage2D(Zu+zi,vn,xt.internalformat,xt.width>>vn,xt.height>>vn,0,xt.internalformat,xt.type,null);So(xt.texInfo,xt.target)})}function wl(){for(var Ae=0;Ae<ds;++Ae){var Dt=fo[Ae];Dt&&(Dt.bindCount=0,Dt.unit=-1,fo[Ae]=null),B.activeTexture(fc+Ae),B.bindTexture(ts,null),B.bindTexture(Ic,null)}}return{create2D:ei,createCube:Di,clear:la,getTexture:function(Ae){return null},restore:Co,refresh:wl}}var js=36161,Dn=32854,An=32855,Zc=36194,cs=33189,Oo=36168,ns=34041,Cu=35907,Xf=34836,_l=34842,sa=34843,Da=[];Da[Dn]=2,Da[An]=2,Da[Zc]=2,Da[cs]=2,Da[Oo]=1,Da[ns]=4,Da[Cu]=4,Da[Xf]=16,Da[_l]=8,Da[sa]=6;function hf(B,ce,Fe){return Da[B]*ce*Fe}var xl=function(B,ce,Fe,Rt,ar){var It={rgba4:Dn,rgb565:Zc,"rgb5 a1":An,depth:cs,stencil:Oo,"depth stencil":ns};ce.ext_srgb&&(It.srgba=Cu),ce.ext_color_buffer_half_float&&(It.rgba16f=_l,It.rgb16f=sa),ce.webgl_color_buffer_float&&(It.rgba32f=Xf);var Kt=[];Object.keys(It).forEach(function(_r){var br=It[_r];Kt[br]=_r});var cr=0,mr={};function yr(_r){this.id=cr++,this.refCount=1,this.renderbuffer=_r,this.format=Dn,this.width=0,this.height=0,ar.profile&&(this.stats={size:0})}yr.prototype.decRef=function(){--this.refCount<=0&&Sr(this)};function Sr(_r){var br=_r.renderbuffer;fe(br,"must not double destroy renderbuffer"),B.bindRenderbuffer(js,null),B.deleteRenderbuffer(br),_r.renderbuffer=null,_r.refCount=0,delete mr[_r.id],Rt.renderbufferCount--}function Mr(_r,br){var nt=new yr(B.createRenderbuffer());mr[nt.id]=nt,Rt.renderbufferCount++;function Zt(Pr,lr){var Rr=0,$r=0,Bn=Dn;if(typeof Pr=="object"&&Pr){var $t=Pr;if("shape"in $t){var er=$t.shape;fe(Array.isArray(er)&&er.length>=2,"invalid renderbuffer shape"),Rr=er[0]|0,$r=er[1]|0}else"radius"in $t&&(Rr=$r=$t.radius|0),"width"in $t&&(Rr=$t.width|0),"height"in $t&&($r=$t.height|0);"format"in $t&&(fe.parameter($t.format,It,"invalid renderbuffer format"),Bn=It[$t.format])}else typeof Pr=="number"?(Rr=Pr|0,typeof lr=="number"?$r=lr|0:$r=Rr):Pr?fe.raise("invalid arguments to renderbuffer constructor"):Rr=$r=1;if(fe(Rr>0&&$r>0&&Rr<=Fe.maxRenderbufferSize&&$r<=Fe.maxRenderbufferSize,"invalid renderbuffer size"),!(Rr===nt.width&&$r===nt.height&&Bn===nt.format))return Zt.width=nt.width=Rr,Zt.height=nt.height=$r,nt.format=Bn,B.bindRenderbuffer(js,nt.renderbuffer),B.renderbufferStorage(js,Bn,Rr,$r),fe(B.getError()===0,"invalid render buffer format"),ar.profile&&(nt.stats.size=hf(nt.format,nt.width,nt.height)),Zt.format=Kt[nt.format],Zt}function Qt(Pr,lr){var Rr=Pr|0,$r=lr|0||Rr;return Rr===nt.width&&$r===nt.height||(fe(Rr>0&&$r>0&&Rr<=Fe.maxRenderbufferSize&&$r<=Fe.maxRenderbufferSize,"invalid renderbuffer size"),Zt.width=nt.width=Rr,Zt.height=nt.height=$r,B.bindRenderbuffer(js,nt.renderbuffer),B.renderbufferStorage(js,nt.format,Rr,$r),fe(B.getError()===0,"invalid render buffer format"),ar.profile&&(nt.stats.size=hf(nt.format,nt.width,nt.height))),Zt}return Zt(_r,br),Zt.resize=Qt,Zt._reglType="renderbuffer",Zt._renderbuffer=nt,ar.profile&&(Zt.stats=nt.stats),Zt.destroy=function(){nt.decRef()},Zt}ar.profile&&(Rt.getTotalRenderbufferSize=function(){var _r=0;return Object.keys(mr).forEach(function(br){_r+=mr[br].stats.size}),_r});function Gr(){J(mr).forEach(function(_r){_r.renderbuffer=B.createRenderbuffer(),B.bindRenderbuffer(js,_r.renderbuffer),B.renderbufferStorage(js,_r.format,_r.width,_r.height)}),B.bindRenderbuffer(js,null)}return{create:Mr,clear:function(){J(mr).forEach(Sr)},restore:Gr}},Au=36160,hu=36161,Yo=3553,al=34069,Wu=36064,jc=36096,du=36128,Vc=33306,hc=36053,jl=36054,Qi=36055,bl=36057,vu=36061,wu=36193,Vl=5121,Tu=5126,Vs=6407,ja=6408,Mu=6402,Gl=[Vs,ja],Gc=[];Gc[ja]=4,Gc[Vs]=3;var l=[];l[Vl]=1,l[Tu]=4,l[wu]=2;var p=32854,c=32855,d=36194,E=33189,w=36168,P=34041,L=35907,z=34836,H=34842,oe=34843,ue=[p,c,d,L,H,oe,z],le={};le[hc]="complete",le[jl]="incomplete attachment",le[bl]="incomplete dimensions",le[Qi]="incomplete, missing attachment",le[vu]="unsupported";function Pe(B,ce,Fe,Rt,ar,It){var Kt={cur:null,next:null,dirty:!1,setFBO:null},cr=["rgba"],mr=["rgba4","rgb565","rgb5 a1"];ce.ext_srgb&&mr.push("srgba"),ce.ext_color_buffer_half_float&&mr.push("rgba16f","rgb16f"),ce.webgl_color_buffer_float&&mr.push("rgba32f");var yr=["uint8"];ce.oes_texture_half_float&&yr.push("half float","float16"),ce.oes_texture_float&&yr.push("float","float32");function Sr(xr,Fr,Hr){this.target=xr,this.texture=Fr,this.renderbuffer=Hr;var si=0,ni=0;Fr?(si=Fr.width,ni=Fr.height):Hr&&(si=Hr.width,ni=Hr.height),this.width=si,this.height=ni}function Mr(xr){xr&&(xr.texture&&xr.texture._texture.decRef(),xr.renderbuffer&&xr.renderbuffer._renderbuffer.decRef())}function Gr(xr,Fr,Hr){if(!!xr)if(xr.texture){var si=xr.texture._texture,ni=Math.max(1,si.width),Vr=Math.max(1,si.height);fe(ni===Fr&&Vr===Hr,"inconsistent width/height for supplied texture"),si.refCount+=1}else{var Jr=xr.renderbuffer._renderbuffer;fe(Jr.width===Fr&&Jr.height===Hr,"inconsistent width/height for renderbuffer"),Jr.refCount+=1}}function _r(xr,Fr){Fr&&(Fr.texture?B.framebufferTexture2D(Au,xr,Fr.target,Fr.texture._texture.texture,0):B.framebufferRenderbuffer(Au,xr,hu,Fr.renderbuffer._renderbuffer.renderbuffer))}function br(xr){var Fr=Yo,Hr=null,si=null,ni=xr;typeof xr=="object"&&(ni=xr.data,"target"in xr&&(Fr=xr.target|0)),fe.type(ni,"function","invalid attachment data");var Vr=ni._reglType;return Vr==="texture2d"?(Hr=ni,fe(Fr===Yo)):Vr==="textureCube"?(Hr=ni,fe(Fr>=al&&Fr<al+6,"invalid cube map target")):Vr==="renderbuffer"?(si=ni,Fr=hu):fe.raise("invalid regl object for attachment"),new Sr(Fr,Hr,si)}function nt(xr,Fr,Hr,si,ni){if(Hr){var Vr=Rt.create2D({width:xr,height:Fr,format:si,type:ni});return Vr._texture.refCount=0,new Sr(Yo,Vr,null)}else{var Jr=ar.create({width:xr,height:Fr,format:si});return Jr._renderbuffer.refCount=0,new Sr(hu,null,Jr)}}function Zt(xr){return xr&&(xr.texture||xr.renderbuffer)}function Qt(xr,Fr,Hr){xr&&(xr.texture?xr.texture.resize(Fr,Hr):xr.renderbuffer&&xr.renderbuffer.resize(Fr,Hr),xr.width=Fr,xr.height=Hr)}var Pr=0,lr={};function Rr(){this.id=Pr++,lr[this.id]=this,this.framebuffer=B.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function $r(xr){xr.colorAttachments.forEach(Mr),Mr(xr.depthAttachment),Mr(xr.stencilAttachment),Mr(xr.depthStencilAttachment)}function Bn(xr){var Fr=xr.framebuffer;fe(Fr,"must not double destroy framebuffer"),B.deleteFramebuffer(Fr),xr.framebuffer=null,It.framebufferCount--,delete lr[xr.id]}function $t(xr){var Fr;B.bindFramebuffer(Au,xr.framebuffer);var Hr=xr.colorAttachments;for(Fr=0;Fr<Hr.length;++Fr)_r(Wu+Fr,Hr[Fr]);for(Fr=Hr.length;Fr<Fe.maxColorAttachments;++Fr)B.framebufferTexture2D(Au,Wu+Fr,Yo,null,0);B.framebufferTexture2D(Au,Vc,Yo,null,0),B.framebufferTexture2D(Au,jc,Yo,null,0),B.framebufferTexture2D(Au,du,Yo,null,0),_r(jc,xr.depthAttachment),_r(du,xr.stencilAttachment),_r(Vc,xr.depthStencilAttachment);var si=B.checkFramebufferStatus(Au);!B.isContextLost()&&si!==hc&&fe.raise("framebuffer configuration not supported, status = "+le[si]),B.bindFramebuffer(Au,Kt.next?Kt.next.framebuffer:null),Kt.cur=Kt.next,B.getError()}function er(xr,Fr){var Hr=new Rr;It.framebufferCount++;function si(Vr,Jr){var Yn;fe(Kt.next!==Hr,"can not update framebuffer which is currently in use");var ui=0,Ni=0,io=!0,co=!0,ki=null,as=!0,Ga="rgba",qo="uint8",So=1,Zo=null,jo=null,ds=null,fo=!1;if(typeof Vr=="number")ui=Vr|0,Ni=Jr|0||ui;else if(!Vr)ui=Ni=1;else{fe.type(Vr,"object","invalid arguments for framebuffer");var xi=Vr;if("shape"in xi){var Vo=xi.shape;fe(Array.isArray(Vo)&&Vo.length>=2,"invalid shape for framebuffer"),ui=Vo[0],Ni=Vo[1]}else"radius"in xi&&(ui=Ni=xi.radius),"width"in xi&&(ui=xi.width),"height"in xi&&(Ni=xi.height);("color"in xi||"colors"in xi)&&(ki=xi.color||xi.colors,Array.isArray(ki)&&fe(ki.length===1||ce.webgl_draw_buffers,"multiple render targets not supported")),ki||("colorCount"in xi&&(So=xi.colorCount|0,fe(So>0,"invalid color buffer count")),"colorTexture"in xi&&(as=!!xi.colorTexture,Ga="rgba4"),"colorType"in xi&&(qo=xi.colorType,as?(fe(ce.oes_texture_float||!(qo==="float"||qo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),fe(ce.oes_texture_half_float||!(qo==="half float"||qo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):qo==="half float"||qo==="float16"?(fe(ce.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Ga="rgba16f"):(qo==="float"||qo==="float32")&&(fe(ce.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Ga="rgba32f"),fe.oneOf(qo,yr,"invalid color type")),"colorFormat"in xi&&(Ga=xi.colorFormat,cr.indexOf(Ga)>=0?as=!0:mr.indexOf(Ga)>=0?as=!1:fe.optional(function(){as?fe.oneOf(xi.colorFormat,cr,"invalid color format for texture"):fe.oneOf(xi.colorFormat,mr,"invalid color format for renderbuffer")}))),("depthTexture"in xi||"depthStencilTexture"in xi)&&(fo=!!(xi.depthTexture||xi.depthStencilTexture),fe(!fo||ce.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in xi&&(typeof xi.depth=="boolean"?io=xi.depth:(Zo=xi.depth,co=!1)),"stencil"in xi&&(typeof xi.stencil=="boolean"?co=xi.stencil:(jo=xi.stencil,io=!1)),"depthStencil"in xi&&(typeof xi.depthStencil=="boolean"?io=co=xi.depthStencil:(ds=xi.depthStencil,io=!1,co=!1))}var Ki=null,Ko=null,ei=null,Di=null;if(Array.isArray(ki))Ki=ki.map(br);else if(ki)Ki=[br(ki)];else for(Ki=new Array(So),Yn=0;Yn<So;++Yn)Ki[Yn]=nt(ui,Ni,as,Ga,qo);fe(ce.webgl_draw_buffers||Ki.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),fe(Ki.length<=Fe.maxColorAttachments,"too many color attachments, not supported"),ui=ui||Ki[0].width,Ni=Ni||Ki[0].height,Zo?Ko=br(Zo):io&&!co&&(Ko=nt(ui,Ni,fo,"depth","uint32")),jo?ei=br(jo):co&&!io&&(ei=nt(ui,Ni,!1,"stencil","uint8")),ds?Di=br(ds):!Zo&&!jo&&co&&io&&(Di=nt(ui,Ni,fo,"depth stencil","depth stencil")),fe(!!Zo+!!jo+!!ds<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var la=null;for(Yn=0;Yn<Ki.length;++Yn)if(Gr(Ki[Yn],ui,Ni),fe(!Ki[Yn]||Ki[Yn].texture&&Gl.indexOf(Ki[Yn].texture._texture.format)>=0||Ki[Yn].renderbuffer&&ue.indexOf(Ki[Yn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Yn+" is invalid"),Ki[Yn]&&Ki[Yn].texture){var Co=Gc[Ki[Yn].texture._texture.format]*l[Ki[Yn].texture._texture.type];la===null?la=Co:fe(la===Co,"all color attachments much have the same number of bits per pixel.")}return Gr(Ko,ui,Ni),fe(!Ko||Ko.texture&&Ko.texture._texture.format===Mu||Ko.renderbuffer&&Ko.renderbuffer._renderbuffer.format===E,"invalid depth attachment for framebuffer object"),Gr(ei,ui,Ni),fe(!ei||ei.renderbuffer&&ei.renderbuffer._renderbuffer.format===w,"invalid stencil attachment for framebuffer object"),Gr(Di,ui,Ni),fe(!Di||Di.texture&&Di.texture._texture.format===P||Di.renderbuffer&&Di.renderbuffer._renderbuffer.format===P,"invalid depth-stencil attachment for framebuffer object"),$r(Hr),Hr.width=ui,Hr.height=Ni,Hr.colorAttachments=Ki,Hr.depthAttachment=Ko,Hr.stencilAttachment=ei,Hr.depthStencilAttachment=Di,si.color=Ki.map(Zt),si.depth=Zt(Ko),si.stencil=Zt(ei),si.depthStencil=Zt(Di),si.width=Hr.width,si.height=Hr.height,$t(Hr),si}function ni(Vr,Jr){fe(Kt.next!==Hr,"can not resize a framebuffer which is currently in use");var Yn=Math.max(Vr|0,1),ui=Math.max(Jr|0||Yn,1);if(Yn===Hr.width&&ui===Hr.height)return si;for(var Ni=Hr.colorAttachments,io=0;io<Ni.length;++io)Qt(Ni[io],Yn,ui);return Qt(Hr.depthAttachment,Yn,ui),Qt(Hr.stencilAttachment,Yn,ui),Qt(Hr.depthStencilAttachment,Yn,ui),Hr.width=si.width=Yn,Hr.height=si.height=ui,$t(Hr),si}return si(xr,Fr),g(si,{resize:ni,_reglType:"framebuffer",_framebuffer:Hr,destroy:function(){Bn(Hr),$r(Hr)},use:function(Vr){Kt.setFBO({framebuffer:si},Vr)}})}function dn(xr){var Fr=Array(6);function Hr(ni){var Vr;fe(Fr.indexOf(Kt.next)<0,"can not update framebuffer which is currently in use");var Jr={color:null},Yn=0,ui=null,Ni="rgba",io="uint8",co=1;if(typeof ni=="number")Yn=ni|0;else if(!ni)Yn=1;else{fe.type(ni,"object","invalid arguments for framebuffer");var ki=ni;if("shape"in ki){var as=ki.shape;fe(Array.isArray(as)&&as.length>=2,"invalid shape for framebuffer"),fe(as[0]===as[1],"cube framebuffer must be square"),Yn=as[0]}else"radius"in ki&&(Yn=ki.radius|0),"width"in ki?(Yn=ki.width|0,"height"in ki&&fe(ki.height===Yn,"must be square")):"height"in ki&&(Yn=ki.height|0);("color"in ki||"colors"in ki)&&(ui=ki.color||ki.colors,Array.isArray(ui)&&fe(ui.length===1||ce.webgl_draw_buffers,"multiple render targets not supported")),ui||("colorCount"in ki&&(co=ki.colorCount|0,fe(co>0,"invalid color buffer count")),"colorType"in ki&&(fe.oneOf(ki.colorType,yr,"invalid color type"),io=ki.colorType),"colorFormat"in ki&&(Ni=ki.colorFormat,fe.oneOf(ki.colorFormat,cr,"invalid color format for texture"))),"depth"in ki&&(Jr.depth=ki.depth),"stencil"in ki&&(Jr.stencil=ki.stencil),"depthStencil"in ki&&(Jr.depthStencil=ki.depthStencil)}var Ga;if(ui)if(Array.isArray(ui))for(Ga=[],Vr=0;Vr<ui.length;++Vr)Ga[Vr]=ui[Vr];else Ga=[ui];else{Ga=Array(co);var qo={radius:Yn,format:Ni,type:io};for(Vr=0;Vr<co;++Vr)Ga[Vr]=Rt.createCube(qo)}for(Jr.color=Array(Ga.length),Vr=0;Vr<Ga.length;++Vr){var So=Ga[Vr];fe(typeof So=="function"&&So._reglType==="textureCube","invalid cube map"),Yn=Yn||So.width,fe(So.width===Yn&&So.height===Yn,"invalid cube map shape"),Jr.color[Vr]={target:al,data:Ga[Vr]}}for(Vr=0;Vr<6;++Vr){for(var Zo=0;Zo<Ga.length;++Zo)Jr.color[Zo].target=al+Vr;Vr>0&&(Jr.depth=Fr[0].depth,Jr.stencil=Fr[0].stencil,Jr.depthStencil=Fr[0].depthStencil),Fr[Vr]?Fr[Vr](Jr):Fr[Vr]=er(Jr)}return g(Hr,{width:Yn,height:Yn,color:Ga})}function si(ni){var Vr,Jr=ni|0;if(fe(Jr>0&&Jr<=Fe.maxCubeMapSize,"invalid radius for cube fbo"),Jr===Hr.width)return Hr;var Yn=Hr.color;for(Vr=0;Vr<Yn.length;++Vr)Yn[Vr].resize(Jr);for(Vr=0;Vr<6;++Vr)Fr[Vr].resize(Jr);return Hr.width=Hr.height=Jr,Hr}return Hr(xr),g(Hr,{faces:Fr,resize:si,_reglType:"framebufferCube",destroy:function(){Fr.forEach(function(ni){ni.destroy()})}})}function Yr(){Kt.cur=null,Kt.next=null,Kt.dirty=!0,J(lr).forEach(function(xr){xr.framebuffer=B.createFramebuffer(),$t(xr)})}return g(Kt,{getFramebuffer:function(xr){if(typeof xr=="function"&&xr._reglType==="framebuffer"){var Fr=xr._framebuffer;if(Fr instanceof Rr)return Fr}return null},create:er,createCube:dn,clear:function(){J(lr).forEach(Bn)},restore:Yr})}var we=5126,Ge=34962,Ce=34963,Ve=["attributes","elements","offset","count","primitive","instances"];function $e(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=we,this.offset=0,this.stride=0,this.divisor=0}function yt(B,ce,Fe,Rt,ar,It,Kt){for(var cr=Fe.maxAttributes,mr=new Array(cr),yr=0;yr<cr;++yr)mr[yr]=new $e;var Sr=0,Mr={},Gr={Record:$e,scope:{},state:mr,currentVAO:null,targetVAO:null,restore:br()?$r:function(){},createVAO:Bn,getVAO:Zt,destroyBuffer:_r,setVAO:br()?Qt:Pr,clear:br()?lr:function(){}};function _r($t){for(var er=0;er<mr.length;++er){var dn=mr[er];dn.buffer===$t&&(B.disableVertexAttribArray(er),dn.buffer=null)}}function br(){return ce.oes_vertex_array_object}function nt(){return ce.angle_instanced_arrays}function Zt($t){return typeof $t=="function"&&$t._vao?$t._vao:null}function Qt($t){if($t!==Gr.currentVAO){var er=br();$t?er.bindVertexArrayOES($t.vao):er.bindVertexArrayOES(null),Gr.currentVAO=$t}}function Pr($t){if($t!==Gr.currentVAO){if($t)$t.bindAttrs();else{for(var er=nt(),dn=0;dn<mr.length;++dn){var Yr=mr[dn];Yr.buffer?(B.enableVertexAttribArray(dn),Yr.buffer.bind(),B.vertexAttribPointer(dn,Yr.size,Yr.type,Yr.normalized,Yr.stride,Yr.offfset),er&&Yr.divisor&&er.vertexAttribDivisorANGLE(dn,Yr.divisor)):(B.disableVertexAttribArray(dn),B.vertexAttrib4f(dn,Yr.x,Yr.y,Yr.z,Yr.w))}Kt.elements?B.bindBuffer(Ce,Kt.elements.buffer.buffer):B.bindBuffer(Ce,null)}Gr.currentVAO=$t}}function lr(){J(Mr).forEach(function($t){$t.destroy()})}function Rr(){this.id=++Sr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var $t=br();$t?this.vao=$t.createVertexArrayOES():this.vao=null,Mr[this.id]=this,this.buffers=[]}Rr.prototype.bindAttrs=function(){for(var $t=nt(),er=this.attributes,dn=0;dn<er.length;++dn){var Yr=er[dn];Yr.buffer?(B.enableVertexAttribArray(dn),B.bindBuffer(Ge,Yr.buffer.buffer),B.vertexAttribPointer(dn,Yr.size,Yr.type,Yr.normalized,Yr.stride,Yr.offset),$t&&Yr.divisor&&$t.vertexAttribDivisorANGLE(dn,Yr.divisor)):(B.disableVertexAttribArray(dn),B.vertexAttrib4f(dn,Yr.x,Yr.y,Yr.z,Yr.w))}for(var xr=er.length;xr<cr;++xr)B.disableVertexAttribArray(xr);var Fr=It.getElements(this.elements);Fr?B.bindBuffer(Ce,Fr.buffer.buffer):B.bindBuffer(Ce,null)},Rr.prototype.refresh=function(){var $t=br();$t&&($t.bindVertexArrayOES(this.vao),this.bindAttrs(),Gr.currentVAO=null,$t.bindVertexArrayOES(null))},Rr.prototype.destroy=function(){if(this.vao){var $t=br();this===Gr.currentVAO&&(Gr.currentVAO=null,$t.bindVertexArrayOES(null)),$t.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Mr[this.id]&&(delete Mr[this.id],Rt.vaoCount-=1)};function $r(){var $t=br();$t&&J(Mr).forEach(function(er){er.refresh()})}function Bn($t){var er=new Rr;Rt.vaoCount+=1;function dn(Yr){var xr;if(Array.isArray(Yr))xr=Yr,er.elements&&er.ownsElements&&er.elements.destroy(),er.elements=null,er.ownsElements=!1,er.offset=0,er.count=0,er.instances=-1,er.primitive=4;else{if(fe(typeof Yr=="object","invalid arguments for create vao"),fe("attributes"in Yr,"must specify attributes for vao"),Yr.elements){var Fr=Yr.elements;er.ownsElements?typeof Fr=="function"&&Fr._reglType==="elements"?(er.elements.destroy(),er.ownsElements=!1):(er.elements(Fr),er.ownsElements=!1):It.getElements(Yr.elements)?(er.elements=Yr.elements,er.ownsElements=!1):(er.elements=It.create(Yr.elements),er.ownsElements=!0)}else er.elements=null,er.ownsElements=!1;xr=Yr.attributes,er.offset=0,er.count=-1,er.instances=-1,er.primitive=4,er.elements&&(er.count=er.elements._elements.vertCount,er.primitive=er.elements._elements.primType),"offset"in Yr&&(er.offset=Yr.offset|0),"count"in Yr&&(er.count=Yr.count|0),"instances"in Yr&&(er.instances=Yr.instances|0),"primitive"in Yr&&(fe(Yr.primitive in ir,"bad primitive type: "+Yr.primitive),er.primitive=ir[Yr.primitive]),fe.optional(function(){for(var io=Object.keys(Yr),co=0;co<io.length;++co)fe(Ve.indexOf(io[co])>=0,'invalid option for vao: "'+io[co]+'" valid options are '+Ve)}),fe(Array.isArray(xr),"attributes must be an array")}fe(xr.length<cr,"too many attributes"),fe(xr.length>0,"must specify at least one attribute");var Hr={},si=er.attributes;si.length=xr.length;for(var ni=0;ni<xr.length;++ni){var Vr=xr[ni],Jr=si[ni]=new $e,Yn=Vr.data||Vr;if(Array.isArray(Yn)||_e(Yn)||ys(Yn)){var ui;er.buffers[ni]&&(ui=er.buffers[ni],_e(Yn)&&ui._buffer.byteLength>=Yn.byteLength?ui.subdata(Yn):(ui.destroy(),er.buffers[ni]=null)),er.buffers[ni]||(ui=er.buffers[ni]=ar.create(Vr,Ge,!1,!0)),Jr.buffer=ar.getBuffer(ui),Jr.size=Jr.buffer.dimension|0,Jr.normalized=!1,Jr.type=Jr.buffer.dtype,Jr.offset=0,Jr.stride=0,Jr.divisor=0,Jr.state=1,Hr[ni]=1}else ar.getBuffer(Vr)?(Jr.buffer=ar.getBuffer(Vr),Jr.size=Jr.buffer.dimension|0,Jr.normalized=!1,Jr.type=Jr.buffer.dtype,Jr.offset=0,Jr.stride=0,Jr.divisor=0,Jr.state=1):ar.getBuffer(Vr.buffer)?(Jr.buffer=ar.getBuffer(Vr.buffer),Jr.size=(+Vr.size||Jr.buffer.dimension)|0,Jr.normalized=!!Vr.normalized||!1,"type"in Vr?(fe.parameter(Vr.type,ou,"invalid buffer type"),Jr.type=ou[Vr.type]):Jr.type=Jr.buffer.dtype,Jr.offset=(Vr.offset||0)|0,Jr.stride=(Vr.stride||0)|0,Jr.divisor=(Vr.divisor||0)|0,Jr.state=1,fe(Jr.size>=1&&Jr.size<=4,"size must be between 1 and 4"),fe(Jr.offset>=0,"invalid offset"),fe(Jr.stride>=0&&Jr.stride<=255,"stride must be between 0 and 255"),fe(Jr.divisor>=0,"divisor must be positive"),fe(!Jr.divisor||!!ce.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Vr?(fe(ni>0,"first attribute must not be a constant"),Jr.x=+Vr.x||0,Jr.y=+Vr.y||0,Jr.z=+Vr.z||0,Jr.w=+Vr.w||0,Jr.state=2):fe(!1,"invalid attribute spec for location "+ni)}for(var Ni=0;Ni<er.buffers.length;++Ni)!Hr[Ni]&&er.buffers[Ni]&&(er.buffers[Ni].destroy(),er.buffers[Ni]=null);return er.refresh(),dn}return dn.destroy=function(){for(var Yr=0;Yr<er.buffers.length;++Yr)er.buffers[Yr]&&er.buffers[Yr].destroy();er.buffers.length=0,er.ownsElements&&(er.elements.destroy(),er.elements=null,er.ownsElements=!1),er.destroy()},dn._vao=er,dn._reglType="vao",dn($t)}return Gr}var Vt=35632,Bt=35633,Xt=35718,vr=35721;function Br(B,ce,Fe,Rt){var ar={},It={};function Kt(nt,Zt,Qt,Pr){this.name=nt,this.id=Zt,this.location=Qt,this.info=Pr}function cr(nt,Zt){for(var Qt=0;Qt<nt.length;++Qt)if(nt[Qt].id===Zt.id){nt[Qt].location=Zt.location;return}nt.push(Zt)}function mr(nt,Zt,Qt){var Pr=nt===Vt?ar:It,lr=Pr[Zt];if(!lr){var Rr=ce.str(Zt);lr=B.createShader(nt),B.shaderSource(lr,Rr),B.compileShader(lr),fe.shaderError(B,lr,Rr,nt,Qt),Pr[Zt]=lr}return lr}var yr={},Sr=[],Mr=0;function Gr(nt,Zt){this.id=Mr++,this.fragId=nt,this.vertId=Zt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Rt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function _r(nt,Zt,Qt){var Pr,lr,Rr=mr(Vt,nt.fragId),$r=mr(Bt,nt.vertId),Bn=nt.program=B.createProgram();if(B.attachShader(Bn,Rr),B.attachShader(Bn,$r),Qt)for(Pr=0;Pr<Qt.length;++Pr){var $t=Qt[Pr];B.bindAttribLocation(Bn,$t[0],$t[1])}B.linkProgram(Bn),fe.linkError(B,Bn,ce.str(nt.fragId),ce.str(nt.vertId),Zt);var er=B.getProgramParameter(Bn,Xt);Rt.profile&&(nt.stats.uniformsCount=er);var dn=nt.uniforms;for(Pr=0;Pr<er;++Pr)if(lr=B.getActiveUniform(Bn,Pr),lr)if(lr.size>1)for(var Yr=0;Yr<lr.size;++Yr){var xr=lr.name.replace("[0]","["+Yr+"]");cr(dn,new Kt(xr,ce.id(xr),B.getUniformLocation(Bn,xr),lr))}else cr(dn,new Kt(lr.name,ce.id(lr.name),B.getUniformLocation(Bn,lr.name),lr));var Fr=B.getProgramParameter(Bn,vr);Rt.profile&&(nt.stats.attributesCount=Fr);var Hr=nt.attributes;for(Pr=0;Pr<Fr;++Pr)lr=B.getActiveAttrib(Bn,Pr),lr&&cr(Hr,new Kt(lr.name,ce.id(lr.name),B.getAttribLocation(Bn,lr.name),lr))}Rt.profile&&(Fe.getMaxUniformsCount=function(){var nt=0;return Sr.forEach(function(Zt){Zt.stats.uniformsCount>nt&&(nt=Zt.stats.uniformsCount)}),nt},Fe.getMaxAttributesCount=function(){var nt=0;return Sr.forEach(function(Zt){Zt.stats.attributesCount>nt&&(nt=Zt.stats.attributesCount)}),nt});function br(){ar={},It={};for(var nt=0;nt<Sr.length;++nt)_r(Sr[nt],null,Sr[nt].attributes.map(function(Zt){return[Zt.location,Zt.name]}))}return{clear:function(){var nt=B.deleteShader.bind(B);J(ar).forEach(nt),ar={},J(It).forEach(nt),It={},Sr.forEach(function(Zt){B.deleteProgram(Zt.program)}),Sr.length=0,yr={},Fe.shaderCount=0},program:function(nt,Zt,Qt,Pr){fe.command(nt>=0,"missing vertex shader",Qt),fe.command(Zt>=0,"missing fragment shader",Qt);var lr=yr[Zt];lr||(lr=yr[Zt]={});var Rr=lr[nt];if(Rr&&(Rr.refCount++,!Pr))return Rr;var $r=new Gr(Zt,nt);return Fe.shaderCount++,_r($r,Qt,Pr),Rr||(lr[nt]=$r),Sr.push($r),g($r,{destroy:function(){if($r.refCount--,$r.refCount<=0){B.deleteProgram($r.program);var Bn=Sr.indexOf($r);Sr.splice(Bn,1),Fe.shaderCount--}lr[$r.vertId].refCount<=0&&(B.deleteShader(It[$r.vertId]),delete It[$r.vertId],delete yr[$r.fragId][$r.vertId]),Object.keys(yr[$r.fragId]).length||(B.deleteShader(ar[$r.fragId]),delete ar[$r.fragId],delete yr[$r.fragId])}})},restore:br,shader:mr,frag:-1,vert:-1}}var Lr=6408,jr=5121,Fn=3333,On=5126;function Zn(B,ce,Fe,Rt,ar,It,Kt){function cr(Sr){var Mr;ce.next===null?(fe(ar.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Mr=jr):(fe(ce.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Mr=ce.next.colorAttachments[0].texture._texture.type,fe.optional(function(){It.oes_texture_float?(fe(Mr===jr||Mr===On,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Mr===On&&fe(Kt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):fe(Mr===jr,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Gr=0,_r=0,br=Rt.framebufferWidth,nt=Rt.framebufferHeight,Zt=null;_e(Sr)?Zt=Sr:Sr&&(fe.type(Sr,"object","invalid arguments to regl.read()"),Gr=Sr.x|0,_r=Sr.y|0,fe(Gr>=0&&Gr<Rt.framebufferWidth,"invalid x offset for regl.read"),fe(_r>=0&&_r<Rt.framebufferHeight,"invalid y offset for regl.read"),br=(Sr.width||Rt.framebufferWidth-Gr)|0,nt=(Sr.height||Rt.framebufferHeight-_r)|0,Zt=Sr.data||null),Zt&&(Mr===jr?fe(Zt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Mr===On&&fe(Zt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),fe(br>0&&br+Gr<=Rt.framebufferWidth,"invalid width for read pixels"),fe(nt>0&&nt+_r<=Rt.framebufferHeight,"invalid height for read pixels"),Fe();var Qt=br*nt*4;return Zt||(Mr===jr?Zt=new Uint8Array(Qt):Mr===On&&(Zt=Zt||new Float32Array(Qt))),fe.isTypedArray(Zt,"data buffer for regl.read() must be a typedarray"),fe(Zt.byteLength>=Qt,"data buffer for regl.read() too small"),B.pixelStorei(Fn,4),B.readPixels(Gr,_r,br,nt,Lr,Mr,Zt),Zt}function mr(Sr){var Mr;return ce.setFBO({framebuffer:Sr.framebuffer},function(){Mr=cr(Sr)}),Mr}function yr(Sr){return!Sr||!("framebuffer"in Sr)?cr(Sr):mr(Sr)}return yr}function Oi(B){return Array.prototype.slice.call(B)}function un(B){return Oi(B).join("")}function Qn(){var B=0,ce=[],Fe=[];function Rt(Mr){for(var Gr=0;Gr<Fe.length;++Gr)if(Fe[Gr]===Mr)return ce[Gr];var _r="g"+B++;return ce.push(_r),Fe.push(Mr),_r}function ar(){var Mr=[];function Gr(){Mr.push.apply(Mr,Oi(arguments))}var _r=[];function br(){var nt="v"+B++;return _r.push(nt),arguments.length>0&&(Mr.push(nt,"="),Mr.push.apply(Mr,Oi(arguments)),Mr.push(";")),nt}return g(Gr,{def:br,toString:function(){return un([_r.length>0?"var "+_r.join(",")+";":"",un(Mr)])}})}function It(){var Mr=ar(),Gr=ar(),_r=Mr.toString,br=Gr.toString;function nt(Zt,Qt){Gr(Zt,Qt,"=",Mr.def(Zt,Qt),";")}return g(function(){Mr.apply(Mr,Oi(arguments))},{def:Mr.def,entry:Mr,exit:Gr,save:nt,set:function(Zt,Qt,Pr){nt(Zt,Qt),Mr(Zt,Qt,"=",Pr,";")},toString:function(){return _r()+br()}})}function Kt(){var Mr=un(arguments),Gr=It(),_r=It(),br=Gr.toString,nt=_r.toString;return g(Gr,{then:function(){return Gr.apply(Gr,Oi(arguments)),this},else:function(){return _r.apply(_r,Oi(arguments)),this},toString:function(){var Zt=nt();return Zt&&(Zt="else{"+Zt+"}"),un(["if(",Mr,"){",br(),"}",Zt])}})}var cr=ar(),mr={};function yr(Mr,Gr){var _r=[];function br(){var lr="a"+_r.length;return _r.push(lr),lr}Gr=Gr||0;for(var nt=0;nt<Gr;++nt)br();var Zt=It(),Qt=Zt.toString,Pr=mr[Mr]=g(Zt,{arg:br,toString:function(){return un(["function(",_r.join(),"){",Qt(),"}"])}});return Pr}function Sr(){var Mr=['"use strict";',cr,"return {"];Object.keys(mr).forEach(function(nt){Mr.push('"',nt,'":',mr[nt].toString(),",")}),Mr.push("}");var Gr=un(Mr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),_r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,br=_r?Oe.Function.apply(null,ce.concat(Gr)):Function.apply(null,ce.concat(Gr));return br.apply(null,Fe)}return{global:cr,link:Rt,block:ar,proc:yr,scope:It,cond:Kt,compile:Sr}}var li="xyzw".split(""),Jn=5121,Hn=1,pi=2,Kn=0,Wn=1,go=2,Va=3,No=4,zo=5,$a=6,lo="dither",Ds="blend.enable",fs="blend.color",Uo="blend.equation",ps="blend.func",is="depth.enable",Js="depth.func",Pu="depth.range",ol="depth.mask",Xu="colorMask",Hl="cull.enable",dc="cull.face",mu="frontFace",Qa="lineWidth",Ta="polygonOffset.enable",no="polygonOffset.offset",Iu="sample.alpha",Gs="sample.enable",El="sample.coverage",ua="stencil.enable",eu="stencil.mask",As="stencil.func",Yu="stencil.opFront",Fs="stencil.opBack",df="scissor.enable",Yf="scissor.box",gu="viewport",Ou="profile",Hs="framebuffer",Ru="vert",vc="frag",yu="elements",yo="primitive",Sl="count",vf="offset",qf="instances",Hc="vao",Pp="Width",nh="Height",Wl=Hs+Pp,tu=Hs+nh,Kf=gu+Pp,zh=gu+nh,Xl="drawingBuffer",mf=Xl+Pp,Uh=Xl+nh,Ad=[ps,Uo,As,Yu,Fs,El,gu,Yf,no],gf=34962,$f=34963,wd=35632,Zh=35633,ih=3553,Ip=34067,jh=2884,yf=3042,Td=3024,Ro=2960,Qf=2929,Vh=3089,Op=32823,Rp=32926,_f=32928,mc=5126,Jf=35664,gc=35665,xf=35666,ep=5124,Lp=35667,Yl=35668,kp=35669,bf=35670,Ef=35671,Sf=35672,Cf=35673,ru=35674,tp=35675,rp=35676,np=35678,Cl=35680,Dp=4,Al=1028,Wc=1029,Gh=2304,ip=2305,ah=32775,Md=32776,Pd=519,_u=7680,oh=0,Fp=1,Af=32774,sl=513,Hh=36160,sh=36064,ql={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Nr=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Xc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},zt={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Wh={frag:wd,vert:Zh},uh={cw:Gh,ccw:ip};function ap(B){return Array.isArray(B)||_e(B)||ys(B)}function Bp(B){return B.sort(function(ce,Fe){return ce===gu?-1:Fe===gu?1:ce<Fe?-1:1})}function ha(B,ce,Fe,Rt){this.thisDep=B,this.contextDep=ce,this.propDep=Fe,this.append=Rt}function yc(B){return B&&!(B.thisDep||B.contextDep||B.propDep)}function Eo(B){return new ha(!1,!1,!1,B)}function hs(B,ce){var Fe=B.type;if(Fe===Kn){var Rt=B.data.length;return new ha(!0,Rt>=1,Rt>=2,ce)}else if(Fe===No){var ar=B.data;return new ha(ar.thisDep,ar.contextDep,ar.propDep,ce)}else{if(Fe===zo)return new ha(!1,!1,!1,ce);if(Fe===$a){for(var It=!1,Kt=!1,cr=!1,mr=0;mr<B.data.length;++mr){var yr=B.data[mr];if(yr.type===Wn)cr=!0;else if(yr.type===go)Kt=!0;else if(yr.type===Va)It=!0;else if(yr.type===Kn){It=!0;var Sr=yr.data;Sr>=1&&(Kt=!0),Sr>=2&&(cr=!0)}else yr.type===No&&(It=It||yr.data.thisDep,Kt=Kt||yr.data.contextDep,cr=cr||yr.data.propDep)}return new ha(It,Kt,cr,ce)}else return new ha(Fe===Va,Fe===go,Fe===Wn,ce)}}var Xh=new ha(!1,!1,!1,function(){});function Yh(B,ce,Fe,Rt,ar,It,Kt,cr,mr,yr,Sr,Mr,Gr,_r,br){var nt=yr.Record,Zt={add:32774,subtract:32778,"reverse subtract":32779};Fe.ext_blend_minmax&&(Zt.min=ah,Zt.max=Md);var Qt=Fe.angle_instanced_arrays,Pr=Fe.webgl_draw_buffers,lr=Fe.oes_vertex_array_object,Rr={dirty:!0,profile:br.profile},$r={},Bn=[],$t={},er={};function dn(be){return be.replace(".","_")}function Yr(be,ne,Ze){var ot=dn(be);Bn.push(be),$r[ot]=Rr[ot]=!!Ze,$t[ot]=ne}function xr(be,ne,Ze){var ot=dn(be);Bn.push(be),Array.isArray(Ze)?(Rr[ot]=Ze.slice(),$r[ot]=Ze.slice()):Rr[ot]=$r[ot]=Ze,er[ot]=ne}Yr(lo,Td),Yr(Ds,yf),xr(fs,"blendColor",[0,0,0,0]),xr(Uo,"blendEquationSeparate",[Af,Af]),xr(ps,"blendFuncSeparate",[Fp,oh,Fp,oh]),Yr(is,Qf,!0),xr(Js,"depthFunc",sl),xr(Pu,"depthRange",[0,1]),xr(ol,"depthMask",!0),xr(Xu,Xu,[!0,!0,!0,!0]),Yr(Hl,jh),xr(dc,"cullFace",Wc),xr(mu,mu,ip),xr(Qa,Qa,1),Yr(Ta,Op),xr(no,"polygonOffset",[0,0]),Yr(Iu,Rp),Yr(Gs,_f),xr(El,"sampleCoverage",[1,!1]),Yr(ua,Ro),xr(eu,"stencilMask",-1),xr(As,"stencilFunc",[Pd,0,-1]),xr(Yu,"stencilOpSeparate",[Al,_u,_u,_u]),xr(Fs,"stencilOpSeparate",[Wc,_u,_u,_u]),Yr(df,Vh),xr(Yf,"scissor",[0,0,B.drawingBufferWidth,B.drawingBufferHeight]),xr(gu,gu,[0,0,B.drawingBufferWidth,B.drawingBufferHeight]);var Fr={gl:B,context:Gr,strings:ce,next:$r,current:Rr,draw:Mr,elements:It,buffer:ar,shader:Sr,attributes:yr.state,vao:yr,uniforms:mr,framebuffer:cr,extensions:Fe,timer:_r,isBufferArgs:ap},Hr={primTypes:ir,compareFuncs:Xc,blendFuncs:ql,blendEquations:Zt,stencilOps:zt,glTypes:ou,orientationType:uh};fe.optional(function(){Fr.isArrayLike=so}),Pr&&(Hr.backBuffer=[Wc],Hr.drawBuffer=je(Rt.maxDrawbuffers,function(be){return be===0?[0]:je(be,function(ne){return sh+ne})}));var si=0;function ni(){var be=Qn(),ne=be.link,Ze=be.global;be.id=si++,be.batchId="0";var ot=ne(Fr),Tt=be.shared={props:"a0"};Object.keys(Fr).forEach(function(Ue){Tt[Ue]=Ze.def(ot,".",Ue)}),fe.optional(function(){be.CHECK=ne(fe),be.commandStr=fe.guessCommand(),be.command=ne(be.commandStr),be.assert=function(Ue,Ee,at){Ue("if(!(",Ee,"))",this.CHECK,".commandRaise(",ne(at),",",this.command,");")},Hr.invalidBlendCombinations=Nr});var Ye=be.next={},De=be.current={};Object.keys(er).forEach(function(Ue){Array.isArray(Rr[Ue])&&(Ye[Ue]=Ze.def(Tt.next,".",Ue),De[Ue]=Ze.def(Tt.current,".",Ue))});var Je=be.constants={};Object.keys(Hr).forEach(function(Ue){Je[Ue]=Ze.def(JSON.stringify(Hr[Ue]))}),be.invoke=function(Ue,Ee){switch(Ee.type){case Kn:var at=["this",Tt.context,Tt.props,be.batchId];return Ue.def(ne(Ee.data),".call(",at.slice(0,Math.max(Ee.data.length+1,4)),")");case Wn:return Ue.def(Tt.props,Ee.data);case go:return Ue.def(Tt.context,Ee.data);case Va:return Ue.def("this",Ee.data);case No:return Ee.data.append(be,Ue),Ee.data.ref;case zo:return Ee.data.toString();case $a:return Ee.data.map(function(bt){return be.invoke(Ue,bt)})}},be.attribCache={};var ve={};return be.scopeAttrib=function(Ue){var Ee=ce.id(Ue);if(Ee in ve)return ve[Ee];var at=yr.scope[Ee];at||(at=yr.scope[Ee]=new nt);var bt=ve[Ee]=ne(at);return bt},be}function Vr(be){var ne=be.static,Ze=be.dynamic,ot;if(Ou in ne){var Tt=!!ne[Ou];ot=Eo(function(De,Je){return Tt}),ot.enable=Tt}else if(Ou in Ze){var Ye=Ze[Ou];ot=hs(Ye,function(De,Je){return De.invoke(Je,Ye)})}return ot}function Jr(be,ne){var Ze=be.static,ot=be.dynamic;if(Hs in Ze){var Tt=Ze[Hs];return Tt?(Tt=cr.getFramebuffer(Tt),fe.command(Tt,"invalid framebuffer object"),Eo(function(De,Je){var ve=De.link(Tt),Ue=De.shared;Je.set(Ue.framebuffer,".next",ve);var Ee=Ue.context;return Je.set(Ee,"."+Wl,ve+".width"),Je.set(Ee,"."+tu,ve+".height"),ve})):Eo(function(De,Je){var ve=De.shared;Je.set(ve.framebuffer,".next","null");var Ue=ve.context;return Je.set(Ue,"."+Wl,Ue+"."+mf),Je.set(Ue,"."+tu,Ue+"."+Uh),"null"})}else if(Hs in ot){var Ye=ot[Hs];return hs(Ye,function(De,Je){var ve=De.invoke(Je,Ye),Ue=De.shared,Ee=Ue.framebuffer,at=Je.def(Ee,".getFramebuffer(",ve,")");fe.optional(function(){De.assert(Je,"!"+ve+"||"+at,"invalid framebuffer object")}),Je.set(Ee,".next",at);var bt=Ue.context;return Je.set(bt,"."+Wl,at+"?"+at+".width:"+bt+"."+mf),Je.set(bt,"."+tu,at+"?"+at+".height:"+bt+"."+Uh),at})}else return null}function Yn(be,ne,Ze){var ot=be.static,Tt=be.dynamic;function Ye(ve){if(ve in ot){var Ue=ot[ve];fe.commandType(Ue,"object","invalid "+ve,Ze.commandStr);var Ee=!0,at=Ue.x|0,bt=Ue.y|0,fr,zr;return"width"in Ue?(fr=Ue.width|0,fe.command(fr>=0,"invalid "+ve,Ze.commandStr)):Ee=!1,"height"in Ue?(zr=Ue.height|0,fe.command(zr>=0,"invalid "+ve,Ze.commandStr)):Ee=!1,new ha(!Ee&&ne&&ne.thisDep,!Ee&&ne&&ne.contextDep,!Ee&&ne&&ne.propDep,function(kr,Cn){var ln=kr.shared.context,xn=fr;"width"in Ue||(xn=Cn.def(ln,".",Wl,"-",at));var bn=zr;return"height"in Ue||(bn=Cn.def(ln,".",tu,"-",bt)),[at,bt,xn,bn]})}else if(ve in Tt){var Zr=Tt[ve],en=hs(Zr,function(kr,Cn){var ln=kr.invoke(Cn,Zr);fe.optional(function(){kr.assert(Cn,ln+"&&typeof "+ln+'==="object"',"invalid "+ve)});var xn=kr.shared.context,bn=Cn.def(ln,".x|0"),mn=Cn.def(ln,".y|0"),qn=Cn.def('"width" in ',ln,"?",ln,".width|0:","(",xn,".",Wl,"-",bn,")"),_a=Cn.def('"height" in ',ln,"?",ln,".height|0:","(",xn,".",tu,"-",mn,")");return fe.optional(function(){kr.assert(Cn,qn+">=0&&"+_a+">=0","invalid "+ve)}),[bn,mn,qn,_a]});return ne&&(en.thisDep=en.thisDep||ne.thisDep,en.contextDep=en.contextDep||ne.contextDep,en.propDep=en.propDep||ne.propDep),en}else return ne?new ha(ne.thisDep,ne.contextDep,ne.propDep,function(kr,Cn){var ln=kr.shared.context;return[0,0,Cn.def(ln,".",Wl),Cn.def(ln,".",tu)]}):null}var De=Ye(gu);if(De){var Je=De;De=new ha(De.thisDep,De.contextDep,De.propDep,function(ve,Ue){var Ee=Je.append(ve,Ue),at=ve.shared.context;return Ue.set(at,"."+Kf,Ee[2]),Ue.set(at,"."+zh,Ee[3]),Ee})}return{viewport:De,scissor_box:Ye(Yf)}}function ui(be,ne){var Ze=be.static,ot=typeof Ze[vc]=="string"&&typeof Ze[Ru]=="string";if(ot){if(Object.keys(ne.dynamic).length>0)return null;var Tt=ne.static,Ye=Object.keys(Tt);if(Ye.length>0&&typeof Tt[Ye[0]]=="number"){for(var De=[],Je=0;Je<Ye.length;++Je)fe(typeof Tt[Ye[Je]]=="number","must specify all vertex attribute locations when using vaos"),De.push([Tt[Ye[Je]]|0,Ye[Je]]);return De}}return null}function Ni(be,ne,Ze){var ot=be.static,Tt=be.dynamic;function Ye(Ee){if(Ee in ot){var at=ce.id(ot[Ee]);fe.optional(function(){Sr.shader(Wh[Ee],at,fe.guessCommand())});var bt=Eo(function(){return at});return bt.id=at,bt}else if(Ee in Tt){var fr=Tt[Ee];return hs(fr,function(zr,Zr){var en=zr.invoke(Zr,fr),kr=Zr.def(zr.shared.strings,".id(",en,")");return fe.optional(function(){Zr(zr.shared.shader,".shader(",Wh[Ee],",",kr,",",zr.command,");")}),kr})}return null}var De=Ye(vc),Je=Ye(Ru),ve=null,Ue;return yc(De)&&yc(Je)?(ve=Sr.program(Je.id,De.id,null,Ze),Ue=Eo(function(Ee,at){return Ee.link(ve)})):Ue=new ha(De&&De.thisDep||Je&&Je.thisDep,De&&De.contextDep||Je&&Je.contextDep,De&&De.propDep||Je&&Je.propDep,function(Ee,at){var bt=Ee.shared.shader,fr;De?fr=De.append(Ee,at):fr=at.def(bt,".",vc);var zr;Je?zr=Je.append(Ee,at):zr=at.def(bt,".",Ru);var Zr=bt+".program("+zr+","+fr;return fe.optional(function(){Zr+=","+Ee.command}),at.def(Zr+")")}),{frag:De,vert:Je,progVar:Ue,program:ve}}function io(be,ne){var Ze=be.static,ot=be.dynamic,Tt={},Ye=!1;function De(){if(Hc in Ze){var Cn=Ze[Hc];return Cn!==null&&yr.getVAO(Cn)===null&&(Cn=yr.createVAO(Cn)),Ye=!0,Tt.vao=Cn,Eo(function(xn){var bn=yr.getVAO(Cn);return bn?xn.link(bn):"null"})}else if(Hc in ot){Ye=!0;var ln=ot[Hc];return hs(ln,function(xn,bn){var mn=xn.invoke(bn,ln);return bn.def(xn.shared.vao+".getVAO("+mn+")")})}return null}var Je=De(),ve=!1;function Ue(){if(yu in Ze){var Cn=Ze[yu];if(Tt.elements=Cn,ap(Cn)){var ln=Tt.elements=It.create(Cn,!0);Cn=It.getElements(ln),ve=!0}else Cn&&(Cn=It.getElements(Cn),ve=!0,fe.command(Cn,"invalid elements",ne.commandStr));var xn=Eo(function(mn,qn){if(Cn){var _a=mn.link(Cn);return mn.ELEMENTS=_a,_a}return mn.ELEMENTS=null,null});return xn.value=Cn,xn}else if(yu in ot){ve=!0;var bn=ot[yu];return hs(bn,function(mn,qn){var _a=mn.shared,os=_a.isBufferArgs,Pa=_a.elements,ca=mn.invoke(qn,bn),ul=qn.def("null"),vs=qn.def(os,"(",ca,")"),ll=mn.cond(vs).then(ul,"=",Pa,".createStream(",ca,");").else(ul,"=",Pa,".getElements(",ca,");");return fe.optional(function(){mn.assert(ll.else,"!"+ca+"||"+ul,"invalid elements")}),qn.entry(ll),qn.exit(mn.cond(vs).then(Pa,".destroyStream(",ul,");")),mn.ELEMENTS=ul,ul})}else if(Ye)return new ha(Je.thisDep,Je.contextDep,Je.propDep,function(mn,qn){return qn.def(mn.shared.vao+".currentVAO?"+mn.shared.elements+".getElements("+mn.shared.vao+".currentVAO.elements):null")});return null}var Ee=Ue();function at(){if(yo in Ze){var Cn=Ze[yo];return Tt.primitive=Cn,fe.commandParameter(Cn,ir,"invalid primitve",ne.commandStr),Eo(function(xn,bn){return ir[Cn]})}else if(yo in ot){var ln=ot[yo];return hs(ln,function(xn,bn){var mn=xn.constants.primTypes,qn=xn.invoke(bn,ln);return fe.optional(function(){xn.assert(bn,qn+" in "+mn,"invalid primitive, must be one of "+Object.keys(ir))}),bn.def(mn,"[",qn,"]")})}else{if(ve)return yc(Ee)?Ee.value?Eo(function(xn,bn){return bn.def(xn.ELEMENTS,".primType")}):Eo(function(){return Dp}):new ha(Ee.thisDep,Ee.contextDep,Ee.propDep,function(xn,bn){var mn=xn.ELEMENTS;return bn.def(mn,"?",mn,".primType:",Dp)});if(Ye)return new ha(Je.thisDep,Je.contextDep,Je.propDep,function(xn,bn){return bn.def(xn.shared.vao+".currentVAO?"+xn.shared.vao+".currentVAO.primitive:"+Dp)})}return null}function bt(Cn,ln){if(Cn in Ze){var xn=Ze[Cn]|0;return ln?Tt.offset=xn:Tt.instances=xn,fe.command(!ln||xn>=0,"invalid "+Cn,ne.commandStr),Eo(function(mn,qn){return ln&&(mn.OFFSET=xn),xn})}else if(Cn in ot){var bn=ot[Cn];return hs(bn,function(mn,qn){var _a=mn.invoke(qn,bn);return ln&&(mn.OFFSET=_a,fe.optional(function(){mn.assert(qn,_a+">=0","invalid "+Cn)})),_a})}else if(ln){if(ve)return Eo(function(mn,qn){return mn.OFFSET=0,0});if(Ye)return new ha(Je.thisDep,Je.contextDep,Je.propDep,function(mn,qn){return qn.def(mn.shared.vao+".currentVAO?"+mn.shared.vao+".currentVAO.offset:0")})}else if(Ye)return new ha(Je.thisDep,Je.contextDep,Je.propDep,function(mn,qn){return qn.def(mn.shared.vao+".currentVAO?"+mn.shared.vao+".currentVAO.instances:-1")});return null}var fr=bt(vf,!0);function zr(){if(Sl in Ze){var Cn=Ze[Sl]|0;return Tt.count=Cn,fe.command(typeof Cn=="number"&&Cn>=0,"invalid vertex count",ne.commandStr),Eo(function(){return Cn})}else if(Sl in ot){var ln=ot[Sl];return hs(ln,function(qn,_a){var os=qn.invoke(_a,ln);return fe.optional(function(){qn.assert(_a,"typeof "+os+'==="number"&&'+os+">=0&&"+os+"===("+os+"|0)","invalid vertex count")}),os})}else if(ve)if(yc(Ee)){if(Ee)return fr?new ha(fr.thisDep,fr.contextDep,fr.propDep,function(qn,_a){var os=_a.def(qn.ELEMENTS,".vertCount-",qn.OFFSET);return fe.optional(function(){qn.assert(_a,os+">=0","invalid vertex offset/element buffer too small")}),os}):Eo(function(qn,_a){return _a.def(qn.ELEMENTS,".vertCount")});var xn=Eo(function(){return-1});return fe.optional(function(){xn.MISSING=!0}),xn}else{var bn=new ha(Ee.thisDep||fr.thisDep,Ee.contextDep||fr.contextDep,Ee.propDep||fr.propDep,function(qn,_a){var os=qn.ELEMENTS;return qn.OFFSET?_a.def(os,"?",os,".vertCount-",qn.OFFSET,":-1"):_a.def(os,"?",os,".vertCount:-1")});return fe.optional(function(){bn.DYNAMIC=!0}),bn}else if(Ye){var mn=new ha(Je.thisDep,Je.contextDep,Je.propDep,function(qn,_a){return _a.def(qn.shared.vao,".currentVAO?",qn.shared.vao,".currentVAO.count:-1")});return mn}return null}var Zr=at(),en=zr(),kr=bt(qf,!1);return{elements:Ee,primitive:Zr,count:en,instances:kr,offset:fr,vao:Je,vaoActive:Ye,elementsActive:ve,static:Tt}}function co(be,ne){var Ze=be.static,ot=be.dynamic,Tt={};return Bn.forEach(function(Ye){var De=dn(Ye);function Je(ve,Ue){if(Ye in Ze){var Ee=ve(Ze[Ye]);Tt[De]=Eo(function(){return Ee})}else if(Ye in ot){var at=ot[Ye];Tt[De]=hs(at,function(bt,fr){return Ue(bt,fr,bt.invoke(fr,at))})}}switch(Ye){case Hl:case Ds:case lo:case ua:case is:case df:case Ta:case Iu:case Gs:case ol:return Je(function(ve){return fe.commandType(ve,"boolean",Ye,ne.commandStr),ve},function(ve,Ue,Ee){return fe.optional(function(){ve.assert(Ue,"typeof "+Ee+'==="boolean"',"invalid flag "+Ye,ve.commandStr)}),Ee});case Js:return Je(function(ve){return fe.commandParameter(ve,Xc,"invalid "+Ye,ne.commandStr),Xc[ve]},function(ve,Ue,Ee){var at=ve.constants.compareFuncs;return fe.optional(function(){ve.assert(Ue,Ee+" in "+at,"invalid "+Ye+", must be one of "+Object.keys(Xc))}),Ue.def(at,"[",Ee,"]")});case Pu:return Je(function(ve){return fe.command(so(ve)&&ve.length===2&&typeof ve[0]=="number"&&typeof ve[1]=="number"&&ve[0]<=ve[1],"depth range is 2d array",ne.commandStr),ve},function(ve,Ue,Ee){fe.optional(function(){ve.assert(Ue,ve.shared.isArrayLike+"("+Ee+")&&"+Ee+".length===2&&typeof "+Ee+'[0]==="number"&&typeof '+Ee+'[1]==="number"&&'+Ee+"[0]<="+Ee+"[1]","depth range must be a 2d array")});var at=Ue.def("+",Ee,"[0]"),bt=Ue.def("+",Ee,"[1]");return[at,bt]});case ps:return Je(function(ve){fe.commandType(ve,"object","blend.func",ne.commandStr);var Ue="srcRGB"in ve?ve.srcRGB:ve.src,Ee="srcAlpha"in ve?ve.srcAlpha:ve.src,at="dstRGB"in ve?ve.dstRGB:ve.dst,bt="dstAlpha"in ve?ve.dstAlpha:ve.dst;return fe.commandParameter(Ue,ql,De+".srcRGB",ne.commandStr),fe.commandParameter(Ee,ql,De+".srcAlpha",ne.commandStr),fe.commandParameter(at,ql,De+".dstRGB",ne.commandStr),fe.commandParameter(bt,ql,De+".dstAlpha",ne.commandStr),fe.command(Nr.indexOf(Ue+", "+at)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Ue+", "+at+")",ne.commandStr),[ql[Ue],ql[at],ql[Ee],ql[bt]]},function(ve,Ue,Ee){var at=ve.constants.blendFuncs;fe.optional(function(){ve.assert(Ue,Ee+"&&typeof "+Ee+'==="object"',"invalid blend func, must be an object")});function bt(ln,xn){var bn=Ue.def('"',ln,xn,'" in ',Ee,"?",Ee,".",ln,xn,":",Ee,".",ln);return fe.optional(function(){ve.assert(Ue,bn+" in "+at,"invalid "+Ye+"."+ln+xn+", must be one of "+Object.keys(ql))}),bn}var fr=bt("src","RGB"),zr=bt("dst","RGB");fe.optional(function(){var ln=ve.constants.invalidBlendCombinations;ve.assert(Ue,ln+".indexOf("+fr+'+", "+'+zr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Zr=Ue.def(at,"[",fr,"]"),en=Ue.def(at,"[",bt("src","Alpha"),"]"),kr=Ue.def(at,"[",zr,"]"),Cn=Ue.def(at,"[",bt("dst","Alpha"),"]");return[Zr,kr,en,Cn]});case Uo:return Je(function(ve){if(typeof ve=="string")return fe.commandParameter(ve,Zt,"invalid "+Ye,ne.commandStr),[Zt[ve],Zt[ve]];if(typeof ve=="object")return fe.commandParameter(ve.rgb,Zt,Ye+".rgb",ne.commandStr),fe.commandParameter(ve.alpha,Zt,Ye+".alpha",ne.commandStr),[Zt[ve.rgb],Zt[ve.alpha]];fe.commandRaise("invalid blend.equation",ne.commandStr)},function(ve,Ue,Ee){var at=ve.constants.blendEquations,bt=Ue.def(),fr=Ue.def(),zr=ve.cond("typeof ",Ee,'==="string"');return fe.optional(function(){function Zr(en,kr,Cn){ve.assert(en,Cn+" in "+at,"invalid "+kr+", must be one of "+Object.keys(Zt))}Zr(zr.then,Ye,Ee),ve.assert(zr.else,Ee+"&&typeof "+Ee+'==="object"',"invalid "+Ye),Zr(zr.else,Ye+".rgb",Ee+".rgb"),Zr(zr.else,Ye+".alpha",Ee+".alpha")}),zr.then(bt,"=",fr,"=",at,"[",Ee,"];"),zr.else(bt,"=",at,"[",Ee,".rgb];",fr,"=",at,"[",Ee,".alpha];"),Ue(zr),[bt,fr]});case fs:return Je(function(ve){return fe.command(so(ve)&&ve.length===4,"blend.color must be a 4d array",ne.commandStr),je(4,function(Ue){return+ve[Ue]})},function(ve,Ue,Ee){return fe.optional(function(){ve.assert(Ue,ve.shared.isArrayLike+"("+Ee+")&&"+Ee+".length===4","blend.color must be a 4d array")}),je(4,function(at){return Ue.def("+",Ee,"[",at,"]")})});case eu:return Je(function(ve){return fe.commandType(ve,"number",De,ne.commandStr),ve|0},function(ve,Ue,Ee){return fe.optional(function(){ve.assert(Ue,"typeof "+Ee+'==="number"',"invalid stencil.mask")}),Ue.def(Ee,"|0")});case As:return Je(function(ve){fe.commandType(ve,"object",De,ne.commandStr);var Ue=ve.cmp||"keep",Ee=ve.ref||0,at="mask"in ve?ve.mask:-1;return fe.commandParameter(Ue,Xc,Ye+".cmp",ne.commandStr),fe.commandType(Ee,"number",Ye+".ref",ne.commandStr),fe.commandType(at,"number",Ye+".mask",ne.commandStr),[Xc[Ue],Ee,at]},function(ve,Ue,Ee){var at=ve.constants.compareFuncs;fe.optional(function(){function Zr(){ve.assert(Ue,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Zr(Ee+"&&typeof ",Ee,'==="object"'),Zr('!("cmp" in ',Ee,")||(",Ee,".cmp in ",at,")")});var bt=Ue.def('"cmp" in ',Ee,"?",at,"[",Ee,".cmp]",":",_u),fr=Ue.def(Ee,".ref|0"),zr=Ue.def('"mask" in ',Ee,"?",Ee,".mask|0:-1");return[bt,fr,zr]});case Yu:case Fs:return Je(function(ve){fe.commandType(ve,"object",De,ne.commandStr);var Ue=ve.fail||"keep",Ee=ve.zfail||"keep",at=ve.zpass||"keep";return fe.commandParameter(Ue,zt,Ye+".fail",ne.commandStr),fe.commandParameter(Ee,zt,Ye+".zfail",ne.commandStr),fe.commandParameter(at,zt,Ye+".zpass",ne.commandStr),[Ye===Fs?Wc:Al,zt[Ue],zt[Ee],zt[at]]},function(ve,Ue,Ee){var at=ve.constants.stencilOps;fe.optional(function(){ve.assert(Ue,Ee+"&&typeof "+Ee+'==="object"',"invalid "+Ye)});function bt(fr){return fe.optional(function(){ve.assert(Ue,'!("'+fr+'" in '+Ee+")||("+Ee+"."+fr+" in "+at+")","invalid "+Ye+"."+fr+", must be one of "+Object.keys(zt))}),Ue.def('"',fr,'" in ',Ee,"?",at,"[",Ee,".",fr,"]:",_u)}return[Ye===Fs?Wc:Al,bt("fail"),bt("zfail"),bt("zpass")]});case no:return Je(function(ve){fe.commandType(ve,"object",De,ne.commandStr);var Ue=ve.factor|0,Ee=ve.units|0;return fe.commandType(Ue,"number",De+".factor",ne.commandStr),fe.commandType(Ee,"number",De+".units",ne.commandStr),[Ue,Ee]},function(ve,Ue,Ee){fe.optional(function(){ve.assert(Ue,Ee+"&&typeof "+Ee+'==="object"',"invalid "+Ye)});var at=Ue.def(Ee,".factor|0"),bt=Ue.def(Ee,".units|0");return[at,bt]});case dc:return Je(function(ve){var Ue=0;return ve==="front"?Ue=Al:ve==="back"&&(Ue=Wc),fe.command(!!Ue,De,ne.commandStr),Ue},function(ve,Ue,Ee){return fe.optional(function(){ve.assert(Ue,Ee+'==="front"||'+Ee+'==="back"',"invalid cull.face")}),Ue.def(Ee,'==="front"?',Al,":",Wc)});case Qa:return Je(function(ve){return fe.command(typeof ve=="number"&&ve>=Rt.lineWidthDims[0]&&ve<=Rt.lineWidthDims[1],"invalid line width, must be a positive number between "+Rt.lineWidthDims[0]+" and "+Rt.lineWidthDims[1],ne.commandStr),ve},function(ve,Ue,Ee){return fe.optional(function(){ve.assert(Ue,"typeof "+Ee+'==="number"&&'+Ee+">="+Rt.lineWidthDims[0]+"&&"+Ee+"<="+Rt.lineWidthDims[1],"invalid line width")}),Ee});case mu:return Je(function(ve){return fe.commandParameter(ve,uh,De,ne.commandStr),uh[ve]},function(ve,Ue,Ee){return fe.optional(function(){ve.assert(Ue,Ee+'==="cw"||'+Ee+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Ue.def(Ee+'==="cw"?'+Gh+":"+ip)});case Xu:return Je(function(ve){return fe.command(so(ve)&&ve.length===4,"color.mask must be length 4 array",ne.commandStr),ve.map(function(Ue){return!!Ue})},function(ve,Ue,Ee){return fe.optional(function(){ve.assert(Ue,ve.shared.isArrayLike+"("+Ee+")&&"+Ee+".length===4","invalid color.mask")}),je(4,function(at){return"!!"+Ee+"["+at+"]"})});case El:return Je(function(ve){fe.command(typeof ve=="object"&&ve,De,ne.commandStr);var Ue="value"in ve?ve.value:1,Ee=!!ve.invert;return fe.command(typeof Ue=="number"&&Ue>=0&&Ue<=1,"sample.coverage.value must be a number between 0 and 1",ne.commandStr),[Ue,Ee]},function(ve,Ue,Ee){fe.optional(function(){ve.assert(Ue,Ee+"&&typeof "+Ee+'==="object"',"invalid sample.coverage")});var at=Ue.def('"value" in ',Ee,"?+",Ee,".value:1"),bt=Ue.def("!!",Ee,".invert");return[at,bt]})}}),Tt}function ki(be,ne){var Ze=be.static,ot=be.dynamic,Tt={};return Object.keys(Ze).forEach(function(Ye){var De=Ze[Ye],Je;if(typeof De=="number"||typeof De=="boolean")Je=Eo(function(){return De});else if(typeof De=="function"){var ve=De._reglType;ve==="texture2d"||ve==="textureCube"?Je=Eo(function(Ue){return Ue.link(De)}):ve==="framebuffer"||ve==="framebufferCube"?(fe.command(De.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Ye+'"',ne.commandStr),Je=Eo(function(Ue){return Ue.link(De.color[0])})):fe.commandRaise('invalid data for uniform "'+Ye+'"',ne.commandStr)}else so(De)?Je=Eo(function(Ue){var Ee=Ue.global.def("[",je(De.length,function(at){return fe.command(typeof De[at]=="number"||typeof De[at]=="boolean","invalid uniform "+Ye,Ue.commandStr),De[at]}),"]");return Ee}):fe.commandRaise('invalid or missing data for uniform "'+Ye+'"',ne.commandStr);Je.value=De,Tt[Ye]=Je}),Object.keys(ot).forEach(function(Ye){var De=ot[Ye];Tt[Ye]=hs(De,function(Je,ve){return Je.invoke(ve,De)})}),Tt}function as(be,ne){var Ze=be.static,ot=be.dynamic,Tt={};return Object.keys(Ze).forEach(function(Ye){var De=Ze[Ye],Je=ce.id(Ye),ve=new nt;if(ap(De))ve.state=Hn,ve.buffer=ar.getBuffer(ar.create(De,gf,!1,!0)),ve.type=0;else{var Ue=ar.getBuffer(De);if(Ue)ve.state=Hn,ve.buffer=Ue,ve.type=0;else if(fe.command(typeof De=="object"&&De,"invalid data for attribute "+Ye,ne.commandStr),"constant"in De){var Ee=De.constant;ve.buffer="null",ve.state=pi,typeof Ee=="number"?ve.x=Ee:(fe.command(so(Ee)&&Ee.length>0&&Ee.length<=4,"invalid constant for attribute "+Ye,ne.commandStr),li.forEach(function(kr,Cn){Cn<Ee.length&&(ve[kr]=Ee[Cn])}))}else{ap(De.buffer)?Ue=ar.getBuffer(ar.create(De.buffer,gf,!1,!0)):Ue=ar.getBuffer(De.buffer),fe.command(!!Ue,'missing buffer for attribute "'+Ye+'"',ne.commandStr);var at=De.offset|0;fe.command(at>=0,'invalid offset for attribute "'+Ye+'"',ne.commandStr);var bt=De.stride|0;fe.command(bt>=0&&bt<256,'invalid stride for attribute "'+Ye+'", must be integer betweeen [0, 255]',ne.commandStr);var fr=De.size|0;fe.command(!("size"in De)||fr>0&&fr<=4,'invalid size for attribute "'+Ye+'", must be 1,2,3,4',ne.commandStr);var zr=!!De.normalized,Zr=0;"type"in De&&(fe.commandParameter(De.type,ou,"invalid type for attribute "+Ye,ne.commandStr),Zr=ou[De.type]);var en=De.divisor|0;fe.optional(function(){"divisor"in De&&(fe.command(en===0||Qt,'cannot specify divisor for attribute "'+Ye+'", instancing not supported',ne.commandStr),fe.command(en>=0,'invalid divisor for attribute "'+Ye+'"',ne.commandStr));var kr=ne.commandStr,Cn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(De).forEach(function(ln){fe.command(Cn.indexOf(ln)>=0,'unknown parameter "'+ln+'" for attribute pointer "'+Ye+'" (valid parameters are '+Cn+")",kr)})}),ve.buffer=Ue,ve.state=Hn,ve.size=fr,ve.normalized=zr,ve.type=Zr||Ue.dtype,ve.offset=at,ve.stride=bt,ve.divisor=en}}Tt[Ye]=Eo(function(kr,Cn){var ln=kr.attribCache;if(Je in ln)return ln[Je];var xn={isStream:!1};return Object.keys(ve).forEach(function(bn){xn[bn]=ve[bn]}),ve.buffer&&(xn.buffer=kr.link(ve.buffer),xn.type=xn.type||xn.buffer+".dtype"),ln[Je]=xn,xn})}),Object.keys(ot).forEach(function(Ye){var De=ot[Ye];function Je(ve,Ue){var Ee=ve.invoke(Ue,De),at=ve.shared,bt=ve.constants,fr=at.isBufferArgs,zr=at.buffer;fe.optional(function(){ve.assert(Ue,Ee+"&&(typeof "+Ee+'==="object"||typeof '+Ee+'==="function")&&('+fr+"("+Ee+")||"+zr+".getBuffer("+Ee+")||"+zr+".getBuffer("+Ee+".buffer)||"+fr+"("+Ee+'.buffer)||("constant" in '+Ee+"&&(typeof "+Ee+'.constant==="number"||'+at.isArrayLike+"("+Ee+".constant))))",'invalid dynamic attribute "'+Ye+'"')});var Zr={isStream:Ue.def(!1)},en=new nt;en.state=Hn,Object.keys(en).forEach(function(xn){Zr[xn]=Ue.def(""+en[xn])});var kr=Zr.buffer,Cn=Zr.type;Ue("if(",fr,"(",Ee,")){",Zr.isStream,"=true;",kr,"=",zr,".createStream(",gf,",",Ee,");",Cn,"=",kr,".dtype;","}else{",kr,"=",zr,".getBuffer(",Ee,");","if(",kr,"){",Cn,"=",kr,".dtype;",'}else if("constant" in ',Ee,"){",Zr.state,"=",pi,";","if(typeof "+Ee+'.constant === "number"){',Zr[li[0]],"=",Ee,".constant;",li.slice(1).map(function(xn){return Zr[xn]}).join("="),"=0;","}else{",li.map(function(xn,bn){return Zr[xn]+"="+Ee+".constant.length>"+bn+"?"+Ee+".constant["+bn+"]:0;"}).join(""),"}}else{","if(",fr,"(",Ee,".buffer)){",kr,"=",zr,".createStream(",gf,",",Ee,".buffer);","}else{",kr,"=",zr,".getBuffer(",Ee,".buffer);","}",Cn,'="type" in ',Ee,"?",bt.glTypes,"[",Ee,".type]:",kr,".dtype;",Zr.normalized,"=!!",Ee,".normalized;");function ln(xn){Ue(Zr[xn],"=",Ee,".",xn,"|0;")}return ln("size"),ln("offset"),ln("stride"),ln("divisor"),Ue("}}"),Ue.exit("if(",Zr.isStream,"){",zr,".destroyStream(",kr,");","}"),Zr}Tt[Ye]=hs(De,Je)}),Tt}function Ga(be){var ne=be.static,Ze=be.dynamic,ot={};return Object.keys(ne).forEach(function(Tt){var Ye=ne[Tt];ot[Tt]=Eo(function(De,Je){return typeof Ye=="number"||typeof Ye=="boolean"?""+Ye:De.link(Ye)})}),Object.keys(Ze).forEach(function(Tt){var Ye=Ze[Tt];ot[Tt]=hs(Ye,function(De,Je){return De.invoke(Je,Ye)})}),ot}function qo(be,ne,Ze,ot,Tt){var Ye=be.static,De=be.dynamic;fe.optional(function(){var ln=[Hs,Ru,vc,yu,yo,vf,Sl,qf,Ou,Hc].concat(Bn);function xn(bn){Object.keys(bn).forEach(function(mn){fe.command(ln.indexOf(mn)>=0,'unknown parameter "'+mn+'"',Tt.commandStr)})}xn(Ye),xn(De)});var Je=ui(be,ne),ve=Jr(be,Tt),Ue=Yn(be,ve,Tt),Ee=io(be,Tt),at=co(be,Tt),bt=Ni(be,Tt,Je);function fr(ln){var xn=Ue[ln];xn&&(at[ln]=xn)}fr(gu),fr(dn(Yf));var zr=Object.keys(at).length>0,Zr={framebuffer:ve,draw:Ee,shader:bt,state:at,dirty:zr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Zr.profile=Vr(be,Tt),Zr.uniforms=ki(Ze,Tt),Zr.drawVAO=Zr.scopeVAO=Ee.vao,!Zr.drawVAO&&bt.program&&!Je&&Fe.angle_instanced_arrays&&Ee.static.elements){var en=!0,kr=bt.program.attributes.map(function(ln){var xn=ne.static[ln];return en=en&&!!xn,xn});if(en&&kr.length>0){var Cn=yr.getVAO(yr.createVAO({attributes:kr,elements:Ee.static.elements}));Zr.drawVAO=new ha(null,null,null,function(ln,xn){return ln.link(Cn)}),Zr.useVAO=!0}}return Je?Zr.useVAO=!0:Zr.attributes=as(ne,Tt),Zr.context=Ga(ot,Tt),Zr}function So(be,ne,Ze){var ot=be.shared,Tt=ot.context,Ye=be.scope();Object.keys(Ze).forEach(function(De){ne.save(Tt,"."+De);var Je=Ze[De],ve=Je.append(be,ne);Array.isArray(ve)?Ye(Tt,".",De,"=[",ve.join(),"];"):Ye(Tt,".",De,"=",ve,";")}),ne(Ye)}function Zo(be,ne,Ze,ot){var Tt=be.shared,Ye=Tt.gl,De=Tt.framebuffer,Je;Pr&&(Je=ne.def(Tt.extensions,".webgl_draw_buffers"));var ve=be.constants,Ue=ve.drawBuffer,Ee=ve.backBuffer,at;Ze?at=Ze.append(be,ne):at=ne.def(De,".next"),ot||ne("if(",at,"!==",De,".cur){"),ne("if(",at,"){",Ye,".bindFramebuffer(",Hh,",",at,".framebuffer);"),Pr&&ne(Je,".drawBuffersWEBGL(",Ue,"[",at,".colorAttachments.length]);"),ne("}else{",Ye,".bindFramebuffer(",Hh,",null);"),Pr&&ne(Je,".drawBuffersWEBGL(",Ee,");"),ne("}",De,".cur=",at,";"),ot||ne("}")}function jo(be,ne,Ze){var ot=be.shared,Tt=ot.gl,Ye=be.current,De=be.next,Je=ot.current,ve=ot.next,Ue=be.cond(Je,".dirty");Bn.forEach(function(Ee){var at=dn(Ee);if(!(at in Ze.state)){var bt,fr;if(at in De){bt=De[at],fr=Ye[at];var zr=je(Rr[at].length,function(en){return Ue.def(bt,"[",en,"]")});Ue(be.cond(zr.map(function(en,kr){return en+"!=="+fr+"["+kr+"]"}).join("||")).then(Tt,".",er[at],"(",zr,");",zr.map(function(en,kr){return fr+"["+kr+"]="+en}).join(";"),";"))}else{bt=Ue.def(ve,".",at);var Zr=be.cond(bt,"!==",Je,".",at);Ue(Zr),at in $t?Zr(be.cond(bt).then(Tt,".enable(",$t[at],");").else(Tt,".disable(",$t[at],");"),Je,".",at,"=",bt,";"):Zr(Tt,".",er[at],"(",bt,");",Je,".",at,"=",bt,";")}}}),Object.keys(Ze.state).length===0&&Ue(Je,".dirty=false;"),ne(Ue)}function ds(be,ne,Ze,ot){var Tt=be.shared,Ye=be.current,De=Tt.current,Je=Tt.gl;Bp(Object.keys(Ze)).forEach(function(ve){var Ue=Ze[ve];if(!(ot&&!ot(Ue))){var Ee=Ue.append(be,ne);if($t[ve]){var at=$t[ve];yc(Ue)?Ee?ne(Je,".enable(",at,");"):ne(Je,".disable(",at,");"):ne(be.cond(Ee).then(Je,".enable(",at,");").else(Je,".disable(",at,");")),ne(De,".",ve,"=",Ee,";")}else if(so(Ee)){var bt=Ye[ve];ne(Je,".",er[ve],"(",Ee,");",Ee.map(function(fr,zr){return bt+"["+zr+"]="+fr}).join(";"),";")}else ne(Je,".",er[ve],"(",Ee,");",De,".",ve,"=",Ee,";")}})}function fo(be,ne){Qt&&(be.instancing=ne.def(be.shared.extensions,".angle_instanced_arrays"))}function xi(be,ne,Ze,ot,Tt){var Ye=be.shared,De=be.stats,Je=Ye.current,ve=Ye.timer,Ue=Ze.profile;function Ee(){var ln=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return ln||typeof performance=="undefined"?"Date.now()":"performance.now()"}var at,bt;function fr(ln){at=ne.def(),ln(at,"=",Ee(),";"),typeof Tt=="string"?ln(De,".count+=",Tt,";"):ln(De,".count++;"),_r&&(ot?(bt=ne.def(),ln(bt,"=",ve,".getNumPendingQueries();")):ln(ve,".beginQuery(",De,");"))}function zr(ln){ln(De,".cpuTime+=",Ee(),"-",at,";"),_r&&(ot?ln(ve,".pushScopeStats(",bt,",",ve,".getNumPendingQueries(),",De,");"):ln(ve,".endQuery();"))}function Zr(ln){var xn=ne.def(Je,".profile");ne(Je,".profile=",ln,";"),ne.exit(Je,".profile=",xn,";")}var en;if(Ue){if(yc(Ue)){Ue.enable?(fr(ne),zr(ne.exit),Zr("true")):Zr("false");return}en=Ue.append(be,ne),Zr(en)}else en=ne.def(Je,".profile");var kr=be.block();fr(kr),ne("if(",en,"){",kr,"}");var Cn=be.block();zr(Cn),ne.exit("if(",en,"){",Cn,"}")}function Vo(be,ne,Ze,ot,Tt){var Ye=be.shared;function De(ve){switch(ve){case Jf:case Lp:case Ef:return 2;case gc:case Yl:case Sf:return 3;case xf:case kp:case Cf:return 4;default:return 1}}function Je(ve,Ue,Ee){var at=Ye.gl,bt=ne.def(ve,".location"),fr=ne.def(Ye.attributes,"[",bt,"]"),zr=Ee.state,Zr=Ee.buffer,en=[Ee.x,Ee.y,Ee.z,Ee.w],kr=["buffer","normalized","offset","stride"];function Cn(){ne("if(!",fr,".buffer){",at,".enableVertexAttribArray(",bt,");}");var xn=Ee.type,bn;if(Ee.size?bn=ne.def(Ee.size,"||",Ue):bn=Ue,ne("if(",fr,".type!==",xn,"||",fr,".size!==",bn,"||",kr.map(function(qn){return fr+"."+qn+"!=="+Ee[qn]}).join("||"),"){",at,".bindBuffer(",gf,",",Zr,".buffer);",at,".vertexAttribPointer(",[bt,bn,xn,Ee.normalized,Ee.stride,Ee.offset],");",fr,".type=",xn,";",fr,".size=",bn,";",kr.map(function(qn){return fr+"."+qn+"="+Ee[qn]+";"}).join(""),"}"),Qt){var mn=Ee.divisor;ne("if(",fr,".divisor!==",mn,"){",be.instancing,".vertexAttribDivisorANGLE(",[bt,mn],");",fr,".divisor=",mn,";}")}}function ln(){ne("if(",fr,".buffer){",at,".disableVertexAttribArray(",bt,");",fr,".buffer=null;","}if(",li.map(function(xn,bn){return fr+"."+xn+"!=="+en[bn]}).join("||"),"){",at,".vertexAttrib4f(",bt,",",en,");",li.map(function(xn,bn){return fr+"."+xn+"="+en[bn]+";"}).join(""),"}")}zr===Hn?Cn():zr===pi?ln():(ne("if(",zr,"===",Hn,"){"),Cn(),ne("}else{"),ln(),ne("}"))}ot.forEach(function(ve){var Ue=ve.name,Ee=Ze.attributes[Ue],at;if(Ee){if(!Tt(Ee))return;at=Ee.append(be,ne)}else{if(!Tt(Xh))return;var bt=be.scopeAttrib(Ue);fe.optional(function(){be.assert(ne,bt+".state","missing attribute "+Ue)}),at={},Object.keys(new nt).forEach(function(fr){at[fr]=ne.def(bt,".",fr)})}Je(be.link(ve),De(ve.info.type),at)})}function Ki(be,ne,Ze,ot,Tt,Ye){for(var De=be.shared,Je=De.gl,ve,Ue=0;Ue<ot.length;++Ue){var Ee=ot[Ue],at=Ee.name,bt=Ee.info.type,fr=Ze.uniforms[at],zr=be.link(Ee),Zr=zr+".location",en;if(fr){if(!Tt(fr))continue;if(yc(fr)){var kr=fr.value;if(fe.command(kr!==null&&typeof kr!="undefined",'missing uniform "'+at+'"',be.commandStr),bt===np||bt===Cl){fe.command(typeof kr=="function"&&(bt===np&&(kr._reglType==="texture2d"||kr._reglType==="framebuffer")||bt===Cl&&(kr._reglType==="textureCube"||kr._reglType==="framebufferCube")),"invalid texture for uniform "+at,be.commandStr);var Cn=be.link(kr._texture||kr.color[0]._texture);ne(Je,".uniform1i(",Zr,",",Cn+".bind());"),ne.exit(Cn,".unbind();")}else if(bt===ru||bt===tp||bt===rp){fe.optional(function(){fe.command(so(kr),"invalid matrix for uniform "+at,be.commandStr),fe.command(bt===ru&&kr.length===4||bt===tp&&kr.length===9||bt===rp&&kr.length===16,"invalid length for matrix uniform "+at,be.commandStr)});var ln=be.global.def("new Float32Array(["+Array.prototype.slice.call(kr)+"])"),xn=2;bt===tp?xn=3:bt===rp&&(xn=4),ne(Je,".uniformMatrix",xn,"fv(",Zr,",false,",ln,");")}else{switch(bt){case mc:fe.commandType(kr,"number","uniform "+at,be.commandStr),ve="1f";break;case Jf:fe.command(so(kr)&&kr.length===2,"uniform "+at,be.commandStr),ve="2f";break;case gc:fe.command(so(kr)&&kr.length===3,"uniform "+at,be.commandStr),ve="3f";break;case xf:fe.command(so(kr)&&kr.length===4,"uniform "+at,be.commandStr),ve="4f";break;case bf:fe.commandType(kr,"boolean","uniform "+at,be.commandStr),ve="1i";break;case ep:fe.commandType(kr,"number","uniform "+at,be.commandStr),ve="1i";break;case Ef:fe.command(so(kr)&&kr.length===2,"uniform "+at,be.commandStr),ve="2i";break;case Lp:fe.command(so(kr)&&kr.length===2,"uniform "+at,be.commandStr),ve="2i";break;case Sf:fe.command(so(kr)&&kr.length===3,"uniform "+at,be.commandStr),ve="3i";break;case Yl:fe.command(so(kr)&&kr.length===3,"uniform "+at,be.commandStr),ve="3i";break;case Cf:fe.command(so(kr)&&kr.length===4,"uniform "+at,be.commandStr),ve="4i";break;case kp:fe.command(so(kr)&&kr.length===4,"uniform "+at,be.commandStr),ve="4i";break}ne(Je,".uniform",ve,"(",Zr,",",so(kr)?Array.prototype.slice.call(kr):kr,");")}continue}else en=fr.append(be,ne)}else{if(!Tt(Xh))continue;en=ne.def(De.uniforms,"[",ce.id(at),"]")}bt===np?(fe(!Array.isArray(en),"must specify a scalar prop for textures"),ne("if(",en,"&&",en,'._reglType==="framebuffer"){',en,"=",en,".color[0];","}")):bt===Cl&&(fe(!Array.isArray(en),"must specify a scalar prop for cube maps"),ne("if(",en,"&&",en,'._reglType==="framebufferCube"){',en,"=",en,".color[0];","}")),fe.optional(function(){function vs(ti,ci){be.assert(ne,ti,'bad data or missing for uniform "'+at+'".  '+ci)}function ll(ti){fe(!Array.isArray(en),"must not specify an array type for uniform"),vs("typeof "+en+'==="'+ti+'"',"invalid type, expected "+ti)}function Lu(ti,ci){Array.isArray(en)?fe(en.length===ti,"must have length "+ti):vs(De.isArrayLike+"("+en+")&&"+en+".length==="+ti,"invalid vector, should have length "+ti,be.commandStr)}function ph(ti){fe(!Array.isArray(en),"must not specify a value type"),vs("typeof "+en+'==="function"&&'+en+'._reglType==="texture'+(ti===ih?"2d":"Cube")+'"',"invalid texture type",be.commandStr)}switch(bt){case ep:ll("number");break;case Lp:Lu(2,"number");break;case Yl:Lu(3,"number");break;case kp:Lu(4,"number");break;case mc:ll("number");break;case Jf:Lu(2,"number");break;case gc:Lu(3,"number");break;case xf:Lu(4,"number");break;case bf:ll("boolean");break;case Ef:Lu(2,"boolean");break;case Sf:Lu(3,"boolean");break;case Cf:Lu(4,"boolean");break;case ru:Lu(4,"number");break;case tp:Lu(9,"number");break;case rp:Lu(16,"number");break;case np:ph(ih);break;case Cl:ph(Ip);break}});var bn=1;switch(bt){case np:case Cl:var mn=ne.def(en,"._texture");ne(Je,".uniform1i(",Zr,",",mn,".bind());"),ne.exit(mn,".unbind();");continue;case ep:case bf:ve="1i";break;case Lp:case Ef:ve="2i",bn=2;break;case Yl:case Sf:ve="3i",bn=3;break;case kp:case Cf:ve="4i",bn=4;break;case mc:ve="1f";break;case Jf:ve="2f",bn=2;break;case gc:ve="3f",bn=3;break;case xf:ve="4f",bn=4;break;case ru:ve="Matrix2fv";break;case tp:ve="Matrix3fv";break;case rp:ve="Matrix4fv";break}if(ve.charAt(0)==="M"){ne(Je,".uniform",ve,"(",Zr,",");var qn=Math.pow(bt-ru+2,2),_a=be.global.def("new Float32Array(",qn,")");Array.isArray(en)?ne("false,(",je(qn,function(vs){return _a+"["+vs+"]="+en[vs]}),",",_a,")"):ne("false,(Array.isArray(",en,")||",en," instanceof Float32Array)?",en,":(",je(qn,function(vs){return _a+"["+vs+"]="+en+"["+vs+"]"}),",",_a,")"),ne(");")}else if(bn>1){for(var os=[],Pa=[],ca=0;ca<bn;++ca)Array.isArray(en)?Pa.push(en[ca]):Pa.push(ne.def(en+"["+ca+"]")),Ye&&os.push(ne.def());Ye&&ne("if(!",be.batchId,"||",os.map(function(vs,ll){return vs+"!=="+Pa[ll]}).join("||"),"){",os.map(function(vs,ll){return vs+"="+Pa[ll]+";"}).join("")),ne(Je,".uniform",ve,"(",Zr,",",Pa.join(","),");"),Ye&&ne("}")}else{if(fe(!Array.isArray(en),"uniform value must not be an array"),Ye){var ul=ne.def();ne("if(!",be.batchId,"||",ul,"!==",en,"){",ul,"=",en,";")}ne(Je,".uniform",ve,"(",Zr,",",en,");"),Ye&&ne("}")}}}function Ko(be,ne,Ze,ot){var Tt=be.shared,Ye=Tt.gl,De=Tt.draw,Je=ot.draw;function ve(){var bn=Je.elements,mn,qn=ne;return bn?((bn.contextDep&&ot.contextDynamic||bn.propDep)&&(qn=Ze),mn=bn.append(be,qn),Je.elementsActive&&qn("if("+mn+")"+Ye+".bindBuffer("+$f+","+mn+".buffer.buffer);")):(mn=qn.def(),qn(mn,"=",De,".",yu,";","if(",mn,"){",Ye,".bindBuffer(",$f,",",mn,".buffer.buffer);}","else if(",Tt.vao,".currentVAO){",mn,"=",be.shared.elements+".getElements("+Tt.vao,".currentVAO.elements);",lr?"":"if("+mn+")"+Ye+".bindBuffer("+$f+","+mn+".buffer.buffer);","}")),mn}function Ue(){var bn=Je.count,mn,qn=ne;return bn?((bn.contextDep&&ot.contextDynamic||bn.propDep)&&(qn=Ze),mn=bn.append(be,qn),fe.optional(function(){bn.MISSING&&be.assert(ne,"false","missing vertex count"),bn.DYNAMIC&&be.assert(qn,mn+">=0","missing vertex count")})):(mn=qn.def(De,".",Sl),fe.optional(function(){be.assert(qn,mn+">=0","missing vertex count")})),mn}var Ee=ve();function at(bn){var mn=Je[bn];return mn?mn.contextDep&&ot.contextDynamic||mn.propDep?mn.append(be,Ze):mn.append(be,ne):ne.def(De,".",bn)}var bt=at(yo),fr=at(vf),zr=Ue();if(typeof zr=="number"){if(zr===0)return}else Ze("if(",zr,"){"),Ze.exit("}");var Zr,en;Qt&&(Zr=at(qf),en=be.instancing);var kr=Ee+".type",Cn=Je.elements&&yc(Je.elements)&&!Je.vaoActive;function ln(){function bn(){Ze(en,".drawElementsInstancedANGLE(",[bt,zr,kr,fr+"<<(("+kr+"-"+Jn+")>>1)",Zr],");")}function mn(){Ze(en,".drawArraysInstancedANGLE(",[bt,fr,zr,Zr],");")}Ee&&Ee!=="null"?Cn?bn():(Ze("if(",Ee,"){"),bn(),Ze("}else{"),mn(),Ze("}")):mn()}function xn(){function bn(){Ze(Ye+".drawElements("+[bt,zr,kr,fr+"<<(("+kr+"-"+Jn+")>>1)"]+");")}function mn(){Ze(Ye+".drawArrays("+[bt,fr,zr]+");")}Ee&&Ee!=="null"?Cn?bn():(Ze("if(",Ee,"){"),bn(),Ze("}else{"),mn(),Ze("}")):mn()}Qt&&(typeof Zr!="number"||Zr>=0)?typeof Zr=="string"?(Ze("if(",Zr,">0){"),ln(),Ze("}else if(",Zr,"<0){"),xn(),Ze("}")):ln():xn()}function ei(be,ne,Ze,ot,Tt){var Ye=ni(),De=Ye.proc("body",Tt);return fe.optional(function(){Ye.commandStr=ne.commandStr,Ye.command=Ye.link(ne.commandStr)}),Qt&&(Ye.instancing=De.def(Ye.shared.extensions,".angle_instanced_arrays")),be(Ye,De,Ze,ot),Ye.compile().body}function Di(be,ne,Ze,ot){fo(be,ne),Ze.useVAO?Ze.drawVAO?ne(be.shared.vao,".setVAO(",Ze.drawVAO.append(be,ne),");"):ne(be.shared.vao,".setVAO(",be.shared.vao,".targetVAO);"):(ne(be.shared.vao,".setVAO(null);"),Vo(be,ne,Ze,ot.attributes,function(){return!0})),Ki(be,ne,Ze,ot.uniforms,function(){return!0},!1),Ko(be,ne,ne,Ze)}function la(be,ne){var Ze=be.proc("draw",1);fo(be,Ze),So(be,Ze,ne.context),Zo(be,Ze,ne.framebuffer),jo(be,Ze,ne),ds(be,Ze,ne.state),xi(be,Ze,ne,!1,!0);var ot=ne.shader.progVar.append(be,Ze);if(Ze(be.shared.gl,".useProgram(",ot,".program);"),ne.shader.program)Di(be,Ze,ne,ne.shader.program);else{Ze(be.shared.vao,".setVAO(null);");var Tt=be.global.def("{}"),Ye=Ze.def(ot,".id"),De=Ze.def(Tt,"[",Ye,"]");Ze(be.cond(De).then(De,".call(this,a0);").else(De,"=",Tt,"[",Ye,"]=",be.link(function(Je){return ei(Di,be,ne,Je,1)}),"(",ot,");",De,".call(this,a0);"))}Object.keys(ne.state).length>0&&Ze(be.shared.current,".dirty=true;"),be.shared.vao&&Ze(be.shared.vao,".setVAO(null);")}function Co(be,ne,Ze,ot){be.batchId="a1",fo(be,ne);function Tt(){return!0}Vo(be,ne,Ze,ot.attributes,Tt),Ki(be,ne,Ze,ot.uniforms,Tt,!1),Ko(be,ne,ne,Ze)}function wl(be,ne,Ze,ot){fo(be,ne);var Tt=Ze.contextDep,Ye=ne.def(),De="a0",Je="a1",ve=ne.def();be.shared.props=ve,be.batchId=Ye;var Ue=be.scope(),Ee=be.scope();ne(Ue.entry,"for(",Ye,"=0;",Ye,"<",Je,";++",Ye,"){",ve,"=",De,"[",Ye,"];",Ee,"}",Ue.exit);function at(kr){return kr.contextDep&&Tt||kr.propDep}function bt(kr){return!at(kr)}if(Ze.needsContext&&So(be,Ee,Ze.context),Ze.needsFramebuffer&&Zo(be,Ee,Ze.framebuffer),ds(be,Ee,Ze.state,at),Ze.profile&&at(Ze.profile)&&xi(be,Ee,Ze,!1,!0),ot)Ze.useVAO?Ze.drawVAO?at(Ze.drawVAO)?Ee(be.shared.vao,".setVAO(",Ze.drawVAO.append(be,Ee),");"):Ue(be.shared.vao,".setVAO(",Ze.drawVAO.append(be,Ue),");"):Ue(be.shared.vao,".setVAO(",be.shared.vao,".targetVAO);"):(Ue(be.shared.vao,".setVAO(null);"),Vo(be,Ue,Ze,ot.attributes,bt),Vo(be,Ee,Ze,ot.attributes,at)),Ki(be,Ue,Ze,ot.uniforms,bt,!1),Ki(be,Ee,Ze,ot.uniforms,at,!0),Ko(be,Ue,Ee,Ze);else{var fr=be.global.def("{}"),zr=Ze.shader.progVar.append(be,Ee),Zr=Ee.def(zr,".id"),en=Ee.def(fr,"[",Zr,"]");Ee(be.shared.gl,".useProgram(",zr,".program);","if(!",en,"){",en,"=",fr,"[",Zr,"]=",be.link(function(kr){return ei(Co,be,Ze,kr,2)}),"(",zr,");}",en,".call(this,a0[",Ye,"],",Ye,");")}}function Ae(be,ne){var Ze=be.proc("batch",2);be.batchId="0",fo(be,Ze);var ot=!1,Tt=!0;Object.keys(ne.context).forEach(function(fr){ot=ot||ne.context[fr].propDep}),ot||(So(be,Ze,ne.context),Tt=!1);var Ye=ne.framebuffer,De=!1;Ye?(Ye.propDep?ot=De=!0:Ye.contextDep&&ot&&(De=!0),De||Zo(be,Ze,Ye)):Zo(be,Ze,null),ne.state.viewport&&ne.state.viewport.propDep&&(ot=!0);function Je(fr){return fr.contextDep&&ot||fr.propDep}jo(be,Ze,ne),ds(be,Ze,ne.state,function(fr){return!Je(fr)}),(!ne.profile||!Je(ne.profile))&&xi(be,Ze,ne,!1,"a1"),ne.contextDep=ot,ne.needsContext=Tt,ne.needsFramebuffer=De;var ve=ne.shader.progVar;if(ve.contextDep&&ot||ve.propDep)wl(be,Ze,ne,null);else{var Ue=ve.append(be,Ze);if(Ze(be.shared.gl,".useProgram(",Ue,".program);"),ne.shader.program)wl(be,Ze,ne,ne.shader.program);else{Ze(be.shared.vao,".setVAO(null);");var Ee=be.global.def("{}"),at=Ze.def(Ue,".id"),bt=Ze.def(Ee,"[",at,"]");Ze(be.cond(bt).then(bt,".call(this,a0,a1);").else(bt,"=",Ee,"[",at,"]=",be.link(function(fr){return ei(wl,be,ne,fr,2)}),"(",Ue,");",bt,".call(this,a0,a1);"))}}Object.keys(ne.state).length>0&&Ze(be.shared.current,".dirty=true;"),be.shared.vao&&Ze(be.shared.vao,".setVAO(null);")}function Dt(be,ne){var Ze=be.proc("scope",3);be.batchId="a2";var ot=be.shared,Tt=ot.current;So(be,Ze,ne.context),ne.framebuffer&&ne.framebuffer.append(be,Ze),Bp(Object.keys(ne.state)).forEach(function(De){var Je=ne.state[De],ve=Je.append(be,Ze);so(ve)?ve.forEach(function(Ue,Ee){Ze.set(be.next[De],"["+Ee+"]",Ue)}):Ze.set(ot.next,"."+De,ve)}),xi(be,Ze,ne,!0,!0),[yu,vf,Sl,qf,yo].forEach(function(De){var Je=ne.draw[De];!Je||Ze.set(ot.draw,"."+De,""+Je.append(be,Ze))}),Object.keys(ne.uniforms).forEach(function(De){var Je=ne.uniforms[De].append(be,Ze);Array.isArray(Je)&&(Je="["+Je.join()+"]"),Ze.set(ot.uniforms,"["+ce.id(De)+"]",Je)}),Object.keys(ne.attributes).forEach(function(De){var Je=ne.attributes[De].append(be,Ze),ve=be.scopeAttrib(De);Object.keys(new nt).forEach(function(Ue){Ze.set(ve,"."+Ue,Je[Ue])})}),ne.scopeVAO&&Ze.set(ot.vao,".targetVAO",ne.scopeVAO.append(be,Ze));function Ye(De){var Je=ne.shader[De];Je&&Ze.set(ot.shader,"."+De,Je.append(be,Ze))}Ye(Ru),Ye(vc),Object.keys(ne.state).length>0&&(Ze(Tt,".dirty=true;"),Ze.exit(Tt,".dirty=true;")),Ze("a1(",be.shared.context,",a0,",be.batchId,");")}function xt(be){if(!(typeof be!="object"||so(be))){for(var ne=Object.keys(be),Ze=0;Ze<ne.length;++Ze)if(Sn.isDynamic(be[ne[Ze]]))return!0;return!1}}function vn(be,ne,Ze){var ot=ne.static[Ze];if(!ot||!xt(ot))return;var Tt=be.global,Ye=Object.keys(ot),De=!1,Je=!1,ve=!1,Ue=be.global.def("{}");Ye.forEach(function(at){var bt=ot[at];if(Sn.isDynamic(bt)){typeof bt=="function"&&(bt=ot[at]=Sn.unbox(bt));var fr=hs(bt,null);De=De||fr.thisDep,ve=ve||fr.propDep,Je=Je||fr.contextDep}else{switch(Tt(Ue,".",at,"="),typeof bt){case"number":Tt(bt);break;case"string":Tt('"',bt,'"');break;case"object":Array.isArray(bt)&&Tt("[",bt.join(),"]");break;default:Tt(be.link(bt));break}Tt(";")}});function Ee(at,bt){Ye.forEach(function(fr){var zr=ot[fr];if(!!Sn.isDynamic(zr)){var Zr=at.invoke(bt,zr);bt(Ue,".",fr,"=",Zr,";")}})}ne.dynamic[Ze]=new Sn.DynamicVariable(No,{thisDep:De,contextDep:Je,propDep:ve,ref:Ue,append:Ee}),delete ne.static[Ze]}function zi(be,ne,Ze,ot,Tt){var Ye=ni();Ye.stats=Ye.link(Tt),Object.keys(ne.static).forEach(function(Je){vn(Ye,ne,Je)}),Ad.forEach(function(Je){vn(Ye,be,Je)});var De=qo(be,ne,Ze,ot,Ye);return la(Ye,De),Dt(Ye,De),Ae(Ye,De),g(Ye.compile(),{destroy:function(){De.shader.program.destroy()}})}return{next:$r,current:Rr,procs:function(){var be=ni(),ne=be.proc("poll"),Ze=be.proc("refresh"),ot=be.block();ne(ot),Ze(ot);var Tt=be.shared,Ye=Tt.gl,De=Tt.next,Je=Tt.current;ot(Je,".dirty=false;"),Zo(be,ne),Zo(be,Ze,null,!0);var ve;Qt&&(ve=be.link(Qt)),Fe.oes_vertex_array_object&&Ze(be.link(Fe.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Ue=0;Ue<Rt.maxAttributes;++Ue){var Ee=Ze.def(Tt.attributes,"[",Ue,"]"),at=be.cond(Ee,".buffer");at.then(Ye,".enableVertexAttribArray(",Ue,");",Ye,".bindBuffer(",gf,",",Ee,".buffer.buffer);",Ye,".vertexAttribPointer(",Ue,",",Ee,".size,",Ee,".type,",Ee,".normalized,",Ee,".stride,",Ee,".offset);").else(Ye,".disableVertexAttribArray(",Ue,");",Ye,".vertexAttrib4f(",Ue,",",Ee,".x,",Ee,".y,",Ee,".z,",Ee,".w);",Ee,".buffer=null;"),Ze(at),Qt&&Ze(ve,".vertexAttribDivisorANGLE(",Ue,",",Ee,".divisor);")}return Ze(be.shared.vao,".currentVAO=null;",be.shared.vao,".setVAO(",be.shared.vao,".targetVAO);"),Object.keys($t).forEach(function(bt){var fr=$t[bt],zr=ot.def(De,".",bt),Zr=be.block();Zr("if(",zr,"){",Ye,".enable(",fr,")}else{",Ye,".disable(",fr,")}",Je,".",bt,"=",zr,";"),Ze(Zr),ne("if(",zr,"!==",Je,".",bt,"){",Zr,"}")}),Object.keys(er).forEach(function(bt){var fr=er[bt],zr=Rr[bt],Zr,en,kr=be.block();if(kr(Ye,".",fr,"("),so(zr)){var Cn=zr.length;Zr=be.global.def(De,".",bt),en=be.global.def(Je,".",bt),kr(je(Cn,function(ln){return Zr+"["+ln+"]"}),");",je(Cn,function(ln){return en+"["+ln+"]="+Zr+"["+ln+"];"}).join("")),ne("if(",je(Cn,function(ln){return Zr+"["+ln+"]!=="+en+"["+ln+"]"}).join("||"),"){",kr,"}")}else Zr=ot.def(De,".",bt),en=ot.def(Je,".",bt),kr(Zr,");",Je,".",bt,"=",Zr,";"),ne("if(",Zr,"!==",en,"){",kr,"}");Ze(kr)}),be.compile()}(),compile:zi}}function qh(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Kh=34918,$h=34919,Np=35007,Qh=function(B,ce){if(!ce.ext_disjoint_timer_query)return null;var Fe=[];function Rt(){return Fe.pop()||ce.ext_disjoint_timer_query.createQueryEXT()}function ar(Qt){Fe.push(Qt)}var It=[];function Kt(Qt){var Pr=Rt();ce.ext_disjoint_timer_query.beginQueryEXT(Np,Pr),It.push(Pr),_r(It.length-1,It.length,Qt)}function cr(){ce.ext_disjoint_timer_query.endQueryEXT(Np)}function mr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var yr=[];function Sr(){return yr.pop()||new mr}function Mr(Qt){yr.push(Qt)}var Gr=[];function _r(Qt,Pr,lr){var Rr=Sr();Rr.startQueryIndex=Qt,Rr.endQueryIndex=Pr,Rr.sum=0,Rr.stats=lr,Gr.push(Rr)}var br=[],nt=[];function Zt(){var Qt,Pr,lr=It.length;if(lr!==0){nt.length=Math.max(nt.length,lr+1),br.length=Math.max(br.length,lr+1),br[0]=0,nt[0]=0;var Rr=0;for(Qt=0,Pr=0;Pr<It.length;++Pr){var $r=It[Pr];ce.ext_disjoint_timer_query.getQueryObjectEXT($r,$h)?(Rr+=ce.ext_disjoint_timer_query.getQueryObjectEXT($r,Kh),ar($r)):It[Qt++]=$r,br[Pr+1]=Rr,nt[Pr+1]=Qt}for(It.length=Qt,Qt=0,Pr=0;Pr<Gr.length;++Pr){var Bn=Gr[Pr],$t=Bn.startQueryIndex,er=Bn.endQueryIndex;Bn.sum+=br[er]-br[$t];var dn=nt[$t],Yr=nt[er];Yr===dn?(Bn.stats.gpuTime+=Bn.sum/1e6,Mr(Bn)):(Bn.startQueryIndex=dn,Bn.endQueryIndex=Yr,Gr[Qt++]=Bn)}Gr.length=Qt}}return{beginQuery:Kt,endQuery:cr,pushScopeStats:_r,update:Zt,getNumPendingQueries:function(){return It.length},clear:function(){Fe.push.apply(Fe,It);for(var Qt=0;Qt<Fe.length;Qt++)ce.ext_disjoint_timer_query.deleteQueryEXT(Fe[Qt]);It.length=0,Fe.length=0},restore:function(){It.length=0,Fe.length=0}}},Id=16384,wf=256,lh=1024,zp=34962,op="webglcontextlost",Ma="webglcontextrestored",ch=1,Kl=2,Tf=3;function fh(B,ce){for(var Fe=0;Fe<B.length;++Fe)if(B[Fe]===ce)return Fe;return-1}function Od(B){var ce=he(B);if(!ce)return null;var Fe=ce.gl,Rt=Fe.getContextAttributes(),ar=Fe.isContextLost(),It=Me(Fe,ce);if(!It)return null;var Kt=gs(),cr=qh(),mr=It.extensions,yr=Qh(Fe,mr),Sr=to(),Mr=Fe.drawingBufferWidth,Gr=Fe.drawingBufferHeight,_r={tick:0,time:0,viewportWidth:Mr,viewportHeight:Gr,framebufferWidth:Mr,framebufferHeight:Gr,drawingBufferWidth:Mr,drawingBufferHeight:Gr,pixelRatio:ce.pixelRatio},br={},nt={elements:null,primitive:4,count:-1,offset:0,instances:-1},Zt=Il(Fe,mr),Qt=F(Fe,cr,ce,Rr),Pr=vl(Fe,mr,Qt,cr),lr=yt(Fe,mr,Zt,cr,Qt,Pr,nt);function Rr(ei){return lr.destroyBuffer(ei)}var $r=Br(Fe,Kt,cr,ce),Bn=ls(Fe,mr,Zt,function(){dn.procs.poll()},_r,cr,ce),$t=xl(Fe,mr,Zt,cr,ce),er=Pe(Fe,mr,Zt,Bn,$t,cr),dn=Yh(Fe,Kt,mr,Zt,Qt,Pr,Bn,er,br,lr,$r,nt,_r,yr,ce),Yr=Zn(Fe,er,dn.procs.poll,_r,Rt,mr,Zt),xr=dn.next,Fr=Fe.canvas,Hr=[],si=[],ni=[],Vr=[ce.onDestroy],Jr=null;function Yn(){if(Hr.length===0){yr&&yr.update(),Jr=null;return}Jr=Pi.next(Yn),fo();for(var ei=Hr.length-1;ei>=0;--ei){var Di=Hr[ei];Di&&Di(_r,null,0)}Fe.flush(),yr&&yr.update()}function ui(){!Jr&&Hr.length>0&&(Jr=Pi.next(Yn))}function Ni(){Jr&&(Pi.cancel(Yn),Jr=null)}function io(ei){ei.preventDefault(),ar=!0,Ni(),si.forEach(function(Di){Di()})}function co(ei){Fe.getError(),ar=!1,It.restore(),$r.restore(),Qt.restore(),Bn.restore(),$t.restore(),er.restore(),lr.restore(),yr&&yr.restore(),dn.procs.refresh(),ui(),ni.forEach(function(Di){Di()})}var ki=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!ki&&Fr&&(Fr.addEventListener(op,io,!1),Fr.addEventListener(Ma,co,!1));function as(){Hr.length=0,Ni(),!ki&&Fr&&(Fr.removeEventListener(op,io),Fr.removeEventListener(Ma,co)),$r.clear(),er.clear(),$t.clear(),lr.clear(),Bn.clear(),Pr.clear(),Qt.clear(),yr&&yr.clear(),Vr.forEach(function(ei){ei()})}function Ga(ei){fe(!!ei,"invalid args to regl({...})"),fe.type(ei,"object","invalid args to regl({...})");function Di(Ye){var De=g({},Ye);delete De.uniforms,delete De.attributes,delete De.context,delete De.vao,"stencil"in De&&De.stencil.op&&(De.stencil.opBack=De.stencil.opFront=De.stencil.op,delete De.stencil.op);function Je(ve){if(ve in De){var Ue=De[ve];delete De[ve],Object.keys(Ue).forEach(function(Ee){De[ve+"."+Ee]=Ue[Ee]})}}return Je("blend"),Je("depth"),Je("cull"),Je("stencil"),Je("polygonOffset"),Je("scissor"),Je("sample"),"vao"in Ye&&(De.vao=Ye.vao),De}function la(Ye,De){var Je={},ve={};return Object.keys(Ye).forEach(function(Ue){var Ee=Ye[Ue];if(Sn.isDynamic(Ee)){ve[Ue]=Sn.unbox(Ee,Ue);return}else if(De&&Array.isArray(Ee)){for(var at=0;at<Ee.length;++at)if(Sn.isDynamic(Ee[at])){ve[Ue]=Sn.unbox(Ee,Ue);return}}Je[Ue]=Ee}),{dynamic:ve,static:Je}}var Co=la(ei.context||{},!0),wl=la(ei.uniforms||{},!0),Ae=la(ei.attributes||{},!1),Dt=la(Di(ei),!1),xt={gpuTime:0,cpuTime:0,count:0},vn=dn.compile(Dt,Ae,wl,Co,xt),zi=vn.draw,be=vn.batch,ne=vn.scope,Ze=[];function ot(Ye){for(;Ze.length<Ye;)Ze.push(null);return Ze}function Tt(Ye,De){var Je;if(ar&&fe.raise("context lost"),typeof Ye=="function")return ne.call(this,null,Ye,0);if(typeof De=="function")if(typeof Ye=="number")for(Je=0;Je<Ye;++Je)ne.call(this,null,De,Je);else if(Array.isArray(Ye))for(Je=0;Je<Ye.length;++Je)ne.call(this,Ye[Je],De,Je);else return ne.call(this,Ye,De,0);else if(typeof Ye=="number"){if(Ye>0)return be.call(this,ot(Ye|0),Ye|0)}else if(Array.isArray(Ye)){if(Ye.length)return be.call(this,Ye,Ye.length)}else return zi.call(this,Ye)}return g(Tt,{stats:xt,destroy:function(){vn.destroy()}})}var qo=er.setFBO=Ga({framebuffer:Sn.define.call(null,ch,"framebuffer")});function So(ei,Di){var la=0;dn.procs.poll();var Co=Di.color;Co&&(Fe.clearColor(+Co[0]||0,+Co[1]||0,+Co[2]||0,+Co[3]||0),la|=Id),"depth"in Di&&(Fe.clearDepth(+Di.depth),la|=wf),"stencil"in Di&&(Fe.clearStencil(Di.stencil|0),la|=lh),fe(!!la,"called regl.clear with no buffer specified"),Fe.clear(la)}function Zo(ei){if(fe(typeof ei=="object"&&ei,"regl.clear() takes an object as input"),"framebuffer"in ei)if(ei.framebuffer&&ei.framebuffer_reglType==="framebufferCube")for(var Di=0;Di<6;++Di)qo(g({framebuffer:ei.framebuffer.faces[Di]},ei),So);else qo(ei,So);else So(null,ei)}function jo(ei){fe.type(ei,"function","regl.frame() callback must be a function"),Hr.push(ei);function Di(){var la=fh(Hr,ei);fe(la>=0,"cannot cancel a frame twice");function Co(){var wl=fh(Hr,Co);Hr[wl]=Hr[Hr.length-1],Hr.length-=1,Hr.length<=0&&Ni()}Hr[la]=Co}return ui(),{cancel:Di}}function ds(){var ei=xr.viewport,Di=xr.scissor_box;ei[0]=ei[1]=Di[0]=Di[1]=0,_r.viewportWidth=_r.framebufferWidth=_r.drawingBufferWidth=ei[2]=Di[2]=Fe.drawingBufferWidth,_r.viewportHeight=_r.framebufferHeight=_r.drawingBufferHeight=ei[3]=Di[3]=Fe.drawingBufferHeight}function fo(){_r.tick+=1,_r.time=Vo(),ds(),dn.procs.poll()}function xi(){Bn.refresh(),ds(),dn.procs.refresh(),yr&&yr.update()}function Vo(){return(to()-Sr)/1e3}xi();function Ki(ei,Di){fe.type(Di,"function","listener callback must be a function");var la;switch(ei){case"frame":return jo(Di);case"lost":la=si;break;case"restore":la=ni;break;case"destroy":la=Vr;break;default:fe.raise("invalid event, must be one of frame,lost,restore,destroy")}return la.push(Di),{cancel:function(){for(var Co=0;Co<la.length;++Co)if(la[Co]===Di){la[Co]=la[la.length-1],la.pop();return}}}}var Ko=g(Ga,{clear:Zo,prop:Sn.define.bind(null,ch),context:Sn.define.bind(null,Kl),this:Sn.define.bind(null,Tf),draw:Ga({}),buffer:function(ei){return Qt.create(ei,zp,!1,!1)},elements:function(ei){return Pr.create(ei,!1)},texture:Bn.create2D,cube:Bn.createCube,renderbuffer:$t.create,framebuffer:er.create,framebufferCube:er.createCube,vao:lr.createVAO,attributes:Rt,frame:jo,on:Ki,limits:Zt,hasExtension:function(ei){return Zt.extensions.indexOf(ei.toLowerCase())>=0},read:Yr,destroy:as,_gl:Fe,_refresh:xi,poll:function(){fo(),yr&&yr.update()},now:Vo,stats:cr});return ce.onDone(null,Ko),Ko}return Od})},49029:function(Tr){var ie=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function ee(Oe){return Oe.match(ie)||[]}Tr.exports=ee},29750:function(Tr){function ie(ee,Oe,_e){return ee===ee&&(_e!==void 0&&(ee=ee<=_e?ee:_e),Oe!==void 0&&(ee=ee>=Oe?ee:Oe)),ee}Tr.exports=ie},18674:function(Tr){function ie(ee){return function(Oe){return ee==null?void 0:ee[Oe]}}Tr.exports=ie},98805:function(Tr,ie,ee){var Oe=ee(40180),_e=ee(62689),g=ee(83140),Re=ee(79833);function X(pe){return function(de){de=Re(de);var Ne=_e(de)?g(de):void 0,xe=Ne?Ne[0]:de.charAt(0),tt=Ne?Oe(Ne,1).join(""):de.slice(1);return xe[pe]()+tt}}Tr.exports=X},35393:function(Tr,ie,ee){var Oe=ee(62663),_e=ee(53816),g=ee(58748),Re="['\u2019]",X=RegExp(Re,"g");function pe(de){return function(Ne){return Oe(g(_e(Ne).replace(X,"")),de,"")}}Tr.exports=pe},69389:function(Tr,ie,ee){var Oe=ee(18674),_e={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},g=Oe(_e);Tr.exports=g},93157:function(Tr){var ie=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function ee(Oe){return ie.test(Oe)}Tr.exports=ee},2757:function(Tr){var ie="\\ud800-\\udfff",ee="\\u0300-\\u036f",Oe="\\ufe20-\\ufe2f",_e="\\u20d0-\\u20ff",g=ee+Oe+_e,Re="\\u2700-\\u27bf",X="a-z\\xdf-\\xf6\\xf8-\\xff",pe="\\xac\\xb1\\xd7\\xf7",de="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Ne="\\u2000-\\u206f",xe=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",tt="A-Z\\xc0-\\xd6\\xd8-\\xde",dt="\\ufe0e\\ufe0f",At=pe+de+Ne+xe,tr="['\u2019]",pr="["+At+"]",Lt="["+g+"]",nr="\\d+",jt="["+Re+"]",ht="["+X+"]",gt="[^"+ie+At+nr+Re+X+tt+"]",sr="\\ud83c[\\udffb-\\udfff]",q="(?:"+Lt+"|"+sr+")",Yt="[^"+ie+"]",ct="(?:\\ud83c[\\udde6-\\uddff]){2}",Ke="[\\ud800-\\udbff][\\udc00-\\udfff]",wt="["+tt+"]",et="\\u200d",qt="(?:"+ht+"|"+gt+")",Ar="(?:"+wt+"|"+gt+")",Wr="(?:"+tr+"(?:d|ll|m|re|s|t|ve))?",on="(?:"+tr+"(?:D|LL|M|RE|S|T|VE))?",A=q+"?",Se="["+dt+"]?",ke="(?:"+et+"(?:"+[Yt,ct,Ke].join("|")+")"+Se+A+")*",St="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",vt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ft=Se+A+ke,Wt="(?:"+[jt,ct,Ke].join("|")+")"+Ft,Er=RegExp([wt+"?"+ht+"+"+Wr+"(?="+[pr,wt,"$"].join("|")+")",Ar+"+"+on+"(?="+[pr,wt+qt,"$"].join("|")+")",wt+"?"+qt+"+"+Wr,wt+"+"+on,vt,St,nr,Wt].join("|"),"g");function $n(_n){return _n.match(Er)||[]}Tr.exports=$n},68929:function(Tr,ie,ee){var Oe=ee(48403),_e=ee(35393),g=_e(function(Re,X,pe){return X=X.toLowerCase(),Re+(pe?Oe(X):X)});Tr.exports=g},48403:function(Tr,ie,ee){var Oe=ee(79833),_e=ee(11700);function g(Re){return _e(Oe(Re).toLowerCase())}Tr.exports=g},74691:function(Tr,ie,ee){var Oe=ee(29750),_e=ee(14841);function g(Re,X,pe){return pe===void 0&&(pe=X,X=void 0),pe!==void 0&&(pe=_e(pe),pe=pe===pe?pe:0),X!==void 0&&(X=_e(X),X=X===X?X:0),Oe(_e(Re),X,pe)}Tr.exports=g},53816:function(Tr,ie,ee){var Oe=ee(69389),_e=ee(79833),g=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Re="\\u0300-\\u036f",X="\\ufe20-\\ufe2f",pe="\\u20d0-\\u20ff",de=Re+X+pe,Ne="["+de+"]",xe=RegExp(Ne,"g");function tt(dt){return dt=_e(dt),dt&&dt.replace(g,Oe).replace(xe,"")}Tr.exports=tt},14293:function(Tr){function ie(ee){return ee==null}Tr.exports=ie},81763:function(Tr,ie,ee){var Oe=ee(44239),_e=ee(37005),g="[object Number]";function Re(X){return typeof X=="number"||_e(X)&&Oe(X)==g}Tr.exports=Re},30236:function(Tr,ie,ee){var Oe=ee(42980),_e=ee(21463),g=_e(function(Re,X,pe,de){Oe(Re,X,pe,de)});Tr.exports=g},44908:function(Tr,ie,ee){var Oe=ee(45652);function _e(g){return g&&g.length?Oe(g):[]}Tr.exports=_e},11700:function(Tr,ie,ee){var Oe=ee(98805),_e=Oe("toUpperCase");Tr.exports=_e},58748:function(Tr,ie,ee){var Oe=ee(49029),_e=ee(93157),g=ee(79833),Re=ee(2757);function X(pe,de,Ne){return pe=g(pe),de=Ne?void 0:de,de===void 0?_e(pe)?Re(pe):Oe(pe):pe.match(de)||[]}Tr.exports=X},6158:function(Tr){(function(ie,ee){Tr.exports=ee()})(this,function(){"use strict";var ie,ee,Oe;function _e(g,Re){if(!ie)ie=Re;else if(!ee)ee=Re;else{var X="var sharedChunk = {}; ("+ie+")(sharedChunk); ("+ee+")(sharedChunk);",pe={};ie(pe),Oe=Re(pe),typeof window!="undefined"&&(Oe.workerUrl=window.URL.createObjectURL(new Blob([X],{type:"text/javascript"})))}}return _e(["exports"],function(g){"use strict";function Re(t,o){return t(o={exports:{}},o.exports),o.exports}var X=pe;function pe(t,o,u,h){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(h-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=h,this.p2x=u,this.p2y=h}pe.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},pe.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},pe.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},pe.prototype.solveCurveX=function(t,o){var u,h,y,b,S;for(o===void 0&&(o=1e-6),y=t,S=0;S<8;S++){if(b=this.sampleCurveX(y)-t,Math.abs(b)<o)return y;var I=this.sampleCurveDerivativeX(y);if(Math.abs(I)<1e-6)break;y-=b/I}if((y=t)<(u=0))return u;if(y>(h=1))return h;for(;u<h;){if(b=this.sampleCurveX(y),Math.abs(b-t)<o)return y;t>b?u=y:h=y,y=.5*(h-u)+u}return y},pe.prototype.solve=function(t,o){return this.sampleCurveY(this.solveCurveX(t,o))};var de=Ne;function Ne(t,o){this.x=t,this.y=o}Ne.prototype={clone:function(){return new Ne(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,o){return this.clone()._rotateAround(t,o)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var o=t.x-this.x,u=t.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,o){return Math.atan2(this.x*o-this.y*t,this.x*t+this.y*o)},_matMult:function(t){var o=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=o,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var o=Math.cos(t),u=Math.sin(t),h=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=h,this},_rotateAround:function(t,o){var u=Math.cos(t),h=Math.sin(t),y=o.y+h*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-h*(this.y-o.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ne.convert=function(t){return t instanceof Ne?t:Array.isArray(t)?new Ne(t[0],t[1]):t};var xe=typeof self!="undefined"?self:{},tt=Math.pow(2,53)-1;function dt(t,o,u,h){var y=new X(t,o,u,h);return function(b){return y.solve(b)}}var At=dt(.25,.1,.25,1);function tr(t,o,u){return Math.min(u,Math.max(o,t))}function pr(t,o,u){var h=u-o,y=((t-o)%h+h)%h+o;return y===o?u:y}function Lt(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var h=0,y=o;h<y.length;h+=1){var b=y[h];for(var S in b)t[S]=b[S]}return t}var nr=1;function jt(){return nr++}function ht(){return function t(o){return o?(o^16*Math.random()>>o/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function gt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function sr(t,o){t.forEach(function(u){o[u]&&(o[u]=o[u].bind(o))})}function q(t,o){return t.indexOf(o,t.length-o.length)!==-1}function Yt(t,o,u){var h={};for(var y in t)h[y]=o.call(u||this,t[y],y,t);return h}function ct(t,o,u){var h={};for(var y in t)o.call(u||this,t[y],y,t)&&(h[y]=t[y]);return h}function Ke(t){return Array.isArray(t)?t.map(Ke):typeof t=="object"&&t?Yt(t,Ke):t}var wt={};function et(t){wt[t]||(typeof console!="undefined"&&console.warn(t),wt[t]=!0)}function qt(t,o,u){return(u.y-t.y)*(o.x-t.x)>(o.y-t.y)*(u.x-t.x)}function Ar(t){for(var o=0,u=0,h=t.length,y=h-1,b=void 0,S=void 0;u<h;y=u++)o+=((S=t[y]).x-(b=t[u]).x)*(b.y+S.y);return o}function Wr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function on(t){var o={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(h,y,b,S){var I=b||S;return o[y]=!I||I.toLowerCase(),""}),o["max-age"]){var u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o}var A=null;function Se(t){if(A==null){var o=t.navigator?t.navigator.userAgent:null;A=!!t.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return A}function ke(t){try{var o=xe[t];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(u){return!1}}var St,vt,Ft,Wt,Er=xe.performance&&xe.performance.now?xe.performance.now.bind(xe.performance):Date.now.bind(Date),$n=xe.requestAnimationFrame||xe.mozRequestAnimationFrame||xe.webkitRequestAnimationFrame||xe.msRequestAnimationFrame,_n=xe.cancelAnimationFrame||xe.mozCancelAnimationFrame||xe.webkitCancelAnimationFrame||xe.msCancelAnimationFrame,mi={now:Er,frame:function(t){var o=$n(t);return{cancel:function(){return _n(o)}}},getImageData:function(t,o){o===void 0&&(o=0);var u=xe.document.createElement("canvas"),h=u.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return u.width=t.width,u.height=t.height,h.drawImage(t,0,0,t.width,t.height),h.getImageData(-o,-o,t.width+2*o,t.height+2*o)},resolveURL:function(t){return St||(St=xe.document.createElement("a")),St.href=t,St.href},hardwareConcurrency:xe.navigator&&xe.navigator.hardwareConcurrency||4,get devicePixelRatio(){return xe.devicePixelRatio},get prefersReducedMotion(){return!!xe.matchMedia&&(vt==null&&(vt=xe.matchMedia("(prefers-reduced-motion: reduce)")),vt.matches)}},Gn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ai={supported:!1,testSupport:function(t){!gi&&Wt&&(Xn?yi(t):Ft=t)}},gi=!1,Xn=!1;function yi(t){var o=t.createTexture();t.bindTexture(t.TEXTURE_2D,o);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Wt),t.isContextLost())return;ai.supported=!0}catch(u){}t.deleteTexture(o),gi=!0}xe.document&&((Wt=xe.document.createElement("img")).onload=function(){Ft&&yi(Ft),Ft=null,Xn=!0},Wt.onerror=function(){gi=!0,Ft=null},Wt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var va="01",Xi=function(t,o){this._transformRequestFn=t,this._customAccessToken=o,this._createSkuToken()};function Ri(t){return t.indexOf("mapbox:")===0}Xi.prototype._createSkuToken=function(){var t=function(){for(var o="",u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",va,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},Xi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Xi.prototype.transformRequest=function(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}},Xi.prototype.normalizeStyleURL=function(t,o){if(!Ri(t))return t;var u=Oa(t);return u.path="/styles/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Xi.prototype.normalizeGlyphsURL=function(t,o){if(!Ri(t))return t;var u=Oa(t);return u.path="/fonts/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Xi.prototype.normalizeSourceURL=function(t,o){if(!Ri(t))return t;var u=Oa(t);return u.path="/v4/"+u.authority+".json",u.params.push("secure"),this._makeAPIURL(u,this._customAccessToken||o)},Xi.prototype.normalizeSpriteURL=function(t,o,u,h){var y=Oa(t);return Ri(t)?(y.path="/styles/v1"+y.path+"/sprite"+o+u,this._makeAPIURL(y,this._customAccessToken||h)):(y.path+=""+o+u,xa(y))},Xi.prototype.normalizeTileURL=function(t,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Ri(t))return t;var u=Oa(t);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,(mi.devicePixelRatio>=2||o===512?"@2x":"")+(ai.supported?".webp":"$1")),u.path=u.path.replace(/^.+\/v4\//,"/"),u.path="/v4"+u.path;var h=this._customAccessToken||function(y){for(var b=0,S=y;b<S.length;b+=1){var I=S[b].match(/^access_token=(.*)$/);if(I)return I[1]}return null}(u.params)||Gn.ACCESS_TOKEN;return Gn.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&u.params.push("sku="+this._skuToken),this._makeAPIURL(u,h)},Xi.prototype.canonicalizeTileURL=function(t,o){var u=Oa(t);if(!u.path.match(/(^\/v4\/)/)||!u.path.match(/\.[\w]+$/))return t;var h="mapbox://tiles/";h+=u.path.replace("/v4/","");var y=u.params;return o&&(y=y.filter(function(b){return!b.match(/^access_token=/)})),y.length&&(h+="?"+y.join("&")),h},Xi.prototype.canonicalizeTileset=function(t,o){for(var u=!!o&&Ri(o),h=[],y=0,b=t.tiles||[];y<b.length;y+=1){var S=b[y];ma(S)?h.push(this.canonicalizeTileURL(S,u)):h.push(S)}return h},Xi.prototype._makeAPIURL=function(t,o){var u="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",h=Oa(Gn.API_URL);if(t.protocol=h.protocol,t.authority=h.authority,t.protocol==="http"){var y=t.params.indexOf("secure");y>=0&&t.params.splice(y,1)}if(h.path!=="/"&&(t.path=""+h.path+t.path),!Gn.REQUIRE_ACCESS_TOKEN)return xa(t);if(!(o=o||Gn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+u);if(o[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return t.params=t.params.filter(function(b){return b.indexOf("access_token")===-1}),t.params.push("access_token="+o),xa(t)};var Ji=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function ma(t){return Ji.test(t)}var Do=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Oa(t){var o=t.match(Do);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function xa(t){var o=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+o}function Ui(t){if(!t)return null;var o=t.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(decodeURIComponent(xe.atob(o[1]).split("").map(function(u){return"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(u){return null}}var aa=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};aa.prototype.getStorageKey=function(t){var o,u=Ui(Gn.ACCESS_TOKEN);return o=u&&u.u?xe.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,function(h,y){return String.fromCharCode(Number("0x"+y))})):Gn.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+o:"mapbox.eventData:"+o},aa.prototype.fetchEventData=function(){var t=ke("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{var h=xe.localStorage.getItem(o);h&&(this.eventData=JSON.parse(h));var y=xe.localStorage.getItem(u);y&&(this.anonId=y)}catch(b){et("Unable to read from LocalStorage")}},aa.prototype.saveEventData=function(){var t=ke("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{xe.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&xe.localStorage.setItem(o,JSON.stringify(this.eventData))}catch(h){et("Unable to write to LocalStorage")}},aa.prototype.processRequests=function(t){},aa.prototype.postEvent=function(t,o,u,h){var y=this;if(Gn.EVENTS_URL){var b=Oa(Gn.EVENTS_URL);b.params.push("access_token="+(h||Gn.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:va,userId:this.anonId},I=o?Lt(S,o):S,k={url:xa(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=ba(k,function(N){y.pendingRequest=null,u(N),y.saveEventData(),y.processRequests(h)})}},aa.prototype.queueRequest=function(t,o){this.queue.push(t),this.processRequests(o)};var ea,Os,fe=function(t){function o(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postMapLoadEvent=function(u,h,y,b){this.skuToken=y,(Gn.EVENTS_URL&&b||Gn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(S){return Ri(S)||ma(S)}))&&this.queueRequest({id:h,timestamp:Date.now()},b)},o.prototype.processRequests=function(u){var h=this;if(!this.pendingRequest&&this.queue.length!==0){var y=this.queue.shift(),b=y.id,S=y.timestamp;b&&this.success[b]||(this.anonId||this.fetchEventData(),gt(this.anonId)||(this.anonId=ht()),this.postEvent(S,{skuToken:this.skuToken},function(I){I||b&&(h.success[b]=!0)},u))}},o}(aa),oi=new(function(t){function o(u){t.call(this,"appUserTurnstile"),this._customAccessToken=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postTurnstileEvent=function(u,h){Gn.EVENTS_URL&&Gn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(y){return Ri(y)||ma(y)})&&this.queueRequest(Date.now(),h)},o.prototype.processRequests=function(u){var h=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var y=Ui(Gn.ACCESS_TOKEN),b=y?y.u:Gn.ACCESS_TOKEN,S=b!==this.eventData.tokenU;gt(this.anonId)||(this.anonId=ht(),S=!0);var I=this.queue.shift();if(this.eventData.lastSuccess){var k=new Date(this.eventData.lastSuccess),N=new Date(I),U=(I-this.eventData.lastSuccess)/864e5;S=S||U>=1||U<-1||k.getDate()!==N.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(I,{"enabled.telemetry":!1},function(G){G||(h.eventData.lastSuccess=I,h.eventData.tokenU=b)},u)}},o}(aa)),xo=oi.postTurnstileEvent.bind(oi),au=new fe,Nt=au.postMapLoadEvent.bind(au),Jt=500,Dr=50;function cn(){xe.caches&&!ea&&(ea=xe.caches.open("mapbox-tiles"))}function wn(t){var o=t.indexOf("?");return o<0?t:t.slice(0,o)}var Nn,Ei=1/0;function di(){return Nn==null&&(Nn=xe.OffscreenCanvas&&new xe.OffscreenCanvas(1,1).getContext("2d")&&typeof xe.createImageBitmap=="function"),Nn}var Sn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Sn);var Pi=function(t){function o(u,h,y){h===401&&ma(y)&&(u+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,u),this.status=h,this.url=y,this.name=this.constructor.name,this.message=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},o}(Error),Mi=Wr()?function(){return self.worker&&self.worker.referrer}:function(){return(xe.location.protocol==="blob:"?xe.parent:xe).location.href},to,gs,Ho=function(t,o){if(!(/^file:/.test(u=t.url)||/^file:/.test(Mi())&&!/^\w+:/.test(u))){if(xe.fetch&&xe.Request&&xe.AbortController&&xe.Request.prototype.hasOwnProperty("signal"))return function(h,y){var b,S=new xe.AbortController,I=new xe.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Mi(),signal:S.signal}),k=!1,N=!1,U=(b=I.url).indexOf("sku=")>0&&ma(b);h.type==="json"&&I.headers.set("Accept","application/json");var G=function(re,Te,Ie){if(!N){if(re&&re.message!=="SecurityError"&&et(re),Te&&Ie)return $(Te);var We=Date.now();xe.fetch(I).then(function(ze){if(ze.ok){var it=U?ze.clone():null;return $(ze,it,We)}return y(new Pi(ze.statusText,ze.status,h.url))}).catch(function(ze){ze.code!==20&&y(new Error(ze.message))})}},$=function(re,Te,Ie){(h.type==="arrayBuffer"?re.arrayBuffer():h.type==="json"?re.json():re.text()).then(function(We){N||(Te&&Ie&&function(ze,it,Et){if(cn(),ea){var Ut={status:it.status,statusText:it.statusText,headers:new xe.Headers};it.headers.forEach(function(or,Ir){return Ut.headers.set(Ir,or)});var Gt=on(it.headers.get("Cache-Control")||"");Gt["no-store"]||(Gt["max-age"]&&Ut.headers.set("Expires",new Date(Et+1e3*Gt["max-age"]).toUTCString()),new Date(Ut.headers.get("Expires")).getTime()-Et<42e4||function(or,Ir){if(Os===void 0)try{new Response(new ReadableStream),Os=!0}catch(Qr){Os=!1}Os?Ir(or.body):or.blob().then(Ir)}(it,function(or){var Ir=new xe.Response(or,Ut);cn(),ea&&ea.then(function(Qr){return Qr.put(wn(ze.url),Ir)}).catch(function(Qr){return et(Qr.message)})}))}}(I,Te,Ie),k=!0,y(null,We,re.headers.get("Cache-Control"),re.headers.get("Expires")))}).catch(function(We){N||y(new Error(We.message))})};return U?function(re,Te){if(cn(),!ea)return Te(null);var Ie=wn(re.url);ea.then(function(We){We.match(Ie).then(function(ze){var it=function(Et){if(!Et)return!1;var Ut=new Date(Et.headers.get("Expires")||0),Gt=on(Et.headers.get("Cache-Control")||"");return Ut>Date.now()&&!Gt["no-cache"]}(ze);We.delete(Ie),it&&We.put(Ie,ze.clone()),Te(null,ze,it)}).catch(Te)}).catch(Te)}(I,G):G(null,null),{cancel:function(){N=!0,k||S.abort()}}}(t,o);if(Wr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,o,void 0,!0)}var u;return function(h,y){var b=new xe.XMLHttpRequest;for(var S in b.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(b.responseType="arraybuffer"),h.headers)b.setRequestHeader(S,h.headers[S]);return h.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=h.credentials==="include",b.onerror=function(){y(new Error(b.statusText))},b.onload=function(){if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){var I=b.response;if(h.type==="json")try{I=JSON.parse(b.response)}catch(k){return y(k)}y(null,I,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else y(new Pi(b.statusText,b.status,h.url))},b.send(h.body),{cancel:function(){return b.abort()}}}(t,o)},Na=function(t,o){return Ho(Lt(t,{type:"arrayBuffer"}),o)},ba=function(t,o){return Ho(Lt(t,{method:"POST"}),o)},V="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";to=[],gs=0;var K=function(t,o){if(ai.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),gs>=Gn.MAX_PARALLEL_IMAGE_REQUESTS){var u={requestParameters:t,callback:o,cancelled:!1,cancel:function(){this.cancelled=!0}};return to.push(u),u}gs++;var h=!1,y=function(){if(!h)for(h=!0,gs--;to.length&&gs<Gn.MAX_PARALLEL_IMAGE_REQUESTS;){var S=to.shift();S.cancelled||(S.cancel=K(S.requestParameters,S.callback).cancel)}},b=Na(t,function(S,I,k,N){y(),S?o(S):I&&(di()?function(U,G){var $=new xe.Blob([new Uint8Array(U)],{type:"image/png"});xe.createImageBitmap($).then(function(re){G(null,re)}).catch(function(re){G(new Error("Could not load image because of "+re.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(I,o):function(U,G,$,re){var Te=new xe.Image,Ie=xe.URL;Te.onload=function(){G(null,Te),Ie.revokeObjectURL(Te.src),Te.onload=null,xe.requestAnimationFrame(function(){Te.src=V})},Te.onerror=function(){return G(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var We=new xe.Blob([new Uint8Array(U)],{type:"image/png"});Te.cacheControl=$,Te.expires=re,Te.src=U.byteLength?Ie.createObjectURL(We):V}(I,o,k,N))});return{cancel:function(){b.cancel(),y()}}};function te(t,o,u){u[t]&&u[t].indexOf(o)!==-1||(u[t]=u[t]||[],u[t].push(o))}function he(t,o,u){if(u&&u[t]){var h=u[t].indexOf(o);h!==-1&&u[t].splice(h,1)}}var Me=function(t,o){o===void 0&&(o={}),Lt(this,o),this.type=t},je=function(t){function o(u,h){h===void 0&&(h={}),t.call(this,"error",Lt({error:u},h))}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Me),Qe=function(){};Qe.prototype.on=function(t,o){return this._listeners=this._listeners||{},te(t,o,this._listeners),this},Qe.prototype.off=function(t,o){return he(t,o,this._listeners),he(t,o,this._oneTimeListeners),this},Qe.prototype.once=function(t,o){return this._oneTimeListeners=this._oneTimeListeners||{},te(t,o,this._oneTimeListeners),this},Qe.prototype.fire=function(t,o){typeof t=="string"&&(t=new Me(t,o||{}));var u=t.type;if(this.listens(u)){t.target=this;for(var h=0,y=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];h<y.length;h+=1)y[h].call(this,t);for(var b=0,S=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];b<S.length;b+=1){var I=S[b];he(u,I,this._oneTimeListeners),I.call(this,t)}var k=this._eventedParent;k&&(Lt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),k.fire(t))}else t instanceof je&&console.error(t.error);return this},Qe.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},Qe.prototype.setEventedParent=function(t,o){return this._eventedParent=t,this._eventedParentData=o,this};var se={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Le=function(t,o,u,h){this.message=(t?t+": ":"")+u,h&&(this.identifier=h),o!=null&&o.__line__&&(this.line=o.__line__)};function ft(t){var o=t.value;return o?[new Le(t.key,o,"constants have been deprecated as of v8")]:[]}function hr(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var h=0,y=o;h<y.length;h+=1){var b=y[h];for(var S in b)t[S]=b[S]}return t}function Ot(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function kt(t){if(Array.isArray(t))return t.map(kt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var o={};for(var u in t)o[u]=kt(t[u]);return o}return Ot(t)}var dr=function(t){function o(u,h){t.call(this,h),this.message=h,this.key=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Error),En=function(t,o){o===void 0&&(o=[]),this.parent=t,this.bindings={};for(var u=0,h=o;u<h.length;u+=1){var y=h[u];this.bindings[y[0]]=y[1]}};En.prototype.concat=function(t){return new En(this,t)},En.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},En.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var fn={kind:"null"},Mt={kind:"number"},tn={kind:"string"},Ur={kind:"boolean"},Xr={kind:"color"},vi={kind:"object"},rn={kind:"value"},nn={kind:"collator"},ji={kind:"formatted"},fi={kind:"resolvedImage"};function Ai(t,o){return{kind:"array",itemType:t,N:o}}function _i(t){if(t.kind==="array"){var o=_i(t.itemType);return typeof t.N=="number"?"array<"+o+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+o+">"}return t.kind}var st=[fn,Mt,tn,Ur,Xr,ji,vi,Ai(rn),fi];function Ct(t,o){if(o.kind==="error")return null;if(t.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!Ct(t.itemType,o.itemType))&&(typeof t.N!="number"||t.N===o.N))return null}else{if(t.kind===o.kind)return null;if(t.kind==="value"){for(var u=0,h=st;u<h.length;u+=1)if(!Ct(h[u],o))return null}}return"Expected "+_i(t)+" but found "+_i(o)+" instead."}function Ca(t,o){return o.some(function(u){return u.kind===t.kind})}function Ci(t,o){return o.some(function(u){return u==="null"?t===null:u==="array"?Array.isArray(t):u==="object"?t&&!Array.isArray(t)&&typeof t=="object":u===typeof t})}var wi=Re(function(t,o){var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function h(I){return(I=Math.round(I))<0?0:I>255?255:I}function y(I){return h(I[I.length-1]==="%"?parseFloat(I)/100*255:parseInt(I))}function b(I){return(k=I[I.length-1]==="%"?parseFloat(I)/100:parseFloat(I))<0?0:k>1?1:k;var k}function S(I,k,N){return N<0?N+=1:N>1&&(N-=1),6*N<1?I+(k-I)*N*6:2*N<1?k:3*N<2?I+(k-I)*(2/3-N)*6:I}try{o.parseCSSColor=function(I){var k,N=I.replace(/ /g,"").toLowerCase();if(N in u)return u[N].slice();if(N[0]==="#")return N.length===4?(k=parseInt(N.substr(1),16))>=0&&k<=4095?[(3840&k)>>4|(3840&k)>>8,240&k|(240&k)>>4,15&k|(15&k)<<4,1]:null:N.length===7&&(k=parseInt(N.substr(1),16))>=0&&k<=16777215?[(16711680&k)>>16,(65280&k)>>8,255&k,1]:null;var U=N.indexOf("("),G=N.indexOf(")");if(U!==-1&&G+1===N.length){var $=N.substr(0,U),re=N.substr(U+1,G-(U+1)).split(","),Te=1;switch($){case"rgba":if(re.length!==4)return null;Te=b(re.pop());case"rgb":return re.length!==3?null:[y(re[0]),y(re[1]),y(re[2]),Te];case"hsla":if(re.length!==4)return null;Te=b(re.pop());case"hsl":if(re.length!==3)return null;var Ie=(parseFloat(re[0])%360+360)%360/360,We=b(re[1]),ze=b(re[2]),it=ze<=.5?ze*(We+1):ze+We-ze*We,Et=2*ze-it;return[h(255*S(Et,it,Ie+1/3)),h(255*S(Et,it,Ie)),h(255*S(Et,it,Ie-1/3)),Te];default:return null}}return null}}catch(I){}}).parseCSSColor,Bi=function(t,o,u,h){h===void 0&&(h=1),this.r=t,this.g=o,this.b=u,this.a=h};Bi.parse=function(t){if(t){if(t instanceof Bi)return t;if(typeof t=="string"){var o=wi(t);if(o)return new Bi(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3])}}},Bi.prototype.toString=function(){var t=this.toArray(),o=t[1],u=t[2],h=t[3];return"rgba("+Math.round(t[0])+","+Math.round(o)+","+Math.round(u)+","+h+")"},Bi.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},Bi.black=new Bi(0,0,0,1),Bi.white=new Bi(1,1,1,1),Bi.transparent=new Bi(0,0,0,0),Bi.red=new Bi(1,0,0,1);var wr=function(t,o,u){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};wr.prototype.compare=function(t,o){return this.collator.compare(t,o)},wr.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var an=function(t,o,u,h,y){this.text=t,this.image=o,this.scale=u,this.fontStack=h,this.textColor=y},pt=function(t){this.sections=t};pt.fromString=function(t){return new pt([new an(t,null,null,null,null)])},pt.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},pt.factory=function(t){return t instanceof pt?t:pt.fromString(t)},pt.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},pt.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var h=u[o];if(h.image)t.push(["image",h.image.name]);else{t.push(h.text);var y={};h.fontStack&&(y["text-font"]=["literal",h.fontStack.split(",")]),h.scale&&(y["font-scale"]=h.scale),h.textColor&&(y["text-color"]=["rgba"].concat(h.textColor.toArray())),t.push(y)}}return t};var ta=function(t){this.name=t.name,this.available=t.available};function ae(t,o,u,h){return typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:"Invalid rgba value ["+[t,o,u,h].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof h=="number"?[t,o,u,h]:[t,o,u]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function es(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Bi||t instanceof wr||t instanceof pt||t instanceof ta)return!0;if(Array.isArray(t)){for(var o=0,u=t;o<u.length;o+=1)if(!es(u[o]))return!1;return!0}if(typeof t=="object"){for(var h in t)if(!es(t[h]))return!1;return!0}return!1}function $i(t){if(t===null)return fn;if(typeof t=="string")return tn;if(typeof t=="boolean")return Ur;if(typeof t=="number")return Mt;if(t instanceof Bi)return Xr;if(t instanceof wr)return nn;if(t instanceof pt)return ji;if(t instanceof ta)return fi;if(Array.isArray(t)){for(var o,u=t.length,h=0,y=t;h<y.length;h+=1){var b=$i(y[h]);if(o){if(o===b)continue;o=rn;break}o=b}return Ai(o||rn,u)}return vi}function Eu(t){var o=typeof t;return t===null?"":o==="string"||o==="number"||o==="boolean"?String(t):t instanceof Bi||t instanceof pt||t instanceof ta?t.toString():JSON.stringify(t)}ta.prototype.toString=function(){return this.name},ta.fromString=function(t){return t?new ta({name:t,available:!1}):null},ta.prototype.serialize=function(){return["image",this.name]};var za=function(t,o){this.type=t,this.value=o};za.parse=function(t,o){if(t.length!==2)return o.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!es(t[1]))return o.error("invalid value");var u=t[1],h=$i(u),y=o.expectedType;return h.kind!=="array"||h.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(h=y),new za(h,u)},za.prototype.evaluate=function(){return this.value},za.prototype.eachChild=function(){},za.prototype.outputDefined=function(){return!0},za.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Bi?["rgba"].concat(this.value.toArray()):this.value instanceof pt?this.value.serialize():this.value};var Aa=function(t){this.name="ExpressionEvaluationError",this.message=t};Aa.prototype.toJSON=function(){return this.message};var Ya={string:tn,number:Mt,boolean:Ur,object:vi},ra=function(t,o){this.type=t,this.args=o};ra.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u,h=1,y=t[0];if(y==="array"){var b,S;if(t.length>2){var I=t[1];if(typeof I!="string"||!(I in Ya)||I==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);b=Ya[I],h++}else b=rn;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);S=t[2],h++}u=Ai(b,S)}else u=Ya[y];for(var k=[];h<t.length;h++){var N=o.parse(t[h],h,rn);if(!N)return null;k.push(N)}return new ra(u,k)},ra.prototype.evaluate=function(t){for(var o=0;o<this.args.length;o++){var u=this.args[o].evaluate(t);if(!Ct(this.type,$i(u)))return u;if(o===this.args.length-1)throw new Aa("Expected value to be of type "+_i(this.type)+", but found "+_i($i(u))+" instead.")}return null},ra.prototype.eachChild=function(t){this.args.forEach(t)},ra.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ra.prototype.serialize=function(){var t=this.type,o=[t.kind];if(t.kind==="array"){var u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);var h=t.N;(typeof h=="number"||this.args.length>1)&&o.push(h)}}return o.concat(this.args.map(function(y){return y.serialize()}))};var Po=function(t){this.type=ji,this.sections=t};Po.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");for(var h=[],y=!1,b=1;b<=t.length-1;++b){var S=t[b];if(y&&typeof S=="object"&&!Array.isArray(S)){y=!1;var I=null;if(S["font-scale"]&&!(I=o.parse(S["font-scale"],1,Mt)))return null;var k=null;if(S["text-font"]&&!(k=o.parse(S["text-font"],1,Ai(tn))))return null;var N=null;if(S["text-color"]&&!(N=o.parse(S["text-color"],1,Xr)))return null;var U=h[h.length-1];U.scale=I,U.font=k,U.textColor=N}else{var G=o.parse(t[b],1,rn);if(!G)return null;var $=G.type.kind;if($!=="string"&&$!=="value"&&$!=="null"&&$!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,h.push({content:G,scale:null,font:null,textColor:null})}}return new Po(h)},Po.prototype.evaluate=function(t){return new pt(this.sections.map(function(o){var u=o.content.evaluate(t);return $i(u)===fi?new an("",u,null,null,null):new an(Eu(u),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))},Po.prototype.eachChild=function(t){for(var o=0,u=this.sections;o<u.length;o+=1){var h=u[o];t(h.content),h.scale&&t(h.scale),h.font&&t(h.font),h.textColor&&t(h.textColor)}},Po.prototype.outputDefined=function(){return!1},Po.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var h=u[o];t.push(h.content.serialize());var y={};h.scale&&(y["font-scale"]=h.scale.serialize()),h.font&&(y["text-font"]=h.font.serialize()),h.textColor&&(y["text-color"]=h.textColor.serialize()),t.push(y)}return t};var Wo=function(t){this.type=fi,this.input=t};Wo.parse=function(t,o){if(t.length!==2)return o.error("Expected two arguments.");var u=o.parse(t[1],1,tn);return u?new Wo(u):o.error("No image name provided.")},Wo.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=ta.fromString(o);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(o)>-1),u},Wo.prototype.eachChild=function(t){t(this.input)},Wo.prototype.outputDefined=function(){return!1},Wo.prototype.serialize=function(){return["image",this.input.serialize()]};var Bu={"to-boolean":Ur,"to-color":Xr,"to-number":Mt,"to-string":tn},ho=function(t,o){this.type=t,this.args=o};ho.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[0];if((u==="to-boolean"||u==="to-string")&&t.length!==2)return o.error("Expected one argument.");for(var h=Bu[u],y=[],b=1;b<t.length;b++){var S=o.parse(t[b],b,rn);if(!S)return null;y.push(S)}return new ho(h,y)},ho.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var o,u,h=0,y=this.args;h<y.length;h+=1){if(u=null,(o=y[h].evaluate(t))instanceof Bi)return o;if(typeof o=="string"){var b=t.parseColor(o);if(b)return b}else if(Array.isArray(o)&&!(u=o.length<3||o.length>4?"Invalid rbga value "+JSON.stringify(o)+": expected an array containing either three or four numeric values.":ae(o[0],o[1],o[2],o[3])))return new Bi(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Aa(u||"Could not parse color from value '"+(typeof o=="string"?o:String(JSON.stringify(o)))+"'")}if(this.type.kind==="number"){for(var S=null,I=0,k=this.args;I<k.length;I+=1){if((S=k[I].evaluate(t))===null)return 0;var N=Number(S);if(!isNaN(N))return N}throw new Aa("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?pt.fromString(Eu(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?ta.fromString(Eu(this.args[0].evaluate(t))):Eu(this.args[0].evaluate(t))},ho.prototype.eachChild=function(t){this.args.forEach(t)},ho.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ho.prototype.serialize=function(){if(this.type.kind==="formatted")return new Po([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Wo(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(o){t.push(o.serialize())}),t};var Fo=["Unknown","Point","LineString","Polygon"],na=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};na.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},na.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Fo[this.feature.type]:this.feature.type:null},na.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},na.prototype.canonicalID=function(){return this.canonical},na.prototype.properties=function(){return this.feature&&this.feature.properties||{}},na.prototype.parseColor=function(t){var o=this._parseColorCache[t];return o||(o=this._parseColorCache[t]=Bi.parse(t)),o};var qa=function(t,o,u,h){this.name=t,this.type=o,this._evaluate=u,this.args=h};qa.prototype.evaluate=function(t){return this._evaluate(t,this.args)},qa.prototype.eachChild=function(t){this.args.forEach(t)},qa.prototype.outputDefined=function(){return!1},qa.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},qa.parse=function(t,o){var u,h=t[0],y=qa.definitions[h];if(!y)return o.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0);for(var b=Array.isArray(y)?y[0]:y.type,S=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,I=S.filter(function(zn){var hn=zn[0];return!Array.isArray(hn)||hn.length===t.length-1}),k=null,N=0,U=I;N<U.length;N+=1){var G=U[N],$=G[0],re=G[1];k=new zs(o.registry,o.path,null,o.scope);for(var Te=[],Ie=!1,We=1;We<t.length;We++){var ze=t[We],it=Array.isArray($)?$[We-1]:$.type,Et=k.parse(ze,1+Te.length,it);if(!Et){Ie=!0;break}Te.push(Et)}if(!Ie)if(Array.isArray($)&&$.length!==Te.length)k.error("Expected "+$.length+" arguments, but found "+Te.length+" instead.");else{for(var Ut=0;Ut<Te.length;Ut++){var Gt=Array.isArray($)?$[Ut]:$.type,or=Te[Ut];k.concat(Ut+1).checkSubtype(Gt,or.type)}if(k.errors.length===0)return new qa(h,b,re,Te)}}if(I.length===1)(u=o.errors).push.apply(u,k.errors);else{for(var Ir=(I.length?I:S).map(function(zn){var hn;return hn=zn[0],Array.isArray(hn)?"("+hn.map(_i).join(", ")+")":"("+_i(hn.type)+"...)"}).join(" | "),Qr=[],kn=1;kn<t.length;kn++){var pn=o.parse(t[kn],1+Qr.length);if(!pn)return null;Qr.push(_i(pn.type))}o.error("Expected arguments of type "+Ir+", but found ("+Qr.join(", ")+") instead.")}return null},qa.register=function(t,o){for(var u in qa.definitions=o,o)t[u]=qa};var Bo=function(t,o,u){this.type=nn,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=o};function Ka(t,o){t[0]=Math.min(t[0],o[0]),t[1]=Math.min(t[1],o[1]),t[2]=Math.max(t[2],o[0]),t[3]=Math.max(t[3],o[1])}function Rs(t,o){return!(t[0]<=o[0]||t[2]>=o[2]||t[1]<=o[1]||t[3]>=o[3])}function Il(t,o){var u=(180+t[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,y=Math.pow(2,o.z);return[Math.round(u*y*8192),Math.round(h*y*8192)]}function ys(t,o,u){return o[1]>t[1]!=u[1]>t[1]&&t[0]<(u[0]-o[0])*(t[1]-o[1])/(u[1]-o[1])+o[0]}function J(t,o){for(var u,h,y,b,S,I,k,N=!1,U=0,G=o.length;U<G;U++)for(var $=o[U],re=0,Te=$.length;re<Te-1;re++){if((b=(u=t)[0]-(h=$[re])[0])*(k=u[1]-(y=$[re+1])[1])-(I=u[0]-y[0])*(S=u[1]-h[1])==0&&b*I<=0&&S*k<=0)return!1;ys(t,$[re],$[re+1])&&(N=!N)}return N}function ge(t,o){for(var u=0;u<o.length;u++)if(J(t,o[u]))return!0;return!1}function Xe(t,o,u,h){var y=h[0]-u[0],b=h[1]-u[1],S=(t[0]-u[0])*b-y*(t[1]-u[1]),I=(o[0]-u[0])*b-y*(o[1]-u[1]);return S>0&&I<0||S<0&&I>0}function Pt(t,o,u){for(var h=0,y=u;h<y.length;h+=1)for(var b=y[h],S=0;S<b.length-1;++S)if((G=[(U=b[S+1])[0]-(N=b[S])[0],U[1]-N[1]])[0]*($=[(k=o)[0]-(I=t)[0],k[1]-I[1]])[1]-G[1]*$[0]!=0&&Xe(I,k,N,U)&&Xe(N,U,I,k))return!0;var I,k,N,U,G,$;return!1}function Or(t,o){for(var u=0;u<t.length;++u)if(!J(t[u],o))return!1;for(var h=0;h<t.length-1;++h)if(Pt(t[h],t[h+1],o))return!1;return!0}function Pn(t,o){for(var u=0;u<o.length;u++)if(Or(t,o[u]))return!0;return!1}function Ti(t,o,u){for(var h=[],y=0;y<t.length;y++){for(var b=[],S=0;S<t[y].length;S++){var I=Il(t[y][S],u);Ka(o,I),b.push(I)}h.push(b)}return h}function ro(t,o,u){for(var h=[],y=0;y<t.length;y++){var b=Ti(t[y],o,u);h.push(b)}return h}function Ra(t,o,u,h){if(t[0]<u[0]||t[0]>u[2]){var y=.5*h,b=t[0]-u[0]>y?-h:u[0]-t[0]>y?h:0;b===0&&(b=t[0]-u[2]>y?-h:u[2]-t[0]>y?h:0),t[0]+=b}Ka(o,t)}function Ua(t,o,u,h){for(var y=8192*Math.pow(2,h.z),b=[8192*h.x,8192*h.y],S=[],I=0,k=t;I<k.length;I+=1)for(var N=0,U=k[I];N<U.length;N+=1){var G=U[N],$=[G.x+b[0],G.y+b[1]];Ra($,o,u,y),S.push($)}return S}function Xo(t,o,u,h){for(var y,b=8192*Math.pow(2,h.z),S=[8192*h.x,8192*h.y],I=[],k=0,N=t;k<N.length;k+=1){for(var U=[],G=0,$=N[k];G<$.length;G+=1){var re=$[G],Te=[re.x+S[0],re.y+S[1]];Ka(o,Te),U.push(Te)}I.push(U)}if(o[2]-o[0]<=b/2){(y=o)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(var Ie=0,We=I;Ie<We.length;Ie+=1)for(var ze=0,it=We[Ie];ze<it.length;ze+=1)Ra(it[ze],o,u,b)}return I}Bo.parse=function(t,o){if(t.length!==2)return o.error("Expected one argument.");var u=t[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");var h=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Ur);if(!h)return null;var y=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Ur);if(!y)return null;var b=null;return u.locale&&!(b=o.parse(u.locale,1,tn))?null:new Bo(h,y,b)},Bo.prototype.evaluate=function(t){return new wr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Bo.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Bo.prototype.outputDefined=function(){return!1},Bo.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var _s=function(t,o){this.type=Ur,this.geojson=t,this.geometries=o};function oo(t){if(t instanceof qa&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof _s)return!1;var o=!0;return t.eachChild(function(u){o&&!oo(u)&&(o=!1)}),o}function Io(t){if(t instanceof qa&&t.name==="feature-state")return!1;var o=!0;return t.eachChild(function(u){o&&!Io(u)&&(o=!1)}),o}function xs(t,o){if(t instanceof qa&&o.indexOf(t.name)>=0)return!1;var u=!0;return t.eachChild(function(h){u&&!xs(h,o)&&(u=!1)}),u}_s.parse=function(t,o){if(t.length!==2)return o.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(es(t[1])){var u=t[1];if(u.type==="FeatureCollection")for(var h=0;h<u.features.length;++h){var y=u.features[h].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new _s(u,u.features[h].geometry)}else if(u.type==="Feature"){var b=u.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new _s(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new _s(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")},_s.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,u){var h=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=Ti(u.coordinates,y,b),I=Ua(o.geometry(),h,y,b);if(!Rs(h,y))return!1;for(var k=0,N=I;k<N.length;k+=1)if(!J(N[k],S))return!1}if(u.type==="MultiPolygon"){var U=ro(u.coordinates,y,b),G=Ua(o.geometry(),h,y,b);if(!Rs(h,y))return!1;for(var $=0,re=G;$<re.length;$+=1)if(!ge(re[$],U))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,u){var h=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=Ti(u.coordinates,y,b),I=Xo(o.geometry(),h,y,b);if(!Rs(h,y))return!1;for(var k=0,N=I;k<N.length;k+=1)if(!Or(N[k],S))return!1}if(u.type==="MultiPolygon"){var U=ro(u.coordinates,y,b),G=Xo(o.geometry(),h,y,b);if(!Rs(h,y))return!1;for(var $=0,re=G;$<re.length;$+=1)if(!Pn(re[$],U))return!1}return!0}(t,this.geometries)}return!1},_s.prototype.eachChild=function(){},_s.prototype.outputDefined=function(){return!0},_s.prototype.serialize=function(){return["within",this.geojson]};var Ls=function(t,o){this.type=o.type,this.name=t,this.boundExpression=o};Ls.parse=function(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");var u=t[1];return o.scope.has(u)?new Ls(u,o.scope.get(u)):o.error('Unknown variable "'+u+'". Make sure "'+u+'" has been bound in an enclosing "let" expression before using it.',1)},Ls.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Ls.prototype.eachChild=function(){},Ls.prototype.outputDefined=function(){return!1},Ls.prototype.serialize=function(){return["var",this.name]};var zs=function(t,o,u,h,y){o===void 0&&(o=[]),h===void 0&&(h=new En),y===void 0&&(y=[]),this.registry=t,this.path=o,this.key=o.map(function(b){return"["+b+"]"}).join(""),this.scope=h,this.errors=y,this.expectedType=u};function ou(t,o){for(var u,h=t.length-1,y=0,b=h,S=0;y<=b;)if((u=t[S=Math.floor((y+b)/2)])<=o){if(S===h||o<t[S+1])return S;y=S+1}else{if(!(u>o))throw new Aa("Input is not a number.");b=S-1}return 0}zs.prototype.parse=function(t,o,u,h,y){return y===void 0&&(y={}),o?this.concat(o,u,h)._parse(t,y):this._parse(t,y)},zs.prototype._parse=function(t,o){function u(N,U,G){return G==="assert"?new ra(U,[N]):G==="coerce"?new ho(U,[N]):N}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var h=t[0];if(typeof h!="string")return this.error("Expression name must be a string, but found "+typeof h+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var y=this.registry[h];if(y){var b=y.parse(t,this);if(!b)return null;if(this.expectedType){var S=this.expectedType,I=b.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||I.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||I.kind!=="value"&&I.kind!=="string"){if(this.checkSubtype(S,I))return null}else b=u(b,S,o.typeAnnotation||"coerce");else b=u(b,S,o.typeAnnotation||"assert")}if(!(b instanceof za)&&b.type.kind!=="resolvedImage"&&function N(U){if(U instanceof Ls)return N(U.boundExpression);if(U instanceof qa&&U.name==="error"||U instanceof Bo||U instanceof _s)return!1;var G=U instanceof ho||U instanceof ra,$=!0;return U.eachChild(function(re){$=G?$&&N(re):$&&re instanceof za}),!!$&&oo(U)&&xs(U,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(b)){var k=new na;try{b=new za(b.type,b.evaluate(k))}catch(N){return this.error(N.message),null}}return b}return this.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},zs.prototype.concat=function(t,o,u){var h=typeof t=="number"?this.path.concat(t):this.path,y=u?this.scope.concat(u):this.scope;return new zs(this.registry,h,o||null,y,this.errors)},zs.prototype.error=function(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];var h=""+this.key+o.map(function(y){return"["+y+"]"}).join("");this.errors.push(new dr(h,t))},zs.prototype.checkSubtype=function(t,o){var u=Ct(t,o);return u&&this.error(u),u};var bs=function(t,o,u){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(var h=0,y=u;h<y.length;h+=1){var b=y[h],S=b[1];this.labels.push(b[0]),this.outputs.push(S)}};function ga(t,o,u){return t*(1-u)+o*u}bs.parse=function(t,o){if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");var u=o.parse(t[1],1,Mt);if(!u)return null;var h=[],y=null;o.expectedType&&o.expectedType.kind!=="value"&&(y=o.expectedType);for(var b=1;b<t.length;b+=2){var S=b===1?-1/0:t[b],I=t[b+1],k=b,N=b+1;if(typeof S!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(h.length&&h[h.length-1][0]>=S)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);var U=o.parse(I,N,y);if(!U)return null;y=y||U.type,h.push([S,U])}return new bs(y,u,h)},bs.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var h=this.input.evaluate(t);if(h<=o[0])return u[0].evaluate(t);var y=o.length;return h>=o[y-1]?u[y-1].evaluate(t):u[ou(o,h)].evaluate(t)},bs.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},bs.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},bs.prototype.serialize=function(){for(var t=["step",this.input.serialize()],o=0;o<this.labels.length;o++)o>0&&t.push(this.labels[o]),t.push(this.outputs[o].serialize());return t};var ya=Object.freeze({__proto__:null,number:ga,color:function(t,o,u){return new Bi(ga(t.r,o.r,u),ga(t.g,o.g,u),ga(t.b,o.b,u),ga(t.a,o.a,u))},array:function(t,o,u){return t.map(function(h,y){return ga(h,o[y],u)})}}),us=6/29*3*(6/29),tf=Math.PI/180,Ol=180/Math.PI;function qs(t){return t>.008856451679035631?Math.pow(t,1/3):t/us+4/29}function ic(t){return t>6/29?t*t*t:us*(t-4/29)}function Qu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ks(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function dl(t){var o=Ks(t.r),u=Ks(t.g),h=Ks(t.b),y=qs((.4124564*o+.3575761*u+.1804375*h)/.95047),b=qs((.2126729*o+.7151522*u+.072175*h)/1);return{l:116*b-16,a:500*(y-b),b:200*(b-qs((.0193339*o+.119192*u+.9503041*h)/1.08883)),alpha:t.a}}function _(t){var o=(t.l+16)/116,u=isNaN(t.a)?o:o+t.a/500,h=isNaN(t.b)?o:o-t.b/200;return o=1*ic(o),u=.95047*ic(u),h=1.08883*ic(h),new Bi(Qu(3.2404542*u-1.5371385*o-.4985314*h),Qu(-.969266*u+1.8760108*o+.041556*h),Qu(.0556434*u-.2040259*o+1.0572252*h),t.alpha)}function M(t,o,u){var h=o-t;return t+u*(h>180||h<-180?h-360*Math.round(h/360):h)}var F={forward:dl,reverse:_,interpolate:function(t,o,u){return{l:ga(t.l,o.l,u),a:ga(t.a,o.a,u),b:ga(t.b,o.b,u),alpha:ga(t.alpha,o.alpha,u)}}},R={forward:function(t){var o=dl(t),u=o.l,h=o.a,y=o.b,b=Math.atan2(y,h)*Ol;return{h:b<0?b+360:b,c:Math.sqrt(h*h+y*y),l:u,alpha:t.a}},reverse:function(t){var o=t.h*tf,u=t.c;return _({l:t.l,a:Math.cos(o)*u,b:Math.sin(o)*u,alpha:t.alpha})},interpolate:function(t,o,u){return{h:M(t.h,o.h,u),c:ga(t.c,o.c,u),l:ga(t.l,o.l,u),alpha:ga(t.alpha,o.alpha,u)}}},Y=Object.freeze({__proto__:null,lab:F,hcl:R}),me=function(t,o,u,h,y){this.type=t,this.operator=o,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(var b=0,S=y;b<S.length;b+=1){var I=S[b],k=I[1];this.labels.push(I[0]),this.outputs.push(k)}};function He(t,o,u,h){var y=h-u,b=t-u;return y===0?0:o===1?b/y:(Math.pow(o,b)-1)/(Math.pow(o,y)-1)}me.interpolationFactor=function(t,o,u,h){var y=0;if(t.name==="exponential")y=He(o,t.base,u,h);else if(t.name==="linear")y=He(o,1,u,h);else if(t.name==="cubic-bezier"){var b=t.controlPoints;y=new X(b[0],b[1],b[2],b[3]).solve(He(o,1,u,h))}return y},me.parse=function(t,o){var u=t[0],h=t[1],y=t[2],b=t.slice(3);if(!Array.isArray(h)||h.length===0)return o.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){var S=h[1];if(typeof S!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:S}}else{if(h[0]!=="cubic-bezier")return o.error("Unknown interpolation type "+String(h[0]),1,0);var I=h.slice(1);if(I.length!==4||I.some(function(We){return typeof We!="number"||We<0||We>1}))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:I}}if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(!(y=o.parse(y,2,Mt)))return null;var k=[],N=null;u==="interpolate-hcl"||u==="interpolate-lab"?N=Xr:o.expectedType&&o.expectedType.kind!=="value"&&(N=o.expectedType);for(var U=0;U<b.length;U+=2){var G=b[U],$=b[U+1],re=U+3,Te=U+4;if(typeof G!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',re);if(k.length&&k[k.length-1][0]>=G)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',re);var Ie=o.parse($,Te,N);if(!Ie)return null;N=N||Ie.type,k.push([G,Ie])}return N.kind==="number"||N.kind==="color"||N.kind==="array"&&N.itemType.kind==="number"&&typeof N.N=="number"?new me(N,u,h,y,k):o.error("Type "+_i(N)+" is not interpolatable.")},me.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var h=this.input.evaluate(t);if(h<=o[0])return u[0].evaluate(t);var y=o.length;if(h>=o[y-1])return u[y-1].evaluate(t);var b=ou(o,h),S=me.interpolationFactor(this.interpolation,h,o[b],o[b+1]),I=u[b].evaluate(t),k=u[b+1].evaluate(t);return this.operator==="interpolate"?ya[this.type.kind.toLowerCase()](I,k,S):this.operator==="interpolate-hcl"?R.reverse(R.interpolate(R.forward(I),R.forward(k),S)):F.reverse(F.interpolate(F.forward(I),F.forward(k),S))},me.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},me.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},me.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var o=[this.operator,t,this.input.serialize()],u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o};var ut=function(t,o){this.type=t,this.args=o};ut.parse=function(t,o){if(t.length<2)return o.error("Expectected at least one argument.");var u=null,h=o.expectedType;h&&h.kind!=="value"&&(u=h);for(var y=[],b=0,S=t.slice(1);b<S.length;b+=1){var I=o.parse(S[b],1+y.length,u,void 0,{typeAnnotation:"omit"});if(!I)return null;u=u||I.type,y.push(I)}var k=h&&y.some(function(N){return Ct(h,N.type)});return new ut(k?rn:u,y)},ut.prototype.evaluate=function(t){for(var o,u=null,h=0,y=0,b=this.args;y<b.length&&(h++,(u=b[y].evaluate(t))&&u instanceof ta&&!u.available&&(o||(o=u.name),u=null,h===this.args.length&&(u=o)),u===null);y+=1);return u},ut.prototype.eachChild=function(t){this.args.forEach(t)},ut.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ut.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(o){t.push(o.serialize())}),t};var lt=function(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o};lt.prototype.evaluate=function(t){return this.result.evaluate(t)},lt.prototype.eachChild=function(t){for(var o=0,u=this.bindings;o<u.length;o+=1)t(u[o][1]);t(this.result)},lt.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var u=[],h=1;h<t.length-1;h+=2){var y=t[h];if(typeof y!="string")return o.error("Expected string, but found "+typeof y+" instead.",h);if(/[^a-zA-Z0-9_]/.test(y))return o.error("Variable names must contain only alphanumeric characters or '_'.",h);var b=o.parse(t[h+1],h+1);if(!b)return null;u.push([y,b])}var S=o.parse(t[t.length-1],t.length-1,o.expectedType,u);return S?new lt(u,S):null},lt.prototype.outputDefined=function(){return this.result.outputDefined()},lt.prototype.serialize=function(){for(var t=["let"],o=0,u=this.bindings;o<u.length;o+=1){var h=u[o];t.push(h[0],h[1].serialize())}return t.push(this.result.serialize()),t};var ir=function(t,o,u){this.type=t,this.index=o,this.input=u};ir.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Mt),h=o.parse(t[2],2,Ai(o.expectedType||rn));return u&&h?new ir(h.type.itemType,u,h):null},ir.prototype.evaluate=function(t){var o=this.index.evaluate(t),u=this.input.evaluate(t);if(o<0)throw new Aa("Array index out of bounds: "+o+" < 0.");if(o>=u.length)throw new Aa("Array index out of bounds: "+o+" > "+(u.length-1)+".");if(o!==Math.floor(o))throw new Aa("Array index must be an integer, but found "+o+" instead.");return u[o]},ir.prototype.eachChild=function(t){t(this.index),t(this.input)},ir.prototype.outputDefined=function(){return!1},ir.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var ur=function(t,o){this.type=Ur,this.needle=t,this.haystack=o};ur.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,rn),h=o.parse(t[2],2,rn);return u&&h?Ca(u.type,[Ur,tn,Mt,fn,rn])?new ur(u,h):o.error("Expected first argument to be of type boolean, string, number or null, but found "+_i(u.type)+" instead"):null},ur.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!Ci(o,["boolean","string","number","null"]))throw new Aa("Expected first argument to be of type boolean, string, number or null, but found "+_i($i(o))+" instead.");if(!Ci(u,["string","array"]))throw new Aa("Expected second argument to be of type array or string, but found "+_i($i(u))+" instead.");return u.indexOf(o)>=0},ur.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},ur.prototype.outputDefined=function(){return!0},ur.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Tn=function(t,o,u){this.type=Mt,this.needle=t,this.haystack=o,this.fromIndex=u};Tn.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,rn),h=o.parse(t[2],2,rn);if(!u||!h)return null;if(!Ca(u.type,[Ur,tn,Mt,fn,rn]))return o.error("Expected first argument to be of type boolean, string, number or null, but found "+_i(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,Mt);return y?new Tn(u,h,y):null}return new Tn(u,h)},Tn.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!Ci(o,["boolean","string","number","null"]))throw new Aa("Expected first argument to be of type boolean, string, number or null, but found "+_i($i(o))+" instead.");if(!Ci(u,["string","array"]))throw new Aa("Expected second argument to be of type array or string, but found "+_i($i(u))+" instead.");if(this.fromIndex){var h=this.fromIndex.evaluate(t);return u.indexOf(o,h)}return u.indexOf(o)},Tn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},Tn.prototype.outputDefined=function(){return!1},Tn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var ri=function(t,o,u,h,y,b){this.inputType=t,this.type=o,this.input=u,this.cases=h,this.outputs=y,this.otherwise=b};ri.parse=function(t,o){if(t.length<5)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return o.error("Expected an even number of arguments.");var u,h;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);for(var y={},b=[],S=2;S<t.length-1;S+=2){var I=t[S],k=t[S+1];Array.isArray(I)||(I=[I]);var N=o.concat(S);if(I.length===0)return N.error("Expected at least one branch label.");for(var U=0,G=I;U<G.length;U+=1){var $=G[U];if(typeof $!="number"&&typeof $!="string")return N.error("Branch labels must be numbers or strings.");if(typeof $=="number"&&Math.abs($)>Number.MAX_SAFE_INTEGER)return N.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof $=="number"&&Math.floor($)!==$)return N.error("Numeric branch labels must be integer values.");if(u){if(N.checkSubtype(u,$i($)))return null}else u=$i($);if(y[String($)]!==void 0)return N.error("Branch labels must be unique.");y[String($)]=b.length}var re=o.parse(k,S,h);if(!re)return null;h=h||re.type,b.push(re)}var Te=o.parse(t[1],1,rn);if(!Te)return null;var Ie=o.parse(t[t.length-1],t.length-1,h);return Ie?Te.type.kind!=="value"&&o.concat(1).checkSubtype(u,Te.type)?null:new ri(u,h,Te,y,b,Ie):null},ri.prototype.evaluate=function(t){var o=this.input.evaluate(t);return($i(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)},ri.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},ri.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},ri.prototype.serialize=function(){for(var t=this,o=["match",this.input.serialize()],u=[],h={},y=0,b=Object.keys(this.cases).sort();y<b.length;y+=1){var S=b[y];(G=h[this.cases[S]])===void 0?(h[this.cases[S]]=u.length,u.push([this.cases[S],[S]])):u[G][1].push(S)}for(var I=function(re){return t.inputType.kind==="number"?Number(re):re},k=0,N=u;k<N.length;k+=1){var U=N[k],G=U[0],$=U[1];o.push($.length===1?I($[0]):$.map(I)),o.push(this.outputs[outputIndex$1].serialize())}return o.push(this.otherwise.serialize()),o};var Ln=function(t,o,u){this.type=t,this.branches=o,this.otherwise=u};Ln.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return o.error("Expected an odd number of arguments.");var u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);for(var h=[],y=1;y<t.length-1;y+=2){var b=o.parse(t[y],y,Ur);if(!b)return null;var S=o.parse(t[y+1],y+1,u);if(!S)return null;h.push([b,S]),u=u||S.type}var I=o.parse(t[t.length-1],t.length-1,u);return I?new Ln(u,h,I):null},Ln.prototype.evaluate=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var h=u[o],y=h[1];if(h[0].evaluate(t))return y.evaluate(t)}return this.otherwise.evaluate(t)},Ln.prototype.eachChild=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var h=u[o],y=h[1];t(h[0]),t(y)}t(this.otherwise)},Ln.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},Ln.prototype.serialize=function(){var t=["case"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Vi=function(t,o,u,h){this.type=t,this.input=o,this.beginIndex=u,this.endIndex=h};function pa(t,o){return t==="=="||t==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function Ea(t,o,u,h){return h.compare(o,u)===0}function Zi(t,o,u){var h=t!=="=="&&t!=="!=";return function(){function y(b,S,I){this.type=Ur,this.lhs=b,this.rhs=S,this.collator=I,this.hasUntypedArgument=b.type.kind==="value"||S.type.kind==="value"}return y.parse=function(b,S){if(b.length!==3&&b.length!==4)return S.error("Expected two or three arguments.");var I=b[0],k=S.parse(b[1],1,rn);if(!k)return null;if(!pa(I,k.type))return S.concat(1).error('"'+I+`" comparisons are not supported for type '`+_i(k.type)+"'.");var N=S.parse(b[2],2,rn);if(!N)return null;if(!pa(I,N.type))return S.concat(2).error('"'+I+`" comparisons are not supported for type '`+_i(N.type)+"'.");if(k.type.kind!==N.type.kind&&k.type.kind!=="value"&&N.type.kind!=="value")return S.error("Cannot compare types '"+_i(k.type)+"' and '"+_i(N.type)+"'.");h&&(k.type.kind==="value"&&N.type.kind!=="value"?k=new ra(N.type,[k]):k.type.kind!=="value"&&N.type.kind==="value"&&(N=new ra(k.type,[N])));var U=null;if(b.length===4){if(k.type.kind!=="string"&&N.type.kind!=="string"&&k.type.kind!=="value"&&N.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(U=S.parse(b[3],3,nn)))return null}return new y(k,N,U)},y.prototype.evaluate=function(b){var S=this.lhs.evaluate(b),I=this.rhs.evaluate(b);if(h&&this.hasUntypedArgument){var k=$i(S),N=$i(I);if(k.kind!==N.kind||k.kind!=="string"&&k.kind!=="number")throw new Aa('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+k.kind+", "+N.kind+") instead.")}if(this.collator&&!h&&this.hasUntypedArgument){var U=$i(S),G=$i(I);if(U.kind!=="string"||G.kind!=="string")return o(b,S,I)}return this.collator?u(b,S,I,this.collator.evaluate(b)):o(b,S,I)},y.prototype.eachChild=function(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)},y.prototype.outputDefined=function(){return!0},y.prototype.serialize=function(){var b=[t];return this.eachChild(function(S){b.push(S.serialize())}),b},y}()}Vi.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,rn),h=o.parse(t[2],2,Mt);if(!u||!h)return null;if(!Ca(u.type,[Ai(rn),tn,rn]))return o.error("Expected first argument to be of type array or string, but found "+_i(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,Mt);return y?new Vi(u.type,u,h,y):null}return new Vi(u.type,u,h)},Vi.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!Ci(o,["string","array"]))throw new Aa("Expected first argument to be of type array or string, but found "+_i($i(o))+" instead.");if(this.endIndex){var h=this.endIndex.evaluate(t);return o.slice(u,h)}return o.slice(u)},Vi.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},Vi.prototype.outputDefined=function(){return!1},Vi.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Es=Zi("==",function(t,o,u){return o===u},Ea),su=Zi("!=",function(t,o,u){return o!==u},function(t,o,u,h){return!Ea(0,o,u,h)}),Ju=Zi("<",function(t,o,u){return o<u},function(t,o,u,h){return h.compare(o,u)<0}),rf=Zi(">",function(t,o,u){return o>u},function(t,o,u,h){return h.compare(o,u)>0}),vl=Zi("<=",function(t,o,u){return o<=u},function(t,o,u,h){return h.compare(o,u)<=0}),Pc=Zi(">=",function(t,o,u){return o>=u},function(t,o,u,h){return h.compare(o,u)>=0}),Nu=function(t,o,u,h,y){this.type=tn,this.number=t,this.locale=o,this.currency=u,this.minFractionDigits=h,this.maxFractionDigits=y};Nu.parse=function(t,o){if(t.length!==3)return o.error("Expected two arguments.");var u=o.parse(t[1],1,Mt);if(!u)return null;var h=t[2];if(typeof h!="object"||Array.isArray(h))return o.error("NumberFormat options argument must be an object.");var y=null;if(h.locale&&!(y=o.parse(h.locale,1,tn)))return null;var b=null;if(h.currency&&!(b=o.parse(h.currency,1,tn)))return null;var S=null;if(h["min-fraction-digits"]&&!(S=o.parse(h["min-fraction-digits"],1,Mt)))return null;var I=null;return h["max-fraction-digits"]&&!(I=o.parse(h["max-fraction-digits"],1,Mt))?null:new Nu(u,y,b,S,I)},Nu.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Nu.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Nu.prototype.outputDefined=function(){return!1},Nu.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var zu=function(t){this.type=Mt,this.input=t};zu.parse=function(t,o){if(t.length!==2)return o.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error("Expected argument of type string or array, but found "+_i(u.type)+" instead."):new zu(u):null},zu.prototype.evaluate=function(t){var o=this.input.evaluate(t);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Aa("Expected value to be of type string or array, but found "+_i($i(o))+" instead.")},zu.prototype.eachChild=function(t){t(this.input)},zu.prototype.outputDefined=function(){return!1},zu.prototype.serialize=function(){var t=["length"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Uu={"==":Es,"!=":su,">":rf,"<":Ju,">=":Pc,"<=":vl,array:ra,at:ir,boolean:ra,case:Ln,coalesce:ut,collator:Bo,format:Po,image:Wo,in:ur,"index-of":Tn,interpolate:me,"interpolate-hcl":me,"interpolate-lab":me,length:zu,let:lt,literal:za,match:ri,number:ra,"number-format":Nu,object:ra,slice:Vi,step:bs,string:ra,"to-boolean":ho,"to-color":ho,"to-number":ho,"to-string":ho,var:Ls,within:_s};function so(t,o){var u=o[0],h=o[1],y=o[2],b=o[3];u=u.evaluate(t),h=h.evaluate(t),y=y.evaluate(t);var S=b?b.evaluate(t):1,I=ae(u,h,y,S);if(I)throw new Aa(I);return new Bi(u/255*S,h/255*S,y/255*S,S)}function jf(t,o){return t in o}function Vf(t,o){var u=o[t];return u===void 0?null:u}function ts(t){return{type:t}}function Ic(t){return{result:"success",value:t}}function Zu(t){return{result:"error",value:t}}function uu(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function nf(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Rl(t){return!!t.expression&&t.expression.interpolated}function Li(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Ll(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Sp(t){return t}function ml(t,o,u){return t!==void 0?t:o!==void 0?o:u!==void 0?u:void 0}function Oc(t,o,u,h,y){return ml(typeof u===y?h[u]:void 0,t.default,o.default)}function Gf(t,o,u){if(Li(u)!=="number")return ml(t.default,o.default);var h=t.stops.length;if(h===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[h-1][0])return t.stops[h-1][1];var y=ou(t.stops.map(function(b){return b[0]}),u);return t.stops[y][1]}function Cp(t,o,u){var h=t.base!==void 0?t.base:1;if(Li(u)!=="number")return ml(t.default,o.default);var y=t.stops.length;if(y===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[y-1][0])return t.stops[y-1][1];var b=ou(t.stops.map(function(G){return G[0]}),u),S=function(G,$,re,Te){var Ie=Te-re,We=G-re;return Ie===0?0:$===1?We/Ie:(Math.pow($,We)-1)/(Math.pow($,Ie)-1)}(u,h,t.stops[b][0],t.stops[b+1][0]),I=t.stops[b][1],k=t.stops[b+1][1],N=ya[o.type]||Sp;if(t.colorSpace&&t.colorSpace!=="rgb"){var U=Y[t.colorSpace];N=function(G,$){return U.reverse(U.interpolate(U.forward(G),U.forward($),S))}}return typeof I.evaluate=="function"?{evaluate:function(){for(var G=[],$=arguments.length;$--;)G[$]=arguments[$];var re=I.evaluate.apply(void 0,G),Te=k.evaluate.apply(void 0,G);if(re!==void 0&&Te!==void 0)return N(re,Te,S)}}:N(I,k,S)}function Hf(t,o,u){return o.type==="color"?u=Bi.parse(u):o.type==="formatted"?u=pt.fromString(u.toString()):o.type==="resolvedImage"?u=ta.fromString(u.toString()):Li(u)===o.type||o.type==="enum"&&o.values[u]||(u=void 0),ml(u,t.default,o.default)}qa.register(Uu,{error:[{kind:"error"},[tn],function(t,o){throw new Aa(o[0].evaluate(t))}],typeof:[tn,[rn],function(t,o){return _i($i(o[0].evaluate(t)))}],"to-rgba":[Ai(Mt,4),[Xr],function(t,o){return o[0].evaluate(t).toArray()}],rgb:[Xr,[Mt,Mt,Mt],so],rgba:[Xr,[Mt,Mt,Mt,Mt],so],has:{type:Ur,overloads:[[[tn],function(t,o){return jf(o[0].evaluate(t),t.properties())}],[[tn,vi],function(t,o){var u=o[1];return jf(o[0].evaluate(t),u.evaluate(t))}]]},get:{type:rn,overloads:[[[tn],function(t,o){return Vf(o[0].evaluate(t),t.properties())}],[[tn,vi],function(t,o){var u=o[1];return Vf(o[0].evaluate(t),u.evaluate(t))}]]},"feature-state":[rn,[tn],function(t,o){return Vf(o[0].evaluate(t),t.featureState||{})}],properties:[vi,[],function(t){return t.properties()}],"geometry-type":[tn,[],function(t){return t.geometryType()}],id:[rn,[],function(t){return t.id()}],zoom:[Mt,[],function(t){return t.globals.zoom}],"heatmap-density":[Mt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Mt,[],function(t){return t.globals.lineProgress||0}],accumulated:[rn,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[Mt,ts(Mt),function(t,o){for(var u=0,h=0,y=o;h<y.length;h+=1)u+=y[h].evaluate(t);return u}],"*":[Mt,ts(Mt),function(t,o){for(var u=1,h=0,y=o;h<y.length;h+=1)u*=y[h].evaluate(t);return u}],"-":{type:Mt,overloads:[[[Mt,Mt],function(t,o){var u=o[1];return o[0].evaluate(t)-u.evaluate(t)}],[[Mt],function(t,o){return-o[0].evaluate(t)}]]},"/":[Mt,[Mt,Mt],function(t,o){var u=o[1];return o[0].evaluate(t)/u.evaluate(t)}],"%":[Mt,[Mt,Mt],function(t,o){var u=o[1];return o[0].evaluate(t)%u.evaluate(t)}],ln2:[Mt,[],function(){return Math.LN2}],pi:[Mt,[],function(){return Math.PI}],e:[Mt,[],function(){return Math.E}],"^":[Mt,[Mt,Mt],function(t,o){var u=o[1];return Math.pow(o[0].evaluate(t),u.evaluate(t))}],sqrt:[Mt,[Mt],function(t,o){return Math.sqrt(o[0].evaluate(t))}],log10:[Mt,[Mt],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN10}],ln:[Mt,[Mt],function(t,o){return Math.log(o[0].evaluate(t))}],log2:[Mt,[Mt],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN2}],sin:[Mt,[Mt],function(t,o){return Math.sin(o[0].evaluate(t))}],cos:[Mt,[Mt],function(t,o){return Math.cos(o[0].evaluate(t))}],tan:[Mt,[Mt],function(t,o){return Math.tan(o[0].evaluate(t))}],asin:[Mt,[Mt],function(t,o){return Math.asin(o[0].evaluate(t))}],acos:[Mt,[Mt],function(t,o){return Math.acos(o[0].evaluate(t))}],atan:[Mt,[Mt],function(t,o){return Math.atan(o[0].evaluate(t))}],min:[Mt,ts(Mt),function(t,o){return Math.min.apply(Math,o.map(function(u){return u.evaluate(t)}))}],max:[Mt,ts(Mt),function(t,o){return Math.max.apply(Math,o.map(function(u){return u.evaluate(t)}))}],abs:[Mt,[Mt],function(t,o){return Math.abs(o[0].evaluate(t))}],round:[Mt,[Mt],function(t,o){var u=o[0].evaluate(t);return u<0?-Math.round(-u):Math.round(u)}],floor:[Mt,[Mt],function(t,o){return Math.floor(o[0].evaluate(t))}],ceil:[Mt,[Mt],function(t,o){return Math.ceil(o[0].evaluate(t))}],"filter-==":[Ur,[tn,rn],function(t,o){var u=o[0],h=o[1];return t.properties()[u.value]===h.value}],"filter-id-==":[Ur,[rn],function(t,o){var u=o[0];return t.id()===u.value}],"filter-type-==":[Ur,[tn],function(t,o){var u=o[0];return t.geometryType()===u.value}],"filter-<":[Ur,[tn,rn],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y<b}],"filter-id-<":[Ur,[rn],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h<y}],"filter->":[Ur,[tn,rn],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y>b}],"filter-id->":[Ur,[rn],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h>y}],"filter-<=":[Ur,[tn,rn],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y<=b}],"filter-id-<=":[Ur,[rn],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h<=y}],"filter->=":[Ur,[tn,rn],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y>=b}],"filter-id->=":[Ur,[rn],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h>=y}],"filter-has":[Ur,[rn],function(t,o){return o[0].value in t.properties()}],"filter-has-id":[Ur,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[Ur,[Ai(tn)],function(t,o){return o[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Ur,[Ai(rn)],function(t,o){return o[0].value.indexOf(t.id())>=0}],"filter-in-small":[Ur,[tn,Ai(rn)],function(t,o){var u=o[0];return o[1].value.indexOf(t.properties()[u.value])>=0}],"filter-in-large":[Ur,[tn,Ai(rn)],function(t,o){var u=o[0],h=o[1];return function(y,b,S,I){for(;S<=I;){var k=S+I>>1;if(b[k]===y)return!0;b[k]>y?I=k-1:S=k+1}return!1}(t.properties()[u.value],h.value,0,h.value.length-1)}],all:{type:Ur,overloads:[[[Ur,Ur],function(t,o){var u=o[1];return o[0].evaluate(t)&&u.evaluate(t)}],[ts(Ur),function(t,o){for(var u=0,h=o;u<h.length;u+=1)if(!h[u].evaluate(t))return!1;return!0}]]},any:{type:Ur,overloads:[[[Ur,Ur],function(t,o){var u=o[1];return o[0].evaluate(t)||u.evaluate(t)}],[ts(Ur),function(t,o){for(var u=0,h=o;u<h.length;u+=1)if(h[u].evaluate(t))return!0;return!1}]]},"!":[Ur,[Ur],function(t,o){return!o[0].evaluate(t)}],"is-supported-script":[Ur,[tn],function(t,o){var u=t.globals&&t.globals.isSupportedScript;return!u||u(o[0].evaluate(t))}],upcase:[tn,[tn],function(t,o){return o[0].evaluate(t).toUpperCase()}],downcase:[tn,[tn],function(t,o){return o[0].evaluate(t).toLowerCase()}],concat:[tn,ts(rn),function(t,o){return o.map(function(u){return Eu(u.evaluate(t))}).join("")}],"resolved-locale":[tn,[nn],function(t,o){return o[0].evaluate(t).resolvedLocale()}]});var Rc=function(t,o){this.expression=t,this._warningHistory={},this._evaluator=new na,this._defaultValue=o?function(u){return u.type==="color"&&Ll(u.default)?new Bi(0,0,0,0):u.type==="color"?Bi.parse(u.default)||null:u.default===void 0?null:u.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null};function ac(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Uu}function oc(t,o){var u=new zs(Uu,[],o?function(y){var b={color:Xr,string:tn,number:Mt,enum:tn,boolean:Ur,formatted:ji,resolvedImage:fi};return y.type==="array"?Ai(b[y.value]||rn,y.length):b[y.type]}(o):void 0),h=u.parse(t,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Ic(new Rc(h,o)):Zu(u.errors)}Rc.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,y,b){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=h,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)},Rc.prototype.evaluate=function(t,o,u,h,y,b){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Aa("Expected value to be one of "+Object.keys(this._enumValues).map(function(I){return JSON.stringify(I)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console!="undefined"&&console.warn(I.message)),this._defaultValue}};var kl=function(t,o){this.kind=t,this._styleExpression=o,this.isStateDependent=t!=="constant"&&!Io(o.expression)};kl.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,h,y,b)},kl.prototype.evaluate=function(t,o,u,h,y,b){return this._styleExpression.evaluate(t,o,u,h,y,b)};var gl=function(t,o,u,h){this.kind=t,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!Io(o.expression),this.interpolationType=h};function Dl(t,o){if((t=oc(t,o)).result==="error")return t;var u=t.value.expression,h=oo(u);if(!h&&!uu(o))return Zu([new dr("","data expressions not supported")]);var y=xs(u,["zoom"]);if(!y&&!nf(o))return Zu([new dr("","zoom expressions not supported")]);var b=function S(I){var k=null;if(I instanceof lt)k=S(I.result);else if(I instanceof ut)for(var N=0,U=I.args;N<U.length&&!(k=S(U[N]));N+=1);else(I instanceof bs||I instanceof me)&&I.input instanceof qa&&I.input.name==="zoom"&&(k=I);return k instanceof dr||I.eachChild(function(G){var $=S(G);$ instanceof dr?k=$:!k&&$?k=new dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):k&&$&&k!==$&&(k=new dr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),k}(u);return b||y?b instanceof dr?Zu([b]):b instanceof me&&!Rl(o)?Zu([new dr("",'"interpolate" expressions cannot be used with this property')]):Ic(b?new gl(h?"camera":"composite",t.value,b.labels,b instanceof me?b.interpolation:void 0):new kl(h?"constant":"source",t.value)):Zu([new dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}gl.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,h,y,b)},gl.prototype.evaluate=function(t,o,u,h,y,b){return this._styleExpression.evaluate(t,o,u,h,y,b)},gl.prototype.interpolationFactor=function(t,o,u){return this.interpolationType?me.interpolationFactor(this.interpolationType,t,o,u):0};var el=function(t,o){this._parameters=t,this._specification=o,hr(this,function u(h,y){var b,S,I,k=y.type==="color",N=h.stops&&typeof h.stops[0][0]=="object",U=N||!(N||h.property!==void 0),G=h.type||(Rl(y)?"exponential":"interval");if(k&&((h=hr({},h)).stops&&(h.stops=h.stops.map(function(pn){return[pn[0],Bi.parse(pn[1])]})),h.default=Bi.parse(h.default?h.default:y.default)),h.colorSpace&&h.colorSpace!=="rgb"&&!Y[h.colorSpace])throw new Error("Unknown color space: "+h.colorSpace);if(G==="exponential")b=Cp;else if(G==="interval")b=Gf;else if(G==="categorical"){b=Oc,S=Object.create(null);for(var $=0,re=h.stops;$<re.length;$+=1){var Te=re[$];S[Te[0]]=Te[1]}I=typeof h.stops[0][0]}else{if(G!=="identity")throw new Error('Unknown function type "'+G+'"');b=Hf}if(N){for(var Ie={},We=[],ze=0;ze<h.stops.length;ze++){var it=h.stops[ze],Et=it[0].zoom;Ie[Et]===void 0&&(Ie[Et]={zoom:Et,type:h.type,property:h.property,default:h.default,stops:[]},We.push(Et)),Ie[Et].stops.push([it[0].value,it[1]])}for(var Ut=[],Gt=0,or=We;Gt<or.length;Gt+=1){var Ir=or[Gt];Ut.push([Ie[Ir].zoom,u(Ie[Ir],y)])}var Qr={name:"linear"};return{kind:"composite",interpolationType:Qr,interpolationFactor:me.interpolationFactor.bind(void 0,Qr),zoomStops:Ut.map(function(pn){return pn[0]}),evaluate:function(pn,zn){var hn=pn.zoom;return Cp({stops:Ut,base:h.base},y,hn).evaluate(hn,zn)}}}if(U){var kn=G==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:kn,interpolationFactor:me.interpolationFactor.bind(void 0,kn),zoomStops:h.stops.map(function(pn){return pn[0]}),evaluate:function(pn){return b(h,y,pn.zoom,S,I)}}}return{kind:"source",evaluate:function(pn,zn){var hn=zn&&zn.properties?zn.properties[h.property]:void 0;return hn===void 0?ml(h.default,y.default):b(h,y,hn,S,I)}}}(this._parameters,this._specification))};function $s(t){var o=t.key,u=t.value,h=t.valueSpec||{},y=t.objectElementValidators||{},b=t.style,S=t.styleSpec,I=[],k=Li(u);if(k!=="object")return[new Le(o,u,"object expected, "+k+" found")];for(var N in u){var U=N.split(".")[0],G=h[U]||h["*"],$=void 0;if(y[U])$=y[U];else if(h[U])$=Gi;else if(y["*"])$=y["*"];else{if(!h["*"]){I.push(new Le(o,u[N],'unknown property "'+N+'"'));continue}$=Gi}I=I.concat($({key:(o&&o+".")+N,value:u[N],valueSpec:G,style:b,styleSpec:S,object:u,objectKey:N},u))}for(var re in h)y[re]||h[re].required&&h[re].default===void 0&&u[re]===void 0&&I.push(new Le(o,u,'missing required property "'+re+'"'));return I}function af(t){var o=t.value,u=t.valueSpec,h=t.style,y=t.styleSpec,b=t.key,S=t.arrayElementValidator||Gi;if(Li(o)!=="array")return[new Le(b,o,"array expected, "+Li(o)+" found")];if(u.length&&o.length!==u.length)return[new Le(b,o,"array length "+u.length+" expected, length "+o.length+" found")];if(u["min-length"]&&o.length<u["min-length"])return[new Le(b,o,"array length at least "+u["min-length"]+" expected, length "+o.length+" found")];var I={type:u.value,values:u.values};y.$version<7&&(I.function=u.function),Li(u.value)==="object"&&(I=u.value);for(var k=[],N=0;N<o.length;N++)k=k.concat(S({array:o,arrayIndex:N,value:o[N],valueSpec:I,style:h,styleSpec:y,key:b+"["+N+"]"}));return k}function of(t){var o=t.key,u=t.value,h=t.valueSpec,y=Li(u);return y==="number"&&u!=u&&(y="NaN"),y!=="number"?[new Le(o,u,"number expected, "+y+" found")]:"minimum"in h&&u<h.minimum?[new Le(o,u,u+" is less than the minimum value "+h.minimum)]:"maximum"in h&&u>h.maximum?[new Le(o,u,u+" is greater than the maximum value "+h.maximum)]:[]}function Wf(t){var o,u,h,y=t.valueSpec,b=Ot(t.value.type),S={},I=b!=="categorical"&&t.value.property===void 0,k=!I,N=Li(t.value.stops)==="array"&&Li(t.value.stops[0])==="array"&&Li(t.value.stops[0][0])==="object",U=$s({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(re){if(b==="identity")return[new Le(re.key,re.value,'identity function may not have a "stops" property')];var Te=[],Ie=re.value;return Te=Te.concat(af({key:re.key,value:Ie,valueSpec:re.valueSpec,style:re.style,styleSpec:re.styleSpec,arrayElementValidator:G})),Li(Ie)==="array"&&Ie.length===0&&Te.push(new Le(re.key,Ie,"array must have at least one stop")),Te},default:function(re){return Gi({key:re.key,value:re.value,valueSpec:y,style:re.style,styleSpec:re.styleSpec})}}});return b==="identity"&&I&&U.push(new Le(t.key,t.value,'missing required property "property"')),b==="identity"||t.value.stops||U.push(new Le(t.key,t.value,'missing required property "stops"')),b==="exponential"&&t.valueSpec.expression&&!Rl(t.valueSpec)&&U.push(new Le(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(k&&!uu(t.valueSpec)?U.push(new Le(t.key,t.value,"property functions not supported")):I&&!nf(t.valueSpec)&&U.push(new Le(t.key,t.value,"zoom functions not supported"))),b!=="categorical"&&!N||t.value.property!==void 0||U.push(new Le(t.key,t.value,'"property" property is required')),U;function G(re){var Te=[],Ie=re.value,We=re.key;if(Li(Ie)!=="array")return[new Le(We,Ie,"array expected, "+Li(Ie)+" found")];if(Ie.length!==2)return[new Le(We,Ie,"array length 2 expected, length "+Ie.length+" found")];if(N){if(Li(Ie[0])!=="object")return[new Le(We,Ie,"object expected, "+Li(Ie[0])+" found")];if(Ie[0].zoom===void 0)return[new Le(We,Ie,"object stop key must have zoom")];if(Ie[0].value===void 0)return[new Le(We,Ie,"object stop key must have value")];if(h&&h>Ot(Ie[0].zoom))return[new Le(We,Ie[0].zoom,"stop zoom values must appear in ascending order")];Ot(Ie[0].zoom)!==h&&(h=Ot(Ie[0].zoom),u=void 0,S={}),Te=Te.concat($s({key:We+"[0]",value:Ie[0],valueSpec:{zoom:{}},style:re.style,styleSpec:re.styleSpec,objectElementValidators:{zoom:of,value:$}}))}else Te=Te.concat($({key:We+"[0]",value:Ie[0],valueSpec:{},style:re.style,styleSpec:re.styleSpec},Ie));return ac(kt(Ie[1]))?Te.concat([new Le(We+"[1]",Ie[1],"expressions are not allowed in function stops.")]):Te.concat(Gi({key:We+"[1]",value:Ie[1],valueSpec:y,style:re.style,styleSpec:re.styleSpec}))}function $(re,Te){var Ie=Li(re.value),We=Ot(re.value),ze=re.value!==null?re.value:Te;if(o){if(Ie!==o)return[new Le(re.key,ze,Ie+" stop domain type must match previous stop domain type "+o)]}else o=Ie;if(Ie!=="number"&&Ie!=="string"&&Ie!=="boolean")return[new Le(re.key,ze,"stop domain value must be a number, string, or boolean")];if(Ie!=="number"&&b!=="categorical"){var it="number expected, "+Ie+" found";return uu(y)&&b===void 0&&(it+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Le(re.key,ze,it)]}return b!=="categorical"||Ie!=="number"||isFinite(We)&&Math.floor(We)===We?b!=="categorical"&&Ie==="number"&&u!==void 0&&We<u?[new Le(re.key,ze,"stop domain values must appear in ascending order")]:(u=We,b==="categorical"&&We in S?[new Le(re.key,ze,"stop domain values must be unique")]:(S[We]=!0,[])):[new Le(re.key,ze,"integer expected, found "+We)]}}function lu(t){var o=(t.expressionContext==="property"?Dl:oc)(kt(t.value),t.valueSpec);if(o.result==="error")return o.value.map(function(h){return new Le(""+t.key+h.key,t.value,h.message)});var u=o.value.expression||o.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!u.outputDefined())return[new Le(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Io(u))return[new Le(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!Io(u))return[new Le(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!xs(u,["zoom","feature-state"]))return[new Le(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!oo(u))return[new Le(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function sc(t){var o=t.key,u=t.value,h=t.valueSpec,y=[];return Array.isArray(h.values)?h.values.indexOf(Ot(u))===-1&&y.push(new Le(o,u,"expected one of ["+h.values.join(", ")+"], "+JSON.stringify(u)+" found")):Object.keys(h.values).indexOf(Ot(u))===-1&&y.push(new Le(o,u,"expected one of ["+Object.keys(h.values).join(", ")+"], "+JSON.stringify(u)+" found")),y}function Lc(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var o=0,u=t.slice(1);o<u.length;o+=1){var h=u[o];if(!Lc(h)&&typeof h!="boolean")return!1}return!0;default:return!0}}el.deserialize=function(t){return new el(t._parameters,t._specification)},el.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var sf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Fl(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};Lc(t)||(t=uf(t));var o=oc(t,sf);if(o.result==="error")throw new Error(o.value.map(function(u){return u.key+": "+u.message}).join(", "));return{filter:function(u,h,y){return o.value.evaluate(u,h,{},y)},needGeometry:function u(h){if(!Array.isArray(h))return!1;if(h[0]==="within")return!0;for(var y=1;y<h.length;y++)if(u(h[y]))return!0;return!1}(t)}}function rh(t,o){return t<o?-1:t>o?1:0}function uf(t){if(!t)return!0;var o,u=t[0];return t.length<=1?u!=="any":u==="=="?Bl(t[1],t[2],"=="):u==="!="?Nl(Bl(t[1],t[2],"==")):u==="<"||u===">"||u==="<="||u===">="?Bl(t[1],t[2],u):u==="any"?(o=t.slice(1),["any"].concat(o.map(uf))):u==="all"?["all"].concat(t.slice(1).map(uf)):u==="none"?["all"].concat(t.slice(1).map(uf).map(Nl)):u==="in"?lf(t[1],t.slice(2)):u==="!in"?Nl(lf(t[1],t.slice(2))):u==="has"?cf(t[1]):u==="!has"?Nl(cf(t[1])):u!=="within"||t}function Bl(t,o,u){switch(t){case"$type":return["filter-type-"+u,o];case"$id":return["filter-id-"+u,o];default:return["filter-"+u,t,o]}}function lf(t,o){if(o.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(function(u){return typeof u!=typeof o[0]})?["filter-in-large",t,["literal",o.sort(rh)]]:["filter-in-small",t,["literal",o]]}}function cf(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Nl(t){return["!",t]}function kc(t){return Lc(kt(t.value))?lu(hr({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function o(u){var h=u.value,y=u.key;if(Li(h)!=="array")return[new Le(y,h,"array expected, "+Li(h)+" found")];var b,S=u.styleSpec,I=[];if(h.length<1)return[new Le(y,h,"filter array must have at least 1 element")];switch(I=I.concat(sc({key:y+"[0]",value:h[0],valueSpec:S.filter_operator,style:u.style,styleSpec:u.styleSpec})),Ot(h[0])){case"<":case"<=":case">":case">=":h.length>=2&&Ot(h[1])==="$type"&&I.push(new Le(y,h,'"$type" cannot be use with operator "'+h[0]+'"'));case"==":case"!=":h.length!==3&&I.push(new Le(y,h,'filter array for operator "'+h[0]+'" must have 3 elements'));case"in":case"!in":h.length>=2&&(b=Li(h[1]))!=="string"&&I.push(new Le(y+"[1]",h[1],"string expected, "+b+" found"));for(var k=2;k<h.length;k++)b=Li(h[k]),Ot(h[1])==="$type"?I=I.concat(sc({key:y+"["+k+"]",value:h[k],valueSpec:S.geometry_type,style:u.style,styleSpec:u.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&I.push(new Le(y+"["+k+"]",h[k],"string, number, or boolean expected, "+b+" found"));break;case"any":case"all":case"none":for(var N=1;N<h.length;N++)I=I.concat(o({key:y+"["+N+"]",value:h[N],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":b=Li(h[1]),h.length!==2?I.push(new Le(y,h,'filter array for "'+h[0]+'" operator must have 2 elements')):b!=="string"&&I.push(new Le(y+"[1]",h[1],"string expected, "+b+" found"));break;case"within":b=Li(h[1]),h.length!==2?I.push(new Le(y,h,'filter array for "'+h[0]+'" operator must have 2 elements')):b!=="object"&&I.push(new Le(y+"[1]",h[1],"object expected, "+b+" found"))}return I}(t)}function Ap(t,o){var u=t.key,h=t.style,y=t.styleSpec,b=t.value,S=t.objectKey,I=y[o+"_"+t.layerType];if(!I)return[];var k=S.match(/^(.*)-transition$/);if(o==="paint"&&k&&I[k[1]]&&I[k[1]].transition)return Gi({key:u,value:b,valueSpec:y.transition,style:h,styleSpec:y});var N,U=t.valueSpec||I[S];if(!U)return[new Le(u,b,'unknown property "'+S+'"')];if(Li(b)==="string"&&uu(U)&&!U.tokens&&(N=/^{([^}]+)}$/.exec(b)))return[new Le(u,b,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(N[1])+" }`.")];var G=[];return t.layerType==="symbol"&&(S==="text-field"&&h&&!h.glyphs&&G.push(new Le(u,b,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&Ll(kt(b))&&Ot(b.type)==="identity"&&G.push(new Le(u,b,'"text-font" does not support identity functions'))),G.concat(Gi({key:t.key,value:b,valueSpec:U,style:h,styleSpec:y,expressionContext:"property",propertyType:o,propertyKey:S}))}function wp(t){return Ap(t,"paint")}function uc(t){return Ap(t,"layout")}function Tp(t){var o=[],u=t.value,h=t.key,y=t.style,b=t.styleSpec;u.type||u.ref||o.push(new Le(h,u,'either "type" or "ref" is required'));var S,I=Ot(u.type),k=Ot(u.ref);if(u.id)for(var N=Ot(u.id),U=0;U<t.arrayIndex;U++){var G=y.layers[U];Ot(G.id)===N&&o.push(new Le(h,u.id,'duplicate layer id "'+u.id+'", previously used at line '+G.id.__line__))}if("ref"in u)["type","source","source-layer","filter","layout"].forEach(function(Te){Te in u&&o.push(new Le(h,u[Te],'"'+Te+'" is prohibited for ref layers'))}),y.layers.forEach(function(Te){Ot(Te.id)===k&&(S=Te)}),S?S.ref?o.push(new Le(h,u.ref,"ref cannot reference another ref layer")):I=Ot(S.type):o.push(new Le(h,u.ref,'ref layer "'+k+'" not found'));else if(I!=="background")if(u.source){var $=y.sources&&y.sources[u.source],re=$&&Ot($.type);$?re==="vector"&&I==="raster"?o.push(new Le(h,u.source,'layer "'+u.id+'" requires a raster source')):re==="raster"&&I!=="raster"?o.push(new Le(h,u.source,'layer "'+u.id+'" requires a vector source')):re!=="vector"||u["source-layer"]?re==="raster-dem"&&I!=="hillshade"?o.push(new Le(h,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):I!=="line"||!u.paint||!u.paint["line-gradient"]||re==="geojson"&&$.lineMetrics||o.push(new Le(h,u,'layer "'+u.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):o.push(new Le(h,u,'layer "'+u.id+'" must specify a "source-layer"')):o.push(new Le(h,u.source,'source "'+u.source+'" not found'))}else o.push(new Le(h,u,'missing required property "source"'));return o=o.concat($s({key:h,value:u,valueSpec:b.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Gi({key:h+".type",value:u.type,valueSpec:b.layer.type,style:t.style,styleSpec:t.styleSpec,object:u,objectKey:"type"})},filter:kc,layout:function(Te){return $s({layer:u,key:Te.key,value:Te.value,style:Te.style,styleSpec:Te.styleSpec,objectElementValidators:{"*":function(Ie){return uc(hr({layerType:I},Ie))}}})},paint:function(Te){return $s({layer:u,key:Te.key,value:Te.value,style:Te.style,styleSpec:Te.styleSpec,objectElementValidators:{"*":function(Ie){return wp(hr({layerType:I},Ie))}}})}}}))}function zl(t){var o=t.value,u=t.key,h=Li(o);return h!=="string"?[new Le(u,o,"string expected, "+h+" found")]:[]}var qi={promoteId:function(t){var o=t.key,u=t.value;if(Li(u)==="string")return zl({key:o,value:u});var h=[];for(var y in u)h.push.apply(h,zl({key:o+"."+y,value:u[y]}));return h}};function lc(t){var o=t.value,u=t.key,h=t.styleSpec,y=t.style;if(!o.type)return[new Le(u,o,'"type" is required')];var b,S=Ot(o.type);switch(S){case"vector":case"raster":case"raster-dem":return $s({key:u,value:o,valueSpec:h["source_"+S.replace("-","_")],style:t.style,styleSpec:h,objectElementValidators:qi});case"geojson":if(b=$s({key:u,value:o,valueSpec:h.source_geojson,style:y,styleSpec:h,objectElementValidators:qi}),o.cluster)for(var I in o.clusterProperties){var k=o.clusterProperties[I],N=k[0],U=typeof N=="string"?[N,["accumulated"],["get",I]]:N;b.push.apply(b,lu({key:u+"."+I+".map",value:k[1],expressionContext:"cluster-map"})),b.push.apply(b,lu({key:u+"."+I+".reduce",value:U,expressionContext:"cluster-reduce"}))}return b;case"video":return $s({key:u,value:o,valueSpec:h.source_video,style:y,styleSpec:h});case"image":return $s({key:u,value:o,valueSpec:h.source_image,style:y,styleSpec:h});case"canvas":return[new Le(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return sc({key:u+".type",value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:y,styleSpec:h})}}function oa(t){var o=t.value,u=t.styleSpec,h=u.light,y=t.style,b=[],S=Li(o);if(o===void 0)return b;if(S!=="object")return b.concat([new Le("light",o,"object expected, "+S+" found")]);for(var I in o){var k=I.match(/^(.*)-transition$/);b=b.concat(k&&h[k[1]]&&h[k[1]].transition?Gi({key:I,value:o[I],valueSpec:u.transition,style:y,styleSpec:u}):h[I]?Gi({key:I,value:o[I],valueSpec:h[I],style:y,styleSpec:u}):[new Le(I,o[I],'unknown property "'+I+'"')])}return b}var ju={"*":function(){return[]},array:af,boolean:function(t){var o=t.value,u=t.key,h=Li(o);return h!=="boolean"?[new Le(u,o,"boolean expected, "+h+" found")]:[]},number:of,color:function(t){var o=t.key,u=t.value,h=Li(u);return h!=="string"?[new Le(o,u,"color expected, "+h+" found")]:wi(u)===null?[new Le(o,u,'color expected, "'+u+'" found')]:[]},constants:ft,enum:sc,filter:kc,function:Wf,layer:Tp,object:$s,source:lc,light:oa,string:zl,formatted:function(t){return zl(t).length===0?[]:lu(t)},resolvedImage:function(t){return zl(t).length===0?[]:lu(t)}};function Gi(t){var o=t.value,u=t.valueSpec,h=t.styleSpec;return u.expression&&Ll(Ot(o))?Wf(t):u.expression&&ac(kt(o))?lu(t):u.type&&ju[u.type]?ju[u.type](t):$s(hr({},t,{valueSpec:u.type?h[u.type]:u}))}function wa(t){var o=t.value,u=t.key,h=zl(t);return h.length||(o.indexOf("{fontstack}")===-1&&h.push(new Le(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&h.push(new Le(u,o,'"glyphs" url must include a "{range}" token'))),h}function Ss(t,o){o===void 0&&(o=se);var u=[];return u=u.concat(Gi({key:"",value:t,valueSpec:o.$root,styleSpec:o,style:t,objectElementValidators:{glyphs:wa,"*":function(){return[]}}})),t.constants&&(u=u.concat(ft({key:"constants",value:t.constants,style:t,styleSpec:o}))),Dc(u)}function Dc(t){return[].concat(t).sort(function(o,u){return o.line-u.line})}function tl(t){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];return Dc(t.apply(this,o))}}Ss.source=tl(lc),Ss.light=tl(oa),Ss.layer=tl(Tp),Ss.filter=tl(kc),Ss.paintProperty=tl(wp),Ss.layoutProperty=tl(uc);var Za=Ss,cc=Za.light,Ul=Za.paintProperty,rl=Za.layoutProperty;function Fc(t,o){var u=!1;if(o&&o.length)for(var h=0,y=o;h<y.length;h+=1)t.fire(new je(new Error(y[h].message))),u=!0;return u}var Vu=vo;function vo(t,o,u){var h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var y=new Int32Array(this.arrayBuffer);t=y[0],this.d=(o=y[1])+2*(u=y[2]);for(var b=0;b<this.d*this.d;b++){var S=y[3+b],I=y[3+b+1];h.push(S===I?null:y.subarray(S,I))}var k=y[3+h.length+1];this.keys=y.subarray(y[3+h.length],k),this.bboxes=y.subarray(k),this.insert=this._insertReadonly}else{this.d=o+2*u;for(var N=0;N<this.d*this.d;N++)h.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=t,this.padding=u,this.scale=o/t,this.uid=0;var U=u/o*t;this.min=-U,this.max=t+U}vo.prototype.insert=function(t,o,u,h,y){this._forEachCell(o,u,h,y,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(h),this.bboxes.push(y)},vo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},vo.prototype._insertCell=function(t,o,u,h,y,b){this.cells[y].push(b)},vo.prototype.query=function(t,o,u,h,y){var b=this.min,S=this.max;if(t<=b&&o<=b&&S<=u&&S<=h&&!y)return Array.prototype.slice.call(this.keys);var I=[];return this._forEachCell(t,o,u,h,this._queryCell,I,{},y),I},vo.prototype._queryCell=function(t,o,u,h,y,b,S,I){var k=this.cells[y];if(k!==null)for(var N=this.keys,U=this.bboxes,G=0;G<k.length;G++){var $=k[G];if(S[$]===void 0){var re=4*$;(I?I(U[re+0],U[re+1],U[re+2],U[re+3]):t<=U[re+2]&&o<=U[re+3]&&u>=U[re+0]&&h>=U[re+1])?(S[$]=!0,b.push(N[$])):S[$]=!1}}},vo.prototype._forEachCell=function(t,o,u,h,y,b,S,I){for(var k=this._convertToCellCoord(t),N=this._convertToCellCoord(o),U=this._convertToCellCoord(u),G=this._convertToCellCoord(h),$=k;$<=U;$++)for(var re=N;re<=G;re++){var Te=this.d*re+$;if((!I||I(this._convertFromCellCoord($),this._convertFromCellCoord(re),this._convertFromCellCoord($+1),this._convertFromCellCoord(re+1)))&&y.call(this,t,o,u,h,Te,b,S,I))return}},vo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},vo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},vo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,o=3+this.cells.length+1+1,u=0,h=0;h<this.cells.length;h++)u+=this.cells[h].length;var y=new Int32Array(o+u+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var b=o,S=0;S<t.length;S++){var I=t[S];y[3+S]=b,y.set(I,b),b+=I.length}return y[3+t.length]=b,y.set(this.keys,b),y[3+t.length+1]=b+=this.keys.length,y.set(this.bboxes,b),b+=this.bboxes.length,y.buffer};var Zl=xe.ImageData,fc=xe.ImageBitmap,mo={};function gn(t,o,u){u===void 0&&(u={}),Object.defineProperty(o,"_classRegistryKey",{value:t,writeable:!1}),mo[t]={klass:o,omit:u.omit||[],shallow:u.shallow||[]}}for(var uo in gn("Object",Object),Vu.serialize=function(t,o){var u=t.toArrayBuffer();return o&&o.push(u),{buffer:u}},Vu.deserialize=function(t){return new Vu(t.buffer)},gn("Grid",Vu),gn("Color",Bi),gn("Error",Error),gn("ResolvedImage",ta),gn("StylePropertyFunction",el),gn("StyleExpression",Rc,{omit:["_evaluator"]}),gn("ZoomDependentExpression",gl),gn("ZoomConstantExpression",kl),gn("CompoundExpression",qa,{omit:["_evaluate"]}),Uu)Uu[uo]._classRegistryKey||gn("Expression_"+uo,Uu[uo]);function nl(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function La(t){return fc&&t instanceof fc}function cu(t,o){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(nl(t)||La(t))return o&&o.push(t),t;if(ArrayBuffer.isView(t)){var u=t;return o&&o.push(u.buffer),u}if(t instanceof Zl)return o&&o.push(t.data.buffer),t;if(Array.isArray(t)){for(var h=[],y=0,b=t;y<b.length;y+=1)h.push(cu(b[y],o));return h}if(typeof t=="object"){var S=t.constructor,I=S._classRegistryKey;if(!I)throw new Error("can't serialize object of unregistered class");var k=S.serialize?S.serialize(t,o):{};if(!S.serialize){for(var N in t)if(t.hasOwnProperty(N)&&!(mo[I].omit.indexOf(N)>=0)){var U=t[N];k[N]=mo[I].shallow.indexOf(N)>=0?U:cu(U,o)}t instanceof Error&&(k.message=t.message)}if(k.$name)throw new Error("$name property is reserved for worker serialization logic.");return I!=="Object"&&(k.$name=I),k}throw new Error("can't serialize object of type "+typeof t)}function ks(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||nl(t)||La(t)||ArrayBuffer.isView(t)||t instanceof Zl)return t;if(Array.isArray(t))return t.map(ks);if(typeof t=="object"){var o=t.$name||"Object",u=mo[o].klass;if(!u)throw new Error("can't deserialize unregistered class "+o);if(u.deserialize)return u.deserialize(t);for(var h=Object.create(u.prototype),y=0,b=Object.keys(t);y<b.length;y+=1){var S=b[y];if(S!=="$name"){var I=t[S];h[S]=mo[o].shallow.indexOf(S)>=0?I:ks(I)}}return h}throw new Error("can't deserialize object of type "+typeof t)}var Bc=function(){this.first=!0};Bc.prototype.update=function(t,o){var u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=o),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))};var Kr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function ff(t){for(var o=0,u=t;o<u.length;o+=1)if(pc(u[o].charCodeAt(0)))return!0;return!1}function pc(t){return!(t!==746&&t!==747&&(t<4352||!(Kr["Bopomofo Extended"](t)||Kr.Bopomofo(t)||Kr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Kr["CJK Compatibility Ideographs"](t)||Kr["CJK Compatibility"](t)||Kr["CJK Radicals Supplement"](t)||Kr["CJK Strokes"](t)||!(!Kr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Kr["CJK Unified Ideographs Extension A"](t)||Kr["CJK Unified Ideographs"](t)||Kr["Enclosed CJK Letters and Months"](t)||Kr["Hangul Compatibility Jamo"](t)||Kr["Hangul Jamo Extended-A"](t)||Kr["Hangul Jamo Extended-B"](t)||Kr["Hangul Jamo"](t)||Kr["Hangul Syllables"](t)||Kr.Hiragana(t)||Kr["Ideographic Description Characters"](t)||Kr.Kanbun(t)||Kr["Kangxi Radicals"](t)||Kr["Katakana Phonetic Extensions"](t)||Kr.Katakana(t)&&t!==12540||!(!Kr["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Kr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Kr["Unified Canadian Aboriginal Syllabics"](t)||Kr["Unified Canadian Aboriginal Syllabics Extended"](t)||Kr["Vertical Forms"](t)||Kr["Yijing Hexagram Symbols"](t)||Kr["Yi Syllables"](t)||Kr["Yi Radicals"](t))))}function Gu(t){return!(pc(t)||function(o){return!!(Kr["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||Kr["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||Kr["Letterlike Symbols"](o)||Kr["Number Forms"](o)||Kr["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||Kr["Control Pictures"](o)&&o!==9251||Kr["Optical Character Recognition"](o)||Kr["Enclosed Alphanumerics"](o)||Kr["Geometric Shapes"](o)||Kr["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Kr["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Kr["CJK Symbols and Punctuation"](o)||Kr.Katakana(o)||Kr["Private Use Area"](o)||Kr["CJK Compatibility Forms"](o)||Kr["Small Form Variants"](o)||Kr["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(t))}function ka(t){return t>=1424&&t<=2303||Kr["Arabic Presentation Forms-A"](t)||Kr["Arabic Presentation Forms-B"](t)}function Cs(t,o){return!(!o&&ka(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Kr.Khmer(t))}function Nc(t){for(var o=0,u=t;o<u.length;o+=1)if(ka(u[o].charCodeAt(0)))return!0;return!1}var Hu=null,rs="unavailable",fu=null,Mp=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(rs="error"),Hu&&Hu(t)};function zc(){Uc.fire(new Me("pluginStateChange",{pluginStatus:rs,pluginURL:fu}))}var Uc=new Qe,pf=function(){return rs},pu=function(){if(rs!=="deferred"||!fu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");rs="loading",zc(),fu&&Na({url:fu},function(t){t?Mp(t):(rs="loaded",zc())})},Us={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return rs==="loaded"||Us.applyArabicShaping!=null},isLoading:function(){return rs==="loading"},setState:function(t){rs=t.pluginStatus,fu=t.pluginURL},isParsed:function(){return Us.applyArabicShaping!=null&&Us.processBidirectionalText!=null&&Us.processStyledBidirectionalText!=null},getPluginURL:function(){return fu}},Ii=function(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Bc,this.transition={})};Ii.prototype.isSupportedScript=function(t){return function(o,u){for(var h=0,y=o;h<y.length;h+=1)if(!Cs(y[h].charCodeAt(0),u))return!1;return!0}(t,Us.isLoaded())},Ii.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Ii.prototype.getCrossfadeParameters=function(){var t=this.zoom,o=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*o}};var Su=function(t,o){this.property=t,this.value=o,this.expression=function(u,h){if(Ll(u))return new el(u,h);if(ac(u)){var y=Dl(u,h);if(y.result==="error")throw new Error(y.value.map(function(S){return S.key+": "+S.message}).join(", "));return y.value}var b=u;return typeof u=="string"&&h.type==="color"&&(b=Bi.parse(u)),{kind:"constant",evaluate:function(){return b}}}(o===void 0?t.specification.default:o,t.specification)};Su.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Su.prototype.possiblyEvaluate=function(t,o,u){return this.property.possiblyEvaluate(this,t,o,u)};var Zs=function(t){this.property=t,this.value=new Su(t,void 0)};Zs.prototype.transitioned=function(t,o){return new yl(this.property,this.value,o,Lt({},t.transition,this.transition),t.now)},Zs.prototype.untransitioned=function(){return new yl(this.property,this.value,null,{},0)};var bo=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};bo.prototype.getValue=function(t){return Ke(this._values[t].value.value)},bo.prototype.setValue=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new Zs(this._values[t].property)),this._values[t].value=new Su(this._values[t].property,o===null?void 0:Ke(o))},bo.prototype.getTransition=function(t){return Ke(this._values[t].transition)},bo.prototype.setTransition=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new Zs(this._values[t].property)),this._values[t].transition=Ke(o)||void 0},bo.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o],y=this.getValue(h);y!==void 0&&(t[h]=y);var b=this.getTransition(h);b!==void 0&&(t[h+"-transition"]=b)}return t},bo.prototype.transitioned=function(t,o){for(var u=new il(this._properties),h=0,y=Object.keys(this._values);h<y.length;h+=1){var b=y[h];u._values[b]=this._values[b].transitioned(t,o._values[b])}return u},bo.prototype.untransitioned=function(){for(var t=new il(this._properties),o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o];t._values[h]=this._values[h].untransitioned()}return t};var yl=function(t,o,u,h,y){this.property=t,this.value=o,this.begin=y+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=u)};yl.prototype.possiblyEvaluate=function(t,o,u){var h=t.now||0,y=this.value.possiblyEvaluate(t,o,u),b=this.prior;if(b){if(h>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(h<this.begin)return b.possiblyEvaluate(t,o,u);var S=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(t,o,u),y,function(I){if(I<=0)return 0;if(I>=1)return 1;var k=I*I,N=k*I;return 4*(I<.5?N:3*(I-k)+N-.75)}(S))}return y};var il=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};il.prototype.possiblyEvaluate=function(t,o,u){for(var h=new js(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var S=b[y];h._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return h},il.prototype.hasTransition=function(){for(var t=0,o=Object.keys(this._values);t<o.length;t+=1)if(this._values[o[t]].prior)return!0;return!1};var Qs=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Qs.prototype.getValue=function(t){return Ke(this._values[t].value)},Qs.prototype.setValue=function(t,o){this._values[t]=new Su(this._values[t].property,o===null?void 0:Ke(o))},Qs.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o],y=this.getValue(h);y!==void 0&&(t[h]=y)}return t},Qs.prototype.possiblyEvaluate=function(t,o,u){for(var h=new js(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var S=b[y];h._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return h};var ls=function(t,o,u){this.property=t,this.value=o,this.parameters=u};ls.prototype.isConstant=function(){return this.value.kind==="constant"},ls.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},ls.prototype.evaluate=function(t,o,u,h){return this.property.evaluate(this.value,this.parameters,t,o,u,h)};var js=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};js.prototype.get=function(t){return this._values[t]};var Dn=function(t){this.specification=t};Dn.prototype.possiblyEvaluate=function(t,o){return t.expression.evaluate(o)},Dn.prototype.interpolate=function(t,o,u){var h=ya[this.specification.type];return h?h(t,o,u):t};var An=function(t,o){this.specification=t,this.overrides=o};An.prototype.possiblyEvaluate=function(t,o,u,h){return new ls(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(o,null,{},u,h)}:t.expression,o)},An.prototype.interpolate=function(t,o,u){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new ls(this,{kind:"constant",value:void 0},t.parameters);var h=ya[this.specification.type];return h?new ls(this,{kind:"constant",value:h(t.value.value,o.value.value,u)},t.parameters):t},An.prototype.evaluate=function(t,o,u,h,y,b){return t.kind==="constant"?t.value:t.evaluate(o,u,h,y,b)};var Zc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,h,y,b){if(u.value===void 0)return new ls(this,{kind:"constant",value:void 0},h);if(u.expression.kind==="constant"){var S=u.expression.evaluate(h,null,{},y,b),I=u.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,k=this._calculate(I,I,I,h);return new ls(this,{kind:"constant",value:k},h)}if(u.expression.kind==="camera"){var N=this._calculate(u.expression.evaluate({zoom:h.zoom-1}),u.expression.evaluate({zoom:h.zoom}),u.expression.evaluate({zoom:h.zoom+1}),h);return new ls(this,{kind:"constant",value:N},h)}return new ls(this,u.expression,h)},o.prototype.evaluate=function(u,h,y,b,S,I){if(u.kind==="source"){var k=u.evaluate(h,y,b,S,I);return this._calculate(k,k,k,h)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(h.zoom)-1},y,b),u.evaluate({zoom:Math.floor(h.zoom)},y,b),u.evaluate({zoom:Math.floor(h.zoom)+1},y,b),h):u.value},o.prototype._calculate=function(u,h,y,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:u,to:h}:{from:y,to:h}},o.prototype.interpolate=function(u){return u},o}(An),cs=function(t){this.specification=t};cs.prototype.possiblyEvaluate=function(t,o,u,h){if(t.value!==void 0){if(t.expression.kind==="constant"){var y=t.expression.evaluate(o,null,{},u,h);return this._calculate(y,y,y,o)}return this._calculate(t.expression.evaluate(new Ii(Math.floor(o.zoom-1),o)),t.expression.evaluate(new Ii(Math.floor(o.zoom),o)),t.expression.evaluate(new Ii(Math.floor(o.zoom+1),o)),o)}},cs.prototype._calculate=function(t,o,u,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:u,to:o}},cs.prototype.interpolate=function(t){return t};var Oo=function(t){this.specification=t};Oo.prototype.possiblyEvaluate=function(t,o,u,h){return!!t.expression.evaluate(o,null,{},u,h)},Oo.prototype.interpolate=function(){return!1};var ns=function(t){for(var o in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var u=t[o];u.specification.overridable&&this.overridableProperties.push(o);var h=this.defaultPropertyValues[o]=new Su(u,void 0),y=this.defaultTransitionablePropertyValues[o]=new Zs(u);this.defaultTransitioningPropertyValues[o]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=h.possiblyEvaluate({})}};gn("DataDrivenProperty",An),gn("DataConstantProperty",Dn),gn("CrossFadedDataDrivenProperty",Zc),gn("CrossFadedProperty",cs),gn("ColorRampProperty",Oo);var Cu=function(t){function o(u,h){if(t.call(this),this.id=u.id,this.type=u.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},u.type!=="custom"&&(this.metadata=(u=u).metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),h.layout&&(this._unevaluatedLayout=new Qs(h.layout)),h.paint)){for(var y in this._transitionablePaint=new bo(h.paint),u.paint)this.setPaintProperty(y,u.paint[y],{validate:!1});for(var b in u.layout)this.setLayoutProperty(b,u.layout[b],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new js(h.paint)}}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},o.prototype.getLayoutProperty=function(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)},o.prototype.setLayoutProperty=function(u,h,y){y===void 0&&(y={}),h!=null&&this._validate(rl,"layers."+this.id+".layout."+u,u,h,y)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,h):this.visibility=h)},o.prototype.getPaintProperty=function(u){return q(u,"-transition")?this._transitionablePaint.getTransition(u.slice(0,-"-transition".length)):this._transitionablePaint.getValue(u)},o.prototype.setPaintProperty=function(u,h,y){if(y===void 0&&(y={}),h!=null&&this._validate(Ul,"layers."+this.id+".paint."+u,u,h,y))return!1;if(q(u,"-transition"))return this._transitionablePaint.setTransition(u.slice(0,-"-transition".length),h||void 0),!1;var b=this._transitionablePaint._values[u],S=b.property.specification["property-type"]==="cross-faded-data-driven",I=b.value.isDataDriven(),k=b.value;this._transitionablePaint.setValue(u,h),this._handleSpecialPaintPropertyUpdate(u);var N=this._transitionablePaint._values[u].value;return N.isDataDriven()||I||S||this._handleOverridablePaintPropertyUpdate(u,k,N)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){},o.prototype._handleOverridablePaintPropertyUpdate=function(u,h,y){return!1},o.prototype.isHidden=function(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"},o.prototype.updateTransitions=function(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)},o.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},o.prototype.recalculate=function(u,h){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,h)},o.prototype.serialize=function(){var u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),ct(u,function(h,y){return!(h===void 0||y==="layout"&&!Object.keys(h).length||y==="paint"&&!Object.keys(h).length)})},o.prototype._validate=function(u,h,y,b,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&Fc(this,u.call(Za,{key:h,layerType:this.type,objectKey:y,value:b,styleSpec:se,style:{glyphs:!0,sprite:!0}}))},o.prototype.is3D=function(){return!1},o.prototype.isTileClipped=function(){return!1},o.prototype.hasOffscreenPass=function(){return!1},o.prototype.resize=function(){},o.prototype.isStateDependent=function(){for(var u in this.paint._values){var h=this.paint.get(u);if(h instanceof ls&&uu(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1},o}(Qe),Xf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},_l=function(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},sa=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Da(t,o){o===void 0&&(o=1);var u=0,h=0;return{members:t.map(function(y){var b=Xf[y.type].BYTES_PER_ELEMENT,S=u=hf(u,Math.max(o,b)),I=y.components||1;return h=Math.max(h,b),u+=b*I,{name:y.name,type:y.type,components:I,offset:S}}),size:hf(u,Math.max(h,o)),alignment:o}}function hf(t,o){return Math.ceil(t/o)*o}sa.serialize=function(t,o){return t._trim(),o&&(t.isTransferred=!0,o.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},sa.deserialize=function(t){var o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o},sa.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},sa.prototype.clear=function(){this.length=0},sa.prototype.resize=function(t){this.reserve(t),this.length=t},sa.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}},sa.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var xl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var y=this.length;return this.resize(y+1),this.emplace(y,u,h)},o.prototype.emplace=function(u,h,y){var b=2*u;return this.int16[b+0]=h,this.int16[b+1]=y,u},o}(sa);xl.prototype.bytesPerElement=4,gn("StructArrayLayout2i4",xl);var Au=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,y,b)},o.prototype.emplace=function(u,h,y,b,S){var I=4*u;return this.int16[I+0]=h,this.int16[I+1]=y,this.int16[I+2]=b,this.int16[I+3]=S,u},o}(sa);Au.prototype.bytesPerElement=8,gn("StructArrayLayout4i8",Au);var hu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I){var k=this.length;return this.resize(k+1),this.emplace(k,u,h,y,b,S,I)},o.prototype.emplace=function(u,h,y,b,S,I,k){var N=6*u;return this.int16[N+0]=h,this.int16[N+1]=y,this.int16[N+2]=b,this.int16[N+3]=S,this.int16[N+4]=I,this.int16[N+5]=k,u},o}(sa);hu.prototype.bytesPerElement=12,gn("StructArrayLayout2i4i12",hu);var Yo=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I){var k=this.length;return this.resize(k+1),this.emplace(k,u,h,y,b,S,I)},o.prototype.emplace=function(u,h,y,b,S,I,k){var N=4*u,U=8*u;return this.int16[N+0]=h,this.int16[N+1]=y,this.uint8[U+4]=b,this.uint8[U+5]=S,this.uint8[U+6]=I,this.uint8[U+7]=k,u},o}(sa);Yo.prototype.bytesPerElement=8,gn("StructArrayLayout2i4ub8",Yo);var al=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var y=this.length;return this.resize(y+1),this.emplace(y,u,h)},o.prototype.emplace=function(u,h,y){var b=2*u;return this.float32[b+0]=h,this.float32[b+1]=y,u},o}(sa);al.prototype.bytesPerElement=8,gn("StructArrayLayout2f8",al);var Wu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I,k,N,U,G){var $=this.length;return this.resize($+1),this.emplace($,u,h,y,b,S,I,k,N,U,G)},o.prototype.emplace=function(u,h,y,b,S,I,k,N,U,G,$){var re=10*u;return this.uint16[re+0]=h,this.uint16[re+1]=y,this.uint16[re+2]=b,this.uint16[re+3]=S,this.uint16[re+4]=I,this.uint16[re+5]=k,this.uint16[re+6]=N,this.uint16[re+7]=U,this.uint16[re+8]=G,this.uint16[re+9]=$,u},o}(sa);Wu.prototype.bytesPerElement=20,gn("StructArrayLayout10ui20",Wu);var jc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I,k,N,U,G,$,re){var Te=this.length;return this.resize(Te+1),this.emplace(Te,u,h,y,b,S,I,k,N,U,G,$,re)},o.prototype.emplace=function(u,h,y,b,S,I,k,N,U,G,$,re,Te){var Ie=12*u;return this.int16[Ie+0]=h,this.int16[Ie+1]=y,this.int16[Ie+2]=b,this.int16[Ie+3]=S,this.uint16[Ie+4]=I,this.uint16[Ie+5]=k,this.uint16[Ie+6]=N,this.uint16[Ie+7]=U,this.int16[Ie+8]=G,this.int16[Ie+9]=$,this.int16[Ie+10]=re,this.int16[Ie+11]=Te,u},o}(sa);jc.prototype.bytesPerElement=24,gn("StructArrayLayout4i4ui4i24",jc);var du=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=3*u;return this.float32[S+0]=h,this.float32[S+1]=y,this.float32[S+2]=b,u},o}(sa);du.prototype.bytesPerElement=12,gn("StructArrayLayout3f12",du);var Vc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.uint32[1*u+0]=h,u},o}(sa);Vc.prototype.bytesPerElement=4,gn("StructArrayLayout1ul4",Vc);var hc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I,k,N,U){var G=this.length;return this.resize(G+1),this.emplace(G,u,h,y,b,S,I,k,N,U)},o.prototype.emplace=function(u,h,y,b,S,I,k,N,U,G){var $=10*u,re=5*u;return this.int16[$+0]=h,this.int16[$+1]=y,this.int16[$+2]=b,this.int16[$+3]=S,this.int16[$+4]=I,this.int16[$+5]=k,this.uint32[re+3]=N,this.uint16[$+8]=U,this.uint16[$+9]=G,u},o}(sa);hc.prototype.bytesPerElement=20,gn("StructArrayLayout6i1ul2ui20",hc);var jl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I){var k=this.length;return this.resize(k+1),this.emplace(k,u,h,y,b,S,I)},o.prototype.emplace=function(u,h,y,b,S,I,k){var N=6*u;return this.int16[N+0]=h,this.int16[N+1]=y,this.int16[N+2]=b,this.int16[N+3]=S,this.int16[N+4]=I,this.int16[N+5]=k,u},o}(sa);jl.prototype.bytesPerElement=12,gn("StructArrayLayout2i2i2i12",jl);var Qi=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S){var I=this.length;return this.resize(I+1),this.emplace(I,u,h,y,b,S)},o.prototype.emplace=function(u,h,y,b,S,I){var k=4*u,N=8*u;return this.float32[k+0]=h,this.float32[k+1]=y,this.float32[k+2]=b,this.int16[N+6]=S,this.int16[N+7]=I,u},o}(sa);Qi.prototype.bytesPerElement=16,gn("StructArrayLayout2f1f2i16",Qi);var bl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,y,b)},o.prototype.emplace=function(u,h,y,b,S){var I=12*u,k=3*u;return this.uint8[I+0]=h,this.uint8[I+1]=y,this.float32[k+1]=b,this.float32[k+2]=S,u},o}(sa);bl.prototype.bytesPerElement=12,gn("StructArrayLayout2ub2f12",bl);var vu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=3*u;return this.uint16[S+0]=h,this.uint16[S+1]=y,this.uint16[S+2]=b,u},o}(sa);vu.prototype.bytesPerElement=6,gn("StructArrayLayout3ui6",vu);var wu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I,k,N,U,G,$,re,Te,Ie,We,ze,it){var Et=this.length;return this.resize(Et+1),this.emplace(Et,u,h,y,b,S,I,k,N,U,G,$,re,Te,Ie,We,ze,it)},o.prototype.emplace=function(u,h,y,b,S,I,k,N,U,G,$,re,Te,Ie,We,ze,it,Et){var Ut=24*u,Gt=12*u,or=48*u;return this.int16[Ut+0]=h,this.int16[Ut+1]=y,this.uint16[Ut+2]=b,this.uint16[Ut+3]=S,this.uint32[Gt+2]=I,this.uint32[Gt+3]=k,this.uint32[Gt+4]=N,this.uint16[Ut+10]=U,this.uint16[Ut+11]=G,this.uint16[Ut+12]=$,this.float32[Gt+7]=re,this.float32[Gt+8]=Te,this.uint8[or+36]=Ie,this.uint8[or+37]=We,this.uint8[or+38]=ze,this.uint32[Gt+10]=it,this.int16[Ut+22]=Et,u},o}(sa);wu.prototype.bytesPerElement=48,gn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",wu);var Vl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I,k,N,U,G,$,re,Te,Ie,We,ze,it,Et,Ut,Gt,or,Ir,Qr,kn,pn,zn,hn,hi){var Vn=this.length;return this.resize(Vn+1),this.emplace(Vn,u,h,y,b,S,I,k,N,U,G,$,re,Te,Ie,We,ze,it,Et,Ut,Gt,or,Ir,Qr,kn,pn,zn,hn,hi)},o.prototype.emplace=function(u,h,y,b,S,I,k,N,U,G,$,re,Te,Ie,We,ze,it,Et,Ut,Gt,or,Ir,Qr,kn,pn,zn,hn,hi,Vn){var Mn=34*u,Fi=17*u;return this.int16[Mn+0]=h,this.int16[Mn+1]=y,this.int16[Mn+2]=b,this.int16[Mn+3]=S,this.int16[Mn+4]=I,this.int16[Mn+5]=k,this.int16[Mn+6]=N,this.int16[Mn+7]=U,this.uint16[Mn+8]=G,this.uint16[Mn+9]=$,this.uint16[Mn+10]=re,this.uint16[Mn+11]=Te,this.uint16[Mn+12]=Ie,this.uint16[Mn+13]=We,this.uint16[Mn+14]=ze,this.uint16[Mn+15]=it,this.uint16[Mn+16]=Et,this.uint16[Mn+17]=Ut,this.uint16[Mn+18]=Gt,this.uint16[Mn+19]=or,this.uint16[Mn+20]=Ir,this.uint16[Mn+21]=Qr,this.uint16[Mn+22]=kn,this.uint32[Fi+12]=pn,this.float32[Fi+13]=zn,this.float32[Fi+14]=hn,this.float32[Fi+15]=hi,this.float32[Fi+16]=Vn,u},o}(sa);Vl.prototype.bytesPerElement=68,gn("StructArrayLayout8i15ui1ul4f68",Vl);var Tu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.float32[1*u+0]=h,u},o}(sa);Tu.prototype.bytesPerElement=4,gn("StructArrayLayout1f4",Tu);var Vs=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=3*u;return this.int16[S+0]=h,this.int16[S+1]=y,this.int16[S+2]=b,u},o}(sa);Vs.prototype.bytesPerElement=6,gn("StructArrayLayout3i6",Vs);var ja=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=4*u;return this.uint32[2*u+0]=h,this.uint16[S+2]=y,this.uint16[S+3]=b,u},o}(sa);ja.prototype.bytesPerElement=8,gn("StructArrayLayout1ul2ui8",ja);var Mu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var y=this.length;return this.resize(y+1),this.emplace(y,u,h)},o.prototype.emplace=function(u,h,y){var b=2*u;return this.uint16[b+0]=h,this.uint16[b+1]=y,u},o}(sa);Mu.prototype.bytesPerElement=4,gn("StructArrayLayout2ui4",Mu);var Gl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.uint16[1*u+0]=h,u},o}(sa);Gl.prototype.bytesPerElement=2,gn("StructArrayLayout1ui2",Gl);var Gc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,y,b)},o.prototype.emplace=function(u,h,y,b,S){var I=4*u;return this.float32[I+0]=h,this.float32[I+1]=y,this.float32[I+2]=b,this.float32[I+3]=S,u},o}(sa);Gc.prototype.bytesPerElement=16,gn("StructArrayLayout4f16",Gc);var l=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return u.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},u.x1.get=function(){return this._structArray.int16[this._pos2+2]},u.y1.get=function(){return this._structArray.int16[this._pos2+3]},u.x2.get=function(){return this._structArray.int16[this._pos2+4]},u.y2.get=function(){return this._structArray.int16[this._pos2+5]},u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.anchorPoint.get=function(){return new de(this.anchorPointX,this.anchorPointY)},Object.defineProperties(o.prototype,u),o}(_l);l.prototype.size=20;var p=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new l(this,u)},o}(hc);gn("CollisionBoxArray",p);var c=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},u.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},u.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},u.segment.get=function(){return this._structArray.uint16[this._pos2+10]},u.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},u.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},u.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},u.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},u.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},u.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},u.placedOrientation.set=function(h){this._structArray.uint8[this._pos1+37]=h},u.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},u.hidden.set=function(h){this._structArray.uint8[this._pos1+38]=h},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},u.crossTileID.set=function(h){this._structArray.uint32[this._pos4+10]=h},u.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(o.prototype,u),o}(_l);c.prototype.size=48;var d=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new c(this,u)},o}(wu);gn("PlacedSymbolArray",d);var E=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},u.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},u.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},u.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},u.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},u.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},u.key.get=function(){return this._structArray.uint16[this._pos2+8]},u.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},u.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},u.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},u.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},u.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},u.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},u.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},u.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},u.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},u.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},u.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},u.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},u.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},u.crossTileID.set=function(h){this._structArray.uint32[this._pos4+12]=h},u.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},u.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},u.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},u.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(o.prototype,u),o}(_l);E.prototype.size=68;var w=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new E(this,u)},o}(Vl);gn("SymbolInstanceArray",w);var P=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getoffsetX=function(u){return this.float32[1*u+0]},o}(Tu);gn("GlyphOffsetArray",P);var L=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getx=function(u){return this.int16[3*u+0]},o.prototype.gety=function(u){return this.int16[3*u+1]},o.prototype.gettileUnitDistanceFromAnchor=function(u){return this.int16[3*u+2]},o}(Vs);gn("SymbolLineVertexArray",L);var z=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(o.prototype,u),o}(_l);z.prototype.size=8;var H=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new z(this,u)},o}(ja);gn("FeatureIndexArray",H);var oe=Da([{name:"a_pos",components:2,type:"Int16"}],4).members,ue=function(t){t===void 0&&(t=[]),this.segments=t};function le(t,o){return 256*(t=tr(Math.floor(t),0,255))+tr(Math.floor(o),0,255)}ue.prototype.prepareSegment=function(t,o,u,h){var y=this.segments[this.segments.length-1];return t>ue.MAX_VERTEX_ARRAY_LENGTH&&et("Max vertices per segment is "+ue.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!y||y.vertexLength+t>ue.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==h)&&(y={vertexOffset:o.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},h!==void 0&&(y.sortKey=h),this.segments.push(y)),y},ue.prototype.get=function(){return this.segments},ue.prototype.destroy=function(){for(var t=0,o=this.segments;t<o.length;t+=1){var u=o[t];for(var h in u.vaos)u.vaos[h].destroy()}},ue.simpleSegment=function(t,o,u,h){return new ue([{vertexOffset:t,primitiveOffset:o,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])},ue.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,gn("SegmentVector",ue);var Pe=Da([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),we=Re(function(t){t.exports=function(o,u){var h,y,b,S,I,k,N,U;for(y=o.length-(h=3&o.length),b=u,I=3432918353,k=461845907,U=0;U<y;)N=255&o.charCodeAt(U)|(255&o.charCodeAt(++U))<<8|(255&o.charCodeAt(++U))<<16|(255&o.charCodeAt(++U))<<24,++U,b=27492+(65535&(S=5*(65535&(b=(b^=N=(65535&(N=(N=(65535&N)*I+(((N>>>16)*I&65535)<<16)&4294967295)<<15|N>>>17))*k+(((N>>>16)*k&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(N=0,h){case 3:N^=(255&o.charCodeAt(U+2))<<16;case 2:N^=(255&o.charCodeAt(U+1))<<8;case 1:b^=N=(65535&(N=(N=(65535&(N^=255&o.charCodeAt(U)))*I+(((N>>>16)*I&65535)<<16)&4294967295)<<15|N>>>17))*k+(((N>>>16)*k&65535)<<16)&4294967295}return b^=o.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}}),Ge=Re(function(t){t.exports=function(o,u){for(var h,y=o.length,b=u^y,S=0;y>=4;)h=1540483477*(65535&(h=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24))+((1540483477*(h>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),y-=4,++S;switch(y){case 3:b^=(255&o.charCodeAt(S+2))<<16;case 2:b^=(255&o.charCodeAt(S+1))<<8;case 1:b=1540483477*(65535&(b^=255&o.charCodeAt(S)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}}),Ce=we,Ve=Ge;Ce.murmur3=we,Ce.murmur2=Ve;var $e=function(){this.ids=[],this.positions=[],this.indexed=!1};$e.prototype.add=function(t,o,u,h){this.ids.push(Vt(t)),this.positions.push(o,u,h)},$e.prototype.getPositions=function(t){for(var o=Vt(t),u=0,h=this.ids.length-1;u<h;){var y=u+h>>1;this.ids[y]>=o?h=y:u=y+1}for(var b=[];this.ids[u]===o;)b.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return b},$e.serialize=function(t,o){var u=new Float64Array(t.ids),h=new Uint32Array(t.positions);return function y(b,S,I,k){for(;I<k;){for(var N=b[I+k>>1],U=I-1,G=k+1;;){do U++;while(b[U]<N);do G--;while(b[G]>N);if(U>=G)break;Bt(b,U,G),Bt(S,3*U,3*G),Bt(S,3*U+1,3*G+1),Bt(S,3*U+2,3*G+2)}G-I<k-G?(y(b,S,I,G),I=G+1):(y(b,S,G+1,k),k=G)}}(u,h,0,u.length-1),o&&o.push(u.buffer,h.buffer),{ids:u,positions:h}},$e.deserialize=function(t){var o=new $e;return o.ids=t.ids,o.positions=t.positions,o.indexed=!0,o};var yt=Math.pow(2,53)-1;function Vt(t){var o=+t;return!isNaN(o)&&o<=yt?o:Ce(String(t))}function Bt(t,o,u){var h=t[o];t[o]=t[u],t[u]=h}gn("FeaturePositionMap",$e);var Xt=function(t,o){this.gl=t.gl,this.location=o},vr=function(t){function o(u,h){t.call(this,u,h),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))},o}(Xt),Br=function(t){function o(u,h){t.call(this,u,h),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))},o}(Xt),Lr=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))},o}(Xt),jr=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))},o}(Xt),Fn=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))},o}(Xt),On=function(t){function o(u,h){t.call(this,u,h),this.current=Bi.transparent}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))},o}(Xt),Zn=new Float32Array(16),Oi=function(t){function o(u,h){t.call(this,u,h),this.current=Zn}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(var h=1;h<16;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}},o}(Xt);function un(t){return[le(255*t.r,255*t.g),le(255*t.b,255*t.a)]}var Qn=function(t,o,u){this.value=t,this.uniformNames=o.map(function(h){return"u_"+h}),this.type=u};Qn.prototype.setUniform=function(t,o,u){t.set(u.constantOr(this.value))},Qn.prototype.getBinding=function(t,o,u){return this.type==="color"?new On(t,o):new Br(t,o)};var li=function(t,o){this.uniformNames=o.map(function(u){return"u_"+u}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};li.prototype.setConstantPatternPositions=function(t,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=t.tlbr},li.prototype.setUniform=function(t,o,u,h){var y=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&t.set(y)},li.prototype.getBinding=function(t,o,u){return u.substr(0,9)==="u_pattern"?new Fn(t,o):new Br(t,o)};var Jn=function(t,o,u,h){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(function(y){return{name:"a_"+y,type:"Float32",components:u==="color"?2:1,offset:0}}),this.paintVertexArray=new h};Jn.prototype.populatePaintArray=function(t,o,u,h,y){var b=this.paintVertexArray.length,S=this.expression.evaluate(new Ii(0),o,{},h,[],y);this.paintVertexArray.resize(t),this._setPaintValue(b,t,S)},Jn.prototype.updatePaintArray=function(t,o,u,h){var y=this.expression.evaluate({zoom:0},u,h);this._setPaintValue(t,o,y)},Jn.prototype._setPaintValue=function(t,o,u){if(this.type==="color")for(var h=un(u),y=t;y<o;y++)this.paintVertexArray.emplace(y,h[0],h[1]);else{for(var b=t;b<o;b++)this.paintVertexArray.emplace(b,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}},Jn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Jn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Hn=function(t,o,u,h,y,b){this.expression=t,this.uniformNames=o.map(function(S){return"u_"+S+"_t"}),this.type=u,this.useIntegerZoom=h,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=o.map(function(S){return{name:"a_"+S,type:"Float32",components:u==="color"?4:2,offset:0}}),this.paintVertexArray=new b};Hn.prototype.populatePaintArray=function(t,o,u,h,y){var b=this.expression.evaluate(new Ii(this.zoom),o,{},h,[],y),S=this.expression.evaluate(new Ii(this.zoom+1),o,{},h,[],y),I=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(I,t,b,S)},Hn.prototype.updatePaintArray=function(t,o,u,h){var y=this.expression.evaluate({zoom:this.zoom},u,h),b=this.expression.evaluate({zoom:this.zoom+1},u,h);this._setPaintValue(t,o,y,b)},Hn.prototype._setPaintValue=function(t,o,u,h){if(this.type==="color")for(var y=un(u),b=un(h),S=t;S<o;S++)this.paintVertexArray.emplace(S,y[0],y[1],b[0],b[1]);else{for(var I=t;I<o;I++)this.paintVertexArray.emplace(I,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}},Hn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Hn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Hn.prototype.setUniform=function(t,o){var u=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,h=tr(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(h)},Hn.prototype.getBinding=function(t,o,u){return new Br(t,o)};var pi=function(t,o,u,h,y,b){this.expression=t,this.type=o,this.useIntegerZoom=u,this.zoom=h,this.layerId=b,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y};pi.prototype.populatePaintArray=function(t,o,u){var h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,o.patterns&&o.patterns[this.layerId],u)},pi.prototype.updatePaintArray=function(t,o,u,h,y){this._setPaintValues(t,o,u.patterns&&u.patterns[this.layerId],y)},pi.prototype._setPaintValues=function(t,o,u,h){if(h&&u){var y=h[u.min],b=h[u.mid],S=h[u.max];if(y&&b&&S)for(var I=t;I<o;I++)this.zoomInPaintVertexArray.emplace(I,b.tl[0],b.tl[1],b.br[0],b.br[1],y.tl[0],y.tl[1],y.br[0],y.br[1],b.pixelRatio,y.pixelRatio),this.zoomOutPaintVertexArray.emplace(I,b.tl[0],b.tl[1],b.br[0],b.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],b.pixelRatio,S.pixelRatio)}},pi.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Pe.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Pe.members,this.expression.isStateDependent))},pi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Kn=function(t,o,u){this.binders={},this._buffers=[];var h=[];for(var y in t.paint._values)if(u(y)){var b=t.paint.get(y);if(b instanceof ls&&uu(b.property.specification)){var S=go(y,t.type),I=b.value,k=b.property.specification.type,N=b.property.useIntegerZoom,U=b.property.specification["property-type"],G=U==="cross-faded"||U==="cross-faded-data-driven";if(I.kind==="constant")this.binders[y]=G?new li(I.value,S):new Qn(I.value,S,k),h.push("/u_"+y);else if(I.kind==="source"||G){var $=Va(y,k,"source");this.binders[y]=G?new pi(I,k,N,o,$,t.id):new Jn(I,S,k,$),h.push("/a_"+y)}else{var re=Va(y,k,"composite");this.binders[y]=new Hn(I,S,k,N,o,re),h.push("/z_"+y)}}}this.cacheKey=h.sort().join("")};Kn.prototype.getMaxValue=function(t){var o=this.binders[t];return o instanceof Jn||o instanceof Hn?o.maxValue:0},Kn.prototype.populatePaintArrays=function(t,o,u,h,y){for(var b in this.binders){var S=this.binders[b];(S instanceof Jn||S instanceof Hn||S instanceof pi)&&S.populatePaintArray(t,o,u,h,y)}},Kn.prototype.setConstantPatternPositions=function(t,o){for(var u in this.binders){var h=this.binders[u];h instanceof li&&h.setConstantPatternPositions(t,o)}},Kn.prototype.updatePaintArrays=function(t,o,u,h,y){var b=!1;for(var S in t)for(var I=0,k=o.getPositions(S);I<k.length;I+=1){var N=k[I],U=u.feature(N.index);for(var G in this.binders){var $=this.binders[G];if(($ instanceof Jn||$ instanceof Hn||$ instanceof pi)&&$.expression.isStateDependent===!0){var re=h.paint.get(G);$.expression=re.value,$.updatePaintArray(N.start,N.end,U,t[S],y),b=!0}}}return b},Kn.prototype.defines=function(){var t=[];for(var o in this.binders){var u=this.binders[o];(u instanceof Qn||u instanceof li)&&t.push.apply(t,u.uniformNames.map(function(h){return"#define HAS_UNIFORM_"+h}))}return t},Kn.prototype.getBinderAttributes=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof Jn||u instanceof Hn)for(var h=0;h<u.paintVertexAttributes.length;h++)t.push(u.paintVertexAttributes[h].name);else if(u instanceof pi)for(var y=0;y<Pe.members.length;y++)t.push(Pe.members[y].name)}return t},Kn.prototype.getBinderUniforms=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof Qn||u instanceof li||u instanceof Hn)for(var h=0,y=u.uniformNames;h<y.length;h+=1)t.push(y[h])}return t},Kn.prototype.getPaintVertexBuffers=function(){return this._buffers},Kn.prototype.getUniforms=function(t,o){var u=[];for(var h in this.binders){var y=this.binders[h];if(y instanceof Qn||y instanceof li||y instanceof Hn)for(var b=0,S=y.uniformNames;b<S.length;b+=1){var I=S[b];if(o[I]){var k=y.getBinding(t,o[I],I);u.push({name:I,property:h,binding:k})}}}return u},Kn.prototype.setUniforms=function(t,o,u,h){for(var y=0,b=o;y<b.length;y+=1){var S=b[y],I=S.name,k=S.property;this.binders[k].setUniform(S.binding,h,u.get(k),I)}},Kn.prototype.updatePaintBuffers=function(t){for(var o in this._buffers=[],this.binders){var u=this.binders[o];if(t&&u instanceof pi){var h=t.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(u instanceof Jn||u instanceof Hn)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}},Kn.prototype.upload=function(t){for(var o in this.binders){var u=this.binders[o];(u instanceof Jn||u instanceof Hn||u instanceof pi)&&u.upload(t)}this.updatePaintBuffers()},Kn.prototype.destroy=function(){for(var t in this.binders){var o=this.binders[t];(o instanceof Jn||o instanceof Hn||o instanceof pi)&&o.destroy()}};var Wn=function(t,o,u){u===void 0&&(u=function(){return!0}),this.programConfigurations={};for(var h=0,y=t;h<y.length;h+=1){var b=y[h];this.programConfigurations[b.id]=new Kn(b,o,u)}this.needsUpload=!1,this._featureMap=new $e,this._bufferOffset=0};function go(t,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(o+"-","").replace(/-/g,"_")]}function Va(t,o,u){var h={color:{source:al,composite:Gc},number:{source:Tu,composite:al}},y=function(b){return{"line-pattern":{source:Wu,composite:Wu},"fill-pattern":{source:Wu,composite:Wu},"fill-extrusion-pattern":{source:Wu,composite:Wu}}[b]}(t);return y&&y[u]||h[o][u]}Wn.prototype.populatePaintArrays=function(t,o,u,h,y,b){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,o,h,y,b);o.id!==void 0&&this._featureMap.add(o.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Wn.prototype.updatePaintArrays=function(t,o,u,h){for(var y=0,b=u;y<b.length;y+=1){var S=b[y];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(t,this._featureMap,o,S,h)||this.needsUpload}},Wn.prototype.get=function(t){return this.programConfigurations[t]},Wn.prototype.upload=function(t){if(this.needsUpload){for(var o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}},Wn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},gn("ConstantBinder",Qn),gn("CrossFadedConstantBinder",li),gn("SourceExpressionBinder",Jn),gn("CrossFadedCompositeBinder",pi),gn("CompositeExpressionBinder",Hn),gn("ProgramConfiguration",Kn,{omit:["_buffers"]}),gn("ProgramConfigurationSet",Wn);var No=Math.pow(2,14)-1,zo=-No-1;function $a(t){for(var o=8192/t.extent,u=t.loadGeometry(),h=0;h<u.length;h++)for(var y=u[h],b=0;b<y.length;b++){var S=y[b],I=Math.round(S.x*o),k=Math.round(S.y*o);S.x=tr(I,zo,No),S.y=tr(k,zo,No),(I<S.x||I>S.x+1||k<S.y||k>S.y+1)&&et("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return u}function lo(t,o){return{type:t.type,id:t.id,properties:t.properties,geometry:o?$a(t):[]}}function Ds(t,o,u,h,y){t.emplaceBack(2*o+(h+1)/2,2*u+(y+1)/2)}var fs=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new xl,this.indexArray=new vu,this.segments=new ue,this.programConfigurations=new Wn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function Uo(t,o){for(var u=0;u<t.length;u++)if(mu(o,t[u]))return!0;for(var h=0;h<o.length;h++)if(mu(t,o[h]))return!0;return!!Pu(t,o)}function ps(t,o,u){return!!mu(t,o)||!!Xu(o,t,u)}function is(t,o){if(t.length===1)return dc(o,t[0]);for(var u=0;u<o.length;u++)for(var h=o[u],y=0;y<h.length;y++)if(mu(t,h[y]))return!0;for(var b=0;b<t.length;b++)if(dc(o,t[b]))return!0;for(var S=0;S<o.length;S++)if(Pu(t,o[S]))return!0;return!1}function Js(t,o,u){if(t.length>1){if(Pu(t,o))return!0;for(var h=0;h<o.length;h++)if(Xu(o[h],t,u))return!0}for(var y=0;y<t.length;y++)if(Xu(t[y],o,u))return!0;return!1}function Pu(t,o){if(t.length===0||o.length===0)return!1;for(var u=0;u<t.length-1;u++)for(var h=t[u],y=t[u+1],b=0;b<o.length-1;b++)if(ol(h,y,o[b],o[b+1]))return!0;return!1}function ol(t,o,u,h){return qt(t,u,h)!==qt(o,u,h)&&qt(t,o,u)!==qt(t,o,h)}function Xu(t,o,u){var h=u*u;if(o.length===1)return t.distSqr(o[0])<h;for(var y=1;y<o.length;y++)if(Hl(t,o[y-1],o[y])<h)return!0;return!1}function Hl(t,o,u){var h=o.distSqr(u);if(h===0)return t.distSqr(o);var y=((t.x-o.x)*(u.x-o.x)+(t.y-o.y)*(u.y-o.y))/h;return t.distSqr(y<0?o:y>1?u:u.sub(o)._mult(y)._add(o))}function dc(t,o){for(var u,h,y,b=!1,S=0;S<t.length;S++)for(var I=0,k=(u=t[S]).length-1;I<u.length;k=I++)(h=u[I]).y>o.y!=(y=u[k]).y>o.y&&o.x<(y.x-h.x)*(o.y-h.y)/(y.y-h.y)+h.x&&(b=!b);return b}function mu(t,o){for(var u=!1,h=0,y=t.length-1;h<t.length;y=h++){var b=t[h],S=t[y];b.y>o.y!=S.y>o.y&&o.x<(S.x-b.x)*(o.y-b.y)/(S.y-b.y)+b.x&&(u=!u)}return u}function Qa(t,o,u){var h=u[0],y=u[2];if(t.x<h.x&&o.x<h.x||t.x>y.x&&o.x>y.x||t.y<h.y&&o.y<h.y||t.y>y.y&&o.y>y.y)return!1;var b=qt(t,o,u[0]);return b!==qt(t,o,u[1])||b!==qt(t,o,u[2])||b!==qt(t,o,u[3])}function Ta(t,o,u){var h=o.paint.get(t).value;return h.kind==="constant"?h.value:u.programConfigurations.get(o.id).getMaxValue(t)}function no(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Iu(t,o,u,h,y){if(!o[0]&&!o[1])return t;var b=de.convert(o)._mult(y);u==="viewport"&&b._rotate(-h);for(var S=[],I=0;I<t.length;I++)S.push(t[I].sub(b));return S}fs.prototype.populate=function(t,o,u){var h=this.layers[0],y=[],b=null;h.type==="circle"&&(b=h.layout.get("circle-sort-key"));for(var S=0,I=t;S<I.length;S+=1){var k=I[S],N=k.feature,U=k.id,G=k.index,$=k.sourceLayerIndex,re=this.layers[0]._featureFilter.needGeometry,Te=lo(N,re);if(this.layers[0]._featureFilter.filter(new Ii(this.zoom),Te,u)){var Ie=b?b.evaluate(Te,{},u):void 0,We={id:U,properties:N.properties,type:N.type,sourceLayerIndex:$,index:G,geometry:re?Te.geometry:$a(N),patterns:{},sortKey:Ie};y.push(We)}}b&&y.sort(function(Qr,kn){return Qr.sortKey-kn.sortKey});for(var ze=0,it=y;ze<it.length;ze+=1){var Et=it[ze],Ut=Et.geometry,Gt=Et.index,or=Et.sourceLayerIndex,Ir=t[Gt].feature;this.addFeature(Et,Ut,Gt,u),o.featureIndex.insert(Ir,Ut,Gt,or,this.index)}},fs.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},fs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},fs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},fs.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,oe),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},fs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},fs.prototype.addFeature=function(t,o,u,h){for(var y=0,b=o;y<b.length;y+=1)for(var S=0,I=b[y];S<I.length;S+=1){var k=I[S],N=k.x,U=k.y;if(!(N<0||N>=8192||U<0||U>=8192)){var G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),$=G.vertexLength;Ds(this.layoutVertexArray,N,U,-1,-1),Ds(this.layoutVertexArray,N,U,1,-1),Ds(this.layoutVertexArray,N,U,1,1),Ds(this.layoutVertexArray,N,U,-1,1),this.indexArray.emplaceBack($,$+1,$+2),this.indexArray.emplaceBack($,$+3,$+2),G.vertexLength+=4,G.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},h)},gn("CircleBucket",fs,{omit:["layers"]});var Gs=new ns({"circle-sort-key":new An(se.layout_circle["circle-sort-key"])}),El={paint:new ns({"circle-radius":new An(se.paint_circle["circle-radius"]),"circle-color":new An(se.paint_circle["circle-color"]),"circle-blur":new An(se.paint_circle["circle-blur"]),"circle-opacity":new An(se.paint_circle["circle-opacity"]),"circle-translate":new Dn(se.paint_circle["circle-translate"]),"circle-translate-anchor":new Dn(se.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Dn(se.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Dn(se.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new An(se.paint_circle["circle-stroke-width"]),"circle-stroke-color":new An(se.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new An(se.paint_circle["circle-stroke-opacity"])}),layout:Gs},ua=typeof Float32Array!="undefined"?Float32Array:Array;function eu(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function As(t,o,u){var h=o[0],y=o[1],b=o[2],S=o[3],I=o[4],k=o[5],N=o[6],U=o[7],G=o[8],$=o[9],re=o[10],Te=o[11],Ie=o[12],We=o[13],ze=o[14],it=o[15],Et=u[0],Ut=u[1],Gt=u[2],or=u[3];return t[0]=Et*h+Ut*I+Gt*G+or*Ie,t[1]=Et*y+Ut*k+Gt*$+or*We,t[2]=Et*b+Ut*N+Gt*re+or*ze,t[3]=Et*S+Ut*U+Gt*Te+or*it,t[4]=(Et=u[4])*h+(Ut=u[5])*I+(Gt=u[6])*G+(or=u[7])*Ie,t[5]=Et*y+Ut*k+Gt*$+or*We,t[6]=Et*b+Ut*N+Gt*re+or*ze,t[7]=Et*S+Ut*U+Gt*Te+or*it,t[8]=(Et=u[8])*h+(Ut=u[9])*I+(Gt=u[10])*G+(or=u[11])*Ie,t[9]=Et*y+Ut*k+Gt*$+or*We,t[10]=Et*b+Ut*N+Gt*re+or*ze,t[11]=Et*S+Ut*U+Gt*Te+or*it,t[12]=(Et=u[12])*h+(Ut=u[13])*I+(Gt=u[14])*G+(or=u[15])*Ie,t[13]=Et*y+Ut*k+Gt*$+or*We,t[14]=Et*b+Ut*N+Gt*re+or*ze,t[15]=Et*S+Ut*U+Gt*Te+or*it,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,o=0,u=arguments.length;u--;)o+=t[u]*t[u];return Math.sqrt(o)});var Yu,Fs=As;function df(t,o,u){var h=o[0],y=o[1],b=o[2],S=o[3];return t[0]=u[0]*h+u[4]*y+u[8]*b+u[12]*S,t[1]=u[1]*h+u[5]*y+u[9]*b+u[13]*S,t[2]=u[2]*h+u[6]*y+u[10]*b+u[14]*S,t[3]=u[3]*h+u[7]*y+u[11]*b+u[15]*S,t}Yu=new ua(3),ua!=Float32Array&&(Yu[0]=0,Yu[1]=0,Yu[2]=0),function(){var t=new ua(4);ua!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var Yf=(function(){var t=new ua(2);ua!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function o(u){t.call(this,u,El)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new fs(u)},o.prototype.queryRadius=function(u){var h=u;return Ta("circle-radius",this,h)+Ta("circle-stroke-width",this,h)+no(this.paint.get("circle-translate"))},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,I,k,N){for(var U=Iu(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),I.angle,k),G=this.paint.get("circle-radius").evaluate(h,y)+this.paint.get("circle-stroke-width").evaluate(h,y),$=this.paint.get("circle-pitch-alignment")==="map",re=$?U:function(Ir,Qr){return Ir.map(function(kn){return gu(kn,Qr)})}(U,N),Te=$?G*k:G,Ie=0,We=b;Ie<We.length;Ie+=1)for(var ze=0,it=We[Ie];ze<it.length;ze+=1){var Et=it[ze],Ut=$?Et:gu(Et,N),Gt=Te,or=df([],[Et.x,Et.y,0,1],N);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Gt*=or[3]/I.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Gt*=I.cameraToCenterDistance/or[3]),ps(re,Ut,Gt))return!0}return!1},o}(Cu));function gu(t,o){var u=df([],[t.x,t.y,0,1],o);return new de(u[0]/u[3],u[1]/u[3])}var Ou=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(fs);function Hs(t,o,u,h){var y=o.width,b=o.height;if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==y*b*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(y*b*u);return t.width=y,t.height=b,t.data=h,t}function Ru(t,o,u){var h=o.width,y=o.height;if(h!==t.width||y!==t.height){var b=Hs({},{width:h,height:y},u);vc(t,b,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,h),height:Math.min(t.height,y)},u),t.width=h,t.height=y,t.data=b.data}}function vc(t,o,u,h,y,b){if(y.width===0||y.height===0)return o;if(y.width>t.width||y.height>t.height||u.x>t.width-y.width||u.y>t.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>o.width||y.height>o.height||h.x>o.width-y.width||h.y>o.height-y.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=t.data,I=o.data,k=0;k<y.height;k++)for(var N=((u.y+k)*t.width+u.x)*b,U=((h.y+k)*o.width+h.x)*b,G=0;G<y.width*b;G++)I[U+G]=S[N+G];return o}gn("HeatmapBucket",Ou,{omit:["layers"]});var yu=function(t,o){Hs(this,t,1,o)};yu.prototype.resize=function(t){Ru(this,t,1)},yu.prototype.clone=function(){return new yu({width:this.width,height:this.height},new Uint8Array(this.data))},yu.copy=function(t,o,u,h,y){vc(t,o,u,h,y,1)};var yo=function(t,o){Hs(this,t,4,o)};yo.prototype.resize=function(t){Ru(this,t,4)},yo.prototype.replace=function(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},yo.prototype.clone=function(){return new yo({width:this.width,height:this.height},new Uint8Array(this.data))},yo.copy=function(t,o,u,h,y){vc(t,o,u,h,y,4)},gn("AlphaImage",yu),gn("RGBAImage",yo);var Sl={paint:new ns({"heatmap-radius":new An(se.paint_heatmap["heatmap-radius"]),"heatmap-weight":new An(se.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Dn(se.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Oo(se.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Dn(se.paint_heatmap["heatmap-opacity"])})};function vf(t){var o={},u=t.resolution||256,h=t.clips?t.clips.length:1,y=t.image||new yo({width:u,height:h}),b=function(Te,Ie,We){o[t.evaluationKey]=We;var ze=t.expression.evaluate(o);y.data[Te+Ie+0]=Math.floor(255*ze.r/ze.a),y.data[Te+Ie+1]=Math.floor(255*ze.g/ze.a),y.data[Te+Ie+2]=Math.floor(255*ze.b/ze.a),y.data[Te+Ie+3]=Math.floor(255*ze.a)};if(t.clips)for(var S=0,I=0;S<h;++S,I+=4*u)for(var k=0,N=0;k<u;k++,N+=4){var U=k/(u-1),G=t.clips[S];b(I,N,G.start*(1-U)+G.end*U)}else for(var $=0,re=0;$<u;$++,re+=4)b(0,re,$/(u-1));return y}var qf=function(t){function o(u){t.call(this,u,Sl),this._updateColorRamp()}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new Ou(u)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="heatmap-color"&&this._updateColorRamp()},o.prototype._updateColorRamp=function(){this.colorRamp=vf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},o.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},o}(Cu),Hc={paint:new ns({"hillshade-illumination-direction":new Dn(se.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Dn(se.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Dn(se.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Dn(se.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Dn(se.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Dn(se.paint_hillshade["hillshade-accent-color"])})},Pp=function(t){function o(u){t.call(this,u,Hc)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},o}(Cu),nh=Da([{name:"a_pos",components:2,type:"Int16"}],4).members,Wl=Kf,tu=Kf;function Kf(t,o,u){u=u||2;var h,y,b,S,I,k,N,U=o&&o.length,G=U?o[0]*u:t.length,$=zh(t,0,G,u,!0),re=[];if(!$||$.next===$.prev)return re;if(U&&($=function(Ie,We,ze,it){var Et,Ut,Gt,or=[];for(Et=0,Ut=We.length;Et<Ut;Et++)(Gt=zh(Ie,We[Et]*it,Et<Ut-1?We[Et+1]*it:Ie.length,it,!1))===Gt.next&&(Gt.steiner=!0),or.push(jh(Gt));for(or.sort(wd),Et=0;Et<or.length;Et++)Zh(or[Et],ze),ze=Xl(ze,ze.next);return ze}(t,o,$,u)),t.length>80*u){h=b=t[0],y=S=t[1];for(var Te=u;Te<G;Te+=u)(I=t[Te])<h&&(h=I),(k=t[Te+1])<y&&(y=k),I>b&&(b=I),k>S&&(S=k);N=(N=Math.max(b-h,S-y))!==0?1/N:0}return mf($,re,u,h,y,N),re}function zh(t,o,u,h,y){var b,S;if(y===ep(t,o,u,h)>0)for(b=o;b<u;b+=h)S=Jf(b,t[b],t[b+1],S);else for(b=u-h;b>=o;b-=h)S=Jf(b,t[b],t[b+1],S);return S&&Qf(S,S.next)&&(gc(S),S=S.next),S}function Xl(t,o){if(!t)return t;o||(o=t);var u,h=t;do if(u=!1,h.steiner||!Qf(h,h.next)&&Ro(h.prev,h,h.next)!==0)h=h.next;else{if(gc(h),(h=o=h.prev)===h.next)break;u=!0}while(u||h!==o);return o}function mf(t,o,u,h,y,b,S){if(t){!S&&b&&function(U,G,$,re){var Te=U;do Te.z===null&&(Te.z=Ip(Te.x,Te.y,G,$,re)),Te.prevZ=Te.prev,Te.nextZ=Te.next,Te=Te.next;while(Te!==U);Te.prevZ.nextZ=null,Te.prevZ=null,function(Ie){var We,ze,it,Et,Ut,Gt,or,Ir,Qr=1;do{for(ze=Ie,Ie=null,Ut=null,Gt=0;ze;){for(Gt++,it=ze,or=0,We=0;We<Qr&&(or++,it=it.nextZ);We++);for(Ir=Qr;or>0||Ir>0&&it;)or!==0&&(Ir===0||!it||ze.z<=it.z)?(Et=ze,ze=ze.nextZ,or--):(Et=it,it=it.nextZ,Ir--),Ut?Ut.nextZ=Et:Ie=Et,Et.prevZ=Ut,Ut=Et;ze=it}Ut.nextZ=null,Qr*=2}while(Gt>1)}(Te)}(t,h,y,b);for(var I,k,N=t;t.prev!==t.next;)if(I=t.prev,k=t.next,b?Ad(t,h,y,b):Uh(t))o.push(I.i/u),o.push(t.i/u),o.push(k.i/u),gc(t),t=k.next,N=k.next;else if((t=k)===N){S?S===1?mf(t=gf(Xl(t),o,u),o,u,h,y,b,2):S===2&&$f(t,o,u,h,y,b):mf(Xl(t),o,u,h,y,b,1);break}}}function Uh(t){var o=t.prev,u=t,h=t.next;if(Ro(o,u,h)>=0)return!1;for(var y=t.next.next;y!==t.prev;){if(yf(o.x,o.y,u.x,u.y,h.x,h.y,y.x,y.y)&&Ro(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function Ad(t,o,u,h){var y=t.prev,b=t,S=t.next;if(Ro(y,b,S)>=0)return!1;for(var I=y.x>b.x?y.x>S.x?y.x:S.x:b.x>S.x?b.x:S.x,k=y.y>b.y?y.y>S.y?y.y:S.y:b.y>S.y?b.y:S.y,N=Ip(y.x<b.x?y.x<S.x?y.x:S.x:b.x<S.x?b.x:S.x,y.y<b.y?y.y<S.y?y.y:S.y:b.y<S.y?b.y:S.y,o,u,h),U=Ip(I,k,o,u,h),G=t.prevZ,$=t.nextZ;G&&G.z>=N&&$&&$.z<=U;){if(G!==t.prev&&G!==t.next&&yf(y.x,y.y,b.x,b.y,S.x,S.y,G.x,G.y)&&Ro(G.prev,G,G.next)>=0||(G=G.prevZ,$!==t.prev&&$!==t.next&&yf(y.x,y.y,b.x,b.y,S.x,S.y,$.x,$.y)&&Ro($.prev,$,$.next)>=0))return!1;$=$.nextZ}for(;G&&G.z>=N;){if(G!==t.prev&&G!==t.next&&yf(y.x,y.y,b.x,b.y,S.x,S.y,G.x,G.y)&&Ro(G.prev,G,G.next)>=0)return!1;G=G.prevZ}for(;$&&$.z<=U;){if($!==t.prev&&$!==t.next&&yf(y.x,y.y,b.x,b.y,S.x,S.y,$.x,$.y)&&Ro($.prev,$,$.next)>=0)return!1;$=$.nextZ}return!0}function gf(t,o,u){var h=t;do{var y=h.prev,b=h.next.next;!Qf(y,b)&&Vh(y,h,h.next,b)&&_f(y,b)&&_f(b,y)&&(o.push(y.i/u),o.push(h.i/u),o.push(b.i/u),gc(h),gc(h.next),h=t=b),h=h.next}while(h!==t);return Xl(h)}function $f(t,o,u,h,y,b){var S=t;do{for(var I=S.next.next;I!==S.prev;){if(S.i!==I.i&&Td(S,I)){var k=mc(S,I);return S=Xl(S,S.next),k=Xl(k,k.next),mf(S,o,u,h,y,b),void mf(k,o,u,h,y,b)}I=I.next}S=S.next}while(S!==t)}function wd(t,o){return t.x-o.x}function Zh(t,o){if(o=function(h,y){var b,S=y,I=h.x,k=h.y,N=-1/0;do{if(k<=S.y&&k>=S.next.y&&S.next.y!==S.y){var U=S.x+(k-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(U<=I&&U>N){if(N=U,U===I){if(k===S.y)return S;if(k===S.next.y)return S.next}b=S.x<S.next.x?S:S.next}}S=S.next}while(S!==y);if(!b)return null;if(I===N)return b;var G,$=b,re=b.x,Te=b.y,Ie=1/0;S=b;do I>=S.x&&S.x>=re&&I!==S.x&&yf(k<Te?I:N,k,re,Te,k<Te?N:I,k,S.x,S.y)&&(G=Math.abs(k-S.y)/(I-S.x),_f(S,h)&&(G<Ie||G===Ie&&(S.x>b.x||S.x===b.x&&ih(b,S)))&&(b=S,Ie=G)),S=S.next;while(S!==$);return b}(t,o)){var u=mc(o,t);Xl(o,o.next),Xl(u,u.next)}}function ih(t,o){return Ro(t.prev,t,o.prev)<0&&Ro(o.next,t,t.next)<0}function Ip(t,o,u,h,y){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-u)*y)|t<<8))|t<<4))|t<<2))|t<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-h)*y)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function jh(t){var o=t,u=t;do(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next;while(o!==t);return u}function yf(t,o,u,h,y,b,S,I){return(y-S)*(o-I)-(t-S)*(b-I)>=0&&(t-S)*(h-I)-(u-S)*(o-I)>=0&&(u-S)*(b-I)-(y-S)*(h-I)>=0}function Td(t,o){return t.next.i!==o.i&&t.prev.i!==o.i&&!function(u,h){var y=u;do{if(y.i!==u.i&&y.next.i!==u.i&&y.i!==h.i&&y.next.i!==h.i&&Vh(y,y.next,u,h))return!0;y=y.next}while(y!==u);return!1}(t,o)&&(_f(t,o)&&_f(o,t)&&function(u,h){var y=u,b=!1,S=(u.x+h.x)/2,I=(u.y+h.y)/2;do y.y>I!=y.next.y>I&&y.next.y!==y.y&&S<(y.next.x-y.x)*(I-y.y)/(y.next.y-y.y)+y.x&&(b=!b),y=y.next;while(y!==u);return b}(t,o)&&(Ro(t.prev,t,o.prev)||Ro(t,o.prev,o))||Qf(t,o)&&Ro(t.prev,t,t.next)>0&&Ro(o.prev,o,o.next)>0)}function Ro(t,o,u){return(o.y-t.y)*(u.x-o.x)-(o.x-t.x)*(u.y-o.y)}function Qf(t,o){return t.x===o.x&&t.y===o.y}function Vh(t,o,u,h){var y=Rp(Ro(t,o,u)),b=Rp(Ro(t,o,h)),S=Rp(Ro(u,h,t)),I=Rp(Ro(u,h,o));return y!==b&&S!==I||!(y!==0||!Op(t,u,o))||!(b!==0||!Op(t,h,o))||!(S!==0||!Op(u,t,h))||!(I!==0||!Op(u,o,h))}function Op(t,o,u){return o.x<=Math.max(t.x,u.x)&&o.x>=Math.min(t.x,u.x)&&o.y<=Math.max(t.y,u.y)&&o.y>=Math.min(t.y,u.y)}function Rp(t){return t>0?1:t<0?-1:0}function _f(t,o){return Ro(t.prev,t,t.next)<0?Ro(t,o,t.next)>=0&&Ro(t,t.prev,o)>=0:Ro(t,o,t.prev)<0||Ro(t,t.next,o)<0}function mc(t,o){var u=new xf(t.i,t.x,t.y),h=new xf(o.i,o.x,o.y),y=t.next,b=o.prev;return t.next=o,o.prev=t,u.next=y,y.prev=u,h.next=u,u.prev=h,b.next=h,h.prev=b,h}function Jf(t,o,u,h){var y=new xf(t,o,u);return h?(y.next=h.next,y.prev=h,h.next.prev=y,h.next=y):(y.prev=y,y.next=y),y}function gc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function xf(t,o,u){this.i=t,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ep(t,o,u,h){for(var y=0,b=o,S=u-h;b<u;b+=h)y+=(t[S]-t[b])*(t[b+1]+t[S+1]),S=b;return y}function Lp(t,o,u,h,y){(function b(S,I,k,N,U){for(;N>k;){if(N-k>600){var G=N-k+1,$=I-k+1,re=Math.log(G),Te=.5*Math.exp(2*re/3),Ie=.5*Math.sqrt(re*Te*(G-Te)/G)*($-G/2<0?-1:1);b(S,I,Math.max(k,Math.floor(I-$*Te/G+Ie)),Math.min(N,Math.floor(I+(G-$)*Te/G+Ie)),U)}var We=S[I],ze=k,it=N;for(Yl(S,k,I),U(S[N],We)>0&&Yl(S,k,N);ze<it;){for(Yl(S,ze,it),ze++,it--;U(S[ze],We)<0;)ze++;for(;U(S[it],We)>0;)it--}U(S[k],We)===0?Yl(S,k,it):Yl(S,++it,N),it<=I&&(k=it+1),I<=it&&(N=it-1)}})(t,o,u||0,h||t.length-1,y||kp)}function Yl(t,o,u){var h=t[o];t[o]=t[u],t[u]=h}function kp(t,o){return t<o?-1:t>o?1:0}function bf(t,o){var u=t.length;if(u<=1)return[t];for(var h,y,b=[],S=0;S<u;S++){var I=Ar(t[S]);I!==0&&(t[S].area=Math.abs(I),y===void 0&&(y=I<0),y===I<0?(h&&b.push(h),h=[t[S]]):h.push(t[S]))}if(h&&b.push(h),o>1)for(var k=0;k<b.length;k++)b[k].length<=o||(Lp(b[k],o,1,b[k].length-1,Ef),b[k]=b[k].slice(0,o));return b}function Ef(t,o){return o.area-t.area}function Sf(t,o,u){for(var h=u.patternDependencies,y=!1,b=0,S=o;b<S.length;b+=1){var I=S[b].paint.get(t+"-pattern");I.isConstant()||(y=!0);var k=I.constantOr(null);k&&(y=!0,h[k.to]=!0,h[k.from]=!0)}return y}function Cf(t,o,u,h,y){for(var b=y.patternDependencies,S=0,I=o;S<I.length;S+=1){var k=I[S],N=k.paint.get(t+"-pattern").value;if(N.kind!=="constant"){var U=N.evaluate({zoom:h-1},u,{},y.availableImages),G=N.evaluate({zoom:h},u,{},y.availableImages),$=N.evaluate({zoom:h+1},u,{},y.availableImages);G=G&&G.name?G.name:G,$=$&&$.name?$.name:$,b[U=U&&U.name?U.name:U]=!0,b[G]=!0,b[$]=!0,u.patterns[k.id]={min:U,mid:G,max:$}}}return u}Kf.deviation=function(t,o,u,h){var y=o&&o.length,b=Math.abs(ep(t,0,y?o[0]*u:t.length,u));if(y)for(var S=0,I=o.length;S<I;S++)b-=Math.abs(ep(t,o[S]*u,S<I-1?o[S+1]*u:t.length,u));var k=0;for(S=0;S<h.length;S+=3){var N=h[S]*u,U=h[S+1]*u,G=h[S+2]*u;k+=Math.abs((t[N]-t[G])*(t[U+1]-t[N+1])-(t[N]-t[U])*(t[G+1]-t[N+1]))}return b===0&&k===0?0:Math.abs((k-b)/b)},Kf.flatten=function(t){for(var o=t[0][0].length,u={vertices:[],holes:[],dimensions:o},h=0,y=0;y<t.length;y++){for(var b=0;b<t[y].length;b++)for(var S=0;S<o;S++)u.vertices.push(t[y][b][S]);y>0&&u.holes.push(h+=t[y-1].length)}return u},Wl.default=tu;var ru=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new xl,this.indexArray=new vu,this.indexArray2=new Mu,this.programConfigurations=new Wn(t.layers,t.zoom),this.segments=new ue,this.segments2=new ue,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};ru.prototype.populate=function(t,o,u){this.hasPattern=Sf("fill",this.layers,o);for(var h=this.layers[0].layout.get("fill-sort-key"),y=[],b=0,S=t;b<S.length;b+=1){var I=S[b],k=I.feature,N=I.id,U=I.index,G=I.sourceLayerIndex,$=this.layers[0]._featureFilter.needGeometry,re=lo(k,$);if(this.layers[0]._featureFilter.filter(new Ii(this.zoom),re,u)){var Te=h?h.evaluate(re,{},u,o.availableImages):void 0,Ie={id:N,properties:k.properties,type:k.type,sourceLayerIndex:G,index:U,geometry:$?re.geometry:$a(k),patterns:{},sortKey:Te};y.push(Ie)}}h&&y.sort(function(Ir,Qr){return Ir.sortKey-Qr.sortKey});for(var We=0,ze=y;We<ze.length;We+=1){var it=ze[We],Et=it.geometry,Ut=it.index,Gt=it.sourceLayerIndex;if(this.hasPattern){var or=Cf("fill",this.layers,it,this.zoom,o);this.patternFeatures.push(or)}else this.addFeature(it,Et,Ut,u,{});o.featureIndex.insert(t[Ut].feature,Et,Ut,Gt,this.index)}},ru.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},ru.prototype.addFeatures=function(t,o,u){for(var h=0,y=this.patternFeatures;h<y.length;h+=1){var b=y[h];this.addFeature(b,b.geometry,b.index,o,u)}},ru.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ru.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ru.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,nh),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},ru.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},ru.prototype.addFeature=function(t,o,u,h,y){for(var b=0,S=bf(o,500);b<S.length;b+=1){for(var I=S[b],k=0,N=0,U=I;N<U.length;N+=1)k+=U[N].length;for(var G=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray),$=G.vertexLength,re=[],Te=[],Ie=0,We=I;Ie<We.length;Ie+=1){var ze=We[Ie];if(ze.length!==0){ze!==I[0]&&Te.push(re.length/2);var it=this.segments2.prepareSegment(ze.length,this.layoutVertexArray,this.indexArray2),Et=it.vertexLength;this.layoutVertexArray.emplaceBack(ze[0].x,ze[0].y),this.indexArray2.emplaceBack(Et+ze.length-1,Et),re.push(ze[0].x),re.push(ze[0].y);for(var Ut=1;Ut<ze.length;Ut++)this.layoutVertexArray.emplaceBack(ze[Ut].x,ze[Ut].y),this.indexArray2.emplaceBack(Et+Ut-1,Et+Ut),re.push(ze[Ut].x),re.push(ze[Ut].y);it.vertexLength+=ze.length,it.primitiveLength+=ze.length}}for(var Gt=Wl(re,Te),or=0;or<Gt.length;or+=3)this.indexArray.emplaceBack($+Gt[or],$+Gt[or+1],$+Gt[or+2]);G.vertexLength+=k,G.primitiveLength+=Gt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,h)},gn("FillBucket",ru,{omit:["layers","patternFeatures"]});var tp=new ns({"fill-sort-key":new An(se.layout_fill["fill-sort-key"])}),rp={paint:new ns({"fill-antialias":new Dn(se.paint_fill["fill-antialias"]),"fill-opacity":new An(se.paint_fill["fill-opacity"]),"fill-color":new An(se.paint_fill["fill-color"]),"fill-outline-color":new An(se.paint_fill["fill-outline-color"]),"fill-translate":new Dn(se.paint_fill["fill-translate"]),"fill-translate-anchor":new Dn(se.paint_fill["fill-translate-anchor"]),"fill-pattern":new Zc(se.paint_fill["fill-pattern"])}),layout:tp},np=function(t){function o(u){t.call(this,u,rp)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,h){t.prototype.recalculate.call(this,u,h);var y=this.paint._values["fill-outline-color"];y.value.kind==="constant"&&y.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},o.prototype.createBucket=function(u){return new ru(u)},o.prototype.queryRadius=function(){return no(this.paint.get("fill-translate"))},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,I,k){return is(Iu(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),I.angle,k),b)},o.prototype.isTileClipped=function(){return!0},o}(Cu),Cl=Da([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Dp=Al;function Al(t,o,u,h,y){this.properties={},this.extent=u,this.type=0,this._pbf=t,this._geometry=-1,this._keys=h,this._values=y,t.readFields(Wc,this,o)}function Wc(t,o,u){t==1?o.id=u.readVarint():t==2?function(h,y){for(var b=h.readVarint()+h.pos;h.pos<b;){var S=y._keys[h.readVarint()],I=y._values[h.readVarint()];y.properties[S]=I}}(u,o):t==3?o.type=u.readVarint():t==4&&(o._geometry=u.pos)}function Gh(t){for(var o,u,h=0,y=0,b=t.length,S=b-1;y<b;S=y++)h+=((u=t[S]).x-(o=t[y]).x)*(o.y+u.y);return h}Al.types=["Unknown","Point","LineString","Polygon"],Al.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var o,u=t.readVarint()+t.pos,h=1,y=0,b=0,S=0,I=[];t.pos<u;){if(y<=0){var k=t.readVarint();h=7&k,y=k>>3}if(y--,h===1||h===2)b+=t.readSVarint(),S+=t.readSVarint(),h===1&&(o&&I.push(o),o=[]),o.push(new de(b,S));else{if(h!==7)throw new Error("unknown command "+h);o&&o.push(o[0].clone())}}return o&&I.push(o),I},Al.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var o=t.readVarint()+t.pos,u=1,h=0,y=0,b=0,S=1/0,I=-1/0,k=1/0,N=-1/0;t.pos<o;){if(h<=0){var U=t.readVarint();u=7&U,h=U>>3}if(h--,u===1||u===2)(y+=t.readSVarint())<S&&(S=y),y>I&&(I=y),(b+=t.readSVarint())<k&&(k=b),b>N&&(N=b);else if(u!==7)throw new Error("unknown command "+u)}return[S,k,I,N]},Al.prototype.toGeoJSON=function(t,o,u){var h,y,b=this.extent*Math.pow(2,u),S=this.extent*t,I=this.extent*o,k=this.loadGeometry(),N=Al.types[this.type];function U(re){for(var Te=0;Te<re.length;Te++){var Ie=re[Te];re[Te]=[360*(Ie.x+S)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ie.y+I)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(h=0;h<k.length;h++)G[h]=k[h][0];U(k=G);break;case 2:for(h=0;h<k.length;h++)U(k[h]);break;case 3:for(k=function(re){var Te=re.length;if(Te<=1)return[re];for(var Ie,We,ze=[],it=0;it<Te;it++){var Et=Gh(re[it]);Et!==0&&(We===void 0&&(We=Et<0),We===Et<0?(Ie&&ze.push(Ie),Ie=[re[it]]):Ie.push(re[it]))}return Ie&&ze.push(Ie),ze}(k),h=0;h<k.length;h++)for(y=0;y<k[h].length;y++)U(k[h][y])}k.length===1?k=k[0]:N="Multi"+N;var $={type:"Feature",geometry:{type:N,coordinates:k},properties:this.properties};return"id"in this&&($.id=this.id),$};var ip=ah;function ah(t,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Md,this,o),this.length=this._features.length}function Md(t,o,u){t===15?o.version=u.readVarint():t===1?o.name=u.readString():t===5?o.extent=u.readVarint():t===2?o._features.push(u.pos):t===3?o._keys.push(u.readString()):t===4&&o._values.push(function(h){for(var y=null,b=h.readVarint()+h.pos;h.pos<b;){var S=h.readVarint()>>3;y=S===1?h.readString():S===2?h.readFloat():S===3?h.readDouble():S===4?h.readVarint64():S===5?h.readVarint():S===6?h.readSVarint():S===7?h.readBoolean():null}return y}(u))}function Pd(t,o,u){if(t===3){var h=new ip(u,u.readVarint()+u.pos);h.length&&(o[h.name]=h)}}ah.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var o=this._pbf.readVarint()+this._pbf.pos;return new Dp(this._pbf,o,this.extent,this._keys,this._values)};var _u={VectorTile:function(t,o){this.layers=t.readFields(Pd,{},o)},VectorTileFeature:Dp,VectorTileLayer:ip},oh=_u.VectorTileFeature.types,Fp=Math.pow(2,13);function Af(t,o,u,h,y,b,S,I){t.emplaceBack(o,u,2*Math.floor(h*Fp)+S,y*Fp*2,b*Fp*2,Math.round(I))}var sl=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new hu,this.indexArray=new vu,this.programConfigurations=new Wn(t.layers,t.zoom),this.segments=new ue,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function Hh(t,o){return t.x===o.x&&(t.x<0||t.x>8192)||t.y===o.y&&(t.y<0||t.y>8192)}sl.prototype.populate=function(t,o,u){this.features=[],this.hasPattern=Sf("fill-extrusion",this.layers,o);for(var h=0,y=t;h<y.length;h+=1){var b=y[h],S=b.feature,I=b.id,k=b.index,N=b.sourceLayerIndex,U=this.layers[0]._featureFilter.needGeometry,G=lo(S,U);if(this.layers[0]._featureFilter.filter(new Ii(this.zoom),G,u)){var $={id:I,sourceLayerIndex:N,index:k,geometry:U?G.geometry:$a(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(Cf("fill-extrusion",this.layers,$,this.zoom,o)):this.addFeature($,$.geometry,k,u,{}),o.featureIndex.insert(S,$.geometry,k,N,this.index,!0)}}},sl.prototype.addFeatures=function(t,o,u){for(var h=0,y=this.features;h<y.length;h+=1){var b=y[h];this.addFeature(b,b.geometry,b.index,o,u)}},sl.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},sl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},sl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},sl.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Cl),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},sl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},sl.prototype.addFeature=function(t,o,u,h,y){for(var b=0,S=bf(o,500);b<S.length;b+=1){for(var I=S[b],k=0,N=0,U=I;N<U.length;N+=1)k+=U[N].length;for(var G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),$=0,re=I;$<re.length;$+=1){var Te=re[$];if(Te.length!==0&&!((Fi=Te).every(function(Si){return Si.x<0})||Fi.every(function(Si){return Si.x>8192})||Fi.every(function(Si){return Si.y<0})||Fi.every(function(Si){return Si.y>8192})))for(var Ie=0,We=0;We<Te.length;We++){var ze=Te[We];if(We>=1){var it=Te[We-1];if(!Hh(ze,it)){G.vertexLength+4>ue.MAX_VERTEX_ARRAY_LENGTH&&(G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Et=ze.sub(it)._perp()._unit(),Ut=it.dist(ze);Ie+Ut>32768&&(Ie=0),Af(this.layoutVertexArray,ze.x,ze.y,Et.x,Et.y,0,0,Ie),Af(this.layoutVertexArray,ze.x,ze.y,Et.x,Et.y,0,1,Ie),Af(this.layoutVertexArray,it.x,it.y,Et.x,Et.y,0,0,Ie+=Ut),Af(this.layoutVertexArray,it.x,it.y,Et.x,Et.y,0,1,Ie);var Gt=G.vertexLength;this.indexArray.emplaceBack(Gt,Gt+2,Gt+1),this.indexArray.emplaceBack(Gt+1,Gt+2,Gt+3),G.vertexLength+=4,G.primitiveLength+=2}}}}if(G.vertexLength+k>ue.MAX_VERTEX_ARRAY_LENGTH&&(G=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),oh[t.type]==="Polygon"){for(var or=[],Ir=[],Qr=G.vertexLength,kn=0,pn=I;kn<pn.length;kn+=1){var zn=pn[kn];if(zn.length!==0){zn!==I[0]&&Ir.push(or.length/2);for(var hn=0;hn<zn.length;hn++){var hi=zn[hn];Af(this.layoutVertexArray,hi.x,hi.y,0,0,1,1,0),or.push(hi.x),or.push(hi.y)}}}for(var Vn=Wl(or,Ir),Mn=0;Mn<Vn.length;Mn+=3)this.indexArray.emplaceBack(Qr+Vn[Mn],Qr+Vn[Mn+2],Qr+Vn[Mn+1]);G.primitiveLength+=Vn.length/3,G.vertexLength+=k}}var Fi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,h)},gn("FillExtrusionBucket",sl,{omit:["layers","features"]});var sh={paint:new ns({"fill-extrusion-opacity":new Dn(se["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new An(se["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Dn(se["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Dn(se["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Zc(se["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new An(se["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new An(se["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Dn(se["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},ql=function(t){function o(u){t.call(this,u,sh)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new sl(u)},o.prototype.queryRadius=function(){return no(this.paint.get("fill-extrusion-translate"))},o.prototype.is3D=function(){return!0},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,I,k,N){var U=Iu(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),I.angle,k),G=this.paint.get("fill-extrusion-height").evaluate(h,y),$=this.paint.get("fill-extrusion-base").evaluate(h,y),re=function(Ie,We,ze,it){for(var Et=[],Ut=0,Gt=Ie;Ut<Gt.length;Ut+=1){var or=Gt[Ut],Ir=[or.x,or.y,0,1];df(Ir,Ir,We),Et.push(new de(Ir[0]/Ir[3],Ir[1]/Ir[3]))}return Et}(U,N),Te=function(Ie,We,ze,it){for(var Et=[],Ut=[],Gt=it[8]*We,or=it[9]*We,Ir=it[10]*We,Qr=it[11]*We,kn=it[8]*ze,pn=it[9]*ze,zn=it[10]*ze,hn=it[11]*ze,hi=0,Vn=Ie;hi<Vn.length;hi+=1){for(var Mn=[],Fi=[],Si=0,Yi=Vn[hi];Si<Yi.length;Si+=1){var jn=Yi[Si],da=jn.x,ao=jn.y,Ao=it[0]*da+it[4]*ao+it[12],Ha=it[1]*da+it[5]*ao+it[13],Hi=it[2]*da+it[6]*ao+it[14],_o=it[3]*da+it[7]*ao+it[15],Qo=Hi+Ir,Jo=_o+Qr,Ts=Ao+kn,ss=Ha+pn,Ws=Hi+zn,Lo=_o+hn,ms=new de((Ao+Gt)/Jo,(Ha+or)/Jo);ms.z=Qo/Jo,Mn.push(ms);var Wi=new de(Ts/Lo,ss/Lo);Wi.z=Ws/Lo,Fi.push(Wi)}Et.push(Mn),Ut.push(Fi)}return[Et,Ut]}(b,$,G,N);return function(Ie,We,ze){var it=1/0;is(ze,We)&&(it=Xc(ze,We[0]));for(var Et=0;Et<We.length;Et++)for(var Ut=We[Et],Gt=Ie[Et],or=0;or<Ut.length-1;or++){var Ir=Ut[or],Qr=[Ir,Ut[or+1],Gt[or+1],Gt[or],Ir];Uo(ze,Qr)&&(it=Math.min(it,Xc(ze,Qr)))}return it!==1/0&&it}(Te[0],Te[1],re)},o}(Cu);function Nr(t,o){return t.x*o.x+t.y*o.y}function Xc(t,o){if(t.length===1){for(var u,h=0,y=o[h++];!u||y.equals(u);)if(!(u=o[h++]))return 1/0;for(;h<o.length;h++){var b=o[h],S=t[0],I=u.sub(y),k=b.sub(y),N=S.sub(y),U=Nr(I,I),G=Nr(I,k),$=Nr(k,k),re=Nr(N,I),Te=Nr(N,k),Ie=U*$-G*G,We=($*re-G*Te)/Ie,ze=(U*Te-G*re)/Ie,it=y.z*(1-We-ze)+u.z*We+b.z*ze;if(isFinite(it))return it}return 1/0}for(var Et=1/0,Ut=0,Gt=o;Ut<Gt.length;Ut+=1)Et=Math.min(Et,Gt[Ut].z);return Et}var zt=Da([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Wh=Da([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,uh=_u.VectorTileFeature.types,ap=Math.cos(Math.PI/180*37.5),Bp=Math.pow(2,14)/.5,ha=function(t){var o=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(u){o.gradients[u.id]={}}),this.layoutVertexArray=new Yo,this.layoutVertexArray2=new al,this.indexArray=new vu,this.programConfigurations=new Wn(t.layers,t.zoom),this.segments=new ue,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};ha.prototype.populate=function(t,o,u){this.hasPattern=Sf("line",this.layers,o);for(var h=this.layers[0].layout.get("line-sort-key"),y=[],b=0,S=t;b<S.length;b+=1){var I=S[b],k=I.feature,N=I.id,U=I.index,G=I.sourceLayerIndex,$=this.layers[0]._featureFilter.needGeometry,re=lo(k,$);if(this.layers[0]._featureFilter.filter(new Ii(this.zoom),re,u)){var Te=h?h.evaluate(re,{},u):void 0,Ie={id:N,properties:k.properties,type:k.type,sourceLayerIndex:G,index:U,geometry:$?re.geometry:$a(k),patterns:{},sortKey:Te};y.push(Ie)}}h&&y.sort(function(Ir,Qr){return Ir.sortKey-Qr.sortKey});for(var We=0,ze=y;We<ze.length;We+=1){var it=ze[We],Et=it.geometry,Ut=it.index,Gt=it.sourceLayerIndex;if(this.hasPattern){var or=Cf("line",this.layers,it,this.zoom,o);this.patternFeatures.push(or)}else this.addFeature(it,Et,Ut,u,{});o.featureIndex.insert(t[Ut].feature,Et,Ut,Gt,this.index)}},ha.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},ha.prototype.addFeatures=function(t,o,u){for(var h=0,y=this.patternFeatures;h<y.length;h+=1){var b=y[h];this.addFeature(b,b.geometry,b.index,o,u)}},ha.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ha.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ha.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Wh)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,zt),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},ha.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ha.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},ha.prototype.addFeature=function(t,o,u,h,y){var b=this.layers[0].layout,S=b.get("line-join").evaluate(t,{}),I=b.get("line-cap"),k=b.get("line-miter-limit"),N=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var U=0,G=o;U<G.length;U+=1)this.addLine(G[U],t,S,I,k,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,h)},ha.prototype.addLine=function(t,o,u,h,y,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<t.length-1;S++)this.totalDistance+=t[S].dist(t[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var I=uh[o.type]==="Polygon",k=t.length;k>=2&&t[k-1].equals(t[k-2]);)k--;for(var N=0;N<k-1&&t[N].equals(t[N+1]);)N++;if(!(k<(I?3:2))){u==="bevel"&&(y=1.05);var U,G=this.overscaling<=16?122880/(512*this.overscaling):0,$=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray),re=void 0,Te=void 0,Ie=void 0,We=void 0;this.e1=this.e2=-1,I&&(We=t[N].sub(U=t[k-2])._unit()._perp());for(var ze=N;ze<k;ze++)if(!(Te=ze===k-1?I?t[N+1]:void 0:t[ze+1])||!t[ze].equals(Te)){We&&(Ie=We),U&&(re=U),U=t[ze],We=Te?Te.sub(U)._unit()._perp():Ie;var it=(Ie=Ie||We).add(We);it.x===0&&it.y===0||it._unit();var Et=Ie.x*We.x+Ie.y*We.y,Ut=it.x*We.x+it.y*We.y,Gt=Ut!==0?1/Ut:1/0,or=2*Math.sqrt(2-2*Ut),Ir=Ut<ap&&re&&Te,Qr=Ie.x*We.y-Ie.y*We.x>0;if(Ir&&ze>N){var kn=U.dist(re);if(kn>2*G){var pn=U.sub(U.sub(re)._mult(G/kn)._round());this.updateDistance(re,pn),this.addCurrentVertex(pn,Ie,0,0,$),re=pn}}var zn=re&&Te,hn=zn?u:I?"butt":h;if(zn&&hn==="round"&&(Gt<b?hn="miter":Gt<=2&&(hn="fakeround")),hn==="miter"&&Gt>y&&(hn="bevel"),hn==="bevel"&&(Gt>2&&(hn="flipbevel"),Gt<y&&(hn="miter")),re&&this.updateDistance(re,U),hn==="miter")it._mult(Gt),this.addCurrentVertex(U,it,0,0,$);else if(hn==="flipbevel"){if(Gt>100)it=We.mult(-1);else{var hi=Gt*Ie.add(We).mag()/Ie.sub(We).mag();it._perp()._mult(hi*(Qr?-1:1))}this.addCurrentVertex(U,it,0,0,$),this.addCurrentVertex(U,it.mult(-1),0,0,$)}else if(hn==="bevel"||hn==="fakeround"){var Vn=-Math.sqrt(Gt*Gt-1),Mn=Qr?Vn:0,Fi=Qr?0:Vn;if(re&&this.addCurrentVertex(U,Ie,Mn,Fi,$),hn==="fakeround")for(var Si=Math.round(180*or/Math.PI/20),Yi=1;Yi<Si;Yi++){var jn=Yi/Si;if(jn!==.5){var da=jn-.5;jn+=jn*da*(jn-1)*((1.0904+Et*(Et*(3.55645-1.43519*Et)-3.2452))*da*da+(.848013+Et*(.215638*Et-1.06021)))}var ao=We.sub(Ie)._mult(jn)._add(Ie)._unit()._mult(Qr?-1:1);this.addHalfVertex(U,ao.x,ao.y,!1,Qr,0,$)}Te&&this.addCurrentVertex(U,We,-Mn,-Fi,$)}else if(hn==="butt")this.addCurrentVertex(U,it,0,0,$);else if(hn==="square"){var Ao=re?1:-1;this.addCurrentVertex(U,it,Ao,Ao,$)}else hn==="round"&&(re&&(this.addCurrentVertex(U,Ie,0,0,$),this.addCurrentVertex(U,Ie,1,1,$,!0)),Te&&(this.addCurrentVertex(U,We,-1,-1,$,!0),this.addCurrentVertex(U,We,0,0,$)));if(Ir&&ze<k-1){var Ha=U.dist(Te);if(Ha>2*G){var Hi=U.add(Te.sub(U)._mult(G/Ha)._round());this.updateDistance(U,Hi),this.addCurrentVertex(Hi,We,0,0,$),U=Hi}}}}},ha.prototype.addCurrentVertex=function(t,o,u,h,y,b){b===void 0&&(b=!1);var S=o.y*h-o.x,I=-o.y-o.x*h;this.addHalfVertex(t,o.x+o.y*u,o.y-o.x*u,b,!1,u,y),this.addHalfVertex(t,S,I,b,!0,-h,y),this.distance>Bp/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,o,u,h,y,b))},ha.prototype.addHalfVertex=function(t,o,u,h,y,b,S){var I=.5*(this.lineClips?this.scaledDistance*(Bp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(h?1:0),(t.y<<1)+(y?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(b===0?0:b<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var k=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),S.primitiveLength++),y?this.e2=k:this.e1=k},ha.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},ha.prototype.updateDistance=function(t,o){this.distance+=t.dist(o),this.updateScaledDistance()},gn("LineBucket",ha,{omit:["layers","patternFeatures"]});var yc=new ns({"line-cap":new Dn(se.layout_line["line-cap"]),"line-join":new An(se.layout_line["line-join"]),"line-miter-limit":new Dn(se.layout_line["line-miter-limit"]),"line-round-limit":new Dn(se.layout_line["line-round-limit"]),"line-sort-key":new An(se.layout_line["line-sort-key"])}),Eo={paint:new ns({"line-opacity":new An(se.paint_line["line-opacity"]),"line-color":new An(se.paint_line["line-color"]),"line-translate":new Dn(se.paint_line["line-translate"]),"line-translate-anchor":new Dn(se.paint_line["line-translate-anchor"]),"line-width":new An(se.paint_line["line-width"]),"line-gap-width":new An(se.paint_line["line-gap-width"]),"line-offset":new An(se.paint_line["line-offset"]),"line-blur":new An(se.paint_line["line-blur"]),"line-dasharray":new cs(se.paint_line["line-dasharray"]),"line-pattern":new Zc(se.paint_line["line-pattern"]),"line-gradient":new Oo(se.paint_line["line-gradient"])}),layout:yc},hs=new(function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,h){return h=new Ii(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),t.prototype.possiblyEvaluate.call(this,u,h)},o.prototype.evaluate=function(u,h,y,b){return h=Lt({},h,{zoom:Math.floor(h.zoom)}),t.prototype.evaluate.call(this,u,h,y,b)},o}(An))(Eo.paint.properties["line-width"].specification);hs.useIntegerZoom=!0;var Xh=function(t){function o(u){t.call(this,u,Eo),this.gradientVersion=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof bs,this.gradientVersion=(this.gradientVersion+1)%tt)},o.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},o.prototype.recalculate=function(u,h){t.prototype.recalculate.call(this,u,h),this.paint._values["line-floorwidth"]=hs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)},o.prototype.createBucket=function(u){return new ha(u)},o.prototype.queryRadius=function(u){var h=u,y=Yh(Ta("line-width",this,h),Ta("line-gap-width",this,h)),b=Ta("line-offset",this,h);return y/2+Math.abs(b)+no(this.paint.get("line-translate"))},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,I,k){var N=Iu(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),I.angle,k),U=k/2*Yh(this.paint.get("line-width").evaluate(h,y),this.paint.get("line-gap-width").evaluate(h,y)),G=this.paint.get("line-offset").evaluate(h,y);return G&&(b=function($,re){for(var Te=[],Ie=new de(0,0),We=0;We<$.length;We++){for(var ze=$[We],it=[],Et=0;Et<ze.length;Et++){var Ut=ze[Et],Gt=ze[Et+1],or=Et===0?Ie:Ut.sub(ze[Et-1])._unit()._perp(),Ir=Et===ze.length-1?Ie:Gt.sub(Ut)._unit()._perp(),Qr=or._add(Ir)._unit();Qr._mult(1/(Qr.x*Ir.x+Qr.y*Ir.y)),it.push(Qr._mult(re)._add(Ut))}Te.push(it)}return Te}(b,G*k)),function($,re,Te){for(var Ie=0;Ie<re.length;Ie++){var We=re[Ie];if($.length>=3){for(var ze=0;ze<We.length;ze++)if(mu($,We[ze]))return!0}if(Js($,We,Te))return!0}return!1}(N,b,U)},o.prototype.isTileClipped=function(){return!0},o}(Cu);function Yh(t,o){return o>0?o+2*t:t}var qh=Da([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Kh=Da([{name:"a_projected_pos",components:3,type:"Float32"}],4),$h=(Da([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Da([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Np=(Da([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Da([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Qh=Da([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Id(t,o,u){return t.sections.forEach(function(h){h.text=function(y,b,S){var I=b.layout.get("text-transform").evaluate(S,{});return I==="uppercase"?y=y.toLocaleUpperCase():I==="lowercase"&&(y=y.toLocaleLowerCase()),Us.applyArabicShaping&&(y=Us.applyArabicShaping(y)),y}(h.text,o,u)}),t}Da([{name:"triangle",components:3,type:"Uint16"}]),Da([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Da([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Da([{type:"Float32",name:"offsetX"}]),Da([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var wf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},lh=function(t,o,u,h,y){var b,S,I=8*y-h-1,k=(1<<I)-1,N=k>>1,U=-7,G=u?y-1:0,$=u?-1:1,re=t[o+G];for(G+=$,b=re&(1<<-U)-1,re>>=-U,U+=I;U>0;b=256*b+t[o+G],G+=$,U-=8);for(S=b&(1<<-U)-1,b>>=-U,U+=h;U>0;S=256*S+t[o+G],G+=$,U-=8);if(b===0)b=1-N;else{if(b===k)return S?NaN:1/0*(re?-1:1);S+=Math.pow(2,h),b-=N}return(re?-1:1)*S*Math.pow(2,b-h)},zp=function(t,o,u,h,y,b){var S,I,k,N=8*b-y-1,U=(1<<N)-1,G=U>>1,$=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,re=h?0:b-1,Te=h?1:-1,Ie=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(I=isNaN(o)?1:0,S=U):(S=Math.floor(Math.log(o)/Math.LN2),o*(k=Math.pow(2,-S))<1&&(S--,k*=2),(o+=S+G>=1?$/k:$*Math.pow(2,1-G))*k>=2&&(S++,k/=2),S+G>=U?(I=0,S=U):S+G>=1?(I=(o*k-1)*Math.pow(2,y),S+=G):(I=o*Math.pow(2,G-1)*Math.pow(2,y),S=0));y>=8;t[u+re]=255&I,re+=Te,I/=256,y-=8);for(S=S<<y|I,N+=y;N>0;t[u+re]=255&S,re+=Te,S/=256,N-=8);t[u+re-Te]|=128*Ie},op=Ma;function Ma(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Ma.Varint=0,Ma.Fixed64=1,Ma.Bytes=2,Ma.Fixed32=5;var ch=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Kl(t){return t.type===Ma.Bytes?t.readVarint()+t.pos:t.pos+1}function Tf(t,o,u){return u?4294967296*o+(t>>>0):4294967296*(o>>>0)+(t>>>0)}function fh(t,o,u){var h=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(h);for(var y=u.pos-1;y>=t;y--)u.buf[y+h]=u.buf[y]}function Od(t,o){for(var u=0;u<t.length;u++)o.writeVarint(t[u])}function B(t,o){for(var u=0;u<t.length;u++)o.writeSVarint(t[u])}function ce(t,o){for(var u=0;u<t.length;u++)o.writeFloat(t[u])}function Fe(t,o){for(var u=0;u<t.length;u++)o.writeDouble(t[u])}function Rt(t,o){for(var u=0;u<t.length;u++)o.writeBoolean(t[u])}function ar(t,o){for(var u=0;u<t.length;u++)o.writeFixed32(t[u])}function It(t,o){for(var u=0;u<t.length;u++)o.writeSFixed32(t[u])}function Kt(t,o){for(var u=0;u<t.length;u++)o.writeFixed64(t[u])}function cr(t,o){for(var u=0;u<t.length;u++)o.writeSFixed64(t[u])}function mr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+16777216*t[o+3]}function yr(t,o,u){t[u]=o,t[u+1]=o>>>8,t[u+2]=o>>>16,t[u+3]=o>>>24}function Sr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+(t[o+3]<<24)}function Mr(t,o,u){t===1&&u.readMessage(Gr,o)}function Gr(t,o,u){if(t===3){var h=u.readMessage(_r,{}),y=h.width,b=h.height,S=h.left,I=h.top,k=h.advance;o.push({id:h.id,bitmap:new yu({width:y+6,height:b+6},h.bitmap),metrics:{width:y,height:b,left:S,top:I,advance:k}})}}function _r(t,o,u){t===1?o.id=u.readVarint():t===2?o.bitmap=u.readBytes():t===3?o.width=u.readVarint():t===4?o.height=u.readVarint():t===5?o.left=u.readSVarint():t===6?o.top=u.readSVarint():t===7&&(o.advance=u.readVarint())}function br(t){for(var o=0,u=0,h=0,y=t;h<y.length;h+=1){var b=y[h];o+=b.w*b.h,u=Math.max(u,b.w)}t.sort(function(Ie,We){return We.h-Ie.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}],I=0,k=0,N=0,U=t;N<U.length;N+=1)for(var G=U[N],$=S.length-1;$>=0;$--){var re=S[$];if(!(G.w>re.w||G.h>re.h)){if(G.x=re.x,G.y=re.y,k=Math.max(k,G.y+G.h),I=Math.max(I,G.x+G.w),G.w===re.w&&G.h===re.h){var Te=S.pop();$<S.length&&(S[$]=Te)}else G.h===re.h?(re.x+=G.w,re.w-=G.w):G.w===re.w?(re.y+=G.h,re.h-=G.h):(S.push({x:re.x+G.w,y:re.y,w:re.w-G.w,h:G.h}),re.y+=G.h,re.h-=G.h);break}}return{w:I,h:k,fill:o/(I*k)||0}}Ma.prototype={destroy:function(){this.buf=null},readFields:function(t,o,u){for(u=u||this.length;this.pos<u;){var h=this.readVarint(),y=h>>3,b=this.pos;this.type=7&h,t(y,o,this),this.pos===b&&this.skip(h)}return o},readMessage:function(t,o){return this.readFields(t,o,this.readVarint()+this.pos)},readFixed32:function(){var t=mr(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Sr(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=mr(this.buf,this.pos)+4294967296*mr(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=mr(this.buf,this.pos)+4294967296*Sr(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=lh(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=lh(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var o,u,h=this.buf;return o=127&(u=h[this.pos++]),u<128?o:(o|=(127&(u=h[this.pos++]))<<7,u<128?o:(o|=(127&(u=h[this.pos++]))<<14,u<128?o:(o|=(127&(u=h[this.pos++]))<<21,u<128?o:function(y,b,S){var I,k,N=S.buf;if(I=(112&(k=N[S.pos++]))>>4,k<128||(I|=(127&(k=N[S.pos++]))<<3,k<128)||(I|=(127&(k=N[S.pos++]))<<10,k<128)||(I|=(127&(k=N[S.pos++]))<<17,k<128)||(I|=(127&(k=N[S.pos++]))<<24,k<128)||(I|=(1&(k=N[S.pos++]))<<31,k<128))return Tf(y,I,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=h[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,o=this.pos;return this.pos=t,t-o>=12&&ch?function(u,h,y){return ch.decode(u.subarray(h,y))}(this.buf,o,t):function(u,h,y){for(var b="",S=h;S<y;){var I,k,N,U=u[S],G=null,$=U>239?4:U>223?3:U>191?2:1;if(S+$>y)break;$===1?U<128&&(G=U):$===2?(192&(I=u[S+1]))==128&&(G=(31&U)<<6|63&I)<=127&&(G=null):$===3?(k=u[S+2],(192&(I=u[S+1]))==128&&(192&k)==128&&((G=(15&U)<<12|(63&I)<<6|63&k)<=2047||G>=55296&&G<=57343)&&(G=null)):$===4&&(k=u[S+2],N=u[S+3],(192&(I=u[S+1]))==128&&(192&k)==128&&(192&N)==128&&((G=(15&U)<<18|(63&I)<<12|(63&k)<<6|63&N)<=65535||G>=1114112)&&(G=null)),G===null?(G=65533,$=1):G>65535&&(G-=65536,b+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),b+=String.fromCharCode(G),S+=$}return b}(this.buf,o,t)},readBytes:function(){var t=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,t);return this.pos=t,o},readPackedVarint:function(t,o){if(this.type!==Ma.Bytes)return t.push(this.readVarint(o));var u=Kl(this);for(t=t||[];this.pos<u;)t.push(this.readVarint(o));return t},readPackedSVarint:function(t){if(this.type!==Ma.Bytes)return t.push(this.readSVarint());var o=Kl(this);for(t=t||[];this.pos<o;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Ma.Bytes)return t.push(this.readBoolean());var o=Kl(this);for(t=t||[];this.pos<o;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Ma.Bytes)return t.push(this.readFloat());var o=Kl(this);for(t=t||[];this.pos<o;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Ma.Bytes)return t.push(this.readDouble());var o=Kl(this);for(t=t||[];this.pos<o;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Ma.Bytes)return t.push(this.readFixed32());var o=Kl(this);for(t=t||[];this.pos<o;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Ma.Bytes)return t.push(this.readSFixed32());var o=Kl(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Ma.Bytes)return t.push(this.readFixed64());var o=Kl(this);for(t=t||[];this.pos<o;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Ma.Bytes)return t.push(this.readSFixed64());var o=Kl(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed64());return t},skip:function(t){var o=7&t;if(o===Ma.Varint)for(;this.buf[this.pos++]>127;);else if(o===Ma.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Ma.Fixed32)this.pos+=4;else{if(o!==Ma.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(t,o){this.writeVarint(t<<3|o)},realloc:function(t){for(var o=this.length||16;o<this.pos+t;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),yr(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),yr(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),yr(this.buf,-1&t,this.pos),yr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),yr(this.buf,-1&t,this.pos),yr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(o,u){var h,y;if(o>=0?(h=o%4294967296|0,y=o/4294967296|0):(y=~(-o/4294967296),4294967295^(h=~(-o%4294967296))?h=h+1|0:(h=0,y=y+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(b,S,I){I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,I.buf[I.pos]=127&(b>>>=7)}(h,0,u),function(b,S){var I=(7&b)<<4;S.buf[S.pos++]|=I|((b>>>=3)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b)))))}(y,u)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var o=this.pos;this.pos=function(h,y,b){for(var S,I,k=0;k<y.length;k++){if((S=y.charCodeAt(k))>55295&&S<57344){if(!I){S>56319||k+1===y.length?(h[b++]=239,h[b++]=191,h[b++]=189):I=S;continue}if(S<56320){h[b++]=239,h[b++]=191,h[b++]=189,I=S;continue}S=I-55296<<10|S-56320|65536,I=null}else I&&(h[b++]=239,h[b++]=191,h[b++]=189,I=null);S<128?h[b++]=S:(S<2048?h[b++]=S>>6|192:(S<65536?h[b++]=S>>12|224:(h[b++]=S>>18|240,h[b++]=S>>12&63|128),h[b++]=S>>6&63|128),h[b++]=63&S|128)}return b}(this.buf,t,this.pos);var u=this.pos-o;u>=128&&fh(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(t){this.realloc(4),zp(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),zp(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var o=t.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=t[u]},writeRawMessage:function(t,o){this.pos++;var u=this.pos;t(o,this);var h=this.pos-u;h>=128&&fh(u,h,this),this.pos=u-1,this.writeVarint(h),this.pos+=h},writeMessage:function(t,o,u){this.writeTag(t,Ma.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(t,o){o.length&&this.writeMessage(t,Od,o)},writePackedSVarint:function(t,o){o.length&&this.writeMessage(t,B,o)},writePackedBoolean:function(t,o){o.length&&this.writeMessage(t,Rt,o)},writePackedFloat:function(t,o){o.length&&this.writeMessage(t,ce,o)},writePackedDouble:function(t,o){o.length&&this.writeMessage(t,Fe,o)},writePackedFixed32:function(t,o){o.length&&this.writeMessage(t,ar,o)},writePackedSFixed32:function(t,o){o.length&&this.writeMessage(t,It,o)},writePackedFixed64:function(t,o){o.length&&this.writeMessage(t,Kt,o)},writePackedSFixed64:function(t,o){o.length&&this.writeMessage(t,cr,o)},writeBytesField:function(t,o){this.writeTag(t,Ma.Bytes),this.writeBytes(o)},writeFixed32Field:function(t,o){this.writeTag(t,Ma.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(t,o){this.writeTag(t,Ma.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(t,o){this.writeTag(t,Ma.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(t,o){this.writeTag(t,Ma.Fixed64),this.writeSFixed64(o)},writeVarintField:function(t,o){this.writeTag(t,Ma.Varint),this.writeVarint(o)},writeSVarintField:function(t,o){this.writeTag(t,Ma.Varint),this.writeSVarint(o)},writeStringField:function(t,o){this.writeTag(t,Ma.Bytes),this.writeString(o)},writeFloatField:function(t,o){this.writeTag(t,Ma.Fixed32),this.writeFloat(o)},writeDoubleField:function(t,o){this.writeTag(t,Ma.Fixed64),this.writeDouble(o)},writeBooleanField:function(t,o){this.writeVarintField(t,Boolean(o))}};var nt=function(t,o){var u=o.pixelRatio,h=o.version,y=o.stretchX,b=o.stretchY,S=o.content;this.paddedRect=t,this.pixelRatio=u,this.stretchX=y,this.stretchY=b,this.content=S,this.version=h},Zt={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Zt.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Zt.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Zt.tlbr.get=function(){return this.tl.concat(this.br)},Zt.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(nt.prototype,Zt);var Qt=function(t,o){var u={},h={};this.haveRenderCallbacks=[];var y=[];this.addImages(t,u,y),this.addImages(o,h,y);var b=br(y),S=new yo({width:b.w||1,height:b.h||1});for(var I in t){var k=t[I],N=u[I].paddedRect;yo.copy(k.data,S,{x:0,y:0},{x:N.x+1,y:N.y+1},k.data)}for(var U in o){var G=o[U],$=h[U].paddedRect,re=$.x+1,Te=$.y+1,Ie=G.data.width,We=G.data.height;yo.copy(G.data,S,{x:0,y:0},{x:re,y:Te},G.data),yo.copy(G.data,S,{x:0,y:We-1},{x:re,y:Te-1},{width:Ie,height:1}),yo.copy(G.data,S,{x:0,y:0},{x:re,y:Te+We},{width:Ie,height:1}),yo.copy(G.data,S,{x:Ie-1,y:0},{x:re-1,y:Te},{width:1,height:We}),yo.copy(G.data,S,{x:0,y:0},{x:re+Ie,y:Te},{width:1,height:We})}this.image=S,this.iconPositions=u,this.patternPositions=h};Qt.prototype.addImages=function(t,o,u){for(var h in t){var y=t[h],b={x:0,y:0,w:y.data.width+2,h:y.data.height+2};u.push(b),o[h]=new nt(b,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(h)}},Qt.prototype.patchUpdatedImages=function(t,o){for(var u in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),o),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),o)},Qt.prototype.patchUpdatedImage=function(t,o,u){if(t&&o&&t.version!==o.version){t.version=o.version;var h=t.tl;u.update(o.data,void 0,{x:h[0],y:h[1]})}},gn("ImagePosition",nt),gn("ImageAtlas",Qt);var Pr={horizontal:1,vertical:2,horizontalOnly:3},lr=function(){this.scale=1,this.fontStack="",this.imageName=null};lr.forText=function(t,o){var u=new lr;return u.scale=t||1,u.fontStack=o,u},lr.forImage=function(t){var o=new lr;return o.imageName=t,o};var Rr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function $r(t,o,u,h,y,b,S,I,k,N,U,G,$,re,Te,Ie){var We,ze=Rr.fromFeature(t,y);G===Pr.vertical&&ze.verticalizePunctuation();var it=Us.processBidirectionalText,Et=Us.processStyledBidirectionalText;if(it&&ze.sections.length===1){We=[];for(var Ut=0,Gt=it(ze.toString(),Fr(ze,N,b,o,h,re,Te));Ut<Gt.length;Ut+=1){var or=Gt[Ut],Ir=new Rr;Ir.text=or,Ir.sections=ze.sections;for(var Qr=0;Qr<or.length;Qr++)Ir.sectionIndex.push(0);We.push(Ir)}}else if(Et){We=[];for(var kn=0,pn=Et(ze.text,ze.sectionIndex,Fr(ze,N,b,o,h,re,Te));kn<pn.length;kn+=1){var zn=pn[kn],hn=new Rr;hn.text=zn[0],hn.sectionIndex=zn[1],hn.sections=ze.sections,We.push(hn)}}else We=function(Mn,Fi){for(var Si=[],Yi=Mn.text,jn=0,da=0,ao=Fi;da<ao.length;da+=1){var Ao=ao[da];Si.push(Mn.substring(jn,Ao)),jn=Ao}return jn<Yi.length&&Si.push(Mn.substring(jn,Yi.length)),Si}(ze,Fr(ze,N,b,o,h,re,Te));var hi=[],Vn={positionedLines:hi,text:ze.toString(),top:U[1],bottom:U[1],left:U[0],right:U[0],writingMode:G,iconsInText:!1,verticalizable:!1};return function(Mn,Fi,Si,Yi,jn,da,ao,Ao,Ha,Hi,_o,Qo){for(var Jo=0,Ts=-17,ss=0,Ws=0,Lo=Ao==="right"?1:Ao==="left"?0:.5,ms=0,Wi=0,Fa=jn;Wi<Fa.length;Wi+=1){var Sa=Fa[Wi];Sa.trim();var ia=Sa.getMaxScale(),j=24*(ia-1),Ms={positionedGlyphs:[],lineOffset:0};Mn.positionedLines[ms]=Ms;var Wa=Ms.positionedGlyphs,ko=0;if(Sa.length()){for(var Ps=0;Ps<Sa.length();Ps++){var fa=Sa.getSection(Ps),$l=Sa.getSectionIndex(Ps),ku=Sa.getCharCode(Ps),xu=0,wo=null,Ql=null,cl=null,sp=24,Rf=!(Ha===Pr.horizontal||!_o&&!pc(ku)||_o&&(Bn[ku]||(_c=ku,Kr.Arabic(_c)||Kr["Arabic Supplement"](_c)||Kr["Arabic Extended-A"](_c)||Kr["Arabic Presentation Forms-A"](_c)||Kr["Arabic Presentation Forms-B"](_c))));if(fa.imageName){var up=Yi[fa.imageName];if(!up)continue;cl=fa.imageName,Mn.iconsInText=Mn.iconsInText||!0,Ql=up.paddedRect;var Tl=up.displaySize;fa.scale=24*fa.scale/Qo,xu=j+(24-Tl[1]*fa.scale),sp=(wo={width:Tl[0],height:Tl[1],left:1,top:-3,advance:Rf?Tl[1]:Tl[0]}).advance;var Up=Rf?Tl[0]*fa.scale-24*ia:Tl[1]*fa.scale-24*ia;Up>0&&Up>ko&&(ko=Up)}else{var ed=Si[fa.fontStack],lp=ed&&ed[ku];if(lp&&lp.rect)Ql=lp.rect,wo=lp.metrics;else{var Zp=Fi[fa.fontStack],dh=Zp&&Zp[ku];if(!dh)continue;wo=dh.metrics}xu=24*(ia-fa.scale)}Rf?(Mn.verticalizable=!0,Wa.push({glyph:ku,imageName:cl,x:Jo,y:Ts+xu,vertical:Rf,scale:fa.scale,fontStack:fa.fontStack,sectionIndex:$l,metrics:wo,rect:Ql}),Jo+=sp*fa.scale+Hi):(Wa.push({glyph:ku,imageName:cl,x:Jo,y:Ts+xu,vertical:Rf,scale:fa.scale,fontStack:fa.fontStack,sectionIndex:$l,metrics:wo,rect:Ql}),Jo+=wo.advance*fa.scale+Hi)}Wa.length!==0&&(ss=Math.max(Jo-Hi,ss),si(Wa,0,Wa.length-1,Lo,ko)),Jo=0;var vh=da*ia+ko;Ms.lineOffset=Math.max(ko,j),Ts+=vh,Ws=Math.max(vh,Ws),++ms}else Ts+=da,++ms}var _c,Yc=Ts- -17,cp=Hr(ao),qc=cp.horizontalAlign,fp=cp.verticalAlign;(function(td,rd,jp,mh,Kc,gh,fl,yh,nd){var Vp,Lf=(rd-jp)*Kc;Vp=gh!==fl?-yh*mh- -17:(-mh*nd+.5)*fl;for(var pp=0,Gp=td;pp<Gp.length;pp+=1)for(var kf=0,hp=Gp[pp].positionedGlyphs;kf<hp.length;kf+=1){var dp=hp[kf];dp.x+=Lf,dp.y+=Vp}})(Mn.positionedLines,Lo,qc,fp,ss,Ws,da,Yc,jn.length),Mn.top+=-fp*Yc,Mn.bottom=Mn.top+Yc,Mn.left+=-qc*ss,Mn.right=Mn.left+ss}(Vn,o,u,h,We,S,I,k,G,N,$,Ie),!function(Mn){for(var Fi=0,Si=Mn;Fi<Si.length;Fi+=1)if(Si[Fi].positionedGlyphs.length!==0)return!1;return!0}(hi)&&Vn}Rr.fromFeature=function(t,o){for(var u=new Rr,h=0;h<t.sections.length;h++){var y=t.sections[h];y.image?u.addImageSection(y):u.addTextSection(y,o)}return u},Rr.prototype.length=function(){return this.text.length},Rr.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Rr.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Rr.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Rr.prototype.verticalizePunctuation=function(){this.text=function(t){for(var o="",u=0;u<t.length;u++){var h=t.charCodeAt(u+1)||null,y=t.charCodeAt(u-1)||null;o+=h&&Gu(h)&&!wf[t[u+1]]||y&&Gu(y)&&!wf[t[u-1]]||!wf[t[u]]?t[u]:wf[t[u]]}return o}(this.text)},Rr.prototype.trim=function(){for(var t=0,o=0;o<this.text.length&&Bn[this.text.charCodeAt(o)];o++)t++;for(var u=this.text.length,h=this.text.length-1;h>=0&&h>=t&&Bn[this.text.charCodeAt(h)];h--)u--;this.text=this.text.substring(t,u),this.sectionIndex=this.sectionIndex.slice(t,u)},Rr.prototype.substring=function(t,o){var u=new Rr;return u.text=this.text.substring(t,o),u.sectionIndex=this.sectionIndex.slice(t,o),u.sections=this.sections,u},Rr.prototype.toString=function(){return this.text},Rr.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(o,u){return Math.max(o,t.sections[u].scale)},0)},Rr.prototype.addTextSection=function(t,o){this.text+=t.text,this.sections.push(lr.forText(t.scale,t.fontStack||o));for(var u=this.sections.length-1,h=0;h<t.text.length;++h)this.sectionIndex.push(u)},Rr.prototype.addImageSection=function(t){var o=t.image?t.image.name:"";if(o.length!==0){var u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(lr.forImage(o)),this.sectionIndex.push(this.sections.length-1)):et("Reached maximum number of images 6401")}else et("Can't add FormattedSection with an empty image.")},Rr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Bn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},$t={};function er(t,o,u,h,y,b){if(o.imageName){var S=h[o.imageName];return S?S.displaySize[0]*o.scale*24/b+y:0}var I=u[o.fontStack],k=I&&I[t];return k?k.metrics.advance*o.scale+y:0}function dn(t,o,u,h){var y=Math.pow(t-o,2);return h?t<o?y/2:2*y:y+Math.abs(u)*u}function Yr(t,o,u){var h=0;return t===10&&(h-=1e4),u&&(h+=150),t!==40&&t!==65288||(h+=50),o!==41&&o!==65289||(h+=50),h}function xr(t,o,u,h,y,b){for(var S=null,I=dn(o,u,y,b),k=0,N=h;k<N.length;k+=1){var U=N[k],G=dn(o-U.x,u,y,b)+U.badness;G<=I&&(S=U,I=G)}return{index:t,x:o,priorBreak:S,badness:I}}function Fr(t,o,u,h,y,b,S){if(b!=="point")return[];if(!t)return[];for(var I,k=[],N=function(We,ze,it,Et,Ut,Gt){for(var or=0,Ir=0;Ir<We.length();Ir++){var Qr=We.getSection(Ir);or+=er(We.getCharCode(Ir),Qr,Et,Ut,ze,Gt)}return or/Math.max(1,Math.ceil(or/it))}(t,o,u,h,y,S),U=t.text.indexOf("\u200B")>=0,G=0,$=0;$<t.length();$++){var re=t.getSection($),Te=t.getCharCode($);if(Bn[Te]||(G+=er(Te,re,h,y,o,S)),$<t.length()-1){var Ie=!((I=Te)<11904||!(Kr["Bopomofo Extended"](I)||Kr.Bopomofo(I)||Kr["CJK Compatibility Forms"](I)||Kr["CJK Compatibility Ideographs"](I)||Kr["CJK Compatibility"](I)||Kr["CJK Radicals Supplement"](I)||Kr["CJK Strokes"](I)||Kr["CJK Symbols and Punctuation"](I)||Kr["CJK Unified Ideographs Extension A"](I)||Kr["CJK Unified Ideographs"](I)||Kr["Enclosed CJK Letters and Months"](I)||Kr["Halfwidth and Fullwidth Forms"](I)||Kr.Hiragana(I)||Kr["Ideographic Description Characters"](I)||Kr["Kangxi Radicals"](I)||Kr["Katakana Phonetic Extensions"](I)||Kr.Katakana(I)||Kr["Vertical Forms"](I)||Kr["Yi Radicals"](I)||Kr["Yi Syllables"](I)));($t[Te]||Ie||re.imageName)&&k.push(xr($+1,G,N,k,Yr(Te,t.getCharCode($+1),Ie&&U),!1))}}return function We(ze){return ze?We(ze.priorBreak).concat(ze.index):[]}(xr(t.length(),G,N,k,0,!0))}function Hr(t){var o=.5,u=.5;switch(t){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function si(t,o,u,h,y){if(h||y)for(var b=t[u],S=(t[u].x+b.metrics.advance*b.scale)*h,I=o;I<=u;I++)t[I].x-=S,t[I].y+=y}function ni(t,o,u,h,y,b){var S,I=t.image;if(I.content){var k=I.content,N=I.pixelRatio||1;S=[k[0]/N,k[1]/N,I.displaySize[0]-k[2]/N,I.displaySize[1]-k[3]/N]}var U,G,$,re,Te=o.left*b,Ie=o.right*b;u==="width"||u==="both"?(re=y[0]+Te-h[3],G=y[0]+Ie+h[1]):G=(re=y[0]+(Te+Ie-I.displaySize[0])/2)+I.displaySize[0];var We=o.top*b,ze=o.bottom*b;return u==="height"||u==="both"?(U=y[1]+We-h[0],$=y[1]+ze+h[2]):$=(U=y[1]+(We+ze-I.displaySize[1])/2)+I.displaySize[1],{image:I,top:U,right:G,bottom:$,left:re,collisionPadding:S}}$t[10]=!0,$t[32]=!0,$t[38]=!0,$t[40]=!0,$t[41]=!0,$t[43]=!0,$t[45]=!0,$t[47]=!0,$t[173]=!0,$t[183]=!0,$t[8203]=!0,$t[8208]=!0,$t[8211]=!0,$t[8231]=!0;var Vr=function(t){function o(u,h,y,b){t.call(this,u,h),this.angle=y,b!==void 0&&(this.segment=b)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.clone=function(){return new o(this.x,this.y,this.angle,this.segment)},o}(de);function Jr(t,o){var u=o.expression;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Ii(t+1))};if(u.kind==="source")return{kind:"source"};for(var h=u.zoomStops,y=u.interpolationType,b=0;b<h.length&&h[b]<=t;)b++;for(var S=b=Math.max(0,b-1);S<h.length&&h[S]<t+1;)S++;S=Math.min(h.length-1,S);var I=h[b],k=h[S];return u.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:k,interpolationType:y}:{kind:"camera",minZoom:I,maxZoom:k,minSize:u.evaluate(new Ii(I)),maxSize:u.evaluate(new Ii(k)),interpolationType:y}}function Yn(t,o,u){var h=o.uSize,y=u.lowerSize;return t.kind==="source"?y/128:t.kind==="composite"?ga(y/128,u.upperSize/128,o.uSizeT):h}function ui(t,o){var u=0,h=0;if(t.kind==="constant")h=t.layoutSize;else if(t.kind!=="source"){var y=t.interpolationType,b=y?tr(me.interpolationFactor(y,o,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?h=ga(t.minSize,t.maxSize,b):u=b}return{uSizeT:u,uSize:h}}gn("Anchor",Vr);var Ni=Object.freeze({__proto__:null,getSizeData:Jr,evaluateSizeForFeature:Yn,evaluateSizeForZoom:ui,SIZE_PACK_FACTOR:128});function io(t,o,u,h,y){if(o.segment===void 0)return!0;for(var b=o,S=o.segment+1,I=0;I>-u/2;){if(--S<0)return!1;I-=t[S].dist(b),b=t[S]}I+=t[S].dist(t[S+1]),S++;for(var k=[],N=0;I<u/2;){var U=t[S],G=t[S+1];if(!G)return!1;var $=t[S-1].angleTo(U)-U.angleTo(G);for($=Math.abs(($+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:I,angleDelta:$}),N+=$;I-k[0].distance>h;)N-=k.shift().angleDelta;if(N>y)return!1;S++,I+=U.dist(G)}return!0}function co(t){for(var o=0,u=0;u<t.length-1;u++)o+=t[u].dist(t[u+1]);return o}function ki(t,o,u){return t?.6*o*u:0}function as(t,o){return Math.max(t?t.right-t.left:0,o?o.right-o.left:0)}function Ga(t,o,u,h,y,b){for(var S=ki(u,y,b),I=as(u,h)*b,k=0,N=co(t)/2,U=0;U<t.length-1;U++){var G=t[U],$=t[U+1],re=G.dist($);if(k+re>N){var Te=(N-k)/re,Ie=ga(G.x,$.x,Te),We=ga(G.y,$.y,Te),ze=new Vr(Ie,We,$.angleTo(G),U);return ze._round(),!S||io(t,ze,I,S,o)?ze:void 0}k+=re}}function qo(t,o,u,h,y,b,S,I,k){var N=ki(h,b,S),U=as(h,y),G=U*S,$=t[0].x===0||t[0].x===k||t[0].y===0||t[0].y===k;return o-G<o/4&&(o=G+o/4),function re(Te,Ie,We,ze,it,Et,Ut,Gt,or){for(var Ir=Et/2,Qr=co(Te),kn=0,pn=Ie-We,zn=[],hn=0;hn<Te.length-1;hn++){for(var hi=Te[hn],Vn=Te[hn+1],Mn=hi.dist(Vn),Fi=Vn.angleTo(hi);pn+We<kn+Mn;){var Si=((pn+=We)-kn)/Mn,Yi=ga(hi.x,Vn.x,Si),jn=ga(hi.y,Vn.y,Si);if(Yi>=0&&Yi<or&&jn>=0&&jn<or&&pn-Ir>=0&&pn+Ir<=Qr){var da=new Vr(Yi,jn,Fi,hn);da._round(),ze&&!io(Te,da,Et,ze,it)||zn.push(da)}}kn+=Mn}return Gt||zn.length||Ut||(zn=re(Te,kn/2,We,ze,it,Et,Ut,!0,or)),zn}(t,$?o/2*I%o:(U/2+2*b)*S*I%o,o,N,u,G,$,!1,k)}function So(t,o,u,h,y){for(var b=[],S=0;S<t.length;S++)for(var I=t[S],k=void 0,N=0;N<I.length-1;N++){var U=I[N],G=I[N+1];U.x<o&&G.x<o||(U.x<o?U=new de(o,U.y+(o-U.x)/(G.x-U.x)*(G.y-U.y))._round():G.x<o&&(G=new de(o,U.y+(o-U.x)/(G.x-U.x)*(G.y-U.y))._round()),U.y<u&&G.y<u||(U.y<u?U=new de(U.x+(u-U.y)/(G.y-U.y)*(G.x-U.x),u)._round():G.y<u&&(G=new de(U.x+(u-U.y)/(G.y-U.y)*(G.x-U.x),u)._round()),U.x>=h&&G.x>=h||(U.x>=h?U=new de(h,U.y+(h-U.x)/(G.x-U.x)*(G.y-U.y))._round():G.x>=h&&(G=new de(h,U.y+(h-U.x)/(G.x-U.x)*(G.y-U.y))._round()),U.y>=y&&G.y>=y||(U.y>=y?U=new de(U.x+(y-U.y)/(G.y-U.y)*(G.x-U.x),y)._round():G.y>=y&&(G=new de(U.x+(y-U.y)/(G.y-U.y)*(G.x-U.x),y)._round()),k&&U.equals(k[k.length-1])||b.push(k=[U]),k.push(G)))))}return b}function Zo(t,o,u,h){var y=[],b=t.image,S=b.pixelRatio,I=b.paddedRect.w-2,k=b.paddedRect.h-2,N=t.right-t.left,U=t.bottom-t.top,G=b.stretchX||[[0,I]],$=b.stretchY||[[0,k]],re=function(Yi,jn){return Yi+jn[1]-jn[0]},Te=G.reduce(re,0),Ie=$.reduce(re,0),We=I-Te,ze=k-Ie,it=0,Et=Te,Ut=0,Gt=Ie,or=0,Ir=We,Qr=0,kn=ze;if(b.content&&h){var pn=b.content;it=jo(G,0,pn[0]),Ut=jo($,0,pn[1]),Et=jo(G,pn[0],pn[2]),Gt=jo($,pn[1],pn[3]),or=pn[0]-it,Qr=pn[1]-Ut,Ir=pn[2]-pn[0]-Et,kn=pn[3]-pn[1]-Gt}var zn=function(Yi,jn,da,ao){var Ao=fo(Yi.stretch-it,Et,N,t.left),Ha=xi(Yi.fixed-or,Ir,Yi.stretch,Te),Hi=fo(jn.stretch-Ut,Gt,U,t.top),_o=xi(jn.fixed-Qr,kn,jn.stretch,Ie),Qo=fo(da.stretch-it,Et,N,t.left),Jo=xi(da.fixed-or,Ir,da.stretch,Te),Ts=fo(ao.stretch-Ut,Gt,U,t.top),ss=xi(ao.fixed-Qr,kn,ao.stretch,Ie),Ws=new de(Ao,Hi),Lo=new de(Qo,Hi),ms=new de(Qo,Ts),Wi=new de(Ao,Ts),Fa=new de(Ha/S,_o/S),Sa=new de(Jo/S,ss/S),ia=o*Math.PI/180;if(ia){var j=Math.sin(ia),Ms=Math.cos(ia),Wa=[Ms,-j,j,Ms];Ws._matMult(Wa),Lo._matMult(Wa),Wi._matMult(Wa),ms._matMult(Wa)}var ko=Yi.stretch+Yi.fixed,Ps=jn.stretch+jn.fixed;return{tl:Ws,tr:Lo,bl:Wi,br:ms,tex:{x:b.paddedRect.x+1+ko,y:b.paddedRect.y+1+Ps,w:da.stretch+da.fixed-ko,h:ao.stretch+ao.fixed-Ps},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Fa,pixelOffsetBR:Sa,minFontScaleX:Ir/S/N,minFontScaleY:kn/S/U,isSDF:u}};if(h&&(b.stretchX||b.stretchY))for(var hn=ds(G,We,Te),hi=ds($,ze,Ie),Vn=0;Vn<hn.length-1;Vn++)for(var Mn=hn[Vn],Fi=hn[Vn+1],Si=0;Si<hi.length-1;Si++)y.push(zn(Mn,hi[Si],Fi,hi[Si+1]));else y.push(zn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:k+1}));return y}function jo(t,o,u){for(var h=0,y=0,b=t;y<b.length;y+=1){var S=b[y];h+=Math.max(o,Math.min(u,S[1]))-Math.max(o,Math.min(u,S[0]))}return h}function ds(t,o,u){for(var h=[{fixed:-1,stretch:0}],y=0,b=t;y<b.length;y+=1){var S=b[y],I=S[0],k=S[1],N=h[h.length-1];h.push({fixed:I-N.stretch,stretch:N.stretch}),h.push({fixed:I-N.stretch,stretch:N.stretch+(k-I)})}return h.push({fixed:o+1,stretch:u}),h}function fo(t,o,u,h){return t/o*u+h}function xi(t,o,u,h){return t-o*u/h}var Vo=function(t,o,u,h,y,b,S,I,k,N){if(this.boxStartIndex=t.length,k){var U=b.top,G=b.bottom,$=b.collisionPadding;$&&(U-=$[1],G+=$[3]);var re=G-U;re>0&&(re=Math.max(10,re),this.circleDiameter=re)}else{var Te=b.top*S-I,Ie=b.bottom*S+I,We=b.left*S-I,ze=b.right*S+I,it=b.collisionPadding;if(it&&(We-=it[0]*S,Te-=it[1]*S,ze+=it[2]*S,Ie+=it[3]*S),N){var Et=new de(We,Te),Ut=new de(ze,Te),Gt=new de(We,Ie),or=new de(ze,Ie),Ir=N*Math.PI/180;Et._rotate(Ir),Ut._rotate(Ir),Gt._rotate(Ir),or._rotate(Ir),We=Math.min(Et.x,Ut.x,Gt.x,or.x),ze=Math.max(Et.x,Ut.x,Gt.x,or.x),Te=Math.min(Et.y,Ut.y,Gt.y,or.y),Ie=Math.max(Et.y,Ut.y,Gt.y,or.y)}t.emplaceBack(o.x,o.y,We,Te,ze,Ie,u,h,y)}this.boxEndIndex=t.length},Ki=function(t,o){if(t===void 0&&(t=[]),o===void 0&&(o=Ko),this.data=t,this.length=this.data.length,this.compare=o,this.length>0)for(var u=(this.length>>1)-1;u>=0;u--)this._down(u)};function Ko(t,o){return t<o?-1:t>o?1:0}function ei(t,o,u){o===void 0&&(o=1),u===void 0&&(u=!1);for(var h=1/0,y=1/0,b=-1/0,S=-1/0,I=t[0],k=0;k<I.length;k++){var N=I[k];(!k||N.x<h)&&(h=N.x),(!k||N.y<y)&&(y=N.y),(!k||N.x>b)&&(b=N.x),(!k||N.y>S)&&(S=N.y)}var U=Math.min(b-h,S-y),G=U/2,$=new Ki([],Di);if(U===0)return new de(h,y);for(var re=h;re<b;re+=U)for(var Te=y;Te<S;Te+=U)$.push(new la(re+G,Te+G,G,t));for(var Ie=function(it){for(var Et=0,Ut=0,Gt=0,or=it[0],Ir=0,Qr=or.length,kn=Qr-1;Ir<Qr;kn=Ir++){var pn=or[Ir],zn=or[kn],hn=pn.x*zn.y-zn.x*pn.y;Ut+=(pn.x+zn.x)*hn,Gt+=(pn.y+zn.y)*hn,Et+=3*hn}return new la(Ut/Et,Gt/Et,0,it)}(t),We=$.length;$.length;){var ze=$.pop();(ze.d>Ie.d||!Ie.d)&&(Ie=ze,u&&console.log("found best %d after %d probes",Math.round(1e4*ze.d)/1e4,We)),ze.max-Ie.d<=o||($.push(new la(ze.p.x-(G=ze.h/2),ze.p.y-G,G,t)),$.push(new la(ze.p.x+G,ze.p.y-G,G,t)),$.push(new la(ze.p.x-G,ze.p.y+G,G,t)),$.push(new la(ze.p.x+G,ze.p.y+G,G,t)),We+=4)}return u&&(console.log("num probes: "+We),console.log("best distance: "+Ie.d)),Ie.p}function Di(t,o){return o.max-t.max}function la(t,o,u,h){this.p=new de(t,o),this.h=u,this.d=function(y,b){for(var S=!1,I=1/0,k=0;k<b.length;k++)for(var N=b[k],U=0,G=N.length,$=G-1;U<G;$=U++){var re=N[U],Te=N[$];re.y>y.y!=Te.y>y.y&&y.x<(Te.x-re.x)*(y.y-re.y)/(Te.y-re.y)+re.x&&(S=!S),I=Math.min(I,Hl(y,re,Te))}return(S?1:-1)*Math.sqrt(I)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}Ki.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},Ki.prototype.pop=function(){if(this.length!==0){var t=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),t}},Ki.prototype.peek=function(){return this.data[0]},Ki.prototype._up=function(t){for(var o=this.data,u=this.compare,h=o[t];t>0;){var y=t-1>>1,b=o[y];if(u(h,b)>=0)break;o[t]=b,t=y}o[t]=h},Ki.prototype._down=function(t){for(var o=this.data,u=this.compare,h=this.length>>1,y=o[t];t<h;){var b=1+(t<<1),S=o[b],I=b+1;if(I<this.length&&u(o[I],S)<0&&(b=I,S=o[I]),u(S,y)>=0)break;o[t]=S,t=b}o[t]=y};var Co=Number.POSITIVE_INFINITY;function wl(t,o){return o[1]!==Co?function(u,h,y){var b=0,S=0;switch(h=Math.abs(h),y=Math.abs(y),u){case"top-right":case"top-left":case"top":S=y-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-y}switch(u){case"top-right":case"bottom-right":case"right":b=-h;break;case"top-left":case"bottom-left":case"left":b=h}return[b,S]}(t,o[0],o[1]):function(u,h){var y=0,b=0;h<0&&(h=0);var S=h/Math.sqrt(2);switch(u){case"top-right":case"top-left":b=S-7;break;case"bottom-right":case"bottom-left":b=7-S;break;case"bottom":b=7-h;break;case"top":b=h-7}switch(u){case"top-right":case"bottom-right":y=-S;break;case"top-left":case"bottom-left":y=S;break;case"left":y=h;break;case"right":y=-h}return[y,b]}(t,o[0])}function Ae(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Dt(t,o,u,h,y,b,S,I,k,N,U,G,$,re,Te){var Ie=function(Ut,Gt,or,Ir,Qr,kn,pn,zn){for(var hn=Ir.layout.get("text-rotate").evaluate(kn,{})*Math.PI/180,hi=[],Vn=0,Mn=Gt.positionedLines;Vn<Mn.length;Vn+=1)for(var Fi=Mn[Vn],Si=0,Yi=Fi.positionedGlyphs;Si<Yi.length;Si+=1){var jn=Yi[Si];if(jn.rect){var da=jn.rect||{},ao=4,Ao=!0,Ha=1,Hi=0,_o=(Qr||zn)&&jn.vertical,Qo=jn.metrics.advance*jn.scale/2;if(zn&&Gt.verticalizable&&(Hi=Fi.lineOffset/2-(jn.imageName?-(24-jn.metrics.width*jn.scale)/2:24*(jn.scale-1))),jn.imageName){var Jo=pn[jn.imageName];Ao=Jo.sdf,ao=1/(Ha=Jo.pixelRatio)}var Ts=Qr?[jn.x+Qo,jn.y]:[0,0],ss=Qr?[0,0]:[jn.x+Qo+or[0],jn.y+or[1]-Hi],Ws=[0,0];_o&&(Ws=ss,ss=[0,0]);var Lo=(jn.metrics.left-ao)*jn.scale-Qo+ss[0],ms=(-jn.metrics.top-ao)*jn.scale+ss[1],Wi=Lo+da.w*jn.scale/Ha,Fa=ms+da.h*jn.scale/Ha,Sa=new de(Lo,ms),ia=new de(Wi,ms),j=new de(Lo,Fa),Ms=new de(Wi,Fa);if(_o){var Wa=new de(-Qo,Qo- -17),ko=-Math.PI/2,Ps=12-Qo,fa=new de(22-Ps,-(jn.imageName?Ps:0)),$l=new(Function.prototype.bind.apply(de,[null].concat(Ws)));Sa._rotateAround(ko,Wa)._add(fa)._add($l),ia._rotateAround(ko,Wa)._add(fa)._add($l),j._rotateAround(ko,Wa)._add(fa)._add($l),Ms._rotateAround(ko,Wa)._add(fa)._add($l)}if(hn){var ku=Math.sin(hn),xu=Math.cos(hn),wo=[xu,-ku,ku,xu];Sa._matMult(wo),ia._matMult(wo),j._matMult(wo),Ms._matMult(wo)}var Ql=new de(0,0),cl=new de(0,0);hi.push({tl:Sa,tr:ia,bl:j,br:Ms,tex:da,writingMode:Gt.writingMode,glyphOffset:Ts,sectionIndex:jn.sectionIndex,isSDF:Ao,pixelOffsetTL:Ql,pixelOffsetBR:cl,minFontScaleX:0,minFontScaleY:0})}}return hi}(0,u,I,y,b,S,h,t.allowVerticalPlacement),We=t.textSizeData,ze=null;We.kind==="source"?(ze=[128*y.layout.get("text-size").evaluate(S,{})])[0]>32640&&et(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):We.kind==="composite"&&((ze=[128*re.compositeTextSizes[0].evaluate(S,{},Te),128*re.compositeTextSizes[1].evaluate(S,{},Te)])[0]>32640||ze[1]>32640)&&et(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,Ie,ze,I,b,S,N,o,k.lineStartIndex,k.lineLength,$,Te);for(var it=0,Et=U;it<Et.length;it+=1)G[Et[it]]=t.text.placedSymbolArray.length-1;return 4*Ie.length}function xt(t){for(var o in t)return t[o];return null}function vn(t,o,u,h){var y=t.compareText;if(o in y){for(var b=y[o],S=b.length-1;S>=0;S--)if(h.dist(b[S])<u)return!0}else y[o]=[];return y[o].push(h),!1}var zi=_u.VectorTileFeature.types,be=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ne(t,o,u,h,y,b,S,I,k,N,U,G,$){var re=I?Math.min(32640,Math.round(I[0])):0,Te=I?Math.min(32640,Math.round(I[1])):0;t.emplaceBack(o,u,Math.round(32*h),Math.round(32*y),b,S,(re<<1)+(k?1:0),Te,16*N,16*U,256*G,256*$)}function Ze(t,o,u){t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u)}function ot(t){for(var o=0,u=t.sections;o<u.length;o+=1)if(Nc(u[o].text))return!0;return!1}var Tt=function(t){this.layoutVertexArray=new jc,this.indexArray=new vu,this.programConfigurations=t,this.segments=new ue,this.dynamicLayoutVertexArray=new du,this.opacityVertexArray=new Vc,this.placedSymbolArray=new d};Tt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Tt.prototype.upload=function(t,o,u,h){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,qh.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Kh.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,be,!0),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(t))},Tt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},gn("SymbolBuffers",Tt);var Ye=function(t,o,u){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new u,this.segments=new ue,this.collisionVertexArray=new bl};Ye.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,$h.members,!0)},Ye.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},gn("CollisionBuffers",Ye);var De=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(b){return b.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=eu([]),this.placementViewportMatrix=eu([]);var o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Jr(this.zoom,o["text-size"]),this.iconSizeData=Jr(this.zoom,o["icon-size"]);var u=this.layers[0].layout,h=u.get("symbol-sort-key"),y=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(function(b){return Pr[b]})),this.stateDependentLayerIds=this.layers.filter(function(b){return b.isStateDependent()}).map(function(b){return b.id}),this.sourceID=t.sourceID};De.prototype.createArrays=function(){this.text=new Tt(new Wn(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new Tt(new Wn(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new P,this.lineVertexArray=new L,this.symbolInstances=new w},De.prototype.calculateGlyphDependencies=function(t,o,u,h,y){for(var b=0;b<t.length;b++)if(o[t.charCodeAt(b)]=!0,(u||h)&&y){var S=wf[t.charAt(b)];S&&(o[S.charCodeAt(0)]=!0)}},De.prototype.populate=function(t,o,u){var h=this.layers[0],y=h.layout,b=y.get("text-font"),S=y.get("text-field"),I=y.get("icon-image"),k=(S.value.kind!=="constant"||S.value.value instanceof pt&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),N=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,U=y.get("symbol-sort-key");if(this.features=[],k||N){for(var G=o.iconDependencies,$=o.glyphDependencies,re=o.availableImages,Te=new Ii(this.zoom),Ie=0,We=t;Ie<We.length;Ie+=1){var ze=We[Ie],it=ze.feature,Et=ze.id,Ut=ze.index,Gt=ze.sourceLayerIndex,or=h._featureFilter.needGeometry,Ir=lo(it,or);if(h._featureFilter.filter(Te,Ir,u)){or||(Ir.geometry=$a(it));var Qr=void 0;if(k){var kn=h.getValueAndResolveTokens("text-field",Ir,u,re),pn=pt.factory(kn);ot(pn)&&(this.hasRTLText=!0),(!this.hasRTLText||pf()==="unavailable"||this.hasRTLText&&Us.isParsed())&&(Qr=Id(pn,h,Ir))}var zn=void 0;if(N){var hn=h.getValueAndResolveTokens("icon-image",Ir,u,re);zn=hn instanceof ta?hn:ta.fromString(hn)}if(Qr||zn){var hi=this.sortFeaturesByKey?U.evaluate(Ir,{},u):void 0;if(this.features.push({id:Et,text:Qr,icon:zn,index:Ut,sourceLayerIndex:Gt,geometry:Ir.geometry,properties:it.properties,type:zi[it.type],sortKey:hi}),zn&&(G[zn.name]=!0),Qr){var Vn=b.evaluate(Ir,{},u).join(","),Mn=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Pr.vertical)>=0;for(var Fi=0,Si=Qr.sections;Fi<Si.length;Fi+=1){var Yi=Si[Fi];if(Yi.image)G[Yi.image.name]=!0;else{var jn=ff(Qr.toString()),da=Yi.fontStack||Vn,ao=$[da]=$[da]||{};this.calculateGlyphDependencies(Yi.text,ao,Mn,this.allowVerticalPlacement,jn)}}}}}}y.get("symbol-placement")==="line"&&(this.features=function(Ao){var Ha={},Hi={},_o=[],Qo=0;function Jo(Wa){_o.push(Ao[Wa]),Qo++}function Ts(Wa,ko,Ps){var fa=Hi[Wa];return delete Hi[Wa],Hi[ko]=fa,_o[fa].geometry[0].pop(),_o[fa].geometry[0]=_o[fa].geometry[0].concat(Ps[0]),fa}function ss(Wa,ko,Ps){var fa=Ha[ko];return delete Ha[ko],Ha[Wa]=fa,_o[fa].geometry[0].shift(),_o[fa].geometry[0]=Ps[0].concat(_o[fa].geometry[0]),fa}function Ws(Wa,ko,Ps){var fa=Ps?ko[0][ko[0].length-1]:ko[0][0];return Wa+":"+fa.x+":"+fa.y}for(var Lo=0;Lo<Ao.length;Lo++){var ms=Ao[Lo],Wi=ms.geometry,Fa=ms.text?ms.text.toString():null;if(Fa){var Sa=Ws(Fa,Wi),ia=Ws(Fa,Wi,!0);if(Sa in Hi&&ia in Ha&&Hi[Sa]!==Ha[ia]){var j=ss(Sa,ia,Wi),Ms=Ts(Sa,ia,_o[j].geometry);delete Ha[Sa],delete Hi[ia],Hi[Ws(Fa,_o[Ms].geometry,!0)]=Ms,_o[j].geometry=null}else Sa in Hi?Ts(Sa,ia,Wi):ia in Ha?ss(Sa,ia,Wi):(Jo(Lo),Ha[Sa]=Qo-1,Hi[ia]=Qo-1)}else Jo(Lo)}return _o.filter(function(Wa){return Wa.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Ao,Ha){return Ao.sortKey-Ha.sortKey})}},De.prototype.update=function(t,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,o,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,o,this.layers,u))},De.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},De.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},De.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},De.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},De.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},De.prototype.addToLineVertexArray=function(t,o){var u=this.lineVertexArray.length;if(t.segment!==void 0){for(var h=t.dist(o[t.segment+1]),y=t.dist(o[t.segment]),b={},S=t.segment+1;S<o.length;S++)b[S]={x:o[S].x,y:o[S].y,tileUnitDistanceFromAnchor:h},S<o.length-1&&(h+=o[S+1].dist(o[S]));for(var I=t.segment||0;I>=0;I--)b[I]={x:o[I].x,y:o[I].y,tileUnitDistanceFromAnchor:y},I>0&&(y+=o[I-1].dist(o[I]));for(var k=0;k<o.length;k++){var N=b[k];this.lineVertexArray.emplaceBack(N.x,N.y,N.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}},De.prototype.addSymbols=function(t,o,u,h,y,b,S,I,k,N,U,G){for(var $=t.indexArray,re=t.layoutVertexArray,Te=t.segments.prepareSegment(4*o.length,re,$,this.canOverlap?b.sortKey:void 0),Ie=this.glyphOffsetArray.length,We=Te.vertexLength,ze=this.allowVerticalPlacement&&S===Pr.vertical?Math.PI/2:0,it=b.text&&b.text.sections,Et=0;Et<o.length;Et++){var Ut=o[Et],Gt=Ut.tl,or=Ut.tr,Ir=Ut.bl,Qr=Ut.br,kn=Ut.tex,pn=Ut.pixelOffsetTL,zn=Ut.pixelOffsetBR,hn=Ut.minFontScaleX,hi=Ut.minFontScaleY,Vn=Ut.glyphOffset,Mn=Ut.isSDF,Fi=Ut.sectionIndex,Si=Te.vertexLength,Yi=Vn[1];ne(re,I.x,I.y,Gt.x,Yi+Gt.y,kn.x,kn.y,u,Mn,pn.x,pn.y,hn,hi),ne(re,I.x,I.y,or.x,Yi+or.y,kn.x+kn.w,kn.y,u,Mn,zn.x,pn.y,hn,hi),ne(re,I.x,I.y,Ir.x,Yi+Ir.y,kn.x,kn.y+kn.h,u,Mn,pn.x,zn.y,hn,hi),ne(re,I.x,I.y,Qr.x,Yi+Qr.y,kn.x+kn.w,kn.y+kn.h,u,Mn,zn.x,zn.y,hn,hi),Ze(t.dynamicLayoutVertexArray,I,ze),$.emplaceBack(Si,Si+1,Si+2),$.emplaceBack(Si+1,Si+2,Si+3),Te.vertexLength+=4,Te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Vn[0]),Et!==o.length-1&&Fi===o[Et+1].sectionIndex||t.programConfigurations.populatePaintArrays(re.length,b,b.index,{},G,it&&it[Fi])}t.placedSymbolArray.emplaceBack(I.x,I.y,Ie,this.glyphOffsetArray.length-Ie,We,k,N,I.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],S,0,!1,0,U)},De.prototype._addCollisionDebugVertex=function(t,o,u,h,y,b){return o.emplaceBack(0,0),t.emplaceBack(u.x,u.y,h,y,Math.round(b.x),Math.round(b.y))},De.prototype.addCollisionDebugVertices=function(t,o,u,h,y,b,S){var I=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),k=I.vertexLength,N=y.layoutVertexArray,U=y.collisionVertexArray,G=S.anchorX,$=S.anchorY;this._addCollisionDebugVertex(N,U,b,G,$,new de(t,o)),this._addCollisionDebugVertex(N,U,b,G,$,new de(u,o)),this._addCollisionDebugVertex(N,U,b,G,$,new de(u,h)),this._addCollisionDebugVertex(N,U,b,G,$,new de(t,h)),I.vertexLength+=4;var re=y.indexArray;re.emplaceBack(k,k+1),re.emplaceBack(k+1,k+2),re.emplaceBack(k+2,k+3),re.emplaceBack(k+3,k),I.primitiveLength+=4},De.prototype.addDebugCollisionBoxes=function(t,o,u,h){for(var y=t;y<o;y++){var b=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,h?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,u)}},De.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ye(jl,Np.members,Mu),this.iconCollisionBox=new Ye(jl,Np.members,Mu);for(var t=0;t<this.symbolInstances.length;t++){var o=this.symbolInstances.get(t);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}},De.prototype._deserializeCollisionBoxesForSymbol=function(t,o,u,h,y,b,S,I,k){for(var N={},U=o;U<u;U++){var G=t.get(U);N.textBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},N.textFeatureIndex=G.featureIndex;break}for(var $=h;$<y;$++){var re=t.get($);N.verticalTextBox={x1:re.x1,y1:re.y1,x2:re.x2,y2:re.y2,anchorPointX:re.anchorPointX,anchorPointY:re.anchorPointY},N.verticalTextFeatureIndex=re.featureIndex;break}for(var Te=b;Te<S;Te++){var Ie=t.get(Te);N.iconBox={x1:Ie.x1,y1:Ie.y1,x2:Ie.x2,y2:Ie.y2,anchorPointX:Ie.anchorPointX,anchorPointY:Ie.anchorPointY},N.iconFeatureIndex=Ie.featureIndex;break}for(var We=I;We<k;We++){var ze=t.get(We);N.verticalIconBox={x1:ze.x1,y1:ze.y1,x2:ze.x2,y2:ze.y2,anchorPointX:ze.anchorPointX,anchorPointY:ze.anchorPointY},N.verticalIconFeatureIndex=ze.featureIndex;break}return N},De.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}},De.prototype.hasTextData=function(){return this.text.segments.get().length>0},De.prototype.hasIconData=function(){return this.icon.segments.get().length>0},De.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},De.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},De.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},De.prototype.addIndicesForPlacedSymbol=function(t,o){for(var u=t.placedSymbolArray.get(o),h=u.vertexStartIndex+4*u.numGlyphs,y=u.vertexStartIndex;y<h;y+=4)t.indexArray.emplaceBack(y,y+1,y+2),t.indexArray.emplaceBack(y+1,y+2,y+3)},De.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var o=Math.sin(t),u=Math.cos(t),h=[],y=[],b=[],S=0;S<this.symbolInstances.length;++S){b.push(S);var I=this.symbolInstances.get(S);h.push(0|Math.round(o*I.anchorX+u*I.anchorY)),y.push(I.featureIndex)}return b.sort(function(k,N){return h[k]-h[N]||y[N]-y[k]}),b},De.prototype.addToSortKeyRanges=function(t,o){var u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})},De.prototype.sortFeatures=function(t){var o=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var u=0,h=this.symbolInstanceIndexes;u<h.length;u+=1){var y=this.symbolInstances.get(h[u]);this.featureSortOrder.push(y.featureIndex),[y.rightJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.leftJustifiedTextSymbolIndex].forEach(function(b,S,I){b>=0&&I.indexOf(b)===S&&o.addIndicesForPlacedSymbol(o.text,b)}),y.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,y.verticalPlacedTextSymbolIndex),y.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.placedIconSymbolIndex),y.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},gn("SymbolBucket",De,{omit:["layers","collisionBoxArray","features","compareText"]}),De.MAX_GLYPHS=65535,De.addDynamicAttributes=Ze;var Je=new ns({"symbol-placement":new Dn(se.layout_symbol["symbol-placement"]),"symbol-spacing":new Dn(se.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Dn(se.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new An(se.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Dn(se.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Dn(se.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Dn(se.layout_symbol["icon-ignore-placement"]),"icon-optional":new Dn(se.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Dn(se.layout_symbol["icon-rotation-alignment"]),"icon-size":new An(se.layout_symbol["icon-size"]),"icon-text-fit":new Dn(se.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Dn(se.layout_symbol["icon-text-fit-padding"]),"icon-image":new An(se.layout_symbol["icon-image"]),"icon-rotate":new An(se.layout_symbol["icon-rotate"]),"icon-padding":new Dn(se.layout_symbol["icon-padding"]),"icon-keep-upright":new Dn(se.layout_symbol["icon-keep-upright"]),"icon-offset":new An(se.layout_symbol["icon-offset"]),"icon-anchor":new An(se.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Dn(se.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Dn(se.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Dn(se.layout_symbol["text-rotation-alignment"]),"text-field":new An(se.layout_symbol["text-field"]),"text-font":new An(se.layout_symbol["text-font"]),"text-size":new An(se.layout_symbol["text-size"]),"text-max-width":new An(se.layout_symbol["text-max-width"]),"text-line-height":new Dn(se.layout_symbol["text-line-height"]),"text-letter-spacing":new An(se.layout_symbol["text-letter-spacing"]),"text-justify":new An(se.layout_symbol["text-justify"]),"text-radial-offset":new An(se.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Dn(se.layout_symbol["text-variable-anchor"]),"text-anchor":new An(se.layout_symbol["text-anchor"]),"text-max-angle":new Dn(se.layout_symbol["text-max-angle"]),"text-writing-mode":new Dn(se.layout_symbol["text-writing-mode"]),"text-rotate":new An(se.layout_symbol["text-rotate"]),"text-padding":new Dn(se.layout_symbol["text-padding"]),"text-keep-upright":new Dn(se.layout_symbol["text-keep-upright"]),"text-transform":new An(se.layout_symbol["text-transform"]),"text-offset":new An(se.layout_symbol["text-offset"]),"text-allow-overlap":new Dn(se.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Dn(se.layout_symbol["text-ignore-placement"]),"text-optional":new Dn(se.layout_symbol["text-optional"])}),ve={paint:new ns({"icon-opacity":new An(se.paint_symbol["icon-opacity"]),"icon-color":new An(se.paint_symbol["icon-color"]),"icon-halo-color":new An(se.paint_symbol["icon-halo-color"]),"icon-halo-width":new An(se.paint_symbol["icon-halo-width"]),"icon-halo-blur":new An(se.paint_symbol["icon-halo-blur"]),"icon-translate":new Dn(se.paint_symbol["icon-translate"]),"icon-translate-anchor":new Dn(se.paint_symbol["icon-translate-anchor"]),"text-opacity":new An(se.paint_symbol["text-opacity"]),"text-color":new An(se.paint_symbol["text-color"],{runtimeType:Xr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new An(se.paint_symbol["text-halo-color"]),"text-halo-width":new An(se.paint_symbol["text-halo-width"]),"text-halo-blur":new An(se.paint_symbol["text-halo-blur"]),"text-translate":new Dn(se.paint_symbol["text-translate"]),"text-translate-anchor":new Dn(se.paint_symbol["text-translate-anchor"])}),layout:Je},Ue=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:fn,this.defaultValue=t};Ue.prototype.evaluate=function(t){if(t.formattedSection){var o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},Ue.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},Ue.prototype.outputDefined=function(){return!1},Ue.prototype.serialize=function(){return null},gn("FormatSectionOverride",Ue,{omit:["defaultValue"]});var Ee=function(t){function o(u){t.call(this,u,ve)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,h){if(t.prototype.recalculate.call(this,u,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var y=this.layout.get("text-writing-mode");if(y){for(var b=[],S=0,I=y;S<I.length;S+=1){var k=I[S];b.indexOf(k)<0&&b.push(k)}this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},o.prototype.getValueAndResolveTokens=function(u,h,y,b){var S=this.layout.get(u).evaluate(h,{},y,b),I=this._unevaluatedLayout._values[u];return I.isDataDriven()||ac(I.value)||!S?S:function(k,N){return N.replace(/{([^{}]+)}/g,function(U,G){return G in k?String(k[G]):""})}(h.properties,S)},o.prototype.createBucket=function(u){return new De(u)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype._setPaintOverrides=function(){for(var u=0,h=ve.paint.overridableProperties;u<h.length;u+=1){var y=h[u];if(o.hasPaintOverride(this.layout,y)){var b,S=this.paint.get(y),I=new Ue(S),k=new Rc(I,S.property.specification);b=S.value.kind==="constant"||S.value.kind==="source"?new kl("source",k):new gl("composite",k,S.value.zoomStops,S.value._interpolationType),this.paint._values[y]=new ls(S.property,b,S.parameters)}}},o.prototype._handleOverridablePaintPropertyUpdate=function(u,h,y){return!(!this.layout||h.isDataDriven()||y.isDataDriven())&&o.hasPaintOverride(this.layout,u)},o.hasPaintOverride=function(u,h){var y=u.get("text-field"),b=ve.paint.properties[h],S=!1,I=function(U){for(var G=0,$=U;G<$.length;G+=1)if(b.overrides&&b.overrides.hasOverride($[G]))return void(S=!0)};if(y.value.kind==="constant"&&y.value.value instanceof pt)I(y.value.value.sections);else if(y.value.kind==="source"){var k=function(U){S||(U instanceof za&&$i(U.value)===ji?I(U.value.sections):U instanceof Po?I(U.sections):U.eachChild(k))},N=y.value;N._styleExpression&&k(N._styleExpression.expression)}return S},o}(Cu),at={paint:new ns({"background-color":new Dn(se.paint_background["background-color"]),"background-pattern":new cs(se.paint_background["background-pattern"]),"background-opacity":new Dn(se.paint_background["background-opacity"])})},bt=function(t){function o(u){t.call(this,u,at)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Cu),fr={paint:new ns({"raster-opacity":new Dn(se.paint_raster["raster-opacity"]),"raster-hue-rotate":new Dn(se.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Dn(se.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Dn(se.paint_raster["raster-brightness-max"]),"raster-saturation":new Dn(se.paint_raster["raster-saturation"]),"raster-contrast":new Dn(se.paint_raster["raster-contrast"]),"raster-resampling":new Dn(se.paint_raster["raster-resampling"]),"raster-fade-duration":new Dn(se.paint_raster["raster-fade-duration"])})},zr=function(t){function o(u){t.call(this,u,fr)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Cu),Zr=function(t){function o(u){t.call(this,u,{}),this.implementation=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},o.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},o.prototype.recalculate=function(){},o.prototype.updateTransitions=function(){},o.prototype.hasTransition=function(){},o.prototype.serialize=function(){},o.prototype.onAdd=function(u){this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},o.prototype.onRemove=function(u){this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},o}(Cu),en={circle:Yf,heatmap:qf,hillshade:Pp,fill:np,"fill-extrusion":ql,line:Xh,symbol:Ee,background:bt,raster:zr},kr=xe.HTMLImageElement,Cn=xe.HTMLCanvasElement,ln=xe.HTMLVideoElement,xn=xe.ImageData,bn=xe.ImageBitmap,mn=function(t,o,u,h){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(o,h)};mn.prototype.update=function(t,o,u){var h=t.width,y=t.height,b=!(this.size&&this.size[0]===h&&this.size[1]===y||u),S=this.context,I=S.gl;if(this.useMipmap=Boolean(o&&o.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!o||o.premultiply!==!1)),b)this.size=[h,y],t instanceof kr||t instanceof Cn||t instanceof ln||t instanceof xn||bn&&t instanceof bn?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,t):I.texImage2D(I.TEXTURE_2D,0,this.format,h,y,0,this.format,I.UNSIGNED_BYTE,t.data);else{var k=u||{x:0,y:0},N=k.x,U=k.y;t instanceof kr||t instanceof Cn||t instanceof ln||t instanceof xn||bn&&t instanceof bn?I.texSubImage2D(I.TEXTURE_2D,0,N,U,I.RGBA,I.UNSIGNED_BYTE,t):I.texSubImage2D(I.TEXTURE_2D,0,N,U,h,y,I.RGBA,I.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)},mn.prototype.bind=function(t,o,u){var h=this.context.gl;h.bindTexture(h.TEXTURE_2D,this.texture),u!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=h.LINEAR),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,u||t),this.filter=t),o!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,o),this.wrap=o)},mn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},mn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var qn=function(t){var o=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){o._triggered=!1,o._callback()})};qn.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},qn.prototype.remove=function(){delete this._channel,this._callback=function(){}};var _a=function(t,o,u){this.target=t,this.parent=o,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},sr(["receive","process"],this),this.invoker=new qn(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Wr()?t:xe};function os(t,o,u){var h=2*Math.PI*6378137/256/Math.pow(2,u);return[t*h-2*Math.PI*6378137/2,o*h-2*Math.PI*6378137/2]}_a.prototype.send=function(t,o,u,h,y){var b=this;y===void 0&&(y=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[S]=u);var I=Se(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:t,hasCallback:!!u,targetMapId:h,mustQueue:y,sourceMapId:this.mapId,data:cu(o,I)},I),{cancel:function(){u&&delete b.callbacks[S],b.target.postMessage({id:S,type:"<cancel>",targetMapId:h,sourceMapId:b.mapId})}}},_a.prototype.receive=function(t){var o=t.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){delete this.tasks[u];var h=this.cancelCallbacks[u];delete this.cancelCallbacks[u],h&&h()}else Wr()||o.mustQueue?(this.tasks[u]=o,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,o)},_a.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),o=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(t,o)}},_a.prototype.processTask=function(t,o){var u=this;if(o.type==="<response>"){var h=this.callbacks[t];delete this.callbacks[t],h&&(o.error?h(ks(o.error)):h(null,ks(o.data)))}else{var y=!1,b=Se(this.globalScope)?void 0:[],S=o.hasCallback?function(U,G){y=!0,delete u.cancelCallbacks[t],u.target.postMessage({id:t,type:"<response>",sourceMapId:u.mapId,error:U?cu(U):null,data:cu(G,b)},b)}:function(U){y=!0},I=null,k=ks(o.data);if(this.parent[o.type])I=this.parent[o.type](o.sourceMapId,k,S);else if(this.parent.getWorkerSource){var N=o.type.split(".");I=this.parent.getWorkerSource(o.sourceMapId,N[0],k.source)[N[1]](k,S)}else S(new Error("Could not find function "+o.type));!y&&I&&I.cancel&&(this.cancelCallbacks[t]=I.cancel)}},_a.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Pa=function(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Pa.prototype.setNorthEast=function(t){return this._ne=t instanceof ca?new ca(t.lng,t.lat):ca.convert(t),this},Pa.prototype.setSouthWest=function(t){return this._sw=t instanceof ca?new ca(t.lng,t.lat):ca.convert(t),this},Pa.prototype.extend=function(t){var o,u,h=this._sw,y=this._ne;if(t instanceof ca)o=t,u=t;else{if(!(t instanceof Pa))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Pa.convert(t)):this.extend(ca.convert(t)):this;if(u=t._ne,!(o=t._sw)||!u)return this}return h||y?(h.lng=Math.min(o.lng,h.lng),h.lat=Math.min(o.lat,h.lat),y.lng=Math.max(u.lng,y.lng),y.lat=Math.max(u.lat,y.lat)):(this._sw=new ca(o.lng,o.lat),this._ne=new ca(u.lng,u.lat)),this},Pa.prototype.getCenter=function(){return new ca((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Pa.prototype.getSouthWest=function(){return this._sw},Pa.prototype.getNorthEast=function(){return this._ne},Pa.prototype.getNorthWest=function(){return new ca(this.getWest(),this.getNorth())},Pa.prototype.getSouthEast=function(){return new ca(this.getEast(),this.getSouth())},Pa.prototype.getWest=function(){return this._sw.lng},Pa.prototype.getSouth=function(){return this._sw.lat},Pa.prototype.getEast=function(){return this._ne.lng},Pa.prototype.getNorth=function(){return this._ne.lat},Pa.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Pa.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Pa.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Pa.prototype.contains=function(t){var o=ca.convert(t),u=o.lng,h=o.lat,y=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&y},Pa.convert=function(t){return!t||t instanceof Pa?t:new Pa(t)};var ca=function(t,o){if(isNaN(t)||isNaN(o))throw new Error("Invalid LngLat object: ("+t+", "+o+")");if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};ca.prototype.wrap=function(){return new ca(pr(this.lng,-180,180),this.lat)},ca.prototype.toArray=function(){return[this.lng,this.lat]},ca.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},ca.prototype.distanceTo=function(t){var o=Math.PI/180,u=this.lat*o,h=t.lat*o,y=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((t.lng-this.lng)*o);return 63710088e-1*Math.acos(Math.min(y,1))},ca.prototype.toBounds=function(t){t===void 0&&(t=0);var o=360*t/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new Pa(new ca(this.lng-u,this.lat-o),new ca(this.lng+u,this.lat+o))},ca.convert=function(t){if(t instanceof ca)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ca(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ca(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var ul=2*Math.PI*63710088e-1;function vs(t){return ul*Math.cos(t*Math.PI/180)}function ll(t){return(180+t)/360}function Lu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function ph(t,o){return t/vs(o)}function ti(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var ci=function(t,o,u){u===void 0&&(u=0),this.x=+t,this.y=+o,this.z=+u};ci.fromLngLat=function(t,o){o===void 0&&(o=0);var u=ca.convert(t);return new ci(ll(u.lng),Lu(u.lat),ph(o,u.lat))},ci.prototype.toLngLat=function(){return new ca(360*this.x-180,ti(this.y))},ci.prototype.toAltitude=function(){return this.z*vs(ti(this.y))},ci.prototype.meterInMercatorCoordinateUnits=function(){return 1/ul*(t=ti(this.y),1/Math.cos(t*Math.PI/180));var t};var Mf=function(t,o,u){this.z=t,this.x=o,this.y=u,this.key=Jh(0,t,t,o,u)};Mf.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Mf.prototype.url=function(t,o){var u,h,y,b,S,I=(h=this.y,y=this.z,b=os(256*(u=this.x),256*(h=Math.pow(2,y)-h-1),y),S=os(256*(u+1),256*(h+1),y),b[0]+","+b[1]+","+S[0]+","+S[1]),k=function(N,U,G){for(var $,re="",Te=N;Te>0;Te--)re+=(U&($=1<<Te-1)?1:0)+(G&$?2:0);return re}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",k).replace("{bbox-epsg-3857}",I)},Mf.prototype.getTilePoint=function(t){var o=Math.pow(2,this.z);return new de(8192*(t.x*o-this.x),8192*(t.y*o-this.y))},Mf.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var g0=function(t,o){this.wrap=t,this.canonical=o,this.key=Jh(t,o.z,o.z,o.x,o.y)},$o=function(t,o,u,h,y){this.overscaledZ=t,this.wrap=o,this.canonical=new Mf(u,+h,+y),this.key=Jh(o,t,u,h,y)};function Jh(t,o,u,h,y){(t*=2)<0&&(t=-1*t-1);var b=1<<u;return(b*b*t+b*y+h).toString(36)+u.toString(36)+o.toString(36)}$o.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},$o.prototype.scaledTo=function(t){var o=this.canonical.z-t;return t>this.canonical.z?new $o(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new $o(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)},$o.prototype.calculateScaledKey=function(t,o){var u=this.canonical.z-t;return t>this.canonical.z?Jh(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y):Jh(this.wrap*+o,t,t,this.canonical.x>>u,this.canonical.y>>u)},$o.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o},$o.prototype.children=function(t){if(this.overscaledZ>=t)return[new $o(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var o=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new $o(o,this.wrap,o,u,h),new $o(o,this.wrap,o,u+1,h),new $o(o,this.wrap,o,u,h+1),new $o(o,this.wrap,o,u+1,h+1)]},$o.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},$o.prototype.wrapped=function(){return new $o(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},$o.prototype.unwrapTo=function(t){return new $o(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},$o.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},$o.prototype.toUnwrapped=function(){return new g0(this.wrap,this.canonical)},$o.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},$o.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new ci(t.x-this.wrap,t.y))},gn("CanonicalTileID",Mf),gn("OverscaledTileID",$o,{omit:["posMatrix"]});var Pf=function(t,o,u){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return et('"'+u+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=o.height;var h=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=u||"mapbox";for(var y=0;y<h;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(h,y)]=this.data[this._idx(h-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,h)]=this.data[this._idx(y,h-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(h,-1)]=this.data[this._idx(h-1,0)],this.data[this._idx(-1,h)]=this.data[this._idx(0,h-1)],this.data[this._idx(h,h)]=this.data[this._idx(h-1,h-1)]};Pf.prototype.get=function(t,o){var u=new Uint8Array(this.data.buffer),h=4*this._idx(t,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[h],u[h+1],u[h+2])},Pf.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Pf.prototype._idx=function(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)},Pf.prototype._unpackMapbox=function(t,o,u){return(256*t*256+256*o+u)/10-1e4},Pf.prototype._unpackTerrarium=function(t,o,u){return 256*t+o+u/256-32768},Pf.prototype.getPixels=function(){return new yo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Pf.prototype.backfillBorder=function(t,o,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var h=o*this.dim,y=o*this.dim+this.dim,b=u*this.dim,S=u*this.dim+this.dim;switch(o){case-1:h=y-1;break;case 1:y=h+1}switch(u){case-1:b=S-1;break;case 1:S=b+1}for(var I=-o*this.dim,k=-u*this.dim,N=b;N<S;N++)for(var U=h;U<y;U++)this.data[this._idx(U,N)]=t.data[this._idx(U+I,N+k)]},gn("DEMData",Pf);var Rd=function(t){this._stringToNumber={},this._numberToString=[];for(var o=0;o<t.length;o++){var u=t[o];this._stringToNumber[u]=o,this._numberToString[o]=u}};Rd.prototype.encode=function(t){return this._stringToNumber[t]},Rd.prototype.decode=function(t){return this._numberToString[t]};var Ld=function(t,o,u,h,y){this.type="Feature",this._vectorTileFeature=t,t._z=o,t._x=u,t._y=h,this.properties=t.properties,this.id=y},yv={geometry:{configurable:!0}};yv.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},yv.geometry.set=function(t){this._geometry=t},Ld.prototype.toJSON=function(){var t={geometry:this.geometry};for(var o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(t[o]=this[o]);return t},Object.defineProperties(Ld.prototype,yv);var hh=function(){this.state={},this.stateChanges={},this.deletedStates={}};hh.prototype.updateState=function(t,o,u){var h=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},Lt(this.stateChanges[t][h],u),this.deletedStates[t]===null)for(var y in this.deletedStates[t]={},this.state[t])y!==h&&(this.deletedStates[t][y]=null);else if(this.deletedStates[t]&&this.deletedStates[t][h]===null)for(var b in this.deletedStates[t][h]={},this.state[t][h])u[b]||(this.deletedStates[t][h][b]=null);else for(var S in u)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][S]===null&&delete this.deletedStates[t][h][S]},hh.prototype.removeFeatureState=function(t,o,u){if(this.deletedStates[t]!==null){var h=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&o!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][u]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(u in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][u]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}},hh.prototype.getState=function(t,o){var u=String(o),h=Lt({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var y=this.deletedStates[t][o];if(y===null)return{};for(var b in y)delete h[b]}return h},hh.prototype.initializeTileState=function(t,o){t.setFeatureState(this.state,o)},hh.prototype.coalesceChanges=function(t,o){var u={};for(var h in this.stateChanges){this.state[h]=this.state[h]||{};var y={};for(var b in this.stateChanges[h])this.state[h][b]||(this.state[h][b]={}),Lt(this.state[h][b],this.stateChanges[h][b]),y[b]=this.state[h][b];u[h]=y}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var I={};if(this.deletedStates[S]===null)for(var k in this.state[S])I[k]={},this.state[S][k]={};else for(var N in this.deletedStates[S]){if(this.deletedStates[S][N]===null)this.state[S][N]={};else for(var U=0,G=Object.keys(this.deletedStates[S][N]);U<G.length;U+=1)delete this.state[S][N][G[U]];I[N]=this.state[S][N]}u[S]=u[S]||{},Lt(u[S],I)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(var $ in t)t[$].setFeatureState(u,o)};var If=function(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Vu(8192,16,0),this.grid3D=new Vu(8192,16,0),this.featureIndexArray=new H,this.promoteId=o};function y0(t,o,u,h,y){return Yt(t,function(b,S){var I=o instanceof js?o.get(S):null;return I&&I.evaluate?I.evaluate(u,h,y):I})}function _0(t){for(var o=1/0,u=1/0,h=-1/0,y=-1/0,b=0,S=t;b<S.length;b+=1){var I=S[b];o=Math.min(o,I.x),u=Math.min(u,I.y),h=Math.max(h,I.x),y=Math.max(y,I.y)}return{minX:o,minY:u,maxX:h,maxY:y}}function gm(t,o){return o-t}If.prototype.insert=function(t,o,u,h,y,b){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,y);for(var I=b?this.grid3D:this.grid,k=0;k<o.length;k++){for(var N=o[k],U=[1/0,1/0,-1/0,-1/0],G=0;G<N.length;G++){var $=N[G];U[0]=Math.min(U[0],$.x),U[1]=Math.min(U[1],$.y),U[2]=Math.max(U[2],$.x),U[3]=Math.max(U[3],$.y)}U[0]<8192&&U[1]<8192&&U[2]>=0&&U[3]>=0&&I.insert(S,U[0],U[1],U[2],U[3])}},If.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new _u.VectorTile(new op(this.rawTileData)).layers,this.sourceLayerCoder=new Rd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},If.prototype.query=function(t,o,u,h){var y=this;this.loadVTLayers();for(var b=t.params||{},S=8192/t.tileSize/t.scale,I=Fl(b.filter),k=t.queryGeometry,N=t.queryPadding*S,U=_0(k),G=this.grid.query(U.minX-N,U.minY-N,U.maxX+N,U.maxY+N),$=_0(t.cameraQueryGeometry),re=this.grid3D.query($.minX-N,$.minY-N,$.maxX+N,$.maxY+N,function(Ut,Gt,or,Ir){return function(Qr,kn,pn,zn,hn){for(var hi=0,Vn=Qr;hi<Vn.length;hi+=1){var Mn=Vn[hi];if(kn<=Mn.x&&pn<=Mn.y&&zn>=Mn.x&&hn>=Mn.y)return!0}var Fi=[new de(kn,pn),new de(kn,hn),new de(zn,hn),new de(zn,pn)];if(Qr.length>2){for(var Si=0,Yi=Fi;Si<Yi.length;Si+=1)if(mu(Qr,Yi[Si]))return!0}for(var jn=0;jn<Qr.length-1;jn++)if(Qa(Qr[jn],Qr[jn+1],Fi))return!0;return!1}(t.cameraQueryGeometry,Ut-N,Gt-N,or+N,Ir+N)}),Te=0,Ie=re;Te<Ie.length;Te+=1)G.push(Ie[Te]);G.sort(gm);for(var We,ze={},it=function(Ut){var Gt=G[Ut];if(Gt!==We){We=Gt;var or=y.featureIndexArray.get(Gt),Ir=null;y.loadMatchingFeature(ze,or.bucketIndex,or.sourceLayerIndex,or.featureIndex,I,b.layers,b.availableImages,o,u,h,function(Qr,kn,pn){return Ir||(Ir=$a(Qr)),kn.queryIntersectsFeature(k,Qr,pn,Ir,y.z,t.transform,S,t.pixelPosMatrix)})}},Et=0;Et<G.length;Et++)it(Et);return ze},If.prototype.loadMatchingFeature=function(t,o,u,h,y,b,S,I,k,N,U){var G=this.bucketLayerIDs[o];if(!b||function(Qr,kn){for(var pn=0;pn<Qr.length;pn++)if(kn.indexOf(Qr[pn])>=0)return!0;return!1}(b,G)){var $=this.sourceLayerCoder.decode(u),re=this.vtLayers[$].feature(h);if(y.needGeometry){var Te=lo(re,!0);if(!y.filter(new Ii(this.tileID.overscaledZ),Te,this.tileID.canonical))return}else if(!y.filter(new Ii(this.tileID.overscaledZ),re))return;for(var Ie=this.getId(re,$),We=0;We<G.length;We++){var ze=G[We];if(!(b&&b.indexOf(ze)<0)){var it=I[ze];if(it){var Et={};Ie!==void 0&&N&&(Et=N.getState(it.sourceLayer||"_geojsonTileLayer",Ie));var Ut=Lt({},k[ze]);Ut.paint=y0(Ut.paint,it.paint,re,Et,S),Ut.layout=y0(Ut.layout,it.layout,re,Et,S);var Gt=!U||U(re,it,Et);if(Gt){var or=new Ld(re,this.z,this.x,this.y,Ie);or.layer=Ut;var Ir=t[ze];Ir===void 0&&(Ir=t[ze]=[]),Ir.push({featureIndex:h,feature:or,intersectionZ:Gt})}}}}}},If.prototype.lookupSymbolFeatures=function(t,o,u,h,y,b,S,I){var k={};this.loadVTLayers();for(var N=Fl(y),U=0,G=t;U<G.length;U+=1)this.loadMatchingFeature(k,u,h,G[U],N,b,S,I,o);return k},If.prototype.hasLayer=function(t){for(var o=0,u=this.bucketLayerIDs;o<u.length;o+=1)for(var h=0,y=u[o];h<y.length;h+=1)if(t===y[h])return!0;return!1},If.prototype.getId=function(t,o){var u=t.id;return this.promoteId&&typeof(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]])=="boolean"&&(u=Number(u)),u},gn("FeatureIndex",If,{omit:["rawTileData","sourceLayerCoder"]});var ws=function(t,o){this.tileID=t,this.uid=jt(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};ws.prototype.registerFadeDuration=function(t){var o=t+this.timeAdded;o<mi.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)},ws.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},ws.prototype.loadVectorData=function(t,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var h in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(N,U){var G={};if(!U)return G;for(var $=function(){var Ie=Te[re],We=Ie.layerIds.map(function(Et){return U.getLayer(Et)}).filter(Boolean);if(We.length!==0){Ie.layers=We,Ie.stateDependentLayerIds&&(Ie.stateDependentLayers=Ie.stateDependentLayerIds.map(function(Et){return We.filter(function(Ut){return Ut.id===Et})[0]}));for(var ze=0,it=We;ze<it.length;ze+=1)G[it[ze].id]=Ie}},re=0,Te=N;re<Te.length;re+=1)$();return G}(t.buckets,o.style),this.hasSymbolBuckets=!1,this.buckets){var y=this.buckets[h];if(y instanceof De){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var b in this.buckets){var S=this.buckets[b];if(S instanceof De&&S.hasRTLText){this.hasRTLText=!0,Us.isLoading()||Us.isLoaded()||pf()!=="deferred"||pu();break}}for(var I in this.queryPadding=0,this.buckets){var k=this.buckets[I];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(I).queryRadius(k))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new p},ws.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},ws.prototype.getBucket=function(t){return this.buckets[t.id]},ws.prototype.upload=function(t){for(var o in this.buckets){var u=this.buckets[o];u.uploadPending()&&u.upload(t)}var h=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new mn(t,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new mn(t,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)},ws.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},ws.prototype.queryRenderedFeatures=function(t,o,u,h,y,b,S,I,k,N){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:y,scale:b,tileSize:this.tileSize,pixelPosMatrix:N,transform:I,params:S,queryPadding:this.queryPadding*k},t,o,u):{}},ws.prototype.querySourceFeatures=function(t,o){var u=this.latestFeatureIndex;if(u&&u.rawTileData){var h=u.loadVTLayers(),y=o?o.sourceLayer:"",b=h._geojsonTileLayer||h[y];if(b)for(var S=Fl(o&&o.filter),I=this.tileID.canonical,k=I.z,N=I.x,U=I.y,G={z:k,x:N,y:U},$=0;$<b.length;$++){var re=b.feature($);if(S.needGeometry){var Te=lo(re,!0);if(!S.filter(new Ii(this.tileID.overscaledZ),Te,this.tileID.canonical))continue}else if(!S.filter(new Ii(this.tileID.overscaledZ),re))continue;var Ie=u.getId(re,y),We=new Ld(re,k,N,U,Ie);We.tile=G,t.push(We)}}},ws.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},ws.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},ws.prototype.setExpiryData=function(t){var o=this.expirationTime;if(t.cacheControl){var u=on(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var h=Date.now(),y=!1;if(this.expirationTime>h)y=!1;else if(o)if(this.expirationTime<o)y=!0;else{var b=this.expirationTime-o;b?this.expirationTime=h+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},ws.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},ws.prototype.setFeatureState=function(t,o){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var u=this.latestFeatureIndex.loadVTLayers();for(var h in this.buckets)if(o.style.hasLayer(h)){var y=this.buckets[h],b=y.layers[0].sourceLayer||"_geojsonTileLayer",S=u[b],I=t[b];if(S&&I&&Object.keys(I).length!==0){y.update(I,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var k=o&&o.style&&o.style.getLayer(h);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(y)))}}}},ws.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},ws.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<mi.now()},ws.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},ws.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=mi.now()+t},ws.prototype.setDependencies=function(t,o){for(var u={},h=0,y=o;h<y.length;h+=1)u[y[h]]=!0;this.dependencies[t]=u},ws.prototype.hasDependency=function(t,o){for(var u=0,h=t;u<h.length;u+=1){var y=this.dependencies[h[u]];if(y){for(var b=0,S=o;b<S.length;b+=1)if(y[S[b]])return!0}}return!1};var Of=xe.performance,x0=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},Of.mark(this._marks.start)};x0.prototype.finish=function(){Of.mark(this._marks.end);var t=Of.getEntriesByName(this._marks.measure);return t.length===0&&(Of.measure(this._marks.measure,this._marks.start,this._marks.end),t=Of.getEntriesByName(this._marks.measure),Of.clearMarks(this._marks.start),Of.clearMarks(this._marks.end),Of.clearMeasures(this._marks.measure)),t},g.Actor=_a,g.AlphaImage=yu,g.CanonicalTileID=Mf,g.CollisionBoxArray=p,g.Color=Bi,g.DEMData=Pf,g.DataConstantProperty=Dn,g.DictionaryCoder=Rd,g.EXTENT=8192,g.ErrorEvent=je,g.EvaluationParameters=Ii,g.Event=Me,g.Evented=Qe,g.FeatureIndex=If,g.FillBucket=ru,g.FillExtrusionBucket=sl,g.ImageAtlas=Qt,g.ImagePosition=nt,g.LineBucket=ha,g.LngLat=ca,g.LngLatBounds=Pa,g.MercatorCoordinate=ci,g.ONE_EM=24,g.OverscaledTileID=$o,g.Point=de,g.Point$1=de,g.Properties=ns,g.Protobuf=op,g.RGBAImage=yo,g.RequestManager=Xi,g.RequestPerformance=x0,g.ResourceType=Sn,g.SegmentVector=ue,g.SourceFeatureState=hh,g.StructArrayLayout1ui2=Gl,g.StructArrayLayout2f1f2i16=Qi,g.StructArrayLayout2i4=xl,g.StructArrayLayout3ui6=vu,g.StructArrayLayout4i8=Au,g.SymbolBucket=De,g.Texture=mn,g.Tile=ws,g.Transitionable=bo,g.Uniform1f=Br,g.Uniform1i=vr,g.Uniform2f=Lr,g.Uniform3f=jr,g.Uniform4f=Fn,g.UniformColor=On,g.UniformMatrix4f=Oi,g.UnwrappedTileID=g0,g.ValidationError=Le,g.WritingMode=Pr,g.ZoomHistory=Bc,g.add=function(t,o,u){return t[0]=o[0]+u[0],t[1]=o[1]+u[1],t[2]=o[2]+u[2],t},g.addDynamicAttributes=Ze,g.asyncAll=function(t,o,u){if(!t.length)return u(null,[]);var h=t.length,y=new Array(t.length),b=null;t.forEach(function(S,I){o(S,function(k,N){k&&(b=k),y[I]=N,--h==0&&u(b,y)})})},g.bezier=dt,g.bindAll=sr,g.browser=mi,g.cacheEntryPossiblyAdded=function(t){++Ei>Dr&&(t.getActor().send("enforceCacheSizeLimit",Jt),Ei=0)},g.clamp=tr,g.clearTileCache=function(t){var o=xe.caches.delete("mapbox-tiles");t&&o.catch(t).then(function(){return t()})},g.clipLine=So,g.clone=function(t){var o=new ua(16);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},g.clone$1=Ke,g.clone$2=function(t){var o=new ua(3);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o},g.collisionCircleLayout=Qh,g.config=Gn,g.create=function(){var t=new ua(16);return ua!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},g.create$1=function(){var t=new ua(9);return ua!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},g.create$2=function(){var t=new ua(4);return ua!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},g.createCommonjsModule=Re,g.createExpression=oc,g.createLayout=Da,g.createStyleLayer=function(t){return t.type==="custom"?new Zr(t):new en[t.type](t)},g.cross=function(t,o,u){var h=o[0],y=o[1],b=o[2],S=u[0],I=u[1],k=u[2];return t[0]=y*k-b*I,t[1]=b*S-h*k,t[2]=h*I-y*S,t},g.deepEqual=function t(o,u){if(Array.isArray(o)){if(!Array.isArray(u)||o.length!==u.length)return!1;for(var h=0;h<o.length;h++)if(!t(o[h],u[h]))return!1;return!0}if(typeof o=="object"&&o!==null&&u!==null){if(typeof u!="object"||Object.keys(o).length!==Object.keys(u).length)return!1;for(var y in o)if(!t(o[y],u[y]))return!1;return!0}return o===u},g.dot=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]},g.dot$1=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]+t[3]*o[3]},g.ease=At,g.emitValidationErrors=Fc,g.endsWith=q,g.enforceCacheSizeLimit=function(t){cn(),ea&&ea.then(function(o){o.keys().then(function(u){for(var h=0;h<u.length-t;h++)o.delete(u[h])})})},g.evaluateSizeForFeature=Yn,g.evaluateSizeForZoom=ui,g.evaluateVariableOffset=wl,g.evented=Uc,g.extend=Lt,g.featureFilter=Fl,g.filterObject=ct,g.fromRotation=function(t,o){var u=Math.sin(o),h=Math.cos(o);return t[0]=h,t[1]=u,t[2]=0,t[3]=-u,t[4]=h,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},g.getAnchorAlignment=Hr,g.getAnchorJustification=Ae,g.getArrayBuffer=Na,g.getImage=K,g.getJSON=function(t,o){return Ho(Lt(t,{type:"json"}),o)},g.getRTLTextPluginStatus=pf,g.getReferrer=Mi,g.getVideo=function(t,o){var u,h,y=xe.document.createElement("video");y.muted=!0,y.onloadstart=function(){o(null,y)};for(var b=0;b<t.length;b++){var S=xe.document.createElement("source");u=t[b],h=void 0,(h=xe.document.createElement("a")).href=u,(h.protocol!==xe.document.location.protocol||h.host!==xe.document.location.host)&&(y.crossOrigin="Anonymous"),S.src=t[b],y.appendChild(S)}return{cancel:function(){}}},g.identity=eu,g.invert=function(t,o){var u=o[0],h=o[1],y=o[2],b=o[3],S=o[4],I=o[5],k=o[6],N=o[7],U=o[8],G=o[9],$=o[10],re=o[11],Te=o[12],Ie=o[13],We=o[14],ze=o[15],it=u*I-h*S,Et=u*k-y*S,Ut=u*N-b*S,Gt=h*k-y*I,or=h*N-b*I,Ir=y*N-b*k,Qr=U*Ie-G*Te,kn=U*We-$*Te,pn=U*ze-re*Te,zn=G*We-$*Ie,hn=G*ze-re*Ie,hi=$*ze-re*We,Vn=it*hi-Et*hn+Ut*zn+Gt*pn-or*kn+Ir*Qr;return Vn?(t[0]=(I*hi-k*hn+N*zn)*(Vn=1/Vn),t[1]=(y*hn-h*hi-b*zn)*Vn,t[2]=(Ie*Ir-We*or+ze*Gt)*Vn,t[3]=($*or-G*Ir-re*Gt)*Vn,t[4]=(k*pn-S*hi-N*kn)*Vn,t[5]=(u*hi-y*pn+b*kn)*Vn,t[6]=(We*Ut-Te*Ir-ze*Et)*Vn,t[7]=(U*Ir-$*Ut+re*Et)*Vn,t[8]=(S*hn-I*pn+N*Qr)*Vn,t[9]=(h*pn-u*hn-b*Qr)*Vn,t[10]=(Te*or-Ie*Ut+ze*it)*Vn,t[11]=(G*Ut-U*or-re*it)*Vn,t[12]=(I*kn-S*zn-k*Qr)*Vn,t[13]=(u*zn-h*kn+y*Qr)*Vn,t[14]=(Ie*Et-Te*Gt-We*it)*Vn,t[15]=(U*Gt-G*Et+$*it)*Vn,t):null},g.isChar=Kr,g.isMapboxURL=Ri,g.keysDifference=function(t,o){var u=[];for(var h in t)h in o||u.push(h);return u},g.makeRequest=Ho,g.mapObject=Yt,g.mercatorXfromLng=ll,g.mercatorYfromLat=Lu,g.mercatorZfromAltitude=ph,g.mul=Fs,g.multiply=As,g.mvt=_u,g.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},g.normalize=function(t,o){var u=o[0],h=o[1],y=o[2],b=u*u+h*h+y*y;return b>0&&(b=1/Math.sqrt(b)),t[0]=o[0]*b,t[1]=o[1]*b,t[2]=o[2]*b,t},g.number=ga,g.offscreenCanvasSupported=di,g.ortho=function(t,o,u,h,y,b,S){var I=1/(o-u),k=1/(h-y),N=1/(b-S);return t[0]=-2*I,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*k,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*N,t[11]=0,t[12]=(o+u)*I,t[13]=(y+h)*k,t[14]=(S+b)*N,t[15]=1,t},g.parseGlyphPBF=function(t){return new op(t).readFields(Mr,[])},g.pbf=op,g.performSymbolLayout=function(t,o,u,h,y,b,S){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var I=t.layers[0].layout,k=t.layers[0]._unevaluatedLayout._values,N={};if(t.textSizeData.kind==="composite"){var U=t.textSizeData,G=U.maxZoom;N.compositeTextSizes=[k["text-size"].possiblyEvaluate(new Ii(U.minZoom),S),k["text-size"].possiblyEvaluate(new Ii(G),S)]}if(t.iconSizeData.kind==="composite"){var $=t.iconSizeData,re=$.maxZoom;N.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new Ii($.minZoom),S),k["icon-size"].possiblyEvaluate(new Ii(re),S)]}N.layoutTextSize=k["text-size"].possiblyEvaluate(new Ii(t.zoom+1),S),N.layoutIconSize=k["icon-size"].possiblyEvaluate(new Ii(t.zoom+1),S),N.textMaxSize=k["text-size"].possiblyEvaluate(new Ii(18));for(var Te=24*I.get("text-line-height"),Ie=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",We=I.get("text-keep-upright"),ze=I.get("text-size"),it=function(){var Gt=Ut[Et],or=I.get("text-font").evaluate(Gt,{},S).join(","),Ir=ze.evaluate(Gt,{},S),Qr=N.layoutTextSize.evaluate(Gt,{},S),kn=N.layoutIconSize.evaluate(Gt,{},S),pn={horizontal:{},vertical:void 0},zn=Gt.text,hn=[0,0];if(zn){var hi=zn.toString(),Vn=24*I.get("text-letter-spacing").evaluate(Gt,{},S),Mn=function(Wi){for(var Fa=0,Sa=Wi;Fa<Sa.length;Fa+=1)if(ia=Sa[Fa].charCodeAt(0),Kr.Arabic(ia)||Kr["Arabic Supplement"](ia)||Kr["Arabic Extended-A"](ia)||Kr["Arabic Presentation Forms-A"](ia)||Kr["Arabic Presentation Forms-B"](ia))return!1;var ia;return!0}(hi)?Vn:0,Fi=I.get("text-anchor").evaluate(Gt,{},S),Si=I.get("text-variable-anchor");if(!Si){var Yi=I.get("text-radial-offset").evaluate(Gt,{},S);hn=Yi?wl(Fi,[24*Yi,Co]):I.get("text-offset").evaluate(Gt,{},S).map(function(Wi){return 24*Wi})}var jn=Ie?"center":I.get("text-justify").evaluate(Gt,{},S),da=I.get("symbol-placement"),ao=da==="point"?24*I.get("text-max-width").evaluate(Gt,{},S):0,Ao=function(){t.allowVerticalPlacement&&ff(hi)&&(pn.vertical=$r(zn,o,u,y,or,ao,Te,Fi,"left",Mn,hn,Pr.vertical,!0,da,Qr,Ir))};if(!Ie&&Si){for(var Ha=jn==="auto"?Si.map(function(Wi){return Ae(Wi)}):[jn],Hi=!1,_o=0;_o<Ha.length;_o++){var Qo=Ha[_o];if(!pn.horizontal[Qo])if(Hi)pn.horizontal[Qo]=pn.horizontal[0];else{var Jo=$r(zn,o,u,y,or,ao,Te,"center",Qo,Mn,hn,Pr.horizontal,!1,da,Qr,Ir);Jo&&(pn.horizontal[Qo]=Jo,Hi=Jo.positionedLines.length===1)}}Ao()}else{jn==="auto"&&(jn=Ae(Fi));var Ts=$r(zn,o,u,y,or,ao,Te,Fi,jn,Mn,hn,Pr.horizontal,!1,da,Qr,Ir);Ts&&(pn.horizontal[jn]=Ts),Ao(),ff(hi)&&Ie&&We&&(pn.vertical=$r(zn,o,u,y,or,ao,Te,Fi,jn,Mn,hn,Pr.vertical,!1,da,Qr,Ir))}}var ss=void 0,Ws=!1;if(Gt.icon&&Gt.icon.name){var Lo=h[Gt.icon.name];Lo&&(ss=function(Wi,Fa,Sa){var ia=Hr(Sa),j=Fa[0]-Wi.displaySize[0]*ia.horizontalAlign,Ms=Fa[1]-Wi.displaySize[1]*ia.verticalAlign;return{image:Wi,top:Ms,bottom:Ms+Wi.displaySize[1],left:j,right:j+Wi.displaySize[0]}}(y[Gt.icon.name],I.get("icon-offset").evaluate(Gt,{},S),I.get("icon-anchor").evaluate(Gt,{},S)),Ws=Lo.sdf,t.sdfIcons===void 0?t.sdfIcons=Lo.sdf:t.sdfIcons!==Lo.sdf&&et("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Lo.pixelRatio!==t.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var ms=xt(pn.horizontal)||pn.vertical;t.iconsInText=!!ms&&ms.iconsInText,(ms||ss)&&function(Wi,Fa,Sa,ia,j,Ms,Wa,ko,Ps,fa,$l){var ku=Ms.textMaxSize.evaluate(Fa,{});ku===void 0&&(ku=Wa);var xu,wo=Wi.layers[0].layout,Ql=wo.get("icon-offset").evaluate(Fa,{},$l),cl=xt(Sa.horizontal),sp=Wa/24,Rf=Wi.tilePixelRatio*sp,up=Wi.tilePixelRatio*ku/24,Tl=Wi.tilePixelRatio*ko,Up=Wi.tilePixelRatio*wo.get("symbol-spacing"),ed=wo.get("text-padding")*Wi.tilePixelRatio,lp=wo.get("icon-padding")*Wi.tilePixelRatio,Zp=wo.get("text-max-angle")/180*Math.PI,dh=wo.get("text-rotation-alignment")==="map"&&wo.get("symbol-placement")!=="point",vh=wo.get("icon-rotation-alignment")==="map"&&wo.get("symbol-placement")!=="point",_c=wo.get("symbol-placement"),Yc=Up/2,cp=wo.get("icon-text-fit");ia&&cp!=="none"&&(Wi.allowVerticalPlacement&&Sa.vertical&&(xu=ni(ia,Sa.vertical,cp,wo.get("icon-text-fit-padding"),Ql,sp)),cl&&(ia=ni(ia,cl,cp,wo.get("icon-text-fit-padding"),Ql,sp)));var qc=function(bv,xh){xh.x<0||xh.x>=8192||xh.y<0||xh.y>=8192||function(To,Ml,Ev,$c,ad,Dd,bh,Jl,Eh,Hp,Sh,Ch,od,Fd,Wp,Bd,Nd,Xs,zd,Ud,Du,Ah,Zd,ec,Sv){var jd,Df,vp,mp,gp,yp=To.addToLineVertexArray(Ml,Ev),Vd=0,Gd=0,Cv=0,Av=0,Hd=-1,Wd=-1,xc={},wv=Ce(""),Xd=0,sd=0;if(Jl._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Xd=(jd=Jl.layout.get("text-offset").evaluate(Du,{},ec).map(function(Ff){return 24*Ff}))[0],sd=jd[1]):(Xd=24*Jl.layout.get("text-radial-offset").evaluate(Du,{},ec),sd=Co),To.allowVerticalPlacement&&$c.vertical){var Yd=Jl.layout.get("text-rotate").evaluate(Du,{},ec)+90;mp=new Vo(Eh,Ml,Hp,Sh,Ch,$c.vertical,od,Fd,Wp,Yd),bh&&(gp=new Vo(Eh,Ml,Hp,Sh,Ch,bh,Nd,Xs,Wp,Yd))}if(ad){var ud=Jl.layout.get("icon-rotate").evaluate(Du,{}),qd=Jl.layout.get("icon-text-fit")!=="none",Xp=Zo(ad,ud,Zd,qd),ld=bh?Zo(bh,ud,Zd,qd):void 0;vp=new Vo(Eh,Ml,Hp,Sh,Ch,ad,Nd,Xs,!1,ud),Vd=4*Xp.length;var Tv=To.iconSizeData,wh=null;Tv.kind==="source"?(wh=[128*Jl.layout.get("icon-size").evaluate(Du,{})])[0]>32640&&et(To.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Tv.kind==="composite"&&((wh=[128*Ah.compositeIconSizes[0].evaluate(Du,{},ec),128*Ah.compositeIconSizes[1].evaluate(Du,{},ec)])[0]>32640||wh[1]>32640)&&et(To.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),To.addSymbols(To.icon,Xp,wh,Ud,zd,Du,!1,Ml,yp.lineStartIndex,yp.lineLength,-1,ec),Hd=To.icon.placedSymbolArray.length-1,ld&&(Gd=4*ld.length,To.addSymbols(To.icon,ld,wh,Ud,zd,Du,Pr.vertical,Ml,yp.lineStartIndex,yp.lineLength,-1,ec),Wd=To.icon.placedSymbolArray.length-1)}for(var Mv in $c.horizontal){var cd=$c.horizontal[Mv];if(!Df){wv=Ce(cd.text);var b0=Jl.layout.get("text-rotate").evaluate(Du,{},ec);Df=new Vo(Eh,Ml,Hp,Sh,Ch,cd,od,Fd,Wp,b0)}var Pv=cd.positionedLines.length===1;if(Cv+=Dt(To,Ml,cd,Dd,Jl,Wp,Du,Bd,yp,$c.vertical?Pr.horizontal:Pr.horizontalOnly,Pv?Object.keys($c.horizontal):[Mv],xc,Hd,Ah,ec),Pv)break}$c.vertical&&(Av+=Dt(To,Ml,$c.vertical,Dd,Jl,Wp,Du,Bd,yp,Pr.vertical,["vertical"],xc,Wd,Ah,ec));var E0=Df?Df.boxStartIndex:To.collisionBoxArray.length,S0=Df?Df.boxEndIndex:To.collisionBoxArray.length,C0=mp?mp.boxStartIndex:To.collisionBoxArray.length,A0=mp?mp.boxEndIndex:To.collisionBoxArray.length,w0=vp?vp.boxStartIndex:To.collisionBoxArray.length,T0=vp?vp.boxEndIndex:To.collisionBoxArray.length,M0=gp?gp.boxStartIndex:To.collisionBoxArray.length,P0=gp?gp.boxEndIndex:To.collisionBoxArray.length,bc=-1,fd=function(Ff,Qc){return Ff&&Ff.circleDiameter?Math.max(Ff.circleDiameter,Qc):Qc};bc=fd(Df,bc),bc=fd(mp,bc),bc=fd(vp,bc);var Iv=(bc=fd(gp,bc))>-1?1:0;Iv&&(bc*=Sv/24),To.glyphOffsetArray.length>=De.MAX_GLYPHS&&et("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Du.sortKey!==void 0&&To.addToSortKeyRanges(To.symbolInstances.length,Du.sortKey),To.symbolInstances.emplaceBack(Ml.x,Ml.y,xc.right>=0?xc.right:-1,xc.center>=0?xc.center:-1,xc.left>=0?xc.left:-1,xc.vertical||-1,Hd,Wd,wv,E0,S0,C0,A0,w0,T0,M0,P0,Hp,Cv,Av,Vd,Gd,Iv,0,od,Xd,sd,bc)}(Wi,xh,bv,Sa,ia,j,xu,Wi.layers[0],Wi.collisionBoxArray,Fa.index,Fa.sourceLayerIndex,Wi.index,Rf,ed,dh,Ps,Tl,lp,vh,Ql,Fa,Ms,fa,$l,Wa)};if(_c==="line")for(var fp=0,td=So(Fa.geometry,0,0,8192,8192);fp<td.length;fp+=1)for(var rd=td[fp],jp=0,mh=qo(rd,Up,Zp,Sa.vertical||cl,ia,24,up,Wi.overscaling,8192);jp<mh.length;jp+=1){var Kc=mh[jp];cl&&vn(Wi,cl.text,Yc,Kc)||qc(rd,Kc)}else if(_c==="line-center")for(var gh=0,fl=Fa.geometry;gh<fl.length;gh+=1){var yh=fl[gh];if(yh.length>1){var nd=Ga(yh,Zp,Sa.vertical||cl,ia,24,up);nd&&qc(yh,nd)}}else if(Fa.type==="Polygon")for(var Vp=0,Lf=bf(Fa.geometry,0);Vp<Lf.length;Vp+=1){var pp=Lf[Vp],Gp=ei(pp,16);qc(pp[0],new Vr(Gp.x,Gp.y,0))}else if(Fa.type==="LineString")for(var kf=0,hp=Fa.geometry;kf<hp.length;kf+=1){var dp=hp[kf];qc(dp,new Vr(dp[0].x,dp[0].y,0))}else if(Fa.type==="Point")for(var id=0,_h=Fa.geometry;id<_h.length;id+=1)for(var _v=0,xv=_h[id];_v<xv.length;_v+=1){var kd=xv[_v];qc([kd],new Vr(kd.x,kd.y,0))}}(t,Gt,pn,ss,h,N,Qr,kn,hn,Ws,S)},Et=0,Ut=t.features;Et<Ut.length;Et+=1)it();b&&t.generateCollisionDebugBuffers()},g.perspective=function(t,o,u,h,y){var b,S=1/Math.tan(o/2);return t[0]=S/u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=S,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,y!=null&&y!==1/0?(t[10]=(y+h)*(b=1/(h-y)),t[14]=2*y*h*b):(t[10]=-1,t[14]=-2*h),t},g.pick=function(t,o){for(var u={},h=0;h<o.length;h++){var y=o[h];y in t&&(u[y]=t[y])}return u},g.plugin=Us,g.polygonIntersectsPolygon=Uo,g.postMapLoadEvent=Nt,g.postTurnstileEvent=xo,g.potpack=br,g.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],g.register=gn,g.registerForPluginStateChange=function(t){return t({pluginStatus:rs,pluginURL:fu}),Uc.on("pluginStateChange",t),t},g.renderColorRamp=vf,g.rotate=function(t,o,u){var h=o[0],y=o[1],b=o[2],S=o[3],I=Math.sin(u),k=Math.cos(u);return t[0]=h*k+b*I,t[1]=y*k+S*I,t[2]=h*-I+b*k,t[3]=y*-I+S*k,t},g.rotateX=function(t,o,u){var h=Math.sin(u),y=Math.cos(u),b=o[4],S=o[5],I=o[6],k=o[7],N=o[8],U=o[9],G=o[10],$=o[11];return o!==t&&(t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[4]=b*y+N*h,t[5]=S*y+U*h,t[6]=I*y+G*h,t[7]=k*y+$*h,t[8]=N*y-b*h,t[9]=U*y-S*h,t[10]=G*y-I*h,t[11]=$*y-k*h,t},g.rotateZ=function(t,o,u){var h=Math.sin(u),y=Math.cos(u),b=o[0],S=o[1],I=o[2],k=o[3],N=o[4],U=o[5],G=o[6],$=o[7];return o!==t&&(t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[0]=b*y+N*h,t[1]=S*y+U*h,t[2]=I*y+G*h,t[3]=k*y+$*h,t[4]=N*y-b*h,t[5]=U*y-S*h,t[6]=G*y-I*h,t[7]=$*y-k*h,t},g.scale=function(t,o,u){var h=u[0],y=u[1],b=u[2];return t[0]=o[0]*h,t[1]=o[1]*h,t[2]=o[2]*h,t[3]=o[3]*h,t[4]=o[4]*y,t[5]=o[5]*y,t[6]=o[6]*y,t[7]=o[7]*y,t[8]=o[8]*b,t[9]=o[9]*b,t[10]=o[10]*b,t[11]=o[11]*b,t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},g.scale$1=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t[3]=o[3]*u,t},g.scale$2=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t},g.setCacheLimits=function(t,o){Jt=t,Dr=o},g.setRTLTextPlugin=function(t,o,u){if(u===void 0&&(u=!1),rs==="deferred"||rs==="loading"||rs==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");fu=mi.resolveURL(t),rs="deferred",Hu=o,zc(),u||pu()},g.sphericalToCartesian=function(t){var o=t[0],u=t[1],h=t[2];return u+=90,u*=Math.PI/180,h*=Math.PI/180,{x:o*Math.cos(u)*Math.sin(h),y:o*Math.sin(u)*Math.sin(h),z:o*Math.cos(h)}},g.sqrLen=function(t){var o=t[0],u=t[1];return o*o+u*u},g.styleSpec=se,g.sub=function(t,o,u){return t[0]=o[0]-u[0],t[1]=o[1]-u[1],t[2]=o[2]-u[2],t},g.symbolSize=Ni,g.transformMat3=function(t,o,u){var h=o[0],y=o[1],b=o[2];return t[0]=h*u[0]+y*u[3]+b*u[6],t[1]=h*u[1]+y*u[4]+b*u[7],t[2]=h*u[2]+y*u[5]+b*u[8],t},g.transformMat4=df,g.translate=function(t,o,u){var h,y,b,S,I,k,N,U,G,$,re,Te,Ie=u[0],We=u[1],ze=u[2];return o===t?(t[12]=o[0]*Ie+o[4]*We+o[8]*ze+o[12],t[13]=o[1]*Ie+o[5]*We+o[9]*ze+o[13],t[14]=o[2]*Ie+o[6]*We+o[10]*ze+o[14],t[15]=o[3]*Ie+o[7]*We+o[11]*ze+o[15]):(y=o[1],b=o[2],S=o[3],I=o[4],k=o[5],N=o[6],U=o[7],G=o[8],$=o[9],re=o[10],Te=o[11],t[0]=h=o[0],t[1]=y,t[2]=b,t[3]=S,t[4]=I,t[5]=k,t[6]=N,t[7]=U,t[8]=G,t[9]=$,t[10]=re,t[11]=Te,t[12]=h*Ie+I*We+G*ze+o[12],t[13]=y*Ie+k*We+$*ze+o[13],t[14]=b*Ie+N*We+re*ze+o[14],t[15]=S*Ie+U*We+Te*ze+o[15]),t},g.triggerPluginCompletionEvent=Mp,g.uniqueId=jt,g.validateCustomStyleLayer=function(t){var o=[],u=t.id;return u===void 0&&o.push({message:"layers."+u+': missing required property "id"'}),t.render===void 0&&o.push({message:"layers."+u+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&o.push({message:"layers."+u+': property "renderingMode" must be either "2d" or "3d"'}),o},g.validateLight=cc,g.validateStyle=Za,g.values=function(t){var o=[];for(var u in t)o.push(t[u]);return o},g.vectorTile=_u,g.version="1.13.2",g.warnOnce=et,g.webpSupported=ai,g.window=xe,g.wrap=pr}),_e(["./shared"],function(g){"use strict";function Re(V){var K=typeof V;if(K==="number"||K==="boolean"||K==="string"||V==null)return JSON.stringify(V);if(Array.isArray(V)){for(var te="[",he=0,Me=V;he<Me.length;he+=1)te+=Re(Me[he])+",";return te+"]"}for(var je=Object.keys(V).sort(),Qe="{",se=0;se<je.length;se++)Qe+=JSON.stringify(je[se])+":"+Re(V[je[se]])+",";return Qe+"}"}function X(V){for(var K="",te=0,he=g.refProperties;te<he.length;te+=1)K+="/"+Re(V[he[te]]);return K}var pe=function(V){this.keyCache={},V&&this.replace(V)};pe.prototype.replace=function(V){this._layerConfigs={},this._layers={},this.update(V,[])},pe.prototype.update=function(V,K){for(var te=this,he=0,Me=V;he<Me.length;he+=1){var je=Me[he];this._layerConfigs[je.id]=je;var Qe=this._layers[je.id]=g.createStyleLayer(je);Qe._featureFilter=g.featureFilter(Qe.filter),this.keyCache[je.id]&&delete this.keyCache[je.id]}for(var se=0,Le=K;se<Le.length;se+=1){var ft=Le[se];delete this.keyCache[ft],delete this._layerConfigs[ft],delete this._layers[ft]}this.familiesBySource={};for(var hr=0,Ot=function(Ur,Xr){for(var vi={},rn=0;rn<Ur.length;rn++){var nn=Xr&&Xr[Ur[rn].id]||X(Ur[rn]);Xr&&(Xr[Ur[rn].id]=nn);var ji=vi[nn];ji||(ji=vi[nn]=[]),ji.push(Ur[rn])}var fi=[];for(var Ai in vi)fi.push(vi[Ai]);return fi}(g.values(this._layerConfigs),this.keyCache);hr<Ot.length;hr+=1){var kt=Ot[hr].map(function(Ur){return te._layers[Ur.id]}),dr=kt[0];if(dr.visibility!=="none"){var En=dr.source||"",fn=this.familiesBySource[En];fn||(fn=this.familiesBySource[En]={});var Mt=dr.sourceLayer||"_geojsonTileLayer",tn=fn[Mt];tn||(tn=fn[Mt]=[]),tn.push(kt)}}};var de=function(V){var K={},te=[];for(var he in V){var Me=V[he],je=K[he]={};for(var Qe in Me){var se=Me[+Qe];if(se&&se.bitmap.width!==0&&se.bitmap.height!==0){var Le={x:0,y:0,w:se.bitmap.width+2,h:se.bitmap.height+2};te.push(Le),je[Qe]={rect:Le,metrics:se.metrics}}}}var ft=g.potpack(te),hr=new g.AlphaImage({width:ft.w||1,height:ft.h||1});for(var Ot in V){var kt=V[Ot];for(var dr in kt){var En=kt[+dr];if(En&&En.bitmap.width!==0&&En.bitmap.height!==0){var fn=K[Ot][dr].rect;g.AlphaImage.copy(En.bitmap,hr,{x:0,y:0},{x:fn.x+1,y:fn.y+1},En.bitmap)}}}this.image=hr,this.positions=K};g.register("GlyphAtlas",de);var Ne=function(V){this.tileID=new g.OverscaledTileID(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId};function xe(V,K,te){for(var he=new g.EvaluationParameters(K),Me=0,je=V;Me<je.length;Me+=1)je[Me].recalculate(he,te)}function tt(V,K){var te=g.getArrayBuffer(V.request,function(he,Me,je,Qe){he?K(he):Me&&K(null,{vectorTile:new g.vectorTile.VectorTile(new g.pbf(Me)),rawData:Me,cacheControl:je,expires:Qe})});return function(){te.cancel(),K()}}Ne.prototype.parse=function(V,K,te,he,Me){var je=this;this.status="parsing",this.data=V,this.collisionBoxArray=new g.CollisionBoxArray;var Qe=new g.DictionaryCoder(Object.keys(V.layers).sort()),se=new g.FeatureIndex(this.tileID,this.promoteId);se.bucketLayerIDs=[];var Le,ft,hr,Ot,kt={},dr={featureIndex:se,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:te},En=K.familiesBySource[this.source];for(var fn in En){var Mt=V.layers[fn];if(Mt){Mt.version===1&&g.warnOnce('Vector tile source "'+this.source+'" layer "'+fn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var tn=Qe.encode(fn),Ur=[],Xr=0;Xr<Mt.length;Xr++){var vi=Mt.feature(Xr),rn=se.getId(vi,fn);Ur.push({feature:vi,id:rn,index:Xr,sourceLayerIndex:tn})}for(var nn=0,ji=En[fn];nn<ji.length;nn+=1){var fi=ji[nn],Ai=fi[0];Ai.minzoom&&this.zoom<Math.floor(Ai.minzoom)||Ai.maxzoom&&this.zoom>=Ai.maxzoom||Ai.visibility!=="none"&&(xe(fi,this.zoom,te),(kt[Ai.id]=Ai.createBucket({index:se.bucketLayerIDs.length,layers:fi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:tn,sourceID:this.source})).populate(Ur,dr,this.tileID.canonical),se.bucketLayerIDs.push(fi.map(function(Ci){return Ci.id})))}}}var _i=g.mapObject(dr.glyphDependencies,function(Ci){return Object.keys(Ci).map(Number)});Object.keys(_i).length?he.send("getGlyphs",{uid:this.uid,stacks:_i},function(Ci,wi){Le||(Le=Ci,ft=wi,Ca.call(je))}):ft={};var st=Object.keys(dr.iconDependencies);st.length?he.send("getImages",{icons:st,source:this.source,tileID:this.tileID,type:"icons"},function(Ci,wi){Le||(Le=Ci,hr=wi,Ca.call(je))}):hr={};var Ct=Object.keys(dr.patternDependencies);function Ca(){if(Le)return Me(Le);if(ft&&hr&&Ot){var Ci=new de(ft),wi=new g.ImageAtlas(hr,Ot);for(var Bi in kt){var wr=kt[Bi];wr instanceof g.SymbolBucket?(xe(wr.layers,this.zoom,te),g.performSymbolLayout(wr,ft,Ci.positions,hr,wi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):wr.hasPattern&&(wr instanceof g.LineBucket||wr instanceof g.FillBucket||wr instanceof g.FillExtrusionBucket)&&(xe(wr.layers,this.zoom,te),wr.addFeatures(dr,this.tileID.canonical,wi.patternPositions))}this.status="done",Me(null,{buckets:g.values(kt).filter(function(an){return!an.isEmpty()}),featureIndex:se,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ci.image,imageAtlas:wi,glyphMap:this.returnDependencies?ft:null,iconMap:this.returnDependencies?hr:null,glyphPositions:this.returnDependencies?Ci.positions:null})}}Ct.length?he.send("getImages",{icons:Ct,source:this.source,tileID:this.tileID,type:"patterns"},function(Ci,wi){Le||(Le=Ci,Ot=wi,Ca.call(je))}):Ot={},Ca.call(this)};var dt=function(V,K,te,he){this.actor=V,this.layerIndex=K,this.availableImages=te,this.loadVectorData=he||tt,this.loading={},this.loaded={}};dt.prototype.loadTile=function(V,K){var te=this,he=V.uid;this.loading||(this.loading={});var Me=!!(V&&V.request&&V.request.collectResourceTiming)&&new g.RequestPerformance(V.request),je=this.loading[he]=new Ne(V);je.abort=this.loadVectorData(V,function(Qe,se){if(delete te.loading[he],Qe||!se)return je.status="done",te.loaded[he]=je,K(Qe);var Le=se.rawData,ft={};se.expires&&(ft.expires=se.expires),se.cacheControl&&(ft.cacheControl=se.cacheControl);var hr={};if(Me){var Ot=Me.finish();Ot&&(hr.resourceTiming=JSON.parse(JSON.stringify(Ot)))}je.vectorTile=se.vectorTile,je.parse(se.vectorTile,te.layerIndex,te.availableImages,te.actor,function(kt,dr){if(kt||!dr)return K(kt);K(null,g.extend({rawTileData:Le.slice(0)},dr,ft,hr))}),te.loaded=te.loaded||{},te.loaded[he]=je})},dt.prototype.reloadTile=function(V,K){var te=this,he=this.loaded,Me=V.uid,je=this;if(he&&he[Me]){var Qe=he[Me];Qe.showCollisionBoxes=V.showCollisionBoxes;var se=function(Le,ft){var hr=Qe.reloadCallback;hr&&(delete Qe.reloadCallback,Qe.parse(Qe.vectorTile,je.layerIndex,te.availableImages,je.actor,hr)),K(Le,ft)};Qe.status==="parsing"?Qe.reloadCallback=se:Qe.status==="done"&&(Qe.vectorTile?Qe.parse(Qe.vectorTile,this.layerIndex,this.availableImages,this.actor,se):se())}},dt.prototype.abortTile=function(V,K){var te=this.loading,he=V.uid;te&&te[he]&&te[he].abort&&(te[he].abort(),delete te[he]),K()},dt.prototype.removeTile=function(V,K){var te=this.loaded,he=V.uid;te&&te[he]&&delete te[he],K()};var At=g.window.ImageBitmap,tr=function(){this.loaded={}};function pr(V,K){if(V.length!==0){Lt(V[0],K);for(var te=1;te<V.length;te++)Lt(V[te],!K)}}function Lt(V,K){for(var te=0,he=0,Me=V.length,je=Me-1;he<Me;je=he++)te+=(V[he][0]-V[je][0])*(V[je][1]+V[he][1]);te>=0!=!!K&&V.reverse()}tr.prototype.loadTile=function(V,K){var te=V.uid,he=V.encoding,Me=V.rawImageData,je=At&&Me instanceof At?this.getImageData(Me):Me,Qe=new g.DEMData(te,je,he);this.loaded=this.loaded||{},this.loaded[te]=Qe,K(null,Qe)},tr.prototype.getImageData=function(V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);var K=this.offscreenCanvasContext.getImageData(-1,-1,V.width+2,V.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new g.RGBAImage({width:K.width,height:K.height},K.data)},tr.prototype.removeTile=function(V){var K=this.loaded,te=V.uid;K&&K[te]&&delete K[te]};var nr=g.vectorTile.VectorTileFeature.prototype.toGeoJSON,jt=function(V){this._feature=V,this.extent=g.EXTENT,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))};jt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var V=[],K=0,te=this._feature.geometry;K<te.length;K+=1){var he=te[K];V.push([new g.Point$1(he[0],he[1])])}return V}for(var Me=[],je=0,Qe=this._feature.geometry;je<Qe.length;je+=1){for(var se=[],Le=0,ft=Qe[je];Le<ft.length;Le+=1){var hr=ft[Le];se.push(new g.Point$1(hr[0],hr[1]))}Me.push(se)}return Me},jt.prototype.toGeoJSON=function(V,K,te){return nr.call(this,V,K,te)};var ht=function(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=g.EXTENT,this.length=V.length,this._features=V};ht.prototype.feature=function(V){return new jt(this._features[V])};var gt=g.vectorTile.VectorTileFeature,sr=q;function q(V,K){this.options=K||{},this.features=V,this.length=V.length}function Yt(V,K){this.id=typeof V.id=="number"?V.id:void 0,this.type=V.type,this.rawGeometry=V.type===1?[V.geometry]:V.geometry,this.properties=V.tags,this.extent=K||4096}q.prototype.feature=function(V){return new Yt(this.features[V],this.options.extent)},Yt.prototype.loadGeometry=function(){var V=this.rawGeometry;this.geometry=[];for(var K=0;K<V.length;K++){for(var te=V[K],he=[],Me=0;Me<te.length;Me++)he.push(new g.Point$1(te[Me][0],te[Me][1]));this.geometry.push(he)}return this.geometry},Yt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var V=this.geometry,K=1/0,te=-1/0,he=1/0,Me=-1/0,je=0;je<V.length;je++)for(var Qe=V[je],se=0;se<Qe.length;se++){var Le=Qe[se];K=Math.min(K,Le.x),te=Math.max(te,Le.x),he=Math.min(he,Le.y),Me=Math.max(Me,Le.y)}return[K,he,te,Me]},Yt.prototype.toGeoJSON=gt.prototype.toGeoJSON;var ct=wt,Ke=sr;function wt(V){var K=new g.pbf;return function(te,he){for(var Me in te.layers)he.writeMessage(3,et,te.layers[Me])}(V,K),K.finish()}function et(V,K){var te;K.writeVarintField(15,V.version||1),K.writeStringField(1,V.name||""),K.writeVarintField(5,V.extent||4096);var he={keys:[],values:[],keycache:{},valuecache:{}};for(te=0;te<V.length;te++)he.feature=V.feature(te),K.writeMessage(2,qt,he);var Me=he.keys;for(te=0;te<Me.length;te++)K.writeStringField(3,Me[te]);var je=he.values;for(te=0;te<je.length;te++)K.writeMessage(4,Se,je[te])}function qt(V,K){var te=V.feature;te.id!==void 0&&K.writeVarintField(1,te.id),K.writeMessage(2,Ar,V),K.writeVarintField(3,te.type),K.writeMessage(4,A,te)}function Ar(V,K){var te=V.feature,he=V.keys,Me=V.values,je=V.keycache,Qe=V.valuecache;for(var se in te.properties){var Le=je[se];Le===void 0&&(he.push(se),je[se]=Le=he.length-1),K.writeVarint(Le);var ft=te.properties[se],hr=typeof ft;hr!=="string"&&hr!=="boolean"&&hr!=="number"&&(ft=JSON.stringify(ft));var Ot=hr+":"+ft,kt=Qe[Ot];kt===void 0&&(Me.push(ft),Qe[Ot]=kt=Me.length-1),K.writeVarint(kt)}}function Wr(V,K){return(K<<3)+(7&V)}function on(V){return V<<1^V>>31}function A(V,K){for(var te=V.loadGeometry(),he=V.type,Me=0,je=0,Qe=te.length,se=0;se<Qe;se++){var Le=te[se],ft=1;he===1&&(ft=Le.length),K.writeVarint(Wr(1,ft));for(var hr=he===3?Le.length-1:Le.length,Ot=0;Ot<hr;Ot++){Ot===1&&he!==1&&K.writeVarint(Wr(2,hr-1));var kt=Le[Ot].x-Me,dr=Le[Ot].y-je;K.writeVarint(on(kt)),K.writeVarint(on(dr)),Me+=kt,je+=dr}he===3&&K.writeVarint(Wr(7,1))}}function Se(V,K){var te=typeof V;te==="string"?K.writeStringField(1,V):te==="boolean"?K.writeBooleanField(7,V):te==="number"&&(V%1!=0?K.writeDoubleField(3,V):V<0?K.writeSVarintField(6,V):K.writeVarintField(5,V))}function ke(V,K,te,he){St(V,te,he),St(K,2*te,2*he),St(K,2*te+1,2*he+1)}function St(V,K,te){var he=V[K];V[K]=V[te],V[te]=he}function vt(V,K,te,he){var Me=V-te,je=K-he;return Me*Me+je*je}ct.fromVectorTileJs=wt,ct.fromGeojsonVt=function(V,K){K=K||{};var te={};for(var he in V)te[he]=new sr(V[he].features,K),te[he].name=he,te[he].version=K.version,te[he].extent=K.extent;return wt({layers:te})},ct.GeoJSONWrapper=Ke;var Ft=function(V){return V[0]},Wt=function(V){return V[1]},Er=function(V,K,te,he,Me){K===void 0&&(K=Ft),te===void 0&&(te=Wt),he===void 0&&(he=64),Me===void 0&&(Me=Float64Array),this.nodeSize=he,this.points=V;for(var je=V.length<65536?Uint16Array:Uint32Array,Qe=this.ids=new je(V.length),se=this.coords=new Me(2*V.length),Le=0;Le<V.length;Le++)Qe[Le]=Le,se[2*Le]=K(V[Le]),se[2*Le+1]=te(V[Le]);(function ft(hr,Ot,kt,dr,En,fn){if(!(En-dr<=kt)){var Mt=dr+En>>1;(function tn(Ur,Xr,vi,rn,nn,ji){for(;nn>rn;){if(nn-rn>600){var fi=nn-rn+1,Ai=vi-rn+1,_i=Math.log(fi),st=.5*Math.exp(2*_i/3),Ct=.5*Math.sqrt(_i*st*(fi-st)/fi)*(Ai-fi/2<0?-1:1);tn(Ur,Xr,vi,Math.max(rn,Math.floor(vi-Ai*st/fi+Ct)),Math.min(nn,Math.floor(vi+(fi-Ai)*st/fi+Ct)),ji)}var Ca=Xr[2*vi+ji],Ci=rn,wi=nn;for(ke(Ur,Xr,rn,vi),Xr[2*nn+ji]>Ca&&ke(Ur,Xr,rn,nn);Ci<wi;){for(ke(Ur,Xr,Ci,wi),Ci++,wi--;Xr[2*Ci+ji]<Ca;)Ci++;for(;Xr[2*wi+ji]>Ca;)wi--}Xr[2*rn+ji]===Ca?ke(Ur,Xr,rn,wi):ke(Ur,Xr,++wi,nn),wi<=vi&&(rn=wi+1),vi<=wi&&(nn=wi-1)}})(hr,Ot,Mt,dr,En,fn%2),ft(hr,Ot,kt,dr,Mt-1,fn+1),ft(hr,Ot,kt,Mt+1,En,fn+1)}})(Qe,se,he,0,Qe.length-1,0)};Er.prototype.range=function(V,K,te,he){return function(Me,je,Qe,se,Le,ft,hr){for(var Ot,kt,dr=[0,Me.length-1,0],En=[];dr.length;){var fn=dr.pop(),Mt=dr.pop(),tn=dr.pop();if(Mt-tn<=hr)for(var Ur=tn;Ur<=Mt;Ur++)kt=je[2*Ur+1],(Ot=je[2*Ur])>=Qe&&Ot<=Le&&kt>=se&&kt<=ft&&En.push(Me[Ur]);else{var Xr=Math.floor((tn+Mt)/2);kt=je[2*Xr+1],(Ot=je[2*Xr])>=Qe&&Ot<=Le&&kt>=se&&kt<=ft&&En.push(Me[Xr]);var vi=(fn+1)%2;(fn===0?Qe<=Ot:se<=kt)&&(dr.push(tn),dr.push(Xr-1),dr.push(vi)),(fn===0?Le>=Ot:ft>=kt)&&(dr.push(Xr+1),dr.push(Mt),dr.push(vi))}}return En}(this.ids,this.coords,V,K,te,he,this.nodeSize)},Er.prototype.within=function(V,K,te){return function(he,Me,je,Qe,se,Le){for(var ft=[0,he.length-1,0],hr=[],Ot=se*se;ft.length;){var kt=ft.pop(),dr=ft.pop(),En=ft.pop();if(dr-En<=Le)for(var fn=En;fn<=dr;fn++)vt(Me[2*fn],Me[2*fn+1],je,Qe)<=Ot&&hr.push(he[fn]);else{var Mt=Math.floor((En+dr)/2),tn=Me[2*Mt],Ur=Me[2*Mt+1];vt(tn,Ur,je,Qe)<=Ot&&hr.push(he[Mt]);var Xr=(kt+1)%2;(kt===0?je-se<=tn:Qe-se<=Ur)&&(ft.push(En),ft.push(Mt-1),ft.push(Xr)),(kt===0?je+se>=tn:Qe+se>=Ur)&&(ft.push(Mt+1),ft.push(dr),ft.push(Xr))}}return hr}(this.ids,this.coords,V,K,te,this.nodeSize)};var $n={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(V){return V}},_n=function(V){this.options=va(Object.create($n),V),this.trees=new Array(this.options.maxZoom+1)};function mi(V,K,te,he,Me){return{x:V,y:K,zoom:1/0,id:te,parentId:-1,numPoints:he,properties:Me}}function Gn(V,K){var te=V.geometry.coordinates,he=te[1];return{x:Xn(te[0]),y:yi(he),zoom:1/0,index:K,parentId:-1}}function ai(V){return{type:"Feature",id:V.id,properties:gi(V),geometry:{type:"Point",coordinates:[(he=V.x,360*(he-.5)),(K=V.y,te=(180-360*K)*Math.PI/180,360*Math.atan(Math.exp(te))/Math.PI-90)]}};var K,te,he}function gi(V){var K=V.numPoints,te=K>=1e4?Math.round(K/1e3)+"k":K>=1e3?Math.round(K/100)/10+"k":K;return va(va({},V.properties),{cluster:!0,cluster_id:V.id,point_count:K,point_count_abbreviated:te})}function Xn(V){return V/360+.5}function yi(V){var K=Math.sin(V*Math.PI/180),te=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return te<0?0:te>1?1:te}function va(V,K){for(var te in K)V[te]=K[te];return V}function Xi(V){return V.x}function Ri(V){return V.y}function Ji(V,K,te,he,Me,je){var Qe=Me-te,se=je-he;if(Qe!==0||se!==0){var Le=((V-te)*Qe+(K-he)*se)/(Qe*Qe+se*se);Le>1?(te=Me,he=je):Le>0&&(te+=Qe*Le,he+=se*Le)}return(Qe=V-te)*Qe+(se=K-he)*se}function ma(V,K,te,he){var Me={id:V===void 0?null:V,type:K,geometry:te,tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(je){var Qe=je.geometry,se=je.type;if(se==="Point"||se==="MultiPoint"||se==="LineString")Do(je,Qe);else if(se==="Polygon"||se==="MultiLineString")for(var Le=0;Le<Qe.length;Le++)Do(je,Qe[Le]);else if(se==="MultiPolygon")for(Le=0;Le<Qe.length;Le++)for(var ft=0;ft<Qe[Le].length;ft++)Do(je,Qe[Le][ft])}(Me),Me}function Do(V,K){for(var te=0;te<K.length;te+=3)V.minX=Math.min(V.minX,K[te]),V.minY=Math.min(V.minY,K[te+1]),V.maxX=Math.max(V.maxX,K[te]),V.maxY=Math.max(V.maxY,K[te+1])}function Oa(V,K,te,he){if(K.geometry){var Me=K.geometry.coordinates,je=K.geometry.type,Qe=Math.pow(te.tolerance/((1<<te.maxZoom)*te.extent),2),se=[],Le=K.id;if(te.promoteId?Le=K.properties[te.promoteId]:te.generateId&&(Le=he||0),je==="Point")xa(Me,se);else if(je==="MultiPoint")for(var ft=0;ft<Me.length;ft++)xa(Me[ft],se);else if(je==="LineString")Ui(Me,se,Qe,!1);else if(je==="MultiLineString"){if(te.lineMetrics){for(ft=0;ft<Me.length;ft++)Ui(Me[ft],se=[],Qe,!1),V.push(ma(Le,"LineString",se,K.properties));return}aa(Me,se,Qe,!1)}else if(je==="Polygon")aa(Me,se,Qe,!0);else{if(je!=="MultiPolygon"){if(je==="GeometryCollection"){for(ft=0;ft<K.geometry.geometries.length;ft++)Oa(V,{id:Le,geometry:K.geometry.geometries[ft],properties:K.properties},te,he);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ft=0;ft<Me.length;ft++){var hr=[];aa(Me[ft],hr,Qe,!0),se.push(hr)}}V.push(ma(Le,je,se,K.properties))}}function xa(V,K){K.push(ea(V[0])),K.push(Os(V[1])),K.push(0)}function Ui(V,K,te,he){for(var Me,je,Qe=0,se=0;se<V.length;se++){var Le=ea(V[se][0]),ft=Os(V[se][1]);K.push(Le),K.push(ft),K.push(0),se>0&&(Qe+=he?(Me*ft-Le*je)/2:Math.sqrt(Math.pow(Le-Me,2)+Math.pow(ft-je,2))),Me=Le,je=ft}var hr=K.length-3;K[2]=1,function Ot(kt,dr,En,fn){for(var Mt,tn=fn,Ur=En-dr>>1,Xr=En-dr,vi=kt[dr],rn=kt[dr+1],nn=kt[En],ji=kt[En+1],fi=dr+3;fi<En;fi+=3){var Ai=Ji(kt[fi],kt[fi+1],vi,rn,nn,ji);if(Ai>tn)Mt=fi,tn=Ai;else if(Ai===tn){var _i=Math.abs(fi-Ur);_i<Xr&&(Mt=fi,Xr=_i)}}tn>fn&&(Mt-dr>3&&Ot(kt,dr,Mt,fn),kt[Mt+2]=tn,En-Mt>3&&Ot(kt,Mt,En,fn))}(K,0,hr,te),K[hr+2]=1,K.size=Math.abs(Qe),K.start=0,K.end=K.size}function aa(V,K,te,he){for(var Me=0;Me<V.length;Me++){var je=[];Ui(V[Me],je,te,he),K.push(je)}}function ea(V){return V/360+.5}function Os(V){var K=Math.sin(V*Math.PI/180),te=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return te<0?0:te>1?1:te}function fe(V,K,te,he,Me,je,Qe,se){if(he/=K,je>=(te/=K)&&Qe<he)return V;if(Qe<te||je>=he)return null;for(var Le=[],ft=0;ft<V.length;ft++){var hr=V[ft],Ot=hr.geometry,kt=hr.type,dr=Me===0?hr.minX:hr.minY,En=Me===0?hr.maxX:hr.maxY;if(dr>=te&&En<he)Le.push(hr);else if(!(En<te||dr>=he)){var fn=[];if(kt==="Point"||kt==="MultiPoint")oi(Ot,fn,te,he,Me);else if(kt==="LineString")xo(Ot,fn,te,he,Me,!1,se.lineMetrics);else if(kt==="MultiLineString")Nt(Ot,fn,te,he,Me,!1);else if(kt==="Polygon")Nt(Ot,fn,te,he,Me,!0);else if(kt==="MultiPolygon")for(var Mt=0;Mt<Ot.length;Mt++){var tn=[];Nt(Ot[Mt],tn,te,he,Me,!0),tn.length&&fn.push(tn)}if(fn.length){if(se.lineMetrics&&kt==="LineString"){for(Mt=0;Mt<fn.length;Mt++)Le.push(ma(hr.id,kt,fn[Mt],hr.tags));continue}kt!=="LineString"&&kt!=="MultiLineString"||(fn.length===1?(kt="LineString",fn=fn[0]):kt="MultiLineString"),kt!=="Point"&&kt!=="MultiPoint"||(kt=fn.length===3?"Point":"MultiPoint"),Le.push(ma(hr.id,kt,fn,hr.tags))}}}return Le.length?Le:null}function oi(V,K,te,he,Me){for(var je=0;je<V.length;je+=3){var Qe=V[je+Me];Qe>=te&&Qe<=he&&(K.push(V[je]),K.push(V[je+1]),K.push(V[je+2]))}}function xo(V,K,te,he,Me,je,Qe){for(var se,Le,ft=au(V),hr=Me===0?Dr:cn,Ot=V.start,kt=0;kt<V.length-3;kt+=3){var dr=V[kt],En=V[kt+1],fn=V[kt+2],Mt=V[kt+3],tn=V[kt+4],Ur=Me===0?dr:En,Xr=Me===0?Mt:tn,vi=!1;Qe&&(se=Math.sqrt(Math.pow(dr-Mt,2)+Math.pow(En-tn,2))),Ur<te?Xr>te&&(Le=hr(ft,dr,En,Mt,tn,te),Qe&&(ft.start=Ot+se*Le)):Ur>he?Xr<he&&(Le=hr(ft,dr,En,Mt,tn,he),Qe&&(ft.start=Ot+se*Le)):Jt(ft,dr,En,fn),Xr<te&&Ur>=te&&(Le=hr(ft,dr,En,Mt,tn,te),vi=!0),Xr>he&&Ur<=he&&(Le=hr(ft,dr,En,Mt,tn,he),vi=!0),!je&&vi&&(Qe&&(ft.end=Ot+se*Le),K.push(ft),ft=au(V)),Qe&&(Ot+=se)}var rn=V.length-3;dr=V[rn],En=V[rn+1],fn=V[rn+2],(Ur=Me===0?dr:En)>=te&&Ur<=he&&Jt(ft,dr,En,fn),rn=ft.length-3,je&&rn>=3&&(ft[rn]!==ft[0]||ft[rn+1]!==ft[1])&&Jt(ft,ft[0],ft[1],ft[2]),ft.length&&K.push(ft)}function au(V){var K=[];return K.size=V.size,K.start=V.start,K.end=V.end,K}function Nt(V,K,te,he,Me,je){for(var Qe=0;Qe<V.length;Qe++)xo(V[Qe],K,te,he,Me,je,!1)}function Jt(V,K,te,he){V.push(K),V.push(te),V.push(he)}function Dr(V,K,te,he,Me,je){var Qe=(je-K)/(he-K);return V.push(je),V.push(te+(Me-te)*Qe),V.push(1),Qe}function cn(V,K,te,he,Me,je){var Qe=(je-te)/(Me-te);return V.push(K+(he-K)*Qe),V.push(je),V.push(1),Qe}function wn(V,K){for(var te=[],he=0;he<V.length;he++){var Me,je=V[he],Qe=je.type;if(Qe==="Point"||Qe==="MultiPoint"||Qe==="LineString")Me=Nn(je.geometry,K);else if(Qe==="MultiLineString"||Qe==="Polygon"){Me=[];for(var se=0;se<je.geometry.length;se++)Me.push(Nn(je.geometry[se],K))}else if(Qe==="MultiPolygon")for(Me=[],se=0;se<je.geometry.length;se++){for(var Le=[],ft=0;ft<je.geometry[se].length;ft++)Le.push(Nn(je.geometry[se][ft],K));Me.push(Le)}te.push(ma(je.id,Qe,Me,je.tags))}return te}function Nn(V,K){var te=[];te.size=V.size,V.start!==void 0&&(te.start=V.start,te.end=V.end);for(var he=0;he<V.length;he+=3)te.push(V[he]+K,V[he+1],V[he+2]);return te}function Ei(V,K){if(V.transformed)return V;var te,he,Me,je=1<<V.z,Qe=V.x,se=V.y;for(te=0;te<V.features.length;te++){var Le=V.features[te],ft=Le.geometry,hr=Le.type;if(Le.geometry=[],hr===1)for(he=0;he<ft.length;he+=2)Le.geometry.push(di(ft[he],ft[he+1],K,je,Qe,se));else for(he=0;he<ft.length;he++){var Ot=[];for(Me=0;Me<ft[he].length;Me+=2)Ot.push(di(ft[he][Me],ft[he][Me+1],K,je,Qe,se));Le.geometry.push(Ot)}}return V.transformed=!0,V}function di(V,K,te,he,Me,je){return[Math.round(te*(V*he-Me)),Math.round(te*(K*he-je))]}function Sn(V,K,te,he,Me){for(var je=K===Me.maxZoom?0:Me.tolerance/((1<<K)*Me.extent),Qe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:te,y:he,z:K,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},se=0;se<V.length;se++){Qe.numFeatures++,Pi(Qe,V[se],je,Me);var Le=V[se].minX,ft=V[se].minY,hr=V[se].maxX,Ot=V[se].maxY;Le<Qe.minX&&(Qe.minX=Le),ft<Qe.minY&&(Qe.minY=ft),hr>Qe.maxX&&(Qe.maxX=hr),Ot>Qe.maxY&&(Qe.maxY=Ot)}return Qe}function Pi(V,K,te,he){var Me=K.geometry,je=K.type,Qe=[];if(je==="Point"||je==="MultiPoint")for(var se=0;se<Me.length;se+=3)Qe.push(Me[se]),Qe.push(Me[se+1]),V.numPoints++,V.numSimplified++;else if(je==="LineString")Mi(Qe,Me,V,te,!1,!1);else if(je==="MultiLineString"||je==="Polygon")for(se=0;se<Me.length;se++)Mi(Qe,Me[se],V,te,je==="Polygon",se===0);else if(je==="MultiPolygon")for(var Le=0;Le<Me.length;Le++){var ft=Me[Le];for(se=0;se<ft.length;se++)Mi(Qe,ft[se],V,te,!0,se===0)}if(Qe.length){var hr=K.tags||null;if(je==="LineString"&&he.lineMetrics){for(var Ot in hr={},K.tags)hr[Ot]=K.tags[Ot];hr.mapbox_clip_start=Me.start/Me.size,hr.mapbox_clip_end=Me.end/Me.size}var kt={geometry:Qe,type:je==="Polygon"||je==="MultiPolygon"?3:je==="LineString"||je==="MultiLineString"?2:1,tags:hr};K.id!==null&&(kt.id=K.id),V.features.push(kt)}}function Mi(V,K,te,he,Me,je){var Qe=he*he;if(he>0&&K.size<(Me?Qe:he))te.numPoints+=K.length/3;else{for(var se=[],Le=0;Le<K.length;Le+=3)(he===0||K[Le+2]>Qe)&&(te.numSimplified++,se.push(K[Le]),se.push(K[Le+1])),te.numPoints++;Me&&function(ft,hr){for(var Ot=0,kt=0,dr=ft.length,En=dr-2;kt<dr;En=kt,kt+=2)Ot+=(ft[kt]-ft[En])*(ft[kt+1]+ft[En+1]);if(Ot>0===hr)for(kt=0,dr=ft.length;kt<dr/2;kt+=2){var fn=ft[kt],Mt=ft[kt+1];ft[kt]=ft[dr-2-kt],ft[kt+1]=ft[dr-1-kt],ft[dr-2-kt]=fn,ft[dr-1-kt]=Mt}}(se,je),V.push(se)}}function to(V,K){var te=(K=this.options=function(Me,je){for(var Qe in je)Me[Qe]=je[Qe];return Me}(Object.create(this.options),K)).debug;if(te&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");var he=function(Me,je){var Qe=[];if(Me.type==="FeatureCollection")for(var se=0;se<Me.features.length;se++)Oa(Qe,Me.features[se],je,se);else Oa(Qe,Me.type==="Feature"?Me:{geometry:Me},je);return Qe}(V,K);this.tiles={},this.tileCoords=[],te&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(he=function(Me,je){var Qe=je.buffer/je.extent,se=Me,Le=fe(Me,1,-1-Qe,Qe,0,-1,2,je),ft=fe(Me,1,1-Qe,2+Qe,0,-1,2,je);return(Le||ft)&&(se=fe(Me,1,-Qe,1+Qe,0,-1,2,je)||[],Le&&(se=wn(Le,1).concat(se)),ft&&(se=se.concat(wn(ft,-1)))),se}(he,K)).length&&this.splitTile(he,0,0,0),te&&(he.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function gs(V,K,te){return 32*((1<<V)*te+K)+V}function Ho(V,K){var te=V.tileID.canonical;if(!this._geoJSONIndex)return K(null,null);var he=this._geoJSONIndex.getTile(te.z,te.x,te.y);if(!he)return K(null,null);var Me=new ht(he.features),je=ct(Me);je.byteOffset===0&&je.byteLength===je.buffer.byteLength||(je=new Uint8Array(je)),K(null,{vectorTile:Me,rawData:je.buffer})}_n.prototype.load=function(V){var K=this.options,te=K.log,he=K.minZoom,Me=K.maxZoom,je=K.nodeSize;te&&console.time("total time");var Qe="prepare "+V.length+" points";te&&console.time(Qe),this.points=V;for(var se=[],Le=0;Le<V.length;Le++)V[Le].geometry&&se.push(Gn(V[Le],Le));this.trees[Me+1]=new Er(se,Xi,Ri,je,Float32Array),te&&console.timeEnd(Qe);for(var ft=Me;ft>=he;ft--){var hr=+Date.now();se=this._cluster(se,ft),this.trees[ft]=new Er(se,Xi,Ri,je,Float32Array),te&&console.log("z%d: %d clusters in %dms",ft,se.length,+Date.now()-hr)}return te&&console.timeEnd("total time"),this},_n.prototype.getClusters=function(V,K){var te=((V[0]+180)%360+360)%360-180,he=Math.max(-90,Math.min(90,V[1])),Me=V[2]===180?180:((V[2]+180)%360+360)%360-180,je=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)te=-180,Me=180;else if(te>Me){var Qe=this.getClusters([te,he,180,je],K),se=this.getClusters([-180,he,Me,je],K);return Qe.concat(se)}for(var Le=this.trees[this._limitZoom(K)],ft=[],hr=0,Ot=Le.range(Xn(te),yi(je),Xn(Me),yi(he));hr<Ot.length;hr+=1){var kt=Le.points[Ot[hr]];ft.push(kt.numPoints?ai(kt):this.points[kt.index])}return ft},_n.prototype.getChildren=function(V){var K=this._getOriginId(V),te=this._getOriginZoom(V),he="No cluster with the specified id.",Me=this.trees[te];if(!Me)throw new Error(he);var je=Me.points[K];if(!je)throw new Error(he);for(var Qe=this.options.radius/(this.options.extent*Math.pow(2,te-1)),se=[],Le=0,ft=Me.within(je.x,je.y,Qe);Le<ft.length;Le+=1){var hr=Me.points[ft[Le]];hr.parentId===V&&se.push(hr.numPoints?ai(hr):this.points[hr.index])}if(se.length===0)throw new Error(he);return se},_n.prototype.getLeaves=function(V,K,te){var he=[];return this._appendLeaves(he,V,K=K||10,te=te||0,0),he},_n.prototype.getTile=function(V,K,te){var he=this.trees[this._limitZoom(V)],Me=Math.pow(2,V),je=this.options,Qe=je.radius/je.extent,se=(te-Qe)/Me,Le=(te+1+Qe)/Me,ft={features:[]};return this._addTileFeatures(he.range((K-Qe)/Me,se,(K+1+Qe)/Me,Le),he.points,K,te,Me,ft),K===0&&this._addTileFeatures(he.range(1-Qe/Me,se,1,Le),he.points,Me,te,Me,ft),K===Me-1&&this._addTileFeatures(he.range(0,se,Qe/Me,Le),he.points,-1,te,Me,ft),ft.features.length?ft:null},_n.prototype.getClusterExpansionZoom=function(V){for(var K=this._getOriginZoom(V)-1;K<=this.options.maxZoom;){var te=this.getChildren(V);if(K++,te.length!==1)break;V=te[0].properties.cluster_id}return K},_n.prototype._appendLeaves=function(V,K,te,he,Me){for(var je=0,Qe=this.getChildren(K);je<Qe.length;je+=1){var se=Qe[je],Le=se.properties;if(Le&&Le.cluster?Me+Le.point_count<=he?Me+=Le.point_count:Me=this._appendLeaves(V,Le.cluster_id,te,he,Me):Me<he?Me++:V.push(se),V.length===te)break}return Me},_n.prototype._addTileFeatures=function(V,K,te,he,Me,je){for(var Qe=0,se=V;Qe<se.length;Qe+=1){var Le=K[se[Qe]],ft=Le.numPoints,hr={type:1,geometry:[[Math.round(this.options.extent*(Le.x*Me-te)),Math.round(this.options.extent*(Le.y*Me-he))]],tags:ft?gi(Le):this.points[Le.index].properties},Ot=void 0;ft?Ot=Le.id:this.options.generateId?Ot=Le.index:this.points[Le.index].id&&(Ot=this.points[Le.index].id),Ot!==void 0&&(hr.id=Ot),je.features.push(hr)}},_n.prototype._limitZoom=function(V){return Math.max(this.options.minZoom,Math.min(+V,this.options.maxZoom+1))},_n.prototype._cluster=function(V,K){for(var te=[],he=this.options,Me=he.reduce,je=he.minPoints,Qe=he.radius/(he.extent*Math.pow(2,K)),se=0;se<V.length;se++){var Le=V[se];if(!(Le.zoom<=K)){Le.zoom=K;for(var ft=this.trees[K+1],hr=ft.within(Le.x,Le.y,Qe),Ot=Le.numPoints||1,kt=Ot,dr=0,En=hr;dr<En.length;dr+=1){var fn=ft.points[En[dr]];fn.zoom>K&&(kt+=fn.numPoints||1)}if(kt>=je){for(var Mt=Le.x*Ot,tn=Le.y*Ot,Ur=Me&&Ot>1?this._map(Le,!0):null,Xr=(se<<5)+(K+1)+this.points.length,vi=0,rn=hr;vi<rn.length;vi+=1){var nn=ft.points[rn[vi]];if(!(nn.zoom<=K)){nn.zoom=K;var ji=nn.numPoints||1;Mt+=nn.x*ji,tn+=nn.y*ji,nn.parentId=Xr,Me&&(Ur||(Ur=this._map(Le,!0)),Me(Ur,this._map(nn)))}}Le.parentId=Xr,te.push(mi(Mt/kt,tn/kt,Xr,kt,Ur))}else if(te.push(Le),kt>1)for(var fi=0,Ai=hr;fi<Ai.length;fi+=1){var _i=ft.points[Ai[fi]];_i.zoom<=K||(_i.zoom=K,te.push(_i))}}}return te},_n.prototype._getOriginId=function(V){return V-this.points.length>>5},_n.prototype._getOriginZoom=function(V){return(V-this.points.length)%32},_n.prototype._map=function(V,K){if(V.numPoints)return K?va({},V.properties):V.properties;var te=this.points[V.index].properties,he=this.options.map(te);return K&&he===te?va({},he):he},to.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},to.prototype.splitTile=function(V,K,te,he,Me,je,Qe){for(var se=[V,K,te,he],Le=this.options,ft=Le.debug;se.length;){he=se.pop(),te=se.pop(),K=se.pop(),V=se.pop();var hr=1<<K,Ot=gs(K,te,he),kt=this.tiles[Ot];if(!kt&&(ft>1&&console.time("creation"),kt=this.tiles[Ot]=Sn(V,K,te,he,Le),this.tileCoords.push({z:K,x:te,y:he}),ft)){ft>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,te,he,kt.numFeatures,kt.numPoints,kt.numSimplified),console.timeEnd("creation"));var dr="z"+K;this.stats[dr]=(this.stats[dr]||0)+1,this.total++}if(kt.source=V,Me){if(K===Le.maxZoom||K===Me)continue;var En=1<<Me-K;if(te!==Math.floor(je/En)||he!==Math.floor(Qe/En))continue}else if(K===Le.indexMaxZoom||kt.numPoints<=Le.indexMaxPoints)continue;if(kt.source=null,V.length!==0){ft>1&&console.time("clipping");var fn,Mt,tn,Ur,Xr,vi,rn=.5*Le.buffer/Le.extent,nn=.5-rn,ji=.5+rn,fi=1+rn;fn=Mt=tn=Ur=null,Xr=fe(V,hr,te-rn,te+ji,0,kt.minX,kt.maxX,Le),vi=fe(V,hr,te+nn,te+fi,0,kt.minX,kt.maxX,Le),V=null,Xr&&(fn=fe(Xr,hr,he-rn,he+ji,1,kt.minY,kt.maxY,Le),Mt=fe(Xr,hr,he+nn,he+fi,1,kt.minY,kt.maxY,Le),Xr=null),vi&&(tn=fe(vi,hr,he-rn,he+ji,1,kt.minY,kt.maxY,Le),Ur=fe(vi,hr,he+nn,he+fi,1,kt.minY,kt.maxY,Le),vi=null),ft>1&&console.timeEnd("clipping"),se.push(fn||[],K+1,2*te,2*he),se.push(Mt||[],K+1,2*te,2*he+1),se.push(tn||[],K+1,2*te+1,2*he),se.push(Ur||[],K+1,2*te+1,2*he+1)}}},to.prototype.getTile=function(V,K,te){var he=this.options,Me=he.extent,je=he.debug;if(V<0||V>24)return null;var Qe=1<<V,se=gs(V,K=(K%Qe+Qe)%Qe,te);if(this.tiles[se])return Ei(this.tiles[se],Me);je>1&&console.log("drilling down to z%d-%d-%d",V,K,te);for(var Le,ft=V,hr=K,Ot=te;!Le&&ft>0;)ft--,hr=Math.floor(hr/2),Ot=Math.floor(Ot/2),Le=this.tiles[gs(ft,hr,Ot)];return Le&&Le.source?(je>1&&console.log("found parent tile z%d-%d-%d",ft,hr,Ot),je>1&&console.time("drilling down"),this.splitTile(Le.source,ft,hr,Ot,V,K,te),je>1&&console.timeEnd("drilling down"),this.tiles[se]?Ei(this.tiles[se],Me):null):null};var Na=function(V){function K(te,he,Me,je){V.call(this,te,he,Me,Ho),je&&(this.loadGeoJSON=je)}return V&&(K.__proto__=V),(K.prototype=Object.create(V&&V.prototype)).constructor=K,K.prototype.loadData=function(te,he){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=he,this._pendingLoadDataParams=te,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},K.prototype._loadData=function(){var te=this;if(this._pendingCallback&&this._pendingLoadDataParams){var he=this._pendingCallback,Me=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var je=!!(Me&&Me.request&&Me.request.collectResourceTiming)&&new g.RequestPerformance(Me.request);this.loadGeoJSON(Me,function(Qe,se){if(Qe||!se)return he(Qe);if(typeof se!="object")return he(new Error("Input data given to '"+Me.source+"' is not a valid GeoJSON object."));(function kt(dr,En){var fn,Mt=dr&&dr.type;if(Mt==="FeatureCollection")for(fn=0;fn<dr.features.length;fn++)kt(dr.features[fn],En);else if(Mt==="GeometryCollection")for(fn=0;fn<dr.geometries.length;fn++)kt(dr.geometries[fn],En);else if(Mt==="Feature")kt(dr.geometry,En);else if(Mt==="Polygon")pr(dr.coordinates,En);else if(Mt==="MultiPolygon")for(fn=0;fn<dr.coordinates.length;fn++)pr(dr.coordinates[fn],En);return dr})(se,!0);try{if(Me.filter){var Le=g.createExpression(Me.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Le.result==="error")throw new Error(Le.value.map(function(kt){return kt.key+": "+kt.message}).join(", "));var ft=se.features.filter(function(kt){return Le.value.evaluate({zoom:0},kt)});se={type:"FeatureCollection",features:ft}}te._geoJSONIndex=Me.cluster?new _n(function(kt){var dr=kt.superclusterOptions,En=kt.clusterProperties;if(!En||!dr)return dr;for(var fn={},Mt={},tn={accumulated:null,zoom:0},Ur={properties:null},Xr=Object.keys(En),vi=0,rn=Xr;vi<rn.length;vi+=1){var nn=rn[vi],ji=En[nn],fi=ji[0],Ai=g.createExpression(ji[1]),_i=g.createExpression(typeof fi=="string"?[fi,["accumulated"],["get",nn]]:fi);fn[nn]=Ai.value,Mt[nn]=_i.value}return dr.map=function(st){Ur.properties=st;for(var Ct={},Ca=0,Ci=Xr;Ca<Ci.length;Ca+=1){var wi=Ci[Ca];Ct[wi]=fn[wi].evaluate(tn,Ur)}return Ct},dr.reduce=function(st,Ct){Ur.properties=Ct;for(var Ca=0,Ci=Xr;Ca<Ci.length;Ca+=1){var wi=Ci[Ca];tn.accumulated=st[wi],st[wi]=Mt[wi].evaluate(tn,Ur)}},dr}(Me)).load(se.features):function(kt,dr){return new to(kt,dr)}(se,Me.geojsonVtOptions)}catch(kt){return he(kt)}te.loaded={};var hr={};if(je){var Ot=je.finish();Ot&&(hr.resourceTiming={},hr.resourceTiming[Me.source]=JSON.parse(JSON.stringify(Ot)))}he(null,hr)})}},K.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},K.prototype.reloadTile=function(te,he){var Me=this.loaded;return Me&&Me[te.uid]?V.prototype.reloadTile.call(this,te,he):this.loadTile(te,he)},K.prototype.loadGeoJSON=function(te,he){if(te.request)g.getJSON(te.request,he);else{if(typeof te.data!="string")return he(new Error("Input data given to '"+te.source+"' is not a valid GeoJSON object."));try{return he(null,JSON.parse(te.data))}catch(Me){return he(new Error("Input data given to '"+te.source+"' is not a valid GeoJSON object."))}}},K.prototype.removeSource=function(te,he){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),he()},K.prototype.getClusterExpansionZoom=function(te,he){try{he(null,this._geoJSONIndex.getClusterExpansionZoom(te.clusterId))}catch(Me){he(Me)}},K.prototype.getClusterChildren=function(te,he){try{he(null,this._geoJSONIndex.getChildren(te.clusterId))}catch(Me){he(Me)}},K.prototype.getClusterLeaves=function(te,he){try{he(null,this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset))}catch(Me){he(Me)}},K}(dt),ba=function(V){var K=this;this.self=V,this.actor=new g.Actor(V,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:dt,geojson:Na},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(te,he){if(K.workerSourceTypes[te])throw new Error('Worker source with name "'+te+'" already registered.');K.workerSourceTypes[te]=he},this.self.registerRTLTextPlugin=function(te){if(g.plugin.isParsed())throw new Error("RTL text plugin already registered.");g.plugin.applyArabicShaping=te.applyArabicShaping,g.plugin.processBidirectionalText=te.processBidirectionalText,g.plugin.processStyledBidirectionalText=te.processStyledBidirectionalText}};return ba.prototype.setReferrer=function(V,K){this.referrer=K},ba.prototype.setImages=function(V,K,te){for(var he in this.availableImages[V]=K,this.workerSources[V]){var Me=this.workerSources[V][he];for(var je in Me)Me[je].availableImages=K}te()},ba.prototype.setLayers=function(V,K,te){this.getLayerIndex(V).replace(K),te()},ba.prototype.updateLayers=function(V,K,te){this.getLayerIndex(V).update(K.layers,K.removedIds),te()},ba.prototype.loadTile=function(V,K,te){this.getWorkerSource(V,K.type,K.source).loadTile(K,te)},ba.prototype.loadDEMTile=function(V,K,te){this.getDEMWorkerSource(V,K.source).loadTile(K,te)},ba.prototype.reloadTile=function(V,K,te){this.getWorkerSource(V,K.type,K.source).reloadTile(K,te)},ba.prototype.abortTile=function(V,K,te){this.getWorkerSource(V,K.type,K.source).abortTile(K,te)},ba.prototype.removeTile=function(V,K,te){this.getWorkerSource(V,K.type,K.source).removeTile(K,te)},ba.prototype.removeDEMTile=function(V,K){this.getDEMWorkerSource(V,K.source).removeTile(K)},ba.prototype.removeSource=function(V,K,te){if(this.workerSources[V]&&this.workerSources[V][K.type]&&this.workerSources[V][K.type][K.source]){var he=this.workerSources[V][K.type][K.source];delete this.workerSources[V][K.type][K.source],he.removeSource!==void 0?he.removeSource(K,te):te()}},ba.prototype.loadWorkerSource=function(V,K,te){try{this.self.importScripts(K.url),te()}catch(he){te(he.toString())}},ba.prototype.syncRTLPluginState=function(V,K,te){try{g.plugin.setState(K);var he=g.plugin.getPluginURL();if(g.plugin.isLoaded()&&!g.plugin.isParsed()&&he!=null){this.self.importScripts(he);var Me=g.plugin.isParsed();te(Me?void 0:new Error("RTL Text Plugin failed to import scripts from "+he),Me)}}catch(je){te(je.toString())}},ba.prototype.getAvailableImages=function(V){var K=this.availableImages[V];return K||(K=[]),K},ba.prototype.getLayerIndex=function(V){var K=this.layerIndexes[V];return K||(K=this.layerIndexes[V]=new pe),K},ba.prototype.getWorkerSource=function(V,K,te){var he=this;return this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][K]||(this.workerSources[V][K]={}),this.workerSources[V][K][te]||(this.workerSources[V][K][te]=new this.workerSourceTypes[K]({send:function(Me,je,Qe){he.actor.send(Me,je,Qe,V)}},this.getLayerIndex(V),this.getAvailableImages(V))),this.workerSources[V][K][te]},ba.prototype.getDEMWorkerSource=function(V,K){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][K]||(this.demWorkerSources[V][K]=new tr),this.demWorkerSources[V][K]},ba.prototype.enforceCacheSizeLimit=function(V,K){g.enforceCacheSizeLimit(K)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new ba(self)),ba}),_e(["./shared"],function(g){"use strict";var Re=g.createCommonjsModule(function(l){function p(E){return!c(E)}function c(E){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var P,L,z=new Blob([""],{type:"text/javascript"}),H=URL.createObjectURL(z);try{L=new Worker(H),P=!0}catch(oe){P=!1}return L&&L.terminate(),URL.revokeObjectURL(H),P}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var P=document.createElement("canvas");P.width=P.height=1;var L=P.getContext("2d");if(!L)return!1;var z=L.getImageData(0,0,1,1);return z&&z.width===P.width}()?(d[w=E&&E.failIfMajorPerformanceCaveat]===void 0&&(d[w]=function(P){var L=function(H){var oe=document.createElement("canvas"),ue=Object.create(p.webGLContextAttributes);return ue.failIfMajorPerformanceCaveat=H,oe.probablySupportsContext?oe.probablySupportsContext("webgl",ue)||oe.probablySupportsContext("experimental-webgl",ue):oe.supportsContext?oe.supportsContext("webgl",ue)||oe.supportsContext("experimental-webgl",ue):oe.getContext("webgl",ue)||oe.getContext("experimental-webgl",ue)}(P);if(!L)return!1;var z=L.createShader(L.VERTEX_SHADER);return!(!z||L.isContextLost())&&(L.shaderSource(z,"void main() {}"),L.compileShader(z),L.getShaderParameter(z,L.COMPILE_STATUS)===!0)}(w)),d[w]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var w}l.exports?l.exports=p:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=p,window.mapboxgl.notSupportedReason=c);var d={};p.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),X={create:function(l,p,c){var d=g.window.document.createElement(l);return p!==void 0&&(d.className=p),c&&c.appendChild(d),d},createNS:function(l,p){return g.window.document.createElementNS(l,p)}},pe=g.window.document&&g.window.document.documentElement.style;function de(l){if(!pe)return l[0];for(var p=0;p<l.length;p++)if(l[p]in pe)return l[p];return l[0]}var Ne,xe=de(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);X.disableDrag=function(){pe&&xe&&(Ne=pe[xe],pe[xe]="none")},X.enableDrag=function(){pe&&xe&&(pe[xe]=Ne)};var tt=de(["transform","WebkitTransform"]);X.setTransform=function(l,p){l.style[tt]=p};var dt=!1;try{var At=Object.defineProperty({},"passive",{get:function(){dt=!0}});g.window.addEventListener("test",At,At),g.window.removeEventListener("test",At,At)}catch(l){dt=!1}X.addEventListener=function(l,p,c,d){d===void 0&&(d={}),l.addEventListener(p,c,"passive"in d&&dt?d:d.capture)},X.removeEventListener=function(l,p,c,d){d===void 0&&(d={}),l.removeEventListener(p,c,"passive"in d&&dt?d:d.capture)};var tr=function(l){l.preventDefault(),l.stopPropagation(),g.window.removeEventListener("click",tr,!0)};function pr(l){var p=l.userImage;return!!(p&&p.render&&p.render())&&(l.data.replace(new Uint8Array(p.data.buffer)),!0)}X.suppressClick=function(){g.window.addEventListener("click",tr,!0),g.window.setTimeout(function(){g.window.removeEventListener("click",tr,!0)},0)},X.mousePos=function(l,p){var c=l.getBoundingClientRect();return new g.Point(p.clientX-c.left-l.clientLeft,p.clientY-c.top-l.clientTop)},X.touchPos=function(l,p){for(var c=l.getBoundingClientRect(),d=[],E=0;E<p.length;E++)d.push(new g.Point(p[E].clientX-c.left-l.clientLeft,p[E].clientY-c.top-l.clientTop));return d},X.mouseButton=function(l){return g.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&g.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},X.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var Lt=function(l){function p(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new g.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.isLoaded=function(){return this.loaded},p.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var d=0,E=this.requestors;d<E.length;d+=1){var w=E[d];this._notify(w.ids,w.callback)}this.requestors=[]}},p.prototype.getImage=function(c){return this.images[c]},p.prototype.addImage=function(c,d){this._validate(c,d)&&(this.images[c]=d)},p.prototype._validate=function(c,d){var E=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new g.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),E=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new g.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),E=!1),this._validateContent(d.content,d)||(this.fire(new g.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),E=!1),E},p.prototype._validateStretch=function(c,d){if(!c)return!0;for(var E=0,w=0,P=c;w<P.length;w+=1){var L=P[w];if(L[0]<E||L[1]<L[0]||d<L[1])return!1;E=L[1]}return!0},p.prototype._validateContent=function(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},p.prototype.updateImage=function(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0},p.prototype.removeImage=function(c){var d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()},p.prototype.listImages=function(){return Object.keys(this.images)},p.prototype.getImages=function(c,d){var E=!0;if(!this.isLoaded())for(var w=0,P=c;w<P.length;w+=1)this.images[P[w]]||(E=!1);this.isLoaded()||E?this._notify(c,d):this.requestors.push({ids:c,callback:d})},p.prototype._notify=function(c,d){for(var E={},w=0,P=c;w<P.length;w+=1){var L=P[w];this.images[L]||this.fire(new g.Event("styleimagemissing",{id:L}));var z=this.images[L];z?E[L]={data:z.data.clone(),pixelRatio:z.pixelRatio,sdf:z.sdf,version:z.version,stretchX:z.stretchX,stretchY:z.stretchY,content:z.content,hasRenderCallback:Boolean(z.userImage&&z.userImage.render)}:g.warnOnce('Image "'+L+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}d(null,E)},p.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},p.prototype.getPattern=function(c){var d=this.patterns[c],E=this.getImage(c);if(!E)return null;if(d&&d.position.version===E.version)return d.position;if(d)d.position.version=E.version;else{var w={w:E.data.width+2,h:E.data.height+2,x:0,y:0},P=new g.ImagePosition(w,E);this.patterns[c]={bin:w,position:P}}return this._updatePatternAtlas(),this.patterns[c].position},p.prototype.bind=function(c){var d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new g.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)},p.prototype._updatePatternAtlas=function(){var c=[];for(var d in this.patterns)c.push(this.patterns[d].bin);var E=g.potpack(c),w=E.w,P=E.h,L=this.atlasImage;for(var z in L.resize({width:w||1,height:P||1}),this.patterns){var H=this.patterns[z].bin,oe=H.x+1,ue=H.y+1,le=this.images[z].data,Pe=le.width,we=le.height;g.RGBAImage.copy(le,L,{x:0,y:0},{x:oe,y:ue},{width:Pe,height:we}),g.RGBAImage.copy(le,L,{x:0,y:we-1},{x:oe,y:ue-1},{width:Pe,height:1}),g.RGBAImage.copy(le,L,{x:0,y:0},{x:oe,y:ue+we},{width:Pe,height:1}),g.RGBAImage.copy(le,L,{x:Pe-1,y:0},{x:oe-1,y:ue},{width:1,height:we}),g.RGBAImage.copy(le,L,{x:0,y:0},{x:oe+Pe,y:ue},{width:1,height:we})}this.dirty=!0},p.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},p.prototype.dispatchRenderCallbacks=function(c){for(var d=0,E=c;d<E.length;d+=1){var w=E[d];if(!this.callbackDispatchedThisFrame[w]){this.callbackDispatchedThisFrame[w]=!0;var P=this.images[w];pr(P)&&this.updateImage(w,P)}}},p}(g.Evented),nr=gt,jt=gt,ht=1e20;function gt(l,p,c,d,E,w){this.fontSize=l||24,this.buffer=p===void 0?3:p,this.cutoff=d||.25,this.fontFamily=E||"sans-serif",this.fontWeight=w||"normal",this.radius=c||8;var P=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=P,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.d=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Int16Array(P),this.middle=Math.round(P/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function sr(l,p,c,d,E,w,P){for(var L=0;L<p;L++){for(var z=0;z<c;z++)d[z]=l[z*p+L];for(q(d,E,w,P,c),z=0;z<c;z++)l[z*p+L]=E[z]}for(z=0;z<c;z++){for(L=0;L<p;L++)d[L]=l[z*p+L];for(q(d,E,w,P,p),L=0;L<p;L++)l[z*p+L]=Math.sqrt(E[L])}}function q(l,p,c,d,E){c[0]=0,d[0]=-ht,d[1]=+ht;for(var w=1,P=0;w<E;w++){for(var L=(l[w]+w*w-(l[c[P]]+c[P]*c[P]))/(2*w-2*c[P]);L<=d[P];)P--,L=(l[w]+w*w-(l[c[P]]+c[P]*c[P]))/(2*w-2*c[P]);c[++P]=w,d[P]=L,d[P+1]=+ht}for(w=0,P=0;w<E;w++){for(;d[P+1]<w;)P++;p[w]=(w-c[P])*(w-c[P])+l[c[P]]}}gt.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var p=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),d=0;d<this.size*this.size;d++){var E=p.data[4*d+3]/255;this.gridOuter[d]=E===1?0:E===0?ht:Math.pow(Math.max(0,.5-E),2),this.gridInner[d]=E===1?ht:E===0?0:Math.pow(Math.max(0,E-.5),2)}for(sr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),sr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),d=0;d<this.size*this.size;d++)c[d]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[d]-this.gridInner[d])/this.radius+this.cutoff))));return c},nr.default=jt;var Yt=function(l,p){this.requestManager=l,this.localIdeographFontFamily=p,this.entries={}};Yt.prototype.setURL=function(l){this.url=l},Yt.prototype.getGlyphs=function(l,p){var c=this,d=[];for(var E in l)for(var w=0,P=l[E];w<P.length;w+=1)d.push({stack:E,id:P[w]});g.asyncAll(d,function(L,z){var H=L.stack,oe=L.id,ue=c.entries[H];ue||(ue=c.entries[H]={glyphs:{},requests:{},ranges:{}});var le=ue.glyphs[oe];if(le===void 0){if(le=c._tinySDF(ue,H,oe))return ue.glyphs[oe]=le,void z(null,{stack:H,id:oe,glyph:le});var Pe=Math.floor(oe/256);if(256*Pe>65535)z(new Error("glyphs > 65535 not supported"));else if(ue.ranges[Pe])z(null,{stack:H,id:oe,glyph:le});else{var we=ue.requests[Pe];we||(we=ue.requests[Pe]=[],Yt.loadGlyphRange(H,Pe,c.url,c.requestManager,function(Ge,Ce){if(Ce){for(var Ve in Ce)c._doesCharSupportLocalGlyph(+Ve)||(ue.glyphs[+Ve]=Ce[+Ve]);ue.ranges[Pe]=!0}for(var $e=0,yt=we;$e<yt.length;$e+=1)(0,yt[$e])(Ge,Ce);delete ue.requests[Pe]})),we.push(function(Ge,Ce){Ge?z(Ge):Ce&&z(null,{stack:H,id:oe,glyph:Ce[oe]||null})})}}else z(null,{stack:H,id:oe,glyph:le})},function(L,z){if(L)p(L);else if(z){for(var H={},oe=0,ue=z;oe<ue.length;oe+=1){var le=ue[oe],Pe=le.stack,we=le.id,Ge=le.glyph;(H[Pe]||(H[Pe]={}))[we]=Ge&&{id:Ge.id,bitmap:Ge.bitmap.clone(),metrics:Ge.metrics}}p(null,H)}})},Yt.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(g.isChar["CJK Unified Ideographs"](l)||g.isChar["Hangul Syllables"](l)||g.isChar.Hiragana(l)||g.isChar.Katakana(l))},Yt.prototype._tinySDF=function(l,p,c){var d=this.localIdeographFontFamily;if(d&&this._doesCharSupportLocalGlyph(c)){var E=l.tinySDF;if(!E){var w="400";/bold/i.test(p)?w="900":/medium/i.test(p)?w="500":/light/i.test(p)&&(w="200"),E=l.tinySDF=new Yt.TinySDF(24,3,8,.25,d,w)}return{id:c,bitmap:new g.AlphaImage({width:30,height:30},E.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Yt.loadGlyphRange=function(l,p,c,d,E){var w=256*p,P=w+255,L=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",w+"-"+P),g.ResourceType.Glyphs);g.getArrayBuffer(L,function(z,H){if(z)E(z);else if(H){for(var oe={},ue=0,le=g.parseGlyphPBF(H);ue<le.length;ue+=1){var Pe=le[ue];oe[Pe.id]=Pe}E(null,oe)}})},Yt.TinySDF=nr;var ct=function(){this.specification=g.styleSpec.light.position};ct.prototype.possiblyEvaluate=function(l,p){return g.sphericalToCartesian(l.expression.evaluate(p))},ct.prototype.interpolate=function(l,p,c){return{x:g.number(l.x,p.x,c),y:g.number(l.y,p.y,c),z:g.number(l.z,p.z,c)}};var Ke=new g.Properties({anchor:new g.DataConstantProperty(g.styleSpec.light.anchor),position:new ct,color:new g.DataConstantProperty(g.styleSpec.light.color),intensity:new g.DataConstantProperty(g.styleSpec.light.intensity)}),wt=function(l){function p(c){l.call(this),this._transitionable=new g.Transitionable(Ke),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getLight=function(){return this._transitionable.serialize()},p.prototype.setLight=function(c,d){if(d===void 0&&(d={}),!this._validate(g.validateLight,c,d))for(var E in c){var w=c[E];g.endsWith(E,"-transition")?this._transitionable.setTransition(E.slice(0,-"-transition".length),w):this._transitionable.setValue(E,w)}},p.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},p.prototype.hasTransition=function(){return this._transitioning.hasTransition()},p.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},p.prototype._validate=function(c,d,E){return(!E||E.validate!==!1)&&g.emitValidationErrors(this,c.call(g.validateStyle,g.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:g.styleSpec})))},p}(g.Evented),et=function(l,p){this.width=l,this.height=p,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};et.prototype.getDash=function(l,p){var c=l.join(",")+String(p);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,p)),this.dashEntry[c]},et.prototype.getDashRanges=function(l,p,c){var d=[],E=l.length%2==1?-l[l.length-1]*c:0,w=l[0]*c,P=!0;d.push({left:E,right:w,isDash:P,zeroLength:l[0]===0});for(var L=l[0],z=1;z<l.length;z++){var H=l[z];d.push({left:E=L*c,right:w=(L+=H)*c,isDash:P=!P,zeroLength:H===0})}return d},et.prototype.addRoundDash=function(l,p,c){for(var d=p/2,E=-c;E<=c;E++)for(var w=this.width*(this.nextRow+c+E),P=0,L=l[P],z=0;z<this.width;z++){z/L.right>1&&(L=l[++P]);var H=Math.abs(z-L.left),oe=Math.abs(z-L.right),ue=Math.min(H,oe),le=void 0,Pe=E/c*(d+1);if(L.isDash){var we=d-Math.abs(Pe);le=Math.sqrt(ue*ue+we*we)}else le=d-Math.sqrt(ue*ue+Pe*Pe);this.data[w+z]=Math.max(0,Math.min(255,le+128))}},et.prototype.addRegularDash=function(l){for(var p=l.length-1;p>=0;--p){var c=l[p],d=l[p+1];c.zeroLength?l.splice(p,1):d&&d.isDash===c.isDash&&(d.left=c.left,l.splice(p,1))}var E=l[0],w=l[l.length-1];E.isDash===w.isDash&&(E.left=w.left-this.width,w.right=E.right+this.width);for(var P=this.width*this.nextRow,L=0,z=l[L],H=0;H<this.width;H++){H/z.right>1&&(z=l[++L]);var oe=Math.abs(H-z.left),ue=Math.abs(H-z.right),le=Math.min(oe,ue);this.data[P+H]=Math.max(0,Math.min(255,(z.isDash?le:-le)+128))}},et.prototype.addDash=function(l,p){var c=p?7:0,d=2*c+1;if(this.nextRow+d>this.height)return g.warnOnce("LineAtlas out of space"),null;for(var E=0,w=0;w<l.length;w++)E+=l[w];if(E!==0){var P=this.width/E,L=this.getDashRanges(l,this.width,P);p?this.addRoundDash(L,P,c):this.addRegularDash(L)}var z={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:E};return this.nextRow+=d,this.dirty=!0,z},et.prototype.bind=function(l){var p=l.gl;this.texture?(p.bindTexture(p.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,p.texSubImage2D(p.TEXTURE_2D,0,0,0,this.width,this.height,p.ALPHA,p.UNSIGNED_BYTE,this.data))):(this.texture=p.createTexture(),p.bindTexture(p.TEXTURE_2D,this.texture),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.REPEAT),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.REPEAT),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR),p.texImage2D(p.TEXTURE_2D,0,p.ALPHA,this.width,this.height,0,p.ALPHA,p.UNSIGNED_BYTE,this.data))};var qt=function l(p,c){this.workerPool=p,this.actors=[],this.currentActor=0,this.id=g.uniqueId();for(var d=this.workerPool.acquire(this.id),E=0;E<d.length;E++){var w=new l.Actor(d[E],c,this.id);w.name="Worker "+E,this.actors.push(w)}};function Ar(l,p,c){var d=function(E,w){if(E)return c(E);if(w){var P=g.pick(g.extend(w,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(P.vectorLayers=w.vector_layers,P.vectorLayerIds=P.vectorLayers.map(function(L){return L.id})),P.tiles=p.canonicalizeTileset(P,l.url),c(null,P)}};return l.url?g.getJSON(p.transformRequest(p.normalizeSourceURL(l.url),g.ResourceType.Source),d):g.browser.frame(function(){return d(null,l)})}qt.prototype.broadcast=function(l,p,c){g.asyncAll(this.actors,function(d,E){d.send(l,p,E)},c=c||function(){})},qt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},qt.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},qt.Actor=g.Actor;var Wr=function(l,p,c){this.bounds=g.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=p||0,this.maxzoom=c||24};Wr.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Wr.prototype.contains=function(l){var p=Math.pow(2,l.z),c=Math.floor(g.mercatorXfromLng(this.bounds.getWest())*p),d=Math.floor(g.mercatorYfromLat(this.bounds.getNorth())*p),E=Math.ceil(g.mercatorXfromLng(this.bounds.getEast())*p),w=Math.ceil(g.mercatorYfromLat(this.bounds.getSouth())*p);return l.x>=c&&l.x<E&&l.y>=d&&l.y<w};var on=function(l){function p(c,d,E,w){if(l.call(this),this.id=c,this.dispatcher=E,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,g.extend(this,g.pick(d,["url","scheme","tileSize","promoteId"])),this._options=g.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ar(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new g.ErrorEvent(d)):E&&(g.extend(c,E),E.bounds&&(c.tileBounds=new Wr(E.bounds,c.minzoom,c.maxzoom)),g.postTurnstileEvent(E.tiles,c.map._requestManager._customAccessToken),g.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})))})},p.prototype.loaded=function(){return this._loaded},p.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},p.prototype.onAdd=function(c){this.map=c,this.load()},p.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},p.prototype.setTiles=function(c){var d=this;return this.setSourceProperty(function(){d._options.tiles=c}),this},p.prototype.setUrl=function(c){var d=this;return this.setSourceProperty(function(){d.url=c,d._options.url=c}),this},p.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},p.prototype.serialize=function(){return g.extend({},this._options)},p.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(E,g.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:g.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function P(L,z){return delete c.request,c.aborted?d(null):L&&L.status!==404?d(L):(z&&z.resourceTiming&&(c.resourceTiming=z.resourceTiming),this.map._refreshExpiredTiles&&z&&c.setExpiryData(z),c.loadVectorData(z,this.map.painter),g.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",w,P.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",w,P.bind(this)))},p.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},p.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},p.prototype.hasTransition=function(){return!1},p}(g.Evented),A=function(l){function p(c,d,E,w){l.call(this),this.id=c,this.dispatcher=E,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=g.extend({type:"raster"},d),g.extend(this,g.pick(d,["url","scheme","tileSize"]))}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ar(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new g.ErrorEvent(d)):E&&(g.extend(c,E),E.bounds&&(c.tileBounds=new Wr(E.bounds,c.minzoom,c.maxzoom)),g.postTurnstileEvent(E.tiles),g.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})))})},p.prototype.loaded=function(){return this._loaded},p.prototype.onAdd=function(c){this.map=c,this.load()},p.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},p.prototype.serialize=function(){return g.extend({},this._options)},p.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},p.prototype.loadTile=function(c,d){var E=this,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=g.getImage(this.map._requestManager.transformRequest(w,g.ResourceType.Tile),function(P,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(P)c.state="errored",d(P);else if(L){E.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var z=E.map.painter.context,H=z.gl;c.texture=E.map.painter.getTileTexture(L.width),c.texture?c.texture.update(L,{useMipmap:!0}):(c.texture=new g.Texture(z,L,H.RGBA,{useMipmap:!0}),c.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST),z.extTextureFilterAnisotropic&&H.texParameterf(H.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax)),c.state="loaded",g.cacheEntryPossiblyAdded(E.dispatcher),d(null)}})},p.prototype.abortTile=function(c,d){c.request&&(c.request.cancel(),delete c.request),d()},p.prototype.unloadTile=function(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()},p.prototype.hasTransition=function(){return!1},p}(g.Evented),Se=function(l){function p(c,d,E,w){l.call(this,c,d,E,w),this.type="raster-dem",this.maxzoom=22,this._options=g.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},p.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function w(P,L){P&&(c.state="errored",d(P)),L&&(c.dem=L,c.needsHillshadePrepare=!0,c.state="loaded",d(null))}c.request=g.getImage(this.map._requestManager.transformRequest(E,g.ResourceType.Tile),function(P,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(P)c.state="errored",d(P);else if(L){this.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var z=g.window.ImageBitmap&&L instanceof g.window.ImageBitmap&&g.offscreenCanvasSupported()?L:g.browser.getImageData(L,1),H={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:z,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",H,w.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},p.prototype._getNeighboringTiles=function(c){var d=c.canonical,E=Math.pow(2,d.z),w=(d.x-1+E)%E,P=d.x===0?c.wrap-1:c.wrap,L=(d.x+1+E)%E,z=d.x+1===E?c.wrap+1:c.wrap,H={};return H[new g.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y).key]={backfilled:!1},H[new g.OverscaledTileID(c.overscaledZ,z,d.z,L,d.y).key]={backfilled:!1},d.y>0&&(H[new g.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y-1).key]={backfilled:!1},H[new g.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},H[new g.OverscaledTileID(c.overscaledZ,z,d.z,L,d.y-1).key]={backfilled:!1}),d.y+1<E&&(H[new g.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y+1).key]={backfilled:!1},H[new g.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},H[new g.OverscaledTileID(c.overscaledZ,z,d.z,L,d.y+1).key]={backfilled:!1}),H},p.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},p}(A),ke=function(l){function p(c,d,E,w){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=E.getActor(),this.setEventedParent(w),this._data=d.data,this._options=g.extend({},d),this._collectResourceTiming=d.collectResourceTiming,this._resourceTiming=[],d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;var P=g.EXTENT/this.tileSize;this.workerOptions=g.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*P,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*P,extent:g.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?Math.min(d.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:g.EXTENT,radius:(d.clusterRadius||50)*P,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.load=function(){var c=this;this.fire(new g.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(d){if(d)c.fire(new g.ErrorEvent(d));else{var E={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(E.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new g.Event("data",E))}})},p.prototype.onAdd=function(c){this.map=c,this.load()},p.prototype.setData=function(c){var d=this;return this._data=c,this.fire(new g.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(E){if(E)d.fire(new g.ErrorEvent(E));else{var w={dataType:"source",sourceDataType:"content"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(w.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new g.Event("data",w))}}),this},p.prototype.getClusterExpansionZoom=function(c,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},d),this},p.prototype.getClusterChildren=function(c,d){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},d),this},p.prototype.getClusterLeaves=function(c,d,E,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:d,offset:E},w),this},p.prototype._updateWorkerData=function(c){var d=this;this._loaded=!1;var E=g.extend({},this.workerOptions),w=this._data;typeof w=="string"?(E.request=this.map._requestManager.transformRequest(g.browser.resolveURL(w),g.ResourceType.Source),E.request.collectResourceTiming=this._collectResourceTiming):E.data=JSON.stringify(w),this.actor.send(this.type+".loadData",E,function(P,L){d._removed||L&&L.abandoned||(d._loaded=!0,L&&L.resourceTiming&&L.resourceTiming[d.id]&&(d._resourceTiming=L.resourceTiming[d.id].slice(0)),d.actor.send(d.type+".coalesce",{source:E.source},null),c(P))})},p.prototype.loaded=function(){return this._loaded},p.prototype.loadTile=function(c,d){var E=this,w=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(w,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:g.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(P,L){return delete c.request,c.unloadVectorData(),c.aborted?d(null):P?d(P):(c.loadVectorData(L,E.map.painter,w==="reloadTile"),d(null))})},p.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},p.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},p.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},p.prototype.serialize=function(){return g.extend({},this._options,{type:this.type,data:this._data})},p.prototype.hasTransition=function(){return!1},p}(g.Evented),St=g.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),vt=function(l){function p(c,d,E,w){l.call(this),this.id=c,this.dispatcher=E,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=d}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.load=function(c,d){var E=this;this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this.url=this.options.url,g.getImage(this.map._requestManager.transformRequest(this.url,g.ResourceType.Image),function(w,P){E._loaded=!0,w?E.fire(new g.ErrorEvent(w)):P&&(E.image=P,c&&(E.coordinates=c),d&&d(),E._finishLoading())})},p.prototype.loaded=function(){return this._loaded},p.prototype.updateImage=function(c){var d=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){d.texture=null}),this):this},p.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})))},p.prototype.onAdd=function(c){this.map=c,this.load()},p.prototype.setCoordinates=function(c){var d=this;this.coordinates=c;var E=c.map(g.MercatorCoordinate.fromLngLat);this.tileID=function(P){for(var L=1/0,z=1/0,H=-1/0,oe=-1/0,ue=0,le=P;ue<le.length;ue+=1){var Pe=le[ue];L=Math.min(L,Pe.x),z=Math.min(z,Pe.y),H=Math.max(H,Pe.x),oe=Math.max(oe,Pe.y)}var we=Math.max(H-L,oe-z),Ge=Math.max(0,Math.floor(-Math.log(we)/Math.LN2)),Ce=Math.pow(2,Ge);return new g.CanonicalTileID(Ge,Math.floor((L+H)/2*Ce),Math.floor((z+oe)/2*Ce))}(E),this.minzoom=this.maxzoom=this.tileID.z;var w=E.map(function(P){return d.tileID.getTilePoint(P)._round()});return this._boundsArray=new g.StructArrayLayout4i8,this._boundsArray.emplaceBack(w[0].x,w[0].y,0,0),this._boundsArray.emplaceBack(w[1].x,w[1].y,g.EXTENT,0),this._boundsArray.emplaceBack(w[3].x,w[3].y,0,g.EXTENT),this._boundsArray.emplaceBack(w[2].x,w[2].y,g.EXTENT,g.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})),this},p.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,St.members)),this.boundsSegments||(this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new g.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[E];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},p.prototype.loadTile=function(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))},p.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},p.prototype.hasTransition=function(){return!1},p}(g.Evented),Ft=function(l){function p(c,d,E,w){l.call(this,c,d,E,w),this.roundZoom=!0,this.type="video",this.options=d}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.load=function(){var c=this;this._loaded=!1;var d=this.options;this.urls=[];for(var E=0,w=d.urls;E<w.length;E+=1)this.urls.push(this.map._requestManager.transformRequest(w[E],g.ResourceType.Source).url);g.getVideo(this.urls,function(P,L){c._loaded=!0,P?c.fire(new g.ErrorEvent(P)):L&&(c.video=L,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},p.prototype.pause=function(){this.video&&this.video.pause()},p.prototype.play=function(){this.video&&this.video.play()},p.prototype.seek=function(c){if(this.video){var d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new g.ErrorEvent(new g.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+d.start(0)+" and "+d.end(0)+"-second mark."))):this.video.currentTime=c}},p.prototype.getVideo=function(){return this.video},p.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},p.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,St.members)),this.boundsSegments||(this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new g.Texture(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[E];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},p.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},p.prototype.hasTransition=function(){return this.video&&!this.video.paused},p}(vt),Wt=function(l){function p(c,d,E,w){l.call(this,c,d,E,w),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(function(P){return!Array.isArray(P)||P.length!==2||P.some(function(L){return typeof L!="number"})})||this.fire(new g.ErrorEvent(new g.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new g.ErrorEvent(new g.ValidationError("sources."+c,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new g.ErrorEvent(new g.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof g.window.HTMLCanvasElement||this.fire(new g.ErrorEvent(new g.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new g.ErrorEvent(new g.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof g.window.HTMLCanvasElement?this.options.canvas:g.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new g.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},p.prototype.getCanvas=function(){return this.canvas},p.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},p.prototype.onRemove=function(){this.pause()},p.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var d=this.map.painter.context,E=d.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,St.members)),this.boundsSegments||(this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new g.Texture(d,this.canvas,E.RGBA,{premultiply:!0}),this.tiles){var P=this.tiles[w];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},p.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},p.prototype.hasTransition=function(){return this._playing},p.prototype._hasInvalidDimensions=function(){for(var c=0,d=[this.canvas.width,this.canvas.height];c<d.length;c+=1){var E=d[c];if(isNaN(E)||E<=0)return!0}return!1},p}(vt),Er={vector:on,raster:A,"raster-dem":Se,geojson:ke,video:Ft,image:vt,canvas:Wt};function $n(l,p){var c=g.identity([]);return g.translate(c,c,[1,1,0]),g.scale(c,c,[.5*l.width,.5*l.height,1]),g.multiply(c,c,l.calculatePosMatrix(p.toUnwrapped()))}function _n(l,p,c,d,E,w){var P=function(Ge,Ce,Ve){if(Ge)for(var $e=0,yt=Ge;$e<yt.length;$e+=1){var Vt=Ce[yt[$e]];if(Vt&&Vt.source===Ve&&Vt.type==="fill-extrusion")return!0}else for(var Bt in Ce){var Xt=Ce[Bt];if(Xt.source===Ve&&Xt.type==="fill-extrusion")return!0}return!1}(E&&E.layers,p,l.id),L=w.maxPitchScaleFactor(),z=l.tilesIn(d,L,P);z.sort(mi);for(var H=[],oe=0,ue=z;oe<ue.length;oe+=1){var le=ue[oe];H.push({wrappedTileID:le.tileID.wrapped().key,queryResults:le.tile.queryRenderedFeatures(p,c,l._state,le.queryGeometry,le.cameraQueryGeometry,le.scale,E,w,L,$n(l.transform,le.tileID))})}var Pe=function(Ge){for(var Ce={},Ve={},$e=0,yt=Ge;$e<yt.length;$e+=1){var Vt=yt[$e],Bt=Vt.queryResults,Xt=Vt.wrappedTileID,vr=Ve[Xt]=Ve[Xt]||{};for(var Br in Bt)for(var Lr=Bt[Br],jr=vr[Br]=vr[Br]||{},Fn=Ce[Br]=Ce[Br]||[],On=0,Zn=Lr;On<Zn.length;On+=1){var Oi=Zn[On];jr[Oi.featureIndex]||(jr[Oi.featureIndex]=!0,Fn.push(Oi))}}return Ce}(H);for(var we in Pe)Pe[we].forEach(function(Ge){var Ce=Ge.feature,Ve=l.getFeatureState(Ce.layer["source-layer"],Ce.id);Ce.source=Ce.layer.source,Ce.layer["source-layer"]&&(Ce.sourceLayer=Ce.layer["source-layer"]),Ce.state=Ve});return Pe}function mi(l,p){var c=l.tileID,d=p.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}var Gn=function(l,p){this.max=l,this.onRemove=p,this.reset()};Gn.prototype.reset=function(){for(var l in this.data)for(var p=0,c=this.data[l];p<c.length;p+=1){var d=c[p];d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value)}return this.data={},this.order=[],this},Gn.prototype.add=function(l,p,c){var d=this,E=l.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);var w={value:p,timeout:void 0};if(c!==void 0&&(w.timeout=setTimeout(function(){d.remove(l,w)},c)),this.data[E].push(w),this.order.push(E),this.order.length>this.max){var P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this},Gn.prototype.has=function(l){return l.wrapped().key in this.data},Gn.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},Gn.prototype._getAndRemoveByKey=function(l){var p=this.data[l].shift();return p.timeout&&clearTimeout(p.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),p.value},Gn.prototype.getByKey=function(l){var p=this.data[l];return p?p[0].value:null},Gn.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},Gn.prototype.remove=function(l,p){if(!this.has(l))return this;var c=l.wrapped().key,d=p===void 0?0:this.data[c].indexOf(p),E=this.data[c][d];return this.data[c].splice(d,1),E.timeout&&clearTimeout(E.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(E.value),this.order.splice(this.order.indexOf(c),1),this},Gn.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this},Gn.prototype.filter=function(l){var p=[];for(var c in this.data)for(var d=0,E=this.data[c];d<E.length;d+=1){var w=E[d];l(w.value)||p.push(w)}for(var P=0,L=p;P<L.length;P+=1){var z=L[P];this.remove(z.value.tileID,z)}};var ai=function(l,p,c){this.context=l;var d=l.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete p.arrayBuffer};ai.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},ai.prototype.updateData=function(l){var p=this.context.gl;this.context.unbindVAO(),this.bind(),p.bufferSubData(p.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},ai.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var gi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Xn=function(l,p,c,d){this.length=p.length,this.attributes=c,this.itemSize=p.bytesPerElement,this.dynamicDraw=d,this.context=l;var E=l.gl;this.buffer=E.createBuffer(),l.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete p.arrayBuffer};Xn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Xn.prototype.updateData=function(l){var p=this.context.gl;this.bind(),p.bufferSubData(p.ARRAY_BUFFER,0,l.arrayBuffer)},Xn.prototype.enableAttributes=function(l,p){for(var c=0;c<this.attributes.length;c++){var d=p.attributes[this.attributes[c].name];d!==void 0&&l.enableVertexAttribArray(d)}},Xn.prototype.setVertexAttribPointers=function(l,p,c){for(var d=0;d<this.attributes.length;d++){var E=this.attributes[d],w=p.attributes[E.name];w!==void 0&&l.vertexAttribPointer(w,E.components,l[gi[E.type]],!1,this.itemSize,E.offset+this.itemSize*(c||0))}},Xn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var yi=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};yi.prototype.get=function(){return this.current},yi.prototype.set=function(l){},yi.prototype.getDefault=function(){return this.default},yi.prototype.setDefault=function(){this.set(this.default)};var va=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return g.Color.transparent},p.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},p}(yi),Xi=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return 1},p.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},p}(yi),Ri=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return 0},p.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},p}(yi),Ji=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return[!0,!0,!0,!0]},p.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},p}(yi),ma=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return!0},p.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},p}(yi),Do=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return 255},p.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},p}(yi),Oa=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},p.prototype.set=function(c){var d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},p}(yi),xa=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},p.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},p}(yi),Ui=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return!1},p.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}},p}(yi),aa=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return[0,1]},p.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},p}(yi),ea=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return!1},p.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}},p}(yi),Os=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return this.gl.LESS},p.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},p}(yi),fe=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return!1},p.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}},p}(yi),oi=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},p.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},p}(yi),xo=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return g.Color.transparent},p.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},p}(yi),au=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return this.gl.FUNC_ADD},p.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},p}(yi),Nt=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return!1},p.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}},p}(yi),Jt=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return this.gl.BACK},p.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},p}(yi),Dr=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return this.gl.CCW},p.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},p}(yi),cn=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return null},p.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},p}(yi),wn=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return this.gl.TEXTURE0},p.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},p}(yi),Nn=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},p.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},p}(yi),Ei=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return null},p.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},p}(yi),di=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return null},p.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},p}(yi),Sn=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return null},p.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}},p}(yi),Pi=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return null},p.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},p}(yi),Mi=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return null},p.prototype.set=function(c){var d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},p}(yi),to=function(l){function p(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return null},p.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},p}(yi),gs=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return 4},p.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},p}(yi),Ho=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return!1},p.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},p}(yi),Na=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return!1},p.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},p}(yi),ba=function(l){function p(c,d){l.call(this,c),this.context=c,this.parent=d}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getDefault=function(){return null},p}(yi),V=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.setDirty=function(){this.dirty=!0},p.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},p}(ba),K=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},p}(ba),te=function(l,p,c,d){this.context=l,this.width=p,this.height=c;var E=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new V(l,E),d&&(this.depthAttachment=new K(l,E))};te.prototype.destroy=function(){var l=this.context.gl,p=this.colorAttachment.get();if(p&&l.deleteTexture(p),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var he=function(l,p,c){this.func=l,this.mask=p,this.range=c};he.ReadOnly=!1,he.ReadWrite=!0,he.disabled=new he(519,he.ReadOnly,[0,1]);var Me=function(l,p,c,d,E,w){this.test=l,this.ref=p,this.mask=c,this.fail=d,this.depthFail=E,this.pass=w};Me.disabled=new Me({func:519,mask:0},0,0,7680,7680,7680);var je=function(l,p,c){this.blendFunction=l,this.blendColor=p,this.mask=c};je.disabled=new je(je.Replace=[1,0],g.Color.transparent,[!1,!1,!1,!1]),je.unblended=new je(je.Replace,g.Color.transparent,[!0,!0,!0,!0]),je.alphaBlended=new je([1,771],g.Color.transparent,[!0,!0,!0,!0]);var Qe=function(l,p,c){this.enable=l,this.mode=p,this.frontFace=c};Qe.disabled=new Qe(!1,1029,2305),Qe.backCCW=new Qe(!0,1029,2305);var se=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new va(this),this.clearDepth=new Xi(this),this.clearStencil=new Ri(this),this.colorMask=new Ji(this),this.depthMask=new ma(this),this.stencilMask=new Do(this),this.stencilFunc=new Oa(this),this.stencilOp=new xa(this),this.stencilTest=new Ui(this),this.depthRange=new aa(this),this.depthTest=new ea(this),this.depthFunc=new Os(this),this.blend=new fe(this),this.blendFunc=new oi(this),this.blendColor=new xo(this),this.blendEquation=new au(this),this.cullFace=new Nt(this),this.cullFaceSide=new Jt(this),this.frontFace=new Dr(this),this.program=new cn(this),this.activeTexture=new wn(this),this.viewport=new Nn(this),this.bindFramebuffer=new Ei(this),this.bindRenderbuffer=new di(this),this.bindTexture=new Sn(this),this.bindVertexBuffer=new Pi(this),this.bindElementBuffer=new Mi(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new to(this),this.pixelStoreUnpack=new gs(this),this.pixelStoreUnpackPremultiplyAlpha=new Ho(this),this.pixelStoreUnpackFlipY=new Na(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};se.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},se.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},se.prototype.createIndexBuffer=function(l,p){return new ai(this,l,p)},se.prototype.createVertexBuffer=function(l,p,c){return new Xn(this,l,p,c)},se.prototype.createRenderbuffer=function(l,p,c){var d=this.gl,E=d.createRenderbuffer();return this.bindRenderbuffer.set(E),d.renderbufferStorage(d.RENDERBUFFER,l,p,c),this.bindRenderbuffer.set(null),E},se.prototype.createFramebuffer=function(l,p,c){return new te(this,l,p,c)},se.prototype.clear=function(l){var p=l.color,c=l.depth,d=this.gl,E=0;p&&(E|=d.COLOR_BUFFER_BIT,this.clearColor.set(p),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(E|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(E)},se.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},se.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},se.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},se.prototype.setColorMode=function(l){g.deepEqual(l.blendFunction,je.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},se.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Le=function(l){function p(c,d,E){var w=this;l.call(this),this.id=c,this.dispatcher=E,this.on("data",function(P){P.dataType==="source"&&P.sourceDataType==="metadata"&&(w._sourceLoaded=!0),w._sourceLoaded&&!w._paused&&P.dataType==="source"&&P.sourceDataType==="content"&&(w.reload(),w.transform&&w.update(w.transform))}),this.on("error",function(){w._sourceErrored=!0}),this._source=function(P,L,z,H){var oe=new Er[L.type](P,L,z,H);if(oe.id!==P)throw new Error("Expected Source id to be "+P+" instead of "+oe.id);return g.bindAll(["load","abort","unload","serialize","prepare"],oe),oe}(c,d,E,this),this._tiles={},this._cache=new Gn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new g.SourceFeatureState}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},p.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},p.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0},p.prototype.getSource=function(){return this._source},p.prototype.pause=function(){this._paused=!0},p.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},p.prototype._loadTile=function(c,d){return this._source.loadTile(c,d)},p.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},p.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},p.prototype.serialize=function(){return this._source.serialize()},p.prototype.prepare=function(c){for(var d in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var E=this._tiles[d];E.upload(c),E.prepare(this.map.style.imageManager)}},p.prototype.getIds=function(){return g.values(this._tiles).map(function(c){return c.tileID}).sort(ft).map(function(c){return c.key})},p.prototype.getRenderableIds=function(c){var d=this,E=[];for(var w in this._tiles)this._isIdRenderable(w,c)&&E.push(this._tiles[w]);return c?E.sort(function(P,L){var z=P.tileID,H=L.tileID,oe=new g.Point(z.canonical.x,z.canonical.y)._rotate(d.transform.angle),ue=new g.Point(H.canonical.x,H.canonical.y)._rotate(d.transform.angle);return z.overscaledZ-H.overscaledZ||ue.y-oe.y||ue.x-oe.x}).map(function(P){return P.tileID.key}):E.map(function(P){return P.tileID}).sort(ft).map(function(P){return P.key})},p.prototype.hasRenderableParent=function(c){var d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)},p.prototype._isIdRenderable=function(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())},p.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},p.prototype._reloadTile=function(c,d){var E=this._tiles[c];E&&(E.state!=="loading"&&(E.state=d),this._loadTile(E,this._tileLoaded.bind(this,E,c,d)))},p.prototype._tileLoaded=function(c,d,E,w){if(w)return c.state="errored",void(w.status!==404?this._source.fire(new g.ErrorEvent(w,{tile:c})):this.update(this.transform));c.timeAdded=g.browser.now(),E==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new g.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},p.prototype._backfillDEM=function(c){for(var d=this.getRenderableIds(),E=0;E<d.length;E++){var w=d[E];if(c.neighboringTiles&&c.neighboringTiles[w]){var P=this.getTileByID(w);L(c,P),L(P,c)}}function L(z,H){z.needsHillshadePrepare=!0;var oe=H.tileID.canonical.x-z.tileID.canonical.x,ue=H.tileID.canonical.y-z.tileID.canonical.y,le=Math.pow(2,z.tileID.canonical.z),Pe=H.tileID.key;oe===0&&ue===0||Math.abs(ue)>1||(Math.abs(oe)>1&&(Math.abs(oe+le)===1?oe+=le:Math.abs(oe-le)===1&&(oe-=le)),H.dem&&z.dem&&(z.dem.backfillBorder(H.dem,oe,ue),z.neighboringTiles&&z.neighboringTiles[Pe]&&(z.neighboringTiles[Pe].backfilled=!0)))}},p.prototype.getTile=function(c){return this.getTileByID(c.key)},p.prototype.getTileByID=function(c){return this._tiles[c]},p.prototype._retainLoadedChildren=function(c,d,E,w){for(var P in this._tiles){var L=this._tiles[P];if(!(w[P]||!L.hasData()||L.tileID.overscaledZ<=d||L.tileID.overscaledZ>E)){for(var z=L.tileID;L&&L.tileID.overscaledZ>d+1;){var H=L.tileID.scaledTo(L.tileID.overscaledZ-1);(L=this._tiles[H.key])&&L.hasData()&&(z=H)}for(var oe=z;oe.overscaledZ>d;)if(c[(oe=oe.scaledTo(oe.overscaledZ-1)).key]){w[z.key]=z;break}}}},p.prototype.findLoadedParent=function(c,d){if(c.key in this._loadedParentTiles){var E=this._loadedParentTiles[c.key];return E&&E.tileID.overscaledZ>=d?E:null}for(var w=c.overscaledZ-1;w>=d;w--){var P=c.scaledTo(w),L=this._getLoadedTile(P);if(L)return L}},p.prototype._getLoadedTile=function(c){var d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)},p.prototype.updateCacheSize=function(c){var d=Math.ceil(c.width/this._source.tileSize)+1,E=Math.ceil(c.height/this._source.tileSize)+1,w=Math.floor(d*E*5),P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(P)},p.prototype.handleWrapJump=function(c){var d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){var E={};for(var w in this._tiles){var P=this._tiles[w];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+d),E[P.tileID.key]=P}for(var L in this._tiles=E,this._timers)clearTimeout(this._timers[L]),delete this._timers[L];for(var z in this._tiles)this._setTileReloadTimer(z,this._tiles[z])}},p.prototype.update=function(c){var d=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var E;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?E=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(vr){return new g.OverscaledTileID(vr.canonical.z,vr.wrap,vr.canonical.z,vr.canonical.x,vr.canonical.y)}):(E=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(E=E.filter(function(vr){return d._source.hasTile(vr)}))):E=[];var w=c.coveringZoomLevel(this._source),P=Math.max(w-p.maxOverzooming,this._source.minzoom),L=Math.max(w+p.maxUnderzooming,this._source.minzoom),z=this._updateRetainedTiles(E,w);if(hr(this._source.type)){for(var H={},oe={},ue=0,le=Object.keys(z);ue<le.length;ue+=1){var Pe=le[ue],we=z[Pe],Ge=this._tiles[Pe];if(Ge&&!(Ge.fadeEndTime&&Ge.fadeEndTime<=g.browser.now())){var Ce=this.findLoadedParent(we,P);Ce&&(this._addTile(Ce.tileID),H[Ce.tileID.key]=Ce.tileID),oe[Pe]=we}}for(var Ve in this._retainLoadedChildren(oe,w,L,z),H)z[Ve]||(this._coveredTiles[Ve]=!0,z[Ve]=H[Ve])}for(var $e in z)this._tiles[$e].clearFadeHold();for(var yt=0,Vt=g.keysDifference(this._tiles,z);yt<Vt.length;yt+=1){var Bt=Vt[yt],Xt=this._tiles[Bt];Xt.hasSymbolBuckets&&!Xt.holdingForFade()?Xt.setHoldDuration(this.map._fadeDuration):Xt.hasSymbolBuckets&&!Xt.symbolFadeFinished()||this._removeTile(Bt)}this._updateLoadedParentTileCache()}},p.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},p.prototype._updateRetainedTiles=function(c,d){for(var E={},w={},P=Math.max(d-p.maxOverzooming,this._source.minzoom),L=Math.max(d+p.maxUnderzooming,this._source.minzoom),z={},H=0,oe=c;H<oe.length;H+=1){var ue=oe[H],le=this._addTile(ue);E[ue.key]=ue,le.hasData()||d<this._source.maxzoom&&(z[ue.key]=ue)}this._retainLoadedChildren(z,d,L,E);for(var Pe=0,we=c;Pe<we.length;Pe+=1){var Ge=we[Pe],Ce=this._tiles[Ge.key];if(!Ce.hasData()){if(d+1>this._source.maxzoom){var Ve=Ge.children(this._source.maxzoom)[0],$e=this.getTile(Ve);if($e&&$e.hasData()){E[Ve.key]=Ve;continue}}else{var yt=Ge.children(this._source.maxzoom);if(E[yt[0].key]&&E[yt[1].key]&&E[yt[2].key]&&E[yt[3].key])continue}for(var Vt=Ce.wasRequested(),Bt=Ge.overscaledZ-1;Bt>=P;--Bt){var Xt=Ge.scaledTo(Bt);if(w[Xt.key]||(w[Xt.key]=!0,!(Ce=this.getTile(Xt))&&Vt&&(Ce=this._addTile(Xt)),Ce&&(E[Xt.key]=Xt,Vt=Ce.wasRequested(),Ce.hasData())))break}}}return E},p.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var d=[],E=void 0,w=this._tiles[c].tileID;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){E=this._loadedParentTiles[w.key];break}d.push(w.key);var P=w.scaledTo(w.overscaledZ-1);if(E=this._getLoadedTile(P))break;w=P}for(var L=0,z=d;L<z.length;L+=1)this._loadedParentTiles[z[L]]=E}},p.prototype._addTile=function(c){var d=this._tiles[c.key];if(d)return d;(d=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));var E=Boolean(d);return E||(d=new g.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,c.key,d.state))),d?(d.uses++,this._tiles[c.key]=d,E||this._source.fire(new g.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null},p.prototype._setTileReloadTimer=function(c,d){var E=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var w=d.getExpiryTimeout();w&&(this._timers[c]=setTimeout(function(){E._reloadTile(c,"expired"),delete E._timers[c]},w))},p.prototype._removeTile=function(c){var d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))},p.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},p.prototype.tilesIn=function(c,d,E){var w=this,P=[],L=this.transform;if(!L)return P;for(var z=E?L.getCameraQueryGeometry(c):c,H=c.map(function(Bt){return L.pointCoordinate(Bt)}),oe=z.map(function(Bt){return L.pointCoordinate(Bt)}),ue=this.getIds(),le=1/0,Pe=1/0,we=-1/0,Ge=-1/0,Ce=0,Ve=oe;Ce<Ve.length;Ce+=1){var $e=Ve[Ce];le=Math.min(le,$e.x),Pe=Math.min(Pe,$e.y),we=Math.max(we,$e.x),Ge=Math.max(Ge,$e.y)}for(var yt=function(Bt){var Xt=w._tiles[ue[Bt]];if(!Xt.holdingForFade()){var vr=Xt.tileID,Br=Math.pow(2,L.zoom-Xt.tileID.overscaledZ),Lr=d*Xt.queryPadding*g.EXTENT/Xt.tileSize/Br,jr=[vr.getTilePoint(new g.MercatorCoordinate(le,Pe)),vr.getTilePoint(new g.MercatorCoordinate(we,Ge))];if(jr[0].x-Lr<g.EXTENT&&jr[0].y-Lr<g.EXTENT&&jr[1].x+Lr>=0&&jr[1].y+Lr>=0){var Fn=H.map(function(Zn){return vr.getTilePoint(Zn)}),On=oe.map(function(Zn){return vr.getTilePoint(Zn)});P.push({tile:Xt,tileID:vr,queryGeometry:Fn,cameraQueryGeometry:On,scale:Br})}}},Vt=0;Vt<ue.length;Vt++)yt(Vt);return P},p.prototype.getVisibleCoordinates=function(c){for(var d=this,E=this.getRenderableIds(c).map(function(z){return d._tiles[z].tileID}),w=0,P=E;w<P.length;w+=1){var L=P[w];L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped())}return E},p.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(hr(this._source.type))for(var c in this._tiles){var d=this._tiles[c];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=g.browser.now())return!0}return!1},p.prototype.setFeatureState=function(c,d,E){this._state.updateState(c=c||"_geojsonTileLayer",d,E)},p.prototype.removeFeatureState=function(c,d,E){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,E)},p.prototype.getFeatureState=function(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)},p.prototype.setDependencies=function(c,d,E){var w=this._tiles[c];w&&w.setDependencies(d,E)},p.prototype.reloadTilesForDependencies=function(c,d){for(var E in this._tiles)this._tiles[E].hasDependency(c,d)&&this._reloadTile(E,"reloading");this._cache.filter(function(w){return!w.hasDependency(c,d)})},p}(g.Evented);function ft(l,p){var c=Math.abs(2*l.wrap)-+(l.wrap<0),d=Math.abs(2*p.wrap)-+(p.wrap<0);return l.overscaledZ-p.overscaledZ||d-c||p.canonical.y-l.canonical.y||p.canonical.x-l.canonical.x}function hr(l){return l==="raster"||l==="image"||l==="video"}function Ot(){return new g.window.Worker(Gc.workerUrl)}Le.maxOverzooming=10,Le.maxUnderzooming=3;var kt="mapboxgl_preloaded_worker_pool",dr=function(){this.active={}};dr.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<dr.workerCount;)this.workers.push(new Ot);return this.active[l]=!0,this.workers.slice()},dr.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(p){p.terminate()}),this.workers=null)},dr.prototype.isPreloaded=function(){return!!this.active[kt]},dr.prototype.numActive=function(){return Object.keys(this.active).length};var En,fn=Math.floor(g.browser.hardwareConcurrency/2);function Mt(){return En||(En=new dr),En}function tn(l,p){var c={};for(var d in l)d!=="ref"&&(c[d]=l[d]);return g.refProperties.forEach(function(E){E in p&&(c[E]=p[E])}),c}function Ur(l){l=l.slice();for(var p=Object.create(null),c=0;c<l.length;c++)p[l[c].id]=l[c];for(var d=0;d<l.length;d++)"ref"in l[d]&&(l[d]=tn(l[d],p[l[d].ref]));return l}dr.workerCount=Math.max(Math.min(fn,6),1);var Xr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function vi(l,p,c){c.push({command:Xr.addSource,args:[l,p[l]]})}function rn(l,p,c){p.push({command:Xr.removeSource,args:[l]}),c[l]=!0}function nn(l,p,c,d){rn(l,c,d),vi(l,p,c)}function ji(l,p,c){var d;for(d in l[c])if(l[c].hasOwnProperty(d)&&d!=="data"&&!g.deepEqual(l[c][d],p[c][d]))return!1;for(d in p[c])if(p[c].hasOwnProperty(d)&&d!=="data"&&!g.deepEqual(l[c][d],p[c][d]))return!1;return!0}function fi(l,p,c,d,E,w){var P;for(P in p=p||{},l=l||{})l.hasOwnProperty(P)&&(g.deepEqual(l[P],p[P])||c.push({command:w,args:[d,P,p[P],E]}));for(P in p)p.hasOwnProperty(P)&&!l.hasOwnProperty(P)&&(g.deepEqual(l[P],p[P])||c.push({command:w,args:[d,P,p[P],E]}))}function Ai(l){return l.id}function _i(l,p){return l[p.id]=p,l}var st=function(l,p){this.reset(l,p)};st.prototype.reset=function(l,p){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(p||0,.5*this.length),this.paddedLength=this.length-2*this.padding},st.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=g.clamp(l,0,1);for(var p=1,c=this._distances[p],d=l*this.paddedLength+this.padding;c<d&&p<this._distances.length;)c=this._distances[++p];var E=p-1,w=this._distances[E],P=c-w,L=P>0?(d-w)/P:0;return this.points[E].mult(1-L).add(this.points[p].mult(L))};var Ct=function(l,p,c){var d=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(p/c);for(var w=0;w<this.xCellCount*this.yCellCount;w++)d.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=p,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/p,this.boxUid=0,this.circleUid=0};function Ca(l,p,c,d,E){var w=g.create();return p?(g.scale(w,w,[1/E,1/E,1]),c||g.rotateZ(w,w,d.angle)):g.multiply(w,d.labelPlaneMatrix,l),w}function Ci(l,p,c,d,E){if(p){var w=g.clone(l);return g.scale(w,w,[E,E,1]),c||g.rotateZ(w,w,-d.angle),w}return d.glCoordMatrix}function wi(l,p){var c=[l.x,l.y,0,1];Aa(c,c,p);var d=c[3];return{point:new g.Point(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function Bi(l,p){return .5+l/p*.5}function wr(l,p){var c=l[0]/l[3],d=l[1]/l[3];return c>=-p[0]&&c<=p[0]&&d>=-p[1]&&d<=p[1]}function an(l,p,c,d,E,w,P,L){var z=d?l.textSizeData:l.iconSizeData,H=g.evaluateSizeForZoom(z,c.transform.zoom),oe=[256/c.width*2+1,256/c.height*2+1],ue=d?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;ue.clear();for(var le=l.lineVertexArray,Pe=d?l.text.placedSymbolArray:l.icon.placedSymbolArray,we=c.transform.width/c.transform.height,Ge=!1,Ce=0;Ce<Pe.length;Ce++){var Ve=Pe.get(Ce);if(Ve.hidden||Ve.writingMode===g.WritingMode.vertical&&!Ge)za(Ve.numGlyphs,ue);else{Ge=!1;var $e=[Ve.anchorX,Ve.anchorY,0,1];if(g.transformMat4($e,$e,p),wr($e,oe)){var yt=Bi(c.transform.cameraToCenterDistance,$e[3]),Vt=g.evaluateSizeForFeature(z,H,Ve),Bt=P?Vt/yt:Vt*yt,Xt=new g.Point(Ve.anchorX,Ve.anchorY),vr=wi(Xt,E).point,Br={},Lr=ae(Ve,Bt,!1,L,p,E,w,l.glyphOffsetArray,le,ue,vr,Xt,Br,we);Ge=Lr.useVertical,(Lr.notEnoughRoom||Ge||Lr.needsFlipping&&ae(Ve,Bt,!0,L,p,E,w,l.glyphOffsetArray,le,ue,vr,Xt,Br,we).notEnoughRoom)&&za(Ve.numGlyphs,ue)}else za(Ve.numGlyphs,ue)}}d?l.text.dynamicLayoutVertexBuffer.updateData(ue):l.icon.dynamicLayoutVertexBuffer.updateData(ue)}function pt(l,p,c,d,E,w,P,L,z,H,oe){var ue=L.glyphStartIndex+L.numGlyphs,le=L.lineStartIndex,Pe=L.lineStartIndex+L.lineLength,we=p.getoffsetX(L.glyphStartIndex),Ge=p.getoffsetX(ue-1),Ce=$i(l*we,c,d,E,w,P,L.segment,le,Pe,z,H,oe);if(!Ce)return null;var Ve=$i(l*Ge,c,d,E,w,P,L.segment,le,Pe,z,H,oe);return Ve?{first:Ce,last:Ve}:null}function ta(l,p,c,d){return l===g.WritingMode.horizontal&&Math.abs(c.y-p.y)>Math.abs(c.x-p.x)*d?{useVertical:!0}:(l===g.WritingMode.vertical?p.y<c.y:p.x>c.x)?{needsFlipping:!0}:null}function ae(l,p,c,d,E,w,P,L,z,H,oe,ue,le,Pe){var we,Ge=p/24,Ce=l.lineOffsetX*Ge,Ve=l.lineOffsetY*Ge;if(l.numGlyphs>1){var $e=l.glyphStartIndex+l.numGlyphs,yt=l.lineStartIndex,Vt=l.lineStartIndex+l.lineLength,Bt=pt(Ge,L,Ce,Ve,c,oe,ue,l,z,w,le);if(!Bt)return{notEnoughRoom:!0};var Xt=wi(Bt.first.point,P).point,vr=wi(Bt.last.point,P).point;if(d&&!c){var Br=ta(l.writingMode,Xt,vr,Pe);if(Br)return Br}we=[Bt.first];for(var Lr=l.glyphStartIndex+1;Lr<$e-1;Lr++)we.push($i(Ge*L.getoffsetX(Lr),Ce,Ve,c,oe,ue,l.segment,yt,Vt,z,w,le));we.push(Bt.last)}else{if(d&&!c){var jr=wi(ue,E).point,Fn=l.lineStartIndex+l.segment+1,On=new g.Point(z.getx(Fn),z.gety(Fn)),Zn=wi(On,E),Oi=Zn.signedDistanceFromCamera>0?Zn.point:es(ue,On,jr,1,E),un=ta(l.writingMode,jr,Oi,Pe);if(un)return un}var Qn=$i(Ge*L.getoffsetX(l.glyphStartIndex),Ce,Ve,c,oe,ue,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,z,w,le);if(!Qn)return{notEnoughRoom:!0};we=[Qn]}for(var li=0,Jn=we;li<Jn.length;li+=1){var Hn=Jn[li];g.addDynamicAttributes(H,Hn.point,Hn.angle)}return{}}function es(l,p,c,d,E){var w=wi(l.add(l.sub(p)._unit()),E).point,P=c.sub(w);return c.add(P._mult(d/P.mag()))}function $i(l,p,c,d,E,w,P,L,z,H,oe,ue){var le=d?l-p:l+p,Pe=le>0?1:-1,we=0;d&&(Pe*=-1,we=Math.PI),Pe<0&&(we+=Math.PI);for(var Ge=Pe>0?L+P:L+P+1,Ce=E,Ve=E,$e=0,yt=0,Vt=Math.abs(le),Bt=[];$e+yt<=Vt;){if((Ge+=Pe)<L||Ge>=z)return null;if(Ve=Ce,Bt.push(Ce),(Ce=ue[Ge])===void 0){var Xt=new g.Point(H.getx(Ge),H.gety(Ge)),vr=wi(Xt,oe);if(vr.signedDistanceFromCamera>0)Ce=ue[Ge]=vr.point;else{var Br=Ge-Pe;Ce=es($e===0?w:new g.Point(H.getx(Br),H.gety(Br)),Xt,Ve,Vt-$e+1,oe)}}$e+=yt,yt=Ve.dist(Ce)}var Lr=(Vt-$e)/yt,jr=Ce.sub(Ve),Fn=jr.mult(Lr)._add(Ve);Fn._add(jr._unit()._perp()._mult(c*Pe));var On=we+Math.atan2(Ce.y-Ve.y,Ce.x-Ve.x);return Bt.push(Fn),{point:Fn,angle:On,path:Bt}}Ct.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Ct.prototype.insert=function(l,p,c,d,E){this._forEachCell(p,c,d,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(p),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(E)},Ct.prototype.insertCircle=function(l,p,c,d){this._forEachCell(p-d,c-d,p+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(p),this.circles.push(c),this.circles.push(d)},Ct.prototype._insertBoxCell=function(l,p,c,d,E,w){this.boxCells[E].push(w)},Ct.prototype._insertCircleCell=function(l,p,c,d,E,w){this.circleCells[E].push(w)},Ct.prototype._query=function(l,p,c,d,E,w){if(c<0||l>this.width||d<0||p>this.height)return!E&&[];var P=[];if(l<=0&&p<=0&&this.width<=c&&this.height<=d){if(E)return!0;for(var L=0;L<this.boxKeys.length;L++)P.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(var z=0;z<this.circleKeys.length;z++){var H=this.circles[3*z],oe=this.circles[3*z+1],ue=this.circles[3*z+2];P.push({key:this.circleKeys[z],x1:H-ue,y1:oe-ue,x2:H+ue,y2:oe+ue})}return w?P.filter(w):P}return this._forEachCell(l,p,c,d,this._queryCell,P,{hitTest:E,seenUids:{box:{},circle:{}}},w),E?P.length>0:P},Ct.prototype._queryCircle=function(l,p,c,d,E){var w=l-c,P=l+c,L=p-c,z=p+c;if(P<0||w>this.width||z<0||L>this.height)return!d&&[];var H=[];return this._forEachCell(w,L,P,z,this._queryCellCircle,H,{hitTest:d,circle:{x:l,y:p,radius:c},seenUids:{box:{},circle:{}}},E),d?H.length>0:H},Ct.prototype.query=function(l,p,c,d,E){return this._query(l,p,c,d,!1,E)},Ct.prototype.hitTest=function(l,p,c,d,E){return this._query(l,p,c,d,!0,E)},Ct.prototype.hitTestCircle=function(l,p,c,d){return this._queryCircle(l,p,c,!0,d)},Ct.prototype._queryCell=function(l,p,c,d,E,w,P,L){var z=P.seenUids,H=this.boxCells[E];if(H!==null)for(var oe=this.bboxes,ue=0,le=H;ue<le.length;ue+=1){var Pe=le[ue];if(!z.box[Pe]){z.box[Pe]=!0;var we=4*Pe;if(l<=oe[we+2]&&p<=oe[we+3]&&c>=oe[we+0]&&d>=oe[we+1]&&(!L||L(this.boxKeys[Pe]))){if(P.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[Pe],x1:oe[we],y1:oe[we+1],x2:oe[we+2],y2:oe[we+3]})}}}var Ge=this.circleCells[E];if(Ge!==null)for(var Ce=this.circles,Ve=0,$e=Ge;Ve<$e.length;Ve+=1){var yt=$e[Ve];if(!z.circle[yt]){z.circle[yt]=!0;var Vt=3*yt;if(this._circleAndRectCollide(Ce[Vt],Ce[Vt+1],Ce[Vt+2],l,p,c,d)&&(!L||L(this.circleKeys[yt]))){if(P.hitTest)return w.push(!0),!0;var Bt=Ce[Vt],Xt=Ce[Vt+1],vr=Ce[Vt+2];w.push({key:this.circleKeys[yt],x1:Bt-vr,y1:Xt-vr,x2:Bt+vr,y2:Xt+vr})}}}},Ct.prototype._queryCellCircle=function(l,p,c,d,E,w,P,L){var z=P.circle,H=P.seenUids,oe=this.boxCells[E];if(oe!==null)for(var ue=this.bboxes,le=0,Pe=oe;le<Pe.length;le+=1){var we=Pe[le];if(!H.box[we]){H.box[we]=!0;var Ge=4*we;if(this._circleAndRectCollide(z.x,z.y,z.radius,ue[Ge+0],ue[Ge+1],ue[Ge+2],ue[Ge+3])&&(!L||L(this.boxKeys[we])))return w.push(!0),!0}}var Ce=this.circleCells[E];if(Ce!==null)for(var Ve=this.circles,$e=0,yt=Ce;$e<yt.length;$e+=1){var Vt=yt[$e];if(!H.circle[Vt]){H.circle[Vt]=!0;var Bt=3*Vt;if(this._circlesCollide(Ve[Bt],Ve[Bt+1],Ve[Bt+2],z.x,z.y,z.radius)&&(!L||L(this.circleKeys[Vt])))return w.push(!0),!0}}},Ct.prototype._forEachCell=function(l,p,c,d,E,w,P,L){for(var z=this._convertToXCellCoord(l),H=this._convertToYCellCoord(p),oe=this._convertToXCellCoord(c),ue=this._convertToYCellCoord(d),le=z;le<=oe;le++)for(var Pe=H;Pe<=ue;Pe++)if(E.call(this,l,p,c,d,this.xCellCount*Pe+le,w,P,L))return},Ct.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},Ct.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},Ct.prototype._circlesCollide=function(l,p,c,d,E,w){var P=d-l,L=E-p,z=c+w;return z*z>P*P+L*L},Ct.prototype._circleAndRectCollide=function(l,p,c,d,E,w,P){var L=(w-d)/2,z=Math.abs(l-(d+L));if(z>L+c)return!1;var H=(P-E)/2,oe=Math.abs(p-(E+H));if(oe>H+c)return!1;if(z<=L||oe<=H)return!0;var ue=z-L,le=oe-H;return ue*ue+le*le<=c*c};var Eu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function za(l,p){for(var c=0;c<l;c++){var d=p.length;p.resize(d+4),p.float32.set(Eu,3*d)}}function Aa(l,p,c){var d=p[0],E=p[1];return l[0]=c[0]*d+c[4]*E+c[12],l[1]=c[1]*d+c[5]*E+c[13],l[3]=c[3]*d+c[7]*E+c[15],l}var Ya=function(l,p,c){p===void 0&&(p=new Ct(l.width+200,l.height+200,25)),c===void 0&&(c=new Ct(l.width+200,l.height+200,25)),this.transform=l,this.grid=p,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function ra(l,p,c){return p*(g.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}Ya.prototype.placeCollisionBox=function(l,p,c,d,E){var w=this.projectAndGetPerspectiveRatio(d,l.anchorPointX,l.anchorPointY),P=c*w.perspectiveRatio,L=l.x1*P+w.point.x,z=l.y1*P+w.point.y,H=l.x2*P+w.point.x,oe=l.y2*P+w.point.y;return!this.isInsideGrid(L,z,H,oe)||!p&&this.grid.hitTest(L,z,H,oe,E)?{box:[],offscreen:!1}:{box:[L,z,H,oe],offscreen:this.isOffscreen(L,z,H,oe)}},Ya.prototype.placeCollisionCircles=function(l,p,c,d,E,w,P,L,z,H,oe,ue,le){var Pe=[],we=new g.Point(p.anchorX,p.anchorY),Ge=wi(we,w),Ce=Bi(this.transform.cameraToCenterDistance,Ge.signedDistanceFromCamera),Ve=(H?E/Ce:E*Ce)/g.ONE_EM,$e=wi(we,P).point,yt=pt(Ve,d,p.lineOffsetX*Ve,p.lineOffsetY*Ve,!1,$e,we,p,c,P,{}),Vt=!1,Bt=!1,Xt=!0;if(yt){for(var vr=.5*ue*Ce+le,Br=new g.Point(-100,-100),Lr=new g.Point(this.screenRightBoundary,this.screenBottomBoundary),jr=new st,Fn=yt.first,On=yt.last,Zn=[],Oi=Fn.path.length-1;Oi>=1;Oi--)Zn.push(Fn.path[Oi]);for(var un=1;un<On.path.length;un++)Zn.push(On.path[un]);var Qn=2.5*vr;if(L){var li=Zn.map(function(Js){return wi(Js,L)});Zn=li.some(function(Js){return Js.signedDistanceFromCamera<=0})?[]:li.map(function(Js){return Js.point})}var Jn=[];if(Zn.length>0){for(var Hn=Zn[0].clone(),pi=Zn[0].clone(),Kn=1;Kn<Zn.length;Kn++)Hn.x=Math.min(Hn.x,Zn[Kn].x),Hn.y=Math.min(Hn.y,Zn[Kn].y),pi.x=Math.max(pi.x,Zn[Kn].x),pi.y=Math.max(pi.y,Zn[Kn].y);Jn=Hn.x>=Br.x&&pi.x<=Lr.x&&Hn.y>=Br.y&&pi.y<=Lr.y?[Zn]:pi.x<Br.x||Hn.x>Lr.x||pi.y<Br.y||Hn.y>Lr.y?[]:g.clipLine([Zn],Br.x,Br.y,Lr.x,Lr.y)}for(var Wn=0,go=Jn;Wn<go.length;Wn+=1){var Va;jr.reset(go[Wn],.25*vr),Va=jr.length<=.5*vr?1:Math.ceil(jr.paddedLength/Qn)+1;for(var No=0;No<Va;No++){var zo=No/Math.max(Va-1,1),$a=jr.lerp(zo),lo=$a.x+100,Ds=$a.y+100;Pe.push(lo,Ds,vr,0);var fs=lo-vr,Uo=Ds-vr,ps=lo+vr,is=Ds+vr;if(Xt=Xt&&this.isOffscreen(fs,Uo,ps,is),Bt=Bt||this.isInsideGrid(fs,Uo,ps,is),!l&&this.grid.hitTestCircle(lo,Ds,vr,oe)&&(Vt=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Vt}}}}return{circles:!z&&Vt||!Bt?[]:Pe,offscreen:Xt,collisionDetected:Vt}},Ya.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var p=[],c=1/0,d=1/0,E=-1/0,w=-1/0,P=0,L=l;P<L.length;P+=1){var z=L[P],H=new g.Point(z.x+100,z.y+100);c=Math.min(c,H.x),d=Math.min(d,H.y),E=Math.max(E,H.x),w=Math.max(w,H.y),p.push(H)}for(var oe={},ue={},le=0,Pe=this.grid.query(c,d,E,w).concat(this.ignoredGrid.query(c,d,E,w));le<Pe.length;le+=1){var we=Pe[le],Ge=we.key;if(oe[Ge.bucketInstanceId]===void 0&&(oe[Ge.bucketInstanceId]={}),!oe[Ge.bucketInstanceId][Ge.featureIndex]){var Ce=[new g.Point(we.x1,we.y1),new g.Point(we.x2,we.y1),new g.Point(we.x2,we.y2),new g.Point(we.x1,we.y2)];g.polygonIntersectsPolygon(p,Ce)&&(oe[Ge.bucketInstanceId][Ge.featureIndex]=!0,ue[Ge.bucketInstanceId]===void 0&&(ue[Ge.bucketInstanceId]=[]),ue[Ge.bucketInstanceId].push(Ge.featureIndex))}}return ue},Ya.prototype.insertCollisionBox=function(l,p,c,d,E){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:E},l[0],l[1],l[2],l[3])},Ya.prototype.insertCollisionCircles=function(l,p,c,d,E){for(var w=p?this.ignoredGrid:this.grid,P={bucketInstanceId:c,featureIndex:d,collisionGroupID:E},L=0;L<l.length;L+=4)w.insertCircle(P,l[L],l[L+1],l[L+2])},Ya.prototype.projectAndGetPerspectiveRatio=function(l,p,c){var d=[p,c,0,1];return Aa(d,d,l),{point:new g.Point((d[0]/d[3]+1)/2*this.transform.width+100,(-d[1]/d[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}},Ya.prototype.isOffscreen=function(l,p,c,d){return c<100||l>=this.screenRightBoundary||d<100||p>this.screenBottomBoundary},Ya.prototype.isInsideGrid=function(l,p,c,d){return c>=0&&l<this.gridRightBoundary&&d>=0&&p<this.gridBottomBoundary},Ya.prototype.getViewportMatrix=function(){var l=g.identity([]);return g.translate(l,l,[-100,-100,0]),l};var Po=function(l,p,c,d){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?p:-p))):d&&c?1:0,this.placed=c};Po.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Wo=function(l,p,c,d,E){this.text=new Po(l?l.text:null,p,c,E),this.icon=new Po(l?l.icon:null,p,d,E)};Wo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Bu=function(l,p,c){this.text=l,this.icon=p,this.skipFade=c},ho=function(){this.invProjMatrix=g.create(),this.viewportMatrix=g.create(),this.circles=[]},Fo=function(l,p,c,d,E){this.bucketInstanceId=l,this.featureIndex=p,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=E},na=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function qa(l,p,c,d,E){var w=g.getAnchorAlignment(l),P=-(w.horizontalAlign-.5)*p,L=-(w.verticalAlign-.5)*c,z=g.evaluateVariableOffset(l,d);return new g.Point(P+z[0]*E,L+z[1]*E)}function Bo(l,p,c,d,E,w){var P=l.x1,L=l.x2,z=l.y1,H=l.y2,oe=l.anchorPointX,ue=l.anchorPointY,le=new g.Point(p,c);return d&&le._rotate(E?w:-w),{x1:P+le.x,y1:z+le.y,x2:L+le.x,y2:H+le.y,anchorPointX:oe,anchorPointY:ue}}na.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var p=++this.maxGroupID;this.collisionGroups[l]={ID:p,predicate:function(c){return c.collisionGroupID===p}}}return this.collisionGroups[l]};var Ka=function(l,p,c,d){this.transform=l.clone(),this.collisionIndex=new Ya(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new na(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}};function Rs(l,p,c,d,E){l.emplaceBack(p?1:0,c?1:0,d||0,E||0),l.emplaceBack(p?1:0,c?1:0,d||0,E||0),l.emplaceBack(p?1:0,c?1:0,d||0,E||0),l.emplaceBack(p?1:0,c?1:0,d||0,E||0)}Ka.prototype.getBucketParts=function(l,p,c,d){var E=c.getBucket(p),w=c.latestFeatureIndex;if(E&&w&&p.id===E.layerIds[0]){var P=c.collisionBoxArray,L=E.layers[0].layout,z=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),H=c.tileSize/g.EXTENT,oe=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),ue=L.get("text-pitch-alignment")==="map",le=L.get("text-rotation-alignment")==="map",Pe=ra(c,1,this.transform.zoom),we=Ca(oe,ue,le,this.transform,Pe),Ge=null;if(ue){var Ce=Ci(oe,ue,le,this.transform,Pe);Ge=g.multiply([],this.transform.labelPlaneMatrix,Ce)}this.retainedQueryData[E.bucketInstanceId]=new Fo(E.bucketInstanceId,w,E.sourceLayerIndex,E.index,c.tileID);var Ve={bucket:E,layout:L,posMatrix:oe,textLabelPlaneMatrix:we,labelToScreenMatrix:Ge,scale:z,textPixelRatio:H,holdingForFade:c.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:g.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(d)for(var $e=0,yt=E.sortKeyRanges;$e<yt.length;$e+=1){var Vt=yt[$e];l.push({sortKey:Vt.sortKey,symbolInstanceStart:Vt.symbolInstanceStart,symbolInstanceEnd:Vt.symbolInstanceEnd,parameters:Ve})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Ve})}},Ka.prototype.attemptAnchorPlacement=function(l,p,c,d,E,w,P,L,z,H,oe,ue,le,Pe,we){var Ge,Ce=[ue.textOffset0,ue.textOffset1],Ve=qa(l,c,d,Ce,E),$e=this.collisionIndex.placeCollisionBox(Bo(p,Ve.x,Ve.y,w,P,this.transform.angle),oe,L,z,H.predicate);if(!we||this.collisionIndex.placeCollisionBox(Bo(we,Ve.x,Ve.y,w,P,this.transform.angle),oe,L,z,H.predicate).box.length!==0)return $e.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[ue.crossTileID]&&this.prevPlacement.placements[ue.crossTileID]&&this.prevPlacement.placements[ue.crossTileID].text&&(Ge=this.prevPlacement.variableOffsets[ue.crossTileID].anchor),this.variableOffsets[ue.crossTileID]={textOffset:Ce,width:c,height:d,anchor:l,textBoxScale:E,prevAnchor:Ge},this.markUsedJustification(le,l,ue,Pe),le.allowVerticalPlacement&&(this.markUsedOrientation(le,Pe,ue),this.placedOrientations[ue.crossTileID]=Pe),{shift:Ve,placedGlyphBoxes:$e}):void 0},Ka.prototype.placeLayerBucketPart=function(l,p,c){var d=this,E=l.parameters,w=E.bucket,P=E.layout,L=E.posMatrix,z=E.textLabelPlaneMatrix,H=E.labelToScreenMatrix,oe=E.textPixelRatio,ue=E.holdingForFade,le=E.collisionBoxArray,Pe=E.partiallyEvaluatedTextSize,we=E.collisionGroup,Ge=P.get("text-optional"),Ce=P.get("icon-optional"),Ve=P.get("text-allow-overlap"),$e=P.get("icon-allow-overlap"),yt=P.get("text-rotation-alignment")==="map",Vt=P.get("text-pitch-alignment")==="map",Bt=P.get("icon-text-fit")!=="none",Xt=P.get("symbol-z-order")==="viewport-y",vr=Ve&&($e||!w.hasIconData()||Ce),Br=$e&&(Ve||!w.hasTextData()||Ge);!w.collisionArrays&&le&&w.deserializeCollisionBoxes(le);var Lr=function(un,Qn){if(!p[un.crossTileID])if(ue)d.placements[un.crossTileID]=new Bu(!1,!1,!1);else{var li,Jn=!1,Hn=!1,pi=!0,Kn=null,Wn={box:null,offscreen:null},go={box:null,offscreen:null},Va=null,No=null,zo=0,$a=0,lo=0;Qn.textFeatureIndex?zo=Qn.textFeatureIndex:un.useRuntimeCollisionCircles&&(zo=un.featureIndex),Qn.verticalTextFeatureIndex&&($a=Qn.verticalTextFeatureIndex);var Ds=Qn.textBox;if(Ds){var fs=function(ua){var eu=g.WritingMode.horizontal;if(w.allowVerticalPlacement&&!ua&&d.prevPlacement){var As=d.prevPlacement.placedOrientations[un.crossTileID];As&&(d.placedOrientations[un.crossTileID]=As,d.markUsedOrientation(w,eu=As,un))}return eu},Uo=function(ua,eu){if(w.allowVerticalPlacement&&un.numVerticalGlyphVertices>0&&Qn.verticalTextBox)for(var As=0,Yu=w.writingModes;As<Yu.length&&(Yu[As]===g.WritingMode.vertical?(Wn=eu(),go=Wn):Wn=ua(),!(Wn&&Wn.box&&Wn.box.length));As+=1);else Wn=ua()};if(P.get("text-variable-anchor")){var ps=P.get("text-variable-anchor");if(d.prevPlacement&&d.prevPlacement.variableOffsets[un.crossTileID]){var is=d.prevPlacement.variableOffsets[un.crossTileID];ps.indexOf(is.anchor)>0&&(ps=ps.filter(function(ua){return ua!==is.anchor})).unshift(is.anchor)}var Js=function(ua,eu,As){for(var Yu=ua.x2-ua.x1,Fs=ua.y2-ua.y1,df=un.textBoxScale,Yf=Bt&&!$e?eu:null,gu={box:[],offscreen:!1},Ou=Ve?2*ps.length:ps.length,Hs=0;Hs<Ou;++Hs){var Ru=d.attemptAnchorPlacement(ps[Hs%ps.length],ua,Yu,Fs,df,yt,Vt,oe,L,we,Hs>=ps.length,un,w,As,Yf);if(Ru&&(gu=Ru.placedGlyphBoxes)&&gu.box&&gu.box.length){Jn=!0,Kn=Ru.shift;break}}return gu};Uo(function(){return Js(Ds,Qn.iconBox,g.WritingMode.horizontal)},function(){var ua=Qn.verticalTextBox;return w.allowVerticalPlacement&&!(Wn&&Wn.box&&Wn.box.length)&&un.numVerticalGlyphVertices>0&&ua?Js(ua,Qn.verticalIconBox,g.WritingMode.vertical):{box:null,offscreen:null}}),Wn&&(Jn=Wn.box,pi=Wn.offscreen);var Pu=fs(Wn&&Wn.box);if(!Jn&&d.prevPlacement){var ol=d.prevPlacement.variableOffsets[un.crossTileID];ol&&(d.variableOffsets[un.crossTileID]=ol,d.markUsedJustification(w,ol.anchor,un,Pu))}}else{var Xu=function(ua,eu){var As=d.collisionIndex.placeCollisionBox(ua,Ve,oe,L,we.predicate);return As&&As.box&&As.box.length&&(d.markUsedOrientation(w,eu,un),d.placedOrientations[un.crossTileID]=eu),As};Uo(function(){return Xu(Ds,g.WritingMode.horizontal)},function(){var ua=Qn.verticalTextBox;return w.allowVerticalPlacement&&un.numVerticalGlyphVertices>0&&ua?Xu(ua,g.WritingMode.vertical):{box:null,offscreen:null}}),fs(Wn&&Wn.box&&Wn.box.length)}}if(Jn=(li=Wn)&&li.box&&li.box.length>0,pi=li&&li.offscreen,un.useRuntimeCollisionCircles){var Hl=w.text.placedSymbolArray.get(un.centerJustifiedTextSymbolIndex),dc=g.evaluateSizeForFeature(w.textSizeData,Pe,Hl),mu=P.get("text-padding");Va=d.collisionIndex.placeCollisionCircles(Ve,Hl,w.lineVertexArray,w.glyphOffsetArray,dc,L,z,H,c,Vt,we.predicate,un.collisionCircleDiameter,mu),Jn=Ve||Va.circles.length>0&&!Va.collisionDetected,pi=pi&&Va.offscreen}if(Qn.iconFeatureIndex&&(lo=Qn.iconFeatureIndex),Qn.iconBox){var Qa=function(ua){var eu=Bt&&Kn?Bo(ua,Kn.x,Kn.y,yt,Vt,d.transform.angle):ua;return d.collisionIndex.placeCollisionBox(eu,$e,oe,L,we.predicate)};Hn=go&&go.box&&go.box.length&&Qn.verticalIconBox?(No=Qa(Qn.verticalIconBox)).box.length>0:(No=Qa(Qn.iconBox)).box.length>0,pi=pi&&No.offscreen}var Ta=Ge||un.numHorizontalGlyphVertices===0&&un.numVerticalGlyphVertices===0,no=Ce||un.numIconVertices===0;if(Ta||no?no?Ta||(Hn=Hn&&Jn):Jn=Hn&&Jn:Hn=Jn=Hn&&Jn,Jn&&li&&li.box&&d.collisionIndex.insertCollisionBox(li.box,P.get("text-ignore-placement"),w.bucketInstanceId,go&&go.box&&$a?$a:zo,we.ID),Hn&&No&&d.collisionIndex.insertCollisionBox(No.box,P.get("icon-ignore-placement"),w.bucketInstanceId,lo,we.ID),Va&&(Jn&&d.collisionIndex.insertCollisionCircles(Va.circles,P.get("text-ignore-placement"),w.bucketInstanceId,zo,we.ID),c)){var Iu=w.bucketInstanceId,Gs=d.collisionCircleArrays[Iu];Gs===void 0&&(Gs=d.collisionCircleArrays[Iu]=new ho);for(var El=0;El<Va.circles.length;El+=4)Gs.circles.push(Va.circles[El+0]),Gs.circles.push(Va.circles[El+1]),Gs.circles.push(Va.circles[El+2]),Gs.circles.push(Va.collisionDetected?1:0)}d.placements[un.crossTileID]=new Bu(Jn||vr,Hn||Br,pi||w.justReloaded),p[un.crossTileID]=!0}};if(Xt)for(var jr=w.getSortedSymbolIndexes(this.transform.angle),Fn=jr.length-1;Fn>=0;--Fn){var On=jr[Fn];Lr(w.symbolInstances.get(On),w.collisionArrays[On])}else for(var Zn=l.symbolInstanceStart;Zn<l.symbolInstanceEnd;Zn++)Lr(w.symbolInstances.get(Zn),w.collisionArrays[Zn]);if(c&&w.bucketInstanceId in this.collisionCircleArrays){var Oi=this.collisionCircleArrays[w.bucketInstanceId];g.invert(Oi.invProjMatrix,L),Oi.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1},Ka.prototype.markUsedJustification=function(l,p,c,d){var E;E=d===g.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[g.getAnchorJustification(p)];for(var w=0,P=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];w<P.length;w+=1){var L=P[w];L>=0&&(l.text.placedSymbolArray.get(L).crossTileID=E>=0&&L!==E?0:c.crossTileID)}},Ka.prototype.markUsedOrientation=function(l,p,c){for(var d=p===g.WritingMode.horizontal||p===g.WritingMode.horizontalOnly?p:0,E=p===g.WritingMode.vertical?p:0,w=0,P=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];w<P.length;w+=1)l.text.placedSymbolArray.get(P[w]).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=E)},Ka.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var p=this.prevPlacement,c=!1;this.prevZoomAdjustment=p?p.zoomAdjustment(this.transform.zoom):0;var d=p?p.symbolFadeChange(l):1,E=p?p.opacities:{},w=p?p.variableOffsets:{},P=p?p.placedOrientations:{};for(var L in this.placements){var z=this.placements[L],H=E[L];H?(this.opacities[L]=new Wo(H,d,z.text,z.icon),c=c||z.text!==H.text.placed||z.icon!==H.icon.placed):(this.opacities[L]=new Wo(null,d,z.text,z.icon,z.skipFade),c=c||z.text||z.icon)}for(var oe in E){var ue=E[oe];if(!this.opacities[oe]){var le=new Wo(ue,d,!1,!1);le.isHidden()||(this.opacities[oe]=le,c=c||ue.text.placed||ue.icon.placed)}}for(var Pe in w)this.variableOffsets[Pe]||!this.opacities[Pe]||this.opacities[Pe].isHidden()||(this.variableOffsets[Pe]=w[Pe]);for(var we in P)this.placedOrientations[we]||!this.opacities[we]||this.opacities[we].isHidden()||(this.placedOrientations[we]=P[we]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=p?p.lastPlacementChangeTime:l)},Ka.prototype.updateLayerOpacities=function(l,p){for(var c={},d=0,E=p;d<E.length;d+=1){var w=E[d],P=w.getBucket(l);P&&w.latestFeatureIndex&&l.id===P.layerIds[0]&&this.updateBucketOpacities(P,c,w.collisionBoxArray)}},Ka.prototype.updateBucketOpacities=function(l,p,c){var d=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var E=l.layers[0].layout,w=new Wo(null,0,!1,!1,!0),P=E.get("text-allow-overlap"),L=E.get("icon-allow-overlap"),z=E.get("text-variable-anchor"),H=E.get("text-rotation-alignment")==="map",oe=E.get("text-pitch-alignment")==="map",ue=E.get("icon-text-fit")!=="none",le=new Wo(null,0,P&&(L||!l.hasIconData()||E.get("icon-optional")),L&&(P||!l.hasTextData()||E.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var Pe=function(Ve,$e,yt){for(var Vt=0;Vt<$e/4;Vt++)Ve.opacityVertexArray.emplaceBack(yt)},we=function(Ve){var $e=l.symbolInstances.get(Ve),yt=$e.numHorizontalGlyphVertices,Vt=$e.numVerticalGlyphVertices,Bt=$e.crossTileID,Xt=d.opacities[Bt];p[Bt]?Xt=w:Xt||(d.opacities[Bt]=Xt=le),p[Bt]=!0;var vr=$e.numIconVertices>0,Br=d.placedOrientations[$e.crossTileID],Lr=Br===g.WritingMode.vertical,jr=Br===g.WritingMode.horizontal||Br===g.WritingMode.horizontalOnly;if(yt>0||Vt>0){var Fn=Pn(Xt.text);Pe(l.text,yt,Lr?Ti:Fn),Pe(l.text,Vt,jr?Ti:Fn);var On=Xt.text.isHidden();[$e.rightJustifiedTextSymbolIndex,$e.centerJustifiedTextSymbolIndex,$e.leftJustifiedTextSymbolIndex].forEach(function(Wn){Wn>=0&&(l.text.placedSymbolArray.get(Wn).hidden=On||Lr?1:0)}),$e.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get($e.verticalPlacedTextSymbolIndex).hidden=On||jr?1:0);var Zn=d.variableOffsets[$e.crossTileID];Zn&&d.markUsedJustification(l,Zn.anchor,$e,Br);var Oi=d.placedOrientations[$e.crossTileID];Oi&&(d.markUsedJustification(l,"left",$e,Oi),d.markUsedOrientation(l,Oi,$e))}if(vr){var un=Pn(Xt.icon),Qn=!(ue&&$e.verticalPlacedIconSymbolIndex&&Lr);$e.placedIconSymbolIndex>=0&&(Pe(l.icon,$e.numIconVertices,Qn?un:Ti),l.icon.placedSymbolArray.get($e.placedIconSymbolIndex).hidden=Xt.icon.isHidden()),$e.verticalPlacedIconSymbolIndex>=0&&(Pe(l.icon,$e.numVerticalIconVertices,Qn?Ti:un),l.icon.placedSymbolArray.get($e.verticalPlacedIconSymbolIndex).hidden=Xt.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var li=l.collisionArrays[Ve];if(li){var Jn=new g.Point(0,0);if(li.textBox||li.verticalTextBox){var Hn=!0;if(z){var pi=d.variableOffsets[Bt];pi?(Jn=qa(pi.anchor,pi.width,pi.height,pi.textOffset,pi.textBoxScale),H&&Jn._rotate(oe?d.transform.angle:-d.transform.angle)):Hn=!1}li.textBox&&Rs(l.textCollisionBox.collisionVertexArray,Xt.text.placed,!Hn||Lr,Jn.x,Jn.y),li.verticalTextBox&&Rs(l.textCollisionBox.collisionVertexArray,Xt.text.placed,!Hn||jr,Jn.x,Jn.y)}var Kn=Boolean(!jr&&li.verticalIconBox);li.iconBox&&Rs(l.iconCollisionBox.collisionVertexArray,Xt.icon.placed,Kn,ue?Jn.x:0,ue?Jn.y:0),li.verticalIconBox&&Rs(l.iconCollisionBox.collisionVertexArray,Xt.icon.placed,!Kn,ue?Jn.x:0,ue?Jn.y:0)}}},Ge=0;Ge<l.symbolInstances.length;Ge++)we(Ge);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var Ce=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Ce.invProjMatrix,l.placementViewportMatrix=Ce.viewportMatrix,l.collisionCircleArray=Ce.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},Ka.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Ka.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},Ka.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},Ka.prototype.stillRecent=function(l,p){var c=this.zoomAtLastRecencyCheck===p?1-this.zoomAdjustment(p):1;return this.zoomAtLastRecencyCheck=p,this.commitTime+this.fadeDuration*c>l},Ka.prototype.setStale=function(){this.stale=!0};var Il=Math.pow(2,25),ys=Math.pow(2,24),J=Math.pow(2,17),ge=Math.pow(2,16),Xe=Math.pow(2,9),Pt=Math.pow(2,8),Or=Math.pow(2,1);function Pn(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var p=l.placed?1:0,c=Math.floor(127*l.opacity);return c*Il+p*ys+c*J+p*ge+c*Xe+p*Pt+c*Or+p}var Ti=0,ro=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};ro.prototype.continuePlacement=function(l,p,c,d,E){for(var w=this._bucketParts;this._currentTileIndex<l.length;)if(p.getBucketParts(w,d,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(function(P,L){return P.sortKey-L.sortKey}));this._currentPartIndex<w.length;)if(p.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,E())return!0;return!1};var Ra=function(l,p,c,d,E,w,P){this.placement=new Ka(l,E,w,P),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1};Ra.prototype.isDone=function(){return this._done},Ra.prototype.continuePlacement=function(l,p,c){for(var d=this,E=g.browser.now(),w=function(){var z=g.browser.now()-E;return!d._forceFullPlacement&&z>2};this._currentPlacementIndex>=0;){var P=p[l[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=L)&&(!P.maxzoom||P.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new ro(P)),this._inProgressLayer.continuePlacement(c[P.source],this.placement,this._showCollisionBoxes,P,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Ra.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Ua=512/g.EXTENT/2,Xo=function(l,p,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var d=0;d<p.length;d++){var E=p.get(d),w=E.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,l)})}};Xo.prototype.getScaledCoordinates=function(l,p){var c=Ua/Math.pow(2,p.canonical.z-this.tileID.canonical.z);return{x:Math.floor((p.canonical.x*g.EXTENT+l.anchorX)*c),y:Math.floor((p.canonical.y*g.EXTENT+l.anchorY)*c)}},Xo.prototype.findMatches=function(l,p,c){for(var d=this.tileID.canonical.z<p.canonical.z?1:Math.pow(2,this.tileID.canonical.z-p.canonical.z),E=0;E<l.length;E++){var w=l.get(E);if(!w.crossTileID){var P=this.indexedSymbolInstances[w.key];if(P)for(var L=this.getScaledCoordinates(w,p),z=0,H=P;z<H.length;z+=1){var oe=H[z];if(Math.abs(oe.coord.x-L.x)<=d&&Math.abs(oe.coord.y-L.y)<=d&&!c[oe.crossTileID]){c[oe.crossTileID]=!0,w.crossTileID=oe.crossTileID;break}}}}};var _s=function(){this.maxCrossTileID=0};_s.prototype.generate=function(){return++this.maxCrossTileID};var oo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};oo.prototype.handleWrapJump=function(l){var p=Math.round((l-this.lng)/360);if(p!==0)for(var c in this.indexes){var d=this.indexes[c],E={};for(var w in d){var P=d[w];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+p),E[P.tileID.key]=P}this.indexes[c]=E}this.lng=l},oo.prototype.addBucket=function(l,p,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===p.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var d=0;d<p.symbolInstances.length;d++)p.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var E=this.usedCrossTileIDs[l.overscaledZ];for(var w in this.indexes){var P=this.indexes[w];if(Number(w)>l.overscaledZ)for(var L in P){var z=P[L];z.tileID.isChildOf(l)&&z.findMatches(p.symbolInstances,l,E)}else{var H=P[l.scaledTo(Number(w)).key];H&&H.findMatches(p.symbolInstances,l,E)}}for(var oe=0;oe<p.symbolInstances.length;oe++){var ue=p.symbolInstances.get(oe);ue.crossTileID||(ue.crossTileID=c.generate(),E[ue.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Xo(l,p.symbolInstances,p.bucketInstanceId),!0},oo.prototype.removeBucketCrossTileIDs=function(l,p){for(var c in p.indexedSymbolInstances)for(var d=0,E=p.indexedSymbolInstances[c];d<E.length;d+=1)delete this.usedCrossTileIDs[l][E[d].crossTileID]},oo.prototype.removeStaleBuckets=function(l){var p=!1;for(var c in this.indexes){var d=this.indexes[c];for(var E in d)l[d[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[E]),delete d[E],p=!0)}return p};var Io=function(){this.layerIndexes={},this.crossTileIDs=new _s,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Io.prototype.addLayer=function(l,p,c){var d=this.layerIndexes[l.id];d===void 0&&(d=this.layerIndexes[l.id]=new oo);var E=!1,w={};d.handleWrapJump(c);for(var P=0,L=p;P<L.length;P+=1){var z=L[P],H=z.getBucket(l);H&&l.id===H.layerIds[0]&&(H.bucketInstanceId||(H.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(z.tileID,H,this.crossTileIDs)&&(E=!0),w[H.bucketInstanceId]=!0)}return d.removeStaleBuckets(w)&&(E=!0),E},Io.prototype.pruneUnusedLayers=function(l){var p={};for(var c in l.forEach(function(d){p[d]=!0}),this.layerIndexes)p[c]||delete this.layerIndexes[c]};var xs=function(l,p){return g.emitValidationErrors(l,p&&p.filter(function(c){return c.identifier!=="source.canvas"}))},Ls=g.pick(Xr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),zs=g.pick(Xr,["setCenter","setZoom","setBearing","setPitch"]),ou=function(){var l={},p=g.styleSpec.$version;for(var c in g.styleSpec.$root){var d,E=g.styleSpec.$root[c];E.required&&(d=c==="version"?p:E.type==="array"?[]:{})!=null&&(l[c]=d)}return l}(),bs=function(l){function p(c,d){var E=this;d===void 0&&(d={}),l.call(this),this.map=c,this.dispatcher=new qt(Mt(),this),this.imageManager=new Lt,this.imageManager.setEventedParent(this),this.glyphManager=new Yt(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new et(256,512),this.crossTileSymbolIndex=new Io,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new g.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",g.getReferrer());var w=this;this._rtlTextPluginCallback=p.registerForPluginStateChange(function(P){w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:P.pluginStatus,pluginURL:P.pluginURL},function(L,z){if(g.triggerPluginCompletionEvent(L),z&&z.every(function(oe){return oe}))for(var H in w.sourceCaches)w.sourceCaches[H].reload()})}),this.on("data",function(P){if(P.dataType==="source"&&P.sourceDataType==="metadata"){var L=E.sourceCaches[P.sourceId];if(L){var z=L.getSource();if(z&&z.vectorLayerIds)for(var H in E._layers){var oe=E._layers[H];oe.source===z.id&&E._validateLayer(oe)}}}})}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.loadURL=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new g.Event("dataloading",{dataType:"style"}));var w=typeof d.validate=="boolean"?d.validate:!g.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);var P=this.map._requestManager.transformRequest(c,g.ResourceType.Style);this._request=g.getJSON(P,function(L,z){E._request=null,L?E.fire(new g.ErrorEvent(L)):z&&E._load(z,w)})},p.prototype.loadJSON=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new g.Event("dataloading",{dataType:"style"})),this._request=g.browser.frame(function(){E._request=null,E._load(c,d.validate!==!1)})},p.prototype.loadEmpty=function(){this.fire(new g.Event("dataloading",{dataType:"style"})),this._load(ou,!1)},p.prototype._load=function(c,d){if(!d||!xs(this,g.validateStyle(c))){for(var E in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(E,c.sources[E],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var w=Ur(this.stylesheet.layers);this._order=w.map(function(H){return H.id}),this._layers={},this._serializedLayers={};for(var P=0,L=w;P<L.length;P+=1){var z=L[P];(z=g.createStyleLayer(z)).setEventedParent(this,{layer:{id:z.id}}),this._layers[z.id]=z,this._serializedLayers[z.id]=z.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new wt(this.stylesheet.light),this.fire(new g.Event("data",{dataType:"style"})),this.fire(new g.Event("style.load"))}},p.prototype._loadSprite=function(c){var d=this;this._spriteRequest=function(E,w,P){var L,z,H,oe=g.browser.devicePixelRatio>1?"@2x":"",ue=g.getJSON(w.transformRequest(w.normalizeSpriteURL(E,oe,".json"),g.ResourceType.SpriteJSON),function(we,Ge){ue=null,H||(H=we,L=Ge,Pe())}),le=g.getImage(w.transformRequest(w.normalizeSpriteURL(E,oe,".png"),g.ResourceType.SpriteImage),function(we,Ge){le=null,H||(H=we,z=Ge,Pe())});function Pe(){if(H)P(H);else if(L&&z){var we=g.browser.getImageData(z),Ge={};for(var Ce in L){var Ve=L[Ce],$e=Ve.width,yt=Ve.height,Vt=Ve.x,Bt=Ve.y,Xt=Ve.sdf,vr=Ve.pixelRatio,Br=Ve.stretchX,Lr=Ve.stretchY,jr=Ve.content,Fn=new g.RGBAImage({width:$e,height:yt});g.RGBAImage.copy(we,Fn,{x:Vt,y:Bt},{x:0,y:0},{width:$e,height:yt}),Ge[Ce]={data:Fn,pixelRatio:vr,sdf:Xt,stretchX:Br,stretchY:Lr,content:jr}}P(null,Ge)}}return{cancel:function(){ue&&(ue.cancel(),ue=null),le&&(le.cancel(),le=null)}}}(c,this.map._requestManager,function(E,w){if(d._spriteRequest=null,E)d.fire(new g.ErrorEvent(E));else if(w)for(var P in w)d.imageManager.addImage(P,w[P]);d.imageManager.setLoaded(!0),d._availableImages=d.imageManager.listImages(),d.dispatcher.broadcast("setImages",d._availableImages),d.fire(new g.Event("data",{dataType:"style"}))})},p.prototype._validateLayer=function(c){var d=this.sourceCaches[c.source];if(d){var E=c.sourceLayer;if(E){var w=d.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(E)===-1)&&this.fire(new g.ErrorEvent(new Error('Source layer "'+E+'" does not exist on source "'+w.id+'" as specified by style layer "'+c.id+'"')))}}},p.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},p.prototype._serializeLayers=function(c){for(var d=[],E=0,w=c;E<w.length;E+=1){var P=this._layers[w[E]];P.type!=="custom"&&d.push(P.serialize())}return d},p.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var d in this._layers)if(this._layers[d].hasTransition())return!0;return!1},p.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},p.prototype.update=function(c){if(this._loaded){var d=this._changed;if(this._changed){var E=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);for(var P in(E.length||w.length)&&this._updateWorkerLayers(E,w),this._updatedSources){var L=this._updatedSources[P];L==="reload"?this._reloadSource(P):L==="clear"&&this._clearSource(P)}for(var z in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[z].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var H={};for(var oe in this.sourceCaches){var ue=this.sourceCaches[oe];H[oe]=ue.used,ue.used=!1}for(var le=0,Pe=this._order;le<Pe.length;le+=1){var we=this._layers[Pe[le]];we.recalculate(c,this._availableImages),!we.isHidden(c.zoom)&&we.source&&(this.sourceCaches[we.source].used=!0)}for(var Ge in H){var Ce=this.sourceCaches[Ge];H[Ge]!==Ce.used&&Ce.fire(new g.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Ge}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new g.Event("data",{dataType:"style"}))}},p.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},p.prototype._updateWorkerLayers=function(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})},p.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},p.prototype.setState=function(c){var d=this;if(this._checkLoaded(),xs(this,g.validateStyle(c)))return!1;(c=g.clone$1(c)).layers=Ur(c.layers);var E=function(P,L){if(!P)return[{command:Xr.setStyle,args:[L]}];var z=[];try{if(!g.deepEqual(P.version,L.version))return[{command:Xr.setStyle,args:[L]}];g.deepEqual(P.center,L.center)||z.push({command:Xr.setCenter,args:[L.center]}),g.deepEqual(P.zoom,L.zoom)||z.push({command:Xr.setZoom,args:[L.zoom]}),g.deepEqual(P.bearing,L.bearing)||z.push({command:Xr.setBearing,args:[L.bearing]}),g.deepEqual(P.pitch,L.pitch)||z.push({command:Xr.setPitch,args:[L.pitch]}),g.deepEqual(P.sprite,L.sprite)||z.push({command:Xr.setSprite,args:[L.sprite]}),g.deepEqual(P.glyphs,L.glyphs)||z.push({command:Xr.setGlyphs,args:[L.glyphs]}),g.deepEqual(P.transition,L.transition)||z.push({command:Xr.setTransition,args:[L.transition]}),g.deepEqual(P.light,L.light)||z.push({command:Xr.setLight,args:[L.light]});var H={},oe=[];(function(le,Pe,we,Ge){var Ce;for(Ce in Pe=Pe||{},le=le||{})le.hasOwnProperty(Ce)&&(Pe.hasOwnProperty(Ce)||rn(Ce,we,Ge));for(Ce in Pe)Pe.hasOwnProperty(Ce)&&(le.hasOwnProperty(Ce)?g.deepEqual(le[Ce],Pe[Ce])||(le[Ce].type==="geojson"&&Pe[Ce].type==="geojson"&&ji(le,Pe,Ce)?we.push({command:Xr.setGeoJSONSourceData,args:[Ce,Pe[Ce].data]}):nn(Ce,Pe,we,Ge)):vi(Ce,Pe,we))})(P.sources,L.sources,oe,H);var ue=[];P.layers&&P.layers.forEach(function(le){H[le.source]?z.push({command:Xr.removeLayer,args:[le.id]}):ue.push(le)}),z=z.concat(oe),function(le,Pe,we){Pe=Pe||[];var Ge,Ce,Ve,$e,yt,Vt,Bt,Xt=(le=le||[]).map(Ai),vr=Pe.map(Ai),Br=le.reduce(_i,{}),Lr=Pe.reduce(_i,{}),jr=Xt.slice(),Fn=Object.create(null);for(Ge=0,Ce=0;Ge<Xt.length;Ge++)Lr.hasOwnProperty(Ve=Xt[Ge])?Ce++:(we.push({command:Xr.removeLayer,args:[Ve]}),jr.splice(jr.indexOf(Ve,Ce),1));for(Ge=0,Ce=0;Ge<vr.length;Ge++)jr[jr.length-1-Ge]!==(Ve=vr[vr.length-1-Ge])&&(Br.hasOwnProperty(Ve)?(we.push({command:Xr.removeLayer,args:[Ve]}),jr.splice(jr.lastIndexOf(Ve,jr.length-Ce),1)):Ce++,we.push({command:Xr.addLayer,args:[Lr[Ve],Vt=jr[jr.length-Ge]]}),jr.splice(jr.length-Ge,0,Ve),Fn[Ve]=!0);for(Ge=0;Ge<vr.length;Ge++)if($e=Br[Ve=vr[Ge]],yt=Lr[Ve],!Fn[Ve]&&!g.deepEqual($e,yt))if(g.deepEqual($e.source,yt.source)&&g.deepEqual($e["source-layer"],yt["source-layer"])&&g.deepEqual($e.type,yt.type)){for(Bt in fi($e.layout,yt.layout,we,Ve,null,Xr.setLayoutProperty),fi($e.paint,yt.paint,we,Ve,null,Xr.setPaintProperty),g.deepEqual($e.filter,yt.filter)||we.push({command:Xr.setFilter,args:[Ve,yt.filter]}),g.deepEqual($e.minzoom,yt.minzoom)&&g.deepEqual($e.maxzoom,yt.maxzoom)||we.push({command:Xr.setLayerZoomRange,args:[Ve,yt.minzoom,yt.maxzoom]}),$e)$e.hasOwnProperty(Bt)&&Bt!=="layout"&&Bt!=="paint"&&Bt!=="filter"&&Bt!=="metadata"&&Bt!=="minzoom"&&Bt!=="maxzoom"&&(Bt.indexOf("paint.")===0?fi($e[Bt],yt[Bt],we,Ve,Bt.slice(6),Xr.setPaintProperty):g.deepEqual($e[Bt],yt[Bt])||we.push({command:Xr.setLayerProperty,args:[Ve,Bt,yt[Bt]]}));for(Bt in yt)yt.hasOwnProperty(Bt)&&!$e.hasOwnProperty(Bt)&&Bt!=="layout"&&Bt!=="paint"&&Bt!=="filter"&&Bt!=="metadata"&&Bt!=="minzoom"&&Bt!=="maxzoom"&&(Bt.indexOf("paint.")===0?fi($e[Bt],yt[Bt],we,Ve,Bt.slice(6),Xr.setPaintProperty):g.deepEqual($e[Bt],yt[Bt])||we.push({command:Xr.setLayerProperty,args:[Ve,Bt,yt[Bt]]}))}else we.push({command:Xr.removeLayer,args:[Ve]}),Vt=jr[jr.lastIndexOf(Ve)+1],we.push({command:Xr.addLayer,args:[yt,Vt]})}(ue,L.layers,z)}catch(le){console.warn("Unable to compute style diff:",le),z=[{command:Xr.setStyle,args:[L]}]}return z}(this.serialize(),c).filter(function(P){return!(P.command in zs)});if(E.length===0)return!1;var w=E.filter(function(P){return!(P.command in Ls)});if(w.length>0)throw new Error("Unimplemented: "+w.map(function(P){return P.command}).join(", ")+".");return E.forEach(function(P){P.command!=="setTransition"&&d[P.command].apply(d,P.args)}),this.stylesheet=c,!0},p.prototype.addImage=function(c,d){if(this.getImage(c))return this.fire(new g.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,d),this._afterImageUpdated(c)},p.prototype.updateImage=function(c,d){this.imageManager.updateImage(c,d)},p.prototype.getImage=function(c){return this.imageManager.getImage(c)},p.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new g.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},p.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new g.Event("data",{dataType:"style"}))},p.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},p.prototype.addSource=function(c,d,E){var w=this;if(E===void 0&&(E={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(d).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(g.validateStyle.source,"sources."+c,d,null,E))){this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);var P=this.sourceCaches[c]=new Le(c,d,this.dispatcher);P.style=this,P.setEventedParent(this,function(){return{isSourceLoaded:w.loaded(),source:P.serialize(),sourceId:c}}),P.onAdd(this.map),this._changed=!0}},p.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var d in this._layers)if(this._layers[d].source===c)return this.fire(new g.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+d+'" is using it.')));var E=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],E.fire(new g.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),E.setEventedParent(null),E.clearTiles(),E.onRemove&&E.onRemove(this.map),this._changed=!0},p.prototype.setGeoJSONSourceData=function(c,d){this._checkLoaded(),this.sourceCaches[c].getSource().setData(d),this._changed=!0},p.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},p.prototype.addLayer=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var w=c.id;if(this.getLayer(w))this.fire(new g.ErrorEvent(new Error('Layer with id "'+w+'" already exists on this map')));else{var P;if(c.type==="custom"){if(xs(this,g.validateCustomStyleLayer(c)))return;P=g.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(w,c.source),c=g.clone$1(c),c=g.extend(c,{source:w})),this._validate(g.validateStyle.layer,"layers."+w,c,{arrayIndex:-1},E))return;P=g.createStyleLayer(c),this._validateLayer(P),P.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[P.id]=P.serialize()}var L=d?this._order.indexOf(d):this._order.length;if(d&&L===-1)this.fire(new g.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.')));else{if(this._order.splice(L,0,w),this._layerOrderChanged=!0,this._layers[w]=P,this._removedLayers[w]&&P.source&&P.type!=="custom"){var z=this._removedLayers[w];delete this._removedLayers[w],z.type!==P.type?this._updatedSources[P.source]="clear":(this._updatedSources[P.source]="reload",this.sourceCaches[P.source].pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map)}}},p.prototype.moveLayer=function(c,d){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==d){var E=this._order.indexOf(c);this._order.splice(E,1);var w=d?this._order.indexOf(d):this._order.length;d&&w===-1?this.fire(new g.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.'))):(this._order.splice(w,0,c),this._layerOrderChanged=!0)}}else this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},p.prototype.removeLayer=function(c){this._checkLoaded();var d=this._layers[c];if(d){d.setEventedParent(null);var E=this._order.indexOf(c);this._order.splice(E,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}else this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},p.prototype.getLayer=function(c){return this._layers[c]},p.prototype.hasLayer=function(c){return c in this._layers},p.prototype.setLayerZoomRange=function(c,d,E){this._checkLoaded();var w=this.getLayer(c);w?w.minzoom===d&&w.maxzoom===E||(d!=null&&(w.minzoom=d),E!=null&&(w.maxzoom=E),this._updateLayer(w)):this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},p.prototype.setFilter=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var w=this.getLayer(c);if(w){if(!g.deepEqual(w.filter,d))return d==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(g.validateStyle.filter,"layers."+w.id+".filter",d,null,E)||(w.filter=g.clone$1(d),this._updateLayer(w)))}else this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},p.prototype.getFilter=function(c){return g.clone$1(this.getLayer(c).filter)},p.prototype.setLayoutProperty=function(c,d,E,w){w===void 0&&(w={}),this._checkLoaded();var P=this.getLayer(c);P?g.deepEqual(P.getLayoutProperty(d),E)||(P.setLayoutProperty(d,E,w),this._updateLayer(P)):this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},p.prototype.getLayoutProperty=function(c,d){var E=this.getLayer(c);if(E)return E.getLayoutProperty(d);this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},p.prototype.setPaintProperty=function(c,d,E,w){w===void 0&&(w={}),this._checkLoaded();var P=this.getLayer(c);P?g.deepEqual(P.getPaintProperty(d),E)||(P.setPaintProperty(d,E,w)&&this._updateLayer(P),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new g.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},p.prototype.getPaintProperty=function(c,d){return this.getLayer(c).getPaintProperty(d)},p.prototype.setFeatureState=function(c,d){this._checkLoaded();var E=c.source,w=c.sourceLayer,P=this.sourceCaches[E];if(P!==void 0){var L=P.getSource().type;L==="geojson"&&w?this.fire(new g.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):L!=="vector"||w?(c.id===void 0&&this.fire(new g.ErrorEvent(new Error("The feature id parameter must be provided."))),P.setFeatureState(w,c.id,d)):this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new g.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},p.prototype.removeFeatureState=function(c,d){this._checkLoaded();var E=c.source,w=this.sourceCaches[E];if(w!==void 0){var P=w.getSource().type,L=P==="vector"?c.sourceLayer:void 0;P!=="vector"||L?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new g.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(L,c.id,d):this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new g.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},p.prototype.getFeatureState=function(c){this._checkLoaded();var d=c.source,E=c.sourceLayer,w=this.sourceCaches[d];if(w!==void 0){if(w.getSource().type!=="vector"||E)return c.id===void 0&&this.fire(new g.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(E,c.id);this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new g.ErrorEvent(new Error("The source '"+d+"' does not exist in the map's style.")))},p.prototype.getTransition=function(){return g.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},p.prototype.serialize=function(){return g.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:g.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},p.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},p.prototype._flattenAndSortRenderedFeatures=function(c){for(var d=this,E=function(Br){return d._layers[Br].type==="fill-extrusion"},w={},P=[],L=this._order.length-1;L>=0;L--){var z=this._order[L];if(E(z)){w[z]=L;for(var H=0,oe=c;H<oe.length;H+=1){var ue=oe[H][z];if(ue)for(var le=0,Pe=ue;le<Pe.length;le+=1)P.push(Pe[le])}}}P.sort(function(Br,Lr){return Lr.intersectionZ-Br.intersectionZ});for(var we=[],Ge=this._order.length-1;Ge>=0;Ge--){var Ce=this._order[Ge];if(E(Ce))for(var Ve=P.length-1;Ve>=0;Ve--){var $e=P[Ve].feature;if(w[$e.layer.id]<Ge)break;we.push($e),P.pop()}else for(var yt=0,Vt=c;yt<Vt.length;yt+=1){var Bt=Vt[yt][Ce];if(Bt)for(var Xt=0,vr=Bt;Xt<vr.length;Xt+=1)we.push(vr[Xt].feature)}}return we},p.prototype.queryRenderedFeatures=function(c,d,E){d&&d.filter&&this._validate(g.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);var w={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new g.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var P=0,L=d.layers;P<L.length;P+=1){var z=L[P],H=this._layers[z];if(!H)return this.fire(new g.ErrorEvent(new Error("The layer '"+z+"' does not exist in the map's style and cannot be queried for features."))),[];w[H.source]=!0}}var oe=[];for(var ue in d.availableImages=this._availableImages,this.sourceCaches)d.layers&&!w[ue]||oe.push(_n(this.sourceCaches[ue],this._layers,this._serializedLayers,c,d,E));return this.placement&&oe.push(function(le,Pe,we,Ge,Ce,Ve,$e){for(var yt={},Vt=Ve.queryRenderedSymbols(Ge),Bt=[],Xt=0,vr=Object.keys(Vt).map(Number);Xt<vr.length;Xt+=1)Bt.push($e[vr[Xt]]);Bt.sort(mi);for(var Br=function(){var Zn=jr[Lr],Oi=Zn.featureIndex.lookupSymbolFeatures(Vt[Zn.bucketInstanceId],Pe,Zn.bucketIndex,Zn.sourceLayerIndex,Ce.filter,Ce.layers,Ce.availableImages,le);for(var un in Oi){var Qn=yt[un]=yt[un]||[],li=Oi[un];li.sort(function(pi,Kn){var Wn=Zn.featureSortOrder;if(Wn){var go=Wn.indexOf(pi.featureIndex);return Wn.indexOf(Kn.featureIndex)-go}return Kn.featureIndex-pi.featureIndex});for(var Jn=0,Hn=li;Jn<Hn.length;Jn+=1)Qn.push(Hn[Jn])}},Lr=0,jr=Bt;Lr<jr.length;Lr+=1)Br();var Fn=function(Zn){yt[Zn].forEach(function(Oi){var un=Oi.feature,Qn=we[le[Zn].source].getFeatureState(un.layer["source-layer"],un.id);un.source=un.layer.source,un.layer["source-layer"]&&(un.sourceLayer=un.layer["source-layer"]),un.state=Qn})};for(var On in yt)Fn(On);return yt}(this._layers,this._serializedLayers,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(oe)},p.prototype.querySourceFeatures=function(c,d){d&&d.filter&&this._validate(g.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);var E=this.sourceCaches[c];return E?function(w,P){for(var L=w.getRenderableIds().map(function(Pe){return w.getTileByID(Pe)}),z=[],H={},oe=0;oe<L.length;oe++){var ue=L[oe],le=ue.tileID.canonical.key;H[le]||(H[le]=!0,ue.querySourceFeatures(z,P))}return z}(E,d):[]},p.prototype.addSourceType=function(c,d,E){return p.getSourceType(c)?E(new Error('A source type called "'+c+'" already exists.')):(p.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},E):E(null,null))},p.prototype.getLight=function(){return this.light.getLight()},p.prototype.setLight=function(c,d){d===void 0&&(d={}),this._checkLoaded();var E=this.light.getLight(),w=!1;for(var P in c)if(!g.deepEqual(c[P],E[P])){w=!0;break}if(w){var L={now:g.browser.now(),transition:g.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(L)}},p.prototype._validate=function(c,d,E,w,P){return P===void 0&&(P={}),(!P||P.validate!==!1)&&xs(this,c.call(g.validateStyle,g.extend({key:d,style:this.serialize(),value:E,styleSpec:g.styleSpec},w)))},p.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),g.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var d in this.sourceCaches)this.sourceCaches[d].clearTiles(),this.sourceCaches[d].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},p.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},p.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},p.prototype._updateSources=function(c){for(var d in this.sourceCaches)this.sourceCaches[d].update(c)},p.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},p.prototype._updatePlacement=function(c,d,E,w,P){P===void 0&&(P=!1);for(var L=!1,z=!1,H={},oe=0,ue=this._order;oe<ue.length;oe+=1){var le=this._layers[ue[oe]];if(le.type==="symbol"){if(!H[le.source]){var Pe=this.sourceCaches[le.source];H[le.source]=Pe.getRenderableIds(!0).map(function($e){return Pe.getTileByID($e)}).sort(function($e,yt){return yt.tileID.overscaledZ-$e.tileID.overscaledZ||($e.tileID.isLessThan(yt.tileID)?-1:1)})}var we=this.crossTileSymbolIndex.addLayer(le,H[le.source],c.center.lng);L=L||we}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((P=P||this._layerOrderChanged||E===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(g.browser.now(),c.zoom))&&(this.pauseablePlacement=new Ra(c,this._order,P,d,E,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,H),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(g.browser.now()),z=!0),L&&this.pauseablePlacement.placement.setStale()),z||L)for(var Ge=0,Ce=this._order;Ge<Ce.length;Ge+=1){var Ve=this._layers[Ce[Ge]];Ve.type==="symbol"&&this.placement.updateLayerOpacities(Ve,H[Ve.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(g.browser.now())},p.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},p.prototype.getImages=function(c,d,E){this.imageManager.getImages(d.icons,E),this._updateTilesForChangedImages();var w=this.sourceCaches[d.source];w&&w.setDependencies(d.tileID.key,d.type,d.icons)},p.prototype.getGlyphs=function(c,d,E){this.glyphManager.getGlyphs(d.stacks,E)},p.prototype.getResource=function(c,d,E){return g.makeRequest(d,E)},p}(g.Evented);bs.getSourceType=function(l){return Er[l]},bs.setSourceType=function(l,p){Er[l]=p},bs.registerForPluginStateChange=g.registerForPluginStateChange;var ga=g.createLayout([{name:"a_pos",type:"Int16",components:2}]),ya=Zi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),us=Zi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),tf=Zi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Ol=Zi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),qs=Zi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),ic=Zi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Qu=Zi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Ks=Zi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),dl=Zi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),_=Zi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),M=Zi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),F=Zi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),R=Zi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Y=Zi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),me=Zi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),He=Zi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),ut=Zi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),lt=Zi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),ir=Zi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),ur=Zi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Tn=Zi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),ri=Zi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Ln=Zi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Vi=Zi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),pa=Zi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Ea=Zi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Zi(l,p){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=p.match(/attribute ([\w]+) ([\w]+)/g),E=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=w?w.concat(E):E,L={};return{fragmentSource:l=l.replace(c,function(z,H,oe,ue,le){return L[le]=!0,H==="define"?`
#ifndef HAS_UNIFORM_u_`+le+`
varying `+oe+" "+ue+" "+le+`;
#else
uniform `+oe+" "+ue+" u_"+le+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+le+`
    `+oe+" "+ue+" "+le+" = u_"+le+`;
#endif
`}),vertexSource:p=p.replace(c,function(z,H,oe,ue,le){var Pe=ue==="float"?"vec2":"vec4",we=le.match(/color/)?"color":Pe;return L[le]?H==="define"?`
#ifndef HAS_UNIFORM_u_`+le+`
uniform lowp float u_`+le+`_t;
attribute `+oe+" "+Pe+" a_"+le+`;
varying `+oe+" "+ue+" "+le+`;
#else
uniform `+oe+" "+ue+" u_"+le+`;
#endif
`:we==="vec4"?`
#ifndef HAS_UNIFORM_u_`+le+`
    `+le+" = a_"+le+`;
#else
    `+oe+" "+ue+" "+le+" = u_"+le+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+le+`
    `+le+" = unpack_mix_"+we+"(a_"+le+", u_"+le+`_t);
#else
    `+oe+" "+ue+" "+le+" = u_"+le+`;
#endif
`:H==="define"?`
#ifndef HAS_UNIFORM_u_`+le+`
uniform lowp float u_`+le+`_t;
attribute `+oe+" "+Pe+" a_"+le+`;
#else
uniform `+oe+" "+ue+" u_"+le+`;
#endif
`:we==="vec4"?`
#ifndef HAS_UNIFORM_u_`+le+`
    `+oe+" "+ue+" "+le+" = a_"+le+`;
#else
    `+oe+" "+ue+" "+le+" = u_"+le+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+le+`
    `+oe+" "+ue+" "+le+" = unpack_mix_"+we+"(a_"+le+", u_"+le+`_t);
#else
    `+oe+" "+ue+" "+le+" = u_"+le+`;
#endif
`}),staticAttributes:d,staticUniforms:P}}var Es=Object.freeze({__proto__:null,prelude:ya,background:us,backgroundPattern:tf,circle:Ol,clippingMask:qs,heatmap:ic,heatmapTexture:Qu,collisionBox:Ks,collisionCircle:dl,debug:_,fill:M,fillOutline:F,fillOutlinePattern:R,fillPattern:Y,fillExtrusion:me,fillExtrusionPattern:He,hillshadePrepare:ut,hillshade:lt,line:ir,lineGradient:ur,linePattern:Tn,lineSDF:ri,raster:Ln,symbolIcon:Vi,symbolSDF:pa,symbolTextAndIcon:Ea}),su=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Ju(l){for(var p=[],c=0;c<l.length;c++)if(l[c]!==null){var d=l[c].split(" ");p.push(d.pop())}return p}su.prototype.bind=function(l,p,c,d,E,w,P,L){this.context=l;for(var z=this.boundPaintVertexBuffers.length!==d.length,H=0;!z&&H<d.length;H++)this.boundPaintVertexBuffers[H]!==d[H]&&(z=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===p&&this.boundLayoutVertexBuffer===c&&!z&&this.boundIndexBuffer===E&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===P&&this.boundDynamicVertexBuffer2===L?(l.bindVertexArrayOES.set(this.vao),P&&P.bind(),E&&E.dynamicDraw&&E.bind(),L&&L.bind()):this.freshBind(p,c,d,E,w,P,L)},su.prototype.freshBind=function(l,p,c,d,E,w,P){var L,z=l.numAttributes,H=this.context,oe=H.gl;if(H.extVertexArrayObject)this.vao&&this.destroy(),this.vao=H.extVertexArrayObject.createVertexArrayOES(),H.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=l,this.boundLayoutVertexBuffer=p,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=P;else{L=H.currentNumAttributes||0;for(var ue=z;ue<L;ue++)oe.disableVertexAttribArray(ue)}p.enableAttributes(oe,l);for(var le=0,Pe=c;le<Pe.length;le+=1)Pe[le].enableAttributes(oe,l);w&&w.enableAttributes(oe,l),P&&P.enableAttributes(oe,l),p.bind(),p.setVertexAttribPointers(oe,l,E);for(var we=0,Ge=c;we<Ge.length;we+=1){var Ce=Ge[we];Ce.bind(),Ce.setVertexAttribPointers(oe,l,E)}w&&(w.bind(),w.setVertexAttribPointers(oe,l,E)),d&&d.bind(),P&&(P.bind(),P.setVertexAttribPointers(oe,l,E)),H.currentNumAttributes=z},su.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var rf=function(l,p,c,d,E,w){var P=l.gl;this.program=P.createProgram();for(var L=Ju(c.staticAttributes),z=d?d.getBinderAttributes():[],H=L.concat(z),oe=c.staticUniforms?Ju(c.staticUniforms):[],ue=d?d.getBinderUniforms():[],le=[],Pe=0,we=oe.concat(ue);Pe<we.length;Pe+=1){var Ge=we[Pe];le.indexOf(Ge)<0&&le.push(Ge)}var Ce=d?d.defines():[];w&&Ce.push("#define OVERDRAW_INSPECTOR;");var Ve=Ce.concat(ya.fragmentSource,c.fragmentSource).join(`
`),$e=Ce.concat(ya.vertexSource,c.vertexSource).join(`
`),yt=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(yt,Ve),P.compileShader(yt),P.attachShader(this.program,yt);var Vt=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(Vt,$e),P.compileShader(Vt),P.attachShader(this.program,Vt),this.attributes={};var Bt={};this.numAttributes=H.length;for(var Xt=0;Xt<this.numAttributes;Xt++)H[Xt]&&(P.bindAttribLocation(this.program,Xt,H[Xt]),this.attributes[H[Xt]]=Xt);P.linkProgram(this.program),P.deleteShader(Vt),P.deleteShader(yt);for(var vr=0;vr<le.length;vr++){var Br=le[vr];if(Br&&!Bt[Br]){var Lr=P.getUniformLocation(this.program,Br);Lr&&(Bt[Br]=Lr)}}this.fixedUniforms=E(l,Bt),this.binderUniforms=d?d.getUniforms(l,Bt):[]}}};function vl(l,p,c){var d=1/ra(c,1,p.transform.tileZoom),E=Math.pow(2,c.tileID.overscaledZ),w=c.tileSize*Math.pow(2,p.transform.tileZoom)/E,P=w*(c.tileID.canonical.x+c.tileID.wrap*E),L=w*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[P>>16,L>>16],u_pixel_coord_lower:[65535&P,65535&L]}}rf.prototype.draw=function(l,p,c,d,E,w,P,L,z,H,oe,ue,le,Pe,we,Ge){var Ce,Ve=l.gl;if(!this.failedToCreate){for(var $e in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(d),l.setColorMode(E),l.setCullFace(w),this.fixedUniforms)this.fixedUniforms[$e].set(P[$e]);Pe&&Pe.setUniforms(l,this.binderUniforms,ue,{zoom:le});for(var yt=(Ce={},Ce[Ve.LINES]=2,Ce[Ve.TRIANGLES]=3,Ce[Ve.LINE_STRIP]=1,Ce)[p],Vt=0,Bt=oe.get();Vt<Bt.length;Vt+=1){var Xt=Bt[Vt],vr=Xt.vaos||(Xt.vaos={});(vr[L]||(vr[L]=new su)).bind(l,this,z,Pe?Pe.getPaintVertexBuffers():[],H,Xt.vertexOffset,we,Ge),Ve.drawElements(p,Xt.primitiveLength*yt,Ve.UNSIGNED_SHORT,Xt.primitiveOffset*yt*2)}}};var Pc=function(l,p,c,d){var E=p.style.light,w=E.properties.get("position"),P=[w.x,w.y,w.z],L=g.create$1();E.properties.get("anchor")==="viewport"&&g.fromRotation(L,-p.transform.angle),g.transformMat3(P,P,L);var z=E.properties.get("color");return{u_matrix:l,u_lightpos:P,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+c,u_opacity:d}},Nu=function(l,p,c,d,E,w,P){return g.extend(Pc(l,p,c,d),vl(w,p,P),{u_height_factor:-Math.pow(2,E.overscaledZ)/P.tileSize/8})},zu=function(l){return{u_matrix:l}},Uu=function(l,p,c,d){return g.extend(zu(l),vl(c,p,d))},so=function(l,p){return{u_matrix:l,u_world:p}},jf=function(l,p,c,d,E){return g.extend(Uu(l,p,c,d),{u_world:E})},Vf=function(l,p,c,d){var E,w,P=l.transform;if(d.paint.get("circle-pitch-alignment")==="map"){var L=ra(c,1,P.zoom);E=!0,w=[L,L]}else E=!1,w=P.pixelsToGLUnits;return{u_camera_to_center_distance:P.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(p.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:g.browser.devicePixelRatio,u_extrude_scale:w}},ts=function(l,p,c){var d=ra(c,1,p.zoom),E=Math.pow(2,p.zoom-c.tileID.overscaledZ),w=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:p.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[p.pixelsToGLUnits[0]/(d*E),p.pixelsToGLUnits[1]/(d*E)],u_overscale_factor:w}},Ic=function(l,p,c){return{u_matrix:l,u_inv_matrix:p,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},Zu=function(l,p,c){return c===void 0&&(c=1),{u_matrix:l,u_color:p,u_overlay:0,u_overlay_scale:c}},uu=function(l){return{u_matrix:l}},nf=function(l,p,c,d){return{u_matrix:l,u_extrude_scale:ra(p,1,c),u_intensity:d}},Rl=function(l,p,c){var d=l.transform;return{u_matrix:Oc(l,p,c),u_ratio:1/ra(p,1,d.zoom),u_device_pixel_ratio:g.browser.devicePixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Li=function(l,p,c,d){return g.extend(Rl(l,p,c),{u_image:0,u_image_height:d})},Ll=function(l,p,c,d){var E=l.transform,w=ml(p,E);return{u_matrix:Oc(l,p,c),u_texsize:p.imageAtlasTexture.size,u_ratio:1/ra(p,1,E.zoom),u_device_pixel_ratio:g.browser.devicePixelRatio,u_image:0,u_scale:[w,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},Sp=function(l,p,c,d,E){var w=l.lineAtlas,P=ml(p,l.transform),L=c.layout.get("line-cap")==="round",z=w.getDash(d.from,L),H=w.getDash(d.to,L),oe=z.width*E.fromScale,ue=H.width*E.toScale;return g.extend(Rl(l,p,c),{u_patternscale_a:[P/oe,-z.height/2],u_patternscale_b:[P/ue,-H.height/2],u_sdfgamma:w.width/(256*Math.min(oe,ue)*g.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:z.y,u_tex_y_b:H.y,u_mix:E.t})};function ml(l,p){return 1/ra(l,1,p.tileZoom)}function Oc(l,p,c){return l.translatePosMatrix(p.tileID.posMatrix,p,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var Gf=function(l,p,c,d,E){return{u_matrix:l,u_tl_parent:p,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(P=E.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(w=E.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Cp(E.paint.get("raster-hue-rotate"))};var w,P};function Cp(l){l*=Math.PI/180;var p=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*p-c+1)/3,(Math.sqrt(3)*p-c+1)/3]}var Hf,Rc=function(l,p,c,d,E,w,P,L,z,H){var oe=E.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:p?p.uSizeT:0,u_size:p?p.uSize:0,u_camera_to_center_distance:oe.cameraToCenterDistance,u_pitch:oe.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:oe.width/oe.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:P,u_coord_matrix:L,u_is_text:+z,u_pitch_with_map:+d,u_texsize:H,u_texture:0}},ac=function(l,p,c,d,E,w,P,L,z,H,oe){var ue=E.transform;return g.extend(Rc(l,p,c,d,E,w,P,L,z,H),{u_gamma_scale:d?Math.cos(ue._pitch)*ue.cameraToCenterDistance:1,u_device_pixel_ratio:g.browser.devicePixelRatio,u_is_halo:+oe})},oc=function(l,p,c,d,E,w,P,L,z,H){return g.extend(ac(l,p,c,d,E,w,P,L,!0,z,!0),{u_texsize_icon:H,u_texture_icon:1})},kl=function(l,p,c){return{u_matrix:l,u_opacity:p,u_color:c}},gl=function(l,p,c,d,E,w){return g.extend(function(P,L,z,H){var oe=z.imageManager.getPattern(P.from.toString()),ue=z.imageManager.getPattern(P.to.toString()),le=z.imageManager.getPixelSize(),Pe=le.width,we=le.height,Ge=Math.pow(2,H.tileID.overscaledZ),Ce=H.tileSize*Math.pow(2,z.transform.tileZoom)/Ge,Ve=Ce*(H.tileID.canonical.x+H.tileID.wrap*Ge),$e=Ce*H.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:oe.tl,u_pattern_br_a:oe.br,u_pattern_tl_b:ue.tl,u_pattern_br_b:ue.br,u_texsize:[Pe,we],u_mix:L.t,u_pattern_size_a:oe.displaySize,u_pattern_size_b:ue.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/ra(H,1,z.transform.tileZoom),u_pixel_coord_upper:[Ve>>16,$e>>16],u_pixel_coord_lower:[65535&Ve,65535&$e]}}(d,w,c,E),{u_matrix:l,u_opacity:p})},Dl={fillExtrusion:function(l,p){return{u_matrix:new g.UniformMatrix4f(l,p.u_matrix),u_lightpos:new g.Uniform3f(l,p.u_lightpos),u_lightintensity:new g.Uniform1f(l,p.u_lightintensity),u_lightcolor:new g.Uniform3f(l,p.u_lightcolor),u_vertical_gradient:new g.Uniform1f(l,p.u_vertical_gradient),u_opacity:new g.Uniform1f(l,p.u_opacity)}},fillExtrusionPattern:function(l,p){return{u_matrix:new g.UniformMatrix4f(l,p.u_matrix),u_lightpos:new g.Uniform3f(l,p.u_lightpos),u_lightintensity:new g.Uniform1f(l,p.u_lightintensity),u_lightcolor:new g.Uniform3f(l,p.u_lightcolor),u_vertical_gradient:new g.Uniform1f(l,p.u_vertical_gradient),u_height_factor:new g.Uniform1f(l,p.u_height_factor),u_image:new g.Uniform1i(l,p.u_image),u_texsize:new g.Uniform2f(l,p.u_texsize),u_pixel_coord_upper:new g.Uniform2f(l,p.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(l,p.u_pixel_coord_lower),u_scale:new g.Uniform3f(l,p.u_scale),u_fade:new g.Uniform1f(l,p.u_fade),u_opacity:new g.Uniform1f(l,p.u_opacity)}},fill:function(l,p){return{u_matrix:new g.UniformMatrix4f(l,p.u_matrix)}},fillPattern:function(l,p){return{u_matrix:new g.UniformMatrix4f(l,p.u_matrix),u_image:new g.Uniform1i(l,p.u_image),u_texsize:new g.Uniform2f(l,p.u_texsize),u_pixel_coord_upper:new g.Uniform2f(l,p.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(l,p.u_pixel_coord_lower),u_scale:new g.Uniform3f(l,p.u_scale),u_fade:new g.Uniform1f(l,p.u_fade)}},fillOutline:function(l,p){return{u_matrix:new g.UniformMatrix4f(l,p.u_matrix),u_world:new g.Uniform2f(l,p.u_world)}},fillOutlinePattern:function(l,p){return{u_matrix:new g.UniformMatrix4f(l,p.u_matrix),u_world:new g.Uniform2f(l,p.u_world),u_image:new g.Uniform1i(l,p.u_image),u_texsize:new g.Uniform2f(l,p.u_texsize),u_pixel_coord_upper:new g.Uniform2f(l,p.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(l,p.u_pixel_coord_lower),u_scale:new g.Uniform3f(l,p.u_scale),u_fade:new g.Uniform1f(l,p.u_fade)}},circle:function(l,p){return{u_camera_to_center_distance:new g.Uniform1f(l,p.u_camera_to_center_distance),u_scale_with_map:new g.Uniform1i(l,p.u_scale_with_map),u_pitch_with_map:new g.Uniform1i(l,p.u_pitch_with_map),u_extrude_scale:new g.Uniform2f(l,p.u_extrude_scale),u_device_pixel_ratio:new g.Uniform1f(l,p.u_device_pixel_ratio),u_matrix:new g.UniformMatrix4f(l,p.u_matrix)}},collisionBox:function(l,p){return{u_matrix:new g.UniformMatrix4f(l,p.u_matrix),u_camera_to_center_distance:new g.Uniform1f(l,p.u_camera_to_center_distance),u_pixels_to_tile_units:new g.Uniform1f(l,p.u_pixels_to_tile_units),u_extrude_scale:new g.Uniform2f(l,p.u_extrude_scale),u_overscale_factor:new g.Uniform1f(l,p.u_overscale_factor)}},collisionCircle:function(l,p){return{u_matrix:new g.UniformMatrix4f(l,p.u_matrix),u_inv_matrix:new g.UniformMatrix4f(l,p.u_inv_matrix),u_camera_to_center_distance:new g.Uniform1f(l,p.u_camera_to_center_distance),u_viewport_size:new g.Uniform2f(l,p.u_viewport_size)}},debug:function(l,p){return{u_color:new g.UniformColor(l,p.u_color),u_matrix:new g.UniformMatrix4f(l,p.u_matrix),u_overlay:new g.Uniform1i(l,p.u_overlay),u_overlay_scale:new g.Uniform1f(l,p.u_overlay_scale)}},clippingMask:function(l,p){return{u_matrix:new g.UniformMatrix4f(l,p.u_matrix)}},heatmap:function(l,p){return{u_extrude_scale:new g.Uniform1f(l,p.u_extrude_scale),u_intensity:new g.Uniform1f(l,p.u_intensity),u_matrix:new g.UniformMatrix4f(l,p.u_matrix)}},heatmapTexture:function(l,p){return{u_matrix:new g.UniformMatrix4f(l,p.u_matrix),u_world:new g.Uniform2f(l,p.u_world),u_image:new g.Uniform1i(l,p.u_image),u_color_ramp:new g.Uniform1i(l,p.u_color_ramp),u_opacity:new g.Uniform1f(l,p.u_opacity)}},hillshade:function(l,p){return{u_matrix:new g.UniformMatrix4f(l,p.u_matrix),u_image:new g.Uniform1i(l,p.u_image),u_latrange:new g.Uniform2f(l,p.u_latrange),u_light:new g.Uniform2f(l,p.u_light),u_shadow:new g.UniformColor(l,p.u_shadow),u_highlight:new g.UniformColor(l,p.u_highlight),u_accent:new g.UniformColor(l,p.u_accent)}},hillshadePrepare:function(l,p){return{u_matrix:new g.UniformMatrix4f(l,p.u_matrix),u_image:new g.Uniform1i(l,p.u_image),u_dimension:new g.Uniform2f(l,p.u_dimension),u_zoom:new g.Uniform1f(l,p.u_zoom),u_unpack:new g.Uniform4f(l,p.u_unpack)}},line:function(l,p){return{u_matrix:new g.UniformMatrix4f(l,p.u_matrix),u_ratio:new g.Uniform1f(l,p.u_ratio),u_device_pixel_ratio:new g.Uniform1f(l,p.u_device_pixel_ratio),u_units_to_pixels:new g.Uniform2f(l,p.u_units_to_pixels)}},lineGradient:function(l,p){return{u_matrix:new g.UniformMatrix4f(l,p.u_matrix),u_ratio:new g.Uniform1f(l,p.u_ratio),u_device_pixel_ratio:new g.Uniform1f(l,p.u_device_pixel_ratio),u_units_to_pixels:new g.Uniform2f(l,p.u_units_to_pixels),u_image:new g.Uniform1i(l,p.u_image),u_image_height:new g.Uniform1f(l,p.u_image_height)}},linePattern:function(l,p){return{u_matrix:new g.UniformMatrix4f(l,p.u_matrix),u_texsize:new g.Uniform2f(l,p.u_texsize),u_ratio:new g.Uniform1f(l,p.u_ratio),u_device_pixel_ratio:new g.Uniform1f(l,p.u_device_pixel_ratio),u_image:new g.Uniform1i(l,p.u_image),u_units_to_pixels:new g.Uniform2f(l,p.u_units_to_pixels),u_scale:new g.Uniform3f(l,p.u_scale),u_fade:new g.Uniform1f(l,p.u_fade)}},lineSDF:function(l,p){return{u_matrix:new g.UniformMatrix4f(l,p.u_matrix),u_ratio:new g.Uniform1f(l,p.u_ratio),u_device_pixel_ratio:new g.Uniform1f(l,p.u_device_pixel_ratio),u_units_to_pixels:new g.Uniform2f(l,p.u_units_to_pixels),u_patternscale_a:new g.Uniform2f(l,p.u_patternscale_a),u_patternscale_b:new g.Uniform2f(l,p.u_patternscale_b),u_sdfgamma:new g.Uniform1f(l,p.u_sdfgamma),u_image:new g.Uniform1i(l,p.u_image),u_tex_y_a:new g.Uniform1f(l,p.u_tex_y_a),u_tex_y_b:new g.Uniform1f(l,p.u_tex_y_b),u_mix:new g.Uniform1f(l,p.u_mix)}},raster:function(l,p){return{u_matrix:new g.UniformMatrix4f(l,p.u_matrix),u_tl_parent:new g.Uniform2f(l,p.u_tl_parent),u_scale_parent:new g.Uniform1f(l,p.u_scale_parent),u_buffer_scale:new g.Uniform1f(l,p.u_buffer_scale),u_fade_t:new g.Uniform1f(l,p.u_fade_t),u_opacity:new g.Uniform1f(l,p.u_opacity),u_image0:new g.Uniform1i(l,p.u_image0),u_image1:new g.Uniform1i(l,p.u_image1),u_brightness_low:new g.Uniform1f(l,p.u_brightness_low),u_brightness_high:new g.Uniform1f(l,p.u_brightness_high),u_saturation_factor:new g.Uniform1f(l,p.u_saturation_factor),u_contrast_factor:new g.Uniform1f(l,p.u_contrast_factor),u_spin_weights:new g.Uniform3f(l,p.u_spin_weights)}},symbolIcon:function(l,p){return{u_is_size_zoom_constant:new g.Uniform1i(l,p.u_is_size_zoom_constant),u_is_size_feature_constant:new g.Uniform1i(l,p.u_is_size_feature_constant),u_size_t:new g.Uniform1f(l,p.u_size_t),u_size:new g.Uniform1f(l,p.u_size),u_camera_to_center_distance:new g.Uniform1f(l,p.u_camera_to_center_distance),u_pitch:new g.Uniform1f(l,p.u_pitch),u_rotate_symbol:new g.Uniform1i(l,p.u_rotate_symbol),u_aspect_ratio:new g.Uniform1f(l,p.u_aspect_ratio),u_fade_change:new g.Uniform1f(l,p.u_fade_change),u_matrix:new g.UniformMatrix4f(l,p.u_matrix),u_label_plane_matrix:new g.UniformMatrix4f(l,p.u_label_plane_matrix),u_coord_matrix:new g.UniformMatrix4f(l,p.u_coord_matrix),u_is_text:new g.Uniform1i(l,p.u_is_text),u_pitch_with_map:new g.Uniform1i(l,p.u_pitch_with_map),u_texsize:new g.Uniform2f(l,p.u_texsize),u_texture:new g.Uniform1i(l,p.u_texture)}},symbolSDF:function(l,p){return{u_is_size_zoom_constant:new g.Uniform1i(l,p.u_is_size_zoom_constant),u_is_size_feature_constant:new g.Uniform1i(l,p.u_is_size_feature_constant),u_size_t:new g.Uniform1f(l,p.u_size_t),u_size:new g.Uniform1f(l,p.u_size),u_camera_to_center_distance:new g.Uniform1f(l,p.u_camera_to_center_distance),u_pitch:new g.Uniform1f(l,p.u_pitch),u_rotate_symbol:new g.Uniform1i(l,p.u_rotate_symbol),u_aspect_ratio:new g.Uniform1f(l,p.u_aspect_ratio),u_fade_change:new g.Uniform1f(l,p.u_fade_change),u_matrix:new g.UniformMatrix4f(l,p.u_matrix),u_label_plane_matrix:new g.UniformMatrix4f(l,p.u_label_plane_matrix),u_coord_matrix:new g.UniformMatrix4f(l,p.u_coord_matrix),u_is_text:new g.Uniform1i(l,p.u_is_text),u_pitch_with_map:new g.Uniform1i(l,p.u_pitch_with_map),u_texsize:new g.Uniform2f(l,p.u_texsize),u_texture:new g.Uniform1i(l,p.u_texture),u_gamma_scale:new g.Uniform1f(l,p.u_gamma_scale),u_device_pixel_ratio:new g.Uniform1f(l,p.u_device_pixel_ratio),u_is_halo:new g.Uniform1i(l,p.u_is_halo)}},symbolTextAndIcon:function(l,p){return{u_is_size_zoom_constant:new g.Uniform1i(l,p.u_is_size_zoom_constant),u_is_size_feature_constant:new g.Uniform1i(l,p.u_is_size_feature_constant),u_size_t:new g.Uniform1f(l,p.u_size_t),u_size:new g.Uniform1f(l,p.u_size),u_camera_to_center_distance:new g.Uniform1f(l,p.u_camera_to_center_distance),u_pitch:new g.Uniform1f(l,p.u_pitch),u_rotate_symbol:new g.Uniform1i(l,p.u_rotate_symbol),u_aspect_ratio:new g.Uniform1f(l,p.u_aspect_ratio),u_fade_change:new g.Uniform1f(l,p.u_fade_change),u_matrix:new g.UniformMatrix4f(l,p.u_matrix),u_label_plane_matrix:new g.UniformMatrix4f(l,p.u_label_plane_matrix),u_coord_matrix:new g.UniformMatrix4f(l,p.u_coord_matrix),u_is_text:new g.Uniform1i(l,p.u_is_text),u_pitch_with_map:new g.Uniform1i(l,p.u_pitch_with_map),u_texsize:new g.Uniform2f(l,p.u_texsize),u_texsize_icon:new g.Uniform2f(l,p.u_texsize_icon),u_texture:new g.Uniform1i(l,p.u_texture),u_texture_icon:new g.Uniform1i(l,p.u_texture_icon),u_gamma_scale:new g.Uniform1f(l,p.u_gamma_scale),u_device_pixel_ratio:new g.Uniform1f(l,p.u_device_pixel_ratio),u_is_halo:new g.Uniform1i(l,p.u_is_halo)}},background:function(l,p){return{u_matrix:new g.UniformMatrix4f(l,p.u_matrix),u_opacity:new g.Uniform1f(l,p.u_opacity),u_color:new g.UniformColor(l,p.u_color)}},backgroundPattern:function(l,p){return{u_matrix:new g.UniformMatrix4f(l,p.u_matrix),u_opacity:new g.Uniform1f(l,p.u_opacity),u_image:new g.Uniform1i(l,p.u_image),u_pattern_tl_a:new g.Uniform2f(l,p.u_pattern_tl_a),u_pattern_br_a:new g.Uniform2f(l,p.u_pattern_br_a),u_pattern_tl_b:new g.Uniform2f(l,p.u_pattern_tl_b),u_pattern_br_b:new g.Uniform2f(l,p.u_pattern_br_b),u_texsize:new g.Uniform2f(l,p.u_texsize),u_mix:new g.Uniform1f(l,p.u_mix),u_pattern_size_a:new g.Uniform2f(l,p.u_pattern_size_a),u_pattern_size_b:new g.Uniform2f(l,p.u_pattern_size_b),u_scale_a:new g.Uniform1f(l,p.u_scale_a),u_scale_b:new g.Uniform1f(l,p.u_scale_b),u_pixel_coord_upper:new g.Uniform2f(l,p.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(l,p.u_pixel_coord_lower),u_tile_units_to_pixels:new g.Uniform1f(l,p.u_tile_units_to_pixels)}}};function el(l,p,c,d,E,w,P){for(var L=l.context,z=L.gl,H=l.useProgram("collisionBox"),oe=[],ue=0,le=0,Pe=0;Pe<d.length;Pe++){var we=d[Pe],Ge=p.getTile(we),Ce=Ge.getBucket(c);if(Ce){var Ve=we.posMatrix;E[0]===0&&E[1]===0||(Ve=l.translatePosMatrix(we.posMatrix,Ge,E,w));var $e=P?Ce.textCollisionBox:Ce.iconCollisionBox,yt=Ce.collisionCircleArray;if(yt.length>0){var Vt=g.create(),Bt=Ve;g.mul(Vt,Ce.placementInvProjMatrix,l.transform.glCoordMatrix),g.mul(Vt,Vt,Ce.placementViewportMatrix),oe.push({circleArray:yt,circleOffset:le,transform:Bt,invTransform:Vt}),le=ue+=yt.length/4}$e&&H.draw(L,z.LINES,he.disabled,Me.disabled,l.colorModeForRenderPass(),Qe.disabled,ts(Ve,l.transform,Ge),c.id,$e.layoutVertexBuffer,$e.indexBuffer,$e.segments,null,l.transform.zoom,null,null,$e.collisionVertexBuffer)}}if(P&&oe.length){var Xt=l.useProgram("collisionCircle"),vr=new g.StructArrayLayout2f1f2i16;vr.resize(4*ue),vr._trim();for(var Br=0,Lr=0,jr=oe;Lr<jr.length;Lr+=1)for(var Fn=jr[Lr],On=0;On<Fn.circleArray.length/4;On++){var Zn=4*On,Oi=Fn.circleArray[Zn+0],un=Fn.circleArray[Zn+1],Qn=Fn.circleArray[Zn+2],li=Fn.circleArray[Zn+3];vr.emplace(Br++,Oi,un,Qn,li,0),vr.emplace(Br++,Oi,un,Qn,li,1),vr.emplace(Br++,Oi,un,Qn,li,2),vr.emplace(Br++,Oi,un,Qn,li,3)}(!Hf||Hf.length<2*ue)&&(Hf=function(Va){var No=2*Va,zo=new g.StructArrayLayout3ui6;zo.resize(No),zo._trim();for(var $a=0;$a<No;$a++){var lo=6*$a;zo.uint16[lo+0]=4*$a+0,zo.uint16[lo+1]=4*$a+1,zo.uint16[lo+2]=4*$a+2,zo.uint16[lo+3]=4*$a+2,zo.uint16[lo+4]=4*$a+3,zo.uint16[lo+5]=4*$a+0}return zo}(ue));for(var Jn=L.createIndexBuffer(Hf,!0),Hn=L.createVertexBuffer(vr,g.collisionCircleLayout.members,!0),pi=0,Kn=oe;pi<Kn.length;pi+=1){var Wn=Kn[pi],go=Ic(Wn.transform,Wn.invTransform,l.transform);Xt.draw(L,z.TRIANGLES,he.disabled,Me.disabled,l.colorModeForRenderPass(),Qe.disabled,go,c.id,Hn,Jn,g.SegmentVector.simpleSegment(0,2*Wn.circleOffset,Wn.circleArray.length,Wn.circleArray.length/2),null,l.transform.zoom,null,null,null)}Hn.destroy(),Jn.destroy()}}var $s=g.identity(new Float32Array(16));function af(l,p,c,d,E,w){var P=g.getAnchorAlignment(l),L=-(P.horizontalAlign-.5)*p,z=-(P.verticalAlign-.5)*c,H=g.evaluateVariableOffset(l,d);return new g.Point((L/E+H[0])*w,(z/E+H[1])*w)}function of(l,p,c,d,E,w,P,L,z,H,oe){var ue=l.text.placedSymbolArray,le=l.text.dynamicLayoutVertexArray,Pe=l.icon.dynamicLayoutVertexArray,we={};le.clear();for(var Ge=0;Ge<ue.length;Ge++){var Ce=ue.get(Ge),Ve=Ce.hidden||!Ce.crossTileID||l.allowVerticalPlacement&&!Ce.placedOrientation?null:d[Ce.crossTileID];if(Ve){var $e=new g.Point(Ce.anchorX,Ce.anchorY),yt=wi($e,c?L:P),Vt=Bi(w.cameraToCenterDistance,yt.signedDistanceFromCamera),Bt=E.evaluateSizeForFeature(l.textSizeData,H,Ce)*Vt/g.ONE_EM;c&&(Bt*=l.tilePixelRatio/z);for(var Xt=af(Ve.anchor,Ve.width,Ve.height,Ve.textOffset,Ve.textBoxScale,Bt),vr=c?wi($e.add(Xt),P).point:yt.point.add(p?Xt.rotate(-w.angle):Xt),Br=l.allowVerticalPlacement&&Ce.placedOrientation===g.WritingMode.vertical?Math.PI/2:0,Lr=0;Lr<Ce.numGlyphs;Lr++)g.addDynamicAttributes(le,vr,Br);oe&&Ce.associatedIconIndex>=0&&(we[Ce.associatedIconIndex]={shiftedAnchor:vr,angle:Br})}else za(Ce.numGlyphs,le)}if(oe){Pe.clear();for(var jr=l.icon.placedSymbolArray,Fn=0;Fn<jr.length;Fn++){var On=jr.get(Fn);if(On.hidden)za(On.numGlyphs,Pe);else{var Zn=we[Fn];if(Zn)for(var Oi=0;Oi<On.numGlyphs;Oi++)g.addDynamicAttributes(Pe,Zn.shiftedAnchor,Zn.angle);else za(On.numGlyphs,Pe)}}l.icon.dynamicLayoutVertexBuffer.updateData(Pe)}l.text.dynamicLayoutVertexBuffer.updateData(le)}function Wf(l,p,c){return c.iconsInText&&p?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function lu(l,p,c,d,E,w,P,L,z,H,oe,ue){for(var le=l.context,Pe=le.gl,we=l.transform,Ge=L==="map",Ce=z==="map",Ve=Ge&&c.layout.get("symbol-placement")!=="point",$e=Ge&&!Ce&&!Ve,yt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Vt=!1,Bt=l.depthModeForSublayer(0,he.ReadOnly),Xt=c.layout.get("text-variable-anchor"),vr=[],Br=0,Lr=d;Br<Lr.length;Br+=1){var jr=Lr[Br],Fn=p.getTile(jr),On=Fn.getBucket(c);if(On){var Zn=E?On.text:On.icon;if(Zn&&Zn.segments.get().length){var Oi=Zn.programConfigurations.get(c.id),un=E||On.sdfIcons,Qn=E?On.textSizeData:On.iconSizeData,li=Ce||we.pitch!==0,Jn=l.useProgram(Wf(un,E,On),Oi),Hn=g.evaluateSizeForZoom(Qn,we.zoom),pi=void 0,Kn=[0,0],Wn=void 0,go=void 0,Va=null,No=void 0;if(E)Wn=Fn.glyphAtlasTexture,go=Pe.LINEAR,pi=Fn.glyphAtlasTexture.size,On.iconsInText&&(Kn=Fn.imageAtlasTexture.size,Va=Fn.imageAtlasTexture,No=li||l.options.rotating||l.options.zooming||Qn.kind==="composite"||Qn.kind==="camera"?Pe.LINEAR:Pe.NEAREST);else{var zo=c.layout.get("icon-size").constantOr(0)!==1||On.iconsNeedLinear;Wn=Fn.imageAtlasTexture,go=un||l.options.rotating||l.options.zooming||zo||li?Pe.LINEAR:Pe.NEAREST,pi=Fn.imageAtlasTexture.size}var $a=ra(Fn,1,l.transform.zoom),lo=Ca(jr.posMatrix,Ce,Ge,l.transform,$a),Ds=Ci(jr.posMatrix,Ce,Ge,l.transform,$a),fs=Xt&&On.hasTextData(),Uo=c.layout.get("icon-text-fit")!=="none"&&fs&&On.hasIconData();Ve&&an(On,jr.posMatrix,l,E,lo,Ds,Ce,H);var ps=l.translatePosMatrix(jr.posMatrix,Fn,w,P),is=Ve||E&&Xt||Uo?$s:lo,Js=l.translatePosMatrix(Ds,Fn,w,P,!0),Pu=un&&c.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0,ol={program:Jn,buffers:Zn,uniformValues:un?On.iconsInText?oc(Qn.kind,Hn,$e,Ce,l,ps,is,Js,pi,Kn):ac(Qn.kind,Hn,$e,Ce,l,ps,is,Js,E,pi,!0):Rc(Qn.kind,Hn,$e,Ce,l,ps,is,Js,E,pi),atlasTexture:Wn,atlasTextureIcon:Va,atlasInterpolation:go,atlasInterpolationIcon:No,isSDF:un,hasHalo:Pu};if(yt&&On.canOverlap){Vt=!0;for(var Xu=0,Hl=Zn.segments.get();Xu<Hl.length;Xu+=1){var dc=Hl[Xu];vr.push({segments:new g.SegmentVector([dc]),sortKey:dc.sortKey,state:ol})}}else vr.push({segments:Zn.segments,sortKey:0,state:ol})}}}Vt&&vr.sort(function(Gs,El){return Gs.sortKey-El.sortKey});for(var mu=0,Qa=vr;mu<Qa.length;mu+=1){var Ta=Qa[mu],no=Ta.state;if(le.activeTexture.set(Pe.TEXTURE0),no.atlasTexture.bind(no.atlasInterpolation,Pe.CLAMP_TO_EDGE),no.atlasTextureIcon&&(le.activeTexture.set(Pe.TEXTURE1),no.atlasTextureIcon&&no.atlasTextureIcon.bind(no.atlasInterpolationIcon,Pe.CLAMP_TO_EDGE)),no.isSDF){var Iu=no.uniformValues;no.hasHalo&&(Iu.u_is_halo=1,sc(no.buffers,Ta.segments,c,l,no.program,Bt,oe,ue,Iu)),Iu.u_is_halo=0}sc(no.buffers,Ta.segments,c,l,no.program,Bt,oe,ue,no.uniformValues)}}function sc(l,p,c,d,E,w,P,L,z){var H=d.context;E.draw(H,H.gl.TRIANGLES,w,P,L,Qe.disabled,z,c.id,l.layoutVertexBuffer,l.indexBuffer,p,c.paint,d.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Lc(l,p,c,d,E,w,P){var L,z,H,oe,ue,le=l.context.gl,Pe=c.paint.get("fill-pattern"),we=Pe&&Pe.constantOr(1),Ge=c.getCrossfadeParameters();P?(z=we&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=le.LINES):(z=we?"fillPattern":"fill",L=le.TRIANGLES);for(var Ce=0,Ve=d;Ce<Ve.length;Ce+=1){var $e=Ve[Ce],yt=p.getTile($e);if(!we||yt.patternsLoaded()){var Vt=yt.getBucket(c);if(Vt){var Bt=Vt.programConfigurations.get(c.id),Xt=l.useProgram(z,Bt);we&&(l.context.activeTexture.set(le.TEXTURE0),yt.imageAtlasTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),Bt.updatePaintBuffers(Ge));var vr=Pe.constantOr(null);if(vr&&yt.imageAtlas){var Br=yt.imageAtlas,Lr=Br.patternPositions[vr.to.toString()],jr=Br.patternPositions[vr.from.toString()];Lr&&jr&&Bt.setConstantPatternPositions(Lr,jr)}var Fn=l.translatePosMatrix($e.posMatrix,yt,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(P){oe=Vt.indexBuffer2,ue=Vt.segments2;var On=[le.drawingBufferWidth,le.drawingBufferHeight];H=z==="fillOutlinePattern"&&we?jf(Fn,l,Ge,yt,On):so(Fn,On)}else oe=Vt.indexBuffer,ue=Vt.segments,H=we?Uu(Fn,l,Ge,yt):zu(Fn);Xt.draw(l.context,L,E,l.stencilModeForClipping($e),w,Qe.disabled,H,c.id,Vt.layoutVertexBuffer,oe,ue,c.paint,l.transform.zoom,Bt)}}}}function sf(l,p,c,d,E,w,P){for(var L=l.context,z=L.gl,H=c.paint.get("fill-extrusion-pattern"),oe=H.constantOr(1),ue=c.getCrossfadeParameters(),le=c.paint.get("fill-extrusion-opacity"),Pe=0,we=d;Pe<we.length;Pe+=1){var Ge=we[Pe],Ce=p.getTile(Ge),Ve=Ce.getBucket(c);if(Ve){var $e=Ve.programConfigurations.get(c.id),yt=l.useProgram(oe?"fillExtrusionPattern":"fillExtrusion",$e);oe&&(l.context.activeTexture.set(z.TEXTURE0),Ce.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),$e.updatePaintBuffers(ue));var Vt=H.constantOr(null);if(Vt&&Ce.imageAtlas){var Bt=Ce.imageAtlas,Xt=Bt.patternPositions[Vt.to.toString()],vr=Bt.patternPositions[Vt.from.toString()];Xt&&vr&&$e.setConstantPatternPositions(Xt,vr)}var Br=l.translatePosMatrix(Ge.posMatrix,Ce,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Lr=c.paint.get("fill-extrusion-vertical-gradient"),jr=oe?Nu(Br,l,Lr,le,Ge,ue,Ce):Pc(Br,l,Lr,le);yt.draw(L,L.gl.TRIANGLES,E,w,P,Qe.backCCW,jr,c.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,c.paint,l.transform.zoom,$e)}}}function Fl(l,p,c,d,E,w){var P=l.context,L=P.gl,z=p.fbo;if(z){var H=l.useProgram("hillshade");P.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,z.colorAttachment.get());var oe=function(ue,le,Pe){var we=Pe.paint.get("hillshade-shadow-color"),Ge=Pe.paint.get("hillshade-highlight-color"),Ce=Pe.paint.get("hillshade-accent-color"),Ve=Pe.paint.get("hillshade-illumination-direction")*(Math.PI/180);Pe.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ve-=ue.transform.angle);var $e,yt,Vt,Bt=!ue.options.moving;return{u_matrix:ue.transform.calculatePosMatrix(le.tileID.toUnwrapped(),Bt),u_image:0,u_latrange:($e=le.tileID,yt=Math.pow(2,$e.canonical.z),Vt=$e.canonical.y,[new g.MercatorCoordinate(0,Vt/yt).toLngLat().lat,new g.MercatorCoordinate(0,(Vt+1)/yt).toLngLat().lat]),u_light:[Pe.paint.get("hillshade-exaggeration"),Ve],u_shadow:we,u_highlight:Ge,u_accent:Ce}}(l,p,c);H.draw(P,L.TRIANGLES,d,E,w,Qe.disabled,oe,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function rh(l,p,c,d,E,w){var P=l.context,L=P.gl,z=p.dem;if(z&&z.data){var H=z.dim,oe=z.stride,ue=z.getPixels();if(P.activeTexture.set(L.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),p.demTexture=p.demTexture||l.getTileTexture(oe),p.demTexture){var le=p.demTexture;le.update(ue,{premultiply:!1}),le.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else p.demTexture=new g.Texture(P,ue,L.RGBA,{premultiply:!1}),p.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);P.activeTexture.set(L.TEXTURE0);var Pe=p.fbo;if(!Pe){var we=new g.Texture(P,{width:H,height:H,data:null},L.RGBA);we.bind(L.LINEAR,L.CLAMP_TO_EDGE),(Pe=p.fbo=P.createFramebuffer(H,H,!0)).colorAttachment.set(we.texture)}P.bindFramebuffer.set(Pe.framebuffer),P.viewport.set([0,0,H,H]),l.useProgram("hillshadePrepare").draw(P,L.TRIANGLES,d,E,w,Qe.disabled,function(Ge,Ce){var Ve=Ce.stride,$e=g.create();return g.ortho($e,0,g.EXTENT,-g.EXTENT,0,0,1),g.translate($e,$e,[0,-g.EXTENT,0]),{u_matrix:$e,u_image:1,u_dimension:[Ve,Ve],u_zoom:Ge.overscaledZ,u_unpack:Ce.getUnpackVector()}}(p.tileID,z),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),p.needsHillshadePrepare=!1}}function uf(l,p,c,d,E){var w=d.paint.get("raster-fade-duration");if(w>0){var P=g.browser.now(),L=(P-l.timeAdded)/w,z=p?(P-p.timeAdded)/w:-1,H=c.getSource(),oe=E.coveringZoomLevel({tileSize:H.tileSize,roundZoom:H.roundZoom}),ue=!p||Math.abs(p.tileID.overscaledZ-oe)>Math.abs(l.tileID.overscaledZ-oe),le=ue&&l.refreshedUponExpiration?1:g.clamp(ue?L:1-z,0,1);return l.refreshedUponExpiration&&L>=1&&(l.refreshedUponExpiration=!1),p?{opacity:1,mix:1-le}:{opacity:le,mix:0}}return{opacity:1,mix:0}}var Bl=new g.Color(1,0,0,1),lf=new g.Color(0,1,0,1),cf=new g.Color(0,0,1,1),Nl=new g.Color(1,0,1,1),kc=new g.Color(0,1,1,1);function Ap(l,p,c,d){uc(l,0,p+c/2,l.transform.width,c,d)}function wp(l,p,c,d){uc(l,p-c/2,0,c,l.transform.height,d)}function uc(l,p,c,d,E,w){var P=l.context,L=P.gl;L.enable(L.SCISSOR_TEST),L.scissor(p*g.browser.devicePixelRatio,c*g.browser.devicePixelRatio,d*g.browser.devicePixelRatio,E*g.browser.devicePixelRatio),P.clear({color:w}),L.disable(L.SCISSOR_TEST)}function Tp(l,p,c){var d=l.context,E=d.gl,w=c.posMatrix,P=l.useProgram("debug"),L=he.disabled,z=Me.disabled,H=l.colorModeForRenderPass();d.activeTexture.set(E.TEXTURE0),l.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),P.draw(d,E.LINE_STRIP,L,z,H,Qe.disabled,Zu(w,g.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var oe=p.getTileByID(c.key).latestRawTileData,ue=Math.floor((oe&&oe.byteLength||0)/1024),le=p.getTile(c).tileSize,Pe=512/Math.min(le,512)*(c.overscaledZ/l.transform.zoom)*.5,we=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(we+=" => "+c.overscaledZ),function(Ge,Ce){Ge.initDebugOverlayCanvas();var Ve=Ge.debugOverlayCanvas,$e=Ge.context.gl,yt=Ge.debugOverlayCanvas.getContext("2d");yt.clearRect(0,0,Ve.width,Ve.height),yt.shadowColor="white",yt.shadowBlur=2,yt.lineWidth=1.5,yt.strokeStyle="white",yt.textBaseline="top",yt.font="bold 36px Open Sans, sans-serif",yt.fillText(Ce,5,5),yt.strokeText(Ce,5,5),Ge.debugOverlayTexture.update(Ve),Ge.debugOverlayTexture.bind($e.LINEAR,$e.CLAMP_TO_EDGE)}(l,we+" "+ue+"kb"),P.draw(d,E.TRIANGLES,L,z,je.alphaBlended,Qe.disabled,Zu(w,g.Color.transparent,Pe),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var zl={symbol:function(l,p,c,d,E){if(l.renderPass==="translucent"){var w=Me.disabled,P=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(L,z,H,oe,ue,le,Pe){for(var we=z.transform,Ge=ue==="map",Ce=le==="map",Ve=0,$e=L;Ve<$e.length;Ve+=1){var yt=$e[Ve],Vt=oe.getTile(yt),Bt=Vt.getBucket(H);if(Bt&&Bt.text&&Bt.text.segments.get().length){var Xt=g.evaluateSizeForZoom(Bt.textSizeData,we.zoom),vr=ra(Vt,1,z.transform.zoom),Br=Ca(yt.posMatrix,Ce,Ge,z.transform,vr),Lr=H.layout.get("icon-text-fit")!=="none"&&Bt.hasIconData();if(Xt){var jr=Math.pow(2,we.zoom-Vt.tileID.overscaledZ);of(Bt,Ge,Ce,Pe,g.symbolSize,we,Br,yt.posMatrix,jr,Xt,Lr)}}}}(d,l,c,p,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),E),c.paint.get("icon-opacity").constantOr(1)!==0&&lu(l,p,c,d,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),w,P),c.paint.get("text-opacity").constantOr(1)!==0&&lu(l,p,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),w,P),p.map.showCollisionBoxes&&(el(l,p,c,d,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),el(l,p,c,d,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,p,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),P=c.paint.get("circle-stroke-opacity"),L=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(E.constantOr(1)!==0||w.constantOr(1)!==0&&P.constantOr(1)!==0){for(var z=l.context,H=z.gl,oe=l.depthModeForSublayer(0,he.ReadOnly),ue=Me.disabled,le=l.colorModeForRenderPass(),Pe=[],we=0;we<d.length;we++){var Ge=d[we],Ce=p.getTile(Ge),Ve=Ce.getBucket(c);if(Ve){var $e=Ve.programConfigurations.get(c.id),yt={programConfiguration:$e,program:l.useProgram("circle",$e),layoutVertexBuffer:Ve.layoutVertexBuffer,indexBuffer:Ve.indexBuffer,uniformValues:Vf(l,Ge,Ce,c)};if(L)for(var Vt=0,Bt=Ve.segments.get();Vt<Bt.length;Vt+=1){var Xt=Bt[Vt];Pe.push({segments:new g.SegmentVector([Xt]),sortKey:Xt.sortKey,state:yt})}else Pe.push({segments:Ve.segments,sortKey:0,state:yt})}}L&&Pe.sort(function(Fn,On){return Fn.sortKey-On.sortKey});for(var vr=0,Br=Pe;vr<Br.length;vr+=1){var Lr=Br[vr],jr=Lr.state;jr.program.draw(z,H.TRIANGLES,oe,ue,le,Qe.disabled,jr.uniformValues,c.id,jr.layoutVertexBuffer,jr.indexBuffer,Lr.segments,c.paint,l.transform.zoom,jr.programConfiguration)}}}},heatmap:function(l,p,c,d){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var E=l.context,w=E.gl,P=Me.disabled,L=new je([w.ONE,w.ONE],g.Color.transparent,[!0,!0,!0,!0]);(function(Pe,we,Ge){var Ce=Pe.gl;Pe.activeTexture.set(Ce.TEXTURE1),Pe.viewport.set([0,0,we.width/4,we.height/4]);var Ve=Ge.heatmapFbo;if(Ve)Ce.bindTexture(Ce.TEXTURE_2D,Ve.colorAttachment.get()),Pe.bindFramebuffer.set(Ve.framebuffer);else{var $e=Ce.createTexture();Ce.bindTexture(Ce.TEXTURE_2D,$e),Ce.texParameteri(Ce.TEXTURE_2D,Ce.TEXTURE_WRAP_S,Ce.CLAMP_TO_EDGE),Ce.texParameteri(Ce.TEXTURE_2D,Ce.TEXTURE_WRAP_T,Ce.CLAMP_TO_EDGE),Ce.texParameteri(Ce.TEXTURE_2D,Ce.TEXTURE_MIN_FILTER,Ce.LINEAR),Ce.texParameteri(Ce.TEXTURE_2D,Ce.TEXTURE_MAG_FILTER,Ce.LINEAR),Ve=Ge.heatmapFbo=Pe.createFramebuffer(we.width/4,we.height/4,!1),function(yt,Vt,Bt,Xt){var vr=yt.gl;vr.texImage2D(vr.TEXTURE_2D,0,vr.RGBA,Vt.width/4,Vt.height/4,0,vr.RGBA,yt.extRenderToTextureHalfFloat?yt.extTextureHalfFloat.HALF_FLOAT_OES:vr.UNSIGNED_BYTE,null),Xt.colorAttachment.set(Bt)}(Pe,we,$e,Ve)}})(E,l,c),E.clear({color:g.Color.transparent});for(var z=0;z<d.length;z++){var H=d[z];if(!p.hasRenderableParent(H)){var oe=p.getTile(H),ue=oe.getBucket(c);if(ue){var le=ue.programConfigurations.get(c.id);l.useProgram("heatmap",le).draw(E,w.TRIANGLES,he.disabled,P,L,Qe.disabled,nf(H.posMatrix,oe,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,c.paint,l.transform.zoom,le)}}}E.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(Pe,we){var Ge=Pe.context,Ce=Ge.gl,Ve=we.heatmapFbo;if(Ve){Ge.activeTexture.set(Ce.TEXTURE0),Ce.bindTexture(Ce.TEXTURE_2D,Ve.colorAttachment.get()),Ge.activeTexture.set(Ce.TEXTURE1);var $e=we.colorRampTexture;$e||($e=we.colorRampTexture=new g.Texture(Ge,we.colorRamp,Ce.RGBA)),$e.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),Pe.useProgram("heatmapTexture").draw(Ge,Ce.TRIANGLES,he.disabled,Me.disabled,Pe.colorModeForRenderPass(),Qe.disabled,function(yt,Vt,Bt,Xt){var vr=g.create();g.ortho(vr,0,yt.width,yt.height,0,0,1);var Br=yt.context.gl;return{u_matrix:vr,u_world:[Br.drawingBufferWidth,Br.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Vt.paint.get("heatmap-opacity")}}(Pe,we),we.id,Pe.viewportBuffer,Pe.quadTriangleIndexBuffer,Pe.viewportSegments,we.paint,Pe.transform.zoom)}}(l,c))},line:function(l,p,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(E.constantOr(1)!==0&&w.constantOr(1)!==0)for(var P=l.depthModeForSublayer(0,he.ReadOnly),L=l.colorModeForRenderPass(),z=c.paint.get("line-dasharray"),H=c.paint.get("line-pattern"),oe=H.constantOr(1),ue=c.paint.get("line-gradient"),le=c.getCrossfadeParameters(),Pe=oe?"linePattern":z?"lineSDF":ue?"lineGradient":"line",we=l.context,Ge=we.gl,Ce=!0,Ve=0,$e=d;Ve<$e.length;Ve+=1){var yt=$e[Ve],Vt=p.getTile(yt);if(!oe||Vt.patternsLoaded()){var Bt=Vt.getBucket(c);if(Bt){var Xt=Bt.programConfigurations.get(c.id),vr=l.context.program.get(),Br=l.useProgram(Pe,Xt),Lr=Ce||Br.program!==vr,jr=H.constantOr(null);if(jr&&Vt.imageAtlas){var Fn=Vt.imageAtlas,On=Fn.patternPositions[jr.to.toString()],Zn=Fn.patternPositions[jr.from.toString()];On&&Zn&&Xt.setConstantPatternPositions(On,Zn)}var Oi=oe?Ll(l,Vt,c,le):z?Sp(l,Vt,c,z,le):ue?Li(l,Vt,c,Bt.lineClipsArray.length):Rl(l,Vt,c);if(oe)we.activeTexture.set(Ge.TEXTURE0),Vt.imageAtlasTexture.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE),Xt.updatePaintBuffers(le);else if(z&&(Lr||l.lineAtlas.dirty))we.activeTexture.set(Ge.TEXTURE0),l.lineAtlas.bind(we);else if(ue){var un=Bt.gradients[c.id],Qn=un.texture;if(c.gradientVersion!==un.version){var li=256;if(c.stepInterpolant){var Jn=p.getSource().maxzoom,Hn=yt.canonical.z===Jn?Math.ceil(1<<l.transform.maxZoom-yt.canonical.z):1;li=g.clamp(g.nextPowerOfTwo(Bt.maxLineLength/g.EXTENT*1024*Hn),256,we.maxTextureSize)}un.gradient=g.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:li,image:un.gradient||void 0,clips:Bt.lineClipsArray}),un.texture?un.texture.update(un.gradient):un.texture=new g.Texture(we,un.gradient,Ge.RGBA),un.version=c.gradientVersion,Qn=un.texture}we.activeTexture.set(Ge.TEXTURE0),Qn.bind(c.stepInterpolant?Ge.NEAREST:Ge.LINEAR,Ge.CLAMP_TO_EDGE)}Br.draw(we,Ge.TRIANGLES,P,l.stencilModeForClipping(yt),L,Qe.disabled,Oi,c.id,Bt.layoutVertexBuffer,Bt.indexBuffer,Bt.segments,c.paint,l.transform.zoom,Xt,Bt.layoutVertexBuffer2),Ce=!1}}}}},fill:function(l,p,c,d){var E=c.paint.get("fill-color"),w=c.paint.get("fill-opacity");if(w.constantOr(1)!==0){var P=l.colorModeForRenderPass(),L=c.paint.get("fill-pattern"),z=l.opaquePassEnabledForLayer()&&!L.constantOr(1)&&E.constantOr(g.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===z){var H=l.depthModeForSublayer(1,l.renderPass==="opaque"?he.ReadWrite:he.ReadOnly);Lc(l,p,c,d,H,P,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var oe=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,he.ReadOnly);Lc(l,p,c,d,oe,P,!0)}}},"fill-extrusion":function(l,p,c,d){var E=c.paint.get("fill-extrusion-opacity");if(E!==0&&l.renderPass==="translucent"){var w=new he(l.context.gl.LEQUAL,he.ReadWrite,l.depthRangeFor3D);if(E!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))sf(l,p,c,d,w,Me.disabled,je.disabled),sf(l,p,c,d,w,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var P=l.colorModeForRenderPass();sf(l,p,c,d,w,Me.disabled,P)}}},hillshade:function(l,p,c,d){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var E=l.context,w=l.depthModeForSublayer(0,he.ReadOnly),P=l.colorModeForRenderPass(),L=l.renderPass==="translucent"?l.stencilConfigForOverlap(d):[{},d],z=L[0],H=0,oe=L[1];H<oe.length;H+=1){var ue=oe[H],le=p.getTile(ue);le.needsHillshadePrepare&&l.renderPass==="offscreen"?rh(l,le,c,w,Me.disabled,P):l.renderPass==="translucent"&&Fl(l,le,c,w,z[ue.overscaledZ],P)}E.viewport.set([0,0,l.width,l.height])}},raster:function(l,p,c,d){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&d.length)for(var E=l.context,w=E.gl,P=p.getSource(),L=l.useProgram("raster"),z=l.colorModeForRenderPass(),H=P instanceof vt?[{},d]:l.stencilConfigForOverlap(d),oe=H[0],ue=H[1],le=ue[ue.length-1].overscaledZ,Pe=!l.options.moving,we=0,Ge=ue;we<Ge.length;we+=1){var Ce=Ge[we],Ve=l.depthModeForSublayer(Ce.overscaledZ-le,c.paint.get("raster-opacity")===1?he.ReadWrite:he.ReadOnly,w.LESS),$e=p.getTile(Ce),yt=l.transform.calculatePosMatrix(Ce.toUnwrapped(),Pe);$e.registerFadeDuration(c.paint.get("raster-fade-duration"));var Vt=p.findLoadedParent(Ce,0),Bt=uf($e,Vt,p,c,l.transform),Xt=void 0,vr=void 0,Br=c.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;E.activeTexture.set(w.TEXTURE0),$e.texture.bind(Br,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(w.TEXTURE1),Vt?(Vt.texture.bind(Br,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),Xt=Math.pow(2,Vt.tileID.overscaledZ-$e.tileID.overscaledZ),vr=[$e.tileID.canonical.x*Xt%1,$e.tileID.canonical.y*Xt%1]):$e.texture.bind(Br,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);var Lr=Gf(yt,vr||[0,0],Xt||1,Bt,c);P instanceof vt?L.draw(E,w.TRIANGLES,Ve,Me.disabled,z,Qe.disabled,Lr,c.id,P.boundsBuffer,l.quadTriangleIndexBuffer,P.boundsSegments):L.draw(E,w.TRIANGLES,Ve,oe[Ce.overscaledZ],z,Qe.disabled,Lr,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,p,c){var d=c.paint.get("background-color"),E=c.paint.get("background-opacity");if(E!==0){var w=l.context,P=w.gl,L=l.transform,z=L.tileSize,H=c.paint.get("background-pattern");if(!l.isPatternMissing(H)){var oe=!H&&d.a===1&&E===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===oe){var ue=Me.disabled,le=l.depthModeForSublayer(0,oe==="opaque"?he.ReadWrite:he.ReadOnly),Pe=l.colorModeForRenderPass(),we=l.useProgram(H?"backgroundPattern":"background"),Ge=L.coveringTiles({tileSize:z});H&&(w.activeTexture.set(P.TEXTURE0),l.imageManager.bind(l.context));for(var Ce=c.getCrossfadeParameters(),Ve=0,$e=Ge;Ve<$e.length;Ve+=1){var yt=$e[Ve],Vt=l.transform.calculatePosMatrix(yt.toUnwrapped()),Bt=H?gl(Vt,E,l,H,{tileID:yt,tileSize:z},Ce):kl(Vt,E,d);we.draw(w,P.TRIANGLES,le,ue,Pe,Qe.disabled,Bt,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,p,c){for(var d=0;d<c.length;d++)Tp(l,p,c[d])},custom:function(l,p,c){var d=l.context,E=c.implementation;if(l.renderPass==="offscreen"){var w=E.prerender;w&&(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),w.call(E,d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(Me.disabled);var P=E.renderingMode==="3d"?new he(l.context.gl.LEQUAL,he.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,he.ReadOnly);d.setDepthMode(P),E.render(d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}},qi=function(l,p){this.context=new se(l),this.transform=p,this._tileTextures={},this.setup(),this.numSublayers=Le.maxUnderzooming+Le.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Io,this.gpuTimers={}};qi.prototype.resize=function(l,p){if(this.width=l*g.browser.devicePixelRatio,this.height=p*g.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,d=this.style._order;c<d.length;c+=1)this.style._layers[d[c]].resize()},qi.prototype.setup=function(){var l=this.context,p=new g.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(g.EXTENT,0),p.emplaceBack(0,g.EXTENT),p.emplaceBack(g.EXTENT,g.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(p,ga.members),this.tileExtentSegments=g.SegmentVector.simpleSegment(0,0,4,2);var c=new g.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(g.EXTENT,0),c.emplaceBack(0,g.EXTENT),c.emplaceBack(g.EXTENT,g.EXTENT),this.debugBuffer=l.createVertexBuffer(c,ga.members),this.debugSegments=g.SegmentVector.simpleSegment(0,0,4,5);var d=new g.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(g.EXTENT,0,g.EXTENT,0),d.emplaceBack(0,g.EXTENT,0,g.EXTENT),d.emplaceBack(g.EXTENT,g.EXTENT,g.EXTENT,g.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(d,St.members),this.rasterBoundsSegments=g.SegmentVector.simpleSegment(0,0,4,2);var E=new g.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(E,ga.members),this.viewportSegments=g.SegmentVector.simpleSegment(0,0,4,2);var w=new g.StructArrayLayout1ui2;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(w);var P=new g.StructArrayLayout3ui6;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(P),this.emptyTexture=new g.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var L=this.context.gl;this.stencilClearMode=new Me({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)},qi.prototype.clearStencil=function(){var l=this.context,p=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=g.create();g.ortho(c,0,this.width,this.height,0,0,1),g.scale(c,c,[p.drawingBufferWidth,p.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,p.TRIANGLES,he.disabled,this.stencilClearMode,je.disabled,Qe.disabled,uu(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},qi.prototype._renderTileClippingMasks=function(l,p){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&p&&p.length){this.currentStencilSource=l.source;var c=this.context,d=c.gl;this.nextStencilID+p.length>256&&this.clearStencil(),c.setColorMode(je.disabled),c.setDepthMode(he.disabled);var E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var w=0,P=p;w<P.length;w+=1){var L=P[w],z=this._tileClippingMaskIDs[L.key]=this.nextStencilID++;E.draw(c,d.TRIANGLES,he.disabled,new Me({func:d.ALWAYS,mask:0},z,255,d.KEEP,d.KEEP,d.REPLACE),je.disabled,Qe.disabled,uu(L.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},qi.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,p=this.context.gl;return new Me({func:p.NOTEQUAL,mask:255},l,255,p.KEEP,p.KEEP,p.REPLACE)},qi.prototype.stencilModeForClipping=function(l){var p=this.context.gl;return new Me({func:p.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,p.KEEP,p.KEEP,p.REPLACE)},qi.prototype.stencilConfigForOverlap=function(l){var p,c=this.context.gl,d=l.sort(function(z,H){return H.overscaledZ-z.overscaledZ}),E=d[d.length-1].overscaledZ,w=d[0].overscaledZ-E+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();for(var P={},L=0;L<w;L++)P[L+E]=new Me({func:c.GEQUAL,mask:255},L+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[P,d]}return[(p={},p[E]=Me.disabled,p),d]},qi.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new je([l.CONSTANT_COLOR,l.ONE],new g.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?je.unblended:je.alphaBlended},qi.prototype.depthModeForSublayer=function(l,p,c){if(!this.opaquePassEnabledForLayer())return he.disabled;var d=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new he(c||this.context.gl.LEQUAL,p,[d,d])},qi.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},qi.prototype.render=function(l,p){var c=this;this.style=l,this.options=p,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(g.browser.now()),this.imageManager.beginFrame();var d=this.style._order,E=this.style.sourceCaches;for(var w in E){var P=E[w];P.used&&P.prepare(this.context)}var L,z,H={},oe={},ue={};for(var le in E){var Pe=E[le];H[le]=Pe.getVisibleCoordinates(),oe[le]=H[le].slice().reverse(),ue[le]=Pe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var we=0;we<d.length;we++)if(this.style._layers[d[we]].is3D()){this.opaquePassCutoff=we;break}this.renderPass="offscreen";for(var Ge=0,Ce=d;Ge<Ce.length;Ge+=1){var Ve=this.style._layers[Ce[Ge]];if(Ve.hasOffscreenPass()&&!Ve.isHidden(this.transform.zoom)){var $e=oe[Ve.source];(Ve.type==="custom"||$e.length)&&this.renderLayer(this,E[Ve.source],Ve,$e)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:p.showOverdrawInspector?g.Color.black:g.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=p.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){var yt=this.style._layers[d[this.currentLayer]],Vt=E[yt.source],Bt=H[yt.source];this._renderTileClippingMasks(yt,Bt),this.renderLayer(this,Vt,yt,Bt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){var Xt=this.style._layers[d[this.currentLayer]],vr=E[Xt.source],Br=(Xt.type==="symbol"?ue:oe)[Xt.source];this._renderTileClippingMasks(Xt,H[Xt.source]),this.renderLayer(this,vr,Xt,Br)}this.options.showTileBoundaries&&(g.values(this.style._layers).forEach(function(Lr){Lr.source&&!Lr.isHidden(c.transform.zoom)&&(Lr.source!==(z&&z.id)&&(z=c.style.sourceCaches[Lr.source]),(!L||L.getSource().maxzoom<z.getSource().maxzoom)&&(L=z))}),L&&zl.debug(this,L,L.getVisibleCoordinates())),this.options.showPadding&&function(Lr){var jr=Lr.transform.padding;Ap(Lr,Lr.transform.height-(jr.top||0),3,Bl),Ap(Lr,jr.bottom||0,3,lf),wp(Lr,jr.left||0,3,cf),wp(Lr,Lr.transform.width-(jr.right||0),3,Nl);var Fn=Lr.transform.centerPoint;(function(On,Zn,Oi,un){uc(On,Zn-1,Oi-10,2,20,un),uc(On,Zn-10,Oi-1,20,2,un)})(Lr,Fn.x,Lr.transform.height-Fn.y,kc)}(this),this.context.setDefault()},qi.prototype.renderLayer=function(l,p,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||d.length)&&(this.id=c.id,this.gpuTimingStart(c),zl[c.type](l,p,c,d,this.style.placement.variableOffsets),this.gpuTimingEnd())},qi.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var p=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:p.createQueryEXT()}),c.calls++,p.beginQueryEXT(p.TIME_ELAPSED_EXT,c.query)}},qi.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},qi.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},qi.prototype.queryGpuTimers=function(l){var p={};for(var c in l){var d=l[c],E=this.context.extTimerQuery,w=E.getQueryObjectEXT(d.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(d.query),p[c]=w}return p},qi.prototype.translatePosMatrix=function(l,p,c,d,E){if(!c[0]&&!c[1])return l;var w=E?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(w){var P=Math.sin(w),L=Math.cos(w);c=[c[0]*L-c[1]*P,c[0]*P+c[1]*L]}var z=[E?c[0]:ra(p,c[0],this.transform.zoom),E?c[1]:ra(p,c[1],this.transform.zoom),0],H=new Float32Array(16);return g.translate(H,l,z),H},qi.prototype.saveTileTexture=function(l){var p=this._tileTextures[l.size[0]];p?p.push(l):this._tileTextures[l.size[0]]=[l]},qi.prototype.getTileTexture=function(l){var p=this._tileTextures[l];return p&&p.length>0?p.pop():null},qi.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var p=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!p||!c},qi.prototype.useProgram=function(l,p){this.cache=this.cache||{};var c=""+l+(p?p.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new rf(this.context,l,Es[l],p,Dl[l],this._showOverdrawInspector)),this.cache[c]},qi.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},qi.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},qi.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=g.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new g.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},qi.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var lc=function(l,p){this.points=l,this.planes=p};lc.fromInvProjectionMatrix=function(l,p,c){var d=Math.pow(2,c),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(P){return g.transformMat4([],P,l)}).map(function(P){return g.scale$1([],P,1/P[3]/p*d)}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(P){var L=g.sub([],E[P[0]],E[P[1]]),z=g.sub([],E[P[2]],E[P[1]]),H=g.normalize([],g.cross([],L,z)),oe=-g.dot(H,E[P[1]]);return H.concat(oe)});return new lc(E,w)};var oa=function(l,p){this.min=l,this.max=p,this.center=g.scale$2([],g.add([],this.min,this.max),.5)};oa.prototype.quadrant=function(l){for(var p=[l%2==0,l<2],c=g.clone$2(this.min),d=g.clone$2(this.max),E=0;E<p.length;E++)c[E]=p[E]?this.min[E]:this.center[E],d[E]=p[E]?this.center[E]:this.max[E];return d[2]=this.max[2],new oa(c,d)},oa.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},oa.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},oa.prototype.intersects=function(l){for(var p=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,d=0;d<l.planes.length;d++){for(var E=l.planes[d],w=0,P=0;P<p.length;P++)w+=g.dot$1(E,p[P])>=0;if(w===0)return 0;w!==p.length&&(c=!1)}if(c)return 2;for(var L=0;L<3;L++){for(var z=Number.MAX_VALUE,H=-Number.MAX_VALUE,oe=0;oe<l.points.length;oe++){var ue=l.points[oe][L]-this.min[L];z=Math.min(z,ue),H=Math.max(H,ue)}if(H<0||z>this.max[L]-this.min[L])return 0}return 1};var ju=function(l,p,c,d){if(l===void 0&&(l=0),p===void 0&&(p=0),c===void 0&&(c=0),d===void 0&&(d=0),isNaN(l)||l<0||isNaN(p)||p<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=p,this.left=c,this.right=d};ju.prototype.interpolate=function(l,p,c){return p.top!=null&&l.top!=null&&(this.top=g.number(l.top,p.top,c)),p.bottom!=null&&l.bottom!=null&&(this.bottom=g.number(l.bottom,p.bottom,c)),p.left!=null&&l.left!=null&&(this.left=g.number(l.left,p.left,c)),p.right!=null&&l.right!=null&&(this.right=g.number(l.right,p.right,c)),this},ju.prototype.getCenter=function(l,p){var c=g.clamp((this.left+l-this.right)/2,0,l),d=g.clamp((this.top+p-this.bottom)/2,0,p);return new g.Point(c,d)},ju.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},ju.prototype.clone=function(){return new ju(this.top,this.bottom,this.left,this.right)},ju.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Gi=function(l,p,c,d,E){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=E===void 0||E,this._minZoom=l||0,this._maxZoom=p||22,this._minPitch=c==null?0:c,this._maxPitch=d==null?60:d,this.setMaxBounds(),this.width=0,this.height=0,this._center=new g.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ju,this._posMatrixCache={},this._alignedPosMatrixCache={}},wa={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Gi.prototype.clone=function(){var l=new Gi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},wa.minZoom.get=function(){return this._minZoom},wa.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},wa.maxZoom.get=function(){return this._maxZoom},wa.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},wa.minPitch.get=function(){return this._minPitch},wa.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},wa.maxPitch.get=function(){return this._maxPitch},wa.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},wa.renderWorldCopies.get=function(){return this._renderWorldCopies},wa.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},wa.worldSize.get=function(){return this.tileSize*this.scale},wa.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},wa.size.get=function(){return new g.Point(this.width,this.height)},wa.bearing.get=function(){return-this.angle/Math.PI*180},wa.bearing.set=function(l){var p=-g.wrap(l,-180,180)*Math.PI/180;this.angle!==p&&(this._unmodified=!1,this.angle=p,this._calcMatrices(),this.rotationMatrix=g.create$2(),g.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},wa.pitch.get=function(){return this._pitch/Math.PI*180},wa.pitch.set=function(l){var p=g.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==p&&(this._unmodified=!1,this._pitch=p,this._calcMatrices())},wa.fov.get=function(){return this._fov/Math.PI*180},wa.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},wa.zoom.get=function(){return this._zoom},wa.zoom.set=function(l){var p=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==p&&(this._unmodified=!1,this._zoom=p,this.scale=this.zoomScale(p),this.tileZoom=Math.floor(p),this.zoomFraction=p-this.tileZoom,this._constrain(),this._calcMatrices())},wa.center.get=function(){return this._center},wa.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},wa.padding.get=function(){return this._edgeInsets.toJSON()},wa.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},wa.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Gi.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},Gi.prototype.interpolatePadding=function(l,p,c){this._unmodified=!1,this._edgeInsets.interpolate(l,p,c),this._constrain(),this._calcMatrices()},Gi.prototype.coveringZoomLevel=function(l){var p=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,p)},Gi.prototype.getVisibleUnwrappedCoordinates=function(l){var p=[new g.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new g.Point(0,0)),d=this.pointCoordinate(new g.Point(this.width,0)),E=this.pointCoordinate(new g.Point(this.width,this.height)),w=this.pointCoordinate(new g.Point(0,this.height)),P=Math.floor(Math.min(c.x,d.x,E.x,w.x)),L=Math.floor(Math.max(c.x,d.x,E.x,w.x)),z=P-1;z<=L+1;z++)z!==0&&p.push(new g.UnwrappedTileID(z,l));return p},Gi.prototype.coveringTiles=function(l){var p=this.coveringZoomLevel(l),c=p;if(l.minzoom!==void 0&&p<l.minzoom)return[];l.maxzoom!==void 0&&p>l.maxzoom&&(p=l.maxzoom);var d=g.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,p),w=[E*d.x,E*d.y,0],P=lc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p),L=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(L=p);var z=function(Lr){return{aabb:new oa([Lr*E,0,0],[(Lr+1)*E,E,0]),zoom:0,x:0,y:0,wrap:Lr,fullyVisible:!1}},H=[],oe=[],ue=p,le=l.reparseOverscaled?c:p;if(this._renderWorldCopies)for(var Pe=1;Pe<=3;Pe++)H.push(z(-Pe)),H.push(z(Pe));for(H.push(z(0));H.length>0;){var we=H.pop(),Ge=we.x,Ce=we.y,Ve=we.fullyVisible;if(!Ve){var $e=we.aabb.intersects(P);if($e===0)continue;Ve=$e===2}var yt=we.aabb.distanceX(w),Vt=we.aabb.distanceY(w),Bt=Math.max(Math.abs(yt),Math.abs(Vt));if(we.zoom===ue||Bt>3+(1<<ue-we.zoom)-2&&we.zoom>=L)oe.push({tileID:new g.OverscaledTileID(we.zoom===ue?le:we.zoom,we.wrap,we.zoom,Ge,Ce),distanceSq:g.sqrLen([w[0]-.5-Ge,w[1]-.5-Ce])});else for(var Xt=0;Xt<4;Xt++){var vr=(Ge<<1)+Xt%2,Br=(Ce<<1)+(Xt>>1);H.push({aabb:we.aabb.quadrant(Xt),zoom:we.zoom+1,x:vr,y:Br,wrap:we.wrap,fullyVisible:Ve})}}return oe.sort(function(Lr,jr){return Lr.distanceSq-jr.distanceSq}).map(function(Lr){return Lr.tileID})},Gi.prototype.resize=function(l,p){this.width=l,this.height=p,this.pixelsToGLUnits=[2/l,-2/p],this._constrain(),this._calcMatrices()},wa.unmodified.get=function(){return this._unmodified},Gi.prototype.zoomScale=function(l){return Math.pow(2,l)},Gi.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},Gi.prototype.project=function(l){var p=g.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new g.Point(g.mercatorXfromLng(l.lng)*this.worldSize,g.mercatorYfromLat(p)*this.worldSize)},Gi.prototype.unproject=function(l){return new g.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},wa.point.get=function(){return this.project(this.center)},Gi.prototype.setLocationAtPoint=function(l,p){var c=this.pointCoordinate(p),d=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(l),w=new g.MercatorCoordinate(E.x-(c.x-d.x),E.y-(c.y-d.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())},Gi.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},Gi.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},Gi.prototype.locationCoordinate=function(l){return g.MercatorCoordinate.fromLngLat(l)},Gi.prototype.coordinateLocation=function(l){return l.toLngLat()},Gi.prototype.pointCoordinate=function(l){var p=[l.x,l.y,0,1],c=[l.x,l.y,1,1];g.transformMat4(p,p,this.pixelMatrixInverse),g.transformMat4(c,c,this.pixelMatrixInverse);var d=p[3],E=c[3],w=p[1]/d,P=c[1]/E,L=p[2]/d,z=c[2]/E,H=L===z?0:(0-L)/(z-L);return new g.MercatorCoordinate(g.number(p[0]/d,c[0]/E,H)/this.worldSize,g.number(w,P,H)/this.worldSize)},Gi.prototype.coordinatePoint=function(l){var p=[l.x*this.worldSize,l.y*this.worldSize,0,1];return g.transformMat4(p,p,this.pixelMatrix),new g.Point(p[0]/p[3],p[1]/p[3])},Gi.prototype.getBounds=function(){return new g.LngLatBounds().extend(this.pointLocation(new g.Point(0,0))).extend(this.pointLocation(new g.Point(this.width,0))).extend(this.pointLocation(new g.Point(this.width,this.height))).extend(this.pointLocation(new g.Point(0,this.height)))},Gi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new g.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Gi.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Gi.prototype.calculatePosMatrix=function(l,p){p===void 0&&(p=!1);var c=l.key,d=p?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];var E=l.canonical,w=this.worldSize/this.zoomScale(E.z),P=E.x+Math.pow(2,E.z)*l.wrap,L=g.identity(new Float64Array(16));return g.translate(L,L,[P*w,E.y*w,0]),g.scale(L,L,[w/g.EXTENT,w/g.EXTENT,1]),g.multiply(L,p?this.alignedProjMatrix:this.projMatrix,L),d[c]=new Float32Array(L),d[c]},Gi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Gi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,p,c,d,E=-90,w=90,P=-180,L=180,z=this.size,H=this._unmodified;if(this.latRange){var oe=this.latRange;E=g.mercatorYfromLat(oe[1])*this.worldSize,l=(w=g.mercatorYfromLat(oe[0])*this.worldSize)-E<z.y?z.y/(w-E):0}if(this.lngRange){var ue=this.lngRange;P=g.mercatorXfromLng(ue[0])*this.worldSize,p=(L=g.mercatorXfromLng(ue[1])*this.worldSize)-P<z.x?z.x/(L-P):0}var le=this.point,Pe=Math.max(p||0,l||0);if(Pe)return this.center=this.unproject(new g.Point(p?(L+P)/2:le.x,l?(w+E)/2:le.y)),this.zoom+=this.scaleZoom(Pe),this._unmodified=H,void(this._constraining=!1);if(this.latRange){var we=le.y,Ge=z.y/2;we-Ge<E&&(d=E+Ge),we+Ge>w&&(d=w-Ge)}if(this.lngRange){var Ce=le.x,Ve=z.x/2;Ce-Ve<P&&(c=P+Ve),Ce+Ve>L&&(c=L-Ve)}c===void 0&&d===void 0||(this.center=this.unproject(new g.Point(c!==void 0?c:le.x,d!==void 0?d:le.y))),this._unmodified=H,this._constraining=!1}},Gi.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var p=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),d=Math.sin(c)*this.cameraToCenterDistance/Math.sin(g.clamp(Math.PI-p-c,.01,Math.PI-.01)),E=this.point,w=E.x,P=E.y,L=1.01*(Math.cos(Math.PI/2-this._pitch)*d+this.cameraToCenterDistance),z=this.height/50,H=new Float64Array(16);g.perspective(H,this._fov,this.width/this.height,z,L),H[8]=2*-l.x/this.width,H[9]=2*l.y/this.height,g.scale(H,H,[1,-1,1]),g.translate(H,H,[0,0,-this.cameraToCenterDistance]),g.rotateX(H,H,this._pitch),g.rotateZ(H,H,this.angle),g.translate(H,H,[-w,-P,0]),this.mercatorMatrix=g.scale([],H,[this.worldSize,this.worldSize,this.worldSize]),g.scale(H,H,[1,1,g.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=H,this.invProjMatrix=g.invert([],this.projMatrix);var oe=this.width%2/2,ue=this.height%2/2,le=Math.cos(this.angle),Pe=Math.sin(this.angle),we=w-Math.round(w)+le*oe+Pe*ue,Ge=P-Math.round(P)+le*ue+Pe*oe,Ce=new Float64Array(H);if(g.translate(Ce,Ce,[we>.5?we-1:we,Ge>.5?Ge-1:Ge,0]),this.alignedProjMatrix=Ce,H=g.create(),g.scale(H,H,[this.width/2,-this.height/2,1]),g.translate(H,H,[1,-1,0]),this.labelPlaneMatrix=H,H=g.create(),g.scale(H,H,[1,-1,1]),g.translate(H,H,[-1,-1,0]),g.scale(H,H,[2/this.width,2/this.height,1]),this.glCoordMatrix=H,this.pixelMatrix=g.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(H=g.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=H,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Gi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new g.Point(0,0)),p=[l.x*this.worldSize,l.y*this.worldSize,0,1];return g.transformMat4(p,p,this.pixelMatrix)[3]/this.cameraToCenterDistance},Gi.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new g.Point(0,l))},Gi.prototype.getCameraQueryGeometry=function(l){var p=this.getCameraPoint();if(l.length===1)return[l[0],p];for(var c=p.x,d=p.y,E=p.x,w=p.y,P=0,L=l;P<L.length;P+=1){var z=L[P];c=Math.min(c,z.x),d=Math.min(d,z.y),E=Math.max(E,z.x),w=Math.max(w,z.y)}return[new g.Point(c,d),new g.Point(E,d),new g.Point(E,w),new g.Point(c,w),new g.Point(c,d)]},Object.defineProperties(Gi.prototype,wa);var Ss=function(l){var p,c,d,E;this._hashName=l&&encodeURIComponent(l),g.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(p=this._updateHashUnthrottled.bind(this),c=!1,d=null,E=function(){d=null,c&&(p(),d=setTimeout(E,300),c=!1)},function(){return c=!0,d||E(),d})};Ss.prototype.addTo=function(l){return this._map=l,g.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ss.prototype.remove=function(){return g.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ss.prototype.getHashString=function(l){var p=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,d),w=Math.round(p.lng*E)/E,P=Math.round(p.lat*E)/E,L=this._map.getBearing(),z=this._map.getPitch(),H="";if(H+=l?"/"+w+"/"+P+"/"+c:c+"/"+P+"/"+w,(L||z)&&(H+="/"+Math.round(10*L)/10),z&&(H+="/"+Math.round(z)),this._hashName){var oe=this._hashName,ue=!1,le=g.window.location.hash.slice(1).split("&").map(function(Pe){var we=Pe.split("=")[0];return we===oe?(ue=!0,we+"="+H):Pe}).filter(function(Pe){return Pe});return ue||le.push(oe+"="+H),"#"+le.join("&")}return"#"+H},Ss.prototype._getCurrentHash=function(){var l,p=this,c=g.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(d){return d.split("=")}).forEach(function(d){d[0]===p._hashName&&(l=d)}),(l&&l[1]||"").split("/")):c.split("/")},Ss.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:p,pitch:+(l[4]||0)}),!0}return!1},Ss.prototype._updateHashUnthrottled=function(){var l=g.window.location.href.replace(/(#.+)?$/,this.getHashString());try{g.window.history.replaceState(g.window.history.state,null,l)}catch(p){}};var Dc={linearity:.3,easing:g.bezier(0,0,.3,1)},tl=g.extend({deceleration:2500,maxSpeed:1400},Dc),Za=g.extend({deceleration:20,maxSpeed:1400},Dc),cc=g.extend({deceleration:1e3,maxSpeed:360},Dc),Ul=g.extend({deceleration:1e3,maxSpeed:90},Dc),rl=function(l){this._map=l,this.clear()};function Fc(l,p){(!l.duration||l.duration<p.duration)&&(l.duration=p.duration,l.easing=p.easing)}function Vu(l,p,c){var d=c.maxSpeed,E=c.linearity,w=c.deceleration,P=g.clamp(l*E/(p/1e3),-d,d),L=Math.abs(P)/(w*E);return{easing:c.easing,duration:1e3*L,amount:P*(L/2)}}rl.prototype.clear=function(){this._inertiaBuffer=[]},rl.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:g.browser.now(),settings:l})},rl.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,p=g.browser.now();l.length>0&&p-l[0].time>160;)l.shift()},rl.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var p={zoom:0,bearing:0,pitch:0,pan:new g.Point(0,0),pinchAround:void 0,around:void 0},c=0,d=this._inertiaBuffer;c<d.length;c+=1){var E=d[c].settings;p.zoom+=E.zoomDelta||0,p.bearing+=E.bearingDelta||0,p.pitch+=E.pitchDelta||0,E.panDelta&&p.pan._add(E.panDelta),E.around&&(p.around=E.around),E.pinchAround&&(p.pinchAround=E.pinchAround)}var w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,P={};if(p.pan.mag()){var L=Vu(p.pan.mag(),w,g.extend({},tl,l||{}));P.offset=p.pan.mult(L.amount/p.pan.mag()),P.center=this._map.transform.center,Fc(P,L)}if(p.zoom){var z=Vu(p.zoom,w,Za);P.zoom=this._map.transform.zoom+z.amount,Fc(P,z)}if(p.bearing){var H=Vu(p.bearing,w,cc);P.bearing=this._map.transform.bearing+g.clamp(H.amount,-179,179),Fc(P,H)}if(p.pitch){var oe=Vu(p.pitch,w,Ul);P.pitch=this._map.transform.pitch+oe.amount,Fc(P,oe)}if(P.zoom||P.bearing){var ue=p.pinchAround===void 0?p.around:p.pinchAround;P.around=ue?this._map.unproject(ue):this._map.getCenter()}return this.clear(),g.extend(P,{noMoveStart:!0})}};var vo=function(l){function p(d,E,w,P){P===void 0&&(P={});var L=X.mousePos(E.getCanvasContainer(),w),z=E.unproject(L);l.call(this,d,g.extend({point:L,lngLat:z,originalEvent:w},P)),this._defaultPrevented=!1,this.target=E}l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p;var c={defaultPrevented:{configurable:!0}};return p.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(p.prototype,c),p}(g.Event),Zl=function(l){function p(d,E,w){var P=d==="touchend"?w.changedTouches:w.touches,L=X.touchPos(E.getCanvasContainer(),P),z=L.map(function(ue){return E.unproject(ue)}),H=L.reduce(function(ue,le,Pe,we){return ue.add(le.div(we.length))},new g.Point(0,0)),oe=E.unproject(H);l.call(this,d,{points:L,point:H,lngLats:z,lngLat:oe,originalEvent:w}),this._defaultPrevented=!1}l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p;var c={defaultPrevented:{configurable:!0}};return p.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(p.prototype,c),p}(g.Event),fc=function(l){function p(d,E,w){l.call(this,d,{originalEvent:w}),this._defaultPrevented=!1}l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p;var c={defaultPrevented:{configurable:!0}};return p.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(p.prototype,c),p}(g.Event),mo=function(l,p){this._map=l,this._clickTolerance=p.clickTolerance};mo.prototype.reset=function(){delete this._mousedownPos},mo.prototype.wheel=function(l){return this._firePreventable(new fc(l.type,this._map,l))},mo.prototype.mousedown=function(l,p){return this._mousedownPos=p,this._firePreventable(new vo(l.type,this._map,l))},mo.prototype.mouseup=function(l){this._map.fire(new vo(l.type,this._map,l))},mo.prototype.click=function(l,p){this._mousedownPos&&this._mousedownPos.dist(p)>=this._clickTolerance||this._map.fire(new vo(l.type,this._map,l))},mo.prototype.dblclick=function(l){return this._firePreventable(new vo(l.type,this._map,l))},mo.prototype.mouseover=function(l){this._map.fire(new vo(l.type,this._map,l))},mo.prototype.mouseout=function(l){this._map.fire(new vo(l.type,this._map,l))},mo.prototype.touchstart=function(l){return this._firePreventable(new Zl(l.type,this._map,l))},mo.prototype.touchmove=function(l){this._map.fire(new Zl(l.type,this._map,l))},mo.prototype.touchend=function(l){this._map.fire(new Zl(l.type,this._map,l))},mo.prototype.touchcancel=function(l){this._map.fire(new Zl(l.type,this._map,l))},mo.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},mo.prototype.isEnabled=function(){return!0},mo.prototype.isActive=function(){return!1},mo.prototype.enable=function(){},mo.prototype.disable=function(){};var gn=function(l){this._map=l};gn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},gn.prototype.mousemove=function(l){this._map.fire(new vo(l.type,this._map,l))},gn.prototype.mousedown=function(){this._delayContextMenu=!0},gn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new vo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},gn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new vo(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},gn.prototype.isEnabled=function(){return!0},gn.prototype.isActive=function(){return!1},gn.prototype.enable=function(){},gn.prototype.disable=function(){};var uo=function(l,p){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=p.clickTolerance||1};function nl(l,p){for(var c={},d=0;d<l.length;d++)c[l[d].identifier]=p[d];return c}uo.prototype.isEnabled=function(){return!!this._enabled},uo.prototype.isActive=function(){return!!this._active},uo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},uo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},uo.prototype.mousedown=function(l,p){this.isEnabled()&&l.shiftKey&&l.button===0&&(X.disableDrag(),this._startPos=this._lastPos=p,this._active=!0)},uo.prototype.mousemoveWindow=function(l,p){if(this._active){var c=p;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var d=this._startPos;this._lastPos=c,this._box||(this._box=X.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var E=Math.min(d.x,c.x),w=Math.max(d.x,c.x),P=Math.min(d.y,c.y),L=Math.max(d.y,c.y);X.setTransform(this._box,"translate("+E+"px,"+P+"px)"),this._box.style.width=w-E+"px",this._box.style.height=L-P+"px"}}},uo.prototype.mouseupWindow=function(l,p){var c=this;if(this._active&&l.button===0){var d=this._startPos,E=p;if(this.reset(),X.suppressClick(),d.x!==E.x||d.y!==E.y)return this._map.fire(new g.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(w){return w.fitScreenCoordinates(d,E,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},uo.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},uo.prototype.blur=function(){this.reset()},uo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(X.remove(this._box),this._box=null),X.enableDrag(),delete this._startPos,delete this._lastPos},uo.prototype._fireEvent=function(l,p){return this._map.fire(new g.Event(l,{originalEvent:p}))};var La=function(l){this.reset(),this.numTouches=l.numTouches};La.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},La.prototype.touchstart=function(l,p,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){for(var E=new g.Point(0,0),w=0,P=d;w<P.length;w+=1)E._add(P[w]);return E.div(d.length)}(p),this.touches=nl(c,p)))},La.prototype.touchmove=function(l,p,c){if(!this.aborted&&this.centroid){var d=nl(c,p);for(var E in this.touches){var w=d[E];(!w||w.dist(this.touches[E])>30)&&(this.aborted=!0)}}},La.prototype.touchend=function(l,p,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var d=!this.aborted&&this.centroid;if(this.reset(),d)return d}};var cu=function(l){this.singleTap=new La(l),this.numTaps=l.numTaps,this.reset()};cu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},cu.prototype.touchstart=function(l,p,c){this.singleTap.touchstart(l,p,c)},cu.prototype.touchmove=function(l,p,c){this.singleTap.touchmove(l,p,c)},cu.prototype.touchend=function(l,p,c){var d=this.singleTap.touchend(l,p,c);if(d){var E=l.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(d)<30;if(E&&w||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}};var ks=function(){this._zoomIn=new cu({numTouches:1,numTaps:2}),this._zoomOut=new cu({numTouches:2,numTaps:1}),this.reset()};ks.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},ks.prototype.touchstart=function(l,p,c){this._zoomIn.touchstart(l,p,c),this._zoomOut.touchstart(l,p,c)},ks.prototype.touchmove=function(l,p,c){this._zoomIn.touchmove(l,p,c),this._zoomOut.touchmove(l,p,c)},ks.prototype.touchend=function(l,p,c){var d=this,E=this._zoomIn.touchend(l,p,c),w=this._zoomOut.touchend(l,p,c);return E?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(E)},{originalEvent:l})}}):w?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(w)},{originalEvent:l})}}):void 0},ks.prototype.touchcancel=function(){this.reset()},ks.prototype.enable=function(){this._enabled=!0},ks.prototype.disable=function(){this._enabled=!1,this.reset()},ks.prototype.isEnabled=function(){return this._enabled},ks.prototype.isActive=function(){return this._active};var Bc={0:1,2:2},Kr=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};Kr.prototype.blur=function(){this.reset()},Kr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Kr.prototype._correctButton=function(l,p){return!1},Kr.prototype._move=function(l,p){return{}},Kr.prototype.mousedown=function(l,p){if(!this._lastPoint){var c=X.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=p,this._eventButton=c)}},Kr.prototype.mousemoveWindow=function(l,p){var c=this._lastPoint;if(c){if(l.preventDefault(),function(d,E){var w=Bc[E];return d.buttons===void 0||(d.buttons&w)!==w}(l,this._eventButton))this.reset();else if(this._moved||!(p.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=p,this._move(c,p)}},Kr.prototype.mouseupWindow=function(l){this._lastPoint&&X.mouseButton(l)===this._eventButton&&(this._moved&&X.suppressClick(),this.reset())},Kr.prototype.enable=function(){this._enabled=!0},Kr.prototype.disable=function(){this._enabled=!1,this.reset()},Kr.prototype.isEnabled=function(){return this._enabled},Kr.prototype.isActive=function(){return this._active};var ff=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.mousedown=function(c,d){l.prototype.mousedown.call(this,c,d),this._lastPoint&&(this._active=!0)},p.prototype._correctButton=function(c,d){return d===0&&!c.ctrlKey},p.prototype._move=function(c,d){return{around:d,panDelta:d.sub(c)}},p}(Kr),pc=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},p.prototype._move=function(c,d){var E=.8*(d.x-c.x);if(E)return this._active=!0,{bearingDelta:E}},p.prototype.contextmenu=function(c){c.preventDefault()},p}(Kr),Gu=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},p.prototype._move=function(c,d){var E=-.5*(d.y-c.y);if(E)return this._active=!0,{pitchDelta:E}},p.prototype.contextmenu=function(c){c.preventDefault()},p}(Kr),ka=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};ka.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new g.Point(0,0)},ka.prototype.touchstart=function(l,p,c){return this._calculateTransform(l,p,c)},ka.prototype.touchmove=function(l,p,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,p,c)},ka.prototype.touchend=function(l,p,c){this._calculateTransform(l,p,c),this._active&&c.length<this._minTouches&&this.reset()},ka.prototype.touchcancel=function(){this.reset()},ka.prototype._calculateTransform=function(l,p,c){c.length>0&&(this._active=!0);var d=nl(c,p),E=new g.Point(0,0),w=new g.Point(0,0),P=0;for(var L in d){var z=d[L],H=this._touches[L];H&&(E._add(z),w._add(z.sub(H)),P++,d[L]=z)}if(this._touches=d,!(P<this._minTouches)&&w.mag()){var oe=w.div(P);if(this._sum._add(oe),!(this._sum.mag()<this._clickTolerance))return{around:E.div(P),panDelta:oe}}},ka.prototype.enable=function(){this._enabled=!0},ka.prototype.disable=function(){this._enabled=!1,this.reset()},ka.prototype.isEnabled=function(){return this._enabled},ka.prototype.isActive=function(){return this._active};var Cs=function(){this.reset()};function Nc(l,p,c){for(var d=0;d<l.length;d++)if(l[d].identifier===c)return p[d]}function Hu(l,p){return Math.log(l/p)/Math.LN2}Cs.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Cs.prototype._start=function(l){},Cs.prototype._move=function(l,p,c){return{}},Cs.prototype.touchstart=function(l,p,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([p[0],p[1]]))},Cs.prototype.touchmove=function(l,p,c){if(this._firstTwoTouches){l.preventDefault();var d=this._firstTwoTouches,E=d[1],w=Nc(c,p,d[0]),P=Nc(c,p,E);if(w&&P){var L=this._aroundCenter?null:w.add(P).div(2);return this._move([w,P],L,l)}}},Cs.prototype.touchend=function(l,p,c){if(this._firstTwoTouches){var d=this._firstTwoTouches,E=d[1],w=Nc(c,p,d[0]),P=Nc(c,p,E);w&&P||(this._active&&X.suppressClick(),this.reset())}},Cs.prototype.touchcancel=function(){this.reset()},Cs.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},Cs.prototype.disable=function(){this._enabled=!1,this.reset()},Cs.prototype.isEnabled=function(){return this._enabled},Cs.prototype.isActive=function(){return this._active};var rs=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},p.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},p.prototype._move=function(c,d){var E=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Hu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Hu(this._distance,E),pinchAround:d}},p}(Cs);function fu(l,p){return 180*l.angleWith(p)/Math.PI}var Mp=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},p.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},p.prototype._move=function(c,d){var E=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:fu(this._vector,E),pinchAround:d}},p.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var d=25/(Math.PI*this._minDiameter)*360,E=fu(c,this._startVector);return Math.abs(E)<d},p}(Cs);function zc(l){return Math.abs(l.y)>Math.abs(l.x)}var Uc=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},p.prototype._start=function(c){this._lastPoints=c,zc(c[0].sub(c[1]))&&(this._valid=!1)},p.prototype._move=function(c,d,E){var w=c[0].sub(this._lastPoints[0]),P=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,P,E.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(w.y+P.y)/2*-.5}},p.prototype.gestureBeginsVertically=function(c,d,E){if(this._valid!==void 0)return this._valid;var w=c.mag()>=2,P=d.mag()>=2;if(w||P){if(!w||!P)return this._firstMove===void 0&&(this._firstMove=E),E-this._firstMove<100&&void 0;var L=c.y>0==d.y>0;return zc(c)&&zc(d)&&L}},p}(Cs),pf={panStep:100,bearingStep:15,pitchStep:10},pu=function(){var l=pf;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function Us(l){return l*(2-l)}pu.prototype.blur=function(){this.reset()},pu.prototype.reset=function(){this._active=!1},pu.prototype.keydown=function(l){var p=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,d=0,E=0,w=0,P=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?d=-1:(l.preventDefault(),w=-1);break;case 39:l.shiftKey?d=1:(l.preventDefault(),w=1);break;case 38:l.shiftKey?E=1:(l.preventDefault(),P=-1);break;case 40:l.shiftKey?E=-1:(l.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(d=0,E=0),{cameraAnimation:function(L){var z=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:Us,zoom:c?Math.round(z)+c*(l.shiftKey?2:1):z,bearing:L.getBearing()+d*p._bearingStep,pitch:L.getPitch()+E*p._pitchStep,offset:[-w*p._panStep,-P*p._panStep],center:L.getCenter()},{originalEvent:l})}}}},pu.prototype.enable=function(){this._enabled=!0},pu.prototype.disable=function(){this._enabled=!1,this.reset()},pu.prototype.isEnabled=function(){return this._enabled},pu.prototype.isActive=function(){return this._active},pu.prototype.disableRotation=function(){this._rotationDisabled=!0},pu.prototype.enableRotation=function(){this._rotationDisabled=!1};var Ii=function(l,p){this._map=l,this._el=l.getCanvasContainer(),this._handler=p,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,g.bindAll(["_onTimeout"],this)};Ii.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Ii.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Ii.prototype.isEnabled=function(){return!!this._enabled},Ii.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Ii.prototype.isZooming=function(){return!!this._zooming},Ii.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Ii.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Ii.prototype.wheel=function(l){if(this.isEnabled()){var p=l.deltaMode===g.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=g.browser.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,p!==0&&p%4.000244140625==0?this._type="wheel":p!==0&&Math.abs(p)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=p,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(d*p)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,p+=this._lastValue)),l.shiftKey&&p&&(p/=4),this._type&&(this._lastWheelEvent=l,this._delta-=p,this._active||this._start(l)),l.preventDefault()}},Ii.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Ii.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var p=X.mousePos(this._el,l);this._around=g.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(p)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Ii.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var p=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,d=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&d!==0&&(d=1/d);var E=typeof this._targetZoom=="number"?p.zoomScale(this._targetZoom):p.scale;this._targetZoom=Math.min(p.maxZoom,Math.max(p.minZoom,p.scaleZoom(E*d))),this._type==="wheel"&&(this._startZoom=p.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var w,P=typeof this._targetZoom=="number"?this._targetZoom:p.zoom,L=this._startZoom,z=this._easing,H=!1;if(this._type==="wheel"&&L&&z){var oe=Math.min((g.browser.now()-this._lastWheelEventTime)/200,1),ue=z(oe);w=g.number(L,P,ue),oe<1?this._frameId||(this._frameId=!0):H=!0}else w=P,H=!0;return this._active=!0,H&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!H,zoomDelta:w-p.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Ii.prototype._smoothOutEasing=function(l){var p=g.ease;if(this._prevEase){var c=this._prevEase,d=(g.browser.now()-c.start)/c.duration,E=c.easing(d+.01)-c.easing(d),w=.27/Math.sqrt(E*E+1e-4)*.01,P=Math.sqrt(.0729-w*w);p=g.bezier(w,P,.25,1)}return this._prevEase={start:g.browser.now(),duration:l,easing:p},p},Ii.prototype.blur=function(){this.reset()},Ii.prototype.reset=function(){this._active=!1};var Su=function(l,p){this._clickZoom=l,this._tapZoom=p};Su.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Su.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Su.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Su.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Zs=function(){this.reset()};Zs.prototype.reset=function(){this._active=!1},Zs.prototype.blur=function(){this.reset()},Zs.prototype.dblclick=function(l,p){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(p)},{originalEvent:l})}}},Zs.prototype.enable=function(){this._enabled=!0},Zs.prototype.disable=function(){this._enabled=!1,this.reset()},Zs.prototype.isEnabled=function(){return this._enabled},Zs.prototype.isActive=function(){return this._active};var bo=function(){this._tap=new cu({numTouches:1,numTaps:1}),this.reset()};bo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},bo.prototype.touchstart=function(l,p,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=p[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,p,c))},bo.prototype.touchmove=function(l,p,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var d=p[0],E=d.y-this._swipePoint.y;return this._swipePoint=d,l.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(l,p,c)},bo.prototype.touchend=function(l,p,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,p,c)&&(this._tapTime=l.timeStamp)},bo.prototype.touchcancel=function(){this.reset()},bo.prototype.enable=function(){this._enabled=!0},bo.prototype.disable=function(){this._enabled=!1,this.reset()},bo.prototype.isEnabled=function(){return this._enabled},bo.prototype.isActive=function(){return this._active};var yl=function(l,p,c){this._el=l,this._mousePan=p,this._touchPan=c};yl.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},yl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},yl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},yl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var il=function(l,p,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=p,this._mousePitch=c};il.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},il.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},il.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},il.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Qs=function(l,p,c,d){this._el=l,this._touchZoom=p,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0};Qs.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Qs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Qs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Qs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Qs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Qs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var ls=function(l){return l.zoom||l.drag||l.pitch||l.rotate},js=function(l){function p(){l.apply(this,arguments)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p}(g.Event);function Dn(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var An=function(l,p){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new rl(l),this._bearingSnap=p.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(p),g.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[g.window.document,"mousemove",{capture:!0}],[g.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[g.window,"blur",void 0]];for(var d=0,E=this._listeners;d<E.length;d+=1){var w=E[d],P=w[0];X.addEventListener(P,w[1],P===g.window.document?this.handleWindowEvent:this.handleEvent,w[2])}};An.prototype.destroy=function(){for(var l=0,p=this._listeners;l<p.length;l+=1){var c=p[l],d=c[0];X.removeEventListener(d,c[1],d===g.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},An.prototype._addDefaultHandlers=function(l){var p=this._map,c=p.getCanvasContainer();this._add("mapEvent",new mo(p,l));var d=p.boxZoom=new uo(p,l);this._add("boxZoom",d);var E=new ks,w=new Zs;p.doubleClickZoom=new Su(w,E),this._add("tapZoom",E),this._add("clickZoom",w);var P=new bo;this._add("tapDragZoom",P);var L=p.touchPitch=new Uc;this._add("touchPitch",L);var z=new pc(l),H=new Gu(l);p.dragRotate=new il(l,z,H),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",H,["mouseRotate"]);var oe=new ff(l),ue=new ka(l);p.dragPan=new yl(c,oe,ue),this._add("mousePan",oe),this._add("touchPan",ue,["touchZoom","touchRotate"]);var le=new Mp,Pe=new rs;p.touchZoomRotate=new Qs(c,Pe,le,P),this._add("touchRotate",le,["touchPan","touchZoom"]),this._add("touchZoom",Pe,["touchPan","touchRotate"]);var we=p.scrollZoom=new Ii(p,this);this._add("scrollZoom",we,["mousePan"]);var Ge=p.keyboard=new pu;this._add("keyboard",Ge),this._add("blockableMapEvent",new gn(p));for(var Ce=0,Ve=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ce<Ve.length;Ce+=1){var $e=Ve[Ce];l.interactive&&l[$e]&&p[$e].enable(l[$e])}},An.prototype._add=function(l,p,c){this._handlers.push({handlerName:l,handler:p,allowed:c}),this._handlersById[l]=p},An.prototype.stop=function(l){if(!this._updatingCamera){for(var p=0,c=this._handlers;p<c.length;p+=1)c[p].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},An.prototype.isActive=function(){for(var l=0,p=this._handlers;l<p.length;l+=1)if(p[l].handler.isActive())return!0;return!1},An.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},An.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},An.prototype.isMoving=function(){return Boolean(ls(this._eventsInProgress))||this.isZooming()},An.prototype._blockedByActive=function(l,p,c){for(var d in l)if(d!==c&&(!p||p.indexOf(d)<0))return!0;return!1},An.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},An.prototype._getMapTouches=function(l){for(var p=[],c=0,d=l;c<d.length;c+=1){var E=d[c];this._el.contains(E.target)&&p.push(E)}return p},An.prototype.handleEvent=function(l,p){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,d={needsRenderFrame:!1},E={},w={},P=l.touches?this._getMapTouches(l.touches):void 0,L=P?X.touchPos(this._el,P):X.mousePos(this._el,l),z=0,H=this._handlers;z<H.length;z+=1){var oe=H[z],ue=oe.handlerName,le=oe.handler,Pe=oe.allowed;if(le.isEnabled()){var we=void 0;this._blockedByActive(w,Pe,ue)?le.reset():le[p||l.type]&&(we=le[p||l.type](l,L,P),this.mergeHandlerResult(d,E,we,ue,c),we&&we.needsRenderFrame&&this._triggerRenderFrame()),(we||le.isActive())&&(w[ue]=le)}}var Ge={};for(var Ce in this._previousActiveHandlers)w[Ce]||(Ge[Ce]=c);this._previousActiveHandlers=w,(Object.keys(Ge).length||Dn(d))&&(this._changes.push([d,E,Ge]),this._triggerRenderFrame()),(Object.keys(w).length||Dn(d))&&this._map._stop(!0),this._updatingCamera=!1;var Ve=d.cameraAnimation;Ve&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ve(this._map))},An.prototype.mergeHandlerResult=function(l,p,c,d,E){if(c){g.extend(l,c);var w={handlerName:d,originalEvent:c.originalEvent||E};c.zoomDelta!==void 0&&(p.zoom=w),c.panDelta!==void 0&&(p.drag=w),c.pitchDelta!==void 0&&(p.pitch=w),c.bearingDelta!==void 0&&(p.rotate=w)}},An.prototype._applyChanges=function(){for(var l={},p={},c={},d=0,E=this._changes;d<E.length;d+=1){var w=E[d],P=w[0],L=w[1],z=w[2];P.panDelta&&(l.panDelta=(l.panDelta||new g.Point(0,0))._add(P.panDelta)),P.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+P.zoomDelta),P.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+P.bearingDelta),P.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+P.pitchDelta),P.around!==void 0&&(l.around=P.around),P.pinchAround!==void 0&&(l.pinchAround=P.pinchAround),P.noInertia&&(l.noInertia=P.noInertia),g.extend(p,L),g.extend(c,z)}this._updateMapTransform(l,p,c),this._changes=[]},An.prototype._updateMapTransform=function(l,p,c){var d=this._map,E=d.transform;if(!Dn(l))return this._fireEvents(p,c,!0);var w=l.panDelta,P=l.zoomDelta,L=l.bearingDelta,z=l.pitchDelta,H=l.around,oe=l.pinchAround;oe!==void 0&&(H=oe),d._stop(!0),H=H||d.transform.centerPoint;var ue=E.pointLocation(w?H.sub(w):H);L&&(E.bearing+=L),z&&(E.pitch+=z),P&&(E.zoom+=P),E.setLocationAtPoint(ue,H),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(p,c,!0)},An.prototype._fireEvents=function(l,p,c){var d=this,E=ls(this._eventsInProgress),w=ls(l),P={};for(var L in l)this._eventsInProgress[L]||(P[L+"start"]=l[L].originalEvent),this._eventsInProgress[L]=l[L];for(var z in!E&&w&&this._fireEvent("movestart",w.originalEvent),P)this._fireEvent(z,P[z]);for(var H in w&&this._fireEvent("move",w.originalEvent),l)this._fireEvent(H,l[H].originalEvent);var oe,ue={};for(var le in this._eventsInProgress){var Pe=this._eventsInProgress[le],we=Pe.handlerName,Ge=Pe.originalEvent;this._handlersById[we].isActive()||(delete this._eventsInProgress[le],ue[le+"end"]=oe=p[we]||Ge)}for(var Ce in ue)this._fireEvent(Ce,ue[Ce]);var Ve=ls(this._eventsInProgress);if(c&&(E||w)&&!Ve){this._updatingCamera=!0;var $e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),yt=function(Vt){return Vt!==0&&-d._bearingSnap<Vt&&Vt<d._bearingSnap};$e?(yt($e.bearing||this._map.getBearing())&&($e.bearing=0),this._map.easeTo($e,{originalEvent:oe})):(this._map.fire(new g.Event("moveend",{originalEvent:oe})),yt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},An.prototype._fireEvent=function(l,p){this._map.fire(new g.Event(l,p?{originalEvent:p}:{}))},An.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(p){delete l._frameId,l.handleEvent(new js("renderFrame",{timeStamp:p})),l._applyChanges()})},An.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Zc=function(l){function p(c,d){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,g.bindAll(["_renderFrameCallback"],this)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.getCenter=function(){return new g.LngLat(this.transform.center.lng,this.transform.center.lat)},p.prototype.setCenter=function(c,d){return this.jumpTo({center:c},d)},p.prototype.panBy=function(c,d,E){return c=g.Point.convert(c).mult(-1),this.panTo(this.transform.center,g.extend({offset:c},d),E)},p.prototype.panTo=function(c,d,E){return this.easeTo(g.extend({center:c},d),E)},p.prototype.getZoom=function(){return this.transform.zoom},p.prototype.setZoom=function(c,d){return this.jumpTo({zoom:c},d),this},p.prototype.zoomTo=function(c,d,E){return this.easeTo(g.extend({zoom:c},d),E)},p.prototype.zoomIn=function(c,d){return this.zoomTo(this.getZoom()+1,c,d),this},p.prototype.zoomOut=function(c,d){return this.zoomTo(this.getZoom()-1,c,d),this},p.prototype.getBearing=function(){return this.transform.bearing},p.prototype.setBearing=function(c,d){return this.jumpTo({bearing:c},d),this},p.prototype.getPadding=function(){return this.transform.padding},p.prototype.setPadding=function(c,d){return this.jumpTo({padding:c},d),this},p.prototype.rotateTo=function(c,d,E){return this.easeTo(g.extend({bearing:c},d),E)},p.prototype.resetNorth=function(c,d){return this.rotateTo(0,g.extend({duration:1e3},c),d),this},p.prototype.resetNorthPitch=function(c,d){return this.easeTo(g.extend({bearing:0,pitch:0,duration:1e3},c),d),this},p.prototype.snapToNorth=function(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this},p.prototype.getPitch=function(){return this.transform.pitch},p.prototype.setPitch=function(c,d){return this.jumpTo({pitch:c},d),this},p.prototype.cameraForBounds=function(c,d){c=g.LngLatBounds.convert(c);var E=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),E,d)},p.prototype._cameraForBoxAndBearing=function(c,d,E,w){var P={top:0,bottom:0,right:0,left:0};if(typeof(w=g.extend({padding:P,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){var L=w.padding;w.padding={top:L,bottom:L,right:L,left:L}}w.padding=g.extend(P,w.padding);var z=this.transform,H=z.padding,oe=z.project(g.LngLat.convert(c)),ue=z.project(g.LngLat.convert(d)),le=oe.rotate(-E*Math.PI/180),Pe=ue.rotate(-E*Math.PI/180),we=new g.Point(Math.max(le.x,Pe.x),Math.max(le.y,Pe.y)),Ge=new g.Point(Math.min(le.x,Pe.x),Math.min(le.y,Pe.y)),Ce=we.sub(Ge),Ve=(z.width-(H.left+H.right+w.padding.left+w.padding.right))/Ce.x,$e=(z.height-(H.top+H.bottom+w.padding.top+w.padding.bottom))/Ce.y;if(!($e<0||Ve<0)){var yt=Math.min(z.scaleZoom(z.scale*Math.min(Ve,$e)),w.maxZoom),Vt=typeof w.offset.x=="number"?new g.Point(w.offset.x,w.offset.y):g.Point.convert(w.offset),Bt=new g.Point((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(E*Math.PI/180),Xt=Vt.add(Bt).mult(z.scale/z.zoomScale(yt));return{center:z.unproject(oe.add(ue).div(2).sub(Xt)),zoom:yt,bearing:E}}g.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},p.prototype.fitBounds=function(c,d,E){return this._fitInternal(this.cameraForBounds(c,d),d,E)},p.prototype.fitScreenCoordinates=function(c,d,E,w,P){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(g.Point.convert(c)),this.transform.pointLocation(g.Point.convert(d)),E,w),w,P)},p.prototype._fitInternal=function(c,d,E){return c?(delete(d=g.extend(c,d)).padding,d.linear?this.easeTo(d,E):this.flyTo(d,E)):this},p.prototype.jumpTo=function(c,d){this.stop();var E=this.transform,w=!1,P=!1,L=!1;return"zoom"in c&&E.zoom!==+c.zoom&&(w=!0,E.zoom=+c.zoom),c.center!==void 0&&(E.center=g.LngLat.convert(c.center)),"bearing"in c&&E.bearing!==+c.bearing&&(P=!0,E.bearing=+c.bearing),"pitch"in c&&E.pitch!==+c.pitch&&(L=!0,E.pitch=+c.pitch),c.padding==null||E.isPaddingEqual(c.padding)||(E.padding=c.padding),this.fire(new g.Event("movestart",d)).fire(new g.Event("move",d)),w&&this.fire(new g.Event("zoomstart",d)).fire(new g.Event("zoom",d)).fire(new g.Event("zoomend",d)),P&&this.fire(new g.Event("rotatestart",d)).fire(new g.Event("rotate",d)).fire(new g.Event("rotateend",d)),L&&this.fire(new g.Event("pitchstart",d)).fire(new g.Event("pitch",d)).fire(new g.Event("pitchend",d)),this.fire(new g.Event("moveend",d))},p.prototype.easeTo=function(c,d){var E=this;this._stop(!1,c.easeId),((c=g.extend({offset:[0,0],duration:500,easing:g.ease},c)).animate===!1||!c.essential&&g.browser.prefersReducedMotion)&&(c.duration=0);var w=this.transform,P=this.getZoom(),L=this.getBearing(),z=this.getPitch(),H=this.getPadding(),oe="zoom"in c?+c.zoom:P,ue="bearing"in c?this._normalizeBearing(c.bearing,L):L,le="pitch"in c?+c.pitch:z,Pe="padding"in c?c.padding:w.padding,we=g.Point.convert(c.offset),Ge=w.centerPoint.add(we),Ce=w.pointLocation(Ge),Ve=g.LngLat.convert(c.center||Ce);this._normalizeCenter(Ve);var $e,yt,Vt=w.project(Ce),Bt=w.project(Ve).sub(Vt),Xt=w.zoomScale(oe-P);c.around&&($e=g.LngLat.convert(c.around),yt=w.locationPoint($e));var vr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||oe!==P,this._rotating=this._rotating||L!==ue,this._pitching=this._pitching||le!==z,this._padding=!w.isPaddingEqual(Pe),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,vr),this._ease(function(Br){if(E._zooming&&(w.zoom=g.number(P,oe,Br)),E._rotating&&(w.bearing=g.number(L,ue,Br)),E._pitching&&(w.pitch=g.number(z,le,Br)),E._padding&&(w.interpolatePadding(H,Pe,Br),Ge=w.centerPoint.add(we)),$e)w.setLocationAtPoint($e,yt);else{var Lr=w.zoomScale(w.zoom-P),jr=oe>P?Math.min(2,Xt):Math.max(.5,Xt),Fn=Math.pow(jr,1-Br),On=w.unproject(Vt.add(Bt.mult(Br*Fn)).mult(Lr));w.setLocationAtPoint(w.renderWorldCopies?On.wrap():On,Ge)}E._fireMoveEvents(d)},function(Br){E._afterEase(d,Br)},c),this},p.prototype._prepareEase=function(c,d,E){E===void 0&&(E={}),this._moving=!0,d||E.moving||this.fire(new g.Event("movestart",c)),this._zooming&&!E.zooming&&this.fire(new g.Event("zoomstart",c)),this._rotating&&!E.rotating&&this.fire(new g.Event("rotatestart",c)),this._pitching&&!E.pitching&&this.fire(new g.Event("pitchstart",c))},p.prototype._fireMoveEvents=function(c){this.fire(new g.Event("move",c)),this._zooming&&this.fire(new g.Event("zoom",c)),this._rotating&&this.fire(new g.Event("rotate",c)),this._pitching&&this.fire(new g.Event("pitch",c))},p.prototype._afterEase=function(c,d){if(!this._easeId||!d||this._easeId!==d){delete this._easeId;var E=this._zooming,w=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,E&&this.fire(new g.Event("zoomend",c)),w&&this.fire(new g.Event("rotateend",c)),P&&this.fire(new g.Event("pitchend",c)),this.fire(new g.Event("moveend",c))}},p.prototype.flyTo=function(c,d){var E=this;if(!c.essential&&g.browser.prefersReducedMotion){var w=g.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(w,d)}this.stop(),c=g.extend({offset:[0,0],speed:1.2,curve:1.42,easing:g.ease},c);var P=this.transform,L=this.getZoom(),z=this.getBearing(),H=this.getPitch(),oe=this.getPadding(),ue="zoom"in c?g.clamp(+c.zoom,P.minZoom,P.maxZoom):L,le="bearing"in c?this._normalizeBearing(c.bearing,z):z,Pe="pitch"in c?+c.pitch:H,we="padding"in c?c.padding:P.padding,Ge=P.zoomScale(ue-L),Ce=g.Point.convert(c.offset),Ve=P.centerPoint.add(Ce),$e=P.pointLocation(Ve),yt=g.LngLat.convert(c.center||$e);this._normalizeCenter(yt);var Vt=P.project($e),Bt=P.project(yt).sub(Vt),Xt=c.curve,vr=Math.max(P.width,P.height),Br=vr/Ge,Lr=Bt.mag();if("minZoom"in c){var jr=g.clamp(Math.min(c.minZoom,L,ue),P.minZoom,P.maxZoom),Fn=vr/P.zoomScale(jr-L);Xt=Math.sqrt(Fn/Lr*2)}var On=Xt*Xt;function Zn(Kn){var Wn=(Br*Br-vr*vr+(Kn?-1:1)*On*On*Lr*Lr)/(2*(Kn?Br:vr)*On*Lr);return Math.log(Math.sqrt(Wn*Wn+1)-Wn)}function Oi(Kn){return(Math.exp(Kn)-Math.exp(-Kn))/2}function un(Kn){return(Math.exp(Kn)+Math.exp(-Kn))/2}var Qn=Zn(0),li=function(Kn){return un(Qn)/un(Qn+Xt*Kn)},Jn=function(Kn){return vr*((un(Qn)*(Oi(Wn=Qn+Xt*Kn)/un(Wn))-Oi(Qn))/On)/Lr;var Wn},Hn=(Zn(1)-Qn)/Xt;if(Math.abs(Lr)<1e-6||!isFinite(Hn)){if(Math.abs(vr-Br)<1e-6)return this.easeTo(c,d);var pi=Br<vr?-1:1;Hn=Math.abs(Math.log(Br/vr))/Xt,Jn=function(){return 0},li=function(Kn){return Math.exp(pi*Xt*Kn)}}return c.duration="duration"in c?+c.duration:1e3*Hn/("screenSpeed"in c?+c.screenSpeed/Xt:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=z!==le,this._pitching=Pe!==H,this._padding=!P.isPaddingEqual(we),this._prepareEase(d,!1),this._ease(function(Kn){var Wn=Kn*Hn,go=1/li(Wn);P.zoom=Kn===1?ue:L+P.scaleZoom(go),E._rotating&&(P.bearing=g.number(z,le,Kn)),E._pitching&&(P.pitch=g.number(H,Pe,Kn)),E._padding&&(P.interpolatePadding(oe,we,Kn),Ve=P.centerPoint.add(Ce));var Va=Kn===1?yt:P.unproject(Vt.add(Bt.mult(Jn(Wn))).mult(go));P.setLocationAtPoint(P.renderWorldCopies?Va.wrap():Va,Ve),E._fireMoveEvents(d)},function(){return E._afterEase(d)},c),this},p.prototype.isEasing=function(){return!!this._easeFrameId},p.prototype.stop=function(){return this._stop()},p.prototype._stop=function(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var E=this._onEaseEnd;delete this._onEaseEnd,E.call(this,d)}if(!c){var w=this.handlers;w&&w.stop(!1)}return this},p.prototype._ease=function(c,d,E){E.animate===!1||E.duration===0?(c(1),d()):(this._easeStart=g.browser.now(),this._easeOptions=E,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},p.prototype._renderFrameCallback=function(){var c=Math.min((g.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},p.prototype._normalizeBearing=function(c,d){c=g.wrap(c,-180,180);var E=Math.abs(c-d);return Math.abs(c-360-d)<E&&(c-=360),Math.abs(c+360-d)<E&&(c+=360),c},p.prototype._normalizeCenter=function(c){var d=this.transform;if(d.renderWorldCopies&&!d.lngRange){var E=c.lng-d.center.lng;c.lng+=E>180?-360:E<-180?360:0}},p}(g.Evented),cs=function(l){l===void 0&&(l={}),this.options=l,g.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};cs.prototype.getDefaultPosition=function(){return"bottom-right"},cs.prototype.onAdd=function(l){var p=this.options&&this.options.compact;return this._map=l,this._container=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=X.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=X.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),p&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),p===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},cs.prototype.onRemove=function(){X.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},cs.prototype._setElementTitle=function(l,p){var c=this._map._getUIString("AttributionControl."+p);l.title=c,l.setAttribute("aria-label",c)},cs.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},cs.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var p=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||g.config.ACCESS_TOKEN}];if(l){var c=p.reduce(function(d,E,w){return E.value&&(d+=E.key+"="+E.value+(w<p.length-1?"&":"")),d},"?");l.href=g.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},cs.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},cs.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(L){return typeof L!="string"?"":L})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}var c=this._map.style.sourceCaches;for(var d in c){var E=c[d];if(E.used){var w=E.getSource();w.attribution&&l.indexOf(w.attribution)<0&&l.push(w.attribution)}}l.sort(function(L,z){return L.length-z.length});var P=(l=l.filter(function(L,z){for(var H=z+1;H<l.length;H++)if(l[H].indexOf(L)>=0)return!1;return!0})).join(" | ");P!==this._attribHTML&&(this._attribHTML=P,l.length?(this._innerContainer.innerHTML=P,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},cs.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Oo=function(){g.bindAll(["_updateLogo"],this),g.bindAll(["_updateCompact"],this)};Oo.prototype.onAdd=function(l){this._map=l,this._container=X.create("div","mapboxgl-ctrl");var p=X.create("a","mapboxgl-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://www.mapbox.com/",p.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),p.setAttribute("rel","noopener nofollow"),this._container.appendChild(p),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Oo.prototype.onRemove=function(){X.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Oo.prototype.getDefaultPosition=function(){return"bottom-left"},Oo.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Oo.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var p in l)if(l[p].getSource().mapbox_logo)return!0;return!1}},Oo.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var p=l[0];this._map.getCanvasContainer().offsetWidth<250?p.classList.add("mapboxgl-compact"):p.classList.remove("mapboxgl-compact")}};var ns=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};ns.prototype.add=function(l){var p=++this._id;return this._queue.push({callback:l,id:p,cancelled:!1}),p},ns.prototype.remove=function(l){for(var p=this._currentlyRunning,c=0,d=p?this._queue.concat(p):this._queue;c<d.length;c+=1){var E=d[c];if(E.id===l)return void(E.cancelled=!0)}},ns.prototype.run=function(l){l===void 0&&(l=0);var p=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,d=p;c<d.length;c+=1){var E=d[c];if(!E.cancelled&&(E.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},ns.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Cu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Xf=g.window.HTMLImageElement,_l=g.window.HTMLElement,sa=g.window.ImageBitmap,Da={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},hf=function(l){function p(d){var E=this;if((d=g.extend({},Da,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var w=new Gi(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies);if(l.call(this,w,d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new ns,this._controls=[],this._mapId=g.uniqueId(),this._locale=g.extend({},Cu,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new g.RequestManager(d.transformRequest,d.accessToken),typeof d.container=="string"){if(this._container=g.window.document.getElementById(d.container),!this._container)throw new Error("Container '"+d.container+"' not found.")}else{if(!(d.container instanceof _l))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),g.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return E._update(!1)}),this.on("moveend",function(){return E._update(!1)}),this.on("zoom",function(){return E._update(!0)}),g.window!==void 0&&(g.window.addEventListener("online",this._onWindowOnline,!1),g.window.addEventListener("resize",this._onWindowResize,!1),g.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new An(this,d),this._hash=d.hash&&new Ss(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,g.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new cs({customAttribution:d.customAttribution})),this.addControl(new Oo,d.logoPosition),this.on("style.load",function(){E.transform.unmodified&&E.jumpTo(E.style.stylesheet)}),this.on("data",function(P){E._update(P.dataType==="style"),E.fire(new g.Event(P.dataType+"data",P))}),this.on("dataloading",function(P){E.fire(new g.Event(P.dataType+"dataloading",P))})}l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return p.prototype._getMapId=function(){return this._mapId},p.prototype.addControl=function(d,E){if(E===void 0&&(E=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new g.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var w=d.onAdd(this);this._controls.push(d);var P=this._controlPositions[E];return E.indexOf("bottom")!==-1?P.insertBefore(w,P.firstChild):P.appendChild(w),this},p.prototype.removeControl=function(d){if(!d||!d.onRemove)return this.fire(new g.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var E=this._controls.indexOf(d);return E>-1&&this._controls.splice(E,1),d.onRemove(this),this},p.prototype.hasControl=function(d){return this._controls.indexOf(d)>-1},p.prototype.resize=function(d){var E=this._containerDimensions(),w=E[0],P=E[1];if(w===this.transform.width&&P===this.transform.height)return this;this._resizeCanvas(w,P),this.transform.resize(w,P),this.painter.resize(w,P);var L=!this._moving;return L&&this.fire(new g.Event("movestart",d)).fire(new g.Event("move",d)),this.fire(new g.Event("resize",d)),L&&this.fire(new g.Event("moveend",d)),this},p.prototype.getBounds=function(){return this.transform.getBounds()},p.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},p.prototype.setMaxBounds=function(d){return this.transform.setMaxBounds(g.LngLatBounds.convert(d)),this._update()},p.prototype.setMinZoom=function(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},p.prototype.getMinZoom=function(){return this.transform.minZoom},p.prototype.setMaxZoom=function(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")},p.prototype.getMaxZoom=function(){return this.transform.maxZoom},p.prototype.setMinPitch=function(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},p.prototype.getMinPitch=function(){return this.transform.minPitch},p.prototype.setMaxPitch=function(d){if((d=d==null?60:d)>60)throw new Error("maxPitch must be less than or equal to 60");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")},p.prototype.getMaxPitch=function(){return this.transform.maxPitch},p.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},p.prototype.setRenderWorldCopies=function(d){return this.transform.renderWorldCopies=d,this._update()},p.prototype.project=function(d){return this.transform.locationPoint(g.LngLat.convert(d))},p.prototype.unproject=function(d){return this.transform.pointLocation(g.Point.convert(d))},p.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},p.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},p.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},p.prototype._createDelegatedListener=function(d,E,w){var P,L=this;if(d==="mouseenter"||d==="mouseover"){var z=!1;return{layer:E,listener:w,delegates:{mousemove:function(oe){var ue=L.getLayer(E)?L.queryRenderedFeatures(oe.point,{layers:[E]}):[];ue.length?z||(z=!0,w.call(L,new vo(d,L,oe.originalEvent,{features:ue}))):z=!1},mouseout:function(){z=!1}}}}if(d==="mouseleave"||d==="mouseout"){var H=!1;return{layer:E,listener:w,delegates:{mousemove:function(oe){(L.getLayer(E)?L.queryRenderedFeatures(oe.point,{layers:[E]}):[]).length?H=!0:H&&(H=!1,w.call(L,new vo(d,L,oe.originalEvent)))},mouseout:function(oe){H&&(H=!1,w.call(L,new vo(d,L,oe.originalEvent)))}}}}return{layer:E,listener:w,delegates:(P={},P[d]=function(oe){var ue=L.getLayer(E)?L.queryRenderedFeatures(oe.point,{layers:[E]}):[];ue.length&&(oe.features=ue,w.call(L,oe),delete oe.features)},P)}},p.prototype.on=function(d,E,w){if(w===void 0)return l.prototype.on.call(this,d,E);var P=this._createDelegatedListener(d,E,w);for(var L in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(P),P.delegates)this.on(L,P.delegates[L]);return this},p.prototype.once=function(d,E,w){if(w===void 0)return l.prototype.once.call(this,d,E);var P=this._createDelegatedListener(d,E,w);for(var L in P.delegates)this.once(L,P.delegates[L]);return this},p.prototype.off=function(d,E,w){var P=this;return w===void 0?l.prototype.off.call(this,d,E):(this._delegatedListeners&&this._delegatedListeners[d]&&function(L){for(var z=L[d],H=0;H<z.length;H++){var oe=z[H];if(oe.layer===E&&oe.listener===w){for(var ue in oe.delegates)P.off(ue,oe.delegates[ue]);return z.splice(H,1),P}}}(this._delegatedListeners),this)},p.prototype.queryRenderedFeatures=function(d,E){if(!this.style)return[];var w;if(E!==void 0||d===void 0||d instanceof g.Point||Array.isArray(d)||(E=d,d=void 0),E=E||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof g.Point||typeof d[0]=="number")w=[g.Point.convert(d)];else{var P=g.Point.convert(d[0]),L=g.Point.convert(d[1]);w=[P,new g.Point(L.x,P.y),L,new g.Point(P.x,L.y),P]}return this.style.queryRenderedFeatures(w,E,this.transform)},p.prototype.querySourceFeatures=function(d,E){return this.style.querySourceFeatures(d,E)},p.prototype.setStyle=function(d,E){return(E=g.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},E)).diff!==!1&&E.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,E),this):(this._localIdeographFontFamily=E.localIdeographFontFamily,this._updateStyle(d,E))},p.prototype._getUIString=function(d){var E=this._locale[d];if(E==null)throw new Error("Missing UI string '"+d+"'");return E},p.prototype._updateStyle=function(d,E){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new bs(this,E||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)},p.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new bs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},p.prototype._diffStyle=function(d,E){var w=this;if(typeof d=="string"){var P=this._requestManager.normalizeStyleURL(d),L=this._requestManager.transformRequest(P,g.ResourceType.Style);g.getJSON(L,function(z,H){z?w.fire(new g.ErrorEvent(z)):H&&w._updateDiff(H,E)})}else typeof d=="object"&&this._updateDiff(d,E)},p.prototype._updateDiff=function(d,E){try{this.style.setState(d)&&this._update(!0)}catch(w){g.warnOnce("Unable to perform style diff: "+(w.message||w.error||w)+".  Rebuilding the style from scratch."),this._updateStyle(d,E)}},p.prototype.getStyle=function(){if(this.style)return this.style.serialize()},p.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():g.warnOnce("There is no style added to the map.")},p.prototype.addSource=function(d,E){return this._lazyInitEmptyStyle(),this.style.addSource(d,E),this._update(!0)},p.prototype.isSourceLoaded=function(d){var E=this.style&&this.style.sourceCaches[d];if(E!==void 0)return E.loaded();this.fire(new g.ErrorEvent(new Error("There is no source with ID '"+d+"'")))},p.prototype.areTilesLoaded=function(){var d=this.style&&this.style.sourceCaches;for(var E in d){var w=d[E]._tiles;for(var P in w){var L=w[P];if(L.state!=="loaded"&&L.state!=="errored")return!1}}return!0},p.prototype.addSourceType=function(d,E,w){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,E,w)},p.prototype.removeSource=function(d){return this.style.removeSource(d),this._update(!0)},p.prototype.getSource=function(d){return this.style.getSource(d)},p.prototype.addImage=function(d,E,w){w===void 0&&(w={});var P=w.pixelRatio;P===void 0&&(P=1);var L=w.sdf;L===void 0&&(L=!1);var z=w.stretchX,H=w.stretchY,oe=w.content;if(this._lazyInitEmptyStyle(),E instanceof Xf||sa&&E instanceof sa){var ue=g.browser.getImageData(E);this.style.addImage(d,{data:new g.RGBAImage({width:ue.width,height:ue.height},ue.data),pixelRatio:P,stretchX:z,stretchY:H,content:oe,sdf:L,version:0})}else{if(E.width===void 0||E.height===void 0)return this.fire(new g.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var le=E;this.style.addImage(d,{data:new g.RGBAImage({width:E.width,height:E.height},new Uint8Array(E.data)),pixelRatio:P,stretchX:z,stretchY:H,content:oe,sdf:L,version:0,userImage:le}),le.onAdd&&le.onAdd(this,d)}},p.prototype.updateImage=function(d,E){var w=this.style.getImage(d);if(!w)return this.fire(new g.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var P=E instanceof Xf||sa&&E instanceof sa?g.browser.getImageData(E):E,L=P.width,z=P.height,H=P.data;return L===void 0||z===void 0?this.fire(new g.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):L!==w.data.width||z!==w.data.height?this.fire(new g.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(w.data.replace(H,!(E instanceof Xf||sa&&E instanceof sa)),void this.style.updateImage(d,w))},p.prototype.hasImage=function(d){return d?!!this.style.getImage(d):(this.fire(new g.ErrorEvent(new Error("Missing required image id"))),!1)},p.prototype.removeImage=function(d){this.style.removeImage(d)},p.prototype.loadImage=function(d,E){g.getImage(this._requestManager.transformRequest(d,g.ResourceType.Image),E)},p.prototype.listImages=function(){return this.style.listImages()},p.prototype.addLayer=function(d,E){return this._lazyInitEmptyStyle(),this.style.addLayer(d,E),this._update(!0)},p.prototype.moveLayer=function(d,E){return this.style.moveLayer(d,E),this._update(!0)},p.prototype.removeLayer=function(d){return this.style.removeLayer(d),this._update(!0)},p.prototype.getLayer=function(d){return this.style.getLayer(d)},p.prototype.setLayerZoomRange=function(d,E,w){return this.style.setLayerZoomRange(d,E,w),this._update(!0)},p.prototype.setFilter=function(d,E,w){return w===void 0&&(w={}),this.style.setFilter(d,E,w),this._update(!0)},p.prototype.getFilter=function(d){return this.style.getFilter(d)},p.prototype.setPaintProperty=function(d,E,w,P){return P===void 0&&(P={}),this.style.setPaintProperty(d,E,w,P),this._update(!0)},p.prototype.getPaintProperty=function(d,E){return this.style.getPaintProperty(d,E)},p.prototype.setLayoutProperty=function(d,E,w,P){return P===void 0&&(P={}),this.style.setLayoutProperty(d,E,w,P),this._update(!0)},p.prototype.getLayoutProperty=function(d,E){return this.style.getLayoutProperty(d,E)},p.prototype.setLight=function(d,E){return E===void 0&&(E={}),this._lazyInitEmptyStyle(),this.style.setLight(d,E),this._update(!0)},p.prototype.getLight=function(){return this.style.getLight()},p.prototype.setFeatureState=function(d,E){return this.style.setFeatureState(d,E),this._update()},p.prototype.removeFeatureState=function(d,E){return this.style.removeFeatureState(d,E),this._update()},p.prototype.getFeatureState=function(d){return this.style.getFeatureState(d)},p.prototype.getContainer=function(){return this._container},p.prototype.getCanvasContainer=function(){return this._canvasContainer},p.prototype.getCanvas=function(){return this._canvas},p.prototype._containerDimensions=function(){var d=0,E=0;return this._container&&(d=this._container.clientWidth||400,E=this._container.clientHeight||300),[d,E]},p.prototype._detectMissingCSS=function(){g.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&g.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},p.prototype._setupContainer=function(){var d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=X.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();var E=this._canvasContainer=X.create("div","mapboxgl-canvas-container",d);this._interactive&&E.classList.add("mapboxgl-interactive"),this._canvas=X.create("canvas","mapboxgl-canvas",E),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var w=this._containerDimensions();this._resizeCanvas(w[0],w[1]);var P=this._controlContainer=X.create("div","mapboxgl-control-container",d),L=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(z){L[z]=X.create("div","mapboxgl-ctrl-"+z,P)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},p.prototype._resizeCanvas=function(d,E){var w=g.browser.devicePixelRatio||1;this._canvas.width=w*d,this._canvas.height=w*E,this._canvas.style.width=d+"px",this._canvas.style.height=E+"px"},p.prototype._setupPainter=function(){var d=g.extend({},Re.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),E=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);E?(this.painter=new qi(E,this.transform),g.webpSupported.testSupport(E)):this.fire(new g.ErrorEvent(new Error("Failed to initialize WebGL")))},p.prototype._contextLost=function(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new g.Event("webglcontextlost",{originalEvent:d}))},p.prototype._contextRestored=function(d){this._setupPainter(),this.resize(),this._update(),this.fire(new g.Event("webglcontextrestored",{originalEvent:d}))},p.prototype._onMapScroll=function(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},p.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},p.prototype._update=function(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this},p.prototype._requestRenderFrame=function(d){return this._update(),this._renderTaskQueue.add(d)},p.prototype._cancelRenderFrame=function(d){this._renderTaskQueue.remove(d)},p.prototype._render=function(d){var E,w=this,P=0,L=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(E=L.createQueryEXT(),L.beginQueryEXT(L.TIME_ELAPSED_EXT,E),P=g.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),!this._removed){var z=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var H=this.transform.zoom,oe=g.browser.now();this.style.zoomHistory.update(H,oe);var ue=new g.EvaluationParameters(H,{now:oe,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),le=ue.crossFadingFactor();le===1&&le===this._crossFadingFactor||(z=!0,this._crossFadingFactor=le),this.style.update(ue)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new g.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new g.Event("load"))),this.style&&(this.style.hasTransitions()||z)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Pe=g.browser.now()-P;L.endQueryEXT(L.TIME_ELAPSED_EXT,E),setTimeout(function(){var Ce=L.getQueryObjectEXT(E,L.QUERY_RESULT_EXT)/1e6;L.deleteQueryEXT(E),w.fire(new g.Event("gpu-timing-frame",{cpuTime:Pe,gpuTime:Ce}))},50)}if(this.listens("gpu-timing-layer")){var we=this.painter.collectGpuTimers();setTimeout(function(){var Ce=w.painter.queryGpuTimers(we);w.fire(new g.Event("gpu-timing-layer",{layerTimes:Ce}))},50)}var Ge=this._sourcesDirty||this._styleDirty||this._placementDirty;return Ge||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new g.Event("idle")),!this._loaded||this._fullyLoaded||Ge||(this._fullyLoaded=!0),this}},p.prototype.remove=function(){this._hash&&this._hash.remove();for(var d=0,E=this._controls;d<E.length;d+=1)E[d].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),g.window!==void 0&&(g.window.removeEventListener("resize",this._onWindowResize,!1),g.window.removeEventListener("orientationchange",this._onWindowResize,!1),g.window.removeEventListener("online",this._onWindowOnline,!1));var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),xl(this._canvasContainer),xl(this._controlContainer),xl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new g.Event("remove"))},p.prototype.triggerRepaint=function(){var d=this;this.style&&!this._frame&&(this._frame=g.browser.frame(function(E){d._frame=null,d._render(E)}))},p.prototype._onWindowOnline=function(){this._update()},p.prototype._onWindowResize=function(d){this._trackResize&&this.resize({originalEvent:d})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(d){this._showPadding!==d&&(this._showPadding=d,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(d){this._vertices=d,this._update()},p.prototype._setCacheLimits=function(d,E){g.setCacheLimits(d,E)},c.version.get=function(){return g.version},Object.defineProperties(p.prototype,c),p}(Zc);function xl(l){l.parentNode&&l.parentNode.removeChild(l)}var Au={showCompass:!0,showZoom:!0,visualizePitch:!1},hu=function(l){var p=this;this.options=g.extend({},Au,l),this._container=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(g.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return p._map.zoomIn({},{originalEvent:c})}),X.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return p._map.zoomOut({},{originalEvent:c})}),X.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(g.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){p.options.visualizePitch?p._map.resetNorthPitch({},{originalEvent:c}):p._map.resetNorth({},{originalEvent:c})}),this._compassIcon=X.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};hu.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),p=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=p,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",p.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},hu.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},hu.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Yo(this._map,this._compass,this.options.visualizePitch)),this._container},hu.prototype.onRemove=function(){X.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},hu.prototype._createButton=function(l,p){var c=X.create("button",l,this._container);return c.type="button",c.addEventListener("click",p),c},hu.prototype._setButtonTitle=function(l,p){var c=this._map._getUIString("NavigationControl."+p);l.title=c,l.setAttribute("aria-label",c)};var Yo=function(l,p,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=p,this.mouseRotate=new pc({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new Gu({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),g.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),X.addEventListener(p,"mousedown",this.mousedown),X.addEventListener(p,"touchstart",this.touchstart,{passive:!1}),X.addEventListener(p,"touchmove",this.touchmove),X.addEventListener(p,"touchend",this.touchend),X.addEventListener(p,"touchcancel",this.reset)};function al(l,p,c){if(l=new g.LngLat(l.lng,l.lat),p){var d=new g.LngLat(l.lng-360,l.lat),E=new g.LngLat(l.lng+360,l.lat),w=c.locationPoint(l).distSqr(p);c.locationPoint(d).distSqr(p)<w?l=d:c.locationPoint(E).distSqr(p)<w&&(l=E)}for(;Math.abs(l.lng-c.center.lng)>180;){var P=c.locationPoint(l);if(P.x>=0&&P.y>=0&&P.x<=c.width&&P.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}Yo.prototype.down=function(l,p){this.mouseRotate.mousedown(l,p),this.mousePitch&&this.mousePitch.mousedown(l,p),X.disableDrag()},Yo.prototype.move=function(l,p){var c=this.map,d=this.mouseRotate.mousemoveWindow(l,p);if(d&&d.bearingDelta&&c.setBearing(c.getBearing()+d.bearingDelta),this.mousePitch){var E=this.mousePitch.mousemoveWindow(l,p);E&&E.pitchDelta&&c.setPitch(c.getPitch()+E.pitchDelta)}},Yo.prototype.off=function(){var l=this.element;X.removeEventListener(l,"mousedown",this.mousedown),X.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),X.removeEventListener(l,"touchmove",this.touchmove),X.removeEventListener(l,"touchend",this.touchend),X.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},Yo.prototype.offTemp=function(){X.enableDrag(),X.removeEventListener(g.window,"mousemove",this.mousemove),X.removeEventListener(g.window,"mouseup",this.mouseup)},Yo.prototype.mousedown=function(l){this.down(g.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),X.mousePos(this.element,l)),X.addEventListener(g.window,"mousemove",this.mousemove),X.addEventListener(g.window,"mouseup",this.mouseup)},Yo.prototype.mousemove=function(l){this.move(l,X.mousePos(this.element,l))},Yo.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},Yo.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=X.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},Yo.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=X.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},Yo.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Yo.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Wu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function jc(l,p,c){var d=l.classList;for(var E in Wu)d.remove("mapboxgl-"+c+"-anchor-"+E);d.add("mapboxgl-"+c+"-anchor-"+p)}var du,Vc=function(l){function p(c,d){if(l.call(this),(c instanceof g.window.HTMLElement||d)&&(c=g.extend({element:c},d)),g.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=g.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=X.create("div"),this._element.setAttribute("aria-label","Map marker");var E=X.createNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","41px"),E.setAttributeNS(null,"width","27px"),E.setAttributeNS(null,"viewBox","0 0 27 41");var w=X.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");var P=X.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");var L=X.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");for(var z=0,H=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];z<H.length;z+=1){var oe=H[z],ue=X.createNS("http://www.w3.org/2000/svg","ellipse");ue.setAttributeNS(null,"opacity","0.04"),ue.setAttributeNS(null,"cx","10.5"),ue.setAttributeNS(null,"cy","5.80029008"),ue.setAttributeNS(null,"rx",oe.rx),ue.setAttributeNS(null,"ry",oe.ry),L.appendChild(ue)}var le=X.createNS("http://www.w3.org/2000/svg","g");le.setAttributeNS(null,"fill",this._color);var Pe=X.createNS("http://www.w3.org/2000/svg","path");Pe.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),le.appendChild(Pe);var we=X.createNS("http://www.w3.org/2000/svg","g");we.setAttributeNS(null,"opacity","0.25"),we.setAttributeNS(null,"fill","#000000");var Ge=X.createNS("http://www.w3.org/2000/svg","path");Ge.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),we.appendChild(Ge);var Ce=X.createNS("http://www.w3.org/2000/svg","g");Ce.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ce.setAttributeNS(null,"fill","#FFFFFF");var Ve=X.createNS("http://www.w3.org/2000/svg","g");Ve.setAttributeNS(null,"transform","translate(8.0, 8.0)");var $e=X.createNS("http://www.w3.org/2000/svg","circle");$e.setAttributeNS(null,"fill","#000000"),$e.setAttributeNS(null,"opacity","0.25"),$e.setAttributeNS(null,"cx","5.5"),$e.setAttributeNS(null,"cy","5.5"),$e.setAttributeNS(null,"r","5.4999962");var yt=X.createNS("http://www.w3.org/2000/svg","circle");yt.setAttributeNS(null,"fill","#FFFFFF"),yt.setAttributeNS(null,"cx","5.5"),yt.setAttributeNS(null,"cy","5.5"),yt.setAttributeNS(null,"r","5.4999962"),Ve.appendChild($e),Ve.appendChild(yt),P.appendChild(L),P.appendChild(le),P.appendChild(we),P.appendChild(Ce),P.appendChild(Ve),E.appendChild(P),E.setAttributeNS(null,"height",41*this._scale+"px"),E.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(E),this._offset=g.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Vt){Vt.preventDefault()}),this._element.addEventListener("mousedown",function(Vt){Vt.preventDefault()}),jc(this._element,this._anchor,"marker"),this._popup=null}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},p.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),X.remove(this._element),this._popup&&this._popup.remove(),this},p.prototype.getLngLat=function(){return this._lngLat},p.prototype.setLngLat=function(c){return this._lngLat=g.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},p.prototype.getElement=function(){return this._element},p.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var d=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},p.prototype._onKeyPress=function(c){var d=c.code,E=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&E!==32&&E!==13||this.togglePopup()},p.prototype._onMapClick=function(c){var d=c.originalEvent.target,E=this._element;this._popup&&(d===E||E.contains(d))&&this.togglePopup()},p.prototype.getPopup=function(){return this._popup},p.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},p.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=al(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(d="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),X.setTransform(this._element,Wu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+E+" "+d)}},p.prototype.getOffset=function(){return this._offset},p.prototype.setOffset=function(c){return this._offset=g.Point.convert(c),this._update(),this},p.prototype._onMove=function(c){if(!this._isDragging){var d=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new g.Event("dragstart"))),this.fire(new g.Event("drag")))},p.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new g.Event("dragend")),this._state="inactive"},p.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},p.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},p.prototype.isDraggable=function(){return this._draggable},p.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},p.prototype.getRotation=function(){return this._rotation},p.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},p.prototype.getRotationAlignment=function(){return this._rotationAlignment},p.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},p.prototype.getPitchAlignment=function(){return this._pitchAlignment},p}(g.Evented),hc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},jl=0,Qi=!1,bl=function(l){function p(c){l.call(this),this.options=g.extend({},hc,c),g.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.onAdd=function(c){var d;return this._map=c,this._container=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),d=this._setupUI,du!==void 0?d(du):g.window.navigator.permissions!==void 0?g.window.navigator.permissions.query({name:"geolocation"}).then(function(E){d(du=E.state!=="denied")}):d(du=!!g.window.navigator.geolocation),this._container},p.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(g.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),X.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,jl=0,Qi=!1},p.prototype._isOutOfMapMaxBounds=function(c){var d=this._map.getMaxBounds(),E=c.coords;return d&&(E.longitude<d.getWest()||E.longitude>d.getEast()||E.latitude<d.getSouth()||E.latitude>d.getNorth())},p.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},p.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new g.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new g.Event("geolocate",c)),this._finish()}},p.prototype._updateCamera=function(c){var d=new g.LngLat(c.coords.longitude,c.coords.latitude),E=c.coords.accuracy,w=this._map.getBearing(),P=g.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(E),P,{geolocateSource:!0})},p.prototype._updateMarker=function(c){if(c){var d=new g.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},p.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,d=this._map.unproject([0,c]),E=this._map.unproject([1,c]),w=d.distanceTo(E),P=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=P+"px",this._circleElement.style.height=P+"px"},p.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},p.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&Qi)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new g.Event("error",c)),this._finish()}},p.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},p.prototype._setupUI=function(c){var d=this;if(this._container.addEventListener("contextmenu",function(P){return P.preventDefault()}),this._geolocateButton=X.create("button","mapboxgl-ctrl-geolocate",this._container),X.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){g.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var E=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=E,this._geolocateButton.setAttribute("aria-label",E)}else{var w=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=X.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Vc(this._dotElement),this._circleElement=X.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Vc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(P){P.geolocateSource||d._watchState!=="ACTIVE_LOCK"||P.originalEvent&&P.originalEvent.type==="resize"||(d._watchState="BACKGROUND",d._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),d._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),d.fire(new g.Event("trackuserlocationend")))})},p.prototype.trigger=function(){if(!this._setup)return g.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new g.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":jl--,Qi=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new g.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new g.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++jl>1?(c={maximumAge:6e5,timeout:0},Qi=!0):(c=this.options.positionOptions,Qi=!1),this._geolocationWatchID=g.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else g.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},p.prototype._clearWatch=function(){g.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},p}(g.Evented),vu={maxWidth:100,unit:"metric"},wu=function(l){this.options=g.extend({},vu,l),g.bindAll(["_onMove","setUnit"],this)};function Vl(l,p,c){var d=c&&c.maxWidth||100,E=l._container.clientHeight/2,w=l.unproject([0,E]),P=l.unproject([d,E]),L=w.distanceTo(P);if(c&&c.unit==="imperial"){var z=3.2808*L;z>5280?Tu(p,d,z/5280,l._getUIString("ScaleControl.Miles")):Tu(p,d,z,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?Tu(p,d,L/1852,l._getUIString("ScaleControl.NauticalMiles")):L>=1e3?Tu(p,d,L/1e3,l._getUIString("ScaleControl.Kilometers")):Tu(p,d,L,l._getUIString("ScaleControl.Meters"))}function Tu(l,p,c,d){var E,w,P,L=(E=c,(w=Math.pow(10,(""+Math.floor(E)).length-1))*(P=(P=E/w)>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(z){var H=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*H)/H}(P)));l.style.width=p*(L/c)+"px",l.innerHTML=L+"&nbsp;"+d}wu.prototype.getDefaultPosition=function(){return"bottom-left"},wu.prototype._onMove=function(){Vl(this._map,this._container,this.options)},wu.prototype.onAdd=function(l){return this._map=l,this._container=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},wu.prototype.onRemove=function(){X.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},wu.prototype.setUnit=function(l){this.options.unit=l,Vl(this._map,this._container,this.options)};var Vs=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof g.window.HTMLElement?this._container=l.container:g.warnOnce("Full screen control 'container' must be a DOM element.")),g.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in g.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in g.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in g.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in g.window.document&&(this._fullscreenchange="MSFullscreenChange")};Vs.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=X.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",g.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Vs.prototype.onRemove=function(){X.remove(this._controlContainer),this._map=null,g.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Vs.prototype._checkFullscreenSupport=function(){return!!(g.window.document.fullscreenEnabled||g.window.document.mozFullScreenEnabled||g.window.document.msFullscreenEnabled||g.window.document.webkitFullscreenEnabled)},Vs.prototype._setupUI=function(){var l=this._fullscreenButton=X.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);X.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),g.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Vs.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},Vs.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Vs.prototype._isFullscreen=function(){return this._fullscreen},Vs.prototype._changeIcon=function(){(g.window.document.fullscreenElement||g.window.document.mozFullScreenElement||g.window.document.webkitFullscreenElement||g.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Vs.prototype._onClickFullscreen=function(){this._isFullscreen()?g.window.document.exitFullscreen?g.window.document.exitFullscreen():g.window.document.mozCancelFullScreen?g.window.document.mozCancelFullScreen():g.window.document.msExitFullscreen?g.window.document.msExitFullscreen():g.window.document.webkitCancelFullScreen&&g.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var ja={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Mu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Gl=function(l){function p(c){l.call(this),this.options=g.extend(Object.create(ja),c),g.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(p.__proto__=l),(p.prototype=Object.create(l&&l.prototype)).constructor=p,p.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new g.Event("open")),this},p.prototype.isOpen=function(){return!!this._map},p.prototype.remove=function(){return this._content&&X.remove(this._content),this._container&&(X.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new g.Event("close")),this},p.prototype.getLngLat=function(){return this._lngLat},p.prototype.setLngLat=function(c){return this._lngLat=g.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},p.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},p.prototype.getElement=function(){return this._container},p.prototype.setText=function(c){return this.setDOMContent(g.window.document.createTextNode(c))},p.prototype.setHTML=function(c){var d,E=g.window.document.createDocumentFragment(),w=g.window.document.createElement("body");for(w.innerHTML=c;d=w.firstChild;)E.appendChild(d);return this.setDOMContent(E)},p.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},p.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},p.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=X.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},p.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},p.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},p.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},p.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},p.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=X.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},p.prototype._onMouseUp=function(c){this._update(c.point)},p.prototype._onMouseMove=function(c){this._update(c.point)},p.prototype._onDrag=function(c){this._update(c.point)},p.prototype._update=function(c){var d=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=X.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=X.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(ue){return d._container.classList.add(ue)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=al(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var E=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),w=this.options.anchor,P=function ue(le){if(le){if(typeof le=="number"){var Pe=Math.round(Math.sqrt(.5*Math.pow(le,2)));return{center:new g.Point(0,0),top:new g.Point(0,le),"top-left":new g.Point(Pe,Pe),"top-right":new g.Point(-Pe,Pe),bottom:new g.Point(0,-le),"bottom-left":new g.Point(Pe,-Pe),"bottom-right":new g.Point(-Pe,-Pe),left:new g.Point(le,0),right:new g.Point(-le,0)}}if(le instanceof g.Point||Array.isArray(le)){var we=g.Point.convert(le);return{center:we,top:we,"top-left":we,"top-right":we,bottom:we,"bottom-left":we,"bottom-right":we,left:we,right:we}}return{center:g.Point.convert(le.center||[0,0]),top:g.Point.convert(le.top||[0,0]),"top-left":g.Point.convert(le["top-left"]||[0,0]),"top-right":g.Point.convert(le["top-right"]||[0,0]),bottom:g.Point.convert(le.bottom||[0,0]),"bottom-left":g.Point.convert(le["bottom-left"]||[0,0]),"bottom-right":g.Point.convert(le["bottom-right"]||[0,0]),left:g.Point.convert(le.left||[0,0]),right:g.Point.convert(le.right||[0,0])}}return ue(new g.Point(0,0))}(this.options.offset);if(!w){var L,z=this._container.offsetWidth,H=this._container.offsetHeight;L=E.y+P.bottom.y<H?["top"]:E.y>this._map.transform.height-H?["bottom"]:[],E.x<z/2?L.push("left"):E.x>this._map.transform.width-z/2&&L.push("right"),w=L.length===0?"bottom":L.join("-")}var oe=E.add(P[w]).round();X.setTransform(this._container,Wu[w]+" translate("+oe.x+"px,"+oe.y+"px)"),jc(this._container,w,"popup")}},p.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(Mu);c&&c.focus()}},p.prototype._onClose=function(){this.remove()},p}(g.Evented),Gc={version:g.version,supported:Re,setRTLTextPlugin:g.setRTLTextPlugin,getRTLTextPluginStatus:g.getRTLTextPluginStatus,Map:hf,NavigationControl:hu,GeolocateControl:bl,AttributionControl:cs,ScaleControl:wu,FullscreenControl:Vs,Popup:Gl,Marker:Vc,Style:bs,LngLat:g.LngLat,LngLatBounds:g.LngLatBounds,Point:g.Point,MercatorCoordinate:g.MercatorCoordinate,Evented:g.Evented,config:g.config,prewarm:function(){Mt().acquire(kt)},clearPrewarmedResources:function(){var l=En;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(kt),En=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return g.config.ACCESS_TOKEN},set accessToken(l){g.config.ACCESS_TOKEN=l},get baseApiUrl(){return g.config.API_URL},set baseApiUrl(l){g.config.API_URL=l},get workerCount(){return dr.workerCount},set workerCount(l){dr.workerCount=l},get maxParallelImageRequests(){return g.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){g.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){g.clearTileCache(l)},workerUrl:""};return Gc}),Oe})},28660:function(Tr,ie,ee){var Oe=ee(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var _e;(function(g){(function(Re){var X=typeof ee.g=="object"?ee.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),pe=de(g);typeof X.Reflect=="undefined"?X.Reflect=g:pe=de(X.Reflect,pe),Re(pe);function de(Ne,xe){return function(tt,dt){typeof Ne[tt]!="function"&&Object.defineProperty(Ne,tt,{configurable:!0,writable:!0,value:dt}),xe&&xe(tt,dt)}}})(function(Re){var X=Object.prototype.hasOwnProperty,pe=typeof Symbol=="function",de=pe&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Ne=pe&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",xe=typeof Object.create=="function",tt={__proto__:[]}instanceof Array,dt=!xe&&!tt,At={create:xe?function(){return au(Object.create(null))}:tt?function(){return au({__proto__:null})}:function(){return au({})},has:dt?function(Nt,Jt){return X.call(Nt,Jt)}:function(Nt,Jt){return Jt in Nt},get:dt?function(Nt,Jt){return X.call(Nt,Jt)?Nt[Jt]:void 0}:function(Nt,Jt){return Nt[Jt]}},tr=Object.getPrototypeOf(Function),pr=typeof Oe=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Lt=!pr&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:fe(),nr=!pr&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:oi(),jt=!pr&&typeof WeakMap=="function"?WeakMap:xo(),ht=new jt;function gt(Nt,Jt,Dr,cn){if(_n(Dr)){if(!Ri(Nt))throw new TypeError;if(!ma(Jt))throw new TypeError;return Wr(Nt,Jt)}else{if(!Ri(Nt))throw new TypeError;if(!ai(Jt))throw new TypeError;if(!ai(cn)&&!_n(cn)&&!mi(cn))throw new TypeError;return mi(cn)&&(cn=void 0),Dr=Xi(Dr),on(Nt,Jt,Dr,cn)}}Re("decorate",gt);function sr(Nt,Jt){function Dr(cn,wn){if(!ai(cn))throw new TypeError;if(!_n(wn)&&!Do(wn))throw new TypeError;Ft(Nt,Jt,cn,wn)}return Dr}Re("metadata",sr);function q(Nt,Jt,Dr,cn){if(!ai(Dr))throw new TypeError;return _n(cn)||(cn=Xi(cn)),Ft(Nt,Jt,Dr,cn)}Re("defineMetadata",q);function Yt(Nt,Jt,Dr){if(!ai(Jt))throw new TypeError;return _n(Dr)||(Dr=Xi(Dr)),Se(Nt,Jt,Dr)}Re("hasMetadata",Yt);function ct(Nt,Jt,Dr){if(!ai(Jt))throw new TypeError;return _n(Dr)||(Dr=Xi(Dr)),ke(Nt,Jt,Dr)}Re("hasOwnMetadata",ct);function Ke(Nt,Jt,Dr){if(!ai(Jt))throw new TypeError;return _n(Dr)||(Dr=Xi(Dr)),St(Nt,Jt,Dr)}Re("getMetadata",Ke);function wt(Nt,Jt,Dr){if(!ai(Jt))throw new TypeError;return _n(Dr)||(Dr=Xi(Dr)),vt(Nt,Jt,Dr)}Re("getOwnMetadata",wt);function et(Nt,Jt){if(!ai(Nt))throw new TypeError;return _n(Jt)||(Jt=Xi(Jt)),Wt(Nt,Jt)}Re("getMetadataKeys",et);function qt(Nt,Jt){if(!ai(Nt))throw new TypeError;return _n(Jt)||(Jt=Xi(Jt)),Er(Nt,Jt)}Re("getOwnMetadataKeys",qt);function Ar(Nt,Jt,Dr){if(!ai(Jt))throw new TypeError;_n(Dr)||(Dr=Xi(Dr));var cn=A(Jt,Dr,!1);if(_n(cn)||!cn.delete(Nt))return!1;if(cn.size>0)return!0;var wn=ht.get(Jt);return wn.delete(Dr),wn.size>0||ht.delete(Jt),!0}Re("deleteMetadata",Ar);function Wr(Nt,Jt){for(var Dr=Nt.length-1;Dr>=0;--Dr){var cn=Nt[Dr],wn=cn(Jt);if(!_n(wn)&&!mi(wn)){if(!ma(wn))throw new TypeError;Jt=wn}}return Jt}function on(Nt,Jt,Dr,cn){for(var wn=Nt.length-1;wn>=0;--wn){var Nn=Nt[wn],Ei=Nn(Jt,Dr,cn);if(!_n(Ei)&&!mi(Ei)){if(!ai(Ei))throw new TypeError;cn=Ei}}return cn}function A(Nt,Jt,Dr){var cn=ht.get(Nt);if(_n(cn)){if(!Dr)return;cn=new Lt,ht.set(Nt,cn)}var wn=cn.get(Jt);if(_n(wn)){if(!Dr)return;wn=new Lt,cn.set(Jt,wn)}return wn}function Se(Nt,Jt,Dr){var cn=ke(Nt,Jt,Dr);if(cn)return!0;var wn=Os(Jt);return mi(wn)?!1:Se(Nt,wn,Dr)}function ke(Nt,Jt,Dr){var cn=A(Jt,Dr,!1);return _n(cn)?!1:yi(cn.has(Nt))}function St(Nt,Jt,Dr){var cn=ke(Nt,Jt,Dr);if(cn)return vt(Nt,Jt,Dr);var wn=Os(Jt);if(!mi(wn))return St(Nt,wn,Dr)}function vt(Nt,Jt,Dr){var cn=A(Jt,Dr,!1);if(!_n(cn))return cn.get(Nt)}function Ft(Nt,Jt,Dr,cn){var wn=A(Dr,cn,!0);wn.set(Nt,Jt)}function Wt(Nt,Jt){var Dr=Er(Nt,Jt),cn=Os(Nt);if(cn===null)return Dr;var wn=Wt(cn,Jt);if(wn.length<=0)return Dr;if(Dr.length<=0)return wn;for(var Nn=new nr,Ei=[],di=0,Sn=Dr;di<Sn.length;di++){var Pi=Sn[di],Mi=Nn.has(Pi);Mi||(Nn.add(Pi),Ei.push(Pi))}for(var to=0,gs=wn;to<gs.length;to++){var Pi=gs[to],Mi=Nn.has(Pi);Mi||(Nn.add(Pi),Ei.push(Pi))}return Ei}function Er(Nt,Jt){var Dr=[],cn=A(Nt,Jt,!1);if(_n(cn))return Dr;for(var wn=cn.keys(),Nn=xa(wn),Ei=0;;){var di=aa(Nn);if(!di)return Dr.length=Ei,Dr;var Sn=Ui(di);try{Dr[Ei]=Sn}catch(Pi){try{ea(Nn)}finally{throw Pi}}Ei++}}function $n(Nt){if(Nt===null)return 1;switch(typeof Nt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Nt===null?1:6;default:return 6}}function _n(Nt){return Nt===void 0}function mi(Nt){return Nt===null}function Gn(Nt){return typeof Nt=="symbol"}function ai(Nt){return typeof Nt=="object"?Nt!==null:typeof Nt=="function"}function gi(Nt,Jt){switch($n(Nt)){case 0:return Nt;case 1:return Nt;case 2:return Nt;case 3:return Nt;case 4:return Nt;case 5:return Nt}var Dr=Jt===3?"string":Jt===5?"number":"default",cn=Oa(Nt,de);if(cn!==void 0){var wn=cn.call(Nt,Dr);if(ai(wn))throw new TypeError;return wn}return Xn(Nt,Dr==="default"?"number":Dr)}function Xn(Nt,Jt){if(Jt==="string"){var Dr=Nt.toString;if(Ji(Dr)){var cn=Dr.call(Nt);if(!ai(cn))return cn}var wn=Nt.valueOf;if(Ji(wn)){var cn=wn.call(Nt);if(!ai(cn))return cn}}else{var wn=Nt.valueOf;if(Ji(wn)){var cn=wn.call(Nt);if(!ai(cn))return cn}var Nn=Nt.toString;if(Ji(Nn)){var cn=Nn.call(Nt);if(!ai(cn))return cn}}throw new TypeError}function yi(Nt){return!!Nt}function va(Nt){return""+Nt}function Xi(Nt){var Jt=gi(Nt,3);return Gn(Jt)?Jt:va(Jt)}function Ri(Nt){return Array.isArray?Array.isArray(Nt):Nt instanceof Object?Nt instanceof Array:Object.prototype.toString.call(Nt)==="[object Array]"}function Ji(Nt){return typeof Nt=="function"}function ma(Nt){return typeof Nt=="function"}function Do(Nt){switch($n(Nt)){case 3:return!0;case 4:return!0;default:return!1}}function Oa(Nt,Jt){var Dr=Nt[Jt];if(Dr!=null){if(!Ji(Dr))throw new TypeError;return Dr}}function xa(Nt){var Jt=Oa(Nt,Ne);if(!Ji(Jt))throw new TypeError;var Dr=Jt.call(Nt);if(!ai(Dr))throw new TypeError;return Dr}function Ui(Nt){return Nt.value}function aa(Nt){var Jt=Nt.next();return Jt.done?!1:Jt}function ea(Nt){var Jt=Nt.return;Jt&&Jt.call(Nt)}function Os(Nt){var Jt=Object.getPrototypeOf(Nt);if(typeof Nt!="function"||Nt===tr||Jt!==tr)return Jt;var Dr=Nt.prototype,cn=Dr&&Object.getPrototypeOf(Dr);if(cn==null||cn===Object.prototype)return Jt;var wn=cn.constructor;return typeof wn!="function"||wn===Nt?Jt:wn}function fe(){var Nt={},Jt=[],Dr=function(){function Ei(di,Sn,Pi){this._index=0,this._keys=di,this._values=Sn,this._selector=Pi}return Ei.prototype["@@iterator"]=function(){return this},Ei.prototype[Ne]=function(){return this},Ei.prototype.next=function(){var di=this._index;if(di>=0&&di<this._keys.length){var Sn=this._selector(this._keys[di],this._values[di]);return di+1>=this._keys.length?(this._index=-1,this._keys=Jt,this._values=Jt):this._index++,{value:Sn,done:!1}}return{value:void 0,done:!0}},Ei.prototype.throw=function(di){throw this._index>=0&&(this._index=-1,this._keys=Jt,this._values=Jt),di},Ei.prototype.return=function(di){return this._index>=0&&(this._index=-1,this._keys=Jt,this._values=Jt),{value:di,done:!0}},Ei}();return function(){function Ei(){this._keys=[],this._values=[],this._cacheKey=Nt,this._cacheIndex=-2}return Object.defineProperty(Ei.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Ei.prototype.has=function(di){return this._find(di,!1)>=0},Ei.prototype.get=function(di){var Sn=this._find(di,!1);return Sn>=0?this._values[Sn]:void 0},Ei.prototype.set=function(di,Sn){var Pi=this._find(di,!0);return this._values[Pi]=Sn,this},Ei.prototype.delete=function(di){var Sn=this._find(di,!1);if(Sn>=0){for(var Pi=this._keys.length,Mi=Sn+1;Mi<Pi;Mi++)this._keys[Mi-1]=this._keys[Mi],this._values[Mi-1]=this._values[Mi];return this._keys.length--,this._values.length--,di===this._cacheKey&&(this._cacheKey=Nt,this._cacheIndex=-2),!0}return!1},Ei.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Nt,this._cacheIndex=-2},Ei.prototype.keys=function(){return new Dr(this._keys,this._values,cn)},Ei.prototype.values=function(){return new Dr(this._keys,this._values,wn)},Ei.prototype.entries=function(){return new Dr(this._keys,this._values,Nn)},Ei.prototype["@@iterator"]=function(){return this.entries()},Ei.prototype[Ne]=function(){return this.entries()},Ei.prototype._find=function(di,Sn){return this._cacheKey!==di&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=di)),this._cacheIndex<0&&Sn&&(this._cacheIndex=this._keys.length,this._keys.push(di),this._values.push(void 0)),this._cacheIndex},Ei}();function cn(Ei,di){return Ei}function wn(Ei,di){return di}function Nn(Ei,di){return[Ei,di]}}function oi(){return function(){function Nt(){this._map=new Lt}return Object.defineProperty(Nt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Nt.prototype.has=function(Jt){return this._map.has(Jt)},Nt.prototype.add=function(Jt){return this._map.set(Jt,Jt),this},Nt.prototype.delete=function(Jt){return this._map.delete(Jt)},Nt.prototype.clear=function(){this._map.clear()},Nt.prototype.keys=function(){return this._map.keys()},Nt.prototype.values=function(){return this._map.values()},Nt.prototype.entries=function(){return this._map.entries()},Nt.prototype["@@iterator"]=function(){return this.keys()},Nt.prototype[Ne]=function(){return this.keys()},Nt}()}function xo(){var Nt=16,Jt=At.create(),Dr=cn();return function(){function Sn(){this._key=cn()}return Sn.prototype.has=function(Pi){var Mi=wn(Pi,!1);return Mi!==void 0?At.has(Mi,this._key):!1},Sn.prototype.get=function(Pi){var Mi=wn(Pi,!1);return Mi!==void 0?At.get(Mi,this._key):void 0},Sn.prototype.set=function(Pi,Mi){var to=wn(Pi,!0);return to[this._key]=Mi,this},Sn.prototype.delete=function(Pi){var Mi=wn(Pi,!1);return Mi!==void 0?delete Mi[this._key]:!1},Sn.prototype.clear=function(){this._key=cn()},Sn}();function cn(){var Sn;do Sn="@@WeakMap@@"+di();while(At.has(Jt,Sn));return Jt[Sn]=!0,Sn}function wn(Sn,Pi){if(!X.call(Sn,Dr)){if(!Pi)return;Object.defineProperty(Sn,Dr,{value:At.create()})}return Sn[Dr]}function Nn(Sn,Pi){for(var Mi=0;Mi<Pi;++Mi)Sn[Mi]=Math.random()*255|0;return Sn}function Ei(Sn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(Sn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(Sn)):Nn(new Uint8Array(Sn),Sn):Nn(new Array(Sn),Sn)}function di(){var Sn=Ei(Nt);Sn[6]=Sn[6]&79|64,Sn[8]=Sn[8]&191|128;for(var Pi="",Mi=0;Mi<Nt;++Mi){var to=Sn[Mi];(Mi===4||Mi===6||Mi===8)&&(Pi+="-"),to<16&&(Pi+="0"),Pi+=to.toString(16).toLowerCase()}return Pi}}function au(Nt){return Nt.__=void 0,delete Nt.__,Nt}})})(_e||(_e={}))},69848:function(Tr){(function(ie,ee){Tr.exports=ee()})(this,function(){"use strict";function ie(ct,Ke,wt,et,qt,Ar){if(!(qt-et<=wt)){var Wr=et+qt>>1;ee(ct,Ke,Wr,et,qt,Ar%2),ie(ct,Ke,wt,et,Wr-1,Ar+1),ie(ct,Ke,wt,Wr+1,qt,Ar+1)}}function ee(ct,Ke,wt,et,qt,Ar){for(;qt>et;){if(qt-et>600){var Wr=qt-et+1,on=wt-et+1,A=Math.log(Wr),Se=.5*Math.exp(2*A/3),ke=.5*Math.sqrt(A*Se*(Wr-Se)/Wr)*(on-Wr/2<0?-1:1),St=Math.max(et,Math.floor(wt-on*Se/Wr+ke)),vt=Math.min(qt,Math.floor(wt+(Wr-on)*Se/Wr+ke));ee(ct,Ke,wt,St,vt,Ar)}var Ft=Ke[2*wt+Ar],Wt=et,Er=qt;for(Oe(ct,Ke,et,wt),Ke[2*qt+Ar]>Ft&&Oe(ct,Ke,et,qt);Wt<Er;){for(Oe(ct,Ke,Wt,Er),Wt++,Er--;Ke[2*Wt+Ar]<Ft;)Wt++;for(;Ke[2*Er+Ar]>Ft;)Er--}Ke[2*et+Ar]===Ft?Oe(ct,Ke,et,Er):(Er++,Oe(ct,Ke,Er,qt)),Er<=wt&&(et=Er+1),wt<=Er&&(qt=Er-1)}}function Oe(ct,Ke,wt,et){_e(ct,wt,et),_e(Ke,2*wt,2*et),_e(Ke,2*wt+1,2*et+1)}function _e(ct,Ke,wt){var et=ct[Ke];ct[Ke]=ct[wt],ct[wt]=et}function g(ct,Ke,wt,et,qt,Ar,Wr){for(var on=[0,ct.length-1,0],A=[],Se,ke;on.length;){var St=on.pop(),vt=on.pop(),Ft=on.pop();if(vt-Ft<=Wr){for(var Wt=Ft;Wt<=vt;Wt++)Se=Ke[2*Wt],ke=Ke[2*Wt+1],Se>=wt&&Se<=qt&&ke>=et&&ke<=Ar&&A.push(ct[Wt]);continue}var Er=Math.floor((Ft+vt)/2);Se=Ke[2*Er],ke=Ke[2*Er+1],Se>=wt&&Se<=qt&&ke>=et&&ke<=Ar&&A.push(ct[Er]);var $n=(St+1)%2;(St===0?wt<=Se:et<=ke)&&(on.push(Ft),on.push(Er-1),on.push($n)),(St===0?qt>=Se:Ar>=ke)&&(on.push(Er+1),on.push(vt),on.push($n))}return A}function Re(ct,Ke,wt,et,qt,Ar){for(var Wr=[0,ct.length-1,0],on=[],A=qt*qt;Wr.length;){var Se=Wr.pop(),ke=Wr.pop(),St=Wr.pop();if(ke-St<=Ar){for(var vt=St;vt<=ke;vt++)X(Ke[2*vt],Ke[2*vt+1],wt,et)<=A&&on.push(ct[vt]);continue}var Ft=Math.floor((St+ke)/2),Wt=Ke[2*Ft],Er=Ke[2*Ft+1];X(Wt,Er,wt,et)<=A&&on.push(ct[Ft]);var $n=(Se+1)%2;(Se===0?wt-qt<=Wt:et-qt<=Er)&&(Wr.push(St),Wr.push(Ft-1),Wr.push($n)),(Se===0?wt+qt>=Wt:et+qt>=Er)&&(Wr.push(Ft+1),Wr.push(ke),Wr.push($n))}return on}function X(ct,Ke,wt,et){var qt=ct-wt,Ar=Ke-et;return qt*qt+Ar*Ar}var pe=function(ct){return ct[0]},de=function(ct){return ct[1]},Ne=function(Ke,wt,et,qt,Ar){wt===void 0&&(wt=pe),et===void 0&&(et=de),qt===void 0&&(qt=64),Ar===void 0&&(Ar=Float64Array),this.nodeSize=qt,this.points=Ke;for(var Wr=Ke.length<65536?Uint16Array:Uint32Array,on=this.ids=new Wr(Ke.length),A=this.coords=new Ar(Ke.length*2),Se=0;Se<Ke.length;Se++)on[Se]=Se,A[2*Se]=wt(Ke[Se]),A[2*Se+1]=et(Ke[Se]);ie(on,A,qt,0,on.length-1,0)};Ne.prototype.range=function(Ke,wt,et,qt){return g(this.ids,this.coords,Ke,wt,et,qt,this.nodeSize)},Ne.prototype.within=function(Ke,wt,et){return Re(this.ids,this.coords,Ke,wt,et,this.nodeSize)};var xe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(ct){return ct}},tt=Math.fround||function(ct){return function(Ke){return ct[0]=+Ke,ct[0]}}(new Float32Array(1)),dt=function(Ke){this.options=sr(Object.create(xe),Ke),this.trees=new Array(this.options.maxZoom+1)};dt.prototype.load=function(Ke){var wt=this.options,et=wt.log,qt=wt.minZoom,Ar=wt.maxZoom,Wr=wt.nodeSize;et&&console.time("total time");var on="prepare "+Ke.length+" points";et&&console.time(on),this.points=Ke;for(var A=[],Se=0;Se<Ke.length;Se++)!Ke[Se].geometry||A.push(tr(Ke[Se],Se));this.trees[Ar+1]=new Ne(A,q,Yt,Wr,Float32Array),et&&console.timeEnd(on);for(var ke=Ar;ke>=qt;ke--){var St=+Date.now();A=this._cluster(A,ke),this.trees[ke]=new Ne(A,q,Yt,Wr,Float32Array),et&&console.log("z%d: %d clusters in %dms",ke,A.length,+Date.now()-St)}return et&&console.timeEnd("total time"),this},dt.prototype.getClusters=function(Ke,wt){var et=((Ke[0]+180)%360+360)%360-180,qt=Math.max(-90,Math.min(90,Ke[1])),Ar=Ke[2]===180?180:((Ke[2]+180)%360+360)%360-180,Wr=Math.max(-90,Math.min(90,Ke[3]));if(Ke[2]-Ke[0]>=360)et=-180,Ar=180;else if(et>Ar){var on=this.getClusters([et,qt,180,Wr],wt),A=this.getClusters([-180,qt,Ar,Wr],wt);return on.concat(A)}for(var Se=this.trees[this._limitZoom(wt)],ke=Se.range(nr(et),jt(Wr),nr(Ar),jt(qt)),St=[],vt=0,Ft=ke;vt<Ft.length;vt+=1){var Wt=Ft[vt],Er=Se.points[Wt];St.push(Er.numPoints?pr(Er):this.points[Er.index])}return St},dt.prototype.getChildren=function(Ke){var wt=this._getOriginId(Ke),et=this._getOriginZoom(Ke),qt="No cluster with the specified id.",Ar=this.trees[et];if(!Ar)throw new Error(qt);var Wr=Ar.points[wt];if(!Wr)throw new Error(qt);for(var on=this.options.radius/(this.options.extent*Math.pow(2,et-1)),A=Ar.within(Wr.x,Wr.y,on),Se=[],ke=0,St=A;ke<St.length;ke+=1){var vt=St[ke],Ft=Ar.points[vt];Ft.parentId===Ke&&Se.push(Ft.numPoints?pr(Ft):this.points[Ft.index])}if(Se.length===0)throw new Error(qt);return Se},dt.prototype.getLeaves=function(Ke,wt,et){wt=wt||10,et=et||0;var qt=[];return this._appendLeaves(qt,Ke,wt,et,0),qt},dt.prototype.getTile=function(Ke,wt,et){var qt=this.trees[this._limitZoom(Ke)],Ar=Math.pow(2,Ke),Wr=this.options,on=Wr.extent,A=Wr.radius,Se=A/on,ke=(et-Se)/Ar,St=(et+1+Se)/Ar,vt={features:[]};return this._addTileFeatures(qt.range((wt-Se)/Ar,ke,(wt+1+Se)/Ar,St),qt.points,wt,et,Ar,vt),wt===0&&this._addTileFeatures(qt.range(1-Se/Ar,ke,1,St),qt.points,Ar,et,Ar,vt),wt===Ar-1&&this._addTileFeatures(qt.range(0,ke,Se/Ar,St),qt.points,-1,et,Ar,vt),vt.features.length?vt:null},dt.prototype.getClusterExpansionZoom=function(Ke){for(var wt=this._getOriginZoom(Ke)-1;wt<=this.options.maxZoom;){var et=this.getChildren(Ke);if(wt++,et.length!==1)break;Ke=et[0].properties.cluster_id}return wt},dt.prototype._appendLeaves=function(Ke,wt,et,qt,Ar){for(var Wr=this.getChildren(wt),on=0,A=Wr;on<A.length;on+=1){var Se=A[on],ke=Se.properties;if(ke&&ke.cluster?Ar+ke.point_count<=qt?Ar+=ke.point_count:Ar=this._appendLeaves(Ke,ke.cluster_id,et,qt,Ar):Ar<qt?Ar++:Ke.push(Se),Ke.length===et)break}return Ar},dt.prototype._addTileFeatures=function(Ke,wt,et,qt,Ar,Wr){for(var on=0,A=Ke;on<A.length;on+=1){var Se=A[on],ke=wt[Se],St=ke.numPoints,vt=void 0,Ft=void 0,Wt=void 0;if(St)vt=Lt(ke),Ft=ke.x,Wt=ke.y;else{var Er=this.points[ke.index];vt=Er.properties,Ft=nr(Er.geometry.coordinates[0]),Wt=jt(Er.geometry.coordinates[1])}var $n={type:1,geometry:[[Math.round(this.options.extent*(Ft*Ar-et)),Math.round(this.options.extent*(Wt*Ar-qt))]],tags:vt},_n=void 0;St?_n=ke.id:this.options.generateId?_n=ke.index:this.points[ke.index].id&&(_n=this.points[ke.index].id),_n!==void 0&&($n.id=_n),Wr.features.push($n)}},dt.prototype._limitZoom=function(Ke){return Math.max(this.options.minZoom,Math.min(Math.floor(+Ke),this.options.maxZoom+1))},dt.prototype._cluster=function(Ke,wt){for(var et=[],qt=this.options,Ar=qt.radius,Wr=qt.extent,on=qt.reduce,A=qt.minPoints,Se=Ar/(Wr*Math.pow(2,wt)),ke=0;ke<Ke.length;ke++){var St=Ke[ke];if(!(St.zoom<=wt)){St.zoom=wt;for(var vt=this.trees[wt+1],Ft=vt.within(St.x,St.y,Se),Wt=St.numPoints||1,Er=Wt,$n=0,_n=Ft;$n<_n.length;$n+=1){var mi=_n[$n],Gn=vt.points[mi];Gn.zoom>wt&&(Er+=Gn.numPoints||1)}if(Er>Wt&&Er>=A){for(var ai=St.x*Wt,gi=St.y*Wt,Xn=on&&Wt>1?this._map(St,!0):null,yi=(ke<<5)+(wt+1)+this.points.length,va=0,Xi=Ft;va<Xi.length;va+=1){var Ri=Xi[va],Ji=vt.points[Ri];if(!(Ji.zoom<=wt)){Ji.zoom=wt;var ma=Ji.numPoints||1;ai+=Ji.x*ma,gi+=Ji.y*ma,Ji.parentId=yi,on&&(Xn||(Xn=this._map(St,!0)),on(Xn,this._map(Ji)))}}St.parentId=yi,et.push(At(ai/Er,gi/Er,yi,Er,Xn))}else if(et.push(St),Er>1)for(var Do=0,Oa=Ft;Do<Oa.length;Do+=1){var xa=Oa[Do],Ui=vt.points[xa];Ui.zoom<=wt||(Ui.zoom=wt,et.push(Ui))}}}return et},dt.prototype._getOriginId=function(Ke){return Ke-this.points.length>>5},dt.prototype._getOriginZoom=function(Ke){return(Ke-this.points.length)%32},dt.prototype._map=function(Ke,wt){if(Ke.numPoints)return wt?sr({},Ke.properties):Ke.properties;var et=this.points[Ke.index].properties,qt=this.options.map(et);return wt&&qt===et?sr({},qt):qt};function At(ct,Ke,wt,et,qt){return{x:tt(ct),y:tt(Ke),zoom:Infinity,id:wt,parentId:-1,numPoints:et,properties:qt}}function tr(ct,Ke){var wt=ct.geometry.coordinates,et=wt[0],qt=wt[1];return{x:tt(nr(et)),y:tt(jt(qt)),zoom:Infinity,index:Ke,parentId:-1}}function pr(ct){return{type:"Feature",id:ct.id,properties:Lt(ct),geometry:{type:"Point",coordinates:[ht(ct.x),gt(ct.y)]}}}function Lt(ct){var Ke=ct.numPoints,wt=Ke>=1e4?Math.round(Ke/1e3)+"k":Ke>=1e3?Math.round(Ke/100)/10+"k":Ke;return sr(sr({},ct.properties),{cluster:!0,cluster_id:ct.id,point_count:Ke,point_count_abbreviated:wt})}function nr(ct){return ct/360+.5}function jt(ct){var Ke=Math.sin(ct*Math.PI/180),wt=.5-.25*Math.log((1+Ke)/(1-Ke))/Math.PI;return wt<0?0:wt>1?1:wt}function ht(ct){return(ct-.5)*360}function gt(ct){var Ke=(180-ct*360)*Math.PI/180;return 360*Math.atan(Math.exp(Ke))/Math.PI-90}function sr(ct,Ke){for(var wt in Ke)ct[wt]=Ke[wt];return ct}function q(ct){return ct.x}function Yt(ct){return ct.y}return dt})},75752:function(Tr){Tr.exports.RADIUS=6378137,Tr.exports.FLATTENING=1/298.257223563,Tr.exports.POLAR_RADIUS=63567523142e-4}}]);
