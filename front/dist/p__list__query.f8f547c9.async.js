(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[2741],{55026:function(jt){jt.exports={main:"main___31kpQ",headerList:"headerList___2mK7o",stepDescription:"stepDescription___15qRg",pageHeader:"pageHeader___3Ha2b",moreInfo:"moreInfo___2mXTE"}},8778:function(jt,qt,i){"use strict";i.r(qt),i.d(qt,{default:function(){return ca}});var Aa=i(72012),or=i(39144),Na=i(66456),Ke=i(85453),La=i(59250),cr=i(13013),za=i(30887),Je=i(99210),Ga=i(74379),se=i(38648),Qa=i(57663),me=i(71577),Va=i(62350),Ct=i(75443),K=i(3182),f=i(11849),Da=i(48736),X=i(27049),Ua=i(9715),Ze=i(82482),Z=i(2824),Wa=i(43358),Xe=i(90290),dr=i(94043),q=i.n(dr),fr=i(1977),mr=i(73218),Mt=i(92104),kt=i(47760),wt=i(29934),vr=i(44545),pr=i(20924),hr=i(65233),yr=i(64335),gr=i(15103),xr=i(21349),v=i(67294),ae=i(58086);function Ba(){return _e.apply(this,arguments)}function _e(){return _e=_asyncToGenerator(_regeneratorRuntime.mark(function l(){return _regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",request("/api/profile/advanced"));case 1:case"end":return a.stop()}},l)})),_e.apply(this,arguments)}var Ce=i(91896);function Ya(l,e){return et.apply(this,arguments)}function et(){return et=_asyncToGenerator(_regeneratorRuntime.mark(function l(e,a){var s;return _regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return s=_extends({},e),n.abrupt("return",request("/api/query/all",_objectSpread({method:"GET",params:_objectSpread({},s)},a||{})));case 2:case"end":return n.stop()}},l)})),et.apply(this,arguments)}function Et(l,e){return tt.apply(this,arguments)}function tt(){return tt=(0,K.Z)(q().mark(function l(e,a){var s;return q().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return s=(0,Ce.Z)({},e),n.abrupt("return",(0,ae.WY)("/api/query/all",(0,f.Z)({method:"POST",params:(0,f.Z)({},s)},a||{})));case 2:case"end":return n.stop()}},l)})),tt.apply(this,arguments)}function Ka(l,e){return rt.apply(this,arguments)}function rt(){return rt=_asyncToGenerator(_regeneratorRuntime.mark(function l(e,a){var s;return _regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return s=_extends({},e),n.abrupt("return",request("/api/query/deleteThenReturnAll",_objectSpread({method:"GET",params:_objectSpread({},s)},a||{})));case 2:case"end":return n.stop()}},l)})),rt.apply(this,arguments)}function br(l,e){return at.apply(this,arguments)}function at(){return at=(0,K.Z)(q().mark(function l(e,a){var s;return q().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return s=(0,Ce.Z)({},e),n.abrupt("return",(0,ae.WY)("/api/query/deleteThenReturnAll",(0,f.Z)({method:"POST",params:(0,f.Z)({},s)},a||{})));case 2:case"end":return n.stop()}},l)})),at.apply(this,arguments)}function Ja(l,e){return nt.apply(this,arguments)}function nt(){return nt=_asyncToGenerator(_regeneratorRuntime.mark(function l(e,a){var s;return _regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return s=_extends({},e),n.abrupt("return",request("/api/query/exportCsv",_objectSpread({method:"GET",params:_objectSpread({},s)},a||{})));case 2:case"end":return n.stop()}},l)})),nt.apply(this,arguments)}function Xa(l,e){return lt.apply(this,arguments)}function lt(){return lt=_asyncToGenerator(_regeneratorRuntime.mark(function l(e,a){var s;return _regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return s=_extends({},e),n.abrupt("return",request("/api/query/exportCsv",_objectSpread({method:"POST",params:_objectSpread({},s)},a||{})));case 2:case"end":return n.stop()}},l)})),lt.apply(this,arguments)}function _a(l,e,a,s){return it.apply(this,arguments)}function it(){return it=_asyncToGenerator(_regeneratorRuntime.mark(function l(e,a,s,g){var n,R;return _regeneratorRuntime.wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return n=_extends({},e),R=new FormData,s&&R.append("Filedata",s[0]||""),Object.keys(a).forEach(function(x){var b=a[x];b!=null&&R.append(x,typeof b=="object"?JSON.stringify(b):b)}),m.abrupt("return",request("/api/query/importCsv",_objectSpread({method:"POST",headers:{"Content-Type":"multipart/form-data"},params:_objectSpread({},n),data:R},g||{})));case 5:case"end":return m.stop()}},l)})),it.apply(this,arguments)}function en(l,e){return st.apply(this,arguments)}function st(){return st=_asyncToGenerator(_regeneratorRuntime.mark(function l(e,a){var s;return _regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return s=_extends({},e),n.abrupt("return",request("/api/query/querySql",_objectSpread({method:"GET",params:_objectSpread({},s)},a||{})));case 2:case"end":return n.stop()}},l)})),st.apply(this,arguments)}function Sr(l,e){return ut.apply(this,arguments)}function ut(){return ut=(0,K.Z)(q().mark(function l(e,a){var s;return q().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return s=(0,Ce.Z)({},e),n.abrupt("return",(0,ae.WY)("/api/query/querySql",(0,f.Z)({method:"POST",params:(0,f.Z)({},s)},a||{})));case 2:case"end":return n.stop()}},l)})),ut.apply(this,arguments)}function tn(l,e){return ot.apply(this,arguments)}function ot(){return ot=_asyncToGenerator(_regeneratorRuntime.mark(function l(e,a){var s;return _regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return s=_extends({},e),n.abrupt("return",request("/api/query/querySqlAppend",_objectSpread({method:"GET",params:_objectSpread({},s)},a||{})));case 2:case"end":return n.stop()}},l)})),ot.apply(this,arguments)}function Zr(l,e){return ct.apply(this,arguments)}function ct(){return ct=(0,K.Z)(q().mark(function l(e,a){var s;return q().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return s=(0,Ce.Z)({},e),n.abrupt("return",(0,ae.WY)("/api/query/querySqlAppend",(0,f.Z)({method:"POST",params:(0,f.Z)({},s)},a||{})));case 2:case"end":return n.stop()}},l)})),ct.apply(this,arguments)}function rn(l,e){return dt.apply(this,arguments)}function dt(){return dt=_asyncToGenerator(_regeneratorRuntime.mark(function l(e,a){var s;return _regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return s=_extends({},e),n.abrupt("return",request("/api/query/save",_objectSpread({method:"GET",params:_objectSpread({},s)},a||{})));case 2:case"end":return n.stop()}},l)})),dt.apply(this,arguments)}function Tr(l,e){return ft.apply(this,arguments)}function ft(){return ft=(0,K.Z)(q().mark(function l(e,a){var s;return q().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return s=(0,Ce.Z)({},e),n.abrupt("return",(0,ae.WY)("/api/query/save",(0,f.Z)({method:"POST",params:(0,f.Z)({},s)},a||{})));case 2:case"end":return n.stop()}},l)})),ft.apply(this,arguments)}function an(l,e){return mt.apply(this,arguments)}function mt(){return mt=_asyncToGenerator(_regeneratorRuntime.mark(function l(e,a){var s;return _regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return s=_extends({},e),n.abrupt("return",request("/api/query/updatePoint",_objectSpread({method:"GET",params:_objectSpread({},s)},a||{})));case 2:case"end":return n.stop()}},l)})),mt.apply(this,arguments)}function jr(l,e){return vt.apply(this,arguments)}function vt(){return vt=(0,K.Z)(q().mark(function l(e,a){var s;return q().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return s=(0,Ce.Z)({},e),n.abrupt("return",(0,ae.WY)("/api/query/updatePoint",(0,f.Z)({method:"POST",params:(0,f.Z)({},s)},a||{})));case 2:case"end":return n.stop()}},l)})),vt.apply(this,arguments)}var qr=i(55026),Te=i.n(qr);function Cr(l,e,a){a!=null&&(l==null||l.code!="0")?a.error({message:l.message}):e(l)}function Mr(l,e){var a=URL.createObjectURL(new Blob([l])),s=document.createElement("a");s.style.display="none",s.href=a,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s)}function kr(l){var e=document.createElement("a");e.style.display="none",e.href=l,document.body.appendChild(e),e.click(),document.body.removeChild(e)}var Fe={dealCallback:Cr,download:Mr,download2:kr},Me=i(86582),nn=i(49111),wr=i(19650),ln=i(47673),he=i(4107),ze=i(37476),Er=i(59879),Rt=i(43061),Rr=i(30381),Pt=i.n(Rr),t=i(85893),Pr=he.Z.Search,sn=he.Z.TextArea,Fr=function(e){var a=(0,ae.YB)(),s=e.done,g=e.visible,n=e.content,R=e.setContent,I=e.querySql,m=e.activeQueryTabkey,x=e.setQuerySql,b=e.setVisible,r=(0,ae.tT)("@@initialState"),k=r.initialState,Q=r.setInitialState,U=(0,v.useState)(void 0),w=(0,Z.Z)(U,2),M=w[0],D=w[1],P=Xe.Z.Option,$=Ze.Z.useForm(),V=(0,Z.Z)($,1),A=V[0],_=(0,ae.QT)((0,K.Z)(q().mark(function d(){return q().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:case"end":return h.stop()}},d)}))),te=_.data,re=_.loading,H=_.mutate,o=function(){var d=(0,K.Z)(q().mark(function u(h,y,F){var z;return q().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.next=2,Et({pageSize:10,pageNum:h,nameLike:F});case 2:z=N.sent,Fe.dealCallback(z,function(O){var ie=0;O.data.pageItems.map(function(ee){ee.key=ie++}),R(O.data)},se.default);case 4:case"end":return N.stop()}},u)}));return function(h,y,F){return d.apply(this,arguments)}}(),S=function(){var d=(0,K.Z)(q().mark(function u(h){var y;return q().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.next=2,br({queryId:h.id,pageSize:10,pageNum:1,nameLike:M});case 2:y=z.sent,Fe.dealCallback(y,function(E){var N=0;E.data.pageItems.map(function(O){O.key=N++}),R(E.data)},se.default);case 4:case"end":return z.stop()}},u)}));return function(h){return d.apply(this,arguments)}}(),c=[{title:a.formatMessage({id:"query.sql.script.name"}),dataIndex:"name",key:"name",width:"20%",render:function(u){return(0,t.jsx)("div",{children:u})}},{title:"SQL",dataIndex:"sqls",key:"sqls",width:"45%",render:function(u){return(0,t.jsx)("div",{children:u})}},{title:a.formatMessage({id:"query.sql.script.createTime"}),dataIndex:"createTime",key:"createTime",width:"20%",render:function(u){return(0,t.jsx)(t.Fragment,{children:Pt()(parseInt(u)).format("YYYY-MM-DD HH:mm")})}},{title:a.formatMessage({id:"pages.operation.text"}),key:"action",render:function(u,h){return(0,t.jsxs)(wr.Z,{size:"middle",children:[(0,t.jsx)("a",{onClick:function(F){I[m]=h.sqls,x((0,f.Z)({},I)),b(!1)},children:a.formatMessage({id:"pages.use.text"})}),(0,t.jsx)(Ct.Z,{placement:"left",title:h.name+" -- "+a.formatMessage({id:"pages.delete.confirm"}),onConfirm:function(F){return S(h,F)},children:(0,t.jsx)("a",{children:a.formatMessage({id:"pages.delete.text"})})})]})}}];return g?(0,t.jsx)(ze.Z,{visible:g,form:A,title:a.formatMessage({id:"query.sql.script.view"}),className:Te().standardListForm,initialValues:n.pageItems,submitter:{submitButtonProps:{style:{display:"none"}},render:function(u,h){return(0,Me.Z)(h)}},modalProps:{onCancel:function(){return b(!1)},destroyOnClose:!0,bodyStyle:s?{padding:"72px 0"}:{}},children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{style:{textAlign:"right",marginBottom:"10px",marginTop:"-10px"},children:(0,t.jsxs)(me.Z.Group,{children:[(0,t.jsxs)(me.Z,{value:"all",onClick:function(){D(null),o(1,10)},children:[(0,t.jsx)(Er.Z,{}),a.formatMessage({id:"pages.refresh.text"})]}),(0,t.jsx)(Pr,{style:{width:"190px"},placeholder:a.formatMessage({id:"pages.refresh.placeholder"}),onSearch:function(u){o(1,10,u)},onChange:function(u){D(u.target.value)},value:M,suffix:M==null||M==""?(0,t.jsx)(Rt.Z,{style:{display:"none"}}):(0,t.jsx)(Rt.Z,{style:{color:"rgba(0,0,0,.45)"},onClick:function(){D(null)}})})]})}),(0,t.jsx)(Ke.Z,{columns:c,dataSource:n.pageItems,pagination:{showSizeChanger:!1,showQuickJumper:!0,pageSize:10,current:n==null?1:n.pageNo,total:n==null?1:n.totalCount,onChange:function(u,h){o(u,h,M)}}})]})}):null},Or=Fr,Ft=i(5966),un=he.Z.Search,on=he.Z.TextArea,Hr=function(e){var a=(0,ae.YB)(),s=e.done,g=e.visible,n=e.setVisible,R=e.querySql,I=e.activeQueryTabkey,m=Ze.Z.useForm(),x=(0,Z.Z)(m,1),b=x[0],r=(0,ae.QT)((0,K.Z)(q().mark(function M(){return q().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:case"end":return P.stop()}},M)}))),k=r.data,Q=r.loading,U=r.mutate,w=function(){var M=(0,K.Z)(q().mark(function D(P){var $;return q().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,Tr({sqls:R[I],name:P});case 2:$=A.sent,Fe.dealCallback($,function(_){se.default.success({message:a.formatMessage({id:"query.sql.script.save.success"})+" "+P}),n(!1)},se.default);case 4:case"end":return A.stop()}},D)}));return function(P){return M.apply(this,arguments)}}();return g?(0,t.jsx)(ze.Z,{visible:g,form:b,title:a.formatMessage({id:"query.sql.script.create"}),className:Te().standardListForm,submitter:{render:function(D,P){return(0,Me.Z)(P)}},onFinish:function(D){w(D.name)},modalProps:{onCancel:function(){return n(!1)},destroyOnClose:!0,bodyStyle:s?{padding:"72px 0"}:{}},children:(0,t.jsx)(Ft.Z,{name:"name",label:a.formatMessage({id:"query.sql.script.name"}),rules:[{required:!0}]})}):null},Ir=Hr,cn=i(13062),pt=i(71230),dn=i(89032),ke=i(15746),ht=i(86615),Ot=i(64317),Ht=i(29656),$r=i(4631),Ar=i.n($r);(function(l){typeof exports=="object"?l(i(4631)):typeof define=="function"&&i.amdO?define(["../../../node_modules/codemirror/lib/codemirror"],l):l(Ar())})(function(l){"use strict";l.defineMode("iotdb-sql",function(m,x){var b=x.client||{},r=x.atoms||{false:!0,true:!0,null:!0},k=x.builtin||R(I),Q=x.keywords||R(n),U=x.operatorChars||/^[*+\-%<>!=&|~^\/]/,w=x.support||{},M=x.hooks||{},D=x.dateSQL||{date:!0,time:!0,timestamp:!0},P=x.backslashStringEscapes!==!1,$=x.brackets||/^[\{}\(\)\[\]]/,V=x.punctuation||/^[;.,:]/;function A(o,S){var c=o.next();if(M[c]){var d=M[c](o,S);if(d!==!1)return d}if(w.hexNumber&&(c=="0"&&o.match(/^[xX][0-9a-fA-F]+/)||(c=="x"||c=="X")&&o.match(/^'[0-9a-fA-F]+'/)))return"number";if(w.binaryNumber&&((c=="b"||c=="B")&&o.match(/^'[01]+'/)||c=="0"&&o.match(/^b[01]+/)))return"number";if(c.charCodeAt(0)>47&&c.charCodeAt(0)<58)return o.match(/^[0-9]*(\.[0-9]+)?([eE][-+]?[0-9]+)?/),w.decimallessFloat&&o.match(/^\.(?!\.)/),"number";if(c=="?"&&(o.eatSpace()||o.eol()||o.eat(";")))return"variable-3";if(c=="'"||c=='"'&&w.doubleQuote)return S.tokenize=_(c),S.tokenize(o,S);if((w.nCharCast&&(c=="n"||c=="N")||w.charsetCast&&c=="_"&&o.match(/[a-z][a-z0-9]*/i))&&(o.peek()=="'"||o.peek()=='"'))return"keyword";if(w.escapeConstant&&(c=="e"||c=="E")&&(o.peek()=="'"||o.peek()=='"'&&w.doubleQuote))return S.tokenize=function(h,y){return(y.tokenize=_(h.next(),!0))(h,y)},"keyword";if(w.commentSlashSlash&&c=="/"&&o.eat("/"))return o.skipToEnd(),"comment";if(w.commentHash&&c=="#"||c=="-"&&o.eat("-")&&(!w.commentSpaceRequired||o.eat(" ")))return o.skipToEnd(),"comment";if(c=="/"&&o.eat("*"))return S.tokenize=te(1),S.tokenize(o,S);if(c=="."){if(w.zerolessFloat&&o.match(/^(?:\d+(?:e[+-]?\d+)?)/i))return"number";if(o.match(/^\.+/))return null;if(w.ODBCdotTable&&o.match(/^[\w\d_$#]+/))return"variable-2"}else{if(U.test(c))return o.eatWhile(U),"operator";if($.test(c))return"bracket";if(V.test(c))return o.eatWhile(V),"punctuation";if(c=="{"&&(o.match(/^( )*(d|D|t|T|ts|TS)( )*'[^']*'( )*}/)||o.match(/^( )*(d|D|t|T|ts|TS)( )*"[^"]*"( )*}/)))return"number";o.eatWhile(/^[_\w\d]/);var u=o.current().toLowerCase();return D.hasOwnProperty(u)&&(o.match(/^( )+'[^']*'/)||o.match(/^( )+"[^"]*"/))?"number":r.hasOwnProperty(u)?"atom":k.hasOwnProperty(u)?"builtin":Q.hasOwnProperty(u)?"keyword":b.hasOwnProperty(u)?"string-2":null}}function _(o,S){return function(c,d){for(var u=!1,h;(h=c.next())!=null;){if(h==o&&!u){d.tokenize=A;break}u=(P||S)&&!u&&h=="\\"}return"string"}}function te(o){return function(S,c){var d=S.match(/^.*?(\/\*|\*\/)/);return d?d[1]=="/*"?c.tokenize=te(o+1):o>1?c.tokenize=te(o-1):c.tokenize=A:S.skipToEnd(),"comment"}}function re(o,S,c){S.context={prev:S.context,indent:o.indentation(),col:o.column(),type:c}}function H(o){o.indent=o.context.indent,o.context=o.context.prev}return{startState:function(){return{tokenize:A,context:null}},token:function(S,c){if(S.sol()&&c.context&&c.context.align==null&&(c.context.align=!1),c.tokenize==A&&S.eatSpace())return null;var d=c.tokenize(S,c);if(d=="comment")return d;c.context&&c.context.align==null&&(c.context.align=!0);var u=S.current();return u=="("?re(S,c,")"):u=="["?re(S,c,"]"):c.context&&c.context.type==u&&H(c),d},indent:function(S,c){var d=S.context;if(!d)return l.Pass;var u=c.charAt(0)==d.type;return d.align?d.col+(u?0:1):d.indent+(u?0:m.indentUnit)},blockCommentStart:"/*",blockCommentEnd:"*/",lineComment:w.commentSlashSlash?"//":w.commentHash?"#":"--",closeBrackets:"()[]{}''\"\"``"}});function e(m){for(var x;(x=m.next())!=null;)if(x=="`"&&!m.eat("`"))return"variable-2";return m.backUp(m.current().length-1),m.eatWhile(/\w/)?"variable-2":null}function a(m){for(var x;(x=m.next())!=null;)if(x=='"'&&!m.eat('"'))return"variable-2";return m.backUp(m.current().length-1),m.eatWhile(/\w/)?"variable-2":null}function s(m){return m.eat("@")&&(m.match("session."),m.match("local."),m.match("global.")),m.eat("'")?(m.match(/^.*'/),"variable-2"):m.eat('"')?(m.match(/^.*"/),"variable-2"):m.eat("`")?(m.match(/^.*`/),"variable-2"):m.match(/^[0-9a-zA-Z$\.\_]+/)?"variable-2":null}function g(m){return m.eat("N")?"atom":m.match(/^[a-zA-Z.#!?]/)?"variable-2":null}var n="alter and as asc between by count create delete desc distinct drop from group having in insert into is join like not on or order select set table union update values where limit ";function R(m){for(var x={},b=m.split(" "),r=0;r<b.length;++r)x[b[r]]=!0;return x}var I="bool boolean bit blob enum long longblob longtext medium mediumblob mediumint mediumtext time timestamp tinyblob tinyint tinytext text bigint int int1 int2 int3 int4 int8 integer float float4 float8 double char varbinary varchar varcharacter precision real date datetime year unsigned signed decimal numeric";l.defineMIME("text/iotdb-sql",{name:"sql",keywords:R("non_negative_derivative derivative non_negative_difference difference time_difference bottom_k top_k string_matches string_contains abs sqrt log10 ln exp round floor ceil sign radians degrees atan acos asin tan cos sin int32 int64 float double boolean text false true null time timestamp lock any without debug explain tolerance like concat contain top asc desc stop start after before triggers trigger as functions function temporary schema for snapshot partition latest cache clear full global rename tags attributes compression align disable last last_value sum first_value avg max_value min_value max_time min_time level nodes count devices paths child move remove version info task flush ttl unset watermark_embedding load revoke password alter of all role privileges user list merge drop off on tracing using index link now values alias upsert add bitmap encoding insert create update delete select show query kill processlist grant into set where from to order by device configuration describe slimit limit unlink offset soffset fill linear previous previousuntillast metadata timeseries property with datatype compressor storage group label"),builtin:R("root now non_negative_derivative derivative non_negative_difference difference time_difference bottom_k top_k string_matches string_contains max_time min_time max_value min_value last_value first_value sum avg count abs sqrt log10 ln exp round floor ceil sign radians degrees atan acos asin tan cos sin false true null time timestamp int32 int64 float double boolean text"),atoms:R("plain plain_dictionary rle diff ts_2diff gorilla regular pla paa lzo gzip lz4 snappy uncompressed"),dateSQL:R(""),support:R("commentHash ODBCdotTable doubleQuote binaryNumber hexNumber")})});var fn=i(71707),mn=i(3585),vn=i(14504),pn=he.Z.Search,hn=he.Z.TextArea,Nr=function(e){var a=(0,ae.YB)(),s=e.done,g=e.visible,n=e.setVisible,R=e.exportCsv,I=e.activeQueryTabkey,m=e.initExportSql,x=(0,ae.tT)("@@initialState"),b=x.initialState,r=x.setInitialState,k=v.useState(void 0),Q=(0,Z.Z)(k,2),U=Q[0],w=Q[1],M=(0,v.useState)({query1:"select * from root"}),D=(0,Z.Z)(M,1),P=D[0],$=v.useState("number"),V=(0,Z.Z)($,2),A=V[0],_=V[1],te=v.useState("+08:00"),re=(0,Z.Z)(te,2),H=re[0],o=re[1],S=v.useState(!0),c=(0,Z.Z)(S,2),d=c[0],u=c[1],h=v.useState("plain"),y=(0,Z.Z)(h,2),F=y[0],z=y[1],E=Ze.Z.useForm(),N=(0,Z.Z)(E,1),O=N[0],ie=(0,t.jsx)(Ht.Rt,{value:P.query1,options:{mode:"text/iotdb-sql",theme:"juejin",autofocus:!1,lineNumbers:!0,tabindex:1,extraKeys:{"Alt-/":"autocomplete","Ctrl-/":"toggleComment"},matchBrackets:!0,indentWithTabs:!0,smartIndent:!0,hintOptions:{completeSingle:!1}},onChange:function(W,le,xe){le.origin!=null&&(le.removed[0].trim()!=""||le.text[0].match(/^[a-zA-Z0-9_]+$/))&&W.showHint(),P.query1=xe}});return g?(0,t.jsxs)(ze.Z,{visible:g,form:O,title:a.formatMessage({id:"query.sql.export"}),className:Te().standardListForm,column:2,submitter:{submitButtonProps:{style:{display:"none"}},render:function(W,le){return[].concat((0,Me.Z)(le),[(0,t.jsx)(me.Z,{type:"primary",onClick:function(){R({queryCommand:P.query1,targetFile:U,timeformat:A,timeZone:H,compress:F})},children:a.formatMessage({id:"query.sql.export"})},"export")])}},modalProps:{onCancel:function(){return n(!1)},destroyOnClose:!0,bodyStyle:s?{padding:"72px 0"}:{}},children:[(0,t.jsx)("div",{style:{marginBottom:10},children:a.formatMessage({id:"query.sql.export.sqlWithRequired"})}),(0,t.jsx)("div",{style:{marginBottom:20},children:ie}),(0,t.jsxs)(pt.Z,{gutter:16,children:[(0,t.jsx)(ke.Z,{lg:12,md:24,sm:48,children:(0,t.jsx)(Ft.Z,{name:"name",label:a.formatMessage({id:"query.sql.export.backupNameWithOptional"}),placeholder:"dump",fieldProps:{value:U,onChange:function(W){w(W.target.value)}}})}),(0,t.jsx)(ke.Z,{lg:10,md:20,sm:40,children:(0,t.jsx)(ht.Z.Group,{name:"compress",label:a.formatMessage({id:"query.sql.export.compressionMode"}),radioType:"button",size:"small",options:[{label:a.formatMessage({id:"query.sql.export.compression.no"}),value:"plain"},{label:"GZIP",value:"gzip"},{label:"SNAPPY",value:"snappy"}],initialValue:F,fieldProps:{buttonStyle:"solid",onChange:function(W){z(W.target.value)}}})})]}),(0,t.jsxs)(pt.Z,{gutter:16,children:[(0,t.jsx)(ke.Z,{lg:12,md:24,sm:48,children:(0,t.jsx)(ht.Z.Group,{name:"tf",label:a.formatMessage({id:"query.sql.export.timeFormat"}),radioType:"button",size:"small",options:[{label:a.formatMessage({id:"query.sql.export.timeFormat.number"}),value:"number"},{label:a.formatMessage({id:"query.sql.export.timeFormat.default"}),value:"default"},{label:a.formatMessage({id:"query.sql.export.timeFormat.timestamp"}),value:"yyyy-MM-dd HH:mm:ss.SSS"}],initialValue:A,fieldProps:{buttonStyle:"solid",onChange:function(W){W.target.value=="number"?u(!0):u(!1),_(W.target.value)}}})}),(0,t.jsx)(ke.Z,{lg:10,md:20,sm:40,children:(0,t.jsx)(Ot.Z,{label:a.formatMessage({id:"query.sql.export.timeZone"}),name:"zone",disabled:d,options:[{label:"-12:00",value:"-12:00"},{label:"-11:00",value:"-11:00"},{label:"-10:00",value:"-10:00"},{label:"-09:00",value:"-09:00"},{label:"-08:00",value:"-08:00"},{label:"-07:00",value:"-07:00"},{label:"-06:00",value:"-06:00"},{label:"-05:00",value:"-05:00"},{label:"-04:00",value:"-04:00"},{label:"-03:00",value:"-03:00"},{label:"-02:00",value:"-02:00"},{label:"-01:00",value:"-01:00"},{label:"+00:00",value:"+00:00"},{label:"+01:00",value:"+01:00"},{label:"+02:00",value:"+02:00"},{label:"+03:00",value:"+03:00"},{label:"+04:00",value:"+04:00"},{label:"+05:00",value:"+05:00"},{label:"+06:00",value:"+06:00"},{label:"+07:00",value:"+07:00"},{label:"+08:00",value:"+08:00"},{label:"+09:00",value:"+09:00"},{label:"+10:00",value:"+10:00"},{label:"+11:00",value:"+11:00"},{label:"+12:00",value:"+12:00"}],initialValue:"+08:00",fieldProps:{allowClear:!1,onChange:function(W){o(W)}}})})]})]}):null},Lr=Nr,yn=i(43185),zr=i(11324),gn=he.Z.Search,xn=he.Z.TextArea,Gr=function(e){var a=(0,ae.YB)(),s=e.done,g=e.visible,n=e.setVisible,R=e.activeQueryTabkey,I=e.initExportSql,m=v.useState(void 0),x=(0,Z.Z)(m,2),b=x[0],r=x[1],k=v.useState("+08:00"),Q=(0,Z.Z)(k,2),U=Q[0],w=Q[1],M=v.useState("plain"),D=(0,Z.Z)(M,2),P=D[0],$=D[1],V=v.useState(0),A=(0,Z.Z)(V,2),_=A[0],te=A[1],re=v.useState(!1),H=(0,Z.Z)(re,2),o=H[0],S=H[1],c=Ze.Z.useForm(),d=(0,Z.Z)(c,1),u=d[0];return g?(0,t.jsx)(ze.Z,{visible:g,form:u,title:a.formatMessage({id:"query.sql.import"}),className:Te().standardListForm,column:2,submitter:{submitButtonProps:{style:{display:"none"}},render:function(y,F){return[].concat((0,Me.Z)(F),[(0,t.jsx)(zr.Z,{action:"/api/query/importCsv",name:"Filedata",showUploadList:!1,data:{compress:P,timeZone:U},beforeUpload:function(E){var N=E.name,O=N.substring(N.lastIndexOf(".")),ie=E.size,ee=3,W=Math.ceil(ie/1024/1024),le=Math.ceil(W*10);return P=="plain"&&O!=".csv"?(se.default.error({message:a.formatMessage({id:"query.sql.import.compression.no.rule"})}),!1):P=="snappy"&&O!=".snappy"?(se.default.error({message:a.formatMessage({id:"query.sql.import.compression.snappy.rule"})}),!1):P=="gzip"&&O!=".gz"?(se.default.error({message:a.formatMessage({id:"query.sql.import.compression.gzip.rule"})}),!1):W>ee?(se.default.error({message:a.formatMessage({id:"query.sql.import.size.rule"})+" "+ee+" MB"}),!1):!0},onChange:function(E){E.file.response!=null&&(S(!1),(E.file.response.code!="0"||E.file.status=="error")&&se.default.error({message:E.file.response.message}))},withCredentials:!0,children:(0,t.jsx)(me.Z,{type:"primary",children:a.formatMessage({id:"query.sql.import.selectFile"})},"import")},"upload")])}},modalProps:{onCancel:function(){n(!1)},destroyOnClose:!0,bodyStyle:s?{padding:"72px 0"}:{}},children:(0,t.jsxs)(pt.Z,{gutter:16,children:[(0,t.jsx)(ke.Z,{lg:12,md:24,sm:48,children:(0,t.jsx)(ht.Z.Group,{name:"compress",label:a.formatMessage({id:"query.sql.export.compressionMode"}),radioType:"button",size:"small",options:[{label:a.formatMessage({id:"query.sql.export.compression.no"}),value:"plain"},{label:"GZIP",value:"gzip"},{label:"SNAPPY",value:"snappy"}],initialValue:P,fieldProps:{buttonStyle:"solid",onChange:function(y){$(y.target.value)}}})}),(0,t.jsx)(ke.Z,{lg:10,md:20,sm:40,children:(0,t.jsx)(Ot.Z,{label:a.formatMessage({id:"query.sql.export.timeZone"}),tooltip:a.formatMessage({id:"query.sql.export.timeZone.description"}),name:"zone",options:[{label:"-12:00",value:"-12:00"},{label:"-11:00",value:"-11:00"},{label:"-10:00",value:"-10:00"},{label:"-09:00",value:"-09:00"},{label:"-08:00",value:"-08:00"},{label:"-07:00",value:"-07:00"},{label:"-06:00",value:"-06:00"},{label:"-05:00",value:"-05:00"},{label:"-04:00",value:"-04:00"},{label:"-03:00",value:"-03:00"},{label:"-02:00",value:"-02:00"},{label:"-01:00",value:"-01:00"},{label:"+00:00",value:"+00:00"},{label:"+01:00",value:"+01:00"},{label:"+02:00",value:"+02:00"},{label:"+03:00",value:"+03:00"},{label:"+04:00",value:"+04:00"},{label:"+05:00",value:"+05:00"},{label:"+06:00",value:"+06:00"},{label:"+07:00",value:"+07:00"},{label:"+08:00",value:"+08:00"},{label:"+09:00",value:"+09:00"},{label:"+10:00",value:"+10:00"},{label:"+11:00",value:"+11:00"},{label:"+12:00",value:"+12:00"}],initialValue:"+08:00",fieldProps:{value:U,allowClear:!1,onChange:function(y){w(y)}}})})]})}):null},Qr=Gr,Vr=i(55877),bn=i(402),It=i(59289),Sn=i(77883),yt=i(51368),Ge=i(93224),Dr=i(54549),Ur=i(79508),Wr=i(2603),Br=i(81296),Yr=i(58848),ge;(function(l){l.INITHEIGHT="INITHEIGHT",l.RENDERTR="RENDERTR",l.RESET="RESET"})(ge||(ge={}));var $t={rowHeight:0,curScrollTop:0,scrollHeight:0,tableScrollY:0};function Kr(l,e){var a=e.curScrollTop,s=e.scrollHeight,g=e.tableScrollY,n=e.rowHeight;switch(e.type){case ge.RENDERTR:return s<0&&(s=0),l.scrollHeight&&g===l.tableScrollY&&(s=l.scrollHeight),l.scrollHeight&&a>l.scrollHeight&&(a=l.scrollHeight),(0,f.Z)((0,f.Z)({},l),{},{curScrollTop:a,scrollHeight:s,tableScrollY:g});case ge.INITHEIGHT:return(0,f.Z)((0,f.Z)({},l),{},{rowHeight:n});case ge.RESET:return(0,f.Z)((0,f.Z)({},l),{},{curScrollTop:0,scrollHeight:0});default:throw new Error}}var gt=(0,v.createContext)({dispatch:Function,renderLen:1,start:0,offsetStart:0,rowHeight:$t.rowHeight,totalLen:0}),xt=0,Oe=null,Zn=function(e){var a=e.children,s=_objectWithoutProperties(e,["children"]);return _jsx("td",_objectSpread(_objectSpread({},s),{},{children:_jsx("div",{children:"zxc"})}))},Jr=function(e){var a=(0,v.useContext)(gt),s=a.dispatch,g=a.rowHeight,n=a.totalLen,R=e.children,I=(0,Ge.Z)(e,["children"]),m=(0,v.useRef)(null);return(0,v.useEffect)(function(){var x=function(r){var k;if(r!=null&&(k=r.current)!==null&&k!==void 0&&k.offsetHeight&&!g&&n){var Q,U,w=(Q=r==null||(U=r.current)===null||U===void 0?void 0:U.offsetHeight)!==null&&Q!==void 0?Q:0;s({type:ge.INITHEIGHT,rowHeight:w})}};x(m)},[m,g,n,s]),(0,t.jsx)("tr",(0,f.Z)((0,f.Z)({},I),{},{ref:m,style:{height:g||"auto",boxSizing:"border-box"},children:R}))},Xr=function(e){var a=e.children,s=(0,Ge.Z)(e,["children"]),g=(0,v.useContext)(gt),n=g.renderLen,R=g.start,I=g.offsetStart,m=a[1],x=null;return Array.isArray(m)&&m.length?x=[a[0],m.slice(R,R+n).map(function(b){return Array.isArray(b)?b[0]:b})]:x=a,(0,t.jsx)("tbody",(0,f.Z)((0,f.Z)({},s),{},{style:{transform:"translateY(-".concat(I,"px)")},children:x}))},we=null,_r=function(e){var a,s,g,n,R=e.style,I=e.children,m=(0,Ge.Z)(e,["style","children"]),x=(0,v.useReducer)(Kr,$t),b=(0,Z.Z)(x,2),r=b[0],k=b[1],Q=(0,v.useRef)(null),U=(0,v.useState)((a=(s=I[1])===null||s===void 0||(g=s.props)===null||g===void 0||(n=g.data)===null||n===void 0?void 0:n.length)!==null&&a!==void 0?a:0),w=(0,Z.Z)(U,2),M=w[0],D=w[1];(0,v.useEffect)(function(){var H,o,S;if((H=I[1])!==null&&H!==void 0&&(o=H.props)!==null&&o!==void 0&&(S=o.data)!==null&&S!==void 0&&S.length){var c,d,u;D((c=I[1])===null||c===void 0||(d=c.props)===null||d===void 0||(u=d.data)===null||u===void 0?void 0:u.length)}},[I]);var P=(0,v.useMemo)(function(){var H="auto";return r.rowHeight&&M&&(H=r.rowHeight*M+10),H},[r.rowHeight,M]),$=0;if(typeof xt=="string"){var V,A;$=(V=we.current)===null||V===void 0||(A=V.parentNode)===null||A===void 0?void 0:A.offsetHeight}else $=xt;(0,Br.Z)(P)&&P<$&&($=P),$<=0&&($=0);var _=(0,v.useMemo)(function(){var H=1;if(r.rowHeight&&M&&$)if($<=0)H=0;else{var o=($/r.rowHeight|0)+1+2;H=o>M?M:o}return H},[r.rowHeight,M,$]),te=r.rowHeight?r.curScrollTop/r.rowHeight|0:0,re=r.rowHeight?r.curScrollTop%r.rowHeight:0;return r.curScrollTop&&r.rowHeight&&r.curScrollTop>r.rowHeight?te>M-_?re=0:te>1&&(te=te-1,re+=r.rowHeight):te=0,(0,v.useEffect)(function(){var H,o,S=(H=we)===null||H===void 0||(o=H.current)===null||o===void 0?void 0:o.parentNode;S&&(S.scrollTop=0),k({type:ge.RESET})},[M]),(0,v.useEffect)(function(){var H,o,S=(0,Yr.Z)(function(d){var u,h,y,F,z,E,N=(u=d==null||(h=d.target)===null||h===void 0?void 0:h.scrollTop)!==null&&u!==void 0?u:0,O=(y=d==null||(F=d.target)===null||F===void 0?void 0:F.scrollHeight)!==null&&y!==void 0?y:0,ie=(z=d==null||(E=d.target)===null||E===void 0?void 0:E.clientHeight)!==null&&z!==void 0?z:0;if(N===O?Oe&&Oe():N+ie===O&&Oe&&Oe(),N!==r.curScrollTop){var ee=d.target.scrollHeight-$;k({type:ge.RENDERTR,curScrollTop:N,scrollHeight:ee,tableScrollY:$})}},60),c=(H=we)===null||H===void 0||(o=H.current)===null||o===void 0?void 0:o.parentNode;return c&&c.addEventListener("scroll",S),function(){c==null||c.removeEventListener("scroll",S)}},[we,r.curScrollTop,$,r.scrollHeight]),(0,t.jsx)("div",{ref:we,style:{width:"100%",position:"relative",height:P,boxSizing:"border-box",paddingTop:r.curScrollTop},children:(0,t.jsx)(gt.Provider,{value:{dispatch:k,start:te,offsetStart:re,renderLen:_,totalLen:M,rowHeight:r.rowHeight},children:(0,t.jsx)("table",(0,f.Z)((0,f.Z)({},m),{},{ref:Q,style:(0,f.Z)({width:"100%",position:"relative"},R),children:I}))})})},ea=function(e){var a=e.columns,s=e.scroll,g=e.sticky,n=e.pagination,R=e.editingKey,I=e.setEditingKey,m=e.form,x=e.updatePoint,b=e.data,r=e.setData,k=e.active,Q=e.rowKey,U=e.clearEditable,w=e.wrapTableRef,M=e.timeDisplayForm,D=function(u){return u[Q]===R},P=(0,v.useState)({}),$=(0,Z.Z)(P,2),V=$[0],A=$[1],_=v.useRef(null),te={ref:_},re=function(u){var h=u.editing,y=u.dataIndex,F=u.title,z=u.inputType,E=u.record,N=u.index,O=u.children,ie=(0,Ge.Z)(u,["editing","dataIndex","title","inputType","record","index","children"]),ee=z==="number"?(0,t.jsx)(yt.Z,{}):(0,t.jsx)(he.Z,{readOnly:V[y]!=!0,addonAfter:y!=null&&y.indexOf(".")<0?null:V[y]==!0?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("a",{title:"unsave",children:(0,t.jsx)(Dr.Z,{style:{color:"#fc4c2f"},onClick:function(){var W=(0,K.Z)(q().mark(function le(xe){var ce;return q().wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:ce={},ce[y]=E[y],m.setFieldsValue((0,f.Z)({},ce)),V[y]=!1,A((0,f.Z)({},V));case 5:case"end":return ue.stop()}},le)}));return function(le){return W.apply(this,arguments)}}()})}),(0,t.jsx)(X.Z,{type:"vertical"}),(0,t.jsx)("a",{title:"save",onClick:function(){var W=(0,K.Z)(q().mark(function le(xe){var ce,He,ue,Ie,Qe,$e;return q().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.next=2,x(E.Time,y,m.getFieldsValue()[y]);case 2:if(ce=B.sent,V[y]=!1,A((0,f.Z)({},V)),!(ce!=null&&ce.message!=null)){B.next=20;break}if(ce.code!="0"){B.next=16;break}return B.next=9,m.validateFields();case 9:He=B.sent,ue=(0,Me.Z)(b[k]),b[k]=ue,Ie=ue.findIndex(function(je){return E[Q]===je[Q]}),Ie>-1&&(Qe=ue[Ie],Qe[y]=He[y],b[k]=ue,r((0,f.Z)({},b))),B.next=20;break;case 16:se.default.error({message:ce.message}),$e={},$e[y]=E[y],m.setFieldsValue((0,f.Z)({},$e));case 20:case"end":return B.stop()}},le)}));return function(le){return W.apply(this,arguments)}}(),children:(0,t.jsx)(Ur.Z,{style:{color:"#1890ff"}})})]}):(0,t.jsx)("a",{title:"click to unlock",onClick:function(){V[y]=!0,A((0,f.Z)({},V))},children:(0,t.jsx)(Wr.Z,{})})});return(0,t.jsx)("td",(0,f.Z)((0,f.Z)({},ie),{},{children:h?(0,t.jsx)(Ze.Z.Item,{name:y,style:{margin:0},rules:[],children:ee}):O}))};a.length>1&&(a[0].render=function(d,u){return(0,t.jsxs)("span",{children:[b[k][u.index-1][a[0].key],(0,t.jsx)("div",{children:"\xA0"})]})},a[1].render=function(d,u){if(a[1].key=="Time"){var h=D(u);return h?(0,t.jsxs)("span",{children:[b[k][u.index-1].Time,(0,t.jsx)("div",{children:(0,t.jsx)(It.Z.Link,{onClick:o,children:"finish"})})]}):(0,t.jsxs)("span",{children:[M[k]=="utc"?Pt()(parseInt(b[k][u.index-1].Time)).utc().format("YYYY-MM-DD HH:mm:ss.SSS"):b[k][u.index-1].Time,(0,t.jsx)("div",{children:(0,t.jsx)(It.Z.Link,{onClick:function(){return H(u)},children:"edit"})})]})}else return b[k][u.index-1][a[1].key]});var H=function(){var d=(0,K.Z)(q().mark(function u(h){var y,F;return q().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return A({}),E.next=3,m.validateFields();case 3:y=E.sent,F={},Object.keys(h).map(function(N,O){N!=Q&&(F[N]=h[N])}),Object.keys(a).map(function(N,O){h[N]==null&&(F[N]=null)}),m.setFieldsValue((0,f.Z)({},F)),I(h[Q]);case 9:case"end":return E.stop()}},u)}));return function(h){return d.apply(this,arguments)}}(),o=function(){U()},S=function(){var d=(0,K.Z)(q().mark(function u(h){var y,F,z,E;return q().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.prev=0,O.next=3,m.validateFields();case 3:y=O.sent,F=(0,Me.Z)(b[k]),z=F.findIndex(function(ie){return h[Q]===ie[Q]}),z>-1?(E=F[z],F.splice(z,1,(0,f.Z)((0,f.Z)({},E),y)),b[k]=F,r((0,f.Z)({},b))):(F.push(y),b[k]=F,r((0,f.Z)({},b))),O.next=12;break;case 9:O.prev=9,O.t0=O.catch(0),console.log("Validate Failed:",O.t0);case 12:U();case 13:case"end":return O.stop()}},u,null,[[0,9]])}));return function(h){return d.apply(this,arguments)}}(),c=a.map(function(d){return d.editable?(0,f.Z)((0,f.Z)({},d),{},{onCell:function(h){return{record:h,inputType:"text",dataIndex:d.dataIndex,title:d.title,editing:D(h)}}}):d});return(0,t.jsx)(Ze.Z,{form:m,component:!1,children:(0,t.jsx)(Ke.Z,{components:At({height:450,cell:re,wrapTableRef:w}),bordered:!0,rowKey:Q,dataSource:b[k],columns:c,rowClassName:"editable-row",scroll:s,sticky:g,pagination:n})})},At=function(e){return xt=e.height,Oe=e.onReachEnd,we=e.wrapTableRef,{table:_r,body:{wrapper:Xr,row:Jr,cell:e.cell}}},ta=function(e){return ea(e)},ra=i(69610),aa=i(54941),na=i(81306),la=i(59206),ia=function(l){(0,na.Z)(a,l);var e=(0,la.Z)(a);function a(){return(0,ra.Z)(this,a),e.apply(this,arguments)}return(0,aa.Z)(a,[{key:"render",value:function(){return this.props.addonAfter?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(yt.Z,(0,f.Z)({style:{borderBottomRightRadius:0,borderTopRightRadius:0}},this.props)),(0,t.jsx)("div",{className:"ant-input-group-addon",style:{marginTop:"-4px",paddingTop:"2px",display:"inline-table",lineHeight:"24px",height:"32px"},children:this.props.addonAfter})]}):(0,t.jsx)(yt.Z,(0,f.Z)({},this.props))}}]),a}(v.Component),sa=i(53667),ua=i.n(sa),Nt=Xe.Z.Option,oa=function(){var e=(0,ae.YB)(),a=(0,ae.tT)("@@initialState"),s=a.initialState,g=a.setInitialState,n=(0,v.useState)({query1:"SHOW STORAGE GROUP"}),R=(0,Z.Z)(n,2),I=R[0],m=R[1],x=(0,v.useState)("query1"),b=(0,Z.Z)(x,2),r=b[0],k=b[1],Q=(0,v.useState)(!1),U=(0,Z.Z)(Q,2),w=U[0],M=U[1],D=(0,v.useState)(!1),P=(0,Z.Z)(D,2),$=P[0],V=P[1],A=(0,v.useState)(void 0),_=(0,Z.Z)(A,2),te=_[0],re=_[1],H=(0,v.useState)(!1),o=(0,Z.Z)(H,2),S=o[0],c=o[1],d=(0,v.useState)(!1),u=(0,Z.Z)(d,2),h=u[0],y=u[1],F=(0,v.useState)(!1),z=(0,Z.Z)(F,2),E=z[0],N=z[1],O=(0,v.useState)(void 0),ie=(0,Z.Z)(O,2),ee=ie[0],W=ie[1],le=(0,v.useRef)(null),xe=null,ce=(0,t.jsx)(Ht.Rt,{value:I[r],options:{mode:"text/iotdb-sql",theme:"juejin",autofocus:!0,lineNumbers:!0,tabindex:1,extraKeys:{"Alt-/":"autocomplete","Ctrl-/":"toggleComment"},matchBrackets:!0,readOnly:w,indentWithTabs:!0,smartIndent:!0,hintOptions:{completeSingle:!1}},onChange:function(p,T,C){T.origin!=null&&(T.removed[0].trim()!=""||T.text[0].match(/^[a-zA-Z0-9_]+$/))&&p.showHint(),I[r]=C}}),He=(0,v.useState)({tabActiveKey:"tab1",operationKey:"query1"}),ue=(0,Z.Z)(He,2),Ie=ue[0],Qe=ue[1],$e=(0,v.useState)({}),bt=(0,Z.Z)($e,2),B=bt[0],je=bt[1],qe=(0,v.useRef)([]);(0,v.useEffect)(function(){qe.current=B},[B]);var da=(0,v.useState)([]),Lt=(0,Z.Z)(da,2),de=Lt[0],Ve=Lt[1],be=(0,v.useRef)([]);(0,v.useEffect)(function(){be.current=de},[de]);var fa=(0,v.useState)([]),zt=(0,Z.Z)(fa,2),ye=zt[0],Ae=zt[1],ve=(0,v.useRef)([]);(0,v.useEffect)(function(){ve.current=ye},[ye]);var ma=(0,v.useState)([]),Gt=(0,Z.Z)(ma,2),pe=Gt[0],Qt=Gt[1],va=(0,v.useState)([]),Vt=(0,Z.Z)(va,2),Se=Vt[0],pa=Vt[1],ha=(0,v.useState)([]),Dt=(0,Z.Z)(ha,2),St=Dt[0],ya=Dt[1],ga=(0,v.useState)([]),Ut=(0,Z.Z)(ga,2),Ne=Ut[0],xa=Ut[1],ba=(0,v.useState)([{}]),Wt=(0,Z.Z)(ba,2),Tn=Wt[0],jn=Wt[1],Sa=(0,v.useState)(""),Bt=(0,Z.Z)(Sa,2),Za=Bt[0],Yt=Bt[1],Ta=(0,v.useState)({}),Kt=(0,Z.Z)(Ta,2),Ee=Kt[0],Jt=Kt[1],ja=(0,v.useState)([]),Xt=(0,Z.Z)(ja,2),De=Xt[0],qa=Xt[1],Ca=Ze.Z.useForm(),Ma=(0,Z.Z)(Ca,1),Zt=Ma[0],Re=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(X.Z,{type:"vertical"}),(0,t.jsxs)("span",{children:[e.formatMessage({id:"query.result.locate.text"})," "]}),(0,t.jsx)(ia,{style:{width:170,size:"small"},placeholder:"index or Time..",min:0,max:9223372036854776e3,onChange:function(p){De[r]=p,qa((0,f.Z)({},De))},onPressEnter:function(){_t()},addonAfter:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("a",{onClick:function(){_t()},children:"index "}),(0,t.jsx)(X.Z,{type:"vertical"}),e.formatMessage({id:"query.result.locate.or"}),(0,t.jsx)(X.Z,{type:"vertical"}),(0,t.jsx)("a",{onClick:function(){Ea()},children:"Time "})]})}),(0,t.jsx)(X.Z,{type:"vertical"}),(0,t.jsxs)(Xe.Z,{placeholder:e.formatMessage({id:"query.result.time.displayAs"}),style:{width:140},onChange:function(p){wa(p)},children:[(0,t.jsx)(Nt,{value:"number",children:"Number"}),(0,t.jsx)(Nt,{value:"utc",children:"UTC"})]}),(0,t.jsx)(X.Z,{type:"vertical"}),(0,t.jsx)("a",{onClick:function(){var p=be.current[r].map(function(T,C){return T.title}).filter(function(T){return T!="index"});ka(r,p,ve.current[r])},children:e.formatMessage({id:"query.result.download"})})]}),ka=function(p,T,C){var j={};j.fileName=p;var G=T.map(function(Y,J){return 10});j.datas=[{sheetData:C,sheetName:p,sheetFilter:T,sheetHeader:T,columnWidths:G}];var ne=new(ua())(j);ne.saveExcel()},wa=function(p){St[r]=p,ya((0,f.Z)({},St))},_t=function(){Ee[r]=De[r],Jt((0,f.Z)({},Ee)),er()},Ea=function(){if(be.current[r][1].title=="Time"){var p=ve.current[r].find(function(T){return T.Time>=De[r]});p=p==null?ve.current[r][ve.current[r].length-1]:p,Ee[r]=p.index,Jt((0,f.Z)({},Ee)),er()}},er=function(){var p=Ee[r]==null?0:Ee[r];p=p<1?1:p;var T=77*(p-1);le.current.parentNode.scrollTop=T},tr=function(){var L=(0,K.Z)(q().mark(function p(){var T,C,j,G,ne;return q().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return qe.current[r]=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{children:["".concat(r," ")+e.formatMessage({id:"query.result.cost.text"})+" ".concat(Se[r]," ms"),(0,t.jsx)(X.Z,{type:"vertical"}),e.formatMessage({id:"query.result.return.text"})+" ".concat(pe[r]," ")+e.formatMessage({id:"query.result.return.rows"}),(0,t.jsx)(X.Z,{type:"vertical"}),e.formatMessage({id:"query.result.load.ing"})]}),Re]}),J.next=3,Zr({queryToken:Ne[r]});case 3:if(T=J.sent,T.code=="0"){for(de[r]=[],C=JSON.parse(T.message||"{}"),j=T.data==null?[]:T.data,G=ve.current[r].length,pe[r]=G+j.length,Qt((0,f.Z)({},pe)),C.hasMore?qe.current[r]=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{children:["".concat(r," ")+e.formatMessage({id:"query.result.cost.text"})+" ".concat(Se[r]," ms"),(0,t.jsx)(X.Z,{type:"vertical"}),e.formatMessage({id:"query.result.return.text"})+" ".concat(pe[r]," ")+e.formatMessage({id:"query.result.return.rows"}),(0,t.jsx)(X.Z,{type:"vertical"})]}),(0,t.jsx)("a",{onClick:function(){tr()},children:e.formatMessage({id:"query.result.load.next"})}),Re]}):qe.current[r]=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{children:["".concat(r," ")+e.formatMessage({id:"query.result.cost.text"})+" ".concat(Se[r]," ms"),(0,t.jsx)(X.Z,{type:"vertical"}),e.formatMessage({id:"query.result.return.text"})+" ".concat(pe[r]," ")+e.formatMessage({id:"query.result.return.rows"}),(0,t.jsx)(X.Z,{type:"vertical"}),e.formatMessage({id:"query.result.load.done"})]}),Re]}),je((0,f.Z)({},qe.current)),ne=0;ne<j.length;ne++)Object.keys(j[ne]).map(function(oe,fe){if(be.current[r][oe]==null){var Tt={title:oe,editable:!0,dataIndex:oe,width:200,key:oe,render:function($a){return $a}};be.current[r][oe]=Tt,be.current[r][be.current[r].length]=Tt}}),j[ne].index=G+ne+1,ve.current[r][G+ne]=j[ne];ve.current[r]=ve.current[r].slice(),Ve((0,f.Z)({},be.current)),Ae((0,f.Z)({},ve.current))}else T.message!=null&&(qe.current[r]=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{children:["".concat(r," ")+e.formatMessage({id:"query.result.cost.text"})+" ".concat(Se[r]," ms"),(0,t.jsx)(X.Z,{type:"vertical"}),e.formatMessage({id:"query.result.return.text"})+" ".concat(pe[r]," ")+e.formatMessage({id:"query.result.return.rows"}),(0,t.jsx)(X.Z,{type:"vertical"}),"".concat(T.message)]}),Re]}),je((0,f.Z)({},qe.current)));case 5:case"end":return J.stop()}},p)}));return function(){return L.apply(this,arguments)}}(),Ra=function(p,T){p.preventDefault();for(var C=We,j=0;j<C.length;j++)if(C[j]!=null&&C[j].key=="query"+T){C[j]=null;break}C=C.filter(function(G){return G!=null}),ar(C),Le(),k("queryPlus"),Ye("Plus"),M(!0)},Ue=1,Pa=(0,v.useState)([{key:"query1",tab:(0,t.jsx)("span",{onClick:function(){k("query1"),Ye(1),Le()},children:e.formatMessage({id:"query.query.text"})+"1"})},{key:"queryPlus",tab:(0,t.jsx)(fr.Z,{onClick:function(p,T){if(Ue==100){alert(e.formatMessage({id:"query.query.rule"}));return}Ue+=1;var C=We,j=We.length;C[j]=C[j-1],C[j-1]={key:"query"+Ue,tab:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{onClick:function(){k("query"+j),Ye(j),Le()},children:[e.formatMessage({id:"query.query.text"})+Ue," "]}),(0,t.jsx)(Ct.Z,{title:"Sure to delete?",onConfirm:function(ne){Ra(ne,j)},children:(0,t.jsx)(mr.Z,{style:{cursor:"default"},title:"delete"})})]})},C=C.filter(function(G){return G!=null}),ar(C),k("query"+j),Ye(j)}})}]),rr=(0,Z.Z)(Pa,2),We=rr[0],ar=rr[1],nr=me.Z.Group,Be=function(){return r=="queryPlus"||w?(alert(e.formatMessage({id:"query.query.description"})),!0):!1},Le=function(){var p={};Object.keys(Zt.getFieldsValue()).map(function(T,C){p[T]=null}),Zt.setFieldsValue((0,f.Z)({},p)),Yt("")},lr=function(){var L=(0,K.Z)(q().mark(function p(){var T,C,j,G;return q().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(Le(),!Be()){Y.next=3;break}return Y.abrupt("return");case 3:return B[r]=null,je((0,f.Z)({},B)),de[r]=[],Ve((0,f.Z)({},de)),ye[r]=[],Ae((0,f.Z)({},ye)),Ne[r]==null&&(T=(0,Vr.v4)().replaceAll("-",""),Ne[r]=T,xa((0,f.Z)({},Ne))),Y.next=13,Sr({sqls:I[r],queryToken:Ne[r]});case 13:C=Y.sent,C.code=="0"?(j=JSON.parse(C.message||"{}"),G=C.data==null?[]:C.data,Se[r]=j.costMilliSecond==null?0:j.costMilliSecond,pa((0,f.Z)({},Se)),pe[r]=G.length,Qt(pe),j.hasMore?B[r]=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{children:["".concat(r," ")+e.formatMessage({id:"query.result.cost.text"})+" ".concat(Se[r]," ms"),(0,t.jsx)(X.Z,{type:"vertical"}),e.formatMessage({id:"query.result.return.text"})+" ".concat(pe[r]," ")+e.formatMessage({id:"query.result.return.rows"}),(0,t.jsx)(X.Z,{type:"vertical"})]}),(0,t.jsx)("a",{onClick:function(){tr()},children:e.formatMessage({id:"query.result.load.next"})}),Re]}):B[r]=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{children:["".concat(r," ")+e.formatMessage({id:"query.result.cost.text"})+" ".concat(Se[r]," ms"),(0,t.jsx)(X.Z,{type:"vertical"}),e.formatMessage({id:"query.result.return.text"})+" ".concat(pe[r]," ")+e.formatMessage({id:"query.result.return.rows"}),(0,t.jsx)(X.Z,{type:"vertical"}),"".concat(G.length==0?e.formatMessage({id:"query.result.execute.done"}):e.formatMessage({id:"query.result.load.done"}))]}),(0,t.jsx)("span",{children:Re})]}),je((0,f.Z)({},B)),G.length==0?(de[r]=[],Ve((0,f.Z)({},de)),ye[r]=[],Ae((0,f.Z)({},ye))):function(){for(var J=[],oe=0;oe<G.length;oe++)J.index==null&&(J.index={title:"index",editable:!1,dataIndex:"index",width:70,key:"index",fixed:"left"},J[J.length]=J.index),Object.keys(G[oe]).map(function(fe,Tt){J[fe]==null&&(J[fe]={title:fe,editable:!(fe=="Time"||fe=="Device"),dataIndex:fe,width:190,key:fe,fixed:fe=="Time"||fe=="Device"?"left":!1},J[J.length]=J[fe])}),G[oe].index=oe+1;de[r]=J,Ve((0,f.Z)({},de)),ye[r]=G.slice(),Ae((0,f.Z)({},ye))}()):(B[r]=r+" "+e.formatMessage({id:"query.result.execute.failed"}),je((0,f.Z)({},B)),se.default.error({message:C.message}));case 15:case"end":return Y.stop()}},p)}));return function(){return L.apply(this,arguments)}}(),ir=function(){Be()||c(!0)},Fa=function(){var L=(0,K.Z)(q().mark(function p(T,C,j){var G;return q().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:if(!Be()){Y.next=2;break}return Y.abrupt("return");case 2:return Y.next=5,jr({point:C,value:j,timestamp:T});case 5:return G=Y.sent,Y.abrupt("return",G);case 7:case"end":return Y.stop()}},p)}));return function(T,C,j){return L.apply(this,arguments)}}(),sr=function(){var L=(0,K.Z)(q().mark(function p(){var T;return q().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(!Be()){j.next=2;break}return j.abrupt("return");case 2:return j.next=5,Et({pageSize:10,pageNum:1});case 5:T=j.sent,Fe.dealCallback(T,function(G){var ne=0;G.data.pageItems.map(function(Y){Y.key=ne++}),re(G.data),V(!0)},se.default);case 7:case"end":return j.stop()}},p)}));return function(){return L.apply(this,arguments)}}(),Oa=function(p){if(p.queryCommand==null||p.queryCommand.trim()==""){se.default.error({message:e.formatMessage({id:"query.sql.export.required"})});return}var T="/api/query/exportCsv?sqls="+p.queryCommand+"&timeformat="+p.timeformat+"&timeZone="+p.timeZone+"&compress="+p.compress+"&targetFile="+(p.targetFile==null?"dump":p.targetFile);Fe.download2(T)},Ha=(0,t.jsx)(yr.Z.Consumer,{children:function(p){var T=p.isMobile;return T?(0,t.jsx)(v.Fragment,{children:(0,t.jsxs)(nr,{children:[(0,t.jsxs)(me.Z,{onClick:ir,children:[(0,t.jsx)(Mt.Z,{}),e.formatMessage({id:"query.sql.script.save"})]}),(0,t.jsxs)(me.Z,{onClick:sr,children:[(0,t.jsx)(kt.Z,{}),e.formatMessage({id:"query.sql.script.view"})]}),(0,t.jsxs)(me.Z,{onClick:lr,type:"primary",children:[(0,t.jsx)(wt.Z,{}),e.formatMessage({id:"query.sql.execute"})]})]})}):(0,t.jsx)(v.Fragment,{children:(0,t.jsxs)(nr,{children:[(0,t.jsxs)(me.Z,{onClick:lr,type:"primary",children:[(0,t.jsx)(wt.Z,{}),e.formatMessage({id:"query.sql.execute"})]}),(0,t.jsxs)(me.Z,{onClick:ir,children:[(0,t.jsx)(kt.Z,{}),e.formatMessage({id:"query.sql.script.save"})]}),(0,t.jsxs)(cr.Z.Button,{trigger:["hover"],onClick:sr,icon:(0,t.jsx)(vr.Z,{}),overlay:(0,t.jsxs)(Je.Z,{children:[(0,t.jsxs)(Je.Z.Item,{onClick:function(){W(I[r]),y(!0)},children:[(0,t.jsx)(pr.Z,{})," ",e.formatMessage({id:"query.sql.export"})]},"exportCsv"),(0,t.jsxs)(Je.Z.Item,{onClick:function(){W(I[r]),N(!0)},children:[(0,t.jsx)(hr.Z,{})," ",e.formatMessage({id:"query.sql.import"})]},"importCsv")]}),placement:"bottomRight",children:[(0,t.jsx)(Mt.Z,{}),e.formatMessage({id:"query.sql.script.view"})]})]})})}}),Ia={},ur=Ia.loading;xe={queryPlus:(0,t.jsx)(Ke.Z,{pagination:!1,loading:ur,dataSource:[],columns:[],scroll:{y:450,scrollToFirstRowOnChange:!1},sticky:!1,components:At({height:450})})};for(var Pe=1;Pe<100;Pe++)xe["query"+Pe]=(0,t.jsx)(ta,{rowKey:"index",loading:ur,columns:de["query"+Pe]==null?[]:de["query"+Pe],scroll:{y:450,scrollToFirstRowOnChange:!1},sticky:!1,pagination:!1,data:ye,setData:Ae,active:"query"+Pe,editingKey:Za,setEditingKey:Yt,form:Zt,clearEditable:Le,updatePoint:Fa,wrapTableRef:le,timeDisplayForm:St});var Ye=function(p){M(!1),Qe({tabActiveKey:"tab"+p,operationKey:"query"+p})};return(0,t.jsxs)(gr.ZP,{title:s.activeConnectionDesc,extra:Ha,className:Te().pageHeader,content:ce,tabList:We,tabActiveKey:r,children:[(0,t.jsx)("div",{className:Te().main,children:(0,t.jsx)(xr.Z,{children:(0,t.jsx)(or.Z,{id:"s",className:Te().tabsCard,title:B[r],bordered:!1,children:xe[Ie.operationKey]})})}),(0,t.jsx)(Or,{visible:$,setVisible:V,content:te,setContent:re,querySql:I,setQuerySql:m,activeQueryTabkey:r}),(0,t.jsx)(Ir,{visible:S,setVisible:c,querySql:I,activeQueryTabkey:r}),(0,t.jsx)(Lr,{visible:h,setVisible:y,exportCsv:Oa,activeQueryTabkey:r,initExportSql:ee}),(0,t.jsx)(Qr,{destroyOnClose:!0,visible:E,setVisible:N,activeQueryTabkey:r,initExportSql:ee})]})},ca=oa}}]);
